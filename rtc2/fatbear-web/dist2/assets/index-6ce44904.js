var a5=(o,d)=>()=>(d||o((d={exports:{}}).exports,d),d.exports);var vz=a5((ny,wk)=>{(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))_(E);new MutationObserver(E=>{for(const T of E)if(T.type==="childList")for(const R of T.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&_(R)}).observe(document,{childList:!0,subtree:!0});function p(E){const T={};return E.integrity&&(T.integrity=E.integrity),E.referrerPolicy&&(T.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?T.credentials="include":E.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function _(E){if(E.ep)return;E.ep=!0;const T=p(E);fetch(E.href,T)}})();function iy(o,d){const p=Object.create(null),_=o.split(",");for(let E=0;E<_.length;E++)p[_[E]]=!0;return d?E=>!!p[E.toLowerCase()]:E=>!!p[E]}const Xn={},wl=[],$r=()=>{},c5=()=>!1,d5=/^on[^a-z]/,Sm=o=>d5.test(o),sy=o=>o.startsWith("onUpdate:"),vi=Object.assign,ry=(o,d)=>{const p=o.indexOf(d);p>-1&&o.splice(p,1)},l5=Object.prototype.hasOwnProperty,pn=(o,d)=>l5.call(o,d),ve=Array.isArray,Ol=o=>Qh(o)==="[object Map]",HD=o=>Qh(o)==="[object Set]",TN=o=>Qh(o)==="[object Date]",Ke=o=>typeof o=="function",yi=o=>typeof o=="string",Bh=o=>typeof o=="symbol",Fn=o=>o!==null&&typeof o=="object",KD=o=>Fn(o)&&Ke(o.then)&&Ke(o.catch),qD=Object.prototype.toString,Qh=o=>qD.call(o),u5=o=>Qh(o).slice(8,-1),YD=o=>Qh(o)==="[object Object]",oy=o=>yi(o)&&o!=="NaN"&&o[0]!=="-"&&""+parseInt(o,10)===o,Y_=iy(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),vm=o=>{const d=Object.create(null);return p=>d[p]||(d[p]=o(p))},h5=/-(\w)/g,Lo=vm(o=>o.replace(h5,(d,p)=>p?p.toUpperCase():"")),p5=/\B([A-Z])/g,jl=vm(o=>o.replace(p5,"-$1").toLowerCase()),ym=vm(o=>o.charAt(0).toUpperCase()+o.slice(1)),z_=vm(o=>o?`on${ym(o)}`:""),jh=(o,d)=>!Object.is(o,d),J_=(o,d)=>{for(let p=0;p<o.length;p++)o[p](d)},am=(o,d,p)=>{Object.defineProperty(o,d,{configurable:!0,enumerable:!1,value:p})},wv=o=>{const d=parseFloat(o);return isNaN(d)?o:d},f5=o=>{const d=yi(o)?Number(o):NaN;return isNaN(d)?o:d};let SN;const Ov=()=>SN||(SN=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Zh(o){if(ve(o)){const d={};for(let p=0;p<o.length;p++){const _=o[p],E=yi(_)?g5(_):Zh(_);if(E)for(const T in E)d[T]=E[T]}return d}else{if(yi(o))return o;if(Fn(o))return o}}const _5=/;(?![^(]*\))/g,m5=/:([^]+)/,E5=/\/\*[^]*?\*\//g;function g5(o){const d={};return o.replace(E5,"").split(_5).forEach(p=>{if(p){const _=p.split(m5);_.length>1&&(d[_[0].trim()]=_[1].trim())}}),d}function uc(o){let d="";if(yi(o))d=o;else if(ve(o))for(let p=0;p<o.length;p++){const _=uc(o[p]);_&&(d+=_+" ")}else if(Fn(o))for(const p in o)o[p]&&(d+=p+" ");return d.trim()}const T5="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",S5=iy(T5);function zD(o){return!!o||o===""}function v5(o,d){if(o.length!==d.length)return!1;let p=!0;for(let _=0;p&&_<o.length;_++)p=cm(o[_],d[_]);return p}function cm(o,d){if(o===d)return!0;let p=TN(o),_=TN(d);if(p||_)return p&&_?o.getTime()===d.getTime():!1;if(p=Bh(o),_=Bh(d),p||_)return o===d;if(p=ve(o),_=ve(d),p||_)return p&&_?v5(o,d):!1;if(p=Fn(o),_=Fn(d),p||_){if(!p||!_)return!1;const E=Object.keys(o).length,T=Object.keys(d).length;if(E!==T)return!1;for(const R in o){const N=o.hasOwnProperty(R),D=d.hasOwnProperty(R);if(N&&!D||!N&&D||!cm(o[R],d[R]))return!1}}return String(o)===String(d)}const fi=o=>yi(o)?o:o==null?"":ve(o)||Fn(o)&&(o.toString===qD||!Ke(o.toString))?JSON.stringify(o,JD,2):String(o),JD=(o,d)=>d&&d.__v_isRef?JD(o,d.value):Ol(d)?{[`Map(${d.size})`]:[...d.entries()].reduce((p,[_,E])=>(p[`${_} =>`]=E,p),{})}:HD(d)?{[`Set(${d.size})`]:[...d.values()]}:Fn(d)&&!ve(d)&&!YD(d)?String(d):d;let hr;class XD{constructor(d=!1){this.detached=d,this._active=!0,this.effects=[],this.cleanups=[],this.parent=hr,!d&&hr&&(this.index=(hr.scopes||(hr.scopes=[])).push(this)-1)}get active(){return this._active}run(d){if(this._active){const p=hr;try{return hr=this,d()}finally{hr=p}}}on(){hr=this}off(){hr=this.parent}stop(d){if(this._active){let p,_;for(p=0,_=this.effects.length;p<_;p++)this.effects[p].stop();for(p=0,_=this.cleanups.length;p<_;p++)this.cleanups[p]();if(this.scopes)for(p=0,_=this.scopes.length;p<_;p++)this.scopes[p].stop(!0);if(!this.detached&&this.parent&&!d){const E=this.parent.scopes.pop();E&&E!==this&&(this.parent.scopes[this.index]=E,E.index=this.index)}this.parent=void 0,this._active=!1}}}function $D(o){return new XD(o)}function y5(o,d=hr){d&&d.active&&d.effects.push(o)}function QD(){return hr}function C5(o){hr&&hr.cleanups.push(o)}const ay=o=>{const d=new Set(o);return d.w=0,d.n=0,d},ZD=o=>(o.w&hc)>0,tP=o=>(o.n&hc)>0,R5=({deps:o})=>{if(o.length)for(let d=0;d<o.length;d++)o[d].w|=hc},b5=o=>{const{deps:d}=o;if(d.length){let p=0;for(let _=0;_<d.length;_++){const E=d[_];ZD(E)&&!tP(E)?E.delete(o):d[p++]=E,E.w&=~hc,E.n&=~hc}d.length=p}},dm=new WeakMap;let bh=0,hc=1;const Nv=30;let Yr;const dd=Symbol(""),Dv=Symbol("");class cy{constructor(d,p=null,_){this.fn=d,this.scheduler=p,this.active=!0,this.deps=[],this.parent=void 0,y5(this,_)}run(){if(!this.active)return this.fn();let d=Yr,p=cc;for(;d;){if(d===this)return;d=d.parent}try{return this.parent=Yr,Yr=this,cc=!0,hc=1<<++bh,bh<=Nv?R5(this):vN(this),this.fn()}finally{bh<=Nv&&b5(this),hc=1<<--bh,Yr=this.parent,cc=p,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Yr===this?this.deferStop=!0:this.active&&(vN(this),this.onStop&&this.onStop(),this.active=!1)}}function vN(o){const{deps:d}=o;if(d.length){for(let p=0;p<d.length;p++)d[p].delete(o);d.length=0}}let cc=!0;const eP=[];function Gl(){eP.push(cc),cc=!1}function Wl(){const o=eP.pop();cc=o===void 0?!0:o}function Ys(o,d,p){if(cc&&Yr){let _=dm.get(o);_||dm.set(o,_=new Map);let E=_.get(p);E||_.set(p,E=ay()),nP(E)}}function nP(o,d){let p=!1;bh<=Nv?tP(o)||(o.n|=hc,p=!ZD(o)):p=!o.has(Yr),p&&(o.add(Yr),Yr.deps.push(o))}function ha(o,d,p,_,E,T){const R=dm.get(o);if(!R)return;let N=[];if(d==="clear")N=[...R.values()];else if(p==="length"&&ve(o)){const D=Number(_);R.forEach((M,P)=>{(P==="length"||P>=D)&&N.push(M)})}else switch(p!==void 0&&N.push(R.get(p)),d){case"add":ve(o)?oy(p)&&N.push(R.get("length")):(N.push(R.get(dd)),Ol(o)&&N.push(R.get(Dv)));break;case"delete":ve(o)||(N.push(R.get(dd)),Ol(o)&&N.push(R.get(Dv)));break;case"set":Ol(o)&&N.push(R.get(dd));break}if(N.length===1)N[0]&&Pv(N[0]);else{const D=[];for(const M of N)M&&D.push(...M);Pv(ay(D))}}function Pv(o,d){const p=ve(o)?o:[...o];for(const _ of p)_.computed&&yN(_);for(const _ of p)_.computed||yN(_)}function yN(o,d){(o!==Yr||o.allowRecurse)&&(o.scheduler?o.scheduler():o.run())}function I5(o,d){var p;return(p=dm.get(o))==null?void 0:p.get(d)}const A5=iy("__proto__,__v_isRef,__isVue"),iP=new Set(Object.getOwnPropertyNames(Symbol).filter(o=>o!=="arguments"&&o!=="caller").map(o=>Symbol[o]).filter(Bh)),w5=dy(),O5=dy(!1,!0),N5=dy(!0),CN=D5();function D5(){const o={};return["includes","indexOf","lastIndexOf"].forEach(d=>{o[d]=function(...p){const _=an(this);for(let T=0,R=this.length;T<R;T++)Ys(_,"get",T+"");const E=_[d](...p);return E===-1||E===!1?_[d](...p.map(an)):E}}),["push","pop","shift","unshift","splice"].forEach(d=>{o[d]=function(...p){Gl();const _=an(this)[d].apply(this,p);return Wl(),_}}),o}function P5(o){const d=an(this);return Ys(d,"has",o),d.hasOwnProperty(o)}function dy(o=!1,d=!1){return function(_,E,T){if(E==="__v_isReactive")return!o;if(E==="__v_isReadonly")return o;if(E==="__v_isShallow")return d;if(E==="__v_raw"&&T===(o?d?z5:cP:d?aP:oP).get(_))return _;const R=ve(_);if(!o){if(R&&pn(CN,E))return Reflect.get(CN,E,T);if(E==="hasOwnProperty")return P5}const N=Reflect.get(_,E,T);return(Bh(E)?iP.has(E):A5(E))||(o||Ys(_,"get",E),d)?N:di(N)?R&&oy(E)?N:N.value:Fn(N)?o?lP(N):tp(N):N}}const L5=sP(),k5=sP(!0);function sP(o=!1){return function(p,_,E,T){let R=p[_];if(Dl(R)&&di(R)&&!di(E))return!1;if(!o&&(!lm(E)&&!Dl(E)&&(R=an(R),E=an(E)),!ve(p)&&di(R)&&!di(E)))return R.value=E,!0;const N=ve(p)&&oy(_)?Number(_)<p.length:pn(p,_),D=Reflect.set(p,_,E,T);return p===an(T)&&(N?jh(E,R)&&ha(p,"set",_,E):ha(p,"add",_,E)),D}}function M5(o,d){const p=pn(o,d);o[d];const _=Reflect.deleteProperty(o,d);return _&&p&&ha(o,"delete",d,void 0),_}function U5(o,d){const p=Reflect.has(o,d);return(!Bh(d)||!iP.has(d))&&Ys(o,"has",d),p}function x5(o){return Ys(o,"iterate",ve(o)?"length":dd),Reflect.ownKeys(o)}const rP={get:w5,set:L5,deleteProperty:M5,has:U5,ownKeys:x5},V5={get:N5,set(o,d){return!0},deleteProperty(o,d){return!0}},F5=vi({},rP,{get:O5,set:k5}),ly=o=>o,Cm=o=>Reflect.getPrototypeOf(o);function B_(o,d,p=!1,_=!1){o=o.__v_raw;const E=an(o),T=an(d);p||(d!==T&&Ys(E,"get",d),Ys(E,"get",T));const{has:R}=Cm(E),N=_?ly:p?py:Gh;if(R.call(E,d))return N(o.get(d));if(R.call(E,T))return N(o.get(T));o!==E&&o.get(d)}function j_(o,d=!1){const p=this.__v_raw,_=an(p),E=an(o);return d||(o!==E&&Ys(_,"has",o),Ys(_,"has",E)),o===E?p.has(o):p.has(o)||p.has(E)}function G_(o,d=!1){return o=o.__v_raw,!d&&Ys(an(o),"iterate",dd),Reflect.get(o,"size",o)}function RN(o){o=an(o);const d=an(this);return Cm(d).has.call(d,o)||(d.add(o),ha(d,"add",o,o)),this}function bN(o,d){d=an(d);const p=an(this),{has:_,get:E}=Cm(p);let T=_.call(p,o);T||(o=an(o),T=_.call(p,o));const R=E.call(p,o);return p.set(o,d),T?jh(d,R)&&ha(p,"set",o,d):ha(p,"add",o,d),this}function IN(o){const d=an(this),{has:p,get:_}=Cm(d);let E=p.call(d,o);E||(o=an(o),E=p.call(d,o)),_&&_.call(d,o);const T=d.delete(o);return E&&ha(d,"delete",o,void 0),T}function AN(){const o=an(this),d=o.size!==0,p=o.clear();return d&&ha(o,"clear",void 0,void 0),p}function W_(o,d){return function(_,E){const T=this,R=T.__v_raw,N=an(R),D=d?ly:o?py:Gh;return!o&&Ys(N,"iterate",dd),R.forEach((M,P)=>_.call(E,D(M),D(P),T))}}function H_(o,d,p){return function(..._){const E=this.__v_raw,T=an(E),R=Ol(T),N=o==="entries"||o===Symbol.iterator&&R,D=o==="keys"&&R,M=E[o](..._),P=p?ly:d?py:Gh;return!d&&Ys(T,"iterate",D?Dv:dd),{next(){const{value:j,done:q}=M.next();return q?{value:j,done:q}:{value:N?[P(j[0]),P(j[1])]:P(j),done:q}},[Symbol.iterator](){return this}}}}function tc(o){return function(...d){return o==="delete"?!1:this}}function B5(){const o={get(T){return B_(this,T)},get size(){return G_(this)},has:j_,add:RN,set:bN,delete:IN,clear:AN,forEach:W_(!1,!1)},d={get(T){return B_(this,T,!1,!0)},get size(){return G_(this)},has:j_,add:RN,set:bN,delete:IN,clear:AN,forEach:W_(!1,!0)},p={get(T){return B_(this,T,!0)},get size(){return G_(this,!0)},has(T){return j_.call(this,T,!0)},add:tc("add"),set:tc("set"),delete:tc("delete"),clear:tc("clear"),forEach:W_(!0,!1)},_={get(T){return B_(this,T,!0,!0)},get size(){return G_(this,!0)},has(T){return j_.call(this,T,!0)},add:tc("add"),set:tc("set"),delete:tc("delete"),clear:tc("clear"),forEach:W_(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(T=>{o[T]=H_(T,!1,!1),p[T]=H_(T,!0,!1),d[T]=H_(T,!1,!0),_[T]=H_(T,!0,!0)}),[o,p,d,_]}const[j5,G5,W5,H5]=B5();function uy(o,d){const p=d?o?H5:W5:o?G5:j5;return(_,E,T)=>E==="__v_isReactive"?!o:E==="__v_isReadonly"?o:E==="__v_raw"?_:Reflect.get(pn(p,E)&&E in _?p:_,E,T)}const K5={get:uy(!1,!1)},q5={get:uy(!1,!0)},Y5={get:uy(!0,!1)},oP=new WeakMap,aP=new WeakMap,cP=new WeakMap,z5=new WeakMap;function J5(o){switch(o){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function X5(o){return o.__v_skip||!Object.isExtensible(o)?0:J5(u5(o))}function tp(o){return Dl(o)?o:hy(o,!1,rP,K5,oP)}function dP(o){return hy(o,!1,F5,q5,aP)}function lP(o){return hy(o,!0,V5,Y5,cP)}function hy(o,d,p,_,E){if(!Fn(o)||o.__v_raw&&!(d&&o.__v_isReactive))return o;const T=E.get(o);if(T)return T;const R=X5(o);if(R===0)return o;const N=new Proxy(o,R===2?_:p);return E.set(o,N),N}function dc(o){return Dl(o)?dc(o.__v_raw):!!(o&&o.__v_isReactive)}function Dl(o){return!!(o&&o.__v_isReadonly)}function lm(o){return!!(o&&o.__v_isShallow)}function uP(o){return dc(o)||Dl(o)}function an(o){const d=o&&o.__v_raw;return d?an(d):o}function Rm(o){return am(o,"__v_skip",!0),o}const Gh=o=>Fn(o)?tp(o):o,py=o=>Fn(o)?lP(o):o;function hP(o){cc&&Yr&&(o=an(o),nP(o.dep||(o.dep=ay())))}function pP(o,d){o=an(o);const p=o.dep;p&&Pv(p)}function di(o){return!!(o&&o.__v_isRef===!0)}function ze(o){return fP(o,!1)}function $5(o){return fP(o,!0)}function fP(o,d){return di(o)?o:new Q5(o,d)}class Q5{constructor(d,p){this.__v_isShallow=p,this.dep=void 0,this.__v_isRef=!0,this._rawValue=p?d:an(d),this._value=p?d:Gh(d)}get value(){return hP(this),this._value}set value(d){const p=this.__v_isShallow||lm(d)||Dl(d);d=p?d:an(d),jh(d,this._rawValue)&&(this._rawValue=d,this._value=p?d:Gh(d),pP(this))}}function Zi(o){return di(o)?o.value:o}const Z5={get:(o,d,p)=>Zi(Reflect.get(o,d,p)),set:(o,d,p,_)=>{const E=o[d];return di(E)&&!di(p)?(E.value=p,!0):Reflect.set(o,d,p,_)}};function _P(o){return dc(o)?o:new Proxy(o,Z5)}function tG(o){const d=ve(o)?new Array(o.length):{};for(const p in o)d[p]=nG(o,p);return d}class eG{constructor(d,p,_){this._object=d,this._key=p,this._defaultValue=_,this.__v_isRef=!0}get value(){const d=this._object[this._key];return d===void 0?this._defaultValue:d}set value(d){this._object[this._key]=d}get dep(){return I5(an(this._object),this._key)}}function nG(o,d,p){const _=o[d];return di(_)?_:new eG(o,d,p)}class iG{constructor(d,p,_,E){this._setter=p,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new cy(d,()=>{this._dirty||(this._dirty=!0,pP(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!E,this.__v_isReadonly=_}get value(){const d=an(this);return hP(d),(d._dirty||!d._cacheable)&&(d._dirty=!1,d._value=d.effect.run()),d._value}set value(d){this._setter(d)}}function sG(o,d,p=!1){let _,E;const T=Ke(o);return T?(_=o,E=$r):(_=o.get,E=o.set),new iG(_,E,T||!E,p)}function lc(o,d,p,_){let E;try{E=_?o(..._):o()}catch(T){bm(T,d,p)}return E}function Lr(o,d,p,_){if(Ke(o)){const T=lc(o,d,p,_);return T&&KD(T)&&T.catch(R=>{bm(R,d,p)}),T}const E=[];for(let T=0;T<o.length;T++)E.push(Lr(o[T],d,p,_));return E}function bm(o,d,p,_=!0){const E=d?d.vnode:null;if(d){let T=d.parent;const R=d.proxy,N=p;for(;T;){const M=T.ec;if(M){for(let P=0;P<M.length;P++)if(M[P](o,R,N)===!1)return}T=T.parent}const D=d.appContext.config.errorHandler;if(D){lc(D,null,10,[o,R,N]);return}}rG(o,p,E,_)}function rG(o,d,p,_=!0){console.error(o)}let Wh=!1,Lv=!1;const hs=[];let Oo=0;const Nl=[];let ca=null,sd=0;const mP=Promise.resolve();let fy=null;function Im(o){const d=fy||mP;return o?d.then(this?o.bind(this):o):d}function oG(o){let d=Oo+1,p=hs.length;for(;d<p;){const _=d+p>>>1;Hh(hs[_])<o?d=_+1:p=_}return d}function _y(o){(!hs.length||!hs.includes(o,Wh&&o.allowRecurse?Oo+1:Oo))&&(o.id==null?hs.push(o):hs.splice(oG(o.id),0,o),EP())}function EP(){!Wh&&!Lv&&(Lv=!0,fy=mP.then(TP))}function aG(o){const d=hs.indexOf(o);d>Oo&&hs.splice(d,1)}function cG(o){ve(o)?Nl.push(...o):(!ca||!ca.includes(o,o.allowRecurse?sd+1:sd))&&Nl.push(o),EP()}function wN(o,d=Wh?Oo+1:0){for(;d<hs.length;d++){const p=hs[d];p&&p.pre&&(hs.splice(d,1),d--,p())}}function gP(o){if(Nl.length){const d=[...new Set(Nl)];if(Nl.length=0,ca){ca.push(...d);return}for(ca=d,ca.sort((p,_)=>Hh(p)-Hh(_)),sd=0;sd<ca.length;sd++)ca[sd]();ca=null,sd=0}}const Hh=o=>o.id==null?1/0:o.id,dG=(o,d)=>{const p=Hh(o)-Hh(d);if(p===0){if(o.pre&&!d.pre)return-1;if(d.pre&&!o.pre)return 1}return p};function TP(o){Lv=!1,Wh=!0,hs.sort(dG);const d=$r;try{for(Oo=0;Oo<hs.length;Oo++){const p=hs[Oo];p&&p.active!==!1&&lc(p,null,14)}}finally{Oo=0,hs.length=0,gP(),Wh=!1,fy=null,(hs.length||Nl.length)&&TP()}}function lG(o,d,...p){if(o.isUnmounted)return;const _=o.vnode.props||Xn;let E=p;const T=d.startsWith("update:"),R=T&&d.slice(7);if(R&&R in _){const P=`${R==="modelValue"?"model":R}Modifiers`,{number:j,trim:q}=_[P]||Xn;q&&(E=p.map(tt=>yi(tt)?tt.trim():tt)),j&&(E=p.map(wv))}let N,D=_[N=z_(d)]||_[N=z_(Lo(d))];!D&&T&&(D=_[N=z_(jl(d))]),D&&Lr(D,o,6,E);const M=_[N+"Once"];if(M){if(!o.emitted)o.emitted={};else if(o.emitted[N])return;o.emitted[N]=!0,Lr(M,o,6,E)}}function SP(o,d,p=!1){const _=d.emitsCache,E=_.get(o);if(E!==void 0)return E;const T=o.emits;let R={},N=!1;if(!Ke(o)){const D=M=>{const P=SP(M,d,!0);P&&(N=!0,vi(R,P))};!p&&d.mixins.length&&d.mixins.forEach(D),o.extends&&D(o.extends),o.mixins&&o.mixins.forEach(D)}return!T&&!N?(Fn(o)&&_.set(o,null),null):(ve(T)?T.forEach(D=>R[D]=null):vi(R,T),Fn(o)&&_.set(o,R),R)}function Am(o,d){return!o||!Sm(d)?!1:(d=d.slice(2).replace(/Once$/,""),pn(o,d[0].toLowerCase()+d.slice(1))||pn(o,jl(d))||pn(o,d))}let Ki=null,wm=null;function um(o){const d=Ki;return Ki=o,wm=o&&o.type.__scopeId||null,d}function my(o){wm=o}function Ey(){wm=null}function ep(o,d=Ki,p){if(!d||o._n)return o;const _=(...E)=>{_._d&&FN(-1);const T=um(d);let R;try{R=o(...E)}finally{um(T),_._d&&FN(1)}return R};return _._n=!0,_._c=!0,_._d=!0,_}function _v(o){const{type:d,vnode:p,proxy:_,withProxy:E,props:T,propsOptions:[R],slots:N,attrs:D,emit:M,render:P,renderCache:j,data:q,setupState:tt,ctx:at,inheritAttrs:lt}=o;let vt,wt;const It=um(o);try{if(p.shapeFlag&4){const Et=E||_;vt=wo(P.call(Et,Et,j,T,tt,q,at)),wt=D}else{const Et=d;vt=wo(Et.length>1?Et(T,{attrs:D,slots:N,emit:M}):Et(T,null)),wt=d.props?D:uG(D)}}catch(Et){Ph.length=0,bm(Et,o,1),vt=ri(pa)}let Bt=vt;if(wt&&lt!==!1){const Et=Object.keys(wt),{shapeFlag:jt}=Bt;Et.length&&jt&7&&(R&&Et.some(sy)&&(wt=hG(wt,R)),Bt=fd(Bt,wt))}return p.dirs&&(Bt=fd(Bt),Bt.dirs=Bt.dirs?Bt.dirs.concat(p.dirs):p.dirs),p.transition&&(Bt.transition=p.transition),vt=Bt,um(It),vt}const uG=o=>{let d;for(const p in o)(p==="class"||p==="style"||Sm(p))&&((d||(d={}))[p]=o[p]);return d},hG=(o,d)=>{const p={};for(const _ in o)(!sy(_)||!(_.slice(9)in d))&&(p[_]=o[_]);return p};function pG(o,d,p){const{props:_,children:E,component:T}=o,{props:R,children:N,patchFlag:D}=d,M=T.emitsOptions;if(d.dirs||d.transition)return!0;if(p&&D>=0){if(D&1024)return!0;if(D&16)return _?ON(_,R,M):!!R;if(D&8){const P=d.dynamicProps;for(let j=0;j<P.length;j++){const q=P[j];if(R[q]!==_[q]&&!Am(M,q))return!0}}}else return(E||N)&&(!N||!N.$stable)?!0:_===R?!1:_?R?ON(_,R,M):!0:!!R;return!1}function ON(o,d,p){const _=Object.keys(d);if(_.length!==Object.keys(o).length)return!0;for(let E=0;E<_.length;E++){const T=_[E];if(d[T]!==o[T]&&!Am(p,T))return!0}return!1}function fG({vnode:o,parent:d},p){for(;d&&d.subTree===o;)(o=d.vnode).el=p,d=d.parent}const _G=o=>o.__isSuspense;function mG(o,d){d&&d.pendingBranch?ve(o)?d.effects.push(...o):d.effects.push(o):cG(o)}const K_={};function Oh(o,d,p){return vP(o,d,p)}function vP(o,d,{immediate:p,deep:_,flush:E,onTrack:T,onTrigger:R}=Xn){var N;const D=QD()===((N=Ui)==null?void 0:N.scope)?Ui:null;let M,P=!1,j=!1;if(di(o)?(M=()=>o.value,P=lm(o)):dc(o)?(M=()=>o,_=!0):ve(o)?(j=!0,P=o.some(Et=>dc(Et)||lm(Et)),M=()=>o.map(Et=>{if(di(Et))return Et.value;if(dc(Et))return ad(Et);if(Ke(Et))return lc(Et,D,2)})):Ke(o)?d?M=()=>lc(o,D,2):M=()=>{if(!(D&&D.isUnmounted))return q&&q(),Lr(o,D,3,[tt])}:M=$r,d&&_){const Et=M;M=()=>ad(Et())}let q,tt=Et=>{q=It.onStop=()=>{lc(Et,D,4)}},at;if(Yh)if(tt=$r,d?p&&Lr(d,D,3,[M(),j?[]:void 0,tt]):M(),E==="sync"){const Et=lW();at=Et.__watcherHandles||(Et.__watcherHandles=[])}else return $r;let lt=j?new Array(o.length).fill(K_):K_;const vt=()=>{if(It.active)if(d){const Et=It.run();(_||P||(j?Et.some((jt,re)=>jh(jt,lt[re])):jh(Et,lt)))&&(q&&q(),Lr(d,D,3,[Et,lt===K_?void 0:j&&lt[0]===K_?[]:lt,tt]),lt=Et)}else It.run()};vt.allowRecurse=!!d;let wt;E==="sync"?wt=vt:E==="post"?wt=()=>qs(vt,D&&D.suspense):(vt.pre=!0,D&&(vt.id=D.uid),wt=()=>_y(vt));const It=new cy(M,wt);d?p?vt():lt=It.run():E==="post"?qs(It.run.bind(It),D&&D.suspense):It.run();const Bt=()=>{It.stop(),D&&D.scope&&ry(D.scope.effects,It)};return at&&at.push(Bt),Bt}function EG(o,d,p){const _=this.proxy,E=yi(o)?o.includes(".")?yP(_,o):()=>_[o]:o.bind(_,_);let T;Ke(d)?T=d:(T=d.handler,p=d);const R=Ui;Pl(this);const N=vP(E,T.bind(_),p);return R?Pl(R):ud(),N}function yP(o,d){const p=d.split(".");return()=>{let _=o;for(let E=0;E<p.length&&_;E++)_=_[p[E]];return _}}function ad(o,d){if(!Fn(o)||o.__v_skip||(d=d||new Set,d.has(o)))return o;if(d.add(o),di(o))ad(o.value,d);else if(ve(o))for(let p=0;p<o.length;p++)ad(o[p],d);else if(HD(o)||Ol(o))o.forEach(p=>{ad(p,d)});else if(YD(o))for(const p in o)ad(o[p],d);return o}function ys(o,d){const p=Ki;if(p===null)return o;const _=Lm(p)||p.proxy,E=o.dirs||(o.dirs=[]);for(let T=0;T<d.length;T++){let[R,N,D,M=Xn]=d[T];R&&(Ke(R)&&(R={mounted:R,updated:R}),R.deep&&ad(N),E.push({dir:R,instance:_,value:N,oldValue:void 0,arg:D,modifiers:M}))}return o}function ed(o,d,p,_){const E=o.dirs,T=d&&d.dirs;for(let R=0;R<E.length;R++){const N=E[R];T&&(N.oldValue=T[R].value);let D=N.dir[_];D&&(Gl(),Lr(D,p,8,[o.el,N,o,d]),Wl())}}function gG(){const o={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return IP(()=>{o.isMounted=!0}),wP(()=>{o.isUnmounting=!0}),o}const Dr=[Function,Array],TG={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Dr,onEnter:Dr,onAfterEnter:Dr,onEnterCancelled:Dr,onBeforeLeave:Dr,onLeave:Dr,onAfterLeave:Dr,onLeaveCancelled:Dr,onBeforeAppear:Dr,onAppear:Dr,onAfterAppear:Dr,onAppearCancelled:Dr};function SG(o,d){const{leavingVNodes:p}=o;let _=p.get(d.type);return _||(_=Object.create(null),p.set(d.type,_)),_}function kv(o,d,p,_){const{appear:E,mode:T,persisted:R=!1,onBeforeEnter:N,onEnter:D,onAfterEnter:M,onEnterCancelled:P,onBeforeLeave:j,onLeave:q,onAfterLeave:tt,onLeaveCancelled:at,onBeforeAppear:lt,onAppear:vt,onAfterAppear:wt,onAppearCancelled:It}=d,Bt=String(o.key),Et=SG(p,o),jt=(Mt,qt)=>{Mt&&Lr(Mt,_,9,qt)},re=(Mt,qt)=>{const Xt=qt[1];jt(Mt,qt),ve(Mt)?Mt.every(Qt=>Qt.length<=1)&&Xt():Mt.length<=1&&Xt()},pe={mode:T,persisted:R,beforeEnter(Mt){let qt=N;if(!p.isMounted)if(E)qt=lt||N;else return;Mt._leaveCb&&Mt._leaveCb(!0);const Xt=Et[Bt];Xt&&bl(o,Xt)&&Xt.el._leaveCb&&Xt.el._leaveCb(),jt(qt,[Mt])},enter(Mt){let qt=D,Xt=M,Qt=P;if(!p.isMounted)if(E)qt=vt||D,Xt=wt||M,Qt=It||P;else return;let Lt=!1;const de=Mt._enterCb=Ne=>{Lt||(Lt=!0,Ne?jt(Qt,[Mt]):jt(Xt,[Mt]),pe.delayedLeave&&pe.delayedLeave(),Mt._enterCb=void 0)};qt?re(qt,[Mt,de]):de()},leave(Mt,qt){const Xt=String(o.key);if(Mt._enterCb&&Mt._enterCb(!0),p.isUnmounting)return qt();jt(j,[Mt]);let Qt=!1;const Lt=Mt._leaveCb=de=>{Qt||(Qt=!0,qt(),de?jt(at,[Mt]):jt(tt,[Mt]),Mt._leaveCb=void 0,Et[Xt]===o&&delete Et[Xt])};Et[Xt]=o,q?re(q,[Mt,Lt]):Lt()},clone(Mt){return kv(Mt,d,p,_)}};return pe}function Mv(o,d){o.shapeFlag&6&&o.component?Mv(o.component.subTree,d):o.shapeFlag&128?(o.ssContent.transition=d.clone(o.ssContent),o.ssFallback.transition=d.clone(o.ssFallback)):o.transition=d}function CP(o,d=!1,p){let _=[],E=0;for(let T=0;T<o.length;T++){let R=o[T];const N=p==null?R.key:String(p)+String(R.key!=null?R.key:T);R.type===$n?(R.patchFlag&128&&E++,_=_.concat(CP(R.children,d,N))):(d||R.type!==pa)&&_.push(N!=null?fd(R,{key:N}):R)}if(E>1)for(let T=0;T<_.length;T++)_[T].patchFlag=-2;return _}function bs(o,d){return Ke(o)?(()=>vi({name:o.name},d,{setup:o}))():o}const Nh=o=>!!o.type.__asyncLoader,RP=o=>o.type.__isKeepAlive;function vG(o,d){bP(o,"a",d)}function yG(o,d){bP(o,"da",d)}function bP(o,d,p=Ui){const _=o.__wdc||(o.__wdc=()=>{let E=p;for(;E;){if(E.isDeactivated)return;E=E.parent}return o()});if(Om(d,_,p),p){let E=p.parent;for(;E&&E.parent;)RP(E.parent.vnode)&&CG(_,d,p,E),E=E.parent}}function CG(o,d,p,_){const E=Om(d,o,_,!0);OP(()=>{ry(_[d],E)},p)}function Om(o,d,p=Ui,_=!1){if(p){const E=p[o]||(p[o]=[]),T=d.__weh||(d.__weh=(...R)=>{if(p.isUnmounted)return;Gl(),Pl(p);const N=Lr(d,p,o,R);return ud(),Wl(),N});return _?E.unshift(T):E.push(T),T}}const _a=o=>(d,p=Ui)=>(!Yh||o==="sp")&&Om(o,(..._)=>d(..._),p),RG=_a("bm"),IP=_a("m"),bG=_a("bu"),AP=_a("u"),wP=_a("bum"),OP=_a("um"),IG=_a("sp"),AG=_a("rtg"),wG=_a("rtc");function OG(o,d=Ui){Om("ec",o,d)}const gy="components";function ld(o,d){return DP(gy,o,!0,d)||o}const NP=Symbol.for("v-ndc");function Ty(o){return yi(o)?DP(gy,o,!1)||o:o||NP}function DP(o,d,p=!0,_=!1){const E=Ki||Ui;if(E){const T=E.type;if(o===gy){const N=aW(T,!1);if(N&&(N===d||N===Lo(d)||N===ym(Lo(d))))return T}const R=NN(E[o]||T[o],d)||NN(E.appContext[o],d);return!R&&_?T:R}}function NN(o,d){return o&&(o[d]||o[Lo(d)]||o[ym(Lo(d))])}function pd(o,d,p,_){let E;const T=p&&p[_];if(ve(o)||yi(o)){E=new Array(o.length);for(let R=0,N=o.length;R<N;R++)E[R]=d(o[R],R,void 0,T&&T[R])}else if(typeof o=="number"){E=new Array(o);for(let R=0;R<o;R++)E[R]=d(R+1,R,void 0,T&&T[R])}else if(Fn(o))if(o[Symbol.iterator])E=Array.from(o,(R,N)=>d(R,N,void 0,T&&T[N]));else{const R=Object.keys(o);E=new Array(R.length);for(let N=0,D=R.length;N<D;N++){const M=R[N];E[N]=d(o[M],M,N,T&&T[N])}}else E=[];return p&&(p[_]=E),E}function NG(o,d,p={},_,E){if(Ki.isCE||Ki.parent&&Nh(Ki.parent)&&Ki.parent.isCE)return d!=="default"&&(p.name=d),ri("slot",p,_&&_());let T=o[d];T&&T._c&&(T._d=!1),Je();const R=T&&PP(T(p)),N=Jr($n,{key:p.key||R&&R.key||`_${d}`},R||(_?_():[]),R&&o._===1?64:-2);return!E&&N.scopeId&&(N.slotScopeIds=[N.scopeId+"-s"]),T&&T._c&&(T._d=!0),N}function PP(o){return o.some(d=>pm(d)?!(d.type===pa||d.type===$n&&!PP(d.children)):!0)?o:null}function DG(o,d){const p={};for(const _ in o)p[d&&/[A-Z]/.test(_)?`on:${_}`:z_(_)]=o[_];return p}const Uv=o=>o?WP(o)?Lm(o)||o.proxy:Uv(o.parent):null,Dh=vi(Object.create(null),{$:o=>o,$el:o=>o.vnode.el,$data:o=>o.data,$props:o=>o.props,$attrs:o=>o.attrs,$slots:o=>o.slots,$refs:o=>o.refs,$parent:o=>Uv(o.parent),$root:o=>Uv(o.root),$emit:o=>o.emit,$options:o=>Sy(o),$forceUpdate:o=>o.f||(o.f=()=>_y(o.update)),$nextTick:o=>o.n||(o.n=Im.bind(o.proxy)),$watch:o=>EG.bind(o)}),mv=(o,d)=>o!==Xn&&!o.__isScriptSetup&&pn(o,d),PG={get({_:o},d){const{ctx:p,setupState:_,data:E,props:T,accessCache:R,type:N,appContext:D}=o;let M;if(d[0]!=="$"){const tt=R[d];if(tt!==void 0)switch(tt){case 1:return _[d];case 2:return E[d];case 4:return p[d];case 3:return T[d]}else{if(mv(_,d))return R[d]=1,_[d];if(E!==Xn&&pn(E,d))return R[d]=2,E[d];if((M=o.propsOptions[0])&&pn(M,d))return R[d]=3,T[d];if(p!==Xn&&pn(p,d))return R[d]=4,p[d];xv&&(R[d]=0)}}const P=Dh[d];let j,q;if(P)return d==="$attrs"&&Ys(o,"get",d),P(o);if((j=N.__cssModules)&&(j=j[d]))return j;if(p!==Xn&&pn(p,d))return R[d]=4,p[d];if(q=D.config.globalProperties,pn(q,d))return q[d]},set({_:o},d,p){const{data:_,setupState:E,ctx:T}=o;return mv(E,d)?(E[d]=p,!0):_!==Xn&&pn(_,d)?(_[d]=p,!0):pn(o.props,d)||d[0]==="$"&&d.slice(1)in o?!1:(T[d]=p,!0)},has({_:{data:o,setupState:d,accessCache:p,ctx:_,appContext:E,propsOptions:T}},R){let N;return!!p[R]||o!==Xn&&pn(o,R)||mv(d,R)||(N=T[0])&&pn(N,R)||pn(_,R)||pn(Dh,R)||pn(E.config.globalProperties,R)},defineProperty(o,d,p){return p.get!=null?o._.accessCache[d]=0:pn(p,"value")&&this.set(o,d,p.value,null),Reflect.defineProperty(o,d,p)}};function DN(o){return ve(o)?o.reduce((d,p)=>(d[p]=null,d),{}):o}let xv=!0;function LG(o){const d=Sy(o),p=o.proxy,_=o.ctx;xv=!1,d.beforeCreate&&PN(d.beforeCreate,o,"bc");const{data:E,computed:T,methods:R,watch:N,provide:D,inject:M,created:P,beforeMount:j,mounted:q,beforeUpdate:tt,updated:at,activated:lt,deactivated:vt,beforeDestroy:wt,beforeUnmount:It,destroyed:Bt,unmounted:Et,render:jt,renderTracked:re,renderTriggered:pe,errorCaptured:Mt,serverPrefetch:qt,expose:Xt,inheritAttrs:Qt,components:Lt,directives:de,filters:Ne}=d;if(M&&kG(M,_,null),R)for(const Oe in R){const Ue=R[Oe];Ke(Ue)&&(_[Oe]=Ue.bind(p))}if(E){const Oe=E.call(p,p);Fn(Oe)&&(o.data=tp(Oe))}if(xv=!0,T)for(const Oe in T){const Ue=T[Oe],Wn=Ke(Ue)?Ue.bind(p,p):Ke(Ue.get)?Ue.get.bind(p,p):$r,Be=!Ke(Ue)&&Ke(Ue.set)?Ue.set.bind(p):$r,kn=Pr({get:Wn,set:Be});Object.defineProperty(_,Oe,{enumerable:!0,configurable:!0,get:()=>kn.value,set:tn=>kn.value=tn})}if(N)for(const Oe in N)LP(N[Oe],_,p,Oe);if(D){const Oe=Ke(D)?D.call(p):D;Reflect.ownKeys(Oe).forEach(Ue=>{X_(Ue,Oe[Ue])})}P&&PN(P,o,"c");function Ee(Oe,Ue){ve(Ue)?Ue.forEach(Wn=>Oe(Wn.bind(p))):Ue&&Oe(Ue.bind(p))}if(Ee(RG,j),Ee(IP,q),Ee(bG,tt),Ee(AP,at),Ee(vG,lt),Ee(yG,vt),Ee(OG,Mt),Ee(wG,re),Ee(AG,pe),Ee(wP,It),Ee(OP,Et),Ee(IG,qt),ve(Xt))if(Xt.length){const Oe=o.exposed||(o.exposed={});Xt.forEach(Ue=>{Object.defineProperty(Oe,Ue,{get:()=>p[Ue],set:Wn=>p[Ue]=Wn})})}else o.exposed||(o.exposed={});jt&&o.render===$r&&(o.render=jt),Qt!=null&&(o.inheritAttrs=Qt),Lt&&(o.components=Lt),de&&(o.directives=de)}function kG(o,d,p=$r){ve(o)&&(o=Vv(o));for(const _ in o){const E=o[_];let T;Fn(E)?"default"in E?T=ts(E.from||_,E.default,!0):T=ts(E.from||_):T=ts(E),di(T)?Object.defineProperty(d,_,{enumerable:!0,configurable:!0,get:()=>T.value,set:R=>T.value=R}):d[_]=T}}function PN(o,d,p){Lr(ve(o)?o.map(_=>_.bind(d.proxy)):o.bind(d.proxy),d,p)}function LP(o,d,p,_){const E=_.includes(".")?yP(p,_):()=>p[_];if(yi(o)){const T=d[o];Ke(T)&&Oh(E,T)}else if(Ke(o))Oh(E,o.bind(p));else if(Fn(o))if(ve(o))o.forEach(T=>LP(T,d,p,_));else{const T=Ke(o.handler)?o.handler.bind(p):d[o.handler];Ke(T)&&Oh(E,T,o)}}function Sy(o){const d=o.type,{mixins:p,extends:_}=d,{mixins:E,optionsCache:T,config:{optionMergeStrategies:R}}=o.appContext,N=T.get(d);let D;return N?D=N:!E.length&&!p&&!_?D=d:(D={},E.length&&E.forEach(M=>hm(D,M,R,!0)),hm(D,d,R)),Fn(d)&&T.set(d,D),D}function hm(o,d,p,_=!1){const{mixins:E,extends:T}=d;T&&hm(o,T,p,!0),E&&E.forEach(R=>hm(o,R,p,!0));for(const R in d)if(!(_&&R==="expose")){const N=MG[R]||p&&p[R];o[R]=N?N(o[R],d[R]):d[R]}return o}const MG={data:LN,props:kN,emits:kN,methods:Ih,computed:Ih,beforeCreate:vs,created:vs,beforeMount:vs,mounted:vs,beforeUpdate:vs,updated:vs,beforeDestroy:vs,beforeUnmount:vs,destroyed:vs,unmounted:vs,activated:vs,deactivated:vs,errorCaptured:vs,serverPrefetch:vs,components:Ih,directives:Ih,watch:xG,provide:LN,inject:UG};function LN(o,d){return d?o?function(){return vi(Ke(o)?o.call(this,this):o,Ke(d)?d.call(this,this):d)}:d:o}function UG(o,d){return Ih(Vv(o),Vv(d))}function Vv(o){if(ve(o)){const d={};for(let p=0;p<o.length;p++)d[o[p]]=o[p];return d}return o}function vs(o,d){return o?[...new Set([].concat(o,d))]:d}function Ih(o,d){return o?vi(Object.create(null),o,d):d}function kN(o,d){return o?ve(o)&&ve(d)?[...new Set([...o,...d])]:vi(Object.create(null),DN(o),DN(d??{})):d}function xG(o,d){if(!o)return d;if(!d)return o;const p=vi(Object.create(null),o);for(const _ in d)p[_]=vs(o[_],d[_]);return p}function kP(){return{app:null,config:{isNativeTag:c5,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let VG=0;function FG(o,d){return function(_,E=null){Ke(_)||(_=vi({},_)),E!=null&&!Fn(E)&&(E=null);const T=kP(),R=new Set;let N=!1;const D=T.app={_uid:VG++,_component:_,_props:E,_container:null,_context:T,_instance:null,version:uW,get config(){return T.config},set config(M){},use(M,...P){return R.has(M)||(M&&Ke(M.install)?(R.add(M),M.install(D,...P)):Ke(M)&&(R.add(M),M(D,...P))),D},mixin(M){return T.mixins.includes(M)||T.mixins.push(M),D},component(M,P){return P?(T.components[M]=P,D):T.components[M]},directive(M,P){return P?(T.directives[M]=P,D):T.directives[M]},mount(M,P,j){if(!N){const q=ri(_,E);return q.appContext=T,P&&d?d(q,M):o(q,M,j),N=!0,D._container=M,M.__vue_app__=D,Lm(q.component)||q.component.proxy}},unmount(){N&&(o(null,D._container),delete D._container.__vue_app__)},provide(M,P){return T.provides[M]=P,D},runWithContext(M){Kh=D;try{return M()}finally{Kh=null}}};return D}}let Kh=null;function X_(o,d){if(Ui){let p=Ui.provides;const _=Ui.parent&&Ui.parent.provides;_===p&&(p=Ui.provides=Object.create(_)),p[o]=d}}function ts(o,d,p=!1){const _=Ui||Ki;if(_||Kh){const E=_?_.parent==null?_.vnode.appContext&&_.vnode.appContext.provides:_.parent.provides:Kh._context.provides;if(E&&o in E)return E[o];if(arguments.length>1)return p&&Ke(d)?d.call(_&&_.proxy):d}}function BG(){return!!(Ui||Ki||Kh)}function jG(o,d,p,_=!1){const E={},T={};am(T,Dm,1),o.propsDefaults=Object.create(null),MP(o,d,E,T);for(const R in o.propsOptions[0])R in E||(E[R]=void 0);p?o.props=_?E:dP(E):o.type.props?o.props=E:o.props=T,o.attrs=T}function GG(o,d,p,_){const{props:E,attrs:T,vnode:{patchFlag:R}}=o,N=an(E),[D]=o.propsOptions;let M=!1;if((_||R>0)&&!(R&16)){if(R&8){const P=o.vnode.dynamicProps;for(let j=0;j<P.length;j++){let q=P[j];if(Am(o.emitsOptions,q))continue;const tt=d[q];if(D)if(pn(T,q))tt!==T[q]&&(T[q]=tt,M=!0);else{const at=Lo(q);E[at]=Fv(D,N,at,tt,o,!1)}else tt!==T[q]&&(T[q]=tt,M=!0)}}}else{MP(o,d,E,T)&&(M=!0);let P;for(const j in N)(!d||!pn(d,j)&&((P=jl(j))===j||!pn(d,P)))&&(D?p&&(p[j]!==void 0||p[P]!==void 0)&&(E[j]=Fv(D,N,j,void 0,o,!0)):delete E[j]);if(T!==N)for(const j in T)(!d||!pn(d,j))&&(delete T[j],M=!0)}M&&ha(o,"set","$attrs")}function MP(o,d,p,_){const[E,T]=o.propsOptions;let R=!1,N;if(d)for(let D in d){if(Y_(D))continue;const M=d[D];let P;E&&pn(E,P=Lo(D))?!T||!T.includes(P)?p[P]=M:(N||(N={}))[P]=M:Am(o.emitsOptions,D)||(!(D in _)||M!==_[D])&&(_[D]=M,R=!0)}if(T){const D=an(p),M=N||Xn;for(let P=0;P<T.length;P++){const j=T[P];p[j]=Fv(E,D,j,M[j],o,!pn(M,j))}}return R}function Fv(o,d,p,_,E,T){const R=o[p];if(R!=null){const N=pn(R,"default");if(N&&_===void 0){const D=R.default;if(R.type!==Function&&!R.skipFactory&&Ke(D)){const{propsDefaults:M}=E;p in M?_=M[p]:(Pl(E),_=M[p]=D.call(null,d),ud())}else _=D}R[0]&&(T&&!N?_=!1:R[1]&&(_===""||_===jl(p))&&(_=!0))}return _}function UP(o,d,p=!1){const _=d.propsCache,E=_.get(o);if(E)return E;const T=o.props,R={},N=[];let D=!1;if(!Ke(o)){const P=j=>{D=!0;const[q,tt]=UP(j,d,!0);vi(R,q),tt&&N.push(...tt)};!p&&d.mixins.length&&d.mixins.forEach(P),o.extends&&P(o.extends),o.mixins&&o.mixins.forEach(P)}if(!T&&!D)return Fn(o)&&_.set(o,wl),wl;if(ve(T))for(let P=0;P<T.length;P++){const j=Lo(T[P]);MN(j)&&(R[j]=Xn)}else if(T)for(const P in T){const j=Lo(P);if(MN(j)){const q=T[P],tt=R[j]=ve(q)||Ke(q)?{type:q}:vi({},q);if(tt){const at=VN(Boolean,tt.type),lt=VN(String,tt.type);tt[0]=at>-1,tt[1]=lt<0||at<lt,(at>-1||pn(tt,"default"))&&N.push(j)}}}const M=[R,N];return Fn(o)&&_.set(o,M),M}function MN(o){return o[0]!=="$"}function UN(o){const d=o&&o.toString().match(/^\s*(function|class) (\w+)/);return d?d[2]:o===null?"null":""}function xN(o,d){return UN(o)===UN(d)}function VN(o,d){return ve(d)?d.findIndex(p=>xN(p,o)):Ke(d)&&xN(d,o)?0:-1}const xP=o=>o[0]==="_"||o==="$stable",vy=o=>ve(o)?o.map(wo):[wo(o)],WG=(o,d,p)=>{if(d._n)return d;const _=ep((...E)=>vy(d(...E)),p);return _._c=!1,_},VP=(o,d,p)=>{const _=o._ctx;for(const E in o){if(xP(E))continue;const T=o[E];if(Ke(T))d[E]=WG(E,T,_);else if(T!=null){const R=vy(T);d[E]=()=>R}}},FP=(o,d)=>{const p=vy(d);o.slots.default=()=>p},HG=(o,d)=>{if(o.vnode.shapeFlag&32){const p=d._;p?(o.slots=an(d),am(d,"_",p)):VP(d,o.slots={})}else o.slots={},d&&FP(o,d);am(o.slots,Dm,1)},KG=(o,d,p)=>{const{vnode:_,slots:E}=o;let T=!0,R=Xn;if(_.shapeFlag&32){const N=d._;N?p&&N===1?T=!1:(vi(E,d),!p&&N===1&&delete E._):(T=!d.$stable,VP(d,E)),R=d}else d&&(FP(o,d),R={default:1});if(T)for(const N in E)!xP(N)&&!(N in R)&&delete E[N]};function Bv(o,d,p,_,E=!1){if(ve(o)){o.forEach((q,tt)=>Bv(q,d&&(ve(d)?d[tt]:d),p,_,E));return}if(Nh(_)&&!E)return;const T=_.shapeFlag&4?Lm(_.component)||_.component.proxy:_.el,R=E?null:T,{i:N,r:D}=o,M=d&&d.r,P=N.refs===Xn?N.refs={}:N.refs,j=N.setupState;if(M!=null&&M!==D&&(yi(M)?(P[M]=null,pn(j,M)&&(j[M]=null)):di(M)&&(M.value=null)),Ke(D))lc(D,N,12,[R,P]);else{const q=yi(D),tt=di(D);if(q||tt){const at=()=>{if(o.f){const lt=q?pn(j,D)?j[D]:P[D]:D.value;E?ve(lt)&&ry(lt,T):ve(lt)?lt.includes(T)||lt.push(T):q?(P[D]=[T],pn(j,D)&&(j[D]=P[D])):(D.value=[T],o.k&&(P[o.k]=D.value))}else q?(P[D]=R,pn(j,D)&&(j[D]=R)):tt&&(D.value=R,o.k&&(P[o.k]=R))};R?(at.id=-1,qs(at,p)):at()}}}const qs=mG;function qG(o){return YG(o)}function YG(o,d){const p=Ov();p.__VUE__=!0;const{insert:_,remove:E,patchProp:T,createElement:R,createText:N,createComment:D,setText:M,setElementText:P,parentNode:j,nextSibling:q,setScopeId:tt=$r,insertStaticContent:at}=o,lt=(H,z,rt,_t=null,gt=null,At=null,zt=!1,Pt=null,Vt=!!z.dynamicChildren)=>{if(H===z)return;H&&!bl(H,z)&&(_t=ft(H),tn(H,gt,At,!0),H=null),z.patchFlag===-2&&(Vt=!1,z.dynamicChildren=null);const{type:Ot,ref:oe,shapeFlag:Zt}=z;switch(Ot){case Nm:vt(H,z,rt,_t);break;case pa:wt(H,z,rt,_t);break;case $_:H==null&&It(z,rt,_t,zt);break;case $n:Lt(H,z,rt,_t,gt,At,zt,Pt,Vt);break;default:Zt&1?jt(H,z,rt,_t,gt,At,zt,Pt,Vt):Zt&6?de(H,z,rt,_t,gt,At,zt,Pt,Vt):(Zt&64||Zt&128)&&Ot.process(H,z,rt,_t,gt,At,zt,Pt,Vt,Ut)}oe!=null&&gt&&Bv(oe,H&&H.ref,At,z||H,!z)},vt=(H,z,rt,_t)=>{if(H==null)_(z.el=N(z.children),rt,_t);else{const gt=z.el=H.el;z.children!==H.children&&M(gt,z.children)}},wt=(H,z,rt,_t)=>{H==null?_(z.el=D(z.children||""),rt,_t):z.el=H.el},It=(H,z,rt,_t)=>{[H.el,H.anchor]=at(H.children,z,rt,_t,H.el,H.anchor)},Bt=({el:H,anchor:z},rt,_t)=>{let gt;for(;H&&H!==z;)gt=q(H),_(H,rt,_t),H=gt;_(z,rt,_t)},Et=({el:H,anchor:z})=>{let rt;for(;H&&H!==z;)rt=q(H),E(H),H=rt;E(z)},jt=(H,z,rt,_t,gt,At,zt,Pt,Vt)=>{zt=zt||z.type==="svg",H==null?re(z,rt,_t,gt,At,zt,Pt,Vt):qt(H,z,gt,At,zt,Pt,Vt)},re=(H,z,rt,_t,gt,At,zt,Pt)=>{let Vt,Ot;const{type:oe,props:Zt,shapeFlag:ae,transition:Se,dirs:De}=H;if(Vt=H.el=R(H.type,At,Zt&&Zt.is,Zt),ae&8?P(Vt,H.children):ae&16&&Mt(H.children,Vt,null,_t,gt,At&&oe!=="foreignObject",zt,Pt),De&&ed(H,null,_t,"created"),pe(Vt,H,H.scopeId,zt,_t),Zt){for(const ce in Zt)ce!=="value"&&!Y_(ce)&&T(Vt,ce,null,Zt[ce],At,H.children,_t,gt,yn);"value"in Zt&&T(Vt,"value",null,Zt.value),(Ot=Zt.onVnodeBeforeMount)&&Ao(Ot,_t,H)}De&&ed(H,null,_t,"beforeMount");const en=(!gt||gt&&!gt.pendingBranch)&&Se&&!Se.persisted;en&&Se.beforeEnter(Vt),_(Vt,z,rt),((Ot=Zt&&Zt.onVnodeMounted)||en||De)&&qs(()=>{Ot&&Ao(Ot,_t,H),en&&Se.enter(Vt),De&&ed(H,null,_t,"mounted")},gt)},pe=(H,z,rt,_t,gt)=>{if(rt&&tt(H,rt),_t)for(let At=0;At<_t.length;At++)tt(H,_t[At]);if(gt){let At=gt.subTree;if(z===At){const zt=gt.vnode;pe(H,zt,zt.scopeId,zt.slotScopeIds,gt.parent)}}},Mt=(H,z,rt,_t,gt,At,zt,Pt,Vt=0)=>{for(let Ot=Vt;Ot<H.length;Ot++){const oe=H[Ot]=Pt?oc(H[Ot]):wo(H[Ot]);lt(null,oe,z,rt,_t,gt,At,zt,Pt)}},qt=(H,z,rt,_t,gt,At,zt)=>{const Pt=z.el=H.el;let{patchFlag:Vt,dynamicChildren:Ot,dirs:oe}=z;Vt|=H.patchFlag&16;const Zt=H.props||Xn,ae=z.props||Xn;let Se;rt&&nd(rt,!1),(Se=ae.onVnodeBeforeUpdate)&&Ao(Se,rt,z,H),oe&&ed(z,H,rt,"beforeUpdate"),rt&&nd(rt,!0);const De=gt&&z.type!=="foreignObject";if(Ot?Xt(H.dynamicChildren,Ot,Pt,rt,_t,De,At):zt||Ue(H,z,Pt,null,rt,_t,De,At,!1),Vt>0){if(Vt&16)Qt(Pt,z,Zt,ae,rt,_t,gt);else if(Vt&2&&Zt.class!==ae.class&&T(Pt,"class",null,ae.class,gt),Vt&4&&T(Pt,"style",Zt.style,ae.style,gt),Vt&8){const en=z.dynamicProps;for(let ce=0;ce<en.length;ce++){const An=en[ce],Ri=Zt[An],es=ae[An];(es!==Ri||An==="value")&&T(Pt,An,Ri,es,gt,H.children,rt,_t,yn)}}Vt&1&&H.children!==z.children&&P(Pt,z.children)}else!zt&&Ot==null&&Qt(Pt,z,Zt,ae,rt,_t,gt);((Se=ae.onVnodeUpdated)||oe)&&qs(()=>{Se&&Ao(Se,rt,z,H),oe&&ed(z,H,rt,"updated")},_t)},Xt=(H,z,rt,_t,gt,At,zt)=>{for(let Pt=0;Pt<z.length;Pt++){const Vt=H[Pt],Ot=z[Pt],oe=Vt.el&&(Vt.type===$n||!bl(Vt,Ot)||Vt.shapeFlag&70)?j(Vt.el):rt;lt(Vt,Ot,oe,null,_t,gt,At,zt,!0)}},Qt=(H,z,rt,_t,gt,At,zt)=>{if(rt!==_t){if(rt!==Xn)for(const Pt in rt)!Y_(Pt)&&!(Pt in _t)&&T(H,Pt,rt[Pt],null,zt,z.children,gt,At,yn);for(const Pt in _t){if(Y_(Pt))continue;const Vt=_t[Pt],Ot=rt[Pt];Vt!==Ot&&Pt!=="value"&&T(H,Pt,Ot,Vt,zt,z.children,gt,At,yn)}"value"in _t&&T(H,"value",rt.value,_t.value)}},Lt=(H,z,rt,_t,gt,At,zt,Pt,Vt)=>{const Ot=z.el=H?H.el:N(""),oe=z.anchor=H?H.anchor:N("");let{patchFlag:Zt,dynamicChildren:ae,slotScopeIds:Se}=z;Se&&(Pt=Pt?Pt.concat(Se):Se),H==null?(_(Ot,rt,_t),_(oe,rt,_t),Mt(z.children,rt,oe,gt,At,zt,Pt,Vt)):Zt>0&&Zt&64&&ae&&H.dynamicChildren?(Xt(H.dynamicChildren,ae,rt,gt,At,zt,Pt),(z.key!=null||gt&&z===gt.subTree)&&BP(H,z,!0)):Ue(H,z,rt,oe,gt,At,zt,Pt,Vt)},de=(H,z,rt,_t,gt,At,zt,Pt,Vt)=>{z.slotScopeIds=Pt,H==null?z.shapeFlag&512?gt.ctx.activate(z,rt,_t,zt,Vt):Ne(z,rt,_t,gt,At,zt,Vt):dn(H,z,Vt)},Ne=(H,z,rt,_t,gt,At,zt)=>{const Pt=H.component=eW(H,_t,gt);if(RP(H)&&(Pt.ctx.renderer=Ut),iW(Pt),Pt.asyncDep){if(gt&&gt.registerDep(Pt,Ee),!H.el){const Vt=Pt.subTree=ri(pa);wt(null,Vt,z,rt)}return}Ee(Pt,H,z,rt,gt,At,zt)},dn=(H,z,rt)=>{const _t=z.component=H.component;if(pG(H,z,rt))if(_t.asyncDep&&!_t.asyncResolved){Oe(_t,z,rt);return}else _t.next=z,aG(_t.update),_t.update();else z.el=H.el,_t.vnode=z},Ee=(H,z,rt,_t,gt,At,zt)=>{const Pt=()=>{if(H.isMounted){let{next:oe,bu:Zt,u:ae,parent:Se,vnode:De}=H,en=oe,ce;nd(H,!1),oe?(oe.el=De.el,Oe(H,oe,zt)):oe=De,Zt&&J_(Zt),(ce=oe.props&&oe.props.onVnodeBeforeUpdate)&&Ao(ce,Se,oe,De),nd(H,!0);const An=_v(H),Ri=H.subTree;H.subTree=An,lt(Ri,An,j(Ri.el),ft(Ri),H,gt,At),oe.el=An.el,en===null&&fG(H,An.el),ae&&qs(ae,gt),(ce=oe.props&&oe.props.onVnodeUpdated)&&qs(()=>Ao(ce,Se,oe,De),gt)}else{let oe;const{el:Zt,props:ae}=z,{bm:Se,m:De,parent:en}=H,ce=Nh(z);if(nd(H,!1),Se&&J_(Se),!ce&&(oe=ae&&ae.onVnodeBeforeMount)&&Ao(oe,en,z),nd(H,!0),Zt&&xt){const An=()=>{H.subTree=_v(H),xt(Zt,H.subTree,H,gt,null)};ce?z.type.__asyncLoader().then(()=>!H.isUnmounted&&An()):An()}else{const An=H.subTree=_v(H);lt(null,An,rt,_t,H,gt,At),z.el=An.el}if(De&&qs(De,gt),!ce&&(oe=ae&&ae.onVnodeMounted)){const An=z;qs(()=>Ao(oe,en,An),gt)}(z.shapeFlag&256||en&&Nh(en.vnode)&&en.vnode.shapeFlag&256)&&H.a&&qs(H.a,gt),H.isMounted=!0,z=rt=_t=null}},Vt=H.effect=new cy(Pt,()=>_y(Ot),H.scope),Ot=H.update=()=>Vt.run();Ot.id=H.uid,nd(H,!0),Ot()},Oe=(H,z,rt)=>{z.component=H;const _t=H.vnode.props;H.vnode=z,H.next=null,GG(H,z.props,_t,rt),KG(H,z.children,rt),Gl(),wN(),Wl()},Ue=(H,z,rt,_t,gt,At,zt,Pt,Vt=!1)=>{const Ot=H&&H.children,oe=H?H.shapeFlag:0,Zt=z.children,{patchFlag:ae,shapeFlag:Se}=z;if(ae>0){if(ae&128){Be(Ot,Zt,rt,_t,gt,At,zt,Pt,Vt);return}else if(ae&256){Wn(Ot,Zt,rt,_t,gt,At,zt,Pt,Vt);return}}Se&8?(oe&16&&yn(Ot,gt,At),Zt!==Ot&&P(rt,Zt)):oe&16?Se&16?Be(Ot,Zt,rt,_t,gt,At,zt,Pt,Vt):yn(Ot,gt,At,!0):(oe&8&&P(rt,""),Se&16&&Mt(Zt,rt,_t,gt,At,zt,Pt,Vt))},Wn=(H,z,rt,_t,gt,At,zt,Pt,Vt)=>{H=H||wl,z=z||wl;const Ot=H.length,oe=z.length,Zt=Math.min(Ot,oe);let ae;for(ae=0;ae<Zt;ae++){const Se=z[ae]=Vt?oc(z[ae]):wo(z[ae]);lt(H[ae],Se,rt,null,gt,At,zt,Pt,Vt)}Ot>oe?yn(H,gt,At,!0,!1,Zt):Mt(z,rt,_t,gt,At,zt,Pt,Vt,Zt)},Be=(H,z,rt,_t,gt,At,zt,Pt,Vt)=>{let Ot=0;const oe=z.length;let Zt=H.length-1,ae=oe-1;for(;Ot<=Zt&&Ot<=ae;){const Se=H[Ot],De=z[Ot]=Vt?oc(z[Ot]):wo(z[Ot]);if(bl(Se,De))lt(Se,De,rt,null,gt,At,zt,Pt,Vt);else break;Ot++}for(;Ot<=Zt&&Ot<=ae;){const Se=H[Zt],De=z[ae]=Vt?oc(z[ae]):wo(z[ae]);if(bl(Se,De))lt(Se,De,rt,null,gt,At,zt,Pt,Vt);else break;Zt--,ae--}if(Ot>Zt){if(Ot<=ae){const Se=ae+1,De=Se<oe?z[Se].el:_t;for(;Ot<=ae;)lt(null,z[Ot]=Vt?oc(z[Ot]):wo(z[Ot]),rt,De,gt,At,zt,Pt,Vt),Ot++}}else if(Ot>ae)for(;Ot<=Zt;)tn(H[Ot],gt,At,!0),Ot++;else{const Se=Ot,De=Ot,en=new Map;for(Ot=De;Ot<=ae;Ot++){const Cn=z[Ot]=Vt?oc(z[Ot]):wo(z[Ot]);Cn.key!=null&&en.set(Cn.key,Ot)}let ce,An=0;const Ri=ae-De+1;let es=!1,zs=0;const gr=new Array(Ri);for(Ot=0;Ot<Ri;Ot++)gr[Ot]=0;for(Ot=Se;Ot<=Zt;Ot++){const Cn=H[Ot];if(An>=Ri){tn(Cn,gt,At,!0);continue}let qi;if(Cn.key!=null)qi=en.get(Cn.key);else for(ce=De;ce<=ae;ce++)if(gr[ce-De]===0&&bl(Cn,z[ce])){qi=ce;break}qi===void 0?tn(Cn,gt,At,!0):(gr[qi-De]=Ot+1,qi>=zs?zs=qi:es=!0,lt(Cn,z[qi],rt,null,gt,At,zt,Pt,Vt),An++)}const wn=es?zG(gr):wl;for(ce=wn.length-1,Ot=Ri-1;Ot>=0;Ot--){const Cn=De+Ot,qi=z[Cn],oi=Cn+1<oe?z[Cn+1].el:_t;gr[Ot]===0?lt(null,qi,rt,oi,gt,At,zt,Pt,Vt):es&&(ce<0||Ot!==wn[ce]?kn(qi,rt,oi,2):ce--)}}},kn=(H,z,rt,_t,gt=null)=>{const{el:At,type:zt,transition:Pt,children:Vt,shapeFlag:Ot}=H;if(Ot&6){kn(H.component.subTree,z,rt,_t);return}if(Ot&128){H.suspense.move(z,rt,_t);return}if(Ot&64){zt.move(H,z,rt,Ut);return}if(zt===$n){_(At,z,rt);for(let Zt=0;Zt<Vt.length;Zt++)kn(Vt[Zt],z,rt,_t);_(H.anchor,z,rt);return}if(zt===$_){Bt(H,z,rt);return}if(_t!==2&&Ot&1&&Pt)if(_t===0)Pt.beforeEnter(At),_(At,z,rt),qs(()=>Pt.enter(At),gt);else{const{leave:Zt,delayLeave:ae,afterLeave:Se}=Pt,De=()=>_(At,z,rt),en=()=>{Zt(At,()=>{De(),Se&&Se()})};ae?ae(At,De,en):en()}else _(At,z,rt)},tn=(H,z,rt,_t=!1,gt=!1)=>{const{type:At,props:zt,ref:Pt,children:Vt,dynamicChildren:Ot,shapeFlag:oe,patchFlag:Zt,dirs:ae}=H;if(Pt!=null&&Bv(Pt,null,rt,H,!0),oe&256){z.ctx.deactivate(H);return}const Se=oe&1&&ae,De=!Nh(H);let en;if(De&&(en=zt&&zt.onVnodeBeforeUnmount)&&Ao(en,z,H),oe&6)Pi(H.component,rt,_t);else{if(oe&128){H.suspense.unmount(rt,_t);return}Se&&ed(H,null,z,"beforeUnmount"),oe&64?H.type.remove(H,z,rt,gt,Ut,_t):Ot&&(At!==$n||Zt>0&&Zt&64)?yn(Ot,z,rt,!1,!0):(At===$n&&Zt&384||!gt&&oe&16)&&yn(Vt,z,rt),_t&&Tt(H)}(De&&(en=zt&&zt.onVnodeUnmounted)||Se)&&qs(()=>{en&&Ao(en,z,H),Se&&ed(H,null,z,"unmounted")},rt)},Tt=H=>{const{type:z,el:rt,anchor:_t,transition:gt}=H;if(z===$n){Ci(rt,_t);return}if(z===$_){Et(H);return}const At=()=>{E(rt),gt&&!gt.persisted&&gt.afterLeave&&gt.afterLeave()};if(H.shapeFlag&1&&gt&&!gt.persisted){const{leave:zt,delayLeave:Pt}=gt,Vt=()=>zt(rt,At);Pt?Pt(H.el,At,Vt):Vt()}else At()},Ci=(H,z)=>{let rt;for(;H!==z;)rt=q(H),E(H),H=rt;E(z)},Pi=(H,z,rt)=>{const{bum:_t,scope:gt,update:At,subTree:zt,um:Pt}=H;_t&&J_(_t),gt.stop(),At&&(At.active=!1,tn(zt,H,z,rt)),Pt&&qs(Pt,z),qs(()=>{H.isUnmounted=!0},z),z&&z.pendingBranch&&!z.isUnmounted&&H.asyncDep&&!H.asyncResolved&&H.suspenseId===z.pendingId&&(z.deps--,z.deps===0&&z.resolve())},yn=(H,z,rt,_t=!1,gt=!1,At=0)=>{for(let zt=At;zt<H.length;zt++)tn(H[zt],z,rt,_t,gt)},ft=H=>H.shapeFlag&6?ft(H.component.subTree):H.shapeFlag&128?H.suspense.next():q(H.anchor||H.el),Yt=(H,z,rt)=>{H==null?z._vnode&&tn(z._vnode,null,null,!0):lt(z._vnode||null,H,z,null,null,null,rt),wN(),gP(),z._vnode=H},Ut={p:lt,um:tn,m:kn,r:Tt,mt:Ne,mc:Mt,pc:Ue,pbc:Xt,n:ft,o};let se,xt;return d&&([se,xt]=d(Ut)),{render:Yt,hydrate:se,createApp:FG(Yt,se)}}function nd({effect:o,update:d},p){o.allowRecurse=d.allowRecurse=p}function BP(o,d,p=!1){const _=o.children,E=d.children;if(ve(_)&&ve(E))for(let T=0;T<_.length;T++){const R=_[T];let N=E[T];N.shapeFlag&1&&!N.dynamicChildren&&((N.patchFlag<=0||N.patchFlag===32)&&(N=E[T]=oc(E[T]),N.el=R.el),p||BP(R,N)),N.type===Nm&&(N.el=R.el)}}function zG(o){const d=o.slice(),p=[0];let _,E,T,R,N;const D=o.length;for(_=0;_<D;_++){const M=o[_];if(M!==0){if(E=p[p.length-1],o[E]<M){d[_]=E,p.push(_);continue}for(T=0,R=p.length-1;T<R;)N=T+R>>1,o[p[N]]<M?T=N+1:R=N;M<o[p[T]]&&(T>0&&(d[_]=p[T-1]),p[T]=_)}}for(T=p.length,R=p[T-1];T-- >0;)p[T]=R,R=d[R];return p}const JG=o=>o.__isTeleport,$n=Symbol.for("v-fgt"),Nm=Symbol.for("v-txt"),pa=Symbol.for("v-cmt"),$_=Symbol.for("v-stc"),Ph=[];let zr=null;function Je(o=!1){Ph.push(zr=o?null:[])}function XG(){Ph.pop(),zr=Ph[Ph.length-1]||null}let qh=1;function FN(o){qh+=o}function jP(o){return o.dynamicChildren=qh>0?zr||wl:null,XG(),qh>0&&zr&&zr.push(o),o}function In(o,d,p,_,E,T){return jP(ot(o,d,p,_,E,T,!0))}function Jr(o,d,p,_,E){return jP(ri(o,d,p,_,E,!0))}function pm(o){return o?o.__v_isVNode===!0:!1}function bl(o,d){return o.type===d.type&&o.key===d.key}const Dm="__vInternal",GP=({key:o})=>o??null,Q_=({ref:o,ref_key:d,ref_for:p})=>(typeof o=="number"&&(o=""+o),o!=null?yi(o)||di(o)||Ke(o)?{i:Ki,r:o,k:d,f:!!p}:o:null);function ot(o,d=null,p=null,_=0,E=null,T=o===$n?0:1,R=!1,N=!1){const D={__v_isVNode:!0,__v_skip:!0,type:o,props:d,key:d&&GP(d),ref:d&&Q_(d),scopeId:wm,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:T,patchFlag:_,dynamicProps:E,dynamicChildren:null,appContext:null,ctx:Ki};return N?(Cy(D,p),T&128&&o.normalize(D)):p&&(D.shapeFlag|=yi(p)?8:16),qh>0&&!R&&zr&&(D.patchFlag>0||T&6)&&D.patchFlag!==32&&zr.push(D),D}const ri=$G;function $G(o,d=null,p=null,_=0,E=null,T=!1){if((!o||o===NP)&&(o=pa),pm(o)){const N=fd(o,d,!0);return p&&Cy(N,p),qh>0&&!T&&zr&&(N.shapeFlag&6?zr[zr.indexOf(o)]=N:zr.push(N)),N.patchFlag|=-2,N}if(cW(o)&&(o=o.__vccOpts),d){d=QG(d);let{class:N,style:D}=d;N&&!yi(N)&&(d.class=uc(N)),Fn(D)&&(uP(D)&&!ve(D)&&(D=vi({},D)),d.style=Zh(D))}const R=yi(o)?1:_G(o)?128:JG(o)?64:Fn(o)?4:Ke(o)?2:0;return ot(o,d,p,_,E,R,T,!0)}function QG(o){return o?uP(o)||Dm in o?vi({},o):o:null}function fd(o,d,p=!1){const{props:_,ref:E,patchFlag:T,children:R}=o,N=d?Pm(_||{},d):_;return{__v_isVNode:!0,__v_skip:!0,type:o.type,props:N,key:N&&GP(N),ref:d&&d.ref?p&&E?ve(E)?E.concat(Q_(d)):[E,Q_(d)]:Q_(d):E,scopeId:o.scopeId,slotScopeIds:o.slotScopeIds,children:R,target:o.target,targetAnchor:o.targetAnchor,staticCount:o.staticCount,shapeFlag:o.shapeFlag,patchFlag:d&&o.type!==$n?T===-1?16:T|16:T,dynamicProps:o.dynamicProps,dynamicChildren:o.dynamicChildren,appContext:o.appContext,dirs:o.dirs,transition:o.transition,component:o.component,suspense:o.suspense,ssContent:o.ssContent&&fd(o.ssContent),ssFallback:o.ssFallback&&fd(o.ssFallback),el:o.el,anchor:o.anchor,ctx:o.ctx,ce:o.ce}}function np(o=" ",d=0){return ri(Nm,null,o,d)}function yy(o,d){const p=ri($_,null,o);return p.staticCount=d,p}function Z_(o="",d=!1){return d?(Je(),Jr(pa,null,o)):ri(pa,null,o)}function wo(o){return o==null||typeof o=="boolean"?ri(pa):ve(o)?ri($n,null,o.slice()):typeof o=="object"?oc(o):ri(Nm,null,String(o))}function oc(o){return o.el===null&&o.patchFlag!==-1||o.memo?o:fd(o)}function Cy(o,d){let p=0;const{shapeFlag:_}=o;if(d==null)d=null;else if(ve(d))p=16;else if(typeof d=="object")if(_&65){const E=d.default;E&&(E._c&&(E._d=!1),Cy(o,E()),E._c&&(E._d=!0));return}else{p=32;const E=d._;!E&&!(Dm in d)?d._ctx=Ki:E===3&&Ki&&(Ki.slots._===1?d._=1:(d._=2,o.patchFlag|=1024))}else Ke(d)?(d={default:d,_ctx:Ki},p=32):(d=String(d),_&64?(p=16,d=[np(d)]):p=8);o.children=d,o.shapeFlag|=p}function Pm(...o){const d={};for(let p=0;p<o.length;p++){const _=o[p];for(const E in _)if(E==="class")d.class!==_.class&&(d.class=uc([d.class,_.class]));else if(E==="style")d.style=Zh([d.style,_.style]);else if(Sm(E)){const T=d[E],R=_[E];R&&T!==R&&!(ve(T)&&T.includes(R))&&(d[E]=T?[].concat(T,R):R)}else E!==""&&(d[E]=_[E])}return d}function Ao(o,d,p,_=null){Lr(o,d,7,[p,_])}const ZG=kP();let tW=0;function eW(o,d,p){const _=o.type,E=(d?d.appContext:o.appContext)||ZG,T={uid:tW++,vnode:o,type:_,parent:d,appContext:E,root:null,next:null,subTree:null,effect:null,update:null,scope:new XD(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:d?d.provides:Object.create(E.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:UP(_,E),emitsOptions:SP(_,E),emit:null,emitted:null,propsDefaults:Xn,inheritAttrs:_.inheritAttrs,ctx:Xn,data:Xn,props:Xn,attrs:Xn,slots:Xn,refs:Xn,setupState:Xn,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return T.ctx={_:T},T.root=d?d.root:T,T.emit=lG.bind(null,T),o.ce&&o.ce(T),T}let Ui=null;const nW=()=>Ui||Ki;let Ry,Cl,BN="__VUE_INSTANCE_SETTERS__";(Cl=Ov()[BN])||(Cl=Ov()[BN]=[]),Cl.push(o=>Ui=o),Ry=o=>{Cl.length>1?Cl.forEach(d=>d(o)):Cl[0](o)};const Pl=o=>{Ry(o),o.scope.on()},ud=()=>{Ui&&Ui.scope.off(),Ry(null)};function WP(o){return o.vnode.shapeFlag&4}let Yh=!1;function iW(o,d=!1){Yh=d;const{props:p,children:_}=o.vnode,E=WP(o);jG(o,p,E,d),HG(o,_);const T=E?sW(o,d):void 0;return Yh=!1,T}function sW(o,d){const p=o.type;o.accessCache=Object.create(null),o.proxy=Rm(new Proxy(o.ctx,PG));const{setup:_}=p;if(_){const E=o.setupContext=_.length>1?oW(o):null;Pl(o),Gl();const T=lc(_,o,0,[o.props,E]);if(Wl(),ud(),KD(T)){if(T.then(ud,ud),d)return T.then(R=>{jN(o,R,d)}).catch(R=>{bm(R,o,0)});o.asyncDep=T}else jN(o,T,d)}else HP(o,d)}function jN(o,d,p){Ke(d)?o.type.__ssrInlineRender?o.ssrRender=d:o.render=d:Fn(d)&&(o.setupState=_P(d)),HP(o,p)}let GN;function HP(o,d,p){const _=o.type;if(!o.render){if(!d&&GN&&!_.render){const E=_.template||Sy(o).template;if(E){const{isCustomElement:T,compilerOptions:R}=o.appContext.config,{delimiters:N,compilerOptions:D}=_,M=vi(vi({isCustomElement:T,delimiters:N},R),D);_.render=GN(E,M)}}o.render=_.render||$r}Pl(o),Gl(),LG(o),Wl(),ud()}function rW(o){return o.attrsProxy||(o.attrsProxy=new Proxy(o.attrs,{get(d,p){return Ys(o,"get","$attrs"),d[p]}}))}function oW(o){const d=p=>{o.exposed=p||{}};return{get attrs(){return rW(o)},slots:o.slots,emit:o.emit,expose:d}}function Lm(o){if(o.exposed)return o.exposeProxy||(o.exposeProxy=new Proxy(_P(Rm(o.exposed)),{get(d,p){if(p in d)return d[p];if(p in Dh)return Dh[p](o)},has(d,p){return p in d||p in Dh}}))}function aW(o,d=!0){return Ke(o)?o.displayName||o.name:o.name||d&&o.__name}function cW(o){return Ke(o)&&"__vccOpts"in o}const Pr=(o,d)=>sG(o,d,Yh);function KP(o,d,p){const _=arguments.length;return _===2?Fn(d)&&!ve(d)?pm(d)?ri(o,null,[d]):ri(o,d):ri(o,null,d):(_>3?p=Array.prototype.slice.call(arguments,2):_===3&&pm(p)&&(p=[p]),ri(o,d,p))}const dW=Symbol.for("v-scx"),lW=()=>ts(dW),uW="3.3.4",hW="http://www.w3.org/2000/svg",rd=typeof document<"u"?document:null,WN=rd&&rd.createElement("template"),pW={insert:(o,d,p)=>{d.insertBefore(o,p||null)},remove:o=>{const d=o.parentNode;d&&d.removeChild(o)},createElement:(o,d,p,_)=>{const E=d?rd.createElementNS(hW,o):rd.createElement(o,p?{is:p}:void 0);return o==="select"&&_&&_.multiple!=null&&E.setAttribute("multiple",_.multiple),E},createText:o=>rd.createTextNode(o),createComment:o=>rd.createComment(o),setText:(o,d)=>{o.nodeValue=d},setElementText:(o,d)=>{o.textContent=d},parentNode:o=>o.parentNode,nextSibling:o=>o.nextSibling,querySelector:o=>rd.querySelector(o),setScopeId(o,d){o.setAttribute(d,"")},insertStaticContent(o,d,p,_,E,T){const R=p?p.previousSibling:d.lastChild;if(E&&(E===T||E.nextSibling))for(;d.insertBefore(E.cloneNode(!0),p),!(E===T||!(E=E.nextSibling)););else{WN.innerHTML=_?`<svg>${o}</svg>`:o;const N=WN.content;if(_){const D=N.firstChild;for(;D.firstChild;)N.appendChild(D.firstChild);N.removeChild(D)}d.insertBefore(N,p)}return[R?R.nextSibling:d.firstChild,p?p.previousSibling:d.lastChild]}};function fW(o,d,p){const _=o._vtc;_&&(d=(d?[d,..._]:[..._]).join(" ")),d==null?o.removeAttribute("class"):p?o.setAttribute("class",d):o.className=d}function _W(o,d,p){const _=o.style,E=yi(p);if(p&&!E){if(d&&!yi(d))for(const T in d)p[T]==null&&jv(_,T,"");for(const T in p)jv(_,T,p[T])}else{const T=_.display;E?d!==p&&(_.cssText=p):d&&o.removeAttribute("style"),"_vod"in o&&(_.display=T)}}const HN=/\s*!important$/;function jv(o,d,p){if(ve(p))p.forEach(_=>jv(o,d,_));else if(p==null&&(p=""),d.startsWith("--"))o.setProperty(d,p);else{const _=mW(o,d);HN.test(p)?o.setProperty(jl(_),p.replace(HN,""),"important"):o[_]=p}}const KN=["Webkit","Moz","ms"],Ev={};function mW(o,d){const p=Ev[d];if(p)return p;let _=Lo(d);if(_!=="filter"&&_ in o)return Ev[d]=_;_=ym(_);for(let E=0;E<KN.length;E++){const T=KN[E]+_;if(T in o)return Ev[d]=T}return d}const qN="http://www.w3.org/1999/xlink";function EW(o,d,p,_,E){if(_&&d.startsWith("xlink:"))p==null?o.removeAttributeNS(qN,d.slice(6,d.length)):o.setAttributeNS(qN,d,p);else{const T=S5(d);p==null||T&&!zD(p)?o.removeAttribute(d):o.setAttribute(d,T?"":p)}}function gW(o,d,p,_,E,T,R){if(d==="innerHTML"||d==="textContent"){_&&R(_,E,T),o[d]=p??"";return}const N=o.tagName;if(d==="value"&&N!=="PROGRESS"&&!N.includes("-")){o._value=p;const M=N==="OPTION"?o.getAttribute("value"):o.value,P=p??"";M!==P&&(o.value=P),p==null&&o.removeAttribute(d);return}let D=!1;if(p===""||p==null){const M=typeof o[d];M==="boolean"?p=zD(p):p==null&&M==="string"?(p="",D=!0):M==="number"&&(p=0,D=!0)}try{o[d]=p}catch{}D&&o.removeAttribute(d)}function od(o,d,p,_){o.addEventListener(d,p,_)}function TW(o,d,p,_){o.removeEventListener(d,p,_)}function SW(o,d,p,_,E=null){const T=o._vei||(o._vei={}),R=T[d];if(_&&R)R.value=_;else{const[N,D]=vW(d);if(_){const M=T[d]=RW(_,E);od(o,N,M,D)}else R&&(TW(o,N,R,D),T[d]=void 0)}}const YN=/(?:Once|Passive|Capture)$/;function vW(o){let d;if(YN.test(o)){d={};let _;for(;_=o.match(YN);)o=o.slice(0,o.length-_[0].length),d[_[0].toLowerCase()]=!0}return[o[2]===":"?o.slice(3):jl(o.slice(2)),d]}let gv=0;const yW=Promise.resolve(),CW=()=>gv||(yW.then(()=>gv=0),gv=Date.now());function RW(o,d){const p=_=>{if(!_._vts)_._vts=Date.now();else if(_._vts<=p.attached)return;Lr(bW(_,p.value),d,5,[_])};return p.value=o,p.attached=CW(),p}function bW(o,d){if(ve(d)){const p=o.stopImmediatePropagation;return o.stopImmediatePropagation=()=>{p.call(o),o._stopped=!0},d.map(_=>E=>!E._stopped&&_&&_(E))}else return d}const zN=/^on[a-z]/,IW=(o,d,p,_,E=!1,T,R,N,D)=>{d==="class"?fW(o,_,E):d==="style"?_W(o,p,_):Sm(d)?sy(d)||SW(o,d,p,_,R):(d[0]==="."?(d=d.slice(1),!0):d[0]==="^"?(d=d.slice(1),!1):AW(o,d,_,E))?gW(o,d,_,T,R,N,D):(d==="true-value"?o._trueValue=_:d==="false-value"&&(o._falseValue=_),EW(o,d,_,E))};function AW(o,d,p,_){return _?!!(d==="innerHTML"||d==="textContent"||d in o&&zN.test(d)&&Ke(p)):d==="spellcheck"||d==="draggable"||d==="translate"||d==="form"||d==="list"&&o.tagName==="INPUT"||d==="type"&&o.tagName==="TEXTAREA"||zN.test(d)&&yi(p)?!1:d in o}const ec="transition",vh="animation",qP={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},wW=vi({},TG,qP),id=(o,d=[])=>{ve(o)?o.forEach(p=>p(...d)):o&&o(...d)},JN=o=>o?ve(o)?o.some(d=>d.length>1):o.length>1:!1;function OW(o){const d={};for(const Lt in o)Lt in qP||(d[Lt]=o[Lt]);if(o.css===!1)return d;const{name:p="v",type:_,duration:E,enterFromClass:T=`${p}-enter-from`,enterActiveClass:R=`${p}-enter-active`,enterToClass:N=`${p}-enter-to`,appearFromClass:D=T,appearActiveClass:M=R,appearToClass:P=N,leaveFromClass:j=`${p}-leave-from`,leaveActiveClass:q=`${p}-leave-active`,leaveToClass:tt=`${p}-leave-to`}=o,at=NW(E),lt=at&&at[0],vt=at&&at[1],{onBeforeEnter:wt,onEnter:It,onEnterCancelled:Bt,onLeave:Et,onLeaveCancelled:jt,onBeforeAppear:re=wt,onAppear:pe=It,onAppearCancelled:Mt=Bt}=d,qt=(Lt,de,Ne)=>{sc(Lt,de?P:N),sc(Lt,de?M:R),Ne&&Ne()},Xt=(Lt,de)=>{Lt._isLeaving=!1,sc(Lt,j),sc(Lt,tt),sc(Lt,q),de&&de()},Qt=Lt=>(de,Ne)=>{const dn=Lt?pe:It,Ee=()=>qt(de,Lt,Ne);id(dn,[de,Ee]),XN(()=>{sc(de,Lt?D:T),aa(de,Lt?P:N),JN(dn)||$N(de,_,lt,Ee)})};return vi(d,{onBeforeEnter(Lt){id(wt,[Lt]),aa(Lt,T),aa(Lt,R)},onBeforeAppear(Lt){id(re,[Lt]),aa(Lt,D),aa(Lt,M)},onEnter:Qt(!1),onAppear:Qt(!0),onLeave(Lt,de){Lt._isLeaving=!0;const Ne=()=>Xt(Lt,de);aa(Lt,j),zP(),aa(Lt,q),XN(()=>{Lt._isLeaving&&(sc(Lt,j),aa(Lt,tt),JN(Et)||$N(Lt,_,vt,Ne))}),id(Et,[Lt,Ne])},onEnterCancelled(Lt){qt(Lt,!1),id(Bt,[Lt])},onAppearCancelled(Lt){qt(Lt,!0),id(Mt,[Lt])},onLeaveCancelled(Lt){Xt(Lt),id(jt,[Lt])}})}function NW(o){if(o==null)return null;if(Fn(o))return[Tv(o.enter),Tv(o.leave)];{const d=Tv(o);return[d,d]}}function Tv(o){return f5(o)}function aa(o,d){d.split(/\s+/).forEach(p=>p&&o.classList.add(p)),(o._vtc||(o._vtc=new Set)).add(d)}function sc(o,d){d.split(/\s+/).forEach(_=>_&&o.classList.remove(_));const{_vtc:p}=o;p&&(p.delete(d),p.size||(o._vtc=void 0))}function XN(o){requestAnimationFrame(()=>{requestAnimationFrame(o)})}let DW=0;function $N(o,d,p,_){const E=o._endId=++DW,T=()=>{E===o._endId&&_()};if(p)return setTimeout(T,p);const{type:R,timeout:N,propCount:D}=YP(o,d);if(!R)return _();const M=R+"end";let P=0;const j=()=>{o.removeEventListener(M,q),T()},q=tt=>{tt.target===o&&++P>=D&&j()};setTimeout(()=>{P<D&&j()},N+1),o.addEventListener(M,q)}function YP(o,d){const p=window.getComputedStyle(o),_=at=>(p[at]||"").split(", "),E=_(`${ec}Delay`),T=_(`${ec}Duration`),R=QN(E,T),N=_(`${vh}Delay`),D=_(`${vh}Duration`),M=QN(N,D);let P=null,j=0,q=0;d===ec?R>0&&(P=ec,j=R,q=T.length):d===vh?M>0&&(P=vh,j=M,q=D.length):(j=Math.max(R,M),P=j>0?R>M?ec:vh:null,q=P?P===ec?T.length:D.length:0);const tt=P===ec&&/\b(transform|all)(,|$)/.test(_(`${ec}Property`).toString());return{type:P,timeout:j,propCount:q,hasTransform:tt}}function QN(o,d){for(;o.length<d.length;)o=o.concat(o);return Math.max(...d.map((p,_)=>ZN(p)+ZN(o[_])))}function ZN(o){return Number(o.slice(0,-1).replace(",","."))*1e3}function zP(){return document.body.offsetHeight}const JP=new WeakMap,XP=new WeakMap,$P={name:"TransitionGroup",props:vi({},wW,{tag:String,moveClass:String}),setup(o,{slots:d}){const p=nW(),_=gG();let E,T;return AP(()=>{if(!E.length)return;const R=o.moveClass||`${o.name||"v"}-move`;if(!xW(E[0].el,p.vnode.el,R))return;E.forEach(kW),E.forEach(MW);const N=E.filter(UW);zP(),N.forEach(D=>{const M=D.el,P=M.style;aa(M,R),P.transform=P.webkitTransform=P.transitionDuration="";const j=M._moveCb=q=>{q&&q.target!==M||(!q||/transform$/.test(q.propertyName))&&(M.removeEventListener("transitionend",j),M._moveCb=null,sc(M,R))};M.addEventListener("transitionend",j)})}),()=>{const R=an(o),N=OW(R);let D=R.tag||$n;E=T,T=d.default?CP(d.default()):[];for(let M=0;M<T.length;M++){const P=T[M];P.key!=null&&Mv(P,kv(P,N,_,p))}if(E)for(let M=0;M<E.length;M++){const P=E[M];Mv(P,kv(P,N,_,p)),JP.set(P,P.el.getBoundingClientRect())}return ri(D,null,T)}}},PW=o=>delete o.mode;$P.props;const LW=$P;function kW(o){const d=o.el;d._moveCb&&d._moveCb(),d._enterCb&&d._enterCb()}function MW(o){XP.set(o,o.el.getBoundingClientRect())}function UW(o){const d=JP.get(o),p=XP.get(o),_=d.left-p.left,E=d.top-p.top;if(_||E){const T=o.el.style;return T.transform=T.webkitTransform=`translate(${_}px,${E}px)`,T.transitionDuration="0s",o}}function xW(o,d,p){const _=o.cloneNode();o._vtc&&o._vtc.forEach(R=>{R.split(/\s+/).forEach(N=>N&&_.classList.remove(N))}),p.split(/\s+/).forEach(R=>R&&_.classList.add(R)),_.style.display="none";const E=d.nodeType===1?d:d.parentNode;E.appendChild(_);const{hasTransform:T}=YP(_);return E.removeChild(_),T}const fm=o=>{const d=o.props["onUpdate:modelValue"]||!1;return ve(d)?p=>J_(d,p):d};function VW(o){o.target.composing=!0}function tD(o){const d=o.target;d.composing&&(d.composing=!1,d.dispatchEvent(new Event("input")))}const zh={created(o,{modifiers:{lazy:d,trim:p,number:_}},E){o._assign=fm(E);const T=_||E.props&&E.props.type==="number";od(o,d?"change":"input",R=>{if(R.target.composing)return;let N=o.value;p&&(N=N.trim()),T&&(N=wv(N)),o._assign(N)}),p&&od(o,"change",()=>{o.value=o.value.trim()}),d||(od(o,"compositionstart",VW),od(o,"compositionend",tD),od(o,"change",tD))},mounted(o,{value:d}){o.value=d??""},beforeUpdate(o,{value:d,modifiers:{lazy:p,trim:_,number:E}},T){if(o._assign=fm(T),o.composing||document.activeElement===o&&o.type!=="range"&&(p||_&&o.value.trim()===d||(E||o.type==="number")&&wv(o.value)===d))return;const R=d??"";o.value!==R&&(o.value=R)}},Lh={created(o,{value:d},p){o.checked=cm(d,p.props.value),o._assign=fm(p),od(o,"change",()=>{o._assign(FW(o))})},beforeUpdate(o,{value:d,oldValue:p},_){o._assign=fm(_),d!==p&&(o.checked=cm(d,_.props.value))}};function FW(o){return"_value"in o?o._value:o.value}const BW=["ctrl","shift","alt","meta"],jW={stop:o=>o.stopPropagation(),prevent:o=>o.preventDefault(),self:o=>o.target!==o.currentTarget,ctrl:o=>!o.ctrlKey,shift:o=>!o.shiftKey,alt:o=>!o.altKey,meta:o=>!o.metaKey,left:o=>"button"in o&&o.button!==0,middle:o=>"button"in o&&o.button!==1,right:o=>"button"in o&&o.button!==2,exact:(o,d)=>BW.some(p=>o[`${p}Key`]&&!d.includes(p))},GW=(o,d)=>(p,..._)=>{for(let E=0;E<d.length;E++){const T=jW[d[E]];if(T&&T(p,d))return}return o(p,..._)},Ah={beforeMount(o,{value:d},{transition:p}){o._vod=o.style.display==="none"?"":o.style.display,p&&d?p.beforeEnter(o):yh(o,d)},mounted(o,{value:d},{transition:p}){p&&d&&p.enter(o)},updated(o,{value:d,oldValue:p},{transition:_}){!d!=!p&&(_?d?(_.beforeEnter(o),yh(o,!0),_.enter(o)):_.leave(o,()=>{yh(o,!1)}):yh(o,d))},beforeUnmount(o,{value:d}){yh(o,d)}};function yh(o,d){o.style.display=d?o._vod:"none"}const WW=vi({patchProp:IW},pW);let eD;function HW(){return eD||(eD=qG(WW))}const QP=(...o)=>{const d=HW().createApp(...o),{mount:p}=d;return d.mount=_=>{const E=KW(_);if(!E)return;const T=d._component;!Ke(T)&&!T.render&&!T.template&&(T.template=E.innerHTML),E.innerHTML="";const R=p(E,!1,E instanceof SVGElement);return E instanceof Element&&(E.removeAttribute("v-cloak"),E.setAttribute("data-v-app","")),R},d};function KW(o){return yi(o)?document.querySelector(o):o}var qW=!1;/*!
 * pinia v2.1.6
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let ZP;const km=o=>ZP=o,tL=Symbol();function Gv(o){return o&&typeof o=="object"&&Object.prototype.toString.call(o)==="[object Object]"&&typeof o.toJSON!="function"}var kh;(function(o){o.direct="direct",o.patchObject="patch object",o.patchFunction="patch function"})(kh||(kh={}));function YW(){const o=$D(!0),d=o.run(()=>ze({}));let p=[],_=[];const E=Rm({install(T){km(E),E._a=T,T.provide(tL,E),T.config.globalProperties.$pinia=E,_.forEach(R=>p.push(R)),_=[]},use(T){return!this._a&&!qW?_.push(T):p.push(T),this},_p:p,_a:null,_e:o,_s:new Map,state:d});return E}const eL=()=>{};function nD(o,d,p,_=eL){o.push(d);const E=()=>{const T=o.indexOf(d);T>-1&&(o.splice(T,1),_())};return!p&&QD()&&C5(E),E}function Rl(o,...d){o.slice().forEach(p=>{p(...d)})}const zW=o=>o();function Wv(o,d){o instanceof Map&&d instanceof Map&&d.forEach((p,_)=>o.set(_,p)),o instanceof Set&&d instanceof Set&&d.forEach(o.add,o);for(const p in d){if(!d.hasOwnProperty(p))continue;const _=d[p],E=o[p];Gv(E)&&Gv(_)&&o.hasOwnProperty(p)&&!di(_)&&!dc(_)?o[p]=Wv(E,_):o[p]=_}return o}const JW=Symbol();function XW(o){return!Gv(o)||!o.hasOwnProperty(JW)}const{assign:rc}=Object;function $W(o){return!!(di(o)&&o.effect)}function QW(o,d,p,_){const{state:E,actions:T,getters:R}=d,N=p.state.value[o];let D;function M(){N||(p.state.value[o]=E?E():{});const P=tG(p.state.value[o]);return rc(P,T,Object.keys(R||{}).reduce((j,q)=>(j[q]=Rm(Pr(()=>{km(p);const tt=p._s.get(o);return R[q].call(tt,tt)})),j),{}))}return D=nL(o,M,d,p,_,!0),D}function nL(o,d,p={},_,E,T){let R;const N=rc({actions:{}},p),D={deep:!0};let M,P,j=[],q=[],tt;const at=_.state.value[o];!T&&!at&&(_.state.value[o]={}),ze({});let lt;function vt(Mt){let qt;M=P=!1,typeof Mt=="function"?(Mt(_.state.value[o]),qt={type:kh.patchFunction,storeId:o,events:tt}):(Wv(_.state.value[o],Mt),qt={type:kh.patchObject,payload:Mt,storeId:o,events:tt});const Xt=lt=Symbol();Im().then(()=>{lt===Xt&&(M=!0)}),P=!0,Rl(j,qt,_.state.value[o])}const wt=T?function(){const{state:qt}=p,Xt=qt?qt():{};this.$patch(Qt=>{rc(Qt,Xt)})}:eL;function It(){R.stop(),j=[],q=[],_._s.delete(o)}function Bt(Mt,qt){return function(){km(_);const Xt=Array.from(arguments),Qt=[],Lt=[];function de(Ee){Qt.push(Ee)}function Ne(Ee){Lt.push(Ee)}Rl(q,{args:Xt,name:Mt,store:jt,after:de,onError:Ne});let dn;try{dn=qt.apply(this&&this.$id===o?this:jt,Xt)}catch(Ee){throw Rl(Lt,Ee),Ee}return dn instanceof Promise?dn.then(Ee=>(Rl(Qt,Ee),Ee)).catch(Ee=>(Rl(Lt,Ee),Promise.reject(Ee))):(Rl(Qt,dn),dn)}}const Et={_p:_,$id:o,$onAction:nD.bind(null,q),$patch:vt,$reset:wt,$subscribe(Mt,qt={}){const Xt=nD(j,Mt,qt.detached,()=>Qt()),Qt=R.run(()=>Oh(()=>_.state.value[o],Lt=>{(qt.flush==="sync"?P:M)&&Mt({storeId:o,type:kh.direct,events:tt},Lt)},rc({},D,qt)));return Xt},$dispose:It},jt=tp(Et);_._s.set(o,jt);const re=_._a&&_._a.runWithContext||zW,pe=_._e.run(()=>(R=$D(),re(()=>R.run(d))));for(const Mt in pe){const qt=pe[Mt];if(di(qt)&&!$W(qt)||dc(qt))T||(at&&XW(qt)&&(di(qt)?qt.value=at[Mt]:Wv(qt,at[Mt])),_.state.value[o][Mt]=qt);else if(typeof qt=="function"){const Xt=Bt(Mt,qt);pe[Mt]=Xt,N.actions[Mt]=qt}}return rc(jt,pe),rc(an(jt),pe),Object.defineProperty(jt,"$state",{get:()=>_.state.value[o],set:Mt=>{vt(qt=>{rc(qt,Mt)})}}),_._p.forEach(Mt=>{rc(jt,R.run(()=>Mt({store:jt,app:_._a,pinia:_,options:N})))}),at&&T&&p.hydrate&&p.hydrate(jt.$state,at),M=!0,P=!0,jt}function by(o,d,p){let _,E;const T=typeof d=="function";typeof o=="string"?(_=o,E=T?p:d):(E=o,_=o.id);function R(N,D){const M=BG();return N=N||(M?ts(tL,null):null),N&&km(N),N=ZP,N._s.has(_)||(T?nL(_,d,E,N):QW(_,E,N)),N._s.get(_)}return R.$id=_,R}var ZW=Object.defineProperty,iD=Object.getOwnPropertySymbols,t6=Object.prototype.hasOwnProperty,e6=Object.prototype.propertyIsEnumerable,sD=(o,d,p)=>d in o?ZW(o,d,{enumerable:!0,configurable:!0,writable:!0,value:p}):o[d]=p,iL=(o,d)=>{for(var p in d||(d={}))t6.call(d,p)&&sD(o,p,d[p]);if(iD)for(var p of iD(d))e6.call(d,p)&&sD(o,p,d[p]);return o},Mm=o=>typeof o=="function",Um=o=>typeof o=="string",sL=o=>Um(o)&&o.trim().length>0,n6=o=>typeof o=="number",cd=o=>typeof o>"u",Jh=o=>typeof o=="object"&&o!==null,i6=o=>Do(o,"tag")&&sL(o.tag),rL=o=>window.TouchEvent&&o instanceof TouchEvent,oL=o=>Do(o,"component")&&aL(o.component),s6=o=>Mm(o)||Jh(o),aL=o=>!cd(o)&&(Um(o)||s6(o)||oL(o)),rD=o=>Jh(o)&&["height","width","right","left","top","bottom"].every(d=>n6(o[d])),Do=(o,d)=>(Jh(o)||Mm(o))&&d in o,r6=(o=>()=>o++)(0);function Sv(o){return rL(o)?o.targetTouches[0].clientX:o.clientX}function oD(o){return rL(o)?o.targetTouches[0].clientY:o.clientY}var o6=o=>{cd(o.remove)?o.parentNode&&o.parentNode.removeChild(o):o.remove()},ip=o=>oL(o)?ip(o.component):i6(o)?bs({render(){return o}}):typeof o=="string"?o:an(Zi(o)),a6=o=>{if(typeof o=="string")return o;const d=Do(o,"props")&&Jh(o.props)?o.props:{},p=Do(o,"listeners")&&Jh(o.listeners)?o.listeners:{};return{component:ip(o),props:d,listeners:p}},c6=()=>typeof window<"u",Iy=class{constructor(){this.allHandlers={}}getHandlers(o){return this.allHandlers[o]||[]}on(o,d){const p=this.getHandlers(o);p.push(d),this.allHandlers[o]=p}off(o,d){const p=this.getHandlers(o);p.splice(p.indexOf(d)>>>0,1)}emit(o,d){this.getHandlers(o).forEach(_=>_(d))}},d6=o=>["on","off","emit"].every(d=>Do(o,d)&&Mm(o[d])),pr;(function(o){o.SUCCESS="success",o.ERROR="error",o.WARNING="warning",o.INFO="info",o.DEFAULT="default"})(pr||(pr={}));var _m;(function(o){o.TOP_LEFT="top-left",o.TOP_CENTER="top-center",o.TOP_RIGHT="top-right",o.BOTTOM_LEFT="bottom-left",o.BOTTOM_CENTER="bottom-center",o.BOTTOM_RIGHT="bottom-right"})(_m||(_m={}));var fr;(function(o){o.ADD="add",o.DISMISS="dismiss",o.UPDATE="update",o.CLEAR="clear",o.UPDATE_DEFAULTS="update_defaults"})(fr||(fr={}));var Xr="Vue-Toastification",qr={type:{type:String,default:pr.DEFAULT},classNames:{type:[String,Array],default:()=>[]},trueBoolean:{type:Boolean,default:!0}},cL={type:qr.type,customIcon:{type:[String,Boolean,Object,Function],default:!0}},tm={component:{type:[String,Object,Function,Boolean],default:"button"},classNames:qr.classNames,showOnHover:{type:Boolean,default:!1},ariaLabel:{type:String,default:"close"}},Hv={timeout:{type:[Number,Boolean],default:5e3},hideProgressBar:{type:Boolean,default:!1},isRunning:{type:Boolean,default:!1}},dL={transition:{type:[Object,String],default:`${Xr}__bounce`}},l6={position:{type:String,default:_m.TOP_RIGHT},draggable:qr.trueBoolean,draggablePercent:{type:Number,default:.6},pauseOnFocusLoss:qr.trueBoolean,pauseOnHover:qr.trueBoolean,closeOnClick:qr.trueBoolean,timeout:Hv.timeout,hideProgressBar:Hv.hideProgressBar,toastClassName:qr.classNames,bodyClassName:qr.classNames,icon:cL.customIcon,closeButton:tm.component,closeButtonClassName:tm.classNames,showCloseButtonOnHover:tm.showOnHover,accessibility:{type:Object,default:()=>({toastRole:"alert",closeButtonLabel:"close"})},rtl:{type:Boolean,default:!1},eventBus:{type:Object,required:!1,default:()=>new Iy}},u6={id:{type:[String,Number],required:!0,default:0},type:qr.type,content:{type:[String,Object,Function],required:!0,default:""},onClick:{type:Function,default:void 0},onClose:{type:Function,default:void 0}},h6={container:{type:[Object,Function],default:()=>document.body},newestOnTop:qr.trueBoolean,maxToasts:{type:Number,default:20},transition:dL.transition,toastDefaults:Object,filterBeforeCreate:{type:Function,default:o=>o},filterToasts:{type:Function,default:o=>o},containerClassName:qr.classNames,onMounted:Function,shareAppContext:[Boolean,Object]},da={CORE_TOAST:l6,TOAST:u6,CONTAINER:h6,PROGRESS_BAR:Hv,ICON:cL,TRANSITION:dL,CLOSE_BUTTON:tm},lL=bs({name:"VtProgressBar",props:da.PROGRESS_BAR,data(){return{hasClass:!0}},computed:{style(){return{animationDuration:`${this.timeout}ms`,animationPlayState:this.isRunning?"running":"paused",opacity:this.hideProgressBar?0:1}},cpClass(){return this.hasClass?`${Xr}__progress-bar`:""}},watch:{timeout(){this.hasClass=!1,this.$nextTick(()=>this.hasClass=!0)}},mounted(){this.$el.addEventListener("animationend",this.animationEnded)},beforeUnmount(){this.$el.removeEventListener("animationend",this.animationEnded)},methods:{animationEnded(){this.$emit("close-toast")}}});function p6(o,d){return Je(),In("div",{style:Zh(o.style),class:uc(o.cpClass)},null,6)}lL.render=p6;var f6=lL,uL=bs({name:"VtCloseButton",props:da.CLOSE_BUTTON,computed:{buttonComponent(){return this.component!==!1?ip(this.component):"button"},classes(){const o=[`${Xr}__close-button`];return this.showOnHover&&o.push("show-on-hover"),o.concat(this.classNames)}}}),_6=np(" × ");function m6(o,d){return Je(),Jr(Ty(o.buttonComponent),Pm({"aria-label":o.ariaLabel,class:o.classes},o.$attrs),{default:ep(()=>[_6]),_:1},16,["aria-label","class"])}uL.render=m6;var E6=uL,hL={},g6={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"check-circle",class:"svg-inline--fa fa-check-circle fa-w-16",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},T6=ot("path",{fill:"currentColor",d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},null,-1),S6=[T6];function v6(o,d){return Je(),In("svg",g6,S6)}hL.render=v6;var y6=hL,pL={},C6={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"info-circle",class:"svg-inline--fa fa-info-circle fa-w-16",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},R6=ot("path",{fill:"currentColor",d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},null,-1),b6=[R6];function I6(o,d){return Je(),In("svg",C6,b6)}pL.render=I6;var aD=pL,fL={},A6={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"exclamation-circle",class:"svg-inline--fa fa-exclamation-circle fa-w-16",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},w6=ot("path",{fill:"currentColor",d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},null,-1),O6=[w6];function N6(o,d){return Je(),In("svg",A6,O6)}fL.render=N6;var D6=fL,_L={},P6={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"exclamation-triangle",class:"svg-inline--fa fa-exclamation-triangle fa-w-18",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512"},L6=ot("path",{fill:"currentColor",d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},null,-1),k6=[L6];function M6(o,d){return Je(),In("svg",P6,k6)}_L.render=M6;var U6=_L,mL=bs({name:"VtIcon",props:da.ICON,computed:{customIconChildren(){return Do(this.customIcon,"iconChildren")?this.trimValue(this.customIcon.iconChildren):""},customIconClass(){return Um(this.customIcon)?this.trimValue(this.customIcon):Do(this.customIcon,"iconClass")?this.trimValue(this.customIcon.iconClass):""},customIconTag(){return Do(this.customIcon,"iconTag")?this.trimValue(this.customIcon.iconTag,"i"):"i"},hasCustomIcon(){return this.customIconClass.length>0},component(){return this.hasCustomIcon?this.customIconTag:aL(this.customIcon)?ip(this.customIcon):this.iconTypeComponent},iconTypeComponent(){return{[pr.DEFAULT]:aD,[pr.INFO]:aD,[pr.SUCCESS]:y6,[pr.ERROR]:U6,[pr.WARNING]:D6}[this.type]},iconClasses(){const o=[`${Xr}__icon`];return this.hasCustomIcon?o.concat(this.customIconClass):o}},methods:{trimValue(o,d=""){return sL(o)?o.trim():d}}});function x6(o,d){return Je(),Jr(Ty(o.component),{class:uc(o.iconClasses)},{default:ep(()=>[np(fi(o.customIconChildren),1)]),_:1},8,["class"])}mL.render=x6;var V6=mL,EL=bs({name:"VtToast",components:{ProgressBar:f6,CloseButton:E6,Icon:V6},inheritAttrs:!1,props:Object.assign({},da.CORE_TOAST,da.TOAST),data(){return{isRunning:!0,disableTransitions:!1,beingDragged:!1,dragStart:0,dragPos:{x:0,y:0},dragRect:{}}},computed:{classes(){const o=[`${Xr}__toast`,`${Xr}__toast--${this.type}`,`${this.position}`].concat(this.toastClassName);return this.disableTransitions&&o.push("disable-transition"),this.rtl&&o.push(`${Xr}__toast--rtl`),o},bodyClasses(){return[`${Xr}__toast-${Um(this.content)?"body":"component-body"}`].concat(this.bodyClassName)},draggableStyle(){return this.dragStart===this.dragPos.x?{}:this.beingDragged?{transform:`translateX(${this.dragDelta}px)`,opacity:1-Math.abs(this.dragDelta/this.removalDistance)}:{transition:"transform 0.2s, opacity 0.2s",transform:"translateX(0)",opacity:1}},dragDelta(){return this.beingDragged?this.dragPos.x-this.dragStart:0},removalDistance(){return rD(this.dragRect)?(this.dragRect.right-this.dragRect.left)*this.draggablePercent:0}},mounted(){this.draggable&&this.draggableSetup(),this.pauseOnFocusLoss&&this.focusSetup()},beforeUnmount(){this.draggable&&this.draggableCleanup(),this.pauseOnFocusLoss&&this.focusCleanup()},methods:{hasProp:Do,getVueComponentFromObj:ip,closeToast(){this.eventBus.emit(fr.DISMISS,this.id)},clickHandler(){this.onClick&&this.onClick(this.closeToast),this.closeOnClick&&(!this.beingDragged||this.dragStart===this.dragPos.x)&&this.closeToast()},timeoutHandler(){this.closeToast()},hoverPause(){this.pauseOnHover&&(this.isRunning=!1)},hoverPlay(){this.pauseOnHover&&(this.isRunning=!0)},focusPause(){this.isRunning=!1},focusPlay(){this.isRunning=!0},focusSetup(){addEventListener("blur",this.focusPause),addEventListener("focus",this.focusPlay)},focusCleanup(){removeEventListener("blur",this.focusPause),removeEventListener("focus",this.focusPlay)},draggableSetup(){const o=this.$el;o.addEventListener("touchstart",this.onDragStart,{passive:!0}),o.addEventListener("mousedown",this.onDragStart),addEventListener("touchmove",this.onDragMove,{passive:!1}),addEventListener("mousemove",this.onDragMove),addEventListener("touchend",this.onDragEnd),addEventListener("mouseup",this.onDragEnd)},draggableCleanup(){const o=this.$el;o.removeEventListener("touchstart",this.onDragStart),o.removeEventListener("mousedown",this.onDragStart),removeEventListener("touchmove",this.onDragMove),removeEventListener("mousemove",this.onDragMove),removeEventListener("touchend",this.onDragEnd),removeEventListener("mouseup",this.onDragEnd)},onDragStart(o){this.beingDragged=!0,this.dragPos={x:Sv(o),y:oD(o)},this.dragStart=Sv(o),this.dragRect=this.$el.getBoundingClientRect()},onDragMove(o){this.beingDragged&&(o.preventDefault(),this.isRunning&&(this.isRunning=!1),this.dragPos={x:Sv(o),y:oD(o)})},onDragEnd(){this.beingDragged&&(Math.abs(this.dragDelta)>=this.removalDistance?(this.disableTransitions=!0,this.$nextTick(()=>this.closeToast())):setTimeout(()=>{this.beingDragged=!1,rD(this.dragRect)&&this.pauseOnHover&&this.dragRect.bottom>=this.dragPos.y&&this.dragPos.y>=this.dragRect.top&&this.dragRect.left<=this.dragPos.x&&this.dragPos.x<=this.dragRect.right?this.isRunning=!1:this.isRunning=!0}))}}}),F6=["role"];function B6(o,d){const p=ld("Icon"),_=ld("CloseButton"),E=ld("ProgressBar");return Je(),In("div",{class:uc(o.classes),style:Zh(o.draggableStyle),onClick:d[0]||(d[0]=(...T)=>o.clickHandler&&o.clickHandler(...T)),onMouseenter:d[1]||(d[1]=(...T)=>o.hoverPause&&o.hoverPause(...T)),onMouseleave:d[2]||(d[2]=(...T)=>o.hoverPlay&&o.hoverPlay(...T))},[o.icon?(Je(),Jr(p,{key:0,"custom-icon":o.icon,type:o.type},null,8,["custom-icon","type"])):Z_("v-if",!0),ot("div",{role:o.accessibility.toastRole||"alert",class:uc(o.bodyClasses)},[typeof o.content=="string"?(Je(),In($n,{key:0},[np(fi(o.content),1)],2112)):(Je(),Jr(Ty(o.getVueComponentFromObj(o.content)),Pm({key:1,"toast-id":o.id},o.hasProp(o.content,"props")?o.content.props:{},DG(o.hasProp(o.content,"listeners")?o.content.listeners:{}),{onCloseToast:o.closeToast}),null,16,["toast-id","onCloseToast"]))],10,F6),o.closeButton?(Je(),Jr(_,{key:1,component:o.closeButton,"class-names":o.closeButtonClassName,"show-on-hover":o.showCloseButtonOnHover,"aria-label":o.accessibility.closeButtonLabel,onClick:GW(o.closeToast,["stop"])},null,8,["component","class-names","show-on-hover","aria-label","onClick"])):Z_("v-if",!0),o.timeout?(Je(),Jr(E,{key:2,"is-running":o.isRunning,"hide-progress-bar":o.hideProgressBar,timeout:o.timeout,onCloseToast:o.timeoutHandler},null,8,["is-running","hide-progress-bar","timeout","onCloseToast"])):Z_("v-if",!0)],38)}EL.render=B6;var j6=EL,gL=bs({name:"VtTransition",props:da.TRANSITION,emits:["leave"],methods:{hasProp:Do,leave(o){o instanceof HTMLElement&&(o.style.left=o.offsetLeft+"px",o.style.top=o.offsetTop+"px",o.style.width=getComputedStyle(o).width,o.style.position="absolute")}}});function G6(o,d){return Je(),Jr(LW,{tag:"div","enter-active-class":o.transition.enter?o.transition.enter:`${o.transition}-enter-active`,"move-class":o.transition.move?o.transition.move:`${o.transition}-move`,"leave-active-class":o.transition.leave?o.transition.leave:`${o.transition}-leave-active`,onLeave:o.leave},{default:ep(()=>[NG(o.$slots,"default")]),_:3},8,["enter-active-class","move-class","leave-active-class","onLeave"])}gL.render=G6;var W6=gL,TL=bs({name:"VueToastification",devtools:{hide:!0},components:{Toast:j6,VtTransition:W6},props:Object.assign({},da.CORE_TOAST,da.CONTAINER,da.TRANSITION),data(){return{count:0,positions:Object.values(_m),toasts:{},defaults:{}}},computed:{toastArray(){return Object.values(this.toasts)},filteredToasts(){return this.defaults.filterToasts(this.toastArray)}},beforeMount(){const o=this.eventBus;o.on(fr.ADD,this.addToast),o.on(fr.CLEAR,this.clearToasts),o.on(fr.DISMISS,this.dismissToast),o.on(fr.UPDATE,this.updateToast),o.on(fr.UPDATE_DEFAULTS,this.updateDefaults),this.defaults=this.$props},mounted(){this.setup(this.container)},methods:{async setup(o){Mm(o)&&(o=await o()),o6(this.$el),o.appendChild(this.$el)},setToast(o){cd(o.id)||(this.toasts[o.id]=o)},addToast(o){o.content=a6(o.content);const d=Object.assign({},this.defaults,o.type&&this.defaults.toastDefaults&&this.defaults.toastDefaults[o.type],o),p=this.defaults.filterBeforeCreate(d,this.toastArray);p&&this.setToast(p)},dismissToast(o){const d=this.toasts[o];!cd(d)&&!cd(d.onClose)&&d.onClose(),delete this.toasts[o]},clearToasts(){Object.keys(this.toasts).forEach(o=>{this.dismissToast(o)})},getPositionToasts(o){const d=this.filteredToasts.filter(p=>p.position===o).slice(0,this.defaults.maxToasts);return this.defaults.newestOnTop?d.reverse():d},updateDefaults(o){cd(o.container)||this.setup(o.container),this.defaults=Object.assign({},this.defaults,o)},updateToast({id:o,options:d,create:p}){this.toasts[o]?(d.timeout&&d.timeout===this.toasts[o].timeout&&d.timeout++,this.setToast(Object.assign({},this.toasts[o],d))):p&&this.addToast(Object.assign({},{id:o},d))},getClasses(o){return[`${Xr}__container`,o].concat(this.defaults.containerClassName)}}});function H6(o,d){const p=ld("Toast"),_=ld("VtTransition");return Je(),In("div",null,[(Je(!0),In($n,null,pd(o.positions,E=>(Je(),In("div",{key:E},[ri(_,{transition:o.defaults.transition,class:uc(o.getClasses(E))},{default:ep(()=>[(Je(!0),In($n,null,pd(o.getPositionToasts(E),T=>(Je(),Jr(p,Pm({key:T.id},T),null,16))),128))]),_:2},1032,["transition","class"])]))),128))])}TL.render=H6;var K6=TL,cD=(o={},d=!0)=>{const p=o.eventBus=o.eventBus||new Iy;d&&Im(()=>{const T=QP(K6,iL({},o)),R=T.mount(document.createElement("div")),N=o.onMounted;if(cd(N)||N(R,T),o.shareAppContext){const D=o.shareAppContext;D===!0?console.warn(`[${Xr}] App to share context with was not provided.`):(T._context.components=D._context.components,T._context.directives=D._context.directives,T._context.mixins=D._context.mixins,T._context.provides=D._context.provides,T.config.globalProperties=D.config.globalProperties)}});const _=(T,R)=>{const N=Object.assign({},{id:r6(),type:pr.DEFAULT},R,{content:T});return p.emit(fr.ADD,N),N.id};_.clear=()=>p.emit(fr.CLEAR,void 0),_.updateDefaults=T=>{p.emit(fr.UPDATE_DEFAULTS,T)},_.dismiss=T=>{p.emit(fr.DISMISS,T)};function E(T,{content:R,options:N},D=!1){const M=Object.assign({},N,{content:R});p.emit(fr.UPDATE,{id:T,options:M,create:D})}return _.update=E,_.success=(T,R)=>_(T,Object.assign({},R,{type:pr.SUCCESS})),_.info=(T,R)=>_(T,Object.assign({},R,{type:pr.INFO})),_.error=(T,R)=>_(T,Object.assign({},R,{type:pr.ERROR})),_.warning=(T,R)=>_(T,Object.assign({},R,{type:pr.WARNING})),_},q6=()=>{const o=()=>console.warn(`[${Xr}] This plugin does not support SSR!`);return new Proxy(o,{get(){return o}})};function Y6(o){return c6()?d6(o)?cD({eventBus:o},!1):cD(o,!0):q6()}var z6=Symbol("VueToastification"),J6=new Iy,X6=(o,d)=>{(d==null?void 0:d.shareAppContext)===!0&&(d.shareAppContext=o);const p=Y6(iL({eventBus:J6},d));o.provide(z6,p)},$6=X6,em=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Q6(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Z6(o){if(o.__esModule)return o;var d=o.default;if(typeof d=="function"){var p=function _(){return this instanceof _?Reflect.construct(d,arguments,this.constructor):d.apply(this,arguments)};p.prototype=d.prototype}else p={};return Object.defineProperty(p,"__esModule",{value:!0}),Object.keys(o).forEach(function(_){var E=Object.getOwnPropertyDescriptor(o,_);Object.defineProperty(p,_,E.get?E:{enumerable:!0,get:function(){return o[_]}})}),p}var tH={exports:{}},Cs="top",_r="bottom",mr="right",Rs="left",xm="auto",Hl=[Cs,_r,mr,Rs],_d="start",Ll="end",SL="clippingParents",Ay="viewport",Il="popper",vL="reference",Kv=Hl.reduce(function(o,d){return o.concat([d+"-"+_d,d+"-"+Ll])},[]),wy=[].concat(Hl,[xm]).reduce(function(o,d){return o.concat([d,d+"-"+_d,d+"-"+Ll])},[]),yL="beforeRead",CL="read",RL="afterRead",bL="beforeMain",IL="main",AL="afterMain",wL="beforeWrite",OL="write",NL="afterWrite",DL=[yL,CL,RL,bL,IL,AL,wL,OL,NL];function ko(o){return o?(o.nodeName||"").toLowerCase():null}function Er(o){if(o==null)return window;if(o.toString()!=="[object Window]"){var d=o.ownerDocument;return d&&d.defaultView||window}return o}function md(o){var d=Er(o).Element;return o instanceof d||o instanceof Element}function kr(o){var d=Er(o).HTMLElement;return o instanceof d||o instanceof HTMLElement}function Oy(o){if(typeof ShadowRoot>"u")return!1;var d=Er(o).ShadowRoot;return o instanceof d||o instanceof ShadowRoot}function eH(o){var d=o.state;Object.keys(d.elements).forEach(function(p){var _=d.styles[p]||{},E=d.attributes[p]||{},T=d.elements[p];!kr(T)||!ko(T)||(Object.assign(T.style,_),Object.keys(E).forEach(function(R){var N=E[R];N===!1?T.removeAttribute(R):T.setAttribute(R,N===!0?"":N)}))})}function nH(o){var d=o.state,p={popper:{position:d.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(d.elements.popper.style,p.popper),d.styles=p,d.elements.arrow&&Object.assign(d.elements.arrow.style,p.arrow),function(){Object.keys(d.elements).forEach(function(_){var E=d.elements[_],T=d.attributes[_]||{},R=Object.keys(d.styles.hasOwnProperty(_)?d.styles[_]:p[_]),N=R.reduce(function(D,M){return D[M]="",D},{});!kr(E)||!ko(E)||(Object.assign(E.style,N),Object.keys(T).forEach(function(D){E.removeAttribute(D)}))})}}const Ny={name:"applyStyles",enabled:!0,phase:"write",fn:eH,effect:nH,requires:["computeStyles"]};function Po(o){return o.split("-")[0]}var hd=Math.max,mm=Math.min,kl=Math.round;function qv(){var o=navigator.userAgentData;return o!=null&&o.brands&&Array.isArray(o.brands)?o.brands.map(function(d){return d.brand+"/"+d.version}).join(" "):navigator.userAgent}function PL(){return!/^((?!chrome|android).)*safari/i.test(qv())}function Ml(o,d,p){d===void 0&&(d=!1),p===void 0&&(p=!1);var _=o.getBoundingClientRect(),E=1,T=1;d&&kr(o)&&(E=o.offsetWidth>0&&kl(_.width)/o.offsetWidth||1,T=o.offsetHeight>0&&kl(_.height)/o.offsetHeight||1);var R=md(o)?Er(o):window,N=R.visualViewport,D=!PL()&&p,M=(_.left+(D&&N?N.offsetLeft:0))/E,P=(_.top+(D&&N?N.offsetTop:0))/T,j=_.width/E,q=_.height/T;return{width:j,height:q,top:P,right:M+j,bottom:P+q,left:M,x:M,y:P}}function Dy(o){var d=Ml(o),p=o.offsetWidth,_=o.offsetHeight;return Math.abs(d.width-p)<=1&&(p=d.width),Math.abs(d.height-_)<=1&&(_=d.height),{x:o.offsetLeft,y:o.offsetTop,width:p,height:_}}function LL(o,d){var p=d.getRootNode&&d.getRootNode();if(o.contains(d))return!0;if(p&&Oy(p)){var _=d;do{if(_&&o.isSameNode(_))return!0;_=_.parentNode||_.host}while(_)}return!1}function fa(o){return Er(o).getComputedStyle(o)}function iH(o){return["table","td","th"].indexOf(ko(o))>=0}function pc(o){return((md(o)?o.ownerDocument:o.document)||window.document).documentElement}function Vm(o){return ko(o)==="html"?o:o.assignedSlot||o.parentNode||(Oy(o)?o.host:null)||pc(o)}function dD(o){return!kr(o)||fa(o).position==="fixed"?null:o.offsetParent}function sH(o){var d=/firefox/i.test(qv()),p=/Trident/i.test(qv());if(p&&kr(o)){var _=fa(o);if(_.position==="fixed")return null}var E=Vm(o);for(Oy(E)&&(E=E.host);kr(E)&&["html","body"].indexOf(ko(E))<0;){var T=fa(E);if(T.transform!=="none"||T.perspective!=="none"||T.contain==="paint"||["transform","perspective"].indexOf(T.willChange)!==-1||d&&T.willChange==="filter"||d&&T.filter&&T.filter!=="none")return E;E=E.parentNode}return null}function sp(o){for(var d=Er(o),p=dD(o);p&&iH(p)&&fa(p).position==="static";)p=dD(p);return p&&(ko(p)==="html"||ko(p)==="body"&&fa(p).position==="static")?d:p||sH(o)||d}function Py(o){return["top","bottom"].indexOf(o)>=0?"x":"y"}function Mh(o,d,p){return hd(o,mm(d,p))}function rH(o,d,p){var _=Mh(o,d,p);return _>p?p:_}function kL(){return{top:0,right:0,bottom:0,left:0}}function ML(o){return Object.assign({},kL(),o)}function UL(o,d){return d.reduce(function(p,_){return p[_]=o,p},{})}var oH=function(d,p){return d=typeof d=="function"?d(Object.assign({},p.rects,{placement:p.placement})):d,ML(typeof d!="number"?d:UL(d,Hl))};function aH(o){var d,p=o.state,_=o.name,E=o.options,T=p.elements.arrow,R=p.modifiersData.popperOffsets,N=Po(p.placement),D=Py(N),M=[Rs,mr].indexOf(N)>=0,P=M?"height":"width";if(!(!T||!R)){var j=oH(E.padding,p),q=Dy(T),tt=D==="y"?Cs:Rs,at=D==="y"?_r:mr,lt=p.rects.reference[P]+p.rects.reference[D]-R[D]-p.rects.popper[P],vt=R[D]-p.rects.reference[D],wt=sp(T),It=wt?D==="y"?wt.clientHeight||0:wt.clientWidth||0:0,Bt=lt/2-vt/2,Et=j[tt],jt=It-q[P]-j[at],re=It/2-q[P]/2+Bt,pe=Mh(Et,re,jt),Mt=D;p.modifiersData[_]=(d={},d[Mt]=pe,d.centerOffset=pe-re,d)}}function cH(o){var d=o.state,p=o.options,_=p.element,E=_===void 0?"[data-popper-arrow]":_;E!=null&&(typeof E=="string"&&(E=d.elements.popper.querySelector(E),!E)||LL(d.elements.popper,E)&&(d.elements.arrow=E))}const xL={name:"arrow",enabled:!0,phase:"main",fn:aH,effect:cH,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ul(o){return o.split("-")[1]}var dH={top:"auto",right:"auto",bottom:"auto",left:"auto"};function lH(o,d){var p=o.x,_=o.y,E=d.devicePixelRatio||1;return{x:kl(p*E)/E||0,y:kl(_*E)/E||0}}function lD(o){var d,p=o.popper,_=o.popperRect,E=o.placement,T=o.variation,R=o.offsets,N=o.position,D=o.gpuAcceleration,M=o.adaptive,P=o.roundOffsets,j=o.isFixed,q=R.x,tt=q===void 0?0:q,at=R.y,lt=at===void 0?0:at,vt=typeof P=="function"?P({x:tt,y:lt}):{x:tt,y:lt};tt=vt.x,lt=vt.y;var wt=R.hasOwnProperty("x"),It=R.hasOwnProperty("y"),Bt=Rs,Et=Cs,jt=window;if(M){var re=sp(p),pe="clientHeight",Mt="clientWidth";if(re===Er(p)&&(re=pc(p),fa(re).position!=="static"&&N==="absolute"&&(pe="scrollHeight",Mt="scrollWidth")),re=re,E===Cs||(E===Rs||E===mr)&&T===Ll){Et=_r;var qt=j&&re===jt&&jt.visualViewport?jt.visualViewport.height:re[pe];lt-=qt-_.height,lt*=D?1:-1}if(E===Rs||(E===Cs||E===_r)&&T===Ll){Bt=mr;var Xt=j&&re===jt&&jt.visualViewport?jt.visualViewport.width:re[Mt];tt-=Xt-_.width,tt*=D?1:-1}}var Qt=Object.assign({position:N},M&&dH),Lt=P===!0?lH({x:tt,y:lt},Er(p)):{x:tt,y:lt};if(tt=Lt.x,lt=Lt.y,D){var de;return Object.assign({},Qt,(de={},de[Et]=It?"0":"",de[Bt]=wt?"0":"",de.transform=(jt.devicePixelRatio||1)<=1?"translate("+tt+"px, "+lt+"px)":"translate3d("+tt+"px, "+lt+"px, 0)",de))}return Object.assign({},Qt,(d={},d[Et]=It?lt+"px":"",d[Bt]=wt?tt+"px":"",d.transform="",d))}function uH(o){var d=o.state,p=o.options,_=p.gpuAcceleration,E=_===void 0?!0:_,T=p.adaptive,R=T===void 0?!0:T,N=p.roundOffsets,D=N===void 0?!0:N,M={placement:Po(d.placement),variation:Ul(d.placement),popper:d.elements.popper,popperRect:d.rects.popper,gpuAcceleration:E,isFixed:d.options.strategy==="fixed"};d.modifiersData.popperOffsets!=null&&(d.styles.popper=Object.assign({},d.styles.popper,lD(Object.assign({},M,{offsets:d.modifiersData.popperOffsets,position:d.options.strategy,adaptive:R,roundOffsets:D})))),d.modifiersData.arrow!=null&&(d.styles.arrow=Object.assign({},d.styles.arrow,lD(Object.assign({},M,{offsets:d.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:D})))),d.attributes.popper=Object.assign({},d.attributes.popper,{"data-popper-placement":d.placement})}const Ly={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:uH,data:{}};var q_={passive:!0};function hH(o){var d=o.state,p=o.instance,_=o.options,E=_.scroll,T=E===void 0?!0:E,R=_.resize,N=R===void 0?!0:R,D=Er(d.elements.popper),M=[].concat(d.scrollParents.reference,d.scrollParents.popper);return T&&M.forEach(function(P){P.addEventListener("scroll",p.update,q_)}),N&&D.addEventListener("resize",p.update,q_),function(){T&&M.forEach(function(P){P.removeEventListener("scroll",p.update,q_)}),N&&D.removeEventListener("resize",p.update,q_)}}const ky={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:hH,data:{}};var pH={left:"right",right:"left",bottom:"top",top:"bottom"};function nm(o){return o.replace(/left|right|bottom|top/g,function(d){return pH[d]})}var fH={start:"end",end:"start"};function uD(o){return o.replace(/start|end/g,function(d){return fH[d]})}function My(o){var d=Er(o),p=d.pageXOffset,_=d.pageYOffset;return{scrollLeft:p,scrollTop:_}}function Uy(o){return Ml(pc(o)).left+My(o).scrollLeft}function _H(o,d){var p=Er(o),_=pc(o),E=p.visualViewport,T=_.clientWidth,R=_.clientHeight,N=0,D=0;if(E){T=E.width,R=E.height;var M=PL();(M||!M&&d==="fixed")&&(N=E.offsetLeft,D=E.offsetTop)}return{width:T,height:R,x:N+Uy(o),y:D}}function mH(o){var d,p=pc(o),_=My(o),E=(d=o.ownerDocument)==null?void 0:d.body,T=hd(p.scrollWidth,p.clientWidth,E?E.scrollWidth:0,E?E.clientWidth:0),R=hd(p.scrollHeight,p.clientHeight,E?E.scrollHeight:0,E?E.clientHeight:0),N=-_.scrollLeft+Uy(o),D=-_.scrollTop;return fa(E||p).direction==="rtl"&&(N+=hd(p.clientWidth,E?E.clientWidth:0)-T),{width:T,height:R,x:N,y:D}}function xy(o){var d=fa(o),p=d.overflow,_=d.overflowX,E=d.overflowY;return/auto|scroll|overlay|hidden/.test(p+E+_)}function VL(o){return["html","body","#document"].indexOf(ko(o))>=0?o.ownerDocument.body:kr(o)&&xy(o)?o:VL(Vm(o))}function Uh(o,d){var p;d===void 0&&(d=[]);var _=VL(o),E=_===((p=o.ownerDocument)==null?void 0:p.body),T=Er(_),R=E?[T].concat(T.visualViewport||[],xy(_)?_:[]):_,N=d.concat(R);return E?N:N.concat(Uh(Vm(R)))}function Yv(o){return Object.assign({},o,{left:o.x,top:o.y,right:o.x+o.width,bottom:o.y+o.height})}function EH(o,d){var p=Ml(o,!1,d==="fixed");return p.top=p.top+o.clientTop,p.left=p.left+o.clientLeft,p.bottom=p.top+o.clientHeight,p.right=p.left+o.clientWidth,p.width=o.clientWidth,p.height=o.clientHeight,p.x=p.left,p.y=p.top,p}function hD(o,d,p){return d===Ay?Yv(_H(o,p)):md(d)?EH(d,p):Yv(mH(pc(o)))}function gH(o){var d=Uh(Vm(o)),p=["absolute","fixed"].indexOf(fa(o).position)>=0,_=p&&kr(o)?sp(o):o;return md(_)?d.filter(function(E){return md(E)&&LL(E,_)&&ko(E)!=="body"}):[]}function TH(o,d,p,_){var E=d==="clippingParents"?gH(o):[].concat(d),T=[].concat(E,[p]),R=T[0],N=T.reduce(function(D,M){var P=hD(o,M,_);return D.top=hd(P.top,D.top),D.right=mm(P.right,D.right),D.bottom=mm(P.bottom,D.bottom),D.left=hd(P.left,D.left),D},hD(o,R,_));return N.width=N.right-N.left,N.height=N.bottom-N.top,N.x=N.left,N.y=N.top,N}function FL(o){var d=o.reference,p=o.element,_=o.placement,E=_?Po(_):null,T=_?Ul(_):null,R=d.x+d.width/2-p.width/2,N=d.y+d.height/2-p.height/2,D;switch(E){case Cs:D={x:R,y:d.y-p.height};break;case _r:D={x:R,y:d.y+d.height};break;case mr:D={x:d.x+d.width,y:N};break;case Rs:D={x:d.x-p.width,y:N};break;default:D={x:d.x,y:d.y}}var M=E?Py(E):null;if(M!=null){var P=M==="y"?"height":"width";switch(T){case _d:D[M]=D[M]-(d[P]/2-p[P]/2);break;case Ll:D[M]=D[M]+(d[P]/2-p[P]/2);break}}return D}function xl(o,d){d===void 0&&(d={});var p=d,_=p.placement,E=_===void 0?o.placement:_,T=p.strategy,R=T===void 0?o.strategy:T,N=p.boundary,D=N===void 0?SL:N,M=p.rootBoundary,P=M===void 0?Ay:M,j=p.elementContext,q=j===void 0?Il:j,tt=p.altBoundary,at=tt===void 0?!1:tt,lt=p.padding,vt=lt===void 0?0:lt,wt=ML(typeof vt!="number"?vt:UL(vt,Hl)),It=q===Il?vL:Il,Bt=o.rects.popper,Et=o.elements[at?It:q],jt=TH(md(Et)?Et:Et.contextElement||pc(o.elements.popper),D,P,R),re=Ml(o.elements.reference),pe=FL({reference:re,element:Bt,strategy:"absolute",placement:E}),Mt=Yv(Object.assign({},Bt,pe)),qt=q===Il?Mt:re,Xt={top:jt.top-qt.top+wt.top,bottom:qt.bottom-jt.bottom+wt.bottom,left:jt.left-qt.left+wt.left,right:qt.right-jt.right+wt.right},Qt=o.modifiersData.offset;if(q===Il&&Qt){var Lt=Qt[E];Object.keys(Xt).forEach(function(de){var Ne=[mr,_r].indexOf(de)>=0?1:-1,dn=[Cs,_r].indexOf(de)>=0?"y":"x";Xt[de]+=Lt[dn]*Ne})}return Xt}function SH(o,d){d===void 0&&(d={});var p=d,_=p.placement,E=p.boundary,T=p.rootBoundary,R=p.padding,N=p.flipVariations,D=p.allowedAutoPlacements,M=D===void 0?wy:D,P=Ul(_),j=P?N?Kv:Kv.filter(function(at){return Ul(at)===P}):Hl,q=j.filter(function(at){return M.indexOf(at)>=0});q.length===0&&(q=j);var tt=q.reduce(function(at,lt){return at[lt]=xl(o,{placement:lt,boundary:E,rootBoundary:T,padding:R})[Po(lt)],at},{});return Object.keys(tt).sort(function(at,lt){return tt[at]-tt[lt]})}function vH(o){if(Po(o)===xm)return[];var d=nm(o);return[uD(o),d,uD(d)]}function yH(o){var d=o.state,p=o.options,_=o.name;if(!d.modifiersData[_]._skip){for(var E=p.mainAxis,T=E===void 0?!0:E,R=p.altAxis,N=R===void 0?!0:R,D=p.fallbackPlacements,M=p.padding,P=p.boundary,j=p.rootBoundary,q=p.altBoundary,tt=p.flipVariations,at=tt===void 0?!0:tt,lt=p.allowedAutoPlacements,vt=d.options.placement,wt=Po(vt),It=wt===vt,Bt=D||(It||!at?[nm(vt)]:vH(vt)),Et=[vt].concat(Bt).reduce(function(Ci,Pi){return Ci.concat(Po(Pi)===xm?SH(d,{placement:Pi,boundary:P,rootBoundary:j,padding:M,flipVariations:at,allowedAutoPlacements:lt}):Pi)},[]),jt=d.rects.reference,re=d.rects.popper,pe=new Map,Mt=!0,qt=Et[0],Xt=0;Xt<Et.length;Xt++){var Qt=Et[Xt],Lt=Po(Qt),de=Ul(Qt)===_d,Ne=[Cs,_r].indexOf(Lt)>=0,dn=Ne?"width":"height",Ee=xl(d,{placement:Qt,boundary:P,rootBoundary:j,altBoundary:q,padding:M}),Oe=Ne?de?mr:Rs:de?_r:Cs;jt[dn]>re[dn]&&(Oe=nm(Oe));var Ue=nm(Oe),Wn=[];if(T&&Wn.push(Ee[Lt]<=0),N&&Wn.push(Ee[Oe]<=0,Ee[Ue]<=0),Wn.every(function(Ci){return Ci})){qt=Qt,Mt=!1;break}pe.set(Qt,Wn)}if(Mt)for(var Be=at?3:1,kn=function(Pi){var yn=Et.find(function(ft){var Yt=pe.get(ft);if(Yt)return Yt.slice(0,Pi).every(function(Ut){return Ut})});if(yn)return qt=yn,"break"},tn=Be;tn>0;tn--){var Tt=kn(tn);if(Tt==="break")break}d.placement!==qt&&(d.modifiersData[_]._skip=!0,d.placement=qt,d.reset=!0)}}const BL={name:"flip",enabled:!0,phase:"main",fn:yH,requiresIfExists:["offset"],data:{_skip:!1}};function pD(o,d,p){return p===void 0&&(p={x:0,y:0}),{top:o.top-d.height-p.y,right:o.right-d.width+p.x,bottom:o.bottom-d.height+p.y,left:o.left-d.width-p.x}}function fD(o){return[Cs,mr,_r,Rs].some(function(d){return o[d]>=0})}function CH(o){var d=o.state,p=o.name,_=d.rects.reference,E=d.rects.popper,T=d.modifiersData.preventOverflow,R=xl(d,{elementContext:"reference"}),N=xl(d,{altBoundary:!0}),D=pD(R,_),M=pD(N,E,T),P=fD(D),j=fD(M);d.modifiersData[p]={referenceClippingOffsets:D,popperEscapeOffsets:M,isReferenceHidden:P,hasPopperEscaped:j},d.attributes.popper=Object.assign({},d.attributes.popper,{"data-popper-reference-hidden":P,"data-popper-escaped":j})}const jL={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:CH};function RH(o,d,p){var _=Po(o),E=[Rs,Cs].indexOf(_)>=0?-1:1,T=typeof p=="function"?p(Object.assign({},d,{placement:o})):p,R=T[0],N=T[1];return R=R||0,N=(N||0)*E,[Rs,mr].indexOf(_)>=0?{x:N,y:R}:{x:R,y:N}}function bH(o){var d=o.state,p=o.options,_=o.name,E=p.offset,T=E===void 0?[0,0]:E,R=wy.reduce(function(P,j){return P[j]=RH(j,d.rects,T),P},{}),N=R[d.placement],D=N.x,M=N.y;d.modifiersData.popperOffsets!=null&&(d.modifiersData.popperOffsets.x+=D,d.modifiersData.popperOffsets.y+=M),d.modifiersData[_]=R}const GL={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:bH};function IH(o){var d=o.state,p=o.name;d.modifiersData[p]=FL({reference:d.rects.reference,element:d.rects.popper,strategy:"absolute",placement:d.placement})}const Vy={name:"popperOffsets",enabled:!0,phase:"read",fn:IH,data:{}};function AH(o){return o==="x"?"y":"x"}function wH(o){var d=o.state,p=o.options,_=o.name,E=p.mainAxis,T=E===void 0?!0:E,R=p.altAxis,N=R===void 0?!1:R,D=p.boundary,M=p.rootBoundary,P=p.altBoundary,j=p.padding,q=p.tether,tt=q===void 0?!0:q,at=p.tetherOffset,lt=at===void 0?0:at,vt=xl(d,{boundary:D,rootBoundary:M,padding:j,altBoundary:P}),wt=Po(d.placement),It=Ul(d.placement),Bt=!It,Et=Py(wt),jt=AH(Et),re=d.modifiersData.popperOffsets,pe=d.rects.reference,Mt=d.rects.popper,qt=typeof lt=="function"?lt(Object.assign({},d.rects,{placement:d.placement})):lt,Xt=typeof qt=="number"?{mainAxis:qt,altAxis:qt}:Object.assign({mainAxis:0,altAxis:0},qt),Qt=d.modifiersData.offset?d.modifiersData.offset[d.placement]:null,Lt={x:0,y:0};if(re){if(T){var de,Ne=Et==="y"?Cs:Rs,dn=Et==="y"?_r:mr,Ee=Et==="y"?"height":"width",Oe=re[Et],Ue=Oe+vt[Ne],Wn=Oe-vt[dn],Be=tt?-Mt[Ee]/2:0,kn=It===_d?pe[Ee]:Mt[Ee],tn=It===_d?-Mt[Ee]:-pe[Ee],Tt=d.elements.arrow,Ci=tt&&Tt?Dy(Tt):{width:0,height:0},Pi=d.modifiersData["arrow#persistent"]?d.modifiersData["arrow#persistent"].padding:kL(),yn=Pi[Ne],ft=Pi[dn],Yt=Mh(0,pe[Ee],Ci[Ee]),Ut=Bt?pe[Ee]/2-Be-Yt-yn-Xt.mainAxis:kn-Yt-yn-Xt.mainAxis,se=Bt?-pe[Ee]/2+Be+Yt+ft+Xt.mainAxis:tn+Yt+ft+Xt.mainAxis,xt=d.elements.arrow&&sp(d.elements.arrow),H=xt?Et==="y"?xt.clientTop||0:xt.clientLeft||0:0,z=(de=Qt==null?void 0:Qt[Et])!=null?de:0,rt=Oe+Ut-z-H,_t=Oe+se-z,gt=Mh(tt?mm(Ue,rt):Ue,Oe,tt?hd(Wn,_t):Wn);re[Et]=gt,Lt[Et]=gt-Oe}if(N){var At,zt=Et==="x"?Cs:Rs,Pt=Et==="x"?_r:mr,Vt=re[jt],Ot=jt==="y"?"height":"width",oe=Vt+vt[zt],Zt=Vt-vt[Pt],ae=[Cs,Rs].indexOf(wt)!==-1,Se=(At=Qt==null?void 0:Qt[jt])!=null?At:0,De=ae?oe:Vt-pe[Ot]-Mt[Ot]-Se+Xt.altAxis,en=ae?Vt+pe[Ot]+Mt[Ot]-Se-Xt.altAxis:Zt,ce=tt&&ae?rH(De,Vt,en):Mh(tt?De:oe,Vt,tt?en:Zt);re[jt]=ce,Lt[jt]=ce-Vt}d.modifiersData[_]=Lt}}const WL={name:"preventOverflow",enabled:!0,phase:"main",fn:wH,requiresIfExists:["offset"]};function OH(o){return{scrollLeft:o.scrollLeft,scrollTop:o.scrollTop}}function NH(o){return o===Er(o)||!kr(o)?My(o):OH(o)}function DH(o){var d=o.getBoundingClientRect(),p=kl(d.width)/o.offsetWidth||1,_=kl(d.height)/o.offsetHeight||1;return p!==1||_!==1}function PH(o,d,p){p===void 0&&(p=!1);var _=kr(d),E=kr(d)&&DH(d),T=pc(d),R=Ml(o,E,p),N={scrollLeft:0,scrollTop:0},D={x:0,y:0};return(_||!_&&!p)&&((ko(d)!=="body"||xy(T))&&(N=NH(d)),kr(d)?(D=Ml(d,!0),D.x+=d.clientLeft,D.y+=d.clientTop):T&&(D.x=Uy(T))),{x:R.left+N.scrollLeft-D.x,y:R.top+N.scrollTop-D.y,width:R.width,height:R.height}}function LH(o){var d=new Map,p=new Set,_=[];o.forEach(function(T){d.set(T.name,T)});function E(T){p.add(T.name);var R=[].concat(T.requires||[],T.requiresIfExists||[]);R.forEach(function(N){if(!p.has(N)){var D=d.get(N);D&&E(D)}}),_.push(T)}return o.forEach(function(T){p.has(T.name)||E(T)}),_}function kH(o){var d=LH(o);return DL.reduce(function(p,_){return p.concat(d.filter(function(E){return E.phase===_}))},[])}function MH(o){var d;return function(){return d||(d=new Promise(function(p){Promise.resolve().then(function(){d=void 0,p(o())})})),d}}function UH(o){var d=o.reduce(function(p,_){var E=p[_.name];return p[_.name]=E?Object.assign({},E,_,{options:Object.assign({},E.options,_.options),data:Object.assign({},E.data,_.data)}):_,p},{});return Object.keys(d).map(function(p){return d[p]})}var _D={placement:"bottom",modifiers:[],strategy:"absolute"};function mD(){for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return!d.some(function(_){return!(_&&typeof _.getBoundingClientRect=="function")})}function Fm(o){o===void 0&&(o={});var d=o,p=d.defaultModifiers,_=p===void 0?[]:p,E=d.defaultOptions,T=E===void 0?_D:E;return function(N,D,M){M===void 0&&(M=T);var P={placement:"bottom",orderedModifiers:[],options:Object.assign({},_D,T),modifiersData:{},elements:{reference:N,popper:D},attributes:{},styles:{}},j=[],q=!1,tt={state:P,setOptions:function(wt){var It=typeof wt=="function"?wt(P.options):wt;lt(),P.options=Object.assign({},T,P.options,It),P.scrollParents={reference:md(N)?Uh(N):N.contextElement?Uh(N.contextElement):[],popper:Uh(D)};var Bt=kH(UH([].concat(_,P.options.modifiers)));return P.orderedModifiers=Bt.filter(function(Et){return Et.enabled}),at(),tt.update()},forceUpdate:function(){if(!q){var wt=P.elements,It=wt.reference,Bt=wt.popper;if(mD(It,Bt)){P.rects={reference:PH(It,sp(Bt),P.options.strategy==="fixed"),popper:Dy(Bt)},P.reset=!1,P.placement=P.options.placement,P.orderedModifiers.forEach(function(Xt){return P.modifiersData[Xt.name]=Object.assign({},Xt.data)});for(var Et=0;Et<P.orderedModifiers.length;Et++){if(P.reset===!0){P.reset=!1,Et=-1;continue}var jt=P.orderedModifiers[Et],re=jt.fn,pe=jt.options,Mt=pe===void 0?{}:pe,qt=jt.name;typeof re=="function"&&(P=re({state:P,options:Mt,name:qt,instance:tt})||P)}}}},update:MH(function(){return new Promise(function(vt){tt.forceUpdate(),vt(P)})}),destroy:function(){lt(),q=!0}};if(!mD(N,D))return tt;tt.setOptions(M).then(function(vt){!q&&M.onFirstUpdate&&M.onFirstUpdate(vt)});function at(){P.orderedModifiers.forEach(function(vt){var wt=vt.name,It=vt.options,Bt=It===void 0?{}:It,Et=vt.effect;if(typeof Et=="function"){var jt=Et({state:P,name:wt,instance:tt,options:Bt}),re=function(){};j.push(jt||re)}})}function lt(){j.forEach(function(vt){return vt()}),j=[]}return tt}}var xH=Fm(),VH=[ky,Vy,Ly,Ny],FH=Fm({defaultModifiers:VH}),BH=[ky,Vy,Ly,Ny,GL,BL,WL,xL,jL],jH=Fm({defaultModifiers:BH});const GH=Object.freeze(Object.defineProperty({__proto__:null,afterMain:AL,afterRead:RL,afterWrite:NL,applyStyles:Ny,arrow:xL,auto:xm,basePlacements:Hl,beforeMain:bL,beforeRead:yL,beforeWrite:wL,bottom:_r,clippingParents:SL,computeStyles:Ly,createPopper:jH,createPopperBase:xH,createPopperLite:FH,detectOverflow:xl,end:Ll,eventListeners:ky,flip:BL,hide:jL,left:Rs,main:IL,modifierPhases:DL,offset:GL,placements:wy,popper:Il,popperGenerator:Fm,popperOffsets:Vy,preventOverflow:WL,read:CL,reference:vL,right:mr,start:_d,top:Cs,variationPlacements:Kv,viewport:Ay,write:OL},Symbol.toStringTag,{value:"Module"})),WH=Z6(GH);/*!
  * Bootstrap v5.3.2 (https://getbootstrap.com/)
  * Copyright 2011-2023 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(o,d){(function(p,_){o.exports=_(WH)})(em,function(p){function _(X){const y=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(X){for(const k in X)if(k!=="default"){const J=Object.getOwnPropertyDescriptor(X,k);Object.defineProperty(y,k,J.get?J:{enumerable:!0,get:()=>X[k]})}}return y.default=X,Object.freeze(y)}const E=_(p),T=new Map,R={set(X,y,k){T.has(X)||T.set(X,new Map);const J=T.get(X);J.has(y)||J.size===0?J.set(y,k):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(J.keys())[0]}.`)},get:(X,y)=>T.has(X)&&T.get(X).get(y)||null,remove(X,y){if(!T.has(X))return;const k=T.get(X);k.delete(y),k.size===0&&T.delete(X)}},N="transitionend",D=X=>(X&&window.CSS&&window.CSS.escape&&(X=X.replace(/#([^\s"#']+)/g,(y,k)=>`#${CSS.escape(k)}`)),X),M=X=>{X.dispatchEvent(new Event(N))},P=X=>!(!X||typeof X!="object")&&(X.jquery!==void 0&&(X=X[0]),X.nodeType!==void 0),j=X=>P(X)?X.jquery?X[0]:X:typeof X=="string"&&X.length>0?document.querySelector(D(X)):null,q=X=>{if(!P(X)||X.getClientRects().length===0)return!1;const y=getComputedStyle(X).getPropertyValue("visibility")==="visible",k=X.closest("details:not([open])");if(!k)return y;if(k!==X){const J=X.closest("summary");if(J&&J.parentNode!==k||J===null)return!1}return y},tt=X=>!X||X.nodeType!==Node.ELEMENT_NODE||!!X.classList.contains("disabled")||(X.disabled!==void 0?X.disabled:X.hasAttribute("disabled")&&X.getAttribute("disabled")!=="false"),at=X=>{if(!document.documentElement.attachShadow)return null;if(typeof X.getRootNode=="function"){const y=X.getRootNode();return y instanceof ShadowRoot?y:null}return X instanceof ShadowRoot?X:X.parentNode?at(X.parentNode):null},lt=()=>{},vt=X=>{X.offsetHeight},wt=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,It=[],Bt=()=>document.documentElement.dir==="rtl",Et=X=>{var y;y=()=>{const k=wt();if(k){const J=X.NAME,St=k.fn[J];k.fn[J]=X.jQueryInterface,k.fn[J].Constructor=X,k.fn[J].noConflict=()=>(k.fn[J]=St,X.jQueryInterface)}},document.readyState==="loading"?(It.length||document.addEventListener("DOMContentLoaded",()=>{for(const k of It)k()}),It.push(y)):y()},jt=(X,y=[],k=X)=>typeof X=="function"?X(...y):k,re=(X,y,k=!0)=>{if(!k)return void jt(X);const J=(ie=>{if(!ie)return 0;let{transitionDuration:$e,transitionDelay:Hn}=window.getComputedStyle(ie);const zi=Number.parseFloat($e),fs=Number.parseFloat(Hn);return zi||fs?($e=$e.split(",")[0],Hn=Hn.split(",")[0],1e3*(Number.parseFloat($e)+Number.parseFloat(Hn))):0})(y)+5;let St=!1;const Kt=({target:ie})=>{ie===y&&(St=!0,y.removeEventListener(N,Kt),jt(X))};y.addEventListener(N,Kt),setTimeout(()=>{St||M(y)},J)},pe=(X,y,k,J)=>{const St=X.length;let Kt=X.indexOf(y);return Kt===-1?!k&&J?X[St-1]:X[0]:(Kt+=k?1:-1,J&&(Kt=(Kt+St)%St),X[Math.max(0,Math.min(Kt,St-1))])},Mt=/[^.]*(?=\..*)\.|.*/,qt=/\..*/,Xt=/::\d+$/,Qt={};let Lt=1;const de={mouseenter:"mouseover",mouseleave:"mouseout"},Ne=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function dn(X,y){return y&&`${y}::${Lt++}`||X.uidEvent||Lt++}function Ee(X){const y=dn(X);return X.uidEvent=y,Qt[y]=Qt[y]||{},Qt[y]}function Oe(X,y,k=null){return Object.values(X).find(J=>J.callable===y&&J.delegationSelector===k)}function Ue(X,y,k){const J=typeof y=="string",St=J?k:y||k;let Kt=tn(X);return Ne.has(Kt)||(Kt=X),[J,St,Kt]}function Wn(X,y,k,J,St){if(typeof y!="string"||!X)return;let[Kt,ie,$e]=Ue(y,k,J);y in de&&(ie=(Wo=>function(Xs){if(!Xs.relatedTarget||Xs.relatedTarget!==Xs.delegateTarget&&!Xs.delegateTarget.contains(Xs.relatedTarget))return Wo.call(this,Xs)})(ie));const Hn=Ee(X),zi=Hn[$e]||(Hn[$e]={}),fs=Oe(zi,ie,Kt?k:null);if(fs)return void(fs.oneOff=fs.oneOff&&St);const Js=dn(ie,y.replace(Mt,"")),Fr=Kt?function(Ji,Wo,Xs){return function Rc(bc){const Gp=Ji.querySelectorAll(Wo);for(let{target:Ho}=bc;Ho&&Ho!==this;Ho=Ho.parentNode)for(const WE of Gp)if(WE===Ho)return Ci(bc,{delegateTarget:Ho}),Rc.oneOff&&Tt.off(Ji,bc.type,Wo,Xs),Xs.apply(Ho,[bc])}}(X,k,ie):function(Ji,Wo){return function Xs(Rc){return Ci(Rc,{delegateTarget:Ji}),Xs.oneOff&&Tt.off(Ji,Rc.type,Wo),Wo.apply(Ji,[Rc])}}(X,ie);Fr.delegationSelector=Kt?k:null,Fr.callable=ie,Fr.oneOff=St,Fr.uidEvent=Js,zi[Js]=Fr,X.addEventListener($e,Fr,Kt)}function Be(X,y,k,J,St){const Kt=Oe(y[k],J,St);Kt&&(X.removeEventListener(k,Kt,!!St),delete y[k][Kt.uidEvent])}function kn(X,y,k,J){const St=y[k]||{};for(const[Kt,ie]of Object.entries(St))Kt.includes(J)&&Be(X,y,k,ie.callable,ie.delegationSelector)}function tn(X){return X=X.replace(qt,""),de[X]||X}const Tt={on(X,y,k,J){Wn(X,y,k,J,!1)},one(X,y,k,J){Wn(X,y,k,J,!0)},off(X,y,k,J){if(typeof y!="string"||!X)return;const[St,Kt,ie]=Ue(y,k,J),$e=ie!==y,Hn=Ee(X),zi=Hn[ie]||{},fs=y.startsWith(".");if(Kt===void 0){if(fs)for(const Js of Object.keys(Hn))kn(X,Hn,Js,y.slice(1));for(const[Js,Fr]of Object.entries(zi)){const Ji=Js.replace(Xt,"");$e&&!y.includes(Ji)||Be(X,Hn,ie,Fr.callable,Fr.delegationSelector)}}else{if(!Object.keys(zi).length)return;Be(X,Hn,ie,Kt,St?k:null)}},trigger(X,y,k){if(typeof y!="string"||!X)return null;const J=wt();let St=null,Kt=!0,ie=!0,$e=!1;y!==tn(y)&&J&&(St=J.Event(y,k),J(X).trigger(St),Kt=!St.isPropagationStopped(),ie=!St.isImmediatePropagationStopped(),$e=St.isDefaultPrevented());const Hn=Ci(new Event(y,{bubbles:Kt,cancelable:!0}),k);return $e&&Hn.preventDefault(),ie&&X.dispatchEvent(Hn),Hn.defaultPrevented&&St&&St.preventDefault(),Hn}};function Ci(X,y={}){for(const[k,J]of Object.entries(y))try{X[k]=J}catch{Object.defineProperty(X,k,{configurable:!0,get:()=>J})}return X}function Pi(X){if(X==="true")return!0;if(X==="false")return!1;if(X===Number(X).toString())return Number(X);if(X===""||X==="null")return null;if(typeof X!="string")return X;try{return JSON.parse(decodeURIComponent(X))}catch{return X}}function yn(X){return X.replace(/[A-Z]/g,y=>`-${y.toLowerCase()}`)}const ft={setDataAttribute(X,y,k){X.setAttribute(`data-bs-${yn(y)}`,k)},removeDataAttribute(X,y){X.removeAttribute(`data-bs-${yn(y)}`)},getDataAttributes(X){if(!X)return{};const y={},k=Object.keys(X.dataset).filter(J=>J.startsWith("bs")&&!J.startsWith("bsConfig"));for(const J of k){let St=J.replace(/^bs/,"");St=St.charAt(0).toLowerCase()+St.slice(1,St.length),y[St]=Pi(X.dataset[J])}return y},getDataAttribute:(X,y)=>Pi(X.getAttribute(`data-bs-${yn(y)}`))};class Yt{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(y){return y=this._mergeConfigObj(y),y=this._configAfterMerge(y),this._typeCheckConfig(y),y}_configAfterMerge(y){return y}_mergeConfigObj(y,k){const J=P(k)?ft.getDataAttribute(k,"config"):{};return{...this.constructor.Default,...typeof J=="object"?J:{},...P(k)?ft.getDataAttributes(k):{},...typeof y=="object"?y:{}}}_typeCheckConfig(y,k=this.constructor.DefaultType){for(const[St,Kt]of Object.entries(k)){const ie=y[St],$e=P(ie)?"element":(J=ie)==null?`${J}`:Object.prototype.toString.call(J).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(Kt).test($e))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${St}" provided type "${$e}" but expected type "${Kt}".`)}var J}}class Ut extends Yt{constructor(y,k){super(),(y=j(y))&&(this._element=y,this._config=this._getConfig(k),R.set(this._element,this.constructor.DATA_KEY,this))}dispose(){R.remove(this._element,this.constructor.DATA_KEY),Tt.off(this._element,this.constructor.EVENT_KEY);for(const y of Object.getOwnPropertyNames(this))this[y]=null}_queueCallback(y,k,J=!0){re(y,k,J)}_getConfig(y){return y=this._mergeConfigObj(y,this._element),y=this._configAfterMerge(y),this._typeCheckConfig(y),y}static getInstance(y){return R.get(j(y),this.DATA_KEY)}static getOrCreateInstance(y,k={}){return this.getInstance(y)||new this(y,typeof k=="object"?k:null)}static get VERSION(){return"5.3.2"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(y){return`${y}${this.EVENT_KEY}`}}const se=X=>{let y=X.getAttribute("data-bs-target");if(!y||y==="#"){let k=X.getAttribute("href");if(!k||!k.includes("#")&&!k.startsWith("."))return null;k.includes("#")&&!k.startsWith("#")&&(k=`#${k.split("#")[1]}`),y=k&&k!=="#"?D(k.trim()):null}return y},xt={find:(X,y=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(y,X)),findOne:(X,y=document.documentElement)=>Element.prototype.querySelector.call(y,X),children:(X,y)=>[].concat(...X.children).filter(k=>k.matches(y)),parents(X,y){const k=[];let J=X.parentNode.closest(y);for(;J;)k.push(J),J=J.parentNode.closest(y);return k},prev(X,y){let k=X.previousElementSibling;for(;k;){if(k.matches(y))return[k];k=k.previousElementSibling}return[]},next(X,y){let k=X.nextElementSibling;for(;k;){if(k.matches(y))return[k];k=k.nextElementSibling}return[]},focusableChildren(X){const y=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(k=>`${k}:not([tabindex^="-"])`).join(",");return this.find(y,X).filter(k=>!tt(k)&&q(k))},getSelectorFromElement(X){const y=se(X);return y&&xt.findOne(y)?y:null},getElementFromSelector(X){const y=se(X);return y?xt.findOne(y):null},getMultipleElementsFromSelector(X){const y=se(X);return y?xt.find(y):[]}},H=(X,y="hide")=>{const k=`click.dismiss${X.EVENT_KEY}`,J=X.NAME;Tt.on(document,k,`[data-bs-dismiss="${J}"]`,function(St){if(["A","AREA"].includes(this.tagName)&&St.preventDefault(),tt(this))return;const Kt=xt.getElementFromSelector(this)||this.closest(`.${J}`);X.getOrCreateInstance(Kt)[y]()})},z=".bs.alert",rt=`close${z}`,_t=`closed${z}`;class gt extends Ut{static get NAME(){return"alert"}close(){if(Tt.trigger(this._element,rt).defaultPrevented)return;this._element.classList.remove("show");const y=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,y)}_destroyElement(){this._element.remove(),Tt.trigger(this._element,_t),this.dispose()}static jQueryInterface(y){return this.each(function(){const k=gt.getOrCreateInstance(this);if(typeof y=="string"){if(k[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);k[y](this)}})}}H(gt,"close"),Et(gt);const At='[data-bs-toggle="button"]';class zt extends Ut{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(y){return this.each(function(){const k=zt.getOrCreateInstance(this);y==="toggle"&&k[y]()})}}Tt.on(document,"click.bs.button.data-api",At,X=>{X.preventDefault();const y=X.target.closest(At);zt.getOrCreateInstance(y).toggle()}),Et(zt);const Pt=".bs.swipe",Vt=`touchstart${Pt}`,Ot=`touchmove${Pt}`,oe=`touchend${Pt}`,Zt=`pointerdown${Pt}`,ae=`pointerup${Pt}`,Se={endCallback:null,leftCallback:null,rightCallback:null},De={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class en extends Yt{constructor(y,k){super(),this._element=y,y&&en.isSupported()&&(this._config=this._getConfig(k),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return Se}static get DefaultType(){return De}static get NAME(){return"swipe"}dispose(){Tt.off(this._element,Pt)}_start(y){this._supportPointerEvents?this._eventIsPointerPenTouch(y)&&(this._deltaX=y.clientX):this._deltaX=y.touches[0].clientX}_end(y){this._eventIsPointerPenTouch(y)&&(this._deltaX=y.clientX-this._deltaX),this._handleSwipe(),jt(this._config.endCallback)}_move(y){this._deltaX=y.touches&&y.touches.length>1?0:y.touches[0].clientX-this._deltaX}_handleSwipe(){const y=Math.abs(this._deltaX);if(y<=40)return;const k=y/this._deltaX;this._deltaX=0,k&&jt(k>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Tt.on(this._element,Zt,y=>this._start(y)),Tt.on(this._element,ae,y=>this._end(y)),this._element.classList.add("pointer-event")):(Tt.on(this._element,Vt,y=>this._start(y)),Tt.on(this._element,Ot,y=>this._move(y)),Tt.on(this._element,oe,y=>this._end(y)))}_eventIsPointerPenTouch(y){return this._supportPointerEvents&&(y.pointerType==="pen"||y.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const ce=".bs.carousel",An=".data-api",Ri="next",es="prev",zs="left",gr="right",wn=`slide${ce}`,Cn=`slid${ce}`,qi=`keydown${ce}`,oi=`mouseenter${ce}`,Ym=`mouseleave${ce}`,dp=`dragstart${ce}`,lp=`load${ce}${An}`,up=`click${ce}${An}`,gd="carousel",_c="active",hp=".active",pp=".carousel-item",Zr=hp+pp,zm={ArrowLeft:gr,ArrowRight:zs},Jm={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Jl={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class to extends Ut{constructor(y,k){super(y,k),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=xt.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===gd&&this.cycle()}static get Default(){return Jm}static get DefaultType(){return Jl}static get NAME(){return"carousel"}next(){this._slide(Ri)}nextWhenVisible(){!document.hidden&&q(this._element)&&this.next()}prev(){this._slide(es)}pause(){this._isSliding&&M(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?Tt.one(this._element,Cn,()=>this.cycle()):this.cycle())}to(y){const k=this._getItems();if(y>k.length-1||y<0)return;if(this._isSliding)return void Tt.one(this._element,Cn,()=>this.to(y));const J=this._getItemIndex(this._getActive());if(J===y)return;const St=y>J?Ri:es;this._slide(St,k[y])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(y){return y.defaultInterval=y.interval,y}_addEventListeners(){this._config.keyboard&&Tt.on(this._element,qi,y=>this._keydown(y)),this._config.pause==="hover"&&(Tt.on(this._element,oi,()=>this.pause()),Tt.on(this._element,Ym,()=>this._maybeEnableCycle())),this._config.touch&&en.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const k of xt.find(".carousel-item img",this._element))Tt.on(k,dp,J=>J.preventDefault());const y={leftCallback:()=>this._slide(this._directionToOrder(zs)),rightCallback:()=>this._slide(this._directionToOrder(gr)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new en(this._element,y)}_keydown(y){if(/input|textarea/i.test(y.target.tagName))return;const k=zm[y.key];k&&(y.preventDefault(),this._slide(this._directionToOrder(k)))}_getItemIndex(y){return this._getItems().indexOf(y)}_setActiveIndicatorElement(y){if(!this._indicatorsElement)return;const k=xt.findOne(hp,this._indicatorsElement);k.classList.remove(_c),k.removeAttribute("aria-current");const J=xt.findOne(`[data-bs-slide-to="${y}"]`,this._indicatorsElement);J&&(J.classList.add(_c),J.setAttribute("aria-current","true"))}_updateInterval(){const y=this._activeElement||this._getActive();if(!y)return;const k=Number.parseInt(y.getAttribute("data-bs-interval"),10);this._config.interval=k||this._config.defaultInterval}_slide(y,k=null){if(this._isSliding)return;const J=this._getActive(),St=y===Ri,Kt=k||pe(this._getItems(),J,St,this._config.wrap);if(Kt===J)return;const ie=this._getItemIndex(Kt),$e=Js=>Tt.trigger(this._element,Js,{relatedTarget:Kt,direction:this._orderToDirection(y),from:this._getItemIndex(J),to:ie});if($e(wn).defaultPrevented||!J||!Kt)return;const Hn=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(ie),this._activeElement=Kt;const zi=St?"carousel-item-start":"carousel-item-end",fs=St?"carousel-item-next":"carousel-item-prev";Kt.classList.add(fs),vt(Kt),J.classList.add(zi),Kt.classList.add(zi),this._queueCallback(()=>{Kt.classList.remove(zi,fs),Kt.classList.add(_c),J.classList.remove(_c,fs,zi),this._isSliding=!1,$e(Cn)},J,this._isAnimated()),Hn&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return xt.findOne(Zr,this._element)}_getItems(){return xt.find(pp,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(y){return Bt()?y===zs?es:Ri:y===zs?Ri:es}_orderToDirection(y){return Bt()?y===es?zs:gr:y===es?gr:zs}static jQueryInterface(y){return this.each(function(){const k=to.getOrCreateInstance(this,y);if(typeof y!="number"){if(typeof y=="string"){if(k[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);k[y]()}}else k.to(y)})}}Tt.on(document,up,"[data-bs-slide], [data-bs-slide-to]",function(X){const y=xt.getElementFromSelector(this);if(!y||!y.classList.contains(gd))return;X.preventDefault();const k=to.getOrCreateInstance(y),J=this.getAttribute("data-bs-slide-to");return J?(k.to(J),void k._maybeEnableCycle()):ft.getDataAttribute(this,"slide")==="next"?(k.next(),void k._maybeEnableCycle()):(k.prev(),void k._maybeEnableCycle())}),Tt.on(window,lp,()=>{const X=xt.find('[data-bs-ride="carousel"]');for(const y of X)to.getOrCreateInstance(y)}),Et(to);const eo=".bs.collapse",Xm=`show${eo}`,li=`shown${eo}`,mc=`hide${eo}`,Tr=`hidden${eo}`,$m=`click${eo}.data-api`,ma="show",ai="collapse",Ea="collapsing",fp=`:scope .${ai} .${ai}`,Td='[data-bs-toggle="collapse"]',Qm={parent:null,toggle:!0},no={parent:"(null|element)",toggle:"boolean"};class Ur extends Ut{constructor(y,k){super(y,k),this._isTransitioning=!1,this._triggerArray=[];const J=xt.find(Td);for(const St of J){const Kt=xt.getSelectorFromElement(St),ie=xt.find(Kt).filter($e=>$e===this._element);Kt!==null&&ie.length&&this._triggerArray.push(St)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Qm}static get DefaultType(){return no}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let y=[];if(this._config.parent&&(y=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(St=>St!==this._element).map(St=>Ur.getOrCreateInstance(St,{toggle:!1}))),y.length&&y[0]._isTransitioning||Tt.trigger(this._element,Xm).defaultPrevented)return;for(const St of y)St.hide();const k=this._getDimension();this._element.classList.remove(ai),this._element.classList.add(Ea),this._element.style[k]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const J=`scroll${k[0].toUpperCase()+k.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Ea),this._element.classList.add(ai,ma),this._element.style[k]="",Tt.trigger(this._element,li)},this._element,!0),this._element.style[k]=`${this._element[J]}px`}hide(){if(this._isTransitioning||!this._isShown()||Tt.trigger(this._element,mc).defaultPrevented)return;const y=this._getDimension();this._element.style[y]=`${this._element.getBoundingClientRect()[y]}px`,vt(this._element),this._element.classList.add(Ea),this._element.classList.remove(ai,ma);for(const k of this._triggerArray){const J=xt.getElementFromSelector(k);J&&!this._isShown(J)&&this._addAriaAndCollapsedClass([k],!1)}this._isTransitioning=!0,this._element.style[y]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Ea),this._element.classList.add(ai),Tt.trigger(this._element,Tr)},this._element,!0)}_isShown(y=this._element){return y.classList.contains(ma)}_configAfterMerge(y){return y.toggle=!!y.toggle,y.parent=j(y.parent),y}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const y=this._getFirstLevelChildren(Td);for(const k of y){const J=xt.getElementFromSelector(k);J&&this._addAriaAndCollapsedClass([k],this._isShown(J))}}_getFirstLevelChildren(y){const k=xt.find(fp,this._config.parent);return xt.find(y,this._config.parent).filter(J=>!k.includes(J))}_addAriaAndCollapsedClass(y,k){if(y.length)for(const J of y)J.classList.toggle("collapsed",!k),J.setAttribute("aria-expanded",k)}static jQueryInterface(y){const k={};return typeof y=="string"&&/show|hide/.test(y)&&(k.toggle=!1),this.each(function(){const J=Ur.getOrCreateInstance(this,k);if(typeof y=="string"){if(J[y]===void 0)throw new TypeError(`No method named "${y}"`);J[y]()}})}}Tt.on(document,$m,Td,function(X){(X.target.tagName==="A"||X.delegateTarget&&X.delegateTarget.tagName==="A")&&X.preventDefault();for(const y of xt.getMultipleElementsFromSelector(this))Ur.getOrCreateInstance(y,{toggle:!1}).toggle()}),Et(Ur);const io="dropdown",Uo=".bs.dropdown",Xl=".data-api",$l="ArrowUp",_p="ArrowDown",Ql=`hide${Uo}`,Sd=`hidden${Uo}`,Zm=`show${Uo}`,tE=`shown${Uo}`,ga=`click${Uo}${Xl}`,mp=`keydown${Uo}${Xl}`,eE=`keyup${Uo}${Xl}`,Is="show",so='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',nE=`${so}.${Is}`,Yi=".dropdown-menu",xo=Bt()?"top-end":"top-start",Zl=Bt()?"top-start":"top-end",tu=Bt()?"bottom-end":"bottom-start",iE=Bt()?"bottom-start":"bottom-end",Ep=Bt()?"left-start":"right-start",ns=Bt()?"right-start":"left-start",Vo={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},gp={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class ps extends Ut{constructor(y,k){super(y,k),this._popper=null,this._parent=this._element.parentNode,this._menu=xt.next(this._element,Yi)[0]||xt.prev(this._element,Yi)[0]||xt.findOne(Yi,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Vo}static get DefaultType(){return gp}static get NAME(){return io}toggle(){return this._isShown()?this.hide():this.show()}show(){if(tt(this._element)||this._isShown())return;const y={relatedTarget:this._element};if(!Tt.trigger(this._element,Zm,y).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const k of[].concat(...document.body.children))Tt.on(k,"mouseover",lt);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Is),this._element.classList.add(Is),Tt.trigger(this._element,tE,y)}}hide(){if(tt(this._element)||!this._isShown())return;const y={relatedTarget:this._element};this._completeHide(y)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(y){if(!Tt.trigger(this._element,Ql,y).defaultPrevented){if("ontouchstart"in document.documentElement)for(const k of[].concat(...document.body.children))Tt.off(k,"mouseover",lt);this._popper&&this._popper.destroy(),this._menu.classList.remove(Is),this._element.classList.remove(Is),this._element.setAttribute("aria-expanded","false"),ft.removeDataAttribute(this._menu,"popper"),Tt.trigger(this._element,Sd,y)}}_getConfig(y){if(typeof(y=super._getConfig(y)).reference=="object"&&!P(y.reference)&&typeof y.reference.getBoundingClientRect!="function")throw new TypeError(`${io.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return y}_createPopper(){if(E===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let y=this._element;this._config.reference==="parent"?y=this._parent:P(this._config.reference)?y=j(this._config.reference):typeof this._config.reference=="object"&&(y=this._config.reference);const k=this._getPopperConfig();this._popper=E.createPopper(y,this._menu,k)}_isShown(){return this._menu.classList.contains(Is)}_getPlacement(){const y=this._parent;if(y.classList.contains("dropend"))return Ep;if(y.classList.contains("dropstart"))return ns;if(y.classList.contains("dropup-center"))return"top";if(y.classList.contains("dropdown-center"))return"bottom";const k=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return y.classList.contains("dropup")?k?Zl:xo:k?iE:tu}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:y}=this._config;return typeof y=="string"?y.split(",").map(k=>Number.parseInt(k,10)):typeof y=="function"?k=>y(k,this._element):y}_getPopperConfig(){const y={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(ft.setDataAttribute(this._menu,"popper","static"),y.modifiers=[{name:"applyStyles",enabled:!1}]),{...y,...jt(this._config.popperConfig,[y])}}_selectMenuItem({key:y,target:k}){const J=xt.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(St=>q(St));J.length&&pe(J,k,y===_p,!J.includes(k)).focus()}static jQueryInterface(y){return this.each(function(){const k=ps.getOrCreateInstance(this,y);if(typeof y=="string"){if(k[y]===void 0)throw new TypeError(`No method named "${y}"`);k[y]()}})}static clearMenus(y){if(y.button===2||y.type==="keyup"&&y.key!=="Tab")return;const k=xt.find(nE);for(const J of k){const St=ps.getInstance(J);if(!St||St._config.autoClose===!1)continue;const Kt=y.composedPath(),ie=Kt.includes(St._menu);if(Kt.includes(St._element)||St._config.autoClose==="inside"&&!ie||St._config.autoClose==="outside"&&ie||St._menu.contains(y.target)&&(y.type==="keyup"&&y.key==="Tab"||/input|select|option|textarea|form/i.test(y.target.tagName)))continue;const $e={relatedTarget:St._element};y.type==="click"&&($e.clickEvent=y),St._completeHide($e)}}static dataApiKeydownHandler(y){const k=/input|textarea/i.test(y.target.tagName),J=y.key==="Escape",St=[$l,_p].includes(y.key);if(!St&&!J||k&&!J)return;y.preventDefault();const Kt=this.matches(so)?this:xt.prev(this,so)[0]||xt.next(this,so)[0]||xt.findOne(so,y.delegateTarget.parentNode),ie=ps.getOrCreateInstance(Kt);if(St)return y.stopPropagation(),ie.show(),void ie._selectMenuItem(y);ie._isShown()&&(y.stopPropagation(),ie.hide(),Kt.focus())}}Tt.on(document,mp,so,ps.dataApiKeydownHandler),Tt.on(document,mp,Yi,ps.dataApiKeydownHandler),Tt.on(document,ga,ps.clearMenus),Tt.on(document,eE,ps.clearMenus),Tt.on(document,ga,so,function(X){X.preventDefault(),ps.getOrCreateInstance(this).toggle()}),Et(ps);const eu="backdrop",nu="show",iu=`mousedown.bs.${eu}`,Tp={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Fo={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class su extends Yt{constructor(y){super(),this._config=this._getConfig(y),this._isAppended=!1,this._element=null}static get Default(){return Tp}static get DefaultType(){return Fo}static get NAME(){return eu}show(y){if(!this._config.isVisible)return void jt(y);this._append();const k=this._getElement();this._config.isAnimated&&vt(k),k.classList.add(nu),this._emulateAnimation(()=>{jt(y)})}hide(y){this._config.isVisible?(this._getElement().classList.remove(nu),this._emulateAnimation(()=>{this.dispose(),jt(y)})):jt(y)}dispose(){this._isAppended&&(Tt.off(this._element,iu),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const y=document.createElement("div");y.className=this._config.className,this._config.isAnimated&&y.classList.add("fade"),this._element=y}return this._element}_configAfterMerge(y){return y.rootElement=j(y.rootElement),y}_append(){if(this._isAppended)return;const y=this._getElement();this._config.rootElement.append(y),Tt.on(y,iu,()=>{jt(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(y){re(y,this._getElement(),this._config.isAnimated)}}const vd=".bs.focustrap",sE=`focusin${vd}`,Ta=`keydown.tab${vd}`,ru="backward",rE={autofocus:!0,trapElement:null},oE={autofocus:"boolean",trapElement:"element"};class Sp extends Yt{constructor(y){super(),this._config=this._getConfig(y),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return rE}static get DefaultType(){return oE}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Tt.off(document,vd),Tt.on(document,sE,y=>this._handleFocusin(y)),Tt.on(document,Ta,y=>this._handleKeydown(y)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Tt.off(document,vd))}_handleFocusin(y){const{trapElement:k}=this._config;if(y.target===document||y.target===k||k.contains(y.target))return;const J=xt.focusableChildren(k);J.length===0?k.focus():this._lastTabNavDirection===ru?J[J.length-1].focus():J[0].focus()}_handleKeydown(y){y.key==="Tab"&&(this._lastTabNavDirection=y.shiftKey?ru:"forward")}}const vp=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Sa=".sticky-top",yd="padding-right",Bo="margin-right";class ou{constructor(){this._element=document.body}getWidth(){const y=document.documentElement.clientWidth;return Math.abs(window.innerWidth-y)}hide(){const y=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,yd,k=>k+y),this._setElementAttributes(vp,yd,k=>k+y),this._setElementAttributes(Sa,Bo,k=>k-y)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,yd),this._resetElementAttributes(vp,yd),this._resetElementAttributes(Sa,Bo)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(y,k,J){const St=this.getWidth();this._applyManipulationCallback(y,Kt=>{if(Kt!==this._element&&window.innerWidth>Kt.clientWidth+St)return;this._saveInitialAttribute(Kt,k);const ie=window.getComputedStyle(Kt).getPropertyValue(k);Kt.style.setProperty(k,`${J(Number.parseFloat(ie))}px`)})}_saveInitialAttribute(y,k){const J=y.style.getPropertyValue(k);J&&ft.setDataAttribute(y,k,J)}_resetElementAttributes(y,k){this._applyManipulationCallback(y,J=>{const St=ft.getDataAttribute(J,k);St!==null?(ft.removeDataAttribute(J,k),J.style.setProperty(k,St)):J.style.removeProperty(k)})}_applyManipulationCallback(y,k){if(P(y))k(y);else for(const J of xt.find(y,this._element))k(J)}}const As=".bs.modal",aE=`hide${As}`,ws=`hidePrevented${As}`,yp=`hidden${As}`,Cp=`show${As}`,au=`shown${As}`,cu=`resize${As}`,du=`click.dismiss${As}`,lu=`mousedown.dismiss${As}`,cE=`keydown.dismiss${As}`,Rp=`click${As}.data-api`,uu="modal-open",bp="show",hu="modal-static",Ip={backdrop:!0,focus:!0,keyboard:!0},pu={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class ro extends Ut{constructor(y,k){super(y,k),this._dialog=xt.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new ou,this._addEventListeners()}static get Default(){return Ip}static get DefaultType(){return pu}static get NAME(){return"modal"}toggle(y){return this._isShown?this.hide():this.show(y)}show(y){this._isShown||this._isTransitioning||Tt.trigger(this._element,Cp,{relatedTarget:y}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(uu),this._adjustDialog(),this._backdrop.show(()=>this._showElement(y)))}hide(){this._isShown&&!this._isTransitioning&&(Tt.trigger(this._element,aE).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(bp),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){Tt.off(window,As),Tt.off(this._dialog,As),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new su({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Sp({trapElement:this._element})}_showElement(y){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const k=xt.findOne(".modal-body",this._dialog);k&&(k.scrollTop=0),vt(this._element),this._element.classList.add(bp),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Tt.trigger(this._element,au,{relatedTarget:y})},this._dialog,this._isAnimated())}_addEventListeners(){Tt.on(this._element,cE,y=>{y.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),Tt.on(window,cu,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Tt.on(this._element,lu,y=>{Tt.one(this._element,du,k=>{this._element===y.target&&this._element===k.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(uu),this._resetAdjustments(),this._scrollBar.reset(),Tt.trigger(this._element,yp)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(Tt.trigger(this._element,ws).defaultPrevented)return;const y=this._element.scrollHeight>document.documentElement.clientHeight,k=this._element.style.overflowY;k==="hidden"||this._element.classList.contains(hu)||(y||(this._element.style.overflowY="hidden"),this._element.classList.add(hu),this._queueCallback(()=>{this._element.classList.remove(hu),this._queueCallback(()=>{this._element.style.overflowY=k},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const y=this._element.scrollHeight>document.documentElement.clientHeight,k=this._scrollBar.getWidth(),J=k>0;if(J&&!y){const St=Bt()?"paddingLeft":"paddingRight";this._element.style[St]=`${k}px`}if(!J&&y){const St=Bt()?"paddingRight":"paddingLeft";this._element.style[St]=`${k}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(y,k){return this.each(function(){const J=ro.getOrCreateInstance(this,y);if(typeof y=="string"){if(J[y]===void 0)throw new TypeError(`No method named "${y}"`);J[y](k)}})}}Tt.on(document,Rp,'[data-bs-toggle="modal"]',function(X){const y=xt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&X.preventDefault(),Tt.one(y,Cp,J=>{J.defaultPrevented||Tt.one(y,yp,()=>{q(this)&&this.focus()})});const k=xt.findOne(".modal.show");k&&ro.getInstance(k).hide(),ro.getOrCreateInstance(y).toggle(this)}),H(ro),Et(ro);const is=".bs.offcanvas",Ap=".data-api",dE=`load${is}${Ap}`,oo="show",wp="showing",Op="hiding",Li=".offcanvas.show",lE=`show${is}`,uE=`shown${is}`,hE=`hide${is}`,Np=`hidePrevented${is}`,Cd=`hidden${is}`,pE=`resize${is}`,Dp=`click${is}${Ap}`,fE=`keydown.dismiss${is}`,_E={backdrop:!0,keyboard:!0,scroll:!1},mE={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class ss extends Ut{constructor(y,k){super(y,k),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return _E}static get DefaultType(){return mE}static get NAME(){return"offcanvas"}toggle(y){return this._isShown?this.hide():this.show(y)}show(y){this._isShown||Tt.trigger(this._element,lE,{relatedTarget:y}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new ou().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(wp),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(oo),this._element.classList.remove(wp),Tt.trigger(this._element,uE,{relatedTarget:y})},this._element,!0))}hide(){this._isShown&&(Tt.trigger(this._element,hE).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Op),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(oo,Op),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new ou().reset(),Tt.trigger(this._element,Cd)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const y=!!this._config.backdrop;return new su({className:"offcanvas-backdrop",isVisible:y,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:y?()=>{this._config.backdrop!=="static"?this.hide():Tt.trigger(this._element,Np)}:null})}_initializeFocusTrap(){return new Sp({trapElement:this._element})}_addEventListeners(){Tt.on(this._element,fE,y=>{y.key==="Escape"&&(this._config.keyboard?this.hide():Tt.trigger(this._element,Np))})}static jQueryInterface(y){return this.each(function(){const k=ss.getOrCreateInstance(this,y);if(typeof y=="string"){if(k[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);k[y](this)}})}}Tt.on(document,Dp,'[data-bs-toggle="offcanvas"]',function(X){const y=xt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&X.preventDefault(),tt(this))return;Tt.one(y,Cd,()=>{q(this)&&this.focus()});const k=xt.findOne(Li);k&&k!==y&&ss.getInstance(k).hide(),ss.getOrCreateInstance(y).toggle(this)}),Tt.on(window,dE,()=>{for(const X of xt.find(Li))ss.getOrCreateInstance(X).show()}),Tt.on(window,pE,()=>{for(const X of xt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(X).position!=="fixed"&&ss.getOrCreateInstance(X).hide()}),H(ss),Et(ss);const Rd={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},EE=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Bn=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,gE=(X,y)=>{const k=X.nodeName.toLowerCase();return y.includes(k)?!EE.has(k)||!!Bn.test(X.nodeValue):y.filter(J=>J instanceof RegExp).some(J=>J.test(k))},Pp={allowList:Rd,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Lp={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},TE={entry:"(string|element|function|null)",selector:"(string|element)"};class SE extends Yt{constructor(y){super(),this._config=this._getConfig(y)}static get Default(){return Pp}static get DefaultType(){return Lp}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(y=>this._resolvePossibleFunction(y)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(y){return this._checkContent(y),this._config.content={...this._config.content,...y},this}toHtml(){const y=document.createElement("div");y.innerHTML=this._maybeSanitize(this._config.template);for(const[St,Kt]of Object.entries(this._config.content))this._setContent(y,Kt,St);const k=y.children[0],J=this._resolvePossibleFunction(this._config.extraClass);return J&&k.classList.add(...J.split(" ")),k}_typeCheckConfig(y){super._typeCheckConfig(y),this._checkContent(y.content)}_checkContent(y){for(const[k,J]of Object.entries(y))super._typeCheckConfig({selector:k,entry:J},TE)}_setContent(y,k,J){const St=xt.findOne(J,y);St&&((k=this._resolvePossibleFunction(k))?P(k)?this._putElementInTemplate(j(k),St):this._config.html?St.innerHTML=this._maybeSanitize(k):St.textContent=k:St.remove())}_maybeSanitize(y){return this._config.sanitize?function(k,J,St){if(!k.length)return k;if(St&&typeof St=="function")return St(k);const Kt=new window.DOMParser().parseFromString(k,"text/html"),ie=[].concat(...Kt.body.querySelectorAll("*"));for(const $e of ie){const Hn=$e.nodeName.toLowerCase();if(!Object.keys(J).includes(Hn)){$e.remove();continue}const zi=[].concat(...$e.attributes),fs=[].concat(J["*"]||[],J[Hn]||[]);for(const Js of zi)gE(Js,fs)||$e.removeAttribute(Js.nodeName)}return Kt.body.innerHTML}(y,this._config.allowList,this._config.sanitizeFn):y}_resolvePossibleFunction(y){return jt(y,[this])}_putElementInTemplate(y,k){if(this._config.html)return k.innerHTML="",void k.append(y);k.textContent=y.textContent}}const vE=new Set(["sanitize","allowList","sanitizeFn"]),fu="fade",bd="show",kp=".modal",Ec="hide.bs.modal",va="hover",gc="focus",yE={AUTO:"auto",TOP:"top",RIGHT:Bt()?"left":"right",BOTTOM:"bottom",LEFT:Bt()?"right":"left"},_u={allowList:Rd,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},CE={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class ao extends Ut{constructor(y,k){if(E===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(y,k),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return _u}static get DefaultType(){return CE}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),Tt.off(this._element.closest(kp),Ec,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const y=Tt.trigger(this._element,this.constructor.eventName("show")),k=(at(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(y.defaultPrevented||!k)return;this._disposePopper();const J=this._getTipElement();this._element.setAttribute("aria-describedby",J.getAttribute("id"));const{container:St}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(St.append(J),Tt.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(J),J.classList.add(bd),"ontouchstart"in document.documentElement)for(const Kt of[].concat(...document.body.children))Tt.on(Kt,"mouseover",lt);this._queueCallback(()=>{Tt.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!Tt.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(bd),"ontouchstart"in document.documentElement)for(const y of[].concat(...document.body.children))Tt.off(y,"mouseover",lt);this._activeTrigger.click=!1,this._activeTrigger[gc]=!1,this._activeTrigger[va]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Tt.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(y){const k=this._getTemplateFactory(y).toHtml();if(!k)return null;k.classList.remove(fu,bd),k.classList.add(`bs-${this.constructor.NAME}-auto`);const J=(St=>{do St+=Math.floor(1e6*Math.random());while(document.getElementById(St));return St})(this.constructor.NAME).toString();return k.setAttribute("id",J),this._isAnimated()&&k.classList.add(fu),k}setContent(y){this._newContent=y,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(y){return this._templateFactory?this._templateFactory.changeContent(y):this._templateFactory=new SE({...this._config,content:y,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(y){return this.constructor.getOrCreateInstance(y.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(fu)}_isShown(){return this.tip&&this.tip.classList.contains(bd)}_createPopper(y){const k=jt(this._config.placement,[this,y,this._element]),J=yE[k.toUpperCase()];return E.createPopper(this._element,y,this._getPopperConfig(J))}_getOffset(){const{offset:y}=this._config;return typeof y=="string"?y.split(",").map(k=>Number.parseInt(k,10)):typeof y=="function"?k=>y(k,this._element):y}_resolvePossibleFunction(y){return jt(y,[this._element])}_getPopperConfig(y){const k={placement:y,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:J=>{this._getTipElement().setAttribute("data-popper-placement",J.state.placement)}}]};return{...k,...jt(this._config.popperConfig,[k])}}_setListeners(){const y=this._config.trigger.split(" ");for(const k of y)if(k==="click")Tt.on(this._element,this.constructor.eventName("click"),this._config.selector,J=>{this._initializeOnDelegatedTarget(J).toggle()});else if(k!=="manual"){const J=k===va?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),St=k===va?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");Tt.on(this._element,J,this._config.selector,Kt=>{const ie=this._initializeOnDelegatedTarget(Kt);ie._activeTrigger[Kt.type==="focusin"?gc:va]=!0,ie._enter()}),Tt.on(this._element,St,this._config.selector,Kt=>{const ie=this._initializeOnDelegatedTarget(Kt);ie._activeTrigger[Kt.type==="focusout"?gc:va]=ie._element.contains(Kt.relatedTarget),ie._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Tt.on(this._element.closest(kp),Ec,this._hideModalHandler)}_fixTitle(){const y=this._element.getAttribute("title");y&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",y),this._element.setAttribute("data-bs-original-title",y),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(y,k){clearTimeout(this._timeout),this._timeout=setTimeout(y,k)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(y){const k=ft.getDataAttributes(this._element);for(const J of Object.keys(k))vE.has(J)&&delete k[J];return y={...k,...typeof y=="object"&&y?y:{}},y=this._mergeConfigObj(y),y=this._configAfterMerge(y),this._typeCheckConfig(y),y}_configAfterMerge(y){return y.container=y.container===!1?document.body:j(y.container),typeof y.delay=="number"&&(y.delay={show:y.delay,hide:y.delay}),typeof y.title=="number"&&(y.title=y.title.toString()),typeof y.content=="number"&&(y.content=y.content.toString()),y}_getDelegateConfig(){const y={};for(const[k,J]of Object.entries(this._config))this.constructor.Default[k]!==J&&(y[k]=J);return y.selector=!1,y.trigger="manual",y}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(y){return this.each(function(){const k=ao.getOrCreateInstance(this,y);if(typeof y=="string"){if(k[y]===void 0)throw new TypeError(`No method named "${y}"`);k[y]()}})}}Et(ao);const RE={...ao.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},bE={...ao.DefaultType,content:"(null|string|element|function)"};class Id extends ao{static get Default(){return RE}static get DefaultType(){return bE}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(y){return this.each(function(){const k=Id.getOrCreateInstance(this,y);if(typeof y=="string"){if(k[y]===void 0)throw new TypeError(`No method named "${y}"`);k[y]()}})}}Et(Id);const mu=".bs.scrollspy",IE=`activate${mu}`,Mp=`click${mu}`,AE=`load${mu}.data-api`,ya="active",Ad="[href]",Up=".nav-link",wE=`${Up}, .nav-item > ${Up}, .list-group-item`,OE={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},Tc={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Sc extends Ut{constructor(y,k){super(y,k),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return OE}static get DefaultType(){return Tc}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const y of this._observableSections.values())this._observer.observe(y)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(y){return y.target=j(y.target)||document.body,y.rootMargin=y.offset?`${y.offset}px 0px -30%`:y.rootMargin,typeof y.threshold=="string"&&(y.threshold=y.threshold.split(",").map(k=>Number.parseFloat(k))),y}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Tt.off(this._config.target,Mp),Tt.on(this._config.target,Mp,Ad,y=>{const k=this._observableSections.get(y.target.hash);if(k){y.preventDefault();const J=this._rootElement||window,St=k.offsetTop-this._element.offsetTop;if(J.scrollTo)return void J.scrollTo({top:St,behavior:"smooth"});J.scrollTop=St}}))}_getNewObserver(){const y={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(k=>this._observerCallback(k),y)}_observerCallback(y){const k=ie=>this._targetLinks.get(`#${ie.target.id}`),J=ie=>{this._previousScrollData.visibleEntryTop=ie.target.offsetTop,this._process(k(ie))},St=(this._rootElement||document.documentElement).scrollTop,Kt=St>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=St;for(const ie of y){if(!ie.isIntersecting){this._activeTarget=null,this._clearActiveClass(k(ie));continue}const $e=ie.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(Kt&&$e){if(J(ie),!St)return}else Kt||$e||J(ie)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const y=xt.find(Ad,this._config.target);for(const k of y){if(!k.hash||tt(k))continue;const J=xt.findOne(decodeURI(k.hash),this._element);q(J)&&(this._targetLinks.set(decodeURI(k.hash),k),this._observableSections.set(k.hash,J))}}_process(y){this._activeTarget!==y&&(this._clearActiveClass(this._config.target),this._activeTarget=y,y.classList.add(ya),this._activateParents(y),Tt.trigger(this._element,IE,{relatedTarget:y}))}_activateParents(y){if(y.classList.contains("dropdown-item"))xt.findOne(".dropdown-toggle",y.closest(".dropdown")).classList.add(ya);else for(const k of xt.parents(y,".nav, .list-group"))for(const J of xt.prev(k,wE))J.classList.add(ya)}_clearActiveClass(y){y.classList.remove(ya);const k=xt.find(`${Ad}.${ya}`,y);for(const J of k)J.classList.remove(ya)}static jQueryInterface(y){return this.each(function(){const k=Sc.getOrCreateInstance(this,y);if(typeof y=="string"){if(k[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);k[y]()}})}}Tt.on(window,AE,()=>{for(const X of xt.find('[data-bs-spy="scroll"]'))Sc.getOrCreateInstance(X)}),Et(Sc);const jo=".bs.tab",NE=`hide${jo}`,DE=`hidden${jo}`,xp=`show${jo}`,PE=`shown${jo}`,LE=`click${jo}`,kE=`keydown${jo}`,vc=`load${jo}`,Os="ArrowLeft",Eu="ArrowRight",ME="ArrowUp",Vp="ArrowDown",gu="Home",Ns="End",Go="active",Fp="fade",Tu="show",yc=".dropdown-toggle",wd=`:not(${yc})`,Bp='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Cc=`.nav-link${wd}, .list-group-item${wd}, [role="tab"]${wd}, ${Bp}`,UE=`.${Go}[data-bs-toggle="tab"], .${Go}[data-bs-toggle="pill"], .${Go}[data-bs-toggle="list"]`;class xr extends Ut{constructor(y){super(y),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Tt.on(this._element,kE,k=>this._keydown(k)))}static get NAME(){return"tab"}show(){const y=this._element;if(this._elemIsActive(y))return;const k=this._getActiveElem(),J=k?Tt.trigger(k,NE,{relatedTarget:y}):null;Tt.trigger(y,xp,{relatedTarget:k}).defaultPrevented||J&&J.defaultPrevented||(this._deactivate(k,y),this._activate(y,k))}_activate(y,k){y&&(y.classList.add(Go),this._activate(xt.getElementFromSelector(y)),this._queueCallback(()=>{y.getAttribute("role")==="tab"?(y.removeAttribute("tabindex"),y.setAttribute("aria-selected",!0),this._toggleDropDown(y,!0),Tt.trigger(y,PE,{relatedTarget:k})):y.classList.add(Tu)},y,y.classList.contains(Fp)))}_deactivate(y,k){y&&(y.classList.remove(Go),y.blur(),this._deactivate(xt.getElementFromSelector(y)),this._queueCallback(()=>{y.getAttribute("role")==="tab"?(y.setAttribute("aria-selected",!1),y.setAttribute("tabindex","-1"),this._toggleDropDown(y,!1),Tt.trigger(y,DE,{relatedTarget:k})):y.classList.remove(Tu)},y,y.classList.contains(Fp)))}_keydown(y){if(![Os,Eu,ME,Vp,gu,Ns].includes(y.key))return;y.stopPropagation(),y.preventDefault();const k=this._getChildren().filter(St=>!tt(St));let J;if([gu,Ns].includes(y.key))J=k[y.key===gu?0:k.length-1];else{const St=[Eu,Vp].includes(y.key);J=pe(k,y.target,St,!0)}J&&(J.focus({preventScroll:!0}),xr.getOrCreateInstance(J).show())}_getChildren(){return xt.find(Cc,this._parent)}_getActiveElem(){return this._getChildren().find(y=>this._elemIsActive(y))||null}_setInitialAttributes(y,k){this._setAttributeIfNotExists(y,"role","tablist");for(const J of k)this._setInitialAttributesOnChild(J)}_setInitialAttributesOnChild(y){y=this._getInnerElement(y);const k=this._elemIsActive(y),J=this._getOuterElement(y);y.setAttribute("aria-selected",k),J!==y&&this._setAttributeIfNotExists(J,"role","presentation"),k||y.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(y,"role","tab"),this._setInitialAttributesOnTargetPanel(y)}_setInitialAttributesOnTargetPanel(y){const k=xt.getElementFromSelector(y);k&&(this._setAttributeIfNotExists(k,"role","tabpanel"),y.id&&this._setAttributeIfNotExists(k,"aria-labelledby",`${y.id}`))}_toggleDropDown(y,k){const J=this._getOuterElement(y);if(!J.classList.contains("dropdown"))return;const St=(Kt,ie)=>{const $e=xt.findOne(Kt,J);$e&&$e.classList.toggle(ie,k)};St(yc,Go),St(".dropdown-menu",Tu),J.setAttribute("aria-expanded",k)}_setAttributeIfNotExists(y,k,J){y.hasAttribute(k)||y.setAttribute(k,J)}_elemIsActive(y){return y.classList.contains(Go)}_getInnerElement(y){return y.matches(Cc)?y:xt.findOne(Cc,y)}_getOuterElement(y){return y.closest(".nav-item, .list-group-item")||y}static jQueryInterface(y){return this.each(function(){const k=xr.getOrCreateInstance(this);if(typeof y=="string"){if(k[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);k[y]()}})}}Tt.on(document,LE,Bp,function(X){["A","AREA"].includes(this.tagName)&&X.preventDefault(),tt(this)||xr.getOrCreateInstance(this).show()}),Tt.on(window,vc,()=>{for(const X of xt.find(UE))xr.getOrCreateInstance(X)}),Et(xr);const Sr=".bs.toast",Su=`mouseover${Sr}`,xE=`mouseout${Sr}`,VE=`focusin${Sr}`,co=`focusout${Sr}`,Od=`hide${Sr}`,FE=`hidden${Sr}`,BE=`show${Sr}`,jE=`shown${Sr}`,jp="hide",Nd="show",Vr="showing",GE={animation:"boolean",autohide:"boolean",delay:"number"},Ca={animation:!0,autohide:!0,delay:5e3};class Ra extends Ut{constructor(y,k){super(y,k),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Ca}static get DefaultType(){return GE}static get NAME(){return"toast"}show(){Tt.trigger(this._element,BE).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(jp),vt(this._element),this._element.classList.add(Nd,Vr),this._queueCallback(()=>{this._element.classList.remove(Vr),Tt.trigger(this._element,jE),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(Tt.trigger(this._element,Od).defaultPrevented||(this._element.classList.add(Vr),this._queueCallback(()=>{this._element.classList.add(jp),this._element.classList.remove(Vr,Nd),Tt.trigger(this._element,FE)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Nd),super.dispose()}isShown(){return this._element.classList.contains(Nd)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(y,k){switch(y.type){case"mouseover":case"mouseout":this._hasMouseInteraction=k;break;case"focusin":case"focusout":this._hasKeyboardInteraction=k}if(k)return void this._clearTimeout();const J=y.relatedTarget;this._element===J||this._element.contains(J)||this._maybeScheduleHide()}_setListeners(){Tt.on(this._element,Su,y=>this._onInteraction(y,!0)),Tt.on(this._element,xE,y=>this._onInteraction(y,!1)),Tt.on(this._element,VE,y=>this._onInteraction(y,!0)),Tt.on(this._element,co,y=>this._onInteraction(y,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(y){return this.each(function(){const k=Ra.getOrCreateInstance(this,y);if(typeof y=="string"){if(k[y]===void 0)throw new TypeError(`No method named "${y}"`);k[y](this)}})}}return H(Ra),Et(Ra),{Alert:gt,Button:zt,Carousel:to,Collapse:Ur,Dropdown:ps,Modal:ro,Offcanvas:ss,Popover:Id,ScrollSpy:Sc,Tab:xr,Toast:Ra,Tooltip:ao}})})(tH);const rp=(o,d)=>{const p=o.__vccOpts||o;for(const[_,E]of d)p[_]=E;return p},HH={};function KH(o,d){const p=ld("router-view");return Je(),Jr(p)}const qH=rp(HH,[["render",KH]]);/*!
  * vue-router v4.2.5
  * (c) 2023 Eduardo San Martin Morote
  * @license MIT
  */const Al=typeof window<"u";function YH(o){return o.__esModule||o[Symbol.toStringTag]==="Module"}const bn=Object.assign;function vv(o,d){const p={};for(const _ in d){const E=d[_];p[_]=Qr(E)?E.map(o):o(E)}return p}const xh=()=>{},Qr=Array.isArray,zH=/\/$/,JH=o=>o.replace(zH,"");function yv(o,d,p="/"){let _,E={},T="",R="";const N=d.indexOf("#");let D=d.indexOf("?");return N<D&&N>=0&&(D=-1),D>-1&&(_=d.slice(0,D),T=d.slice(D+1,N>-1?N:d.length),E=o(T)),N>-1&&(_=_||d.slice(0,N),R=d.slice(N,d.length)),_=ZH(_??d,p),{fullPath:_+(T&&"?")+T+R,path:_,query:E,hash:R}}function XH(o,d){const p=d.query?o(d.query):"";return d.path+(p&&"?")+p+(d.hash||"")}function ED(o,d){return!d||!o.toLowerCase().startsWith(d.toLowerCase())?o:o.slice(d.length)||"/"}function $H(o,d,p){const _=d.matched.length-1,E=p.matched.length-1;return _>-1&&_===E&&Vl(d.matched[_],p.matched[E])&&HL(d.params,p.params)&&o(d.query)===o(p.query)&&d.hash===p.hash}function Vl(o,d){return(o.aliasOf||o)===(d.aliasOf||d)}function HL(o,d){if(Object.keys(o).length!==Object.keys(d).length)return!1;for(const p in o)if(!QH(o[p],d[p]))return!1;return!0}function QH(o,d){return Qr(o)?gD(o,d):Qr(d)?gD(d,o):o===d}function gD(o,d){return Qr(d)?o.length===d.length&&o.every((p,_)=>p===d[_]):o.length===1&&o[0]===d}function ZH(o,d){if(o.startsWith("/"))return o;if(!o)return d;const p=d.split("/"),_=o.split("/"),E=_[_.length-1];(E===".."||E===".")&&_.push("");let T=p.length-1,R,N;for(R=0;R<_.length;R++)if(N=_[R],N!==".")if(N==="..")T>1&&T--;else break;return p.slice(0,T).join("/")+"/"+_.slice(R-(R===_.length?1:0)).join("/")}var Xh;(function(o){o.pop="pop",o.push="push"})(Xh||(Xh={}));var Vh;(function(o){o.back="back",o.forward="forward",o.unknown=""})(Vh||(Vh={}));function tK(o){if(!o)if(Al){const d=document.querySelector("base");o=d&&d.getAttribute("href")||"/",o=o.replace(/^\w+:\/\/[^\/]+/,"")}else o="/";return o[0]!=="/"&&o[0]!=="#"&&(o="/"+o),JH(o)}const eK=/^[^#]+#/;function nK(o,d){return o.replace(eK,"#")+d}function iK(o,d){const p=document.documentElement.getBoundingClientRect(),_=o.getBoundingClientRect();return{behavior:d.behavior,left:_.left-p.left-(d.left||0),top:_.top-p.top-(d.top||0)}}const Bm=()=>({left:window.pageXOffset,top:window.pageYOffset});function sK(o){let d;if("el"in o){const p=o.el,_=typeof p=="string"&&p.startsWith("#"),E=typeof p=="string"?_?document.getElementById(p.slice(1)):document.querySelector(p):p;if(!E)return;d=iK(E,o)}else d=o;"scrollBehavior"in document.documentElement.style?window.scrollTo(d):window.scrollTo(d.left!=null?d.left:window.pageXOffset,d.top!=null?d.top:window.pageYOffset)}function TD(o,d){return(history.state?history.state.position-d:-1)+o}const zv=new Map;function rK(o,d){zv.set(o,d)}function oK(o){const d=zv.get(o);return zv.delete(o),d}let aK=()=>location.protocol+"//"+location.host;function KL(o,d){const{pathname:p,search:_,hash:E}=d,T=o.indexOf("#");if(T>-1){let N=E.includes(o.slice(T))?o.slice(T).length:1,D=E.slice(N);return D[0]!=="/"&&(D="/"+D),ED(D,"")}return ED(p,o)+_+E}function cK(o,d,p,_){let E=[],T=[],R=null;const N=({state:q})=>{const tt=KL(o,location),at=p.value,lt=d.value;let vt=0;if(q){if(p.value=tt,d.value=q,R&&R===at){R=null;return}vt=lt?q.position-lt.position:0}else _(tt);E.forEach(wt=>{wt(p.value,at,{delta:vt,type:Xh.pop,direction:vt?vt>0?Vh.forward:Vh.back:Vh.unknown})})};function D(){R=p.value}function M(q){E.push(q);const tt=()=>{const at=E.indexOf(q);at>-1&&E.splice(at,1)};return T.push(tt),tt}function P(){const{history:q}=window;q.state&&q.replaceState(bn({},q.state,{scroll:Bm()}),"")}function j(){for(const q of T)q();T=[],window.removeEventListener("popstate",N),window.removeEventListener("beforeunload",P)}return window.addEventListener("popstate",N),window.addEventListener("beforeunload",P,{passive:!0}),{pauseListeners:D,listen:M,destroy:j}}function SD(o,d,p,_=!1,E=!1){return{back:o,current:d,forward:p,replaced:_,position:window.history.length,scroll:E?Bm():null}}function dK(o){const{history:d,location:p}=window,_={value:KL(o,p)},E={value:d.state};E.value||T(_.value,{back:null,current:_.value,forward:null,position:d.length-1,replaced:!0,scroll:null},!0);function T(D,M,P){const j=o.indexOf("#"),q=j>-1?(p.host&&document.querySelector("base")?o:o.slice(j))+D:aK()+o+D;try{d[P?"replaceState":"pushState"](M,"",q),E.value=M}catch(tt){console.error(tt),p[P?"replace":"assign"](q)}}function R(D,M){const P=bn({},d.state,SD(E.value.back,D,E.value.forward,!0),M,{position:E.value.position});T(D,P,!0),_.value=D}function N(D,M){const P=bn({},E.value,d.state,{forward:D,scroll:Bm()});T(P.current,P,!0);const j=bn({},SD(_.value,D,null),{position:P.position+1},M);T(D,j,!1),_.value=D}return{location:_,state:E,push:N,replace:R}}function lK(o){o=tK(o);const d=dK(o),p=cK(o,d.state,d.location,d.replace);function _(T,R=!0){R||p.pauseListeners(),history.go(T)}const E=bn({location:"",base:o,go:_,createHref:nK.bind(null,o)},d,p);return Object.defineProperty(E,"location",{enumerable:!0,get:()=>d.location.value}),Object.defineProperty(E,"state",{enumerable:!0,get:()=>d.state.value}),E}function uK(o){return typeof o=="string"||o&&typeof o=="object"}function qL(o){return typeof o=="string"||typeof o=="symbol"}const nc={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},YL=Symbol("");var vD;(function(o){o[o.aborted=4]="aborted",o[o.cancelled=8]="cancelled",o[o.duplicated=16]="duplicated"})(vD||(vD={}));function Fl(o,d){return bn(new Error,{type:o,[YL]:!0},d)}function oa(o,d){return o instanceof Error&&YL in o&&(d==null||!!(o.type&d))}const yD="[^/]+?",hK={sensitive:!1,strict:!1,start:!0,end:!0},pK=/[.+*?^${}()[\]/\\]/g;function fK(o,d){const p=bn({},hK,d),_=[];let E=p.start?"^":"";const T=[];for(const M of o){const P=M.length?[]:[90];p.strict&&!M.length&&(E+="/");for(let j=0;j<M.length;j++){const q=M[j];let tt=40+(p.sensitive?.25:0);if(q.type===0)j||(E+="/"),E+=q.value.replace(pK,"\\$&"),tt+=40;else if(q.type===1){const{value:at,repeatable:lt,optional:vt,regexp:wt}=q;T.push({name:at,repeatable:lt,optional:vt});const It=wt||yD;if(It!==yD){tt+=10;try{new RegExp(`(${It})`)}catch(Et){throw new Error(`Invalid custom RegExp for param "${at}" (${It}): `+Et.message)}}let Bt=lt?`((?:${It})(?:/(?:${It}))*)`:`(${It})`;j||(Bt=vt&&M.length<2?`(?:/${Bt})`:"/"+Bt),vt&&(Bt+="?"),E+=Bt,tt+=20,vt&&(tt+=-8),lt&&(tt+=-20),It===".*"&&(tt+=-50)}P.push(tt)}_.push(P)}if(p.strict&&p.end){const M=_.length-1;_[M][_[M].length-1]+=.7000000000000001}p.strict||(E+="/?"),p.end?E+="$":p.strict&&(E+="(?:/|$)");const R=new RegExp(E,p.sensitive?"":"i");function N(M){const P=M.match(R),j={};if(!P)return null;for(let q=1;q<P.length;q++){const tt=P[q]||"",at=T[q-1];j[at.name]=tt&&at.repeatable?tt.split("/"):tt}return j}function D(M){let P="",j=!1;for(const q of o){(!j||!P.endsWith("/"))&&(P+="/"),j=!1;for(const tt of q)if(tt.type===0)P+=tt.value;else if(tt.type===1){const{value:at,repeatable:lt,optional:vt}=tt,wt=at in M?M[at]:"";if(Qr(wt)&&!lt)throw new Error(`Provided param "${at}" is an array but it is not repeatable (* or + modifiers)`);const It=Qr(wt)?wt.join("/"):wt;if(!It)if(vt)q.length<2&&(P.endsWith("/")?P=P.slice(0,-1):j=!0);else throw new Error(`Missing required param "${at}"`);P+=It}}return P||"/"}return{re:R,score:_,keys:T,parse:N,stringify:D}}function _K(o,d){let p=0;for(;p<o.length&&p<d.length;){const _=d[p]-o[p];if(_)return _;p++}return o.length<d.length?o.length===1&&o[0]===40+40?-1:1:o.length>d.length?d.length===1&&d[0]===40+40?1:-1:0}function mK(o,d){let p=0;const _=o.score,E=d.score;for(;p<_.length&&p<E.length;){const T=_K(_[p],E[p]);if(T)return T;p++}if(Math.abs(E.length-_.length)===1){if(CD(_))return 1;if(CD(E))return-1}return E.length-_.length}function CD(o){const d=o[o.length-1];return o.length>0&&d[d.length-1]<0}const EK={type:0,value:""},gK=/[a-zA-Z0-9_]/;function TK(o){if(!o)return[[]];if(o==="/")return[[EK]];if(!o.startsWith("/"))throw new Error(`Invalid path "${o}"`);function d(tt){throw new Error(`ERR (${p})/"${M}": ${tt}`)}let p=0,_=p;const E=[];let T;function R(){T&&E.push(T),T=[]}let N=0,D,M="",P="";function j(){M&&(p===0?T.push({type:0,value:M}):p===1||p===2||p===3?(T.length>1&&(D==="*"||D==="+")&&d(`A repeatable param (${M}) must be alone in its segment. eg: '/:ids+.`),T.push({type:1,value:M,regexp:P,repeatable:D==="*"||D==="+",optional:D==="*"||D==="?"})):d("Invalid state to consume buffer"),M="")}function q(){M+=D}for(;N<o.length;){if(D=o[N++],D==="\\"&&p!==2){_=p,p=4;continue}switch(p){case 0:D==="/"?(M&&j(),R()):D===":"?(j(),p=1):q();break;case 4:q(),p=_;break;case 1:D==="("?p=2:gK.test(D)?q():(j(),p=0,D!=="*"&&D!=="?"&&D!=="+"&&N--);break;case 2:D===")"?P[P.length-1]=="\\"?P=P.slice(0,-1)+D:p=3:P+=D;break;case 3:j(),p=0,D!=="*"&&D!=="?"&&D!=="+"&&N--,P="";break;default:d("Unknown state");break}}return p===2&&d(`Unfinished custom RegExp for param "${M}"`),j(),R(),E}function SK(o,d,p){const _=fK(TK(o.path),p),E=bn(_,{record:o,parent:d,children:[],alias:[]});return d&&!E.record.aliasOf==!d.record.aliasOf&&d.children.push(E),E}function vK(o,d){const p=[],_=new Map;d=ID({strict:!1,end:!0,sensitive:!1},d);function E(P){return _.get(P)}function T(P,j,q){const tt=!q,at=yK(P);at.aliasOf=q&&q.record;const lt=ID(d,P),vt=[at];if("alias"in P){const Bt=typeof P.alias=="string"?[P.alias]:P.alias;for(const Et of Bt)vt.push(bn({},at,{components:q?q.record.components:at.components,path:Et,aliasOf:q?q.record:at}))}let wt,It;for(const Bt of vt){const{path:Et}=Bt;if(j&&Et[0]!=="/"){const jt=j.record.path,re=jt[jt.length-1]==="/"?"":"/";Bt.path=j.record.path+(Et&&re+Et)}if(wt=SK(Bt,j,lt),q?q.alias.push(wt):(It=It||wt,It!==wt&&It.alias.push(wt),tt&&P.name&&!bD(wt)&&R(P.name)),at.children){const jt=at.children;for(let re=0;re<jt.length;re++)T(jt[re],wt,q&&q.children[re])}q=q||wt,(wt.record.components&&Object.keys(wt.record.components).length||wt.record.name||wt.record.redirect)&&D(wt)}return It?()=>{R(It)}:xh}function R(P){if(qL(P)){const j=_.get(P);j&&(_.delete(P),p.splice(p.indexOf(j),1),j.children.forEach(R),j.alias.forEach(R))}else{const j=p.indexOf(P);j>-1&&(p.splice(j,1),P.record.name&&_.delete(P.record.name),P.children.forEach(R),P.alias.forEach(R))}}function N(){return p}function D(P){let j=0;for(;j<p.length&&mK(P,p[j])>=0&&(P.record.path!==p[j].record.path||!zL(P,p[j]));)j++;p.splice(j,0,P),P.record.name&&!bD(P)&&_.set(P.record.name,P)}function M(P,j){let q,tt={},at,lt;if("name"in P&&P.name){if(q=_.get(P.name),!q)throw Fl(1,{location:P});lt=q.record.name,tt=bn(RD(j.params,q.keys.filter(It=>!It.optional).map(It=>It.name)),P.params&&RD(P.params,q.keys.map(It=>It.name))),at=q.stringify(tt)}else if("path"in P)at=P.path,q=p.find(It=>It.re.test(at)),q&&(tt=q.parse(at),lt=q.record.name);else{if(q=j.name?_.get(j.name):p.find(It=>It.re.test(j.path)),!q)throw Fl(1,{location:P,currentLocation:j});lt=q.record.name,tt=bn({},j.params,P.params),at=q.stringify(tt)}const vt=[];let wt=q;for(;wt;)vt.unshift(wt.record),wt=wt.parent;return{name:lt,path:at,params:tt,matched:vt,meta:RK(vt)}}return o.forEach(P=>T(P)),{addRoute:T,resolve:M,removeRoute:R,getRoutes:N,getRecordMatcher:E}}function RD(o,d){const p={};for(const _ of d)_ in o&&(p[_]=o[_]);return p}function yK(o){return{path:o.path,redirect:o.redirect,name:o.name,meta:o.meta||{},aliasOf:void 0,beforeEnter:o.beforeEnter,props:CK(o),children:o.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in o?o.components||null:o.component&&{default:o.component}}}function CK(o){const d={},p=o.props||!1;if("component"in o)d.default=p;else for(const _ in o.components)d[_]=typeof p=="object"?p[_]:p;return d}function bD(o){for(;o;){if(o.record.aliasOf)return!0;o=o.parent}return!1}function RK(o){return o.reduce((d,p)=>bn(d,p.meta),{})}function ID(o,d){const p={};for(const _ in o)p[_]=_ in d?d[_]:o[_];return p}function zL(o,d){return d.children.some(p=>p===o||zL(o,p))}const JL=/#/g,bK=/&/g,IK=/\//g,AK=/=/g,wK=/\?/g,XL=/\+/g,OK=/%5B/g,NK=/%5D/g,$L=/%5E/g,DK=/%60/g,QL=/%7B/g,PK=/%7C/g,ZL=/%7D/g,LK=/%20/g;function Fy(o){return encodeURI(""+o).replace(PK,"|").replace(OK,"[").replace(NK,"]")}function kK(o){return Fy(o).replace(QL,"{").replace(ZL,"}").replace($L,"^")}function Jv(o){return Fy(o).replace(XL,"%2B").replace(LK,"+").replace(JL,"%23").replace(bK,"%26").replace(DK,"`").replace(QL,"{").replace(ZL,"}").replace($L,"^")}function MK(o){return Jv(o).replace(AK,"%3D")}function UK(o){return Fy(o).replace(JL,"%23").replace(wK,"%3F")}function xK(o){return o==null?"":UK(o).replace(IK,"%2F")}function Em(o){try{return decodeURIComponent(""+o)}catch{}return""+o}function VK(o){const d={};if(o===""||o==="?")return d;const _=(o[0]==="?"?o.slice(1):o).split("&");for(let E=0;E<_.length;++E){const T=_[E].replace(XL," "),R=T.indexOf("="),N=Em(R<0?T:T.slice(0,R)),D=R<0?null:Em(T.slice(R+1));if(N in d){let M=d[N];Qr(M)||(M=d[N]=[M]),M.push(D)}else d[N]=D}return d}function AD(o){let d="";for(let p in o){const _=o[p];if(p=MK(p),_==null){_!==void 0&&(d+=(d.length?"&":"")+p);continue}(Qr(_)?_.map(T=>T&&Jv(T)):[_&&Jv(_)]).forEach(T=>{T!==void 0&&(d+=(d.length?"&":"")+p,T!=null&&(d+="="+T))})}return d}function FK(o){const d={};for(const p in o){const _=o[p];_!==void 0&&(d[p]=Qr(_)?_.map(E=>E==null?null:""+E):_==null?_:""+_)}return d}const BK=Symbol(""),wD=Symbol(""),jm=Symbol(""),tk=Symbol(""),Xv=Symbol("");function Ch(){let o=[];function d(_){return o.push(_),()=>{const E=o.indexOf(_);E>-1&&o.splice(E,1)}}function p(){o=[]}return{add:d,list:()=>o.slice(),reset:p}}function ac(o,d,p,_,E){const T=_&&(_.enterCallbacks[E]=_.enterCallbacks[E]||[]);return()=>new Promise((R,N)=>{const D=j=>{j===!1?N(Fl(4,{from:p,to:d})):j instanceof Error?N(j):uK(j)?N(Fl(2,{from:d,to:j})):(T&&_.enterCallbacks[E]===T&&typeof j=="function"&&T.push(j),R())},M=o.call(_&&_.instances[E],d,p,D);let P=Promise.resolve(M);o.length<3&&(P=P.then(D)),P.catch(j=>N(j))})}function Cv(o,d,p,_){const E=[];for(const T of o)for(const R in T.components){let N=T.components[R];if(!(d!=="beforeRouteEnter"&&!T.instances[R]))if(jK(N)){const M=(N.__vccOpts||N)[d];M&&E.push(ac(M,p,_,T,R))}else{let D=N();E.push(()=>D.then(M=>{if(!M)return Promise.reject(new Error(`Couldn't resolve component "${R}" at "${T.path}"`));const P=YH(M)?M.default:M;T.components[R]=P;const q=(P.__vccOpts||P)[d];return q&&ac(q,p,_,T,R)()}))}}return E}function jK(o){return typeof o=="object"||"displayName"in o||"props"in o||"__vccOpts"in o}function OD(o){const d=ts(jm),p=ts(tk),_=Pr(()=>d.resolve(Zi(o.to))),E=Pr(()=>{const{matched:D}=_.value,{length:M}=D,P=D[M-1],j=p.matched;if(!P||!j.length)return-1;const q=j.findIndex(Vl.bind(null,P));if(q>-1)return q;const tt=ND(D[M-2]);return M>1&&ND(P)===tt&&j[j.length-1].path!==tt?j.findIndex(Vl.bind(null,D[M-2])):q}),T=Pr(()=>E.value>-1&&KK(p.params,_.value.params)),R=Pr(()=>E.value>-1&&E.value===p.matched.length-1&&HL(p.params,_.value.params));function N(D={}){return HK(D)?d[Zi(o.replace)?"replace":"push"](Zi(o.to)).catch(xh):Promise.resolve()}return{route:_,href:Pr(()=>_.value.href),isActive:T,isExactActive:R,navigate:N}}const GK=bs({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:OD,setup(o,{slots:d}){const p=tp(OD(o)),{options:_}=ts(jm),E=Pr(()=>({[DD(o.activeClass,_.linkActiveClass,"router-link-active")]:p.isActive,[DD(o.exactActiveClass,_.linkExactActiveClass,"router-link-exact-active")]:p.isExactActive}));return()=>{const T=d.default&&d.default(p);return o.custom?T:KP("a",{"aria-current":p.isExactActive?o.ariaCurrentValue:null,href:p.href,onClick:p.navigate,class:E.value},T)}}}),WK=GK;function HK(o){if(!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)&&!o.defaultPrevented&&!(o.button!==void 0&&o.button!==0)){if(o.currentTarget&&o.currentTarget.getAttribute){const d=o.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(d))return}return o.preventDefault&&o.preventDefault(),!0}}function KK(o,d){for(const p in d){const _=d[p],E=o[p];if(typeof _=="string"){if(_!==E)return!1}else if(!Qr(E)||E.length!==_.length||_.some((T,R)=>T!==E[R]))return!1}return!0}function ND(o){return o?o.aliasOf?o.aliasOf.path:o.path:""}const DD=(o,d,p)=>o??d??p,qK=bs({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(o,{attrs:d,slots:p}){const _=ts(Xv),E=Pr(()=>o.route||_.value),T=ts(wD,0),R=Pr(()=>{let M=Zi(T);const{matched:P}=E.value;let j;for(;(j=P[M])&&!j.components;)M++;return M}),N=Pr(()=>E.value.matched[R.value]);X_(wD,Pr(()=>R.value+1)),X_(BK,N),X_(Xv,E);const D=ze();return Oh(()=>[D.value,N.value,o.name],([M,P,j],[q,tt,at])=>{P&&(P.instances[j]=M,tt&&tt!==P&&M&&M===q&&(P.leaveGuards.size||(P.leaveGuards=tt.leaveGuards),P.updateGuards.size||(P.updateGuards=tt.updateGuards))),M&&P&&(!tt||!Vl(P,tt)||!q)&&(P.enterCallbacks[j]||[]).forEach(lt=>lt(M))},{flush:"post"}),()=>{const M=E.value,P=o.name,j=N.value,q=j&&j.components[P];if(!q)return PD(p.default,{Component:q,route:M});const tt=j.props[P],at=tt?tt===!0?M.params:typeof tt=="function"?tt(M):tt:null,vt=KP(q,bn({},at,d,{onVnodeUnmounted:wt=>{wt.component.isUnmounted&&(j.instances[P]=null)},ref:D}));return PD(p.default,{Component:vt,route:M})||vt}}});function PD(o,d){if(!o)return null;const p=o(d);return p.length===1?p[0]:p}const YK=qK;function zK(o){const d=vK(o.routes,o),p=o.parseQuery||VK,_=o.stringifyQuery||AD,E=o.history,T=Ch(),R=Ch(),N=Ch(),D=$5(nc);let M=nc;Al&&o.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const P=vv.bind(null,ft=>""+ft),j=vv.bind(null,xK),q=vv.bind(null,Em);function tt(ft,Yt){let Ut,se;return qL(ft)?(Ut=d.getRecordMatcher(ft),se=Yt):se=ft,d.addRoute(se,Ut)}function at(ft){const Yt=d.getRecordMatcher(ft);Yt&&d.removeRoute(Yt)}function lt(){return d.getRoutes().map(ft=>ft.record)}function vt(ft){return!!d.getRecordMatcher(ft)}function wt(ft,Yt){if(Yt=bn({},Yt||D.value),typeof ft=="string"){const rt=yv(p,ft,Yt.path),_t=d.resolve({path:rt.path},Yt),gt=E.createHref(rt.fullPath);return bn(rt,_t,{params:q(_t.params),hash:Em(rt.hash),redirectedFrom:void 0,href:gt})}let Ut;if("path"in ft)Ut=bn({},ft,{path:yv(p,ft.path,Yt.path).path});else{const rt=bn({},ft.params);for(const _t in rt)rt[_t]==null&&delete rt[_t];Ut=bn({},ft,{params:j(rt)}),Yt.params=j(Yt.params)}const se=d.resolve(Ut,Yt),xt=ft.hash||"";se.params=P(q(se.params));const H=XH(_,bn({},ft,{hash:kK(xt),path:se.path})),z=E.createHref(H);return bn({fullPath:H,hash:xt,query:_===AD?FK(ft.query):ft.query||{}},se,{redirectedFrom:void 0,href:z})}function It(ft){return typeof ft=="string"?yv(p,ft,D.value.path):bn({},ft)}function Bt(ft,Yt){if(M!==ft)return Fl(8,{from:Yt,to:ft})}function Et(ft){return pe(ft)}function jt(ft){return Et(bn(It(ft),{replace:!0}))}function re(ft){const Yt=ft.matched[ft.matched.length-1];if(Yt&&Yt.redirect){const{redirect:Ut}=Yt;let se=typeof Ut=="function"?Ut(ft):Ut;return typeof se=="string"&&(se=se.includes("?")||se.includes("#")?se=It(se):{path:se},se.params={}),bn({query:ft.query,hash:ft.hash,params:"path"in se?{}:ft.params},se)}}function pe(ft,Yt){const Ut=M=wt(ft),se=D.value,xt=ft.state,H=ft.force,z=ft.replace===!0,rt=re(Ut);if(rt)return pe(bn(It(rt),{state:typeof rt=="object"?bn({},xt,rt.state):xt,force:H,replace:z}),Yt||Ut);const _t=Ut;_t.redirectedFrom=Yt;let gt;return!H&&$H(_,se,Ut)&&(gt=Fl(16,{to:_t,from:se}),kn(se,se,!0,!1)),(gt?Promise.resolve(gt):Xt(_t,se)).catch(At=>oa(At)?oa(At,2)?At:Be(At):Ue(At,_t,se)).then(At=>{if(At){if(oa(At,2))return pe(bn({replace:z},It(At.to),{state:typeof At.to=="object"?bn({},xt,At.to.state):xt,force:H}),Yt||_t)}else At=Lt(_t,se,!0,z,xt);return Qt(_t,se,At),At})}function Mt(ft,Yt){const Ut=Bt(ft,Yt);return Ut?Promise.reject(Ut):Promise.resolve()}function qt(ft){const Yt=Ci.values().next().value;return Yt&&typeof Yt.runWithContext=="function"?Yt.runWithContext(ft):ft()}function Xt(ft,Yt){let Ut;const[se,xt,H]=JK(ft,Yt);Ut=Cv(se.reverse(),"beforeRouteLeave",ft,Yt);for(const rt of se)rt.leaveGuards.forEach(_t=>{Ut.push(ac(_t,ft,Yt))});const z=Mt.bind(null,ft,Yt);return Ut.push(z),yn(Ut).then(()=>{Ut=[];for(const rt of T.list())Ut.push(ac(rt,ft,Yt));return Ut.push(z),yn(Ut)}).then(()=>{Ut=Cv(xt,"beforeRouteUpdate",ft,Yt);for(const rt of xt)rt.updateGuards.forEach(_t=>{Ut.push(ac(_t,ft,Yt))});return Ut.push(z),yn(Ut)}).then(()=>{Ut=[];for(const rt of H)if(rt.beforeEnter)if(Qr(rt.beforeEnter))for(const _t of rt.beforeEnter)Ut.push(ac(_t,ft,Yt));else Ut.push(ac(rt.beforeEnter,ft,Yt));return Ut.push(z),yn(Ut)}).then(()=>(ft.matched.forEach(rt=>rt.enterCallbacks={}),Ut=Cv(H,"beforeRouteEnter",ft,Yt),Ut.push(z),yn(Ut))).then(()=>{Ut=[];for(const rt of R.list())Ut.push(ac(rt,ft,Yt));return Ut.push(z),yn(Ut)}).catch(rt=>oa(rt,8)?rt:Promise.reject(rt))}function Qt(ft,Yt,Ut){N.list().forEach(se=>qt(()=>se(ft,Yt,Ut)))}function Lt(ft,Yt,Ut,se,xt){const H=Bt(ft,Yt);if(H)return H;const z=Yt===nc,rt=Al?history.state:{};Ut&&(se||z?E.replace(ft.fullPath,bn({scroll:z&&rt&&rt.scroll},xt)):E.push(ft.fullPath,xt)),D.value=ft,kn(ft,Yt,Ut,z),Be()}let de;function Ne(){de||(de=E.listen((ft,Yt,Ut)=>{if(!Pi.listening)return;const se=wt(ft),xt=re(se);if(xt){pe(bn(xt,{replace:!0}),se).catch(xh);return}M=se;const H=D.value;Al&&rK(TD(H.fullPath,Ut.delta),Bm()),Xt(se,H).catch(z=>oa(z,12)?z:oa(z,2)?(pe(z.to,se).then(rt=>{oa(rt,20)&&!Ut.delta&&Ut.type===Xh.pop&&E.go(-1,!1)}).catch(xh),Promise.reject()):(Ut.delta&&E.go(-Ut.delta,!1),Ue(z,se,H))).then(z=>{z=z||Lt(se,H,!1),z&&(Ut.delta&&!oa(z,8)?E.go(-Ut.delta,!1):Ut.type===Xh.pop&&oa(z,20)&&E.go(-1,!1)),Qt(se,H,z)}).catch(xh)}))}let dn=Ch(),Ee=Ch(),Oe;function Ue(ft,Yt,Ut){Be(ft);const se=Ee.list();return se.length?se.forEach(xt=>xt(ft,Yt,Ut)):console.error(ft),Promise.reject(ft)}function Wn(){return Oe&&D.value!==nc?Promise.resolve():new Promise((ft,Yt)=>{dn.add([ft,Yt])})}function Be(ft){return Oe||(Oe=!ft,Ne(),dn.list().forEach(([Yt,Ut])=>ft?Ut(ft):Yt()),dn.reset()),ft}function kn(ft,Yt,Ut,se){const{scrollBehavior:xt}=o;if(!Al||!xt)return Promise.resolve();const H=!Ut&&oK(TD(ft.fullPath,0))||(se||!Ut)&&history.state&&history.state.scroll||null;return Im().then(()=>xt(ft,Yt,H)).then(z=>z&&sK(z)).catch(z=>Ue(z,ft,Yt))}const tn=ft=>E.go(ft);let Tt;const Ci=new Set,Pi={currentRoute:D,listening:!0,addRoute:tt,removeRoute:at,hasRoute:vt,getRoutes:lt,resolve:wt,options:o,push:Et,replace:jt,go:tn,back:()=>tn(-1),forward:()=>tn(1),beforeEach:T.add,beforeResolve:R.add,afterEach:N.add,onError:Ee.add,isReady:Wn,install(ft){const Yt=this;ft.component("RouterLink",WK),ft.component("RouterView",YK),ft.config.globalProperties.$router=Yt,Object.defineProperty(ft.config.globalProperties,"$route",{enumerable:!0,get:()=>Zi(D)}),Al&&!Tt&&D.value===nc&&(Tt=!0,Et(E.location).catch(xt=>{}));const Ut={};for(const xt in nc)Object.defineProperty(Ut,xt,{get:()=>D.value[xt],enumerable:!0});ft.provide(jm,Yt),ft.provide(tk,dP(Ut)),ft.provide(Xv,D);const se=ft.unmount;Ci.add(ft),ft.unmount=function(){Ci.delete(ft),Ci.size<1&&(M=nc,de&&de(),de=null,D.value=nc,Tt=!1,Oe=!1),se()}}};function yn(ft){return ft.reduce((Yt,Ut)=>Yt.then(()=>qt(Ut)),Promise.resolve())}return Pi}function JK(o,d){const p=[],_=[],E=[],T=Math.max(d.matched.length,o.matched.length);for(let R=0;R<T;R++){const N=d.matched[R];N&&(o.matched.find(M=>Vl(M,N))?_.push(N):p.push(N));const D=o.matched[R];D&&(d.matched.find(M=>Vl(M,D))||E.push(D))}return[p,_,E]}function Kl(){return ts(jm)}const XK={},$K={class:"container-fluid row mt-1 mb-2"};function QK(o,d){return Je(),In("div",$K)}const By=rp(XK,[["render",QK]]),ek="/assets/logo-0e46a7a4.png",ql=by("token",()=>{const o=ze("");function d(_){o.value=_}function p(){return o.value}return{token:o,getToken:p,setToken:d}}),Yl=by("user",()=>{const o=ze(""),d=ze("");function p(R){o.value=R}function _(){return o.value}function E(R){d.value=R}function T(){return d.value}return{userName:o,host:d,setUserName:p,getUserName:_,getHost:T,setHost:E}}),nk="ac1f26c994ea4f978a11ce1251424920",ik="007eJxTYGCes/Paoln9j5xjV15+Y1a2K+JB9jepi/b96R28NUs/zuNQYEhMNkwzMku2tDRJTTRJszS3SDQ0TE41NDI1NDEysTQy+K9qlNoQyMhQJ36fhZEBAkF8doa0xJKk1MQiBgYAOU0hpA==",la="https://120.55.60.98/",op=o=>(my("data-v-f699eae1"),o=o(),Ey(),o),ZK={class:"bg-info right-side"},t8=op(()=>ot("div",{class:"header"},[ot("div",{class:"current-chatter"},"Chat Window")],-1)),e8={class:"chat-window container-fluid"},n8=op(()=>ot("div",{class:"system-message"}," Conversation starts ! Say Hi to others. ",-1)),i8=op(()=>ot("div",{class:"system-message"},"11:05PM, 7/14/2023",-1)),s8=op(()=>ot("div",{class:"chatter-avatar"},[ot("img",{src:ek,alt:"..."})],-1)),r8={class:"chatter-message container"},o8={class:"container row mt-2"},a8={class:"col-6"},c8=op(()=>ot("label",{for:"inputMsg",class:"visually-hidden"},"Password",-1)),d8=bs({__name:"Chat",setup(o){const d=Kl(),p=Yl(),_=ql();p.getHost();const E=ze([]);let T=ze("");const R=ts("axios"),N=la+"api/v1/room/msg";function D(){R.get(N+"?name=host",{headers:{Token:_.getToken()}},{withCredentials:!0}).then(P=>{console.log("res data",P.data),P.data===401&&(console.log("get 401, push to login"),d.push({name:"login"})),E.value=P.data.data}).catch(P=>{console.log("res err",P),P.response.status===401&&(console.log("res err, get 401, push to login"),d.push({name:"login"}))})}function M(){R.post(N,{name:"host",send_user:p.getUserName(),msg:T.value},{headers:{Token:_.getToken()}},{withCredentials:!0}).then(P=>{console.log("res data",P.data),P.data===401&&(console.log("get 401, push to login"),d.push({name:"login"}))}).catch(P=>{console.log("res err",P),P.response.status===401&&(console.log("res err, get 401, push to login"),d.push({name:"login"}))}),T.value=""}return D(),setInterval(D,500),(P,j)=>(Je(),In("div",ZK,[t8,ot("div",e8,[n8,i8,(Je(!0),In($n,null,pd(E.value,(q,tt)=>(Je(),In("div",{key:q.id+tt,class:"current-chatter-wrapper"},[s8,ot("div",r8,fi(q.send_user)+" says: "+fi(q.msg),1)]))),128))]),ot("div",o8,[ot("div",a8,[c8,ys(ot("input",{type:"text",class:"form-control",id:"inputMsg",placeholder:"input msg","onUpdate:modelValue":j[0]||(j[0]=q=>di(T)?T.value=q:T=q)},null,512),[[zh,Zi(T)]])]),ot("div",{class:"col-6"},[ot("button",{type:"submit",class:"btn btn-primary mb-3",onClick:M},"Send msg")])])]))}}),jy=rp(d8,[["__scopeId","data-v-f699eae1"]]),sk=by("dev",()=>{const o=ze("");function d(_){o.value=_}function p(){return o.value}return{devName:o,setDevName:d,getDevName:p}});var rk={exports:{}};(function(o,d){(function(p,_){o.exports=_()})(em,function(){function p(n,t){return t.forEach(function(e){e&&typeof e!="string"&&!Array.isArray(e)&&Object.keys(e).forEach(function(i){if(i!=="default"&&!(i in n)){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})}),Object.freeze(n)}let _=!0,E=!0;function T(n,t,e){const i=n.match(t);return i&&i.length>=e&&parseInt(i[e],10)}function R(n,t,e){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(a,c){if(a!==t)return s.apply(this,arguments);const l=u=>{const h=e(u);h&&(c.handleEvent?c.handleEvent(h):c(h))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,l),s.apply(this,[a,l])};const r=i.removeEventListener;i.removeEventListener=function(a,c){if(a!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(c))return r.apply(this,arguments);const l=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[a,l])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function N(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(_=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function D(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(E=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function M(){if(typeof window=="object"){if(_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function P(n,t){E&&console.warn(n+" is deprecated, please use "+t+" instead.")}function j(n){return Object.prototype.toString.call(n)==="[object Object]"}function q(n){return j(n)?Object.keys(n).reduce(function(t,e){const i=j(n[e]),s=i?q(n[e]):n[e],r=i&&!Object.keys(s).length;return s===void 0||r?t:Object.assign(t,{[e]:s})},{}):n}function tt(n,t,e){t&&!e.has(t.id)&&(e.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?tt(n,n.get(t[i]),e):i.endsWith("Ids")&&t[i].forEach(s=>{tt(n,n.get(s),e)})}))}function at(n,t,e){const i=e?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const r=[];return n.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&r.push(a)}),r.forEach(a=>{n.forEach(c=>{c.type===i&&c.trackId===a.id&&tt(n,c,s)})}),s}const lt=M;function vt(n,t){const e=n&&n.navigator;if(!e.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,g){return f?f+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",l)]=u.ideal,c.optional.push(f),f={},f[h("max",l)]=u.ideal,c.optional.push(f)):(f[h("",l)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,l)]=u[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},s=function(a,c){if(t.version>=61)return c(a);if((a=JSON.parse(JSON.stringify(a)))&&typeof a.audio=="object"){const l=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};l((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&(!e.mediaDevices.getSupportedConstraints||!e.mediaDevices.getSupportedConstraints().facingMode||u)){let h;if(delete a.video.facingMode,l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:l.exact!=="user"&&l.ideal!=="user"||(h=["front"]),h)return e.mediaDevices.enumerateDevices().then(f=>{let g=(f=f.filter(S=>S.kind==="videoinput")).find(S=>h.some(w=>S.label.toLowerCase().includes(w)));return!g&&f.length&&h.includes("back")&&(g=f[f.length-1]),g&&(a.video.deviceId=l.exact?{exact:g.deviceId}:{ideal:g.deviceId}),a.video=i(a.video),lt("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return lt("chrome: "+JSON.stringify(a)),c(a)},r=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e.getUserMedia=(function(a,c,l){s(a,u=>{e.webkitGetUserMedia(u,c,h=>{l&&l(r(h))})})}).bind(e),e.mediaDevices.getUserMedia){const a=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(c){return s(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(r(u))))}}}function wt(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function It(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",i=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):{track:i.track};const r=new Event("track");r.track=i.track,r.receiver=s,r.transceiver={receiver:s},r.streams=[e.stream],this.dispatchEvent(r)}),e.stream.getTracks().forEach(i=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===i.id):{track:i};const r=new Event("track");r.track=i,r.receiver=s,r.transceiver={receiver:s},r.streams=[e.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else R(n,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Bt(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const t=function(s,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=s.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){let l=s.apply(this,arguments);return l||(l=t(this,a),this._senders.push(l)),l};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(r=>{this._senders.push(t(this,r))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(r=>{const a=this._senders.find(c=>c.track===r);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(i=>i._pc=this),e},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Et(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[e,i,s]=arguments;if(arguments.length>0&&typeof e=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof e!="function"))return t.apply(this,[]);const r=function(c){const l={};return c.result().forEach(u=>{const h={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(f=>{h[f]=u.stat(f)}),l[h.id]=h}),l},a=function(c){return new Map(Object.keys(c).map(l=>[l,c[l]]))};if(arguments.length>=2){const c=function(l){i(a(r(l)))};return t.apply(this,[c,e])}return new Promise((c,l)=>{t.apply(this,[function(u){c(a(r(u)))},l])}).then(i,s)}}function jt(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>at(r,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i}),R(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>at(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const e=arguments[0];let i,s,r;return this.getSenders().forEach(a=>{a.track===e&&(i?r=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===e&&(s?r=!0:s=a),a.track===e)),r||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function re(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(r=>this._shimmedLocalStreams[r][0])};const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(r,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._shimmedLocalStreams=this._shimmedLocalStreams||{},r.getTracks().forEach(l=>{if(this.getSenders().find(u=>u.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();e.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[r.id]=[r].concat(c)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[r.id],i.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(r);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function pe(n,t){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&t.version>=65)return re(n);const e=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const l=e.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(u=>this._reverseStreams[u.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(u=>{if(this.getSenders().find(h=>h.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const u=new n.MediaStream(l.getTracks());this._streams[l.id]=u,this._reverseStreams[u.id]=l,l=u}i.apply(this,[l])};const s=n.RTCPeerConnection.prototype.removeStream;function r(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const g=l._reverseStreams[f],S=l._streams[g.id];h=h.replace(new RegExp(S.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:h})}n.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},n.RTCPeerConnection.prototype.addTrack=function(l,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(g=>g===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const f=this._streams[u.id];if(f)f.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new n.MediaStream([l]);this._streams[u.id]=g,this._reverseStreams[g.id]=u,this.addStream(g)}return this.getSenders().find(g=>g.track===l)},["createOffer","createAnswer"].forEach(function(l){const u=n.RTCPeerConnection.prototype[l],h={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const S=r(this,g);f[0].apply(null,[S])},g=>{f[1]&&f[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>r(this,g))}};n.RTCPeerConnection.prototype[l]=h[l]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const g=l._reverseStreams[f],S=l._streams[g.id];h=h.replace(new RegExp(g.id,"g"),S.id)}),new RTCSessionDescription({type:u.type,sdp:h})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:r(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(l._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u;this._streams=this._streams||{},Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(f=>l.track===f)&&(u=this._streams[h])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Mt(n,t){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const i=n.RTCPeerConnection.prototype[e],s={[e](){return arguments[0]=new(e==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[e]=s[e]})}function qt(n,t){R(n,"negotiationneeded",e=>{const i=e.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return e})}var Xt=Object.freeze({__proto__:null,fixNegotiationNeeded:qt,shimAddTrackRemoveTrack:pe,shimAddTrackRemoveTrackWithNative:re,shimGetDisplayMedia:function(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(typeof t=="function"?n.navigator.mediaDevices.getDisplayMedia=function(e){return t(e).then(i=>{const s=e.video&&e.video.width,r=e.video&&e.video.height,a=e.video&&e.video.frameRate;return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:a||3}},s&&(e.video.mandatory.maxWidth=s),r&&(e.video.mandatory.maxHeight=r),n.navigator.mediaDevices.getUserMedia(e)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Bt,shimGetStats:Et,shimGetUserMedia:vt,shimMediaStream:wt,shimOnTrack:It,shimPeerConnection:Mt,shimSenderReceiverGetStats:jt});function Qt(n,t){const e=n&&n.navigator,i=n&&n.MediaStreamTrack;if(e.getUserMedia=function(s,r,a){P("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(s).then(r,a)},!(t.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const s=function(a,c,l){c in a&&!(l in a)&&(a[l]=a[c],delete a[c])},r=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a.audio,"autoGainControl","mozAutoGainControl"),s(a.audio,"noiseSuppression","mozNoiseSuppression")),r(a)},i&&i.prototype.getSettings){const a=i.prototype.getSettings;i.prototype.getSettings=function(){const c=a.apply(this,arguments);return s(c,"mozAutoGainControl","autoGainControl"),s(c,"mozNoiseSuppression","noiseSuppression"),c}}if(i&&i.prototype.applyConstraints){const a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),s(c,"autoGainControl","mozAutoGainControl"),s(c,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[c])}}}}function Lt(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function de(n,t){if(typeof n!="object"||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=n.RTCPeerConnection.prototype[s],a={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=a[s]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,r,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(t.version<53&&!r)try{c.forEach(l=>{l.type=e[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:e[u.type]||u.type}))})}return c}).then(r,a)}}function Ne(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i});const e=n.RTCPeerConnection.prototype.addTrack;e&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=e.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function dn(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(i=>i._pc=this),e}),R(n,"track",e=>(e.receiver._pc=e.srcElement,e)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ee(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(t){P("removeStream","removeTrack"),this.getSenders().forEach(e=>{e.track&&t.getTracks().includes(e.track)&&this.removeTrack(e)})})}function Oe(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function Ue(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.addTransceiver;t&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=[...e];const i=e.length>0;i&&e.forEach(r=>{if("rid"in r&&!/^[a-z0-9]{0,16}$/i.test(r.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in r&&!(parseFloat(r.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in r&&!(parseFloat(r.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(i){const{sender:r}=s,a=r.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=e,r.sendEncodings=e,this.setParametersPromises.push(r.setParameters(a).then(()=>{delete r.sendEncodings}).catch(()=>{delete r.sendEncodings})))}return s})}function Wn(n){if(typeof n!="object"||!n.RTCRtpSender)return;const t=n.RTCRtpSender.prototype.getParameters;t&&(n.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Be(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function kn(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var tn=Object.freeze({__proto__:null,shimAddTransceiver:Ue,shimCreateAnswer:kn,shimCreateOffer:Be,shimGetDisplayMedia:function(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(e){if(!e||!e.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return e.video===!0?e.video={mediaSource:t}:e.video.mediaSource=t,n.navigator.mediaDevices.getUserMedia(e)})},shimGetParameters:Wn,shimGetUserMedia:Qt,shimOnTrack:Lt,shimPeerConnection:de,shimRTCDataChannel:Oe,shimReceiverGetStats:dn,shimRemoveStream:Ee,shimSenderGetStats:Ne});function Tt(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(i=>t.call(this,i,e)),e.getVideoTracks().forEach(i=>t.call(this,i,e))},n.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),t.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(t);if(e===-1)return;this._localStreams.splice(e,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function Ci(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,this.dispatchEvent(r)})})}});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(s)>=0)return;e._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,e.dispatchEvent(r)})}),t.apply(e,arguments)}}}function Pi(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype,e=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=e.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f},t.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f};let c=function(l,u,h){const f=s.apply(this,[l]);return h?(f.then(u,h),Promise.resolve()):f};t.setLocalDescription=c,c=function(l,u,h){const f=r.apply(this,[l]);return h?(f.then(u,h),Promise.resolve()):f},t.setRemoteDescription=c,c=function(l,u,h){const f=a.apply(this,[l]);return h?(f.then(u,h),Promise.resolve()):f},t.addIceCandidate=c}function yn(n){const t=n&&n.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=s=>i(ft(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,i,s){t.mediaDevices.getUserMedia(e).then(i,s)}).bind(t))}function ft(n){return n&&n.video!==void 0?Object.assign({},n,{video:q(n.video)}):n}function Yt(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection;n.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const s=[];for(let r=0;r<e.iceServers.length;r++){let a=e.iceServers[r];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(P("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(e.iceServers[r])}e.iceServers=s}return new t(e,i)},n.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Ut(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function se(n){const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(e){if(e){e.offerToReceiveAudio!==void 0&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const i=this.getTransceivers().find(r=>r.receiver.track.kind==="audio");e.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):e.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),e.offerToReceiveVideo!==void 0&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const s=this.getTransceivers().find(r=>r.receiver.track.kind==="video");e.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):e.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function xt(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var H=Object.freeze({__proto__:null,shimAudioContext:xt,shimCallbacksAPI:Pi,shimConstraints:ft,shimCreateOfferLegacy:se,shimGetUserMedia:yn,shimLocalStreamsAPI:Tt,shimRTCIceServerUrls:Yt,shimRemoteStreamsAPI:Ci,shimTrackEventTransceiver:Ut}),z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof em<"u"?em:typeof self<"u"?self:{};function rt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var _t={exports:{}};(function(n){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(e){return e.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(e){const i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){const i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter(s=>s.indexOf(i)===0)},t.parseCandidate=function(e){let i;i=e.indexOf("a=candidate:")===0?e.substring(12).split(" "):e.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let r=8;r<i.length;r+=2)switch(i[r]){case"raddr":s.relatedAddress=i[r+1];break;case"rport":s.relatedPort=parseInt(i[r+1],10);break;case"tcptype":s.tcpType=i[r+1];break;case"ufrag":s.ufrag=i[r+1],s.usernameFragment=i[r+1];break;default:s[i[r]]===void 0&&(s[i[r]]=i[r+1])}return s},t.writeCandidate=function(e){const i=[];i.push(e.foundation);const s=e.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(e.protocol.toUpperCase()),i.push(e.priority),i.push(e.address||e.ip),i.push(e.port);const r=e.type;return i.push("typ"),i.push(r),r!=="host"&&e.relatedAddress&&e.relatedPort&&(i.push("raddr"),i.push(e.relatedAddress),i.push("rport"),i.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(i.push("ufrag"),i.push(e.usernameFragment||e.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let i=e.substring(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(e){let i=e.payloadType;e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType);const s=e.channels||e.numChannels||1;return"a=rtpmap:"+i+" "+e.name+"/"+e.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(e){const i=e.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+`\r
`},t.parseFmtp=function(e){const i={};let s;const r=e.substring(e.indexOf(" ")+1).split(";");for(let a=0;a<r.length;a++)s=r[a].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(e){let i="",s=e.payloadType;if(e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach(a=>{e.parameters[a]!==void 0?r.push(a+"="+e.parameters[a]):r.push(a)}),i+="a=fmtp:"+s+" "+r.join(";")+`\r
`}return i},t.parseRtcpFb=function(e){const i=e.substring(e.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(e){let i="",s=e.payloadType;return e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(r=>{i+="a=rtcp-fb:"+s+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(e){const i=e.indexOf(" "),s={ssrc:parseInt(e.substring(7,i),10)},r=e.indexOf(":",i);return r>-1?(s.attribute=e.substring(i+1,r),s.value=e.substring(r+1)):s.attribute=e.substring(i+1),s},t.parseSsrcGroup=function(e){const i=e.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},t.getMid=function(e){const i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(e){const i=e.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(e,i){return{role:"auto",fingerprints:t.matchPrefix(e+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,i){let s="a=setup:"+i+`\r
`;return e.fingerprints.forEach(r=>{s+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),s},t.parseCryptoLine=function(e){const i=e.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;const i=e.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){return t.matchPrefix(e+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,i){const s=t.matchPrefix(e+i,"a=ice-ufrag:")[0],r=t.matchPrefix(e+i,"a=ice-pwd:")[0];return s&&r?{usernameFragment:s.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let i="a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`;return e.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(e){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(e)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=t.matchPrefix(e,"a=rtpmap:"+c+" ")[0];if(l){const u=t.parseRtpMap(l),h=t.matchPrefix(e,"a=fmtp:"+c+" ");switch(u.parameters=h.length?t.parseFmtp(h[0]):{},u.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(a=>{i.headerExtensions.push(t.parseExtmap(a))});const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(a=>{r.forEach(c=>{a.rtcpFeedback.find(l=>l.type===c.type&&l.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},t.writeRtpDescription=function(e,i){let s="";s+="m="+e+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{s+=t.writeRtpMap(a),s+=t.writeFmtp(a),s+=t.writeRtcpFb(a)});let r=0;return i.codecs.forEach(a=>{a.maxptime>r&&(r=a.maxptime)}),r>0&&(s+="a=maxptime:"+r+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{s+=t.writeExtmap(a)}),s},t.parseRtpEncodingParameters=function(e){const i=[],s=t.parseRtpParameters(e),r=s.fecMechanisms.indexOf("RED")!==-1,a=s.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(e,"a=ssrc:").map(g=>t.parseSsrcMedia(g)).filter(g=>g.attribute==="cname"),l=c.length>0&&c[0].ssrc;let u;const h=t.matchPrefix(e,"a=ssrc-group:FID").map(g=>g.substring(17).split(" ").map(S=>parseInt(S,10)));h.length>0&&h[0].length>1&&h[0][0]===l&&(u=h[0][1]),s.codecs.forEach(g=>{if(g.name.toUpperCase()==="RTX"&&g.parameters.apt){let S={ssrc:l,codecPayloadType:parseInt(g.parameters.apt,10)};l&&u&&(S.rtx={ssrc:u}),i.push(S),r&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},i.push(S))}}),i.length===0&&l&&i.push({ssrc:l});let f=t.matchPrefix(e,"b=");return f.length&&(f=f[0].indexOf("b=TIAS:")===0?parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?1e3*parseInt(f[0].substring(5),10)*.95-16e3:void 0,i.forEach(g=>{g.maxBitrate=f})),i},t.parseRtcpParameters=function(e){const i={},s=t.matchPrefix(e,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;const a=t.matchPrefix(e,"a=rtcp-mux");return i.mux=a.length>0,i},t.writeRtcpParameters=function(e){let i="";return e.reducedSize&&(i+=`a=rtcp-rsize\r
`),e.mux&&(i+=`a=rtcp-mux\r
`),e.ssrc!==void 0&&e.cname&&(i+="a=ssrc:"+e.ssrc+" cname:"+e.cname+`\r
`),i},t.parseMsid=function(e){let i;const s=t.matchPrefix(e,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};const r=t.matchPrefix(e,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");return r.length>0?(i=r[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(e){const i=t.parseMLine(e),s=t.matchPrefix(e,"a=max-message-size:");let r;s.length>0&&(r=parseInt(s[0].substring(19),10)),isNaN(r)&&(r=65536);const a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};const c=t.matchPrefix(e,"a=sctpmap:");if(c.length>0){const l=c[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,i){let s=[];return s=e.protocol!=="DTLS/SCTP"?["m="+e.kind+" 9 "+e.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+e.kind+" 9 "+e.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,i,s){let r;const a=i!==void 0?i:2;return r=e||t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+r+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(e,i){const s=t.splitLines(e);for(let r=0;r<s.length;r++)switch(s[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[r].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return e.split(" ",2)[1]==="0"},t.parseMLine=function(e){const i=t.splitLines(e)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){const i=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;const i=t.splitLines(e);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},n.exports=t})(_t);var gt=_t.exports,At=rt(gt),zt=p({__proto__:null,default:At},[gt]);function Pt(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const t=n.RTCIceCandidate;n.RTCIceCandidate=function(e){if(typeof e=="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const i=new t(e),s=At.parseCandidate(e.candidate),r=Object.assign(i,s);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},n.RTCIceCandidate.prototype=t.prototype,R(n,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new n.RTCIceCandidate(e.candidate),writable:"false"}),e))}function Vt(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||R(n,"icecandidate",t=>{if(t.candidate){const e=At.parseCandidate(t.candidate.candidate);e.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[e.priority>>24])}return t})}function Ot(n,t){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const e=function(c){if(!c||!c.sdp)return!1;const l=At.splitSections(c.sdp);return l.shift(),l.some(u=>{const h=At.parseMLine(u);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},i=function(c){const l=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const u=parseInt(l[1],10);return u!=u?-1:u},s=function(c){let l=65536;return t.browser==="firefox"&&(l=t.version<57?c===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),l},r=function(c,l){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const h=At.matchPrefix(c.sdp,"a=max-message-size:");return h.length>0?u=parseInt(h[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(u=2147483637),u},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const c=i(arguments[0]),l=s(c),u=r(arguments[0],c);let h;h=l===0&&u===0?Number.POSITIVE_INFINITY:l===0||u===0?Math.max(l,u):Math.min(l,u);const f={};Object.defineProperty(f,"maxMessageSize",{get:()=>h}),this._sctp=f}return a.apply(this,arguments)}}function oe(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function t(i,s){const r=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const e=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=e.apply(this,arguments);return t(i,this),i},R(n,"datachannel",i=>(t(i.channel,i.target),i))}function Zt(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const r=s.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const a=new Event("connectionstatechange",s);r.dispatchEvent(a)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function ae(n,t){if(!n.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(r=>r.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return e.apply(this,arguments)}}function Se(n,t){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype.addIceCandidate;e&&e.length!==0&&(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function De(n,t){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype.setLocalDescription;e&&e.length!==0&&(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return e.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?e.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>e.apply(this,[s]))})}var en=Object.freeze({__proto__:null,removeExtmapAllowMixed:ae,shimAddIceCandidateNullOrEmpty:Se,shimConnectionState:Zt,shimMaxMessageSize:Ot,shimParameterlessSetLocalDescription:De,shimRTCIceCandidate:Pt,shimRTCIceCandidateRelayProtocol:Vt,shimSendThrowTypeError:oe});(function({window:n}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const e=M,i=function(r){const a={browser:null,version:null};if(r===void 0||!r.navigator)return a.browser="Not a browser.",a;const{navigator:c}=r;if(c.mozGetUserMedia)a.browser="firefox",a.version=T(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)a.browser="chrome",a.version=T(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!r.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=T(c.userAgent,/AppleWebKit\/(\d+)\./,1),a.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype}return a}(n),s={browserDetails:i,commonShim:en,extractVersion:T,disableLog:N,disableWarnings:D,sdp:zt};switch(i.browser){case"chrome":if(!Xt||!Mt||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),s;if(i.version===null)return e("Chrome shim can not determine version, not shimming."),s;e("adapter.js shimming chrome."),s.browserShim=Xt,Se(n,i),De(n),vt(n,i),wt(n),Mt(n,i),It(n),pe(n,i),Bt(n),Et(n),jt(n),qt(n,i),Pt(n),Vt(n),Zt(n),Ot(n,i),oe(n),ae(n,i);break;case"firefox":if(!tn||!de||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),s;e("adapter.js shimming firefox."),s.browserShim=tn,Se(n,i),De(n),Qt(n,i),de(n,i),Lt(n),Ee(n),Ne(n),dn(n),Oe(n),Ue(n),Wn(n),Be(n),kn(n),Pt(n),Zt(n),Ot(n,i),oe(n);break;case"safari":if(!H||!t.shimSafari)return e("Safari shim is not included in this adapter release."),s;e("adapter.js shimming safari."),s.browserShim=H,Se(n,i),De(n),Yt(n),se(n),Pi(n),Tt(n),Ci(n),Ut(n),yn(n),xt(n),Pt(n),Vt(n),Ot(n,i),oe(n),ae(n,i);break;default:e("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var ce=function(n){try{return!!n()}catch{return!0}},An=!ce(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),Ri=An,es=Function.prototype,zs=es.call,gr=Ri&&es.bind.bind(zs,zs),wn=Ri?gr:function(n){return function(){return zs.apply(n,arguments)}},Cn=wn({}.isPrototypeOf),qi=function(n){return n&&n.Math==Math&&n},oi=qi(typeof globalThis=="object"&&globalThis)||qi(typeof window=="object"&&window)||qi(typeof self=="object"&&self)||qi(typeof z=="object"&&z)||function(){return this}()||z||Function("return this")(),Ym=An,dp=Function.prototype,lp=dp.apply,up=dp.call,gd=typeof Reflect=="object"&&Reflect.apply||(Ym?up.bind(lp):function(){return up.apply(lp,arguments)}),_c=wn,hp=_c({}.toString),pp=_c("".slice),Zr=function(n){return pp(hp(n),8,-1)},zm=Zr,Jm=wn,Jl=function(n){if(zm(n)==="Function")return Jm(n)},to=typeof document=="object"&&document.all,eo={all:to,IS_HTMLDDA:to===void 0&&to!==void 0},Xm=eo.all,li=eo.IS_HTMLDDA?function(n){return typeof n=="function"||n===Xm}:function(n){return typeof n=="function"},mc={},Tr=!ce(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),$m=An,ma=Function.prototype.call,ai=$m?ma.bind(ma):function(){return ma.apply(ma,arguments)},Ea={},fp={}.propertyIsEnumerable,Td=Object.getOwnPropertyDescriptor,Qm=Td&&!fp.call({1:2},1);Ea.f=Qm?function(n){var t=Td(this,n);return!!t&&t.enumerable}:fp;var no,Ur,io=function(n,t){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:t}},Uo=ce,Xl=Zr,$l=Object,_p=wn("".split),Ql=Uo(function(){return!$l("z").propertyIsEnumerable(0)})?function(n){return Xl(n)=="String"?_p(n,""):$l(n)}:$l,Sd=function(n){return n==null},Zm=Sd,tE=TypeError,ga=function(n){if(Zm(n))throw tE("Can't call method on "+n);return n},mp=Ql,eE=ga,Is=function(n){return mp(eE(n))},so=li,nE=eo.all,Yi=eo.IS_HTMLDDA?function(n){return typeof n=="object"?n!==null:so(n)||n===nE}:function(n){return typeof n=="object"?n!==null:so(n)},xo={},Zl=xo,tu=oi,iE=li,Ep=function(n){return iE(n)?n:void 0},ns=function(n,t){return arguments.length<2?Ep(Zl[n])||Ep(tu[n]):Zl[n]&&Zl[n][t]||tu[n]&&tu[n][t]},Vo=typeof navigator<"u"&&String(navigator.userAgent)||"",gp=oi,ps=Vo,eu=gp.process,nu=gp.Deno,iu=eu&&eu.versions||nu&&nu.version,Tp=iu&&iu.v8;Tp&&(Ur=(no=Tp.split("."))[0]>0&&no[0]<4?1:+(no[0]+no[1])),!Ur&&ps&&(!(no=ps.match(/Edge\/(\d+)/))||no[1]>=74)&&(no=ps.match(/Chrome\/(\d+)/))&&(Ur=+no[1]);var Fo=Ur,su=Fo,vd=ce,sE=oi.String,Ta=!!Object.getOwnPropertySymbols&&!vd(function(){var n=Symbol();return!sE(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&su&&su<41}),ru=Ta&&!Symbol.sham&&typeof Symbol.iterator=="symbol",rE=ns,oE=li,Sp=Cn,vp=Object,Sa=ru?function(n){return typeof n=="symbol"}:function(n){var t=rE("Symbol");return oE(t)&&Sp(t.prototype,vp(n))},yd=String,Bo=function(n){try{return yd(n)}catch{return"Object"}},ou=li,As=Bo,aE=TypeError,ws=function(n){if(ou(n))return n;throw aE(As(n)+" is not a function")},yp=ws,Cp=Sd,au=function(n,t){var e=n[t];return Cp(e)?void 0:yp(e)},cu=ai,du=li,lu=Yi,cE=TypeError,Rp={exports:{}},uu=oi,bp=Object.defineProperty,hu=function(n,t){try{bp(uu,n,{value:t,configurable:!0,writable:!0})}catch{uu[n]=t}return t},Ip="__core-js_shared__",pu=oi[Ip]||hu(Ip,{}),ro=pu;(Rp.exports=function(n,t){return ro[n]||(ro[n]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var is=Rp.exports,Ap=ga,dE=Object,oo=function(n){return dE(Ap(n))},wp=oo,Op=wn({}.hasOwnProperty),Li=Object.hasOwn||function(n,t){return Op(wp(n),t)},lE=wn,uE=0,hE=Math.random(),Np=lE(1 .toString),Cd=function(n){return"Symbol("+(n===void 0?"":n)+")_"+Np(++uE+hE,36)},pE=is,Dp=Li,fE=Cd,_E=Ta,mE=ru,ss=oi.Symbol,Rd=pE("wks"),EE=mE?ss.for||ss:ss&&ss.withoutSetter||fE,Bn=function(n){return Dp(Rd,n)||(Rd[n]=_E&&Dp(ss,n)?ss[n]:EE("Symbol."+n)),Rd[n]},gE=ai,Pp=Yi,Lp=Sa,TE=au,SE=function(n,t){var e,i;if(t==="string"&&du(e=n.toString)&&!lu(i=cu(e,n))||du(e=n.valueOf)&&!lu(i=cu(e,n))||t!=="string"&&du(e=n.toString)&&!lu(i=cu(e,n)))return i;throw cE("Can't convert object to primitive value")},vE=TypeError,fu=Bn("toPrimitive"),bd=function(n,t){if(!Pp(n)||Lp(n))return n;var e,i=TE(n,fu);if(i){if(t===void 0&&(t="default"),e=gE(i,n,t),!Pp(e)||Lp(e))return e;throw vE("Can't convert object to primitive value")}return t===void 0&&(t="number"),SE(n,t)},kp=Sa,Ec=function(n){var t=bd(n,"string");return kp(t)?t:t+""},va=Yi,gc=oi.document,yE=va(gc)&&va(gc.createElement),_u=function(n){return yE?gc.createElement(n):{}},CE=_u,ao=!Tr&&!ce(function(){return Object.defineProperty(CE("div"),"a",{get:function(){return 7}}).a!=7}),RE=Tr,bE=ai,Id=Ea,mu=io,IE=Is,Mp=Ec,AE=Li,ya=ao,Ad=Object.getOwnPropertyDescriptor;mc.f=RE?Ad:function(n,t){if(n=IE(n),t=Mp(t),ya)try{return Ad(n,t)}catch{}if(AE(n,t))return mu(!bE(Id.f,n,t),n[t])};var Up=ce,wE=li,OE=/#|\.prototype\./,Tc=function(n,t){var e=jo[Sc(n)];return e==DE||e!=NE&&(wE(t)?Up(t):!!t)},Sc=Tc.normalize=function(n){return String(n).replace(OE,".").toLowerCase()},jo=Tc.data={},NE=Tc.NATIVE="N",DE=Tc.POLYFILL="P",xp=Tc,PE=ws,LE=An,kE=Jl(Jl.bind),vc=function(n,t){return PE(n),t===void 0?n:LE?kE(n,t):function(){return n.apply(t,arguments)}},Os={},Eu=Tr&&ce(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),ME=Yi,Vp=String,gu=TypeError,Ns=function(n){if(ME(n))return n;throw gu(Vp(n)+" is not an object")},Go=Tr,Fp=ao,Tu=Eu,yc=Ns,wd=Ec,Bp=TypeError,Cc=Object.defineProperty,UE=Object.getOwnPropertyDescriptor,xr="enumerable",Sr="configurable",Su="writable";Os.f=Go?Tu?function(n,t,e){if(yc(n),t=wd(t),yc(e),typeof n=="function"&&t==="prototype"&&"value"in e&&Su in e&&!e[Su]){var i=UE(n,t);i&&i[Su]&&(n[t]=e.value,e={configurable:Sr in e?e[Sr]:i[Sr],enumerable:xr in e?e[xr]:i[xr],writable:!1})}return Cc(n,t,e)}:Cc:function(n,t,e){if(yc(n),t=wd(t),yc(e),Fp)try{return Cc(n,t,e)}catch{}if("get"in e||"set"in e)throw Bp("Accessors not supported");return"value"in e&&(n[t]=e.value),n};var xE=Os,VE=io,co=Tr?function(n,t,e){return xE.f(n,t,VE(1,e))}:function(n,t,e){return n[t]=e,n},Od=oi,FE=gd,BE=Jl,jE=li,jp=mc.f,Nd=xp,Vr=xo,GE=vc,Ca=co,Ra=Li,X=function(n){var t=function(e,i,s){if(this instanceof t){switch(arguments.length){case 0:return new n;case 1:return new n(e);case 2:return new n(e,i)}return new n(e,i,s)}return FE(n,this,arguments)};return t.prototype=n.prototype,t},y=function(n,t){var e,i,s,r,a,c,l,u,h,f=n.target,g=n.global,S=n.stat,w=n.proto,b=g?Od:S?Od[f]:(Od[f]||{}).prototype,I=g?Vr:Vr[f]||Ca(Vr,f,{})[f],U=I.prototype;for(r in t)i=!(e=Nd(g?r:f+(S?".":"#")+r,n.forced))&&b&&Ra(b,r),c=I[r],i&&(l=n.dontCallGetSet?(h=jp(b,r))&&h.value:b[r]),a=i&&l?l:t[r],i&&typeof c==typeof a||(u=n.bind&&i?GE(a,Od):n.wrap&&i?X(a):w&&jE(a)?BE(a):a,(n.sham||a&&a.sham||c&&c.sham)&&Ca(u,"sham",!0),Ca(I,r,u),w&&(Ra(Vr,s=f+"Prototype")||Ca(Vr,s,{}),Ca(Vr[s],r,a),n.real&&U&&(e||!U[r])&&Ca(U,r,a)))},k=Math.ceil,J=Math.floor,St=Math.trunc||function(n){var t=+n;return(t>0?J:k)(t)},Kt=function(n){var t=+n;return t!=t||t===0?0:St(t)},ie=Kt,$e=Math.max,Hn=Math.min,zi=function(n,t){var e=ie(n);return e<0?$e(e+t,0):Hn(e,t)},fs=Kt,Js=Math.min,Fr=function(n){return n>0?Js(fs(n),9007199254740991):0},Ji=function(n){return Fr(n.length)},Wo=Is,Xs=zi,Rc=Ji,bc=function(n){return function(t,e,i){var s,r=Wo(t),a=Rc(r),c=Xs(i,a);if(n&&e!=e){for(;a>c;)if((s=r[c++])!=s)return!0}else for(;a>c;c++)if((n||c in r)&&r[c]===e)return n||c||0;return!n&&-1}},Gp={includes:bc(!0),indexOf:bc(!1)},Ho=Gp.includes;y({target:"Array",proto:!0,forced:ce(function(){return!Array(1).includes()})},{includes:function(n){return Ho(this,n,arguments.length>1?arguments[1]:void 0)}});var WE=xo,Ic=function(n){return WE[n+"Prototype"]},Ok=Ic("Array").includes,Nk=Yi,Dk=Zr,Pk=Bn("match"),Lk=function(n){var t;return Nk(n)&&((t=n[Pk])!==void 0?!!t:Dk(n)=="RegExp")},kk=TypeError,zy={};zy[Bn("toStringTag")]="z";var HE=String(zy)==="[object z]",Mk=HE,Uk=li,Wp=Zr,xk=Bn("toStringTag"),Vk=Object,Fk=Wp(function(){return arguments}())=="Arguments",Ac=Mk?Wp:function(n){var t,e,i;return n===void 0?"Undefined":n===null?"Null":typeof(e=function(s,r){try{return s[r]}catch{}}(t=Vk(n),xk))=="string"?e:Fk?Wp(t):(i=Wp(t))=="Object"&&Uk(t.callee)?"Arguments":i},Bk=Ac,jk=String,Ko=function(n){if(Bk(n)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return jk(n)},Gk=Bn("match"),Wk=y,Hk=function(n){if(Lk(n))throw kk("The method doesn't accept regular expressions");return n},Kk=ga,Jy=Ko,qk=function(n){var t=/./;try{"/./"[n](t)}catch{try{return t[Gk]=!1,"/./"[n](t)}catch{}}return!1},Yk=wn("".indexOf);Wk({target:"String",proto:!0,forced:!qk("includes")},{includes:function(n){return!!~Yk(Jy(Kk(this)),Jy(Hk(n)),arguments.length>1?arguments[1]:void 0)}});var zk=Ic("String").includes,Xy=Cn,Jk=Ok,Xk=zk,KE=Array.prototype,qE=String.prototype,Wt=rt(function(n){var t=n.includes;return n===KE||Xy(KE,n)&&t===KE.includes?Jk:typeof n=="string"||n===qE||Xy(qE,n)&&t===qE.includes?Xk:t}),$y={exports:{}},$k=y,Qk=Tr,Qy=Os.f;$k({target:"Object",stat:!0,forced:Object.defineProperty!==Qy,sham:!Qk},{defineProperty:Qy});var Zy=xo.Object,Zk=$y.exports=function(n,t,e){return Zy.defineProperty(n,t,e)};Zy.defineProperty.sham&&(Zk.sham=!0);var t1=rt($y.exports),e1=Zr,YE=Array.isArray||function(n){return e1(n)=="Array"},n1=TypeError,i1=Ec,s1=Os,r1=io,tC=function(n,t,e){var i=i1(t);i in n?s1.f(n,i,r1(0,e)):n[i]=e},o1=li,zE=pu,a1=wn(Function.toString);o1(zE.inspectSource)||(zE.inspectSource=function(n){return a1(n)});var eC=zE.inspectSource,c1=wn,d1=ce,nC=li,l1=Ac,u1=eC,iC=function(){},h1=[],sC=ns("Reflect","construct"),JE=/^\s*(?:class|function)\b/,p1=c1(JE.exec),f1=!JE.exec(iC),vu=function(n){if(!nC(n))return!1;try{return sC(iC,h1,n),!0}catch{return!1}},rC=function(n){if(!nC(n))return!1;switch(l1(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f1||!!p1(JE,u1(n))}catch{return!0}};rC.sham=!0;var oC=!sC||d1(function(){var n;return vu(vu.call)||!vu(Object)||!vu(function(){n=!0})||n})?rC:vu,aC=YE,_1=oC,m1=Yi,E1=Bn("species"),cC=Array,g1=function(n){var t;return aC(n)&&(t=n.constructor,(_1(t)&&(t===cC||aC(t.prototype))||m1(t)&&(t=t[E1])===null)&&(t=void 0)),t===void 0?cC:t},dC=function(n,t){return new(g1(n))(t===0?0:t)},T1=ce,S1=Fo,v1=Bn("species"),y1=y,C1=ce,R1=YE,b1=Yi,I1=oo,A1=Ji,lC=function(n){if(n>9007199254740991)throw n1("Maximum allowed index exceeded");return n},uC=tC,w1=dC,O1=function(n){return S1>=51||!T1(function(){var t=[];return(t.constructor={})[v1]=function(){return{foo:1}},t[n](Boolean).foo!==1})},N1=Fo,hC=Bn("isConcatSpreadable"),D1=N1>=51||!C1(function(){var n=[];return n[hC]=!1,n.concat()[0]!==n}),P1=function(n){if(!b1(n))return!1;var t=n[hC];return t!==void 0?!!t:R1(n)};y1({target:"Array",proto:!0,arity:1,forced:!D1||!O1("concat")},{concat:function(n){var t,e,i,s,r,a=I1(this),c=w1(a,0),l=0;for(t=-1,i=arguments.length;t<i;t++)if(P1(r=t===-1?a:arguments[t]))for(s=A1(r),lC(l+s),e=0;e<s;e++,l++)e in r&&uC(c,l,r[e]);else lC(l+1),uC(c,l++,r);return c.length=l,c}});var XE={},Hp={},$E=Li,L1=Is,k1=Gp.indexOf,M1=Hp,pC=wn([].push),fC=function(n,t){var e,i=L1(n),s=0,r=[];for(e in i)!$E(M1,e)&&$E(i,e)&&pC(r,e);for(;t.length>s;)$E(i,e=t[s++])&&(~k1(r,e)||pC(r,e));return r},QE=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],U1=fC,x1=QE,_C=Object.keys||function(n){return U1(n,x1)},V1=Tr,F1=Eu,B1=Os,j1=Ns,G1=Is,W1=_C;XE.f=V1&&!F1?Object.defineProperties:function(n,t){j1(n);for(var e,i=G1(t),s=W1(t),r=s.length,a=0;r>a;)B1.f(n,e=s[a++],i[e]);return n};var Kp,mC=ns("document","documentElement"),H1=Cd,EC=is("keys"),qp=function(n){return EC[n]||(EC[n]=H1(n))},K1=Ns,q1=XE,gC=QE,Y1=Hp,z1=mC,J1=_u,ZE="prototype",tg="script",TC=qp("IE_PROTO"),eg=function(){},SC=function(n){return"<"+tg+">"+n+"</"+tg+">"},vC=function(n){n.write(SC("")),n.close();var t=n.parentWindow.Object;return n=null,t},Yp=function(){try{Kp=new ActiveXObject("htmlfile")}catch{}var n,t,e;Yp=typeof document<"u"?document.domain&&Kp?vC(Kp):(t=J1("iframe"),e="java"+tg+":",t.style.display="none",z1.appendChild(t),t.src=String(e),(n=t.contentWindow.document).open(),n.write(SC("document.F=Object")),n.close(),n.F):vC(Kp);for(var i=gC.length;i--;)delete Yp[ZE][gC[i]];return Yp()};Y1[TC]=!0;var zp=Object.create||function(n,t){var e;return n!==null?(eg[ZE]=K1(n),e=new eg,eg[ZE]=null,e[TC]=n):e=Yp(),t===void 0?e:q1.f(e,t)},Jp={},X1=fC,$1=QE.concat("length","prototype");Jp.f=Object.getOwnPropertyNames||function(n){return X1(n,$1)};var yC={},CC=zi,Q1=Ji,Z1=tC,tM=Array,eM=Math.max,RC=function(n,t,e){for(var i=Q1(n),s=CC(t,i),r=CC(e===void 0?i:e,i),a=tM(eM(r-s,0)),c=0;s<r;s++,c++)Z1(a,c,n[s]);return a.length=c,a},nM=Zr,iM=Is,bC=Jp.f,sM=RC,IC=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];yC.f=function(n){return IC&&nM(n)=="Window"?function(t){try{return bC(t)}catch{return sM(IC)}}(n):bC(iM(n))};var Xp={};Xp.f=Object.getOwnPropertySymbols;var rM=co,yu=function(n,t,e,i){return i&&i.enumerable?n[t]=e:rM(n,t,e),n},oM=Os,AC=function(n,t,e){return oM.f(n,t,e)},Dd={},aM=Bn;Dd.f=aM;var $p,Cu,Qp,wC=xo,cM=Li,dM=Dd,lM=Os.f,ui=function(n){var t=wC.Symbol||(wC.Symbol={});cM(t,n)||lM(t,n,{value:dM.f(n)})},uM=ai,hM=ns,pM=Bn,fM=yu,OC=function(){var n=hM("Symbol"),t=n&&n.prototype,e=t&&t.valueOf,i=pM("toPrimitive");t&&!t[i]&&fM(t,i,function(s){return uM(e,this)},{arity:1})},_M=Ac,mM=HE?{}.toString:function(){return"[object "+_M(this)+"]"},EM=HE,gM=Os.f,TM=co,SM=Li,vM=mM,NC=Bn("toStringTag"),Pd=function(n,t,e,i){if(n){var s=e?n:n.prototype;SM(s,NC)||gM(s,NC,{configurable:!0,value:t}),i&&!EM&&TM(s,"toString",vM)}},yM=li,DC=oi.WeakMap,CM=yM(DC)&&/native code/.test(String(DC)),PC=oi,RM=Yi,bM=co,ng=Li,ig=pu,IM=qp,AM=Hp,LC="Object already initialized",sg=PC.TypeError,wM=PC.WeakMap;if(CM||ig.state){var lo=ig.state||(ig.state=new wM);lo.get=lo.get,lo.has=lo.has,lo.set=lo.set,$p=function(n,t){if(lo.has(n))throw sg(LC);return t.facade=n,lo.set(n,t),t},Cu=function(n){return lo.get(n)||{}},Qp=function(n){return lo.has(n)}}else{var Ld=IM("state");AM[Ld]=!0,$p=function(n,t){if(ng(n,Ld))throw sg(LC);return t.facade=n,bM(n,Ld,t),t},Cu=function(n){return ng(n,Ld)?n[Ld]:{}},Qp=function(n){return ng(n,Ld)}}var Zp={set:$p,get:Cu,has:Qp,enforce:function(n){return Qp(n)?Cu(n):$p(n,{})},getterFor:function(n){return function(t){var e;if(!RM(t)||(e=Cu(t)).type!==n)throw sg("Incompatible receiver, "+n+" required");return e}}},OM=vc,NM=Ql,DM=oo,PM=Ji,LM=dC,kC=wn([].push),ba=function(n){var t=n==1,e=n==2,i=n==3,s=n==4,r=n==6,a=n==7,c=n==5||r;return function(l,u,h,f){for(var g,S,w=DM(l),b=NM(w),I=OM(u,h),U=PM(b),F=0,V=f||LM,Z=t?V(l,U):e||a?V(l,0):void 0;U>F;F++)if((c||F in b)&&(S=I(g=b[F],F,w),n))if(t)Z[F]=S;else if(S)switch(n){case 3:return!0;case 5:return g;case 6:return F;case 2:kC(Z,g)}else switch(n){case 4:return!1;case 7:kC(Z,g)}return r?-1:i||s?s:Z}},kM={forEach:ba(0),map:ba(1),filter:ba(2),some:ba(3),every:ba(4),find:ba(5),findIndex:ba(6),filterReject:ba(7)},tf=y,rg=oi,og=ai,MM=wn,kd=Tr,Md=Ta,UM=ce,xi=Li,xM=Cn,ag=Ns,ef=Is,cg=Ec,VM=Ko,dg=io,Ru=zp,MC=_C,FM=Jp,UC=yC,BM=Xp,xC=mc,VC=Os,jM=XE,FC=Ea,BC=yu,GM=AC,lg=is,jC=Hp,GC=Cd,WM=Bn,HM=Dd,KM=ui,qM=OC,YM=Pd,WC=Zp,nf=kM.forEach,Ds=qp("hidden"),sf="Symbol",bu="prototype",zM=WC.set,HC=WC.getterFor(sf),Br=Object[bu],wc=rg.Symbol,rf=wc&&wc[bu],JM=rg.TypeError,ug=rg.QObject,KC=xC.f,Oc=VC.f,qC=UC.f,XM=FC.f,YC=MM([].push),qo=lg("symbols"),Iu=lg("op-symbols"),$M=lg("wks"),hg=!ug||!ug[bu]||!ug[bu].findChild,pg=kd&&UM(function(){return Ru(Oc({},"a",{get:function(){return Oc(this,"a",{value:7}).a}})).a!=7})?function(n,t,e){var i=KC(Br,t);i&&delete Br[t],Oc(n,t,e),i&&n!==Br&&Oc(Br,t,i)}:Oc,fg=function(n,t){var e=qo[n]=Ru(rf);return zM(e,{type:sf,tag:n,description:t}),kd||(e.description=t),e},of=function(n,t,e){n===Br&&of(Iu,t,e),ag(n);var i=cg(t);return ag(e),xi(qo,i)?(e.enumerable?(xi(n,Ds)&&n[Ds][i]&&(n[Ds][i]=!1),e=Ru(e,{enumerable:dg(0,!1)})):(xi(n,Ds)||Oc(n,Ds,dg(1,{})),n[Ds][i]=!0),pg(n,i,e)):Oc(n,i,e)},_g=function(n,t){ag(n);var e=ef(t),i=MC(e).concat($C(e));return nf(i,function(s){kd&&!og(zC,e,s)||of(n,s,e[s])}),n},zC=function(n){var t=cg(n),e=og(XM,this,t);return!(this===Br&&xi(qo,t)&&!xi(Iu,t))&&(!(e||!xi(this,t)||!xi(qo,t)||xi(this,Ds)&&this[Ds][t])||e)},JC=function(n,t){var e=ef(n),i=cg(t);if(e!==Br||!xi(qo,i)||xi(Iu,i)){var s=KC(e,i);return!s||!xi(qo,i)||xi(e,Ds)&&e[Ds][i]||(s.enumerable=!0),s}},XC=function(n){var t=qC(ef(n)),e=[];return nf(t,function(i){xi(qo,i)||xi(jC,i)||YC(e,i)}),e},$C=function(n){var t=n===Br,e=qC(t?Iu:ef(n)),i=[];return nf(e,function(s){!xi(qo,s)||t&&!xi(Br,s)||YC(i,qo[s])}),i};Md||(wc=function(){if(xM(rf,this))throw JM("Symbol is not a constructor");var n=arguments.length&&arguments[0]!==void 0?VM(arguments[0]):void 0,t=GC(n),e=function(i){this===Br&&og(e,Iu,i),xi(this,Ds)&&xi(this[Ds],t)&&(this[Ds][t]=!1),pg(this,t,dg(1,i))};return kd&&hg&&pg(Br,t,{configurable:!0,set:e}),fg(t,n)},BC(rf=wc[bu],"toString",function(){return HC(this).tag}),BC(wc,"withoutSetter",function(n){return fg(GC(n),n)}),FC.f=zC,VC.f=of,jM.f=_g,xC.f=JC,FM.f=UC.f=XC,BM.f=$C,HM.f=function(n){return fg(WM(n),n)},kd&&GM(rf,"description",{configurable:!0,get:function(){return HC(this).description}})),tf({global:!0,constructor:!0,wrap:!0,forced:!Md,sham:!Md},{Symbol:wc}),nf(MC($M),function(n){KM(n)}),tf({target:sf,stat:!0,forced:!Md},{useSetter:function(){hg=!0},useSimple:function(){hg=!1}}),tf({target:"Object",stat:!0,forced:!Md,sham:!kd},{create:function(n,t){return t===void 0?Ru(n):_g(Ru(n),t)},defineProperty:of,defineProperties:_g,getOwnPropertyDescriptor:JC}),tf({target:"Object",stat:!0,forced:!Md},{getOwnPropertyNames:XC}),qM(),YM(wc,sf),jC[Ds]=!0;var QC=Ta&&!!Symbol.for&&!!Symbol.keyFor,QM=y,ZM=ns,tU=Li,eU=Ko,ZC=is,nU=QC,mg=ZC("string-to-symbol-registry"),iU=ZC("symbol-to-string-registry");QM({target:"Symbol",stat:!0,forced:!nU},{for:function(n){var t=eU(n);if(tU(mg,t))return mg[t];var e=ZM("Symbol")(t);return mg[t]=e,iU[e]=t,e}});var sU=y,rU=Li,oU=Sa,aU=Bo,cU=QC,tR=is("symbol-to-string-registry");sU({target:"Symbol",stat:!0,forced:!cU},{keyFor:function(n){if(!oU(n))throw TypeError(aU(n)+" is not a symbol");if(rU(tR,n))return tR[n]}});var eR=wn([].slice),nR=YE,dU=li,iR=Zr,lU=Ko,sR=wn([].push),uU=y,rR=ns,oR=gd,hU=ai,Au=wn,aR=ce,cR=li,dR=Sa,lR=eR,pU=function(n){if(dU(n))return n;if(nR(n)){for(var t=n.length,e=[],i=0;i<t;i++){var s=n[i];typeof s=="string"?sR(e,s):typeof s!="number"&&iR(s)!="Number"&&iR(s)!="String"||sR(e,lU(s))}var r=e.length,a=!0;return function(c,l){if(a)return a=!1,l;if(nR(this))return l;for(var u=0;u<r;u++)if(e[u]===c)return l}}},fU=Ta,_U=String,Ia=rR("JSON","stringify"),af=Au(/./.exec),uR=Au("".charAt),mU=Au("".charCodeAt),EU=Au("".replace),gU=Au(1 .toString),TU=/[\uD800-\uDFFF]/g,hR=/^[\uD800-\uDBFF]$/,pR=/^[\uDC00-\uDFFF]$/,fR=!fU||aR(function(){var n=rR("Symbol")();return Ia([n])!="[null]"||Ia({a:n})!="{}"||Ia(Object(n))!="{}"}),_R=aR(function(){return Ia("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ia("\uDEAD")!=='"\\udead"'}),SU=function(n,t){var e=lR(arguments),i=pU(t);if(cR(i)||n!==void 0&&!dR(n))return e[1]=function(s,r){if(cR(i)&&(r=hU(i,this,_U(s),r)),!dR(r))return r},oR(Ia,null,e)},vU=function(n,t,e){var i=uR(e,t-1),s=uR(e,t+1);return af(hR,n)&&!af(pR,s)||af(pR,n)&&!af(hR,i)?"\\u"+gU(mU(n,0),16):n};Ia&&uU({target:"JSON",stat:!0,arity:3,forced:fR||_R},{stringify:function(n,t,e){var i=lR(arguments),s=oR(fR?SU:Ia,null,i);return _R&&typeof s=="string"?EU(s,TU,vU):s}});var mR=Xp,yU=oo;y({target:"Object",stat:!0,forced:!Ta||ce(function(){mR.f(1)})},{getOwnPropertySymbols:function(n){var t=mR.f;return t?t(yU(n)):[]}}),ui("asyncIterator"),ui("hasInstance"),ui("isConcatSpreadable"),ui("iterator"),ui("match"),ui("matchAll"),ui("replace"),ui("search"),ui("species"),ui("split");var CU=OC;ui("toPrimitive"),CU();var RU=ns,bU=Pd;ui("toStringTag"),bU(RU("Symbol"),"Symbol"),ui("unscopables"),Pd(oi.JSON,"JSON",!0);var Nc,ER,gR,IU=xo.Symbol,Ud={},Eg=Tr,AU=Li,TR=Function.prototype,wU=Eg&&Object.getOwnPropertyDescriptor,gg=AU(TR,"name"),SR={EXISTS:gg,PROPER:gg&&(function(){}).name==="something",CONFIGURABLE:gg&&(!Eg||Eg&&wU(TR,"name").configurable)},OU=!ce(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}),NU=Li,DU=li,PU=oo,LU=OU,vR=qp("IE_PROTO"),Tg=Object,kU=Tg.prototype,Sg=LU?Tg.getPrototypeOf:function(n){var t=PU(n);if(NU(t,vR))return t[vR];var e=t.constructor;return DU(e)&&t instanceof e?e.prototype:t instanceof Tg?kU:null},MU=ce,UU=li,xU=Yi,VU=zp,yR=Sg,FU=yu,vg=Bn("iterator"),CR=!1;[].keys&&("next"in(gR=[].keys())?(ER=yR(yR(gR)))!==Object.prototype&&(Nc=ER):CR=!0);var BU=!xU(Nc)||MU(function(){var n={};return Nc[vg].call(n)!==n});UU((Nc=BU?{}:VU(Nc))[vg])||FU(Nc,vg,function(){return this});var RR={IteratorPrototype:Nc,BUGGY_SAFARI_ITERATORS:CR},jU=RR.IteratorPrototype,GU=zp,WU=io,HU=Pd,KU=Ud,qU=function(){return this},YU=wn,zU=ws,JU=li,XU=String,$U=TypeError,QU=function(n,t,e){try{return YU(zU(Object.getOwnPropertyDescriptor(n,t)[e]))}catch{}},ZU=Ns,tx=function(n){if(typeof n=="object"||JU(n))return n;throw $U("Can't set "+XU(n)+" as a prototype")},ex=Object.setPrototypeOf||("__proto__"in{}?function(){var n,t=!1,e={};try{(n=QU(Object.prototype,"__proto__","set"))(e,[]),t=e instanceof Array}catch{}return function(i,s){return ZU(i),tx(s),t?n(i,s):i.__proto__=s,i}}():void 0),nx=y,ix=ai,sx=SR,rx=function(n,t,e,i){var s=t+" Iterator";return n.prototype=GU(jU,{next:WU(+!i,e)}),HU(n,s,!1,!0),KU[s]=qU,n},ox=Sg,ax=Pd,bR=yu,IR=Ud,cx=RR,dx=sx.PROPER,cf=cx.BUGGY_SAFARI_ITERATORS,yg=Bn("iterator"),AR="keys",df="values",wR="entries",lx=function(){return this},OR=function(n,t,e,i,s,r,a){rx(e,t,i);var c,l,u,h=function(U){if(U===s&&b)return b;if(!cf&&U in S)return S[U];switch(U){case AR:case df:case wR:return function(){return new e(this,U)}}return function(){return new e(this)}},f=t+" Iterator",g=!1,S=n.prototype,w=S[yg]||S["@@iterator"]||s&&S[s],b=!cf&&w||h(s),I=t=="Array"&&S.entries||w;if(I&&(c=ox(I.call(new n)))!==Object.prototype&&c.next&&(ax(c,f,!0,!0),IR[f]=lx),dx&&s==df&&w&&w.name!==df&&(g=!0,b=function(){return ix(w,this)}),s)if(l={values:h(df),keys:r?b:h(AR),entries:h(wR)},a)for(u in l)(cf||g||!(u in S))&&bR(S,u,l[u]);else nx({target:t,proto:!0,forced:cf||g},l);return a&&S[yg]!==b&&bR(S,yg,b,{name:s}),IR[t]=b,l},NR=function(n,t){return{value:n,done:t}},ux=Is,DR=Ud,PR=Zp;Os.f;var hx=OR,LR=NR,kR="Array Iterator",px=PR.set,fx=PR.getterFor(kR);hx(Array,"Array",function(n,t){px(this,{type:kR,target:ux(n),index:0,kind:t})},function(){var n=fx(this),t=n.target,e=n.kind,i=n.index++;return!t||i>=t.length?(n.target=void 0,LR(void 0,!0)):LR(e=="keys"?i:e=="values"?t[i]:[i,t[i]],!1)},"values"),DR.Arguments=DR.Array;var _x={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},mx=oi,Ex=Ac,gx=co,MR=Ud,UR=Bn("toStringTag");for(var Cg in _x){var xR=mx[Cg],Rg=xR&&xR.prototype;Rg&&Ex(Rg)!==UR&&gx(Rg,UR,Cg),MR[Cg]=MR.Array}var Tx=IU,Sx=Bn,vx=Os.f,VR=Sx("metadata"),FR=Function.prototype;FR[VR]===void 0&&vx(FR,VR,{value:null}),ui("dispose"),ui("metadata");var yx=Tx;ui("asyncDispose");var Cx=wn,bg=ns("Symbol"),Rx=bg.keyFor,bx=Cx(bg.prototype.valueOf),BR=bg.isRegisteredSymbol||function(n){try{return Rx(bx(n))!==void 0}catch{return!1}};y({target:"Symbol",stat:!0},{isRegisteredSymbol:BR});for(var Ix=is,jR=ns,Ax=wn,wx=Sa,Ox=Bn,lf=jR("Symbol"),GR=lf.isWellKnownSymbol,WR=jR("Object","getOwnPropertyNames"),Nx=Ax(lf.prototype.valueOf),HR=Ix("wks"),Ig=0,KR=WR(lf),Dx=KR.length;Ig<Dx;Ig++)try{var qR=KR[Ig];wx(lf[qR])&&Ox(qR)}catch{}var YR=function(n){if(GR&&GR(n))return!0;try{for(var t=Nx(n),e=0,i=WR(HR),s=i.length;e<s;e++)if(HR[i[e]]==t)return!0}catch{}return!1};y({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:YR}),ui("matcher"),ui("observable"),y({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:BR}),y({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:YR}),ui("metadataKey"),ui("patternMatch"),ui("replaceAll");var xd=rt(yx),Ag=wn,Px=Kt,Lx=Ko,kx=ga,Mx=Ag("".charAt),zR=Ag("".charCodeAt),Ux=Ag("".slice),JR=function(n){return function(t,e){var i,s,r=Lx(kx(t)),a=Px(e),c=r.length;return a<0||a>=c?n?"":void 0:(i=zR(r,a))<55296||i>56319||a+1===c||(s=zR(r,a+1))<56320||s>57343?n?Mx(r,a):i:n?Ux(r,a,a+2):s-56320+(i-55296<<10)+65536}},xx={codeAt:JR(!1),charAt:JR(!0)}.charAt,Vx=Ko,XR=Zp,Fx=OR,$R=NR,QR="String Iterator",Bx=XR.set,jx=XR.getterFor(QR);Fx(String,"String",function(n){Bx(this,{type:QR,string:Vx(n),index:0})},function(){var n,t=jx(this),e=t.string,i=t.index;return i>=e.length?$R(void 0,!0):(n=xx(e,i),t.index+=n.length,$R(n,!1))});var ZR=rt(Dd.f("iterator"));function wu(n){return wu=typeof xd=="function"&&typeof ZR=="symbol"?function(t){return typeof t}:function(t){return t&&typeof xd=="function"&&t.constructor===xd&&t!==xd.prototype?"symbol":typeof t},wu(n)}var Gx=rt(Dd.f("toPrimitive"));function Wx(n){var t=function(e,i){if(wu(e)!=="object"||e===null)return e;var s=e[Gx];if(s!==void 0){var r=s.call(e,i||"default");if(wu(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}(n,"string");return wu(t)==="symbol"?t:String(t)}function m(n,t,e){return(t=Wx(t))in n?t1(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var Hx=Ic("Array").keys,Kx=Ac,qx=Li,Yx=Cn,zx=Hx,wg=Array.prototype,Jx={DOMTokenList:!0,NodeList:!0},Ps=rt(function(n){var t=n.keys;return n===wg||Yx(wg,n)&&t===wg.keys||qx(Jx,Kx(n))?zx:t}),tb=Bo,Xx=TypeError,eb=RC,$x=Math.floor,Og=function(n,t){var e=n.length,i=$x(e/2);return e<8?Qx(n,t):Zx(n,Og(eb(n,0,i),t),Og(eb(n,i),t),t)},Qx=function(n,t){for(var e,i,s=n.length,r=1;r<s;){for(i=r,e=n[r];i&&t(n[i-1],e)>0;)n[i]=n[--i];i!==r++&&(n[i]=e)}return n},Zx=function(n,t,e,i){for(var s=t.length,r=e.length,a=0,c=0;a<s||c<r;)n[a+c]=a<s&&c<r?i(t[a],e[c])<=0?t[a++]:e[c++]:a<s?t[a++]:e[c++];return n},t2=Og,e2=ce,nb=function(n,t){var e=[][n];return!!e&&e2(function(){e.call(null,t||function(){return 1},1)})},ib=Vo.match(/firefox\/(\d+)/i),n2=!!ib&&+ib[1],i2=/MSIE|Trident/.test(Vo),sb=Vo.match(/AppleWebKit\/(\d+)\./),s2=!!sb&&+sb[1],r2=y,rb=wn,o2=ws,a2=oo,ob=Ji,c2=function(n,t){if(!delete n[t])throw Xx("Cannot delete property "+tb(t)+" of "+tb(n))},ab=Ko,Ng=ce,d2=t2,l2=nb,cb=n2,u2=i2,db=Fo,lb=s2,Aa=[],ub=rb(Aa.sort),h2=rb(Aa.push),p2=Ng(function(){Aa.sort(void 0)}),f2=Ng(function(){Aa.sort(null)}),_2=l2("sort"),hb=!Ng(function(){if(db)return db<70;if(!(cb&&cb>3)){if(u2)return!0;if(lb)return lb<603;var n,t,e,i,s="";for(n=65;n<76;n++){switch(t=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:e=3;break;case 68:case 71:e=4;break;default:e=2}for(i=0;i<47;i++)Aa.push({k:t+i,v:e})}for(Aa.sort(function(r,a){return a.v-r.v}),i=0;i<Aa.length;i++)t=Aa[i].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}});r2({target:"Array",proto:!0,forced:p2||!f2||!_2||!hb},{sort:function(n){n!==void 0&&o2(n);var t=a2(this);if(hb)return n===void 0?ub(t):ub(t,n);var e,i,s=[],r=ob(t);for(i=0;i<r;i++)i in t&&h2(s,t[i]);for(d2(s,function(a){return function(c,l){return l===void 0?-1:c===void 0?1:a!==void 0?+a(c,l)||0:ab(c)>ab(l)?1:-1}}(n)),e=ob(s),i=0;i<e;)t[i]=s[i++];for(;i<r;)c2(t,i++);return t}});var m2=Ic("Array").sort,E2=Cn,g2=m2,Dg=Array.prototype,Ou=rt(function(n){var t=n.sort;return n===Dg||E2(Dg,n)&&t===Dg.sort?g2:t}),T2=ns,S2=Jp,v2=Xp,y2=Ns,C2=wn([].concat),R2=T2("Reflect","ownKeys")||function(n){var t=S2.f(y2(n)),e=v2.f;return e?C2(t,e(n)):t},pb=Li,b2=R2,I2=mc,A2=Os,w2=Yi,O2=co,fb=Error,N2=wn("".replace),D2=String(fb("zxcasd").stack),_b=/\n\s*at [^:]*:[^\n]*/,P2=_b.test(D2),L2=io,k2=!ce(function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",L2(1,7)),n.stack!==7)}),M2=co,U2=function(n,t){if(P2&&typeof n=="string"&&!fb.prepareStackTrace)for(;t--;)n=N2(n,_b,"");return n},x2=k2,mb=Error.captureStackTrace,V2=Ud,F2=Bn("iterator"),B2=Array.prototype,j2=Ac,Eb=au,G2=Sd,W2=Ud,H2=Bn("iterator"),gb=function(n){if(!G2(n))return Eb(n,H2)||Eb(n,"@@iterator")||W2[j2(n)]},K2=ai,q2=ws,Y2=Ns,z2=Bo,J2=gb,X2=TypeError,$2=ai,Tb=Ns,Q2=au,Z2=vc,tV=ai,eV=Ns,nV=Bo,iV=function(n){return n!==void 0&&(V2.Array===n||B2[F2]===n)},sV=Ji,Sb=Cn,rV=function(n,t){var e=arguments.length<2?J2(n):t;if(q2(e))return Y2(K2(e,n));throw X2(z2(n)+" is not iterable")},oV=gb,vb=function(n,t,e){var i,s;Tb(n);try{if(!(i=Q2(n,"return"))){if(t==="throw")throw e;return e}i=$2(i,n)}catch(r){s=!0,i=r}if(t==="throw")throw e;if(s)throw i;return Tb(i),e},aV=TypeError,uf=function(n,t){this.stopped=n,this.result=t},yb=uf.prototype,Nu=function(n,t,e){var i,s,r,a,c,l,u,h=e&&e.that,f=!(!e||!e.AS_ENTRIES),g=!(!e||!e.IS_RECORD),S=!(!e||!e.IS_ITERATOR),w=!(!e||!e.INTERRUPTED),b=Z2(t,h),I=function(F){return i&&vb(i,"normal",F),new uf(!0,F)},U=function(F){return f?(eV(F),w?b(F[0],F[1],I):b(F[0],F[1])):w?b(F,I):b(F)};if(g)i=n.iterator;else if(S)i=n;else{if(!(s=oV(n)))throw aV(nV(n)+" is not iterable");if(iV(s)){for(r=0,a=sV(n);a>r;r++)if((c=U(n[r]))&&Sb(yb,c))return c;return new uf(!1)}i=rV(n,s)}for(l=g?n.next:i.next;!(u=tV(l,i)).done;){try{c=U(u.value)}catch(F){vb(i,"throw",F)}if(typeof c=="object"&&c&&Sb(yb,c))return c}return new uf(!1)},cV=Ko,dV=y,lV=Cn,uV=Sg,hf=ex,hV=function(n,t,e){for(var i=b2(t),s=A2.f,r=I2.f,a=0;a<i.length;a++){var c=i[a];pb(n,c)||e&&pb(e,c)||s(n,c,r(t,c))}},Cb=zp,Pg=co,Lg=io,pV=function(n,t){w2(t)&&"cause"in t&&O2(n,"cause",t.cause)},fV=function(n,t,e,i){x2&&(mb?mb(n,t):M2(n,"stack",U2(e,i)))},_V=Nu,mV=function(n,t){return n===void 0?arguments.length<2?"":t:cV(n)},EV=Bn("toStringTag"),pf=Error,gV=[].push,Vd=function(n,t){var e,i=lV(kg,this);hf?e=hf(pf(),i?uV(this):kg):(e=i?this:Cb(kg),Pg(e,EV,"Error")),t!==void 0&&Pg(e,"message",mV(t)),fV(e,Vd,e.stack,1),arguments.length>2&&pV(e,arguments[2]);var s=[];return _V(n,gV,{that:s}),Pg(e,"errors",s),e};hf?hf(Vd,pf):hV(Vd,pf,{name:!0});var kg=Vd.prototype=Cb(pf.prototype,{constructor:Lg(1,Vd),message:Lg(1,""),name:Lg(1,"AggregateError")});dV({global:!0,constructor:!0,arity:2},{AggregateError:Vd});var Du,Fd,Rb,Mg,Pu=typeof process<"u"&&Zr(process)=="process",TV=ns,SV=AC,vV=Tr,bb=Bn("species"),yV=Cn,CV=TypeError,RV=oC,bV=Bo,IV=TypeError,Ib=Ns,AV=function(n){if(RV(n))return n;throw IV(bV(n)+" is not a constructor")},wV=Sd,OV=Bn("species"),Ab=function(n,t){var e,i=Ib(n).constructor;return i===void 0||wV(e=Ib(i)[OV])?t:AV(e)},NV=TypeError,wb=/(?:ipad|iphone|ipod).*applewebkit/i.test(Vo),$s=oi,DV=gd,PV=vc,Ob=li,LV=Li,Nb=ce,Db=mC,kV=eR,Pb=_u,MV=function(n,t){if(n<t)throw NV("Not enough arguments");return n},UV=wb,xV=Pu,Ug=$s.setImmediate,xg=$s.clearImmediate,VV=$s.process,Vg=$s.Dispatch,FV=$s.Function,Lb=$s.MessageChannel,BV=$s.String,Fg=0,Lu={},kb="onreadystatechange";Nb(function(){Du=$s.location});var Bg=function(n){if(LV(Lu,n)){var t=Lu[n];delete Lu[n],t()}},jg=function(n){return function(){Bg(n)}},Mb=function(n){Bg(n.data)},Ub=function(n){$s.postMessage(BV(n),Du.protocol+"//"+Du.host)};Ug&&xg||(Ug=function(n){MV(arguments.length,1);var t=Ob(n)?n:FV(n),e=kV(arguments,1);return Lu[++Fg]=function(){DV(t,void 0,e)},Fd(Fg),Fg},xg=function(n){delete Lu[n]},xV?Fd=function(n){VV.nextTick(jg(n))}:Vg&&Vg.now?Fd=function(n){Vg.now(jg(n))}:Lb&&!UV?(Mg=(Rb=new Lb).port2,Rb.port1.onmessage=Mb,Fd=PV(Mg.postMessage,Mg)):$s.addEventListener&&Ob($s.postMessage)&&!$s.importScripts&&Du&&Du.protocol!=="file:"&&!Nb(Ub)?(Fd=Ub,$s.addEventListener("message",Mb,!1)):Fd=kb in Pb("script")?function(n){Db.appendChild(Pb("script"))[kb]=function(){Db.removeChild(this),Bg(n)}}:function(n){setTimeout(jg(n),0)});var xb={set:Ug,clear:xg},Vb=function(){this.head=null,this.tail=null};Vb.prototype={add:function(n){var t={item:n,next:null},e=this.tail;e?e.next=t:this.head=t,this.tail=t},get:function(){var n=this.head;if(n)return(this.head=n.next)===null&&(this.tail=null),n.item}};var Bd,Gg,Wg,Hg,Fb,Bb=Vb,jV=/ipad|iphone|ipod/i.test(Vo)&&typeof Pebble<"u",GV=/web0s(?!.*chrome)/i.test(Vo),Dc=oi,jb=vc,WV=mc.f,Kg=xb.set,HV=Bb,KV=wb,qV=jV,YV=GV,qg=Pu,Gb=Dc.MutationObserver||Dc.WebKitMutationObserver,Wb=Dc.document,Hb=Dc.process,ff=Dc.Promise,Kb=WV(Dc,"queueMicrotask"),Yg=Kb&&Kb.value;if(!Yg){var _f=new HV,mf=function(){var n,t;for(qg&&(n=Hb.domain)&&n.exit();t=_f.get();)try{t()}catch(e){throw _f.head&&Bd(),e}n&&n.enter()};KV||qg||YV||!Gb||!Wb?!qV&&ff&&ff.resolve?((Hg=ff.resolve(void 0)).constructor=ff,Fb=jb(Hg.then,Hg),Bd=function(){Fb(mf)}):qg?Bd=function(){Hb.nextTick(mf)}:(Kg=jb(Kg,Dc),Bd=function(){Kg(mf)}):(Gg=!0,Wg=Wb.createTextNode(""),new Gb(mf).observe(Wg,{characterData:!0}),Bd=function(){Wg.data=Gg=!Gg}),Yg=function(n){_f.head||Bd(),_f.add(n)}}var zV=Yg,jd=function(n){try{return{error:!1,value:n()}}catch(t){return{error:!0,value:t}}},Pc=oi.Promise,qb=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",JV=!qb&&!Pu&&typeof window=="object"&&typeof document=="object",XV=oi,ku=Pc,$V=li,QV=xp,ZV=eC,tF=Bn,eF=JV,nF=qb,zg=Fo,Yb=ku&&ku.prototype,iF=tF("species"),zb=!1,Jb=$V(XV.PromiseRejectionEvent),sF=QV("Promise",function(){var n=ZV(ku),t=n!==String(ku);if(!t&&zg===66||!Yb.catch||!Yb.finally)return!0;if(!zg||zg<51||!/native code/.test(n)){var e=new ku(function(s){s(1)}),i=function(s){s(function(){},function(){})};if((e.constructor={})[iF]=i,!(zb=e.then(function(){})instanceof i))return!0}return!t&&(eF||nF)&&!Jb}),Mu={CONSTRUCTOR:sF,REJECTION_EVENT:Jb,SUBCLASSING:zb},uo={},Xb=ws,rF=TypeError,oF=function(n){var t,e;this.promise=new n(function(i,s){if(t!==void 0||e!==void 0)throw rF("Bad Promise constructor");t=i,e=s}),this.resolve=Xb(t),this.reject=Xb(e)};uo.f=function(n){return new oF(n)};var Jg,$b,aF=y,Ef=Pu,wa=oi,Uu=ai,cF=yu,dF=Pd,lF=function(n){var t=TV(n);vV&&t&&!t[bb]&&SV(t,bb,{configurable:!0,get:function(){return this}})},uF=ws,Xg=li,hF=Yi,pF=function(n,t){if(yV(t,n))return n;throw CV("Incorrect invocation")},fF=Ab,Qb=xb.set,$g=zV,_F=function(n,t){try{arguments.length==1?console.error(n):console.error(n,t)}catch{}},mF=jd,EF=Bb,Zb=Zp,Qg=Pc,tI=Mu,eI=uo,gf="Promise",nI=tI.CONSTRUCTOR,gF=tI.REJECTION_EVENT,Zg=Zb.getterFor(gf),TF=Zb.set,SF=Qg&&Qg.prototype,xu=Qg,tT=SF,iI=wa.TypeError,eT=wa.document,nT=wa.process,iT=eI.f,vF=iT,yF=!!(eT&&eT.createEvent&&wa.dispatchEvent),sI="unhandledrejection",rI=function(n){var t;return!(!hF(n)||!Xg(t=n.then))&&t},oI=function(n,t){var e,i,s,r=t.value,a=t.state==1,c=a?n.ok:n.fail,l=n.resolve,u=n.reject,h=n.domain;try{c?(a||(t.rejection===2&&RF(t),t.rejection=1),c===!0?e=r:(h&&h.enter(),e=c(r),h&&(h.exit(),s=!0)),e===n.promise?u(iI("Promise-chain cycle")):(i=rI(e))?Uu(i,e,l,u):l(e)):u(r)}catch(f){h&&!s&&h.exit(),u(f)}},aI=function(n,t){n.notified||(n.notified=!0,$g(function(){for(var e,i=n.reactions;e=i.get();)oI(e,n);n.notified=!1,t&&!n.rejection&&CF(n)}))},cI=function(n,t,e){var i,s;yF?((i=eT.createEvent("Event")).promise=t,i.reason=e,i.initEvent(n,!1,!0),wa.dispatchEvent(i)):i={promise:t,reason:e},!gF&&(s=wa["on"+n])?s(i):n===sI&&_F("Unhandled promise rejection",e)},CF=function(n){Uu(Qb,wa,function(){var t,e=n.facade,i=n.value;if(dI(n)&&(t=mF(function(){Ef?nT.emit("unhandledRejection",i,e):cI(sI,e,i)}),n.rejection=Ef||dI(n)?2:1,t.error))throw t.value})},dI=function(n){return n.rejection!==1&&!n.parent},RF=function(n){Uu(Qb,wa,function(){var t=n.facade;Ef?nT.emit("rejectionHandled",t):cI("rejectionhandled",t,n.value)})},Gd=function(n,t,e){return function(i){n(t,i,e)}},Wd=function(n,t,e){n.done||(n.done=!0,e&&(n=e),n.value=t,n.state=2,aI(n,!0))},sT=function(n,t,e){if(!n.done){n.done=!0,e&&(n=e);try{if(n.facade===t)throw iI("Promise can't be resolved itself");var i=rI(t);i?$g(function(){var s={done:!1};try{Uu(i,t,Gd(sT,s,n),Gd(Wd,s,n))}catch(r){Wd(s,r,n)}}):(n.value=t,n.state=1,aI(n,!1))}catch(s){Wd({done:!1},s,n)}}};nI&&(tT=(xu=function(n){pF(this,tT),uF(n),Uu(Jg,this);var t=Zg(this);try{n(Gd(sT,t),Gd(Wd,t))}catch(e){Wd(t,e)}}).prototype,(Jg=function(n){TF(this,{type:gf,done:!1,notified:!1,parent:!1,reactions:new EF,rejection:!1,state:0,value:void 0})}).prototype=cF(tT,"then",function(n,t){var e=Zg(this),i=iT(fF(this,xu));return e.parent=!0,i.ok=!Xg(n)||n,i.fail=Xg(t)&&t,i.domain=Ef?nT.domain:void 0,e.state==0?e.reactions.add(i):$g(function(){oI(i,e)}),i.promise}),$b=function(){var n=new Jg,t=Zg(n);this.promise=n,this.resolve=Gd(sT,t),this.reject=Gd(Wd,t)},eI.f=iT=function(n){return n===xu||n===void 0?new $b(n):vF(n)}),aF({global:!0,constructor:!0,wrap:!0,forced:nI},{Promise:xu}),dF(xu,gf,!1,!0),lF(gf);var lI=Bn("iterator"),uI=!1;try{var bF=0,hI={next:function(){return{done:!!bF++}},return:function(){uI=!0}};hI[lI]=function(){return this},Array.from(hI,function(){throw 2})}catch{}var IF=Pc,AF=function(n,t){if(!t&&!uI)return!1;var e=!1;try{var i={};i[lI]=function(){return{next:function(){return{done:e=!0}}}},n(i)}catch{}return e},Tf=Mu.CONSTRUCTOR||!AF(function(n){IF.all(n).then(void 0,function(){})}),wF=ai,OF=ws,NF=uo,DF=jd,PF=Nu;y({target:"Promise",stat:!0,forced:Tf},{all:function(n){var t=this,e=NF.f(t),i=e.resolve,s=e.reject,r=DF(function(){var a=OF(t.resolve),c=[],l=0,u=1;PF(n,function(h){var f=l++,g=!1;u++,wF(a,t,h).then(function(S){g||(g=!0,c[f]=S,--u||i(c))},s)}),--u||i(c)});return r.error&&s(r.value),e.promise}});var LF=y,kF=Mu.CONSTRUCTOR;Pc&&Pc.prototype,LF({target:"Promise",proto:!0,forced:kF,real:!0},{catch:function(n){return this.then(void 0,n)}});var MF=ai,UF=ws,xF=uo,VF=jd,FF=Nu;y({target:"Promise",stat:!0,forced:Tf},{race:function(n){var t=this,e=xF.f(t),i=e.reject,s=VF(function(){var r=UF(t.resolve);FF(n,function(a){MF(r,t,a).then(e.resolve,i)})});return s.error&&i(s.value),e.promise}});var BF=ai,jF=uo;y({target:"Promise",stat:!0,forced:Mu.CONSTRUCTOR},{reject:function(n){var t=jF.f(this);return BF(t.reject,void 0,n),t.promise}});var GF=Ns,WF=Yi,HF=uo,pI=function(n,t){if(GF(n),WF(t)&&t.constructor===n)return t;var e=HF.f(n);return(0,e.resolve)(t),e.promise},KF=y,qF=Pc,YF=Mu.CONSTRUCTOR,zF=pI,JF=ns("Promise"),XF=!YF;KF({target:"Promise",stat:!0,forced:!0},{resolve:function(n){return zF(XF&&this===JF?qF:this,n)}});var $F=ai,QF=ws,ZF=uo,tB=jd,eB=Nu;y({target:"Promise",stat:!0,forced:Tf},{allSettled:function(n){var t=this,e=ZF.f(t),i=e.resolve,s=e.reject,r=tB(function(){var a=QF(t.resolve),c=[],l=0,u=1;eB(n,function(h){var f=l++,g=!1;u++,$F(a,t,h).then(function(S){g||(g=!0,c[f]={status:"fulfilled",value:S},--u||i(c))},function(S){g||(g=!0,c[f]={status:"rejected",reason:S},--u||i(c))})}),--u||i(c)});return r.error&&s(r.value),e.promise}});var nB=ai,iB=ws,sB=ns,rB=uo,oB=jd,aB=Nu,fI="No one promise resolved";y({target:"Promise",stat:!0,forced:Tf},{any:function(n){var t=this,e=sB("AggregateError"),i=rB.f(t),s=i.resolve,r=i.reject,a=oB(function(){var c=iB(t.resolve),l=[],u=0,h=1,f=!1;aB(n,function(g){var S=u++,w=!1;h++,nB(c,t,g).then(function(b){w||f||(f=!0,s(b))},function(b){w||f||(w=!0,l[S]=b,--h||r(new e(l,fI)))})}),--h||r(new e(l,fI))});return a.error&&r(a.value),i.promise}});var cB=y,rT=Pc,dB=ce,lB=ns,uB=li,hB=Ab,_I=pI,pB=rT&&rT.prototype;cB({target:"Promise",proto:!0,real:!0,forced:!!rT&&dB(function(){pB.finally.call({then:function(){}},function(){})})},{finally:function(n){var t=hB(this,lB("Promise")),e=uB(n);return this.then(e?function(i){return _I(t,n()).then(function(){return i})}:n,e?function(i){return _I(t,n()).then(function(){throw i})}:n)}});var mI=xo.Promise,K=rt(mI);const fB=()=>{};function Vu(){const n={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:fB};return n.promise=new K((t,e)=>{n.resolve=i=>{n.isFinished||(n.isResolved=!0,n.isFinished=!0,t(i),n.value=i)},n.reject=i=>{n.isFinished||(n.isRejected=!0,n.isFinished=!0,e(i))}}),n}const Sf=new Map,vf=new Map,ho=new Map;var Qn,ke;(function(n){n.WIN_10="Windows 10",n.WIN_81="Windows 8.1",n.WIN_8="Windows 8",n.WIN_7="Windows 7",n.WIN_VISTA="Windows Vista",n.WIN_SERVER_2003="Windows Server 2003",n.WIN_XP="Windows XP",n.WIN_2000="Windows 2000",n.ANDROID="Android",n.HARMONY_OS="HarmonyOS",n.OPEN_BSD="Open BSD",n.SUN_OS="Sun OS",n.LINUX="Linux",n.IOS="iOS",n.MAC_OS="Mac OS",n.QNX="QNX",n.UNIX="UNIX",n.BEOS="BeOS",n.OS_2="OS/2",n.SEARCH_BOT="Search Bot"})(Qn||(Qn={})),function(n){n.CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger"}(ke||(ke={}));var oT={exports:{}};(function(n,t){(function(e,i){var s="function",r="undefined",a="object",c="string",l="major",u="model",h="name",f="type",g="vendor",S="version",w="architecture",b="console",I="mobile",U="tablet",F="smarttv",V="wearable",Z="embedded",$="Amazon",W="Apple",Y="ASUS",nt="BlackBerry",mt="Browser",ut="Chrome",ee="Firefox",Te="Google",be="Huawei",Fe="LG",_e="Microsoft",xn="Motorola",it="Opera",dt="Samsung",Rt="Sharp",$t="Sony",Ae="Xiaomi",ht="Zebra",C="Facebook",L="Chromium OS",B="Mac OS",ct=function(Sn){for(var Vn={},sn=0;sn<Sn.length;sn++)Vn[Sn[sn].toUpperCase()]=Sn[sn];return Vn},ne=function(Sn,Vn){return typeof Sn===c&&Ze(Vn).indexOf(Ze(Sn))!==-1},Ze=function(Sn){return Sn.toLowerCase()},Si=function(Sn,Vn){if(typeof Sn===c)return Sn=Sn.replace(/^\s\s*/,""),typeof Vn===r?Sn:Sn.substring(0,350)},Ts=function(Sn,Vn){for(var sn,Ss,Io,vn,we,us,Za=0;Za<Vn.length&&!we;){var Kr=Vn[Za],gN=Vn[Za+1];for(sn=Ss=0;sn<Kr.length&&!we&&Kr[sn];)if(we=Kr[sn++].exec(Sn))for(Io=0;Io<gN.length;Io++)us=we[++Ss],typeof(vn=gN[Io])===a&&vn.length>0?vn.length===2?typeof vn[1]==s?this[vn[0]]=vn[1].call(this,us):this[vn[0]]=vn[1]:vn.length===3?typeof vn[1]!==s||vn[1].exec&&vn[1].test?this[vn[0]]=us?us.replace(vn[1],vn[2]):i:this[vn[0]]=us?vn[1].call(this,us,vn[2]):i:vn.length===4&&(this[vn[0]]=us?vn[3].call(this,us.replace(vn[1],vn[2])):i):this[vn]=us||i;Za+=2}},ra=function(Sn,Vn){for(var sn in Vn)if(typeof Vn[sn]===a&&Vn[sn].length>0){for(var Ss=0;Ss<Vn[sn].length;Ss++)if(ne(Vn[sn][Ss],Sn))return sn==="?"?i:sn}else if(ne(Vn[sn],Sn))return sn==="?"?i:sn;return Sn},V_={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},F_={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,S],[/opios[\/ ]+([\w\.]+)/i],[S,[h,it+" Mini"]],[/\bopr\/([\w\.]+)/i],[S,[h,it]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[h,S],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[h,"UC"+mt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[S,[h,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[S,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[h,"IE"]],[/yabrowser\/([\w\.]+)/i],[S,[h,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+mt],S],[/\bfocus\/([\w\.]+)/i],[S,[h,ee+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[h,it+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[h,it+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[h,"MIUI "+mt]],[/fxios\/([-\w\.]+)/i],[S,[h,ee]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+mt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+mt],S],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[h,S],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,C],S],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[h,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[h,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[h,ut+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,ut+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[h,"Android "+mt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[S,ra,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[h,ee+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,S],[/(cobalt)\/([\w\.]+)/i],[h,[S,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[w,"amd64"]],[/(ia32(?=;))/i],[[w,Ze]],[/((?:i[346]|x)86)[;\)]/i],[[w,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[w,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[w,"armhf"]],[/windows (ce|mobile); ppc;/i],[[w,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[w,/ower/,"",Ze]],[/(sun4\w)[;\)]/i],[[w,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[w,Ze]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[g,dt],[f,U]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[g,dt],[f,I]],[/\((ip(?:hone|od)[\w ]*);/i],[u,[g,W],[f,I]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[g,W],[f,U]],[/(macintosh);/i],[u,[g,W]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[g,Rt],[f,I]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[g,be],[f,U]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[g,be],[f,I]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[g,Ae],[f,I]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[g,Ae],[f,U]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[g,"OPPO"],[f,I]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[g,"Vivo"],[f,I]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[g,"Realme"],[f,I]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[g,xn],[f,I]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[g,xn],[f,U]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[g,Fe],[f,U]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[g,Fe],[f,I]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[g,"Lenovo"],[f,U]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[g,"Nokia"],[f,I]],[/(pixel c)\b/i],[u,[g,Te],[f,U]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[g,Te],[f,I]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[g,$t],[f,I]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[g,$t],[f,U]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[g,"OnePlus"],[f,I]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[g,$],[f,U]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[g,$],[f,I]],[/(playbook);[-\w\),; ]+(rim)/i],[u,g,[f,U]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[g,nt],[f,I]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[g,Y],[f,U]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[g,Y],[f,I]],[/(nexus 9)/i],[u,[g,"HTC"],[f,U]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[u,/_/g," "],[f,I]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[g,"Acer"],[f,U]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[g,"Meizu"],[f,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,u,[f,I]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,u,[f,U]],[/(surface duo)/i],[u,[g,_e],[f,U]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[g,"Fairphone"],[f,I]],[/(u304aa)/i],[u,[g,"AT&T"],[f,I]],[/\bsie-(\w*)/i],[u,[g,"Siemens"],[f,I]],[/\b(rct\w+) b/i],[u,[g,"RCA"],[f,U]],[/\b(venue[\d ]{2,7}) b/i],[u,[g,"Dell"],[f,U]],[/\b(q(?:mv|ta)\w+) b/i],[u,[g,"Verizon"],[f,U]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[g,"Barnes & Noble"],[f,U]],[/\b(tm\d{3}\w+) b/i],[u,[g,"NuVision"],[f,U]],[/\b(k88) b/i],[u,[g,"ZTE"],[f,U]],[/\b(nx\d{3}j) b/i],[u,[g,"ZTE"],[f,I]],[/\b(gen\d{3}) b.+49h/i],[u,[g,"Swiss"],[f,I]],[/\b(zur\d{3}) b/i],[u,[g,"Swiss"],[f,U]],[/\b((zeki)?tb.*\b) b/i],[u,[g,"Zeki"],[f,U]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],u,[f,U]],[/\b(ns-?\w{0,9}) b/i],[u,[g,"Insignia"],[f,U]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[g,"NextBook"],[f,U]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],u,[f,I]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],u,[f,I]],[/\b(ph-1) /i],[u,[g,"Essential"],[f,I]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[g,"Envizen"],[f,U]],[/\b(trio[-\w\. ]+) b/i],[u,[g,"MachSpeed"],[f,U]],[/\btu_(1491) b/i],[u,[g,"Rotor"],[f,U]],[/(shield[\w ]+) b/i],[u,[g,"Nvidia"],[f,U]],[/(sprint) (\w+)/i],[g,u,[f,I]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[g,_e],[f,I]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[g,ht],[f,U]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[g,ht],[f,I]],[/smart-tv.+(samsung)/i],[g,[f,F]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[g,dt],[f,F]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,Fe],[f,F]],[/(apple) ?tv/i],[g,[u,W+" TV"],[f,F]],[/crkey/i],[[u,ut+"cast"],[g,Te],[f,F]],[/droid.+aft(\w)( bui|\))/i],[u,[g,$],[f,F]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[g,Rt],[f,F]],[/(bravia[\w ]+)( bui|\))/i],[u,[g,$t],[f,F]],[/(mitv-\w{5}) bui/i],[u,[g,Ae],[f,F]],[/Hbbtv.*(technisat) (.*);/i],[g,u,[f,F]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,Si],[u,Si],[f,F]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,F]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,u,[f,b]],[/droid.+; (shield) bui/i],[u,[g,"Nvidia"],[f,b]],[/(playstation [345portablevi]+)/i],[u,[g,$t],[f,b]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[g,_e],[f,b]],[/((pebble))app/i],[g,u,[f,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[g,W],[f,V]],[/droid.+; (glass) \d/i],[u,[g,Te],[f,V]],[/droid.+; (wt63?0{2,3})\)/i],[u,[g,ht],[f,V]],[/(quest( 2| pro)?)/i],[u,[g,C],[f,V]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[f,Z]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[f,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[f,U]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,U]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,I]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[h,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,S],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[h,[S,ra,V_]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,"Windows"],[S,ra,V_]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,B],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,S],[/\(bb(10);/i],[S,[h,nt]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[h,ee+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[h,ut+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,L],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,S],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[h,S]]},ur=function(Sn,Vn){if(typeof Sn===a&&(Vn=Sn,Sn=i),!(this instanceof ur))return new ur(Sn,Vn).getResult();var sn=typeof e!==r&&e.navigator?e.navigator:i,Ss=Sn||(sn&&sn.userAgent?sn.userAgent:""),Io=sn&&sn.userAgentData?sn.userAgentData:i,vn=Vn?function(we,us){var Za={};for(var Kr in we)us[Kr]&&us[Kr].length%2==0?Za[Kr]=us[Kr].concat(we[Kr]):Za[Kr]=we[Kr];return Za}(F_,Vn):F_;return this.getBrowser=function(){var we={};return we[h]=i,we[S]=i,Ts.call(we,Ss,vn.browser),we[l]=function(us){return typeof us===c?us.replace(/[^\d\.]/g,"").split(".")[0]:i}(we[S]),sn&&sn.brave&&typeof sn.brave.isBrave==s&&(we[h]="Brave"),we},this.getCPU=function(){var we={};return we[w]=i,Ts.call(we,Ss,vn.cpu),we},this.getDevice=function(){var we={};return we[g]=i,we[u]=i,we[f]=i,Ts.call(we,Ss,vn.device),!we[f]&&Io&&Io.mobile&&(we[f]=I),we[u]=="Macintosh"&&sn&&typeof sn.standalone!==r&&sn.maxTouchPoints&&sn.maxTouchPoints>2&&(we[u]="iPad",we[f]=U),we},this.getEngine=function(){var we={};return we[h]=i,we[S]=i,Ts.call(we,Ss,vn.engine),we},this.getOS=function(){var we={};return we[h]=i,we[S]=i,Ts.call(we,Ss,vn.os),!we[h]&&Io&&Io.platform!="Unknown"&&(we[h]=Io.platform.replace(/chrome os/i,L).replace(/macos/i,B)),we},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ss},this.setUA=function(we){return Ss=typeof we===c&&we.length>350?Si(we,350):we,this},this.setUA(Ss),this};ur.VERSION="0.7.34",ur.BROWSER=ct([h,S,l]),ur.CPU=ct([w]),ur.DEVICE=ct([u,g,f,b,I,F,U,V,Z]),ur.ENGINE=ur.OS=ct([h,S]),n.exports&&(t=n.exports=ur),t.UAParser=ur;var Qa=typeof e!==r&&(e.jQuery||e.Zepto);if(Qa&&!Qa.ua){var yl=new ur;Qa.ua=yl.getResult(),Qa.ua.get=function(){return yl.getUA()},Qa.ua.set=function(Sn){yl.setUA(Sn);var Vn=yl.getResult();for(var sn in Vn)Qa.ua[sn]=Vn[sn]}}})(typeof window=="object"?window:z)})(oT,oT.exports);const aT=new(rt(oT.exports));let Yo=aT.getResult(),cT=null;function Pe(n){if(!cT){n&&aT.setUA(n),Yo=aT.getResult();const t=function(r){if(r.engine.name==="Blink"&&r.browser.name!=="WeChat")return ke.CHROME;switch(r.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ke.CHROME;case"Safari":case"Mobile Safari":return ke.SAFARI;case"Edge":return ke.EDGE;case"Firefox":return ke.FIREFOX;case"QQBrowser":return ke.QQ;case"Opera":return ke.OPERA;case"WeChat":return ke.WECHAT;default:return r.browser.name||""}}(Yo),e=function(r){let a;return a=r.engine.name==="Blink"?r.engine.version||"":r.browser.version||"",a.split(".")[0]}(Yo),i=function(r){return r.os.name==="Windows"?r.os.version?r.os.name+" "+r.os.version:r.os.name:r.os.name||""}(Yo),s=Yo.os.version;if(!(t&&e&&i&&s))return{name:t,version:e,os:i,osVersion:s};cT={name:t,version:e,os:i,osVersion:s}}return cT}function yf(){return Pe().os}function EI(){const n=Pe();return"".concat(n.os," ").concat(n.osVersion)}function Cf(){const n=Pe();return!!(Yo.engine.name==="WebKit"&&n.os===Qn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&n.name!==ke.SAFARI||Fi()&&n.name!==ke.SAFARI)}function _B(){const n=Pe();if(Cf()){if(n.os===Qn.MAC_OS)return!0;if(n.os===Qn.IOS){const t=Yo.os.version&&Yo.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function mB(){return Yo.engine.name==="WebKit"}function dT(){return Pe().name===ke.CHROME}function Vi(){return Pe().name===ke.SAFARI}function nn(){return Pe().name===ke.FIREFOX}function Fi(){return Pe().os===Qn.IOS}function lT(n){const t=Pe();return!(t.name!==ke.CHROME||!t.osVersion)&&Number(t.version)>=n}function gI(n){const t=Pe();return!(t.name!==ke.EDGE||!t.osVersion)&&Number(t.version)>=n}function TI(n){const t=Pe();return!(t.name!==ke.OPERA||!t.osVersion)&&Number(t.version)>=n}function SI(){const n=Pe();return!(n.name!==ke.CHROME||!n.osVersion)&&Number(n.version)<=90}function vI(){const n=Pe();if(n.os!==Qn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Hd(){const n=Pe();if(n.os!==Qn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])===15}function uT(){const n=Pe();if(n.os!==Qn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])===16}function yI(){const n=Pe();if(n.os!==Qn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function po(){return Vi()&&navigator.maxTouchPoints>0}function CI(){return Pe().name===ke.WECHAT}function RI(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Oa(){const n=Pe();return n.name===ke.EDGE||n.name===ke.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Rf(){return yf()===Qn.ANDROID}function Fu(){const n=Pe();return Rf()&&(n.name===ke.CHROME||n.name===ke.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var O;(function(n){n.UNEXPECTED_ERROR="UNEXPECTED_ERROR",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.TIMEOUT="TIMEOUT",n.INVALID_PARAMS="INVALID_PARAMS",n.NOT_READABLE="NOT_READABLE",n.NOT_SUPPORTED="NOT_SUPPORTED",n.INVALID_OPERATION="INVALID_OPERATION",n.OPERATION_ABORTED="OPERATION_ABORTED",n.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",n.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",n.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",n.DATACHANNEL_FAILED="DATACHANNEL_FAILED",n.NETWORK_ERROR="NETWORK_ERROR",n.NETWORK_TIMEOUT="NETWORK_TIMEOUT",n.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",n.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",n.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",n.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",n.ELECTRON_IS_NULL="ELECTRON_IS_NULL",n.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",n.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",n.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",n.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",n.TRACK_IS_DISABLED="TRACK_IS_DISABLED",n.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",n.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",n.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",n.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",n.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",n.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",n.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",n.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",n.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",n.UID_CONFLICT="UID_CONFLICT",n.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",n.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",n.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",n.INVALID_TRACK="INVALID_TRACK",n.SENDER_NOT_FOUND="SENDER_NOT_FOUND",n.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",n.SET_ANSWER_FAILED="SET_ANSWER_FAILED",n.ICE_FAILED="ICE_FAILED",n.PC_CLOSED="PC_CLOSED",n.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",n.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",n.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",n.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",n.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",n.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",n.INVALID_REMOTE_USER="INVALID_REMOTE_USER",n.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",n.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",n.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",n.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",n.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",n.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",n.WS_ABORT="WS_ABORT",n.WS_DISCONNECT="WS_DISCONNECT",n.WS_ERR="WS_ERR",n.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",n.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",n.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",n.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",n.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",n.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",n.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",n.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",n.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",n.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",n.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",n.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",n.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",n.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",n.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",n.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",n.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",n.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",n.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",n.INVALID_PLUGIN="INVALID_PLUGIN",n.DISCONNECT_P2P="DISCONNECT_P2P",n.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",n.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",n.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",n.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",n.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",n.PROHIBITED_OPERATION="PROHIBITED_OPERATION",n.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"})(O||(O={}));let Q=class extends Error{constructor(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",e=arguments.length>2?arguments[2]:void 0;super(t),m(this,"code",void 0),m(this,"message",void 0),m(this,"data",void 0),m(this,"name","AgoraRTCException"),this.code=n,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=e}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return n==="error"&&(t||console).error(this.toString()),n==="warning"&&(t||console).warn(this.toString()),this}throw(n){throw this.print("error",n),this}};function Lc(n,t){if(typeof n!="boolean")throw new Q(O.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Kn(n,t,e){if(!Wt(e).call(e,n))throw new Q(O.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(e)))}function je(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(n<e||n>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(n))throw new Q(O.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(e,", ").concat(i,"]. integer only"))}function hT(n,t){if(typeof n!="number"){if(!(n.min||n.max||n.ideal||n.exact))throw new Q(O.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));n.min!==void 0&&je(n.min,"".concat(t,".min"),0,1/0),n.max!==void 0&&je(n.max,"".concat(t,".max"),1,1/0),n.exact!==void 0&&je(n.exact,"".concat(t,".exact"),1,1/0),n.ideal!==void 0&&je(n.ideal,"".concat(t,".ideal"),1,1/0)}else je(n,t,1,1/0)}function _i(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(n==null)throw new Q(O.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!bI(n,e,i,s))throw new Q(O.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(e,",").concat(i,"].").concat(s?" ASCII characters only.":""))}function zo(n,t){if(!Array.isArray(n))throw new Q(O.INVALID_PARAMS,"".concat(t," should be an array"))}function ln(n){return n==null}function bI(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof n=="string"&&n.length<=e&&n.length>=t&&(!i||function(s){if(typeof s!="string")return!1;for(let r=0;r<s.length;r+=1){const a=s.charCodeAt(r);if(a<0||a>255)return!1}return!0}(n))}function II(n,t,e){if("getBigUint64"in DataView.prototype)return n.getBigUint64(t,e);const i=n.getUint32(t,e),s=n.getUint32(t+4,e),r=+!!e,a=+!e;return BigInt(i*a+s*r)<<BigInt(32)|BigInt(i*r+s*a)}function AI(n,t,e,i){if("setBigUint64"in DataView.prototype)return n.setBigUint64(t,e,i);const s=Number(e>>BigInt(32)),r=Number(e&BigInt(4294967295));i?(n.setUint32(t+4,s,i),n.setUint32(t,r,i)):(n.setUint32(t,s,i),n.setUint32(t+4,r,i))}var Kd,bf;(function(n){n.COVERED="COVERED",n.POSITION="POSITION",n.SIZE="SIZE",n.STYLE="STYLE"})(Kd||(Kd={})),function(n){n.UNMOUNTED="UNMOUNTED",n.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(bf||(bf={}));const wI=new class{constructor(){m(this,"_clientSize",null),m(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),m(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),m(this,"getStyle",n=>window.getComputedStyle(n,null)),m(this,"checkCssVisibleProperty",n=>{var t;let e=!0;const i=this.getStyle(n),{display:s,visibility:r,opacity:a,filter:c}=i;return(s==="none"||Wt(t=["hidden","collapse"]).call(t,r)||Number(a)<.1)&&(e=!1),e?(c&&c.split(" ").filter(l=>{var u;const h=l.split("(")[0];return Wt(u=["brightness","blur","opacity"]).call(u,h)}).map(l=>{const[u,h]=l.split(/\(|\)/);return[u,Number(h.match(/^[0-9\.]+/))]}).forEach(l=>{const[u,h]=l;switch(u){case"brightness":(h<.1||h>3)&&(e=!1);break;case"blur":h>3&&(e=!1);break;case"opacity":h<.1&&(e=!1)}}),e):!1}),m(this,"checkPropertyUpToAllParentNodes",(n,t)=>{let e=!0,i=!0;const s=a=>t(a);let r=n;for(;r&&i;)s(r)||(e=!1,i=!1),r=r.parentElement,r||(i=!1);return e}),m(this,"checkActualCssVisibleIncludeInherit",n=>this.checkPropertyUpToAllParentNodes(n,this.checkCssVisibleProperty)),m(this,"getSizeAboutClient",n=>{const{width:t,height:e,left:i,right:s,top:r,bottom:a}=n.getBoundingClientRect(),c=this.getClientWidth(),l=this.getClientHeight();return{width:t,height:e,left:i,right:s,top:r,bottom:a,clientWidth:c,clientHeight:l,clientMin:Math.min(c,l)}}),m(this,"checkActualSize",()=>{const{width:n,height:t,clientMin:e}=this._clientSize;return this.checkSizeIsVisible(n,t,e)}),m(this,"elementFromPoint",(n,t)=>document.elementFromPoint?document.elementFromPoint(n,t):null),m(this,"checkCoverForAPoint",(n,t,e)=>{const i=this.elementFromPoint(n,t);return i!==null&&i!==e}),m(this,"getPointPositionList",()=>{const{width:n,height:t,left:e,top:i}=this._clientSize,s=n/6,r=t/6,a=[],c=10**6;for(let l=0;l<5;l++)for(let u=0;u<5;u++){const h=(e*c+(l===0?.1:l===4?(s*l*c-1e5)/c:s*l)*c)/c,f=(i*c+(u===0?.1:u===4?(r*u*c-1e5)/c:r*u)*c)/c;a.push({x:h,y:f})}return[...a]}),m(this,"checkElementCover",n=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,n)).filter(t=>!!t).length>6),m(this,"checkSizeIsVisible",(n,t,e)=>(n>50||e/n<=10)&&(t>50||e/t<=10)),m(this,"checkSizeOfPartInClient",()=>{const{left:n,right:t,top:e,bottom:i,clientHeight:s,clientWidth:r,clientMin:a}=this._clientSize;let c,l,u,h;if(n<0)c=0;else{if(!(n<r))return!1;c=n}if(t<0)return!1;if(l=t<r?t:r,e<0)u=0;else{if(!(e<s))return!1;u=e}if(i<0)return!1;h=i<s?i:s;const f=l-c,g=h-u;return this.checkSizeIsVisible(f,g,a)}),m(this,"returnHiddenResult",n=>(this._clientSize=null,{visible:!1,reason:n})),m(this,"checkOneElementVisible",n=>{if(n instanceof HTMLElement){if(this.checkElementIsMountedOnDom(n)){if(this.checkActualCssVisibleIncludeInherit(n)){if(this._clientSize=this.getSizeAboutClient(n),this.checkElementCover(n))return this.returnHiddenResult(Kd.COVERED);{const t=this.checkActualSize(),e=this.checkSizeOfPartInClient();return t&&!e?this.returnHiddenResult(Kd.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Kd.SIZE)}}return this.returnHiddenResult(Kd.STYLE)}return this.returnHiddenResult(bf.UNMOUNTED)}return this.returnHiddenResult(bf.INVALID_HTML_ELEMENT)}),m(this,"checkElementIsMountedOnDom",n=>this.checkPropertyUpToAllParentNodes(n,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function pT(n){return new TextEncoder().encode(n)}const OI=function(n,t){const e=new Uint8Array(n.byteLength+t.byteLength);return e.set(new Uint8Array(n),0),e.set(new Uint8Array(t),n.byteLength),e},EB=async n=>{const t=function(r){const a=window.atob(r),c=new Uint8Array(new ArrayBuffer(a.length));for(let l=0;l<a.length;l+=1)c[l]=a.charCodeAt(l);return c}(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),e=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=pT(n),s=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},e,i);return function(r){let a="";for(let c=0;c<r.length;c+=1)a+=String.fromCharCode(r[c]);return window.btoa(a)}(new Uint8Array(s))},gB=async n=>function(t,e){let i="";return new Uint8Array(t).forEach(s=>{i+=s.toString(e).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",pT(n)),16);class rn{constructor(){m(this,"_events",{}),m(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,e)===-1&&i.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,e)===-1&&i.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,e);s!==-1&&i.splice(s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(a=>a);for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];for(let a=0;a<e.length;a+=1){const c=e[a];c.once&&this.off(t,c.listener),c.listener.apply(this,s||[])}}safeEmit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,i)}catch(a){console.error("safeEmit event:".concat(t," error ").concat(a==null?void 0:a.toString()))}})}_indexOfListener(t,e){let i=t.length;for(;i--;)if(t[i].listener===e)return i;return-1}}let Bu=null;function NI(){if(Bu)return Bu;if(window.electron)return Bu=window.electron;if(!window.require)return null;try{return Bu=window.require("electron"),Bu}catch{return null}}var Mn,un,fT,fe,me,qn,ki,Jo;function DI(n){return je(n.timeout,"config.timeout",0,1e5),je(n.timeoutFactor,"config.timeoutFactor",0,100,!1),je(n.maxRetryCount,"config.maxRetryConfig",0,1/0),je(n.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function qd(n){if(!Array.isArray(n)||n.length<1)return!1;try{n.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function PI(n){return _i(n.turnServerURL,"turnServerURL"),_i(n.username,"username"),_i(n.password,"password"),n.udpport&&je(n.udpport,"udpport",1,99999,!0),n.forceturn&&Lc(n.forceturn,"forceturn"),n.security&&Lc(n.security,"security"),n.tcpport&&je(n.tcpport,"tcpport",1,99999,!0),!0}function LI(n){return n.level!==void 0&&Kn(n.level,"level",[1,2,3]),n.delay!==void 0&&je(n.delay,"delay",0,3e3,!0),!0}function hn(n,t){for(var e=arguments.length,i=new Array(e>2?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return n.getListeners(t).length===0?K.reject(new Q(O.UNEXPECTED_ERROR,"can not emit promise")):new K((r,a)=>{n.emit(t,...i,r,a)})}function qe(n,t){if(n.getListeners(t).length===0)return K.resolve();for(var e=arguments.length,i=new Array(e>2?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return hn(n,t,...i)}function _s(n,t){if(n.getListeners(t).length===0)return null;for(var e=arguments.length,i=new Array(e>2?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return Xo(n,t,...i)}function Xo(n,t){let e=null,i=null;for(var s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];if(n.emit(t,...r,c=>{e=c},c=>{i=c}),i!==null)throw i;if(e===null)throw new Q(O.UNEXPECTED_ERROR,"handler is not sync");return e}(function(n){n.CREATE_CLIENT="createClient",n.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",n.SET_AREA="setArea",n.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",n.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",n.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",n.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",n.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",n.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",n.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",n.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",n.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",n.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",n.START_PROXY_SERVER="Client.startProxyServer",n.STOP_PROXY_SERVER="Client.stopProxyServer",n.SET_PROXY_SERVER="Client.setProxyServer",n.SET_TURN_SERVER="Client.setTurnServer",n.SET_CLIENT_ROLE="Client.setClientRole",n.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",n.ENABLE_DUAL_STREAM="Client.enableDualStream",n.DISABLE_DUAL_STREAM="Client.disableDualStream",n.JOIN="Client.join",n.LEAVE="Client.leave",n.PUBLISH="Client.publish",n.UNPUBLISH="Client.unpublish",n.SUBSCRIBE="Client.subscribe",n.MASS_SUBSCRIBE="Client.massSubscribe",n.MASS_UNSUBSCRIBE="Client.massUnsubscribe",n.UNSUBSCRIBE="Client.unsubscribe",n.RENEW_TOKEN="Client.renewToken",n.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",n.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",n.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",n.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",n.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",n.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",n.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",n.DATACHANNEL_FAILBACK="Client._datachannelFailback",n.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",n.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",n.START_LIVE_STREAMING="Client.startLiveStreaming",n.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",n.STOP_LIVE_STREAMING="Client.stopLiveStreaming",n.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",n.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",n.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",n.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",n.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",n.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",n.SET_CONFIG_DISTRIBUTE="_configDistribute",n.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",n.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",n.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",n.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",n.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",n.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",n.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",n.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",n.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",n.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",n.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",n.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",n.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",n.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",n.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",n.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",n.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",n.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",n.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",n.STREAM_TYPE_CHANGE="streamTypeChange",n.CONNECTION_STATE_CHANGE="connectionStateChange",n.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",n.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(Mn||(Mn={})),function(n){n.TRACER="tracer"}(un||(un={})),function(n){n[n.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",n[n.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",n[n.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(fT||(fT={})),function(n){n.LEAVE="LEAVE",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.UID_BANNED="UID_BANNED",n.IP_BANNED="IP_BANNED",n.CHANNEL_BANNED="CHANNEL_BANNED",n.FALLBACK="FALLBACK",n.LICENSE_MISSING="LICENSE_MISSING",n.LICENSE_EXPIRED="LICENSE_EXPIRED",n.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",n.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",n.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",n.LICENSE_ILLEGAL="LICENSE_ILLEGAL",n.TOKEN_EXPIRE="TOKEN_EXPIRE"}(fe||(fe={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.MEDIA_RECONNECT_START="media-reconnect-start",n.MEDIA_RECONNECT_END="media-reconnect-end",n.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",n.USER_JOINED="user-joined",n.USER_LEAVED="user-left",n.USER_PUBLISHED="user-published",n.USER_UNPUBLISHED="user-unpublished",n.USER_INFO_UPDATED="user-info-updated",n.CLIENT_BANNED="client-banned",n.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",n.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",n.VOLUME_INDICATOR="volume-indicator",n.CRYPT_ERROR="crypt-error",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGED="stream-type-changed",n.STREAM_FALLBACK="stream-fallback",n.RECEIVE_METADATA="receive-metadata",n.STREAM_MESSAGE="stream-message",n.LIVE_STREAMING_ERROR="live-streaming-error",n.LIVE_STREAMING_WARNING="live-streaming-warning",n.INJECT_STREAM_STATUS="stream-inject-status",n.EXCEPTION="exception",n.ERROR="error",n.P2P_LOST="p2p_lost",n.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",n.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",n.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",n.PUBLISHED_USER_LIST="published-user-list",n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",n.CONTENT_INSPECT_ERROR="content-inspect-error",n.CONTENT_INSPECT_RESULT="content-inspect-result",n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(me||(me={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}(qn||(qn={})),function(n){n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(ki||(ki={})),function(n){n.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(Jo||(Jo={}));const On=new class extends rn{set networkState(n){this.emit(Jo.NETWORK_STATE_CHANGE,n,this._networkState),n===ki.ONLINE?this.emit(Jo.ONLINE):n===ki.OFFLINE&&(this.onlineWaiter=new K(t=>{this.once(Jo.ONLINE,()=>{this.onlineWaiter=void 0,t(ki.ONLINE)})}),this.emit(Jo.OFFLINE)),this._networkState=n}get networkState(){return this._networkState}get isOnline(){return this._networkState===ki.ONLINE}constructor(){super(),m(this,"_moduleName","network-indicator"),m(this,"_networkState",ki.ONLINE),m(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ki.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ki.OFFLINE})}};function kI(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function kc(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?kI(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):kI(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function _T(n,t){const e=n.indexOf(t);e!==-1&&n.splice(e,1)}function Yd(n){const t=[];return n.forEach(e=>{t.indexOf(e)===-1&&t.push(e)}),t}function vr(n){K!==void 0?K.resolve().then(n):setTimeout(n,0)}function Nn(n){return JSON.parse(JSON.stringify(n))}function Mc(n){try{return Nn(n)}catch{return n}}const MI={};function ju(n,t){MI[t]||(MI[t]=!0,n())}function If(n){const t=window.atob(n),e=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)e[i]=t.charCodeAt(i);return e}function Af(n){let t="";for(let e=0;e<n.length;e+=1)t+=String.fromCharCode(n[e]);return window.btoa(t)}function fo(n){return window.TextEncoder?new TextEncoder().encode(n).length:n.length}function UI(n){let t=0;return/DingTalk/i.test(navigator.userAgent)&&n.realFormData&&(n=n.realFormData),n.forEach(e=>{t+=typeof e=="string"?fo(e):e.size}),t+138}function TB(n){const t=new Q(O.TIMEOUT,"timeout");return new K((e,i)=>{window.setTimeout(()=>i(t),n)})}function hi(n){return new K(t=>{window.setTimeout(t,n)})}function Ge(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const e=Math.random().toString(16).substr(2,n).toLowerCase();return e.length===n?"".concat(t).concat(e):"".concat(t).concat(e)+Ge(n-e.length,"")}function mT(){return Ge(32,"").toUpperCase()}const wf=()=>{},xI=new class{constructor(){m(this,"fnMap",new Map)}throttleByKey(n,t,e,i){for(var s=arguments.length,r=new Array(s>4?s-4:0),a=4;a<s;a++)r[a-4]=arguments[a];if(this.fnMap.has(t)){const c=this.fnMap.get(t);if(c.threshold!==e){c.fn(...c.args),clearTimeout(c.timer);const l=window.setTimeout(()=>{const u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},e);this.fnMap.set(t,{fn:n,threshold:e,timer:l,args:r,skipFn:i})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(t,kc(kc({},c),{},{fn:n,args:r,skipFn:i}))}else{const c=window.setTimeout(()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},e);this.fnMap.set(t,{fn:n,threshold:e,timer:c,args:r,skipFn:i})}}},VI=xI.throttleByKey.bind(xI);function FI(n){return typeof n=="object"&&n!==null&&!(n instanceof RegExp)}function ET(n,t){if(!FI(n)||!FI(t)||Array.isArray(n)&&!Array.isArray(t)||!Array.isArray(n)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(n)){const e=[...n];for(let i=0;i<t.length;i++)e[i]=ET(n[i],t[i]);return e}{const e=kc({},n);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(n,i)?e[i]=ET(n[i],t[i]):e[i]=t[i]);return e}}let SB=1,Of=console;class Zn{static setLogger(t){Of=t}constructor(t){m(this,"lockingPromise",K.resolve()),m(this,"locks",0),m(this,"name",""),m(this,"lockId",void 0),this.lockId=SB++,t&&(this.name=t),Of.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,Of.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const i=new K(r=>{e=()=>{this.locks-=1,Of.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),r()}}),s=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>i),s}}function zd(n,t){return function(e,i,s){const r=s.value;if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const a=this[t];if(!a)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(n));const c=await a.lock("From ".concat(n,".").concat(i));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await r.apply(this,u)}finally{c()}},s}}const Dn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Nf(n,t){const e=Math.floor(t.timeout*Math.pow(t.timeoutFactor,n));return Math.min(t.maxRetryTimeout,e)}function jr(n,t,e,i){const s=Object.assign({},Dn,i);let r=s.timeout;const a=async()=>{await function(u){return new K(h=>{window.setTimeout(h,u)})}(r),r*=s.timeoutFactor,r=Math.min(s.maxRetryTimeout,r)};let c=!1;const l=new K(async(u,h)=>{t=t||(()=>!1),e=e||(()=>!0);for(let f=0;f<s.maxRetryCount;f+=1){if(c)return h(new Q(O.OPERATION_ABORTED));try{const g=await n();if(!t(g,f)||f+1===s.maxRetryCount)return u(g);await a()}catch(g){if(!e(g,f)||f+1===s.maxRetryCount)return h(g);await a()}}});return l.cancel=()=>c=!0,l}var vB=ws,yB=oo,CB=Ql,RB=Ji,bB=TypeError,BI=function(n){return function(t,e,i,s){vB(e);var r=yB(t),a=CB(r),c=RB(r),l=n?c-1:0,u=n?-1:1;if(i<2)for(;;){if(l in a){s=a[l],l+=u;break}if(l+=u,n?l<0:c<=l)throw bB("Reduce of empty array with no initial value")}for(;n?l>=0:c>l;l+=u)l in a&&(s=e(s,a[l],l,r));return s}},IB={left:BI(!1),right:BI(!0)}.left;y({target:"Array",proto:!0,forced:!Pu&&Fo>79&&Fo<83||!nb("reduce")},{reduce:function(n){var t=arguments.length;return IB(this,n,t,t>1?arguments[1]:void 0)}});var AB=Ic("Array").reduce,wB=Cn,OB=AB,gT=Array.prototype,Uc=rt(function(n){var t=n.reduce;return n===gT||wB(gT,n)&&t===gT.reduce?OB:t});let TT=class{constructor(n){m(this,"input",[]),m(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}mean(){var n;return this.input.length===0?0:Uc(n=this.input).call(n,(t,e)=>t+e)/this.input.length}};var ST,vT={exports:{}},jI=function(n,t){return function(){for(var e=new Array(arguments.length),i=0;i<e.length;i++)e[i]=arguments[i];return n.apply(t,e)}},NB=jI,yT=Object.prototype.toString,CT=(ST=Object.create(null),function(n){var t=yT.call(n);return ST[t]||(ST[t]=t.slice(8,-1).toLowerCase())});function xc(n){return n=n.toLowerCase(),function(t){return CT(t)===n}}function RT(n){return Array.isArray(n)}function Df(n){return n===void 0}var GI=xc("ArrayBuffer");function WI(n){return n!==null&&typeof n=="object"}function Pf(n){if(CT(n)!=="object")return!1;var t=Object.getPrototypeOf(n);return t===null||t===Object.prototype}var DB=xc("Date"),PB=xc("File"),LB=xc("Blob"),kB=xc("FileList");function bT(n){return yT.call(n)==="[object Function]"}var MB=xc("URLSearchParams");function IT(n,t){if(n!=null)if(typeof n!="object"&&(n=[n]),RT(n))for(var e=0,i=n.length;e<i;e++)t.call(null,n[e],e,n);else for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.call(null,n[s],s,n)}var AT,UB=(AT=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(n){return AT&&n instanceof AT}),Xi={isArray:RT,isArrayBuffer:GI,isBuffer:function(n){return n!==null&&!Df(n)&&n.constructor!==null&&!Df(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)},isFormData:function(n){var t="[object FormData]";return n&&(typeof FormData=="function"&&n instanceof FormData||yT.call(n)===t||bT(n.toString)&&n.toString()===t)},isArrayBufferView:function(n){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&GI(n.buffer)},isString:function(n){return typeof n=="string"},isNumber:function(n){return typeof n=="number"},isObject:WI,isPlainObject:Pf,isUndefined:Df,isDate:DB,isFile:PB,isBlob:LB,isFunction:bT,isStream:function(n){return WI(n)&&bT(n.pipe)},isURLSearchParams:MB,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:IT,merge:function n(){var t={};function e(r,a){Pf(t[a])&&Pf(r)?t[a]=n(t[a],r):Pf(r)?t[a]=n({},r):RT(r)?t[a]=r.slice():t[a]=r}for(var i=0,s=arguments.length;i<s;i++)IT(arguments[i],e);return t},extend:function(n,t,e){return IT(t,function(i,s){n[s]=e&&typeof i=="function"?NB(i,e):i}),n},trim:function(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")},stripBOM:function(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n},inherits:function(n,t,e,i){n.prototype=Object.create(t.prototype,i),n.prototype.constructor=n,e&&Object.assign(n.prototype,e)},toFlatObject:function(n,t,e){var i,s,r,a={};t=t||{};do{for(s=(i=Object.getOwnPropertyNames(n)).length;s-- >0;)a[r=i[s]]||(t[r]=n[r],a[r]=!0);n=Object.getPrototypeOf(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},kindOf:CT,kindOfTest:xc,endsWith:function(n,t,e){n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;var i=n.indexOf(t,e);return i!==-1&&i===e},toArray:function(n){if(!n)return null;var t=n.length;if(Df(t))return null;for(var e=new Array(t);t-- >0;)e[t]=n[t];return e},isTypedArray:UB,isFileList:kB},Jd=Xi;function HI(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var KI=function(n,t,e){if(!t)return n;var i;if(e)i=e(t);else if(Jd.isURLSearchParams(t))i=t.toString();else{var s=[];Jd.forEach(t,function(a,c){a!=null&&(Jd.isArray(a)?c+="[]":a=[a],Jd.forEach(a,function(l){Jd.isDate(l)?l=l.toISOString():Jd.isObject(l)&&(l=JSON.stringify(l)),s.push(HI(c)+"="+HI(l))}))}),i=s.join("&")}if(i){var r=n.indexOf("#");r!==-1&&(n=n.slice(0,r)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n},xB=Xi;function Lf(){this.handlers=[]}Lf.prototype.use=function(n,t,e){return this.handlers.push({fulfilled:n,rejected:t,synchronous:!!e&&e.synchronous,runWhen:e?e.runWhen:null}),this.handlers.length-1},Lf.prototype.eject=function(n){this.handlers[n]&&(this.handlers[n]=null)},Lf.prototype.forEach=function(n){xB.forEach(this.handlers,function(t){t!==null&&n(t)})};var qI,YI,VB=Lf,FB=Xi;function Xd(){if(YI)return qI;YI=1;var n=Xi;function t(s,r,a,c,l){Error.call(this),this.message=s,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),c&&(this.request=c),l&&(this.response=l)}n.inherits(t,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var e=t.prototype,i={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(s){i[s]={value:s}}),Object.defineProperties(t,i),Object.defineProperty(e,"isAxiosError",{value:!0}),t.from=function(s,r,a,c,l,u){var h=Object.create(e);return n.toFlatObject(s,h,function(f){return f!==Error.prototype}),t.call(h,s.message,r,a,c,l),h.name=s.name,u&&Object.assign(h,u),h},qI=t}var wT,zI,JI,XI,OT,$I,QI={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function ZI(){if(zI)return wT;zI=1;var n=Xi;return wT=function(t,e){e=e||new FormData;var i=[];function s(r){return r===null?"":n.isDate(r)?r.toISOString():n.isArrayBuffer(r)||n.isTypedArray(r)?typeof Blob=="function"?new Blob([r]):Buffer.from(r):r}return function r(a,c){if(n.isPlainObject(a)||n.isArray(a)){if(i.indexOf(a)!==-1)throw Error("Circular reference detected in "+c);i.push(a),n.forEach(a,function(l,u){if(!n.isUndefined(l)){var h,f=c?c+"."+u:u;if(l&&!c&&typeof l=="object"){if(n.endsWith(u,"{}"))l=JSON.stringify(l);else if(n.endsWith(u,"[]")&&(h=n.toArray(l)))return void h.forEach(function(g){!n.isUndefined(g)&&e.append(f,s(g))})}r(l,f)}}),i.pop()}else e.append(c,s(a))}(t),e},wT}function BB(){if(XI)return JI;XI=1;var n=Xd();return JI=function(t,e,i){var s=i.config.validateStatus;i.status&&s&&!s(i.status)?e(new n("Request failed with status code "+i.status,[n.ERR_BAD_REQUEST,n.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}}function jB(){if($I)return OT;$I=1;var n=Xi;return OT=n.isStandardBrowserEnv()?{write:function(t,e,i,s,r,a){var c=[];c.push(t+"="+encodeURIComponent(e)),n.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),n.isString(s)&&c.push("path="+s),n.isString(r)&&c.push("domain="+r),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},OT}var NT,tA,eA,nA,iA,sA,rA,oA,DT,aA,cA,dA,GB=function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)},WB=function(n,t){return t?n.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):n},lA=function(n,t){return n&&!GB(t)?WB(n,t):t};function HB(){if(tA)return NT;tA=1;var n=Xi,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return NT=function(e){var i,s,r,a={};return e&&n.forEach(e.split(`
`),function(c){if(r=c.indexOf(":"),i=n.trim(c.substr(0,r)).toLowerCase(),s=n.trim(c.substr(r+1)),i){if(a[i]&&t.indexOf(i)>=0)return;a[i]=i==="set-cookie"?(a[i]?a[i]:[]).concat([s]):a[i]?a[i]+", "+s:s}}),a},NT}function KB(){if(nA)return eA;nA=1;var n=Xi;return eA=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function s(r){var a=r;return e&&(i.setAttribute("href",a),a=i.href),i.setAttribute("href",a),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return t=s(window.location.href),function(r){var a=n.isString(r)?s(r):r;return a.protocol===t.protocol&&a.host===t.host}}():function(){return!0}}function kf(){if(sA)return iA;sA=1;var n=Xd();function t(e){n.call(this,e??"canceled",n.ERR_CANCELED),this.name="CanceledError"}return Xi.inherits(t,n,{__CANCEL__:!0}),iA=t}function qB(){return oA||(oA=1,rA=function(n){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}),rA}function YB(){if(aA)return DT;aA=1;var n=Xi,t=BB(),e=jB(),i=KI,s=lA,r=HB(),a=KB(),c=QI,l=Xd(),u=kf(),h=qB();return DT=function(f){return new Promise(function(g,S){var w,b=f.data,I=f.headers,U=f.responseType;function F(){f.cancelToken&&f.cancelToken.unsubscribe(w),f.signal&&f.signal.removeEventListener("abort",w)}n.isFormData(b)&&n.isStandardBrowserEnv()&&delete I["Content-Type"];var V=new XMLHttpRequest;if(f.auth){var Z=f.auth.username||"",$=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"";I.Authorization="Basic "+btoa(Z+":"+$)}var W=s(f.baseURL,f.url);function Y(){if(V){var ut="getAllResponseHeaders"in V?r(V.getAllResponseHeaders()):null,ee={data:U&&U!=="text"&&U!=="json"?V.response:V.responseText,status:V.status,statusText:V.statusText,headers:ut,config:f,request:V};t(function(Te){g(Te),F()},function(Te){S(Te),F()},ee),V=null}}if(V.open(f.method.toUpperCase(),i(W,f.params,f.paramsSerializer),!0),V.timeout=f.timeout,"onloadend"in V?V.onloadend=Y:V.onreadystatechange=function(){V&&V.readyState===4&&(V.status!==0||V.responseURL&&V.responseURL.indexOf("file:")===0)&&setTimeout(Y)},V.onabort=function(){V&&(S(new l("Request aborted",l.ECONNABORTED,f,V)),V=null)},V.onerror=function(){S(new l("Network Error",l.ERR_NETWORK,f,V,V)),V=null},V.ontimeout=function(){var ut=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded",ee=f.transitional||c;f.timeoutErrorMessage&&(ut=f.timeoutErrorMessage),S(new l(ut,ee.clarifyTimeoutError?l.ETIMEDOUT:l.ECONNABORTED,f,V)),V=null},n.isStandardBrowserEnv()){var nt=(f.withCredentials||a(W))&&f.xsrfCookieName?e.read(f.xsrfCookieName):void 0;nt&&(I[f.xsrfHeaderName]=nt)}"setRequestHeader"in V&&n.forEach(I,function(ut,ee){b===void 0&&ee.toLowerCase()==="content-type"?delete I[ee]:V.setRequestHeader(ee,ut)}),n.isUndefined(f.withCredentials)||(V.withCredentials=!!f.withCredentials),U&&U!=="json"&&(V.responseType=f.responseType),typeof f.onDownloadProgress=="function"&&V.addEventListener("progress",f.onDownloadProgress),typeof f.onUploadProgress=="function"&&V.upload&&V.upload.addEventListener("progress",f.onUploadProgress),(f.cancelToken||f.signal)&&(w=function(ut){V&&(S(!ut||ut&&ut.type?new u:ut),V.abort(),V=null)},f.cancelToken&&f.cancelToken.subscribe(w),f.signal&&(f.signal.aborted?w():f.signal.addEventListener("abort",w))),b||(b=null);var mt=h(W);mt&&["http","https","file"].indexOf(mt)===-1?S(new l("Unsupported protocol "+mt+":",l.ERR_BAD_REQUEST,f)):V.send(b)})},DT}var Bi=Xi,uA=function(n,t){FB.forEach(n,function(e,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(n[t]=e,delete n[i])})},hA=Xd(),zB=QI,JB=ZI(),XB={"Content-Type":"application/x-www-form-urlencoded"};function pA(n,t){!Bi.isUndefined(n)&&Bi.isUndefined(n["Content-Type"])&&(n["Content-Type"]=t)}var fA,Mf={transitional:zB,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(fA=YB()),fA),transformRequest:[function(n,t){if(uA(t,"Accept"),uA(t,"Content-Type"),Bi.isFormData(n)||Bi.isArrayBuffer(n)||Bi.isBuffer(n)||Bi.isStream(n)||Bi.isFile(n)||Bi.isBlob(n))return n;if(Bi.isArrayBufferView(n))return n.buffer;if(Bi.isURLSearchParams(n))return pA(t,"application/x-www-form-urlencoded;charset=utf-8"),n.toString();var e,i=Bi.isObject(n),s=t&&t["Content-Type"];if((e=Bi.isFileList(n))||i&&s==="multipart/form-data"){var r=this.env&&this.env.FormData;return JB(e?{"files[]":n}:n,r&&new r)}return i||s==="application/json"?(pA(t,"application/json"),function(a,c,l){if(Bi.isString(a))try{return(c||JSON.parse)(a),Bi.trim(a)}catch(u){if(u.name!=="SyntaxError")throw u}return(l||JSON.stringify)(a)}(n)):n}],transformResponse:[function(n){var t=this.transitional||Mf.transitional,e=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,s=!e&&this.responseType==="json";if(s||i&&Bi.isString(n)&&n.length)try{return JSON.parse(n)}catch(r){if(s)throw r.name==="SyntaxError"?hA.from(r,hA.ERR_BAD_RESPONSE,this,null,this.response):r}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:dA?cA:(dA=1,cA=null)},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Bi.forEach(["delete","get","head"],function(n){Mf.headers[n]={}}),Bi.forEach(["post","put","patch"],function(n){Mf.headers[n]=Bi.merge(XB)});var _A,mA,PT=Mf,$B=Xi,QB=PT;function EA(){return mA?_A:(mA=1,_A=function(n){return!(!n||!n.__CANCEL__)})}var gA=Xi,LT=function(n,t,e){var i=this||QB;return $B.forEach(e,function(s){n=s.call(i,n,t)}),n},ZB=EA(),tj=PT,ej=kf();function kT(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new ej}var TA,SA,Qs=Xi,vA=function(n,t){t=t||{};var e={};function i(u,h){return Qs.isPlainObject(u)&&Qs.isPlainObject(h)?Qs.merge(u,h):Qs.isPlainObject(h)?Qs.merge({},h):Qs.isArray(h)?h.slice():h}function s(u){return Qs.isUndefined(t[u])?Qs.isUndefined(n[u])?void 0:i(void 0,n[u]):i(n[u],t[u])}function r(u){if(!Qs.isUndefined(t[u]))return i(void 0,t[u])}function a(u){return Qs.isUndefined(t[u])?Qs.isUndefined(n[u])?void 0:i(void 0,n[u]):i(void 0,t[u])}function c(u){return u in t?i(n[u],t[u]):u in n?i(void 0,n[u]):void 0}var l={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return Qs.forEach(Object.keys(n).concat(Object.keys(t)),function(u){var h=l[u]||s,f=h(u);Qs.isUndefined(f)&&h!==c||(e[u]=f)}),e};function yA(){return SA?TA:(SA=1,TA={version:"0.27.2"})}var nj=yA().version,Na=Xd(),MT={};["object","boolean","number","function","string","symbol"].forEach(function(n,t){MT[n]=function(e){return typeof e===n||"a"+(t<1?"n ":" ")+n}});var CA={};MT.transitional=function(n,t,e){function i(s,r){return"[Axios v"+nj+"] Transitional option '"+s+"'"+r+(e?". "+e:"")}return function(s,r,a){if(n===!1)throw new Na(i(r," has been removed"+(t?" in "+t:"")),Na.ERR_DEPRECATED);return t&&!CA[r]&&(CA[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!n||n(s,r,a)}};var RA,bA,IA,AA,wA,OA,ij={assertOptions:function(n,t,e){if(typeof n!="object")throw new Na("options must be an object",Na.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(n),s=i.length;s-- >0;){var r=i[s],a=t[r];if(a){var c=n[r],l=c===void 0||a(c,r,n);if(l!==!0)throw new Na("option "+r+" must be "+l,Na.ERR_BAD_OPTION_VALUE)}else if(e!==!0)throw new Na("Unknown option "+r,Na.ERR_BAD_OPTION)}},validators:MT},NA=Xi,sj=KI,DA=VB,PA=function(n){return kT(n),n.headers=n.headers||{},n.data=LT.call(n,n.data,n.headers,n.transformRequest),n.headers=gA.merge(n.headers.common||{},n.headers[n.method]||{},n.headers),gA.forEach(["delete","get","head","post","put","patch","common"],function(t){delete n.headers[t]}),(n.adapter||tj.adapter)(n).then(function(t){return kT(n),t.data=LT.call(n,t.data,t.headers,n.transformResponse),t},function(t){return ZB(t)||(kT(n),t&&t.response&&(t.response.data=LT.call(n,t.response.data,t.response.headers,n.transformResponse))),Promise.reject(t)})},Uf=vA,rj=lA,LA=ij,$d=LA.validators;function Qd(n){this.defaults=n,this.interceptors={request:new DA,response:new DA}}Qd.prototype.request=function(n,t){typeof n=="string"?(t=t||{}).url=n:t=n||{},(t=Uf(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=t.transitional;e!==void 0&&LA.assertOptions(e,{silentJSONParsing:$d.transitional($d.boolean),forcedJSONParsing:$d.transitional($d.boolean),clarifyTimeoutError:$d.transitional($d.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(t)===!1||(s=s&&f.synchronous,i.unshift(f.fulfilled,f.rejected))});var r,a=[];if(this.interceptors.response.forEach(function(f){a.push(f.fulfilled,f.rejected)}),!s){var c=[PA,void 0];for(Array.prototype.unshift.apply(c,i),c=c.concat(a),r=Promise.resolve(t);c.length;)r=r.then(c.shift(),c.shift());return r}for(var l=t;i.length;){var u=i.shift(),h=i.shift();try{l=u(l)}catch(f){h(f);break}}try{r=PA(l)}catch(f){return Promise.reject(f)}for(;a.length;)r=r.then(a.shift(),a.shift());return r},Qd.prototype.getUri=function(n){n=Uf(this.defaults,n);var t=rj(n.baseURL,n.url);return sj(t,n.params,n.paramsSerializer)},NA.forEach(["delete","get","head","options"],function(n){Qd.prototype[n]=function(t,e){return this.request(Uf(e||{},{method:n,url:t,data:(e||{}).data}))}}),NA.forEach(["post","put","patch"],function(n){function t(e){return function(i,s,r){return this.request(Uf(r||{},{method:n,headers:e?{"Content-Type":"multipart/form-data"}:{},url:i,data:s}))}}Qd.prototype[n]=t(),Qd.prototype[n+"Form"]=t(!0)});var kA=Xi,oj=jI,xf=Qd,aj=vA,Ls=function n(t){var e=new xf(t),i=oj(xf.prototype.request,e);return kA.extend(i,xf.prototype,e),kA.extend(i,e),i.create=function(s){return n(aj(t,s))},i}(PT);Ls.Axios=xf,Ls.CanceledError=kf(),Ls.CancelToken=function(){if(bA)return RA;bA=1;var n=kf();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var i;this.promise=new Promise(function(r){i=r});var s=this;this.promise.then(function(r){if(s._listeners){var a,c=s._listeners.length;for(a=0;a<c;a++)s._listeners[a](r);s._listeners=null}}),this.promise.then=function(r){var a,c=new Promise(function(l){s.subscribe(l),a=l}).then(r);return c.cancel=function(){s.unsubscribe(a)},c},e(function(r){s.reason||(s.reason=new n(r),i(s.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},t.prototype.unsubscribe=function(e){if(this._listeners){var i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}},t.source=function(){var e;return{token:new t(function(i){e=i}),cancel:e}},RA=t}(),Ls.isCancel=EA(),Ls.VERSION=yA().version,Ls.toFormData=ZI(),Ls.AxiosError=Xd(),Ls.Cancel=Ls.CanceledError,Ls.all=function(n){return Promise.all(n)},Ls.spread=AA?IA:(AA=1,IA=function(n){return function(t){return n.apply(null,t)}}),Ls.isAxiosError=function(){if(OA)return wA;OA=1;var n=Xi;return wA=function(t){return n.isObject(t)&&t.isAxiosError===!0}}(),vT.exports=Ls,vT.exports.default=Ls;var rs=rt(vT.exports);function MA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function UA(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?MA(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):MA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}let Vf,Ff=0,UT=0;function xT(n,t,e,i){return new K((s,r)=>{t.responseType=t.responseType||"json",t.data&&!e?(t.data=JSON.stringify(t.data),Ff+=fo(t.data)):e&&(t.data.size?Ff+=t.data.size:t.data instanceof FormData?Ff+=UI(t.data):Ff+=fo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=n,rs.request(t).then(a=>{typeof a.data=="string"?UT+=fo(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?UT+=a.data.byteLength:UT+=fo(JSON.stringify(a.data)),i&&s({data:a.data,headers:a.headers}),s(a.data)}).catch(a=>{rs.isCancel(a)?r(new Q(O.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?r(new Q(O.NETWORK_TIMEOUT,a.message)):a.response?r(new Q(O.NETWORK_RESPONSE_ERROR,a.response.status)):r(new Q(O.NETWORK_ERROR,a.message))})})}async function cj(n,t){const e=new Blob([t.data],{type:"buffer"});return await xT(n,UA(UA({},t),{},{data:e,headers:{"Content-Type":"application/octet-stream"}}),!0)}const dj=()=>(Vf||Vf||(Vf=(window.location.protocol.split(":")[0]||"").toUpperCase(),Vf))==="HTTPS",xA=()=>window.isSecureContext!==void 0;function VA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function kt(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?VA(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):VA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}var ge;(function(n){n.SET_SESSION_ID="SET_SESSION_ID",n.SET_P2P_ID="SET_P2P_id",n.SET_DC_ID="SET_DC_id",n.SET_UID="SET_UID",n.SET_PUB_ID="SET_PUB_ID",n.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",n.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",n.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",n.AVOID_JOIN_START="AVOID_JOIN_START",n.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",n.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",n.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",n.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",n.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",n.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",n.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",n.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",n.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",n.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",n.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",n.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",n.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",n.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",n.RESET_KEY_METRICS="RESET_KEY_METRICS",n.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",n.SET_USE_P2P="SET_USE_P2P"})(ge||(ge={}));class lj{constructor(t,e,i,s){m(this,"state",void 0),this.state={codec:t,audioCodec:e,mode:i,clientId:s,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(t){this.state=function(e,i){switch(i.type){case ge.SET_SESSION_ID:return kt(kt({},e),{},{sessionId:i.sessionId});case ge.SET_P2P_ID:return kt(kt({},e),{},{p2pId:i.p2pId});case ge.SET_UID:return kt(kt({},e),{},{uid:i.uid});case ge.SET_PUB_ID:return kt(kt({},e),{},{pubId:i.pubId});case ge.KEY_METRIC_CLIENT_CREATED:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{clientCreated:i.metric})});case ge.KEY_METRIC_JOIN_START:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{joinStart:i.metric})});case ge.AVOID_JOIN_START:return kt(kt({},e),{},{avoidJoinStart:i.avoidJoinStart});case ge.KEY_METRIC_JOIN_END:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{joinEnd:i.metric})});case ge.KEY_METRIC_REQUEST_AP_START:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{requestAPStart:i.metric})});case ge.KEY_METRIC_REQUEST_AP_END:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{requestAPEnd:i.metric})});case ge.KEY_METRIC_JOIN_GATEWAY_START:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{joinGatewayStart:i.metric})});case ge.KEY_METRIC_JOIN_GATEWAY_END:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{joinGatewayEnd:i.metric})});case ge.KEY_METRIC_PEER_CONNECTION_START:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{peerConnectionStart:i.metric})});case ge.KEY_METRIC_PEER_CONNECTION_END:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{peerConnectionEnd:i.metric})});case ge.KEY_METRIC_DESCRIPTION_START:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{descriptionStart:i.metric})});case ge.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{signalChannelOpen:i.metric})});case ge.KEY_METRIC_ICE_CONNECTION_END:return kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{iceConnectionEnd:i.metric})});case ge.KEY_METRIC_PUBLISH:{const s=e.keyMetrics.publish,r=s.findIndex(a=>a.trackId===i.metric.trackId);return r!==-1?(s[r]=kt(kt({},s[r]),i.metric),kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{publish:[...s]})})):kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,i.metric]})})}case ge.KEY_METRIC_SUBSCRIBE:{const s=e.keyMetrics.subscribe,r=s.findIndex(a=>a.userId===i.metric.userId&&a.type===i.metric.type);return r!==-1?(s[r]=kt(kt({},s[r]),i.metric),kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{subscribe:[...s]})})):kt(kt({},e),{},{keyMetrics:kt(kt({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,i.metric]})})}case ge.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=i.mode,e;case ge.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,i.record]:(e.joinChannelServiceRecords[i.index]=kt(kt({},e.joinChannelServiceRecords[i.index]),i.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case ge.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case ge.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case ge.SET_USE_DATACHANNEL:return kt(kt({},e),{},{useDataChannel:i.val});case ge.SET_USE_P2P:return kt(kt({},e),{},{useP2P:i.val});default:return e}}(this.state,t)}set sessionId(t){this.dispatch({type:ge.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:ge.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:ge.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:ge.SET_UID,uid:t})}get uid(){return this.state.uid}set pubId(t){this.dispatch({type:ge.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:ge.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:ge.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}set useP2P(t){this.dispatch({type:ge.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:ge.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ge.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ge.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ge.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ge.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ge.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ge.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ge.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ge.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ge.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ge.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ge.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,e,i,s){this.dispatch({type:ge.KEY_METRIC_PUBLISH,metric:kt(kt({trackId:t,type:e},i&&{publishStart:i}),s&&{publishEnd:s})})}subscribe(t,e,i,s,r,a,c){this.dispatch({type:ge.KEY_METRIC_SUBSCRIBE,metric:kt(kt(kt(kt(kt({userId:t,type:e},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),r&&{firstFrame:r}),a&&{streamAdded:a}),c&&{firstDecoded:c})})}massSubscribe(t,e,i,s){t.forEach(r=>{this.dispatch({type:ge.KEY_METRIC_SUBSCRIBE,metric:kt(kt(kt({userId:r.userId,type:r.type},e&&{subscribeStart:e}),i&&{subscribeEnd:i}),s&&{firstFrame:s})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,e){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof e!="number"?(this.dispatch({type:ge.RECORD_JOIN_CHANNEL_SERVICE,record:kt(kt({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(e<0||e>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ge.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:e}),e)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ge.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ge.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:ge.AVOID_JOIN_START,avoidJoinStart:t})}}const Zs=function(n){if(n.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return n;const t=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[1],s=t[2];return"".concat(i,".").concat(s)}const e=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(e&&e[1]&&e[2]){const i=e[1],s=e[2];return"".concat(i,".").concat(100*(Number(s)+1))}return"4.0.0.999"}("4.19.1"),VT=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),FT="v4.19.1-0-g605286cc(10/11/2023, 2:37:03 PM)",ji={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}};function We(n,t,e){var i,s;Wt(i=Object.keys(ji)).call(i,n)&&(!e&&Wt(s=Object.keys(Da)).call(s,n)||(ji[n]=t))}function x(n){return ji[n]}const Da={},Bf=new class extends rn{reportLogUploadError(n){this.emit("REPORT_LOG_UPLOAD",n)}};class uj{constructor(t){m(this,"logger",void 0),m(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.debug(...this.prefixLists,...e)}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.info(...this.prefixLists,...e)}warning(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.warning(...this.prefixLists,...e)}error(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.error(...this.prefixLists,...e)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function BT(){const n=new Date;return n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}function FA(){const n=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+n.getUTCMilliseconds():n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}const tr={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},jf=Date.now(),Gu=n=>{for(const t in tr)if(Object.prototype.hasOwnProperty.call(tr,t)&&tr[t]===n)return t;return"DEFAULT"},v=new class{constructor(){m(this,"proxyServerURL",void 0),m(this,"logLevel",tr.DEBUG),m(this,"uploadState","collecting"),m(this,"uploadLogWaitingList",[]),m(this,"uploadLogUploadingList",[]),m(this,"uploadErrorCount",0),m(this,"currentLogID",0),m(this,"url",void 0),m(this,"extLog",(n,t)=>{this.appendLogToWaitingList(n,...t)})}debug(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[tr.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[tr.INFO].concat(t);this.log.apply(this,i)}warning(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[tr.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[tr.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[tr.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(n){n=Math.min(Math.max(0,n),4),this.logLevel=n}enableLogUpload(){We("UPLOAD_LOG",!0)}disableLogUpload(){We("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(n){this.proxyServerURL=n}prefix(n){return new uj(this).prefix(n)}log(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];if(Date.now()-jf<100)return void setTimeout(()=>{this.log(...t)},Date.now()-jf);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=BT()+" Agora-SDK [".concat(Gu(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const s=BT()+" %cAgora-SDK [".concat(Gu(i),"]:");let r=[];if(!x("USE_NEW_LOG"))switch(i){case tr.DEBUG:r=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,r);break;case tr.INFO:r=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,r);break;case tr.WARNING:r=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,r);break;case tr.ERROR:r=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,r)}}uploadLog(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];if(Date.now()-jf<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-jf);const i=Math.max(0,Math.min(4,t[0]));t[0]=BT()+" Agora-SDK [".concat(Gu(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(n){if(!x("UPLOAD_LOG"))return;for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];Array.isArray(e[0])?e[0][0]=FA()+" Agora-SDK [".concat(Gu(n),"]:"):e[0]=FA()+" Agora-SDK [".concat(Gu(n),"]:");let s="";e.forEach(r=>{typeof r=="object"&&(r=JSON.stringify(r)),s+="".concat(r," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:n,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const n=this.uploadLogUploadingList,t={sdk_version:Zs,process_id:x("PROCESS_ID"),payload:JSON.stringify(n)};return jr(async()=>{const e=await rs.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(x("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(x("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(e.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=e,i}},()=>(this.uploadLogUploadingList=[],!1),e=>(e.response?Bf.reportLogUploadError({status:e.response.status,data:e.response.data,headers:e.response.headers,message:e.message}):e.request?Bf.reportLogUploadError({status:e.request.status,message:e.message}):Bf.reportLogUploadError({status:-1,message:e.message}),!0),{timeout:x("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:x("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,x("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_INTERVAL"))}).catch(n=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var BA,jA;function hj(n){return _i(n.reportId,"params.reportId",0,100,!1),_i(n.category,"params.category",0,100,!1),_i(n.event,"params.event",0,100,!1),_i(n.label,"params.label",0,100,!1),je(n.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(n){n.FREE="free",n.UPLOADING="uploading"})(BA||(BA={})),function(n){n[n.MISC=0]="MISC",n[n.INTERNAL_EVENT=1]="INTERNAL_EVENT",n[n.PUBLIC_EVENT=2]="PUBLIC_EVENT",n[n.WEB_EVENT=3]="WEB_EVENT",n[n.INTERNAL_API=4]="INTERNAL_API",n[n.WEB_API=5]="WEB_API",n[n.PUBLIC_API=6]="PUBLIC_API"}(jA||(jA={}));const pj={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Yn,on,GA,WA;function HA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function le(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?HA(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):HA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}(function(n){n.PUBLISH="publish",n.SUBSCRIBE="subscribe",n.WS_COMPRESSOR_INIT="ws_compressor_init",n.SESSION_INIT="session_init",n.JOIN_CHOOSE_SERVER="join_choose_server",n.REQ_USER_ACCOUNT="req_user_account",n.JOIN_GATEWAY="join_gateway",n.REJOIN_GATEWAY="rejoin_gateway",n.STREAM_SWITCH="stream_switch",n.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",n.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",n.FIRST_VIDEO_RECEIVED="first_video_received",n.FIRST_AUDIO_RECEIVED="first_audio_received",n.FIRST_VIDEO_DECODE="first_video_decode",n.FIRST_AUDIO_DECODE="first_audio_decode",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_UPDATE_STREAM="on_update_stream",n.ON_REMOVE_STREAM="on_remove_stream",n.USER_ANALYTICS="req_user_analytics",n.PC_STATS="pc_stats"})(Yn||(Yn={})),function(n){n.SESSION="io.agora.pb.Wrtc.Session",n.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",n.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",n.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",n.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",n.PUBLISH="io.agora.pb.Wrtc.Publish",n.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",n.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",n.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",n.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",n.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",n.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",n.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",n.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",n.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",n.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",n.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",n.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",n.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",n.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",n.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",n.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",n.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",n.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",n.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",n.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",n.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",n.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",n.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",n.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",n.PC_STATS="io.agora.pb.Wrtc.PCStats"}(on||(on={})),function(n){n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(GA||(GA={})),function(n){n[n.SESSION=26]="SESSION",n[n.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",n[n.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",n[n.JOIN_GATEWAY=28]="JOIN_GATEWAY",n[n.PUBLISH=30]="PUBLISH",n[n.SUBSCRIBE=29]="SUBSCRIBE",n[n.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",n[n.STREAM_SWITCH=32]="STREAM_SWITCH",n[n.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",n[n.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",n[n.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",n[n.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",n[n.API_INVOKE=41]="API_INVOKE",n[n.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",n[n.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",n[n.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",n[n.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",n[n.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",n[n.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",n[n.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",n[n.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",n[n.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",n[n.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",n[n.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",n[n.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",n[n.USER_ANALYTICS=1e4]="USER_ANALYTICS",n[n.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(WA||(WA={}));class Wu{constructor(){m(this,"baseInfoMap",new Map),m(this,"proxyServer",void 0),m(this,"eventUploadTimer",void 0),m(this,"setSessionIdTimer",void 0),m(this,"url",void 0),m(this,"backupUrl",void 0),m(this,"_appId",void 0),m(this,"keyEventUploadPendingItems",[]),m(this,"normalEventUploadPendingItems",[]),m(this,"apiInvokeUploadPendingItems",[]),m(this,"apiInvokeCount",0),m(this,"ltsList",[]),m(this,"lastSendNormalEventTime",Date.now()),m(this,"customReportCounterTimer",void 0),m(this,"customReportCount",0),m(this,"extApiInvoke",async t=>{for(const e of t){const i=le(le({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:un.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),x("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),x("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void v.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));const e=this.baseInfoMap.get(t),i=Date.now(),s=e.startTime;e.startTime=i,v.debug("rewrite session ".concat(t," startTime: ").concat(i," , ").concat(i-s,"ms")),this.baseInfoMap.set(t,e)}setAppId(t){this._appId=t}reportApiInvoke(t,e,i){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const s=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,a=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:s,options:e.options,states:e.states||null}),c=!!x("SHOW_REPORT_INVOKER_LOG");c&&v.info("".concat(e.name," start"),e.options);let l=!1;hi(e.timeout).then(()=>{l||(this.sendApiInvoke(le(le({},a()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),v.debug("".concat(e.name," timeout")))});const u=new Q(O.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:h=>{const f=()=>{if(l)throw u;return l=!0,this.sendApiInvoke(le(le({},a()),{},{success:!0},e.reportResult&&{result:h})),c&&v.info("".concat(e.name," onSuccess")),h};return i?VI(f,e.name+"Success",i,()=>l=!0):f()},onError:h=>{const f=()=>{if(l)throw h;l=!0,this.sendApiInvoke(le(le({},a()),{},{success:!1,error:h})),c&&v.info("".concat(e.name," onFailure"),h.toString())};return i?VI(f,e.name+"Error",i,()=>l=!0):f()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const i=Date.now(),s=this.createBaseInfo(t,i);s.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:x("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:VT?"global":"oversea",areas:x("AREAS")&&x("AREAS").join(",")},e.extend),a=Date.now(),c=le(le({},s),{},{eventType:Yn.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,build:FT,lts:a,elapse:a-i,extend:JSON.stringify(r),mode:e.mode,process:x("PROCESS_ID"),appType:x("APP_TYPE"),success:!0,version:Zs});this.send({type:on.SESSION,data:c},!0)}joinChooseServer(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le({},s),{},{eventType:Yn.JOIN_CHOOSE_SERVER,lts:r,eventElapse:r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-i.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3});this.send({type:on.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le({},s),{},{eventType:Yn.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:r-i.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:on.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;e.vid&&(s.vid=e.vid),s.uid=e.uid,s.cid=e.cid;const r=Date.now(),{firstSuccess:a,avoidJoinStartTime:c,isProxy:l,addr:u}=e,h=r-(a&&c?c:i.startTime),f=le(le({},s),{},{eventType:Yn.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,elapse:h,eventElapse:r-e.lts,firstSuccess:a,signalChannel:e.signalChannel}),g=f.success?1:0;if(e.succ&&(i.lastJoinSuccessTime=r),a)this.send({type:on.JOIN_GATEWAY,data:f},!0);else{let S;if(u)if(l){const b=u.match(/h=(\d{1,3}-){3}\d{1,3}/g),I=u.match(/p=[0-9]{1,6}/g);S={isSuccess:g,gatewayIp:b&&b.length?b[0].split("=")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split("=")[1]:"",isProxy:l?1:0}}else{const b=u.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),I=u.match(/(:|p=)[0-9]{1,6}/g);S={isSuccess:g,gatewayIp:b&&b.length?b[0].split("//")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split(/:|p=/g)[1]:"",isProxy:l?1:0}}else S={isSuccess:g,gatewayIp:"",port:"",isProxy:l?1:0};delete f.success,delete f.eventType,delete f.firstSuccess,f.vid=Number(f.vid);const w=Object.assign({},f,S,{eventType:Yn.REJOIN_GATEWAY});this.send({type:on.RE_JOIN_GATEWAY,data:w},!0)}}joinChannelTimeout(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=Date.now(),r=le(le({},i.info),{},{lts:s,timeout:e,elapse:s-i.startTime});this.send({type:on.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le({},s),{},{eventType:Yn.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-i.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:on.PUBLISH,data:a},!0)}subscribe(t,e,i){const s=this.baseInfoMap.get(t);if(!s)return;const r=s.info,a=Date.now(),c=le(le({},r),{},{eventType:Yn.SUBSCRIBE,lts:a,eventElapse:e.eventElapse,elapse:a-s.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:on.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const i=[...Ps(e=this.baseInfoMap).call(e)],s=i.length?i[0]:"UnableToGetSid",r=this.baseInfoMap.get(s);if(!r)return;const a=r.info,c=Date.now(),l=le(le({},a),{},{eventType:Yn.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:on.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,i,s){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=le(le(le({},a),s),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max(c-r.startTime,0),apEnd:Math.max(s.apEnd-r.startTime,0),apStart:Math.max(s.apStart-r.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-r.startTime,0),joinGwStart:Math.max(s.joinGwStart-r.startTime,0),pcEnd:Math.max(s.pcEnd-r.startTime,0),pcStart:Math.max(s.pcStart-r.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-r.startTime,0),subscriberStart:Math.max(s.subscriberStart-r.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-r.startTime,0)});this.send({type:i,data:l},!0)}firstRemoteFrame(t,e,i,s){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=le(le(le({},a),s),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:i,data:l},!0)}pcStats(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le(le({},s),e),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:r-i.startTime,eventType:Yn.PC_STATS,lts:r});this.send({type:on.PC_STATS,data:a},!0)}onGatewayStream(t,e,i,s){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=le(le(le({},a),s),{},{eventType:e,lts:c});this.send({type:i,data:l},!0)}streamSwitch(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le({},s),{},{eventType:Yn.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-i.startTime,success:e.succ});this.send({type:on.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le({},s),{},{eventType:Yn.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-i.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:on.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le({},s),{},{eventType:Yn.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-i.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:on.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(t){this.proxyServer=t,t?v.debug("reportProxyServerurl: ".concat(t)):v.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le({},s),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-i.startTime,joinChannelSuccessElapse:r-(i.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:on.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now();(function(c,l,u){const h=c[l];if(!h||typeof h!="string")return[c];c[l]="";const f=fo(JSON.stringify(c));let g=0;const S=[];let w=0;for(let b=0;b<h.length;b++)w+=h.charCodeAt(b)<=127?1:3,w<=u-f||(S[S.length]=kc(kc({},c),{},{[l]:h.substring(g,b)}),g=b,w=h.charCodeAt(b)<=127?1:3);return g!==h.length-1&&(S[S.length]=kc(kc({},c),{},{[l]:h.substring(g)})),S})(le(le(le({},s),e),{},{elapse:r-i.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:on.WORKER_EVENT,data:c},!0))}apworkerEvent(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le(le({},s),e),{},{elapse:r-i.startTime,lts:r});this.send({type:on.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le(le({},s),e),{},{elapse:r-i.startTime,lts:r,extend:e.extend||void 0});this.send({type:on.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=le(le(le({},s),e),{},{elapse:r-i.startTime,lts:r});this.send({type:on.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>x("CUSTOM_REPORT_LIMIT"))throw new Q(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),s=e.map(r=>({type:on.USER_ANALYTICS,data:le(le({sid:t},r),{},{lts:i})}));try{x("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(r){throw v.error("send custom report message failed",r.toString()),new Q(O.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=x("NOT_REPORT_EVENT");if(t.tag&&Wt(e)&&Wt(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const i=this.baseInfoMap.get(t.sid);if(!i)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:s,uid:r,cid:a}=i.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Q){const{code:u,message:h}=t.error;c=u||h||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:s,cid:a,uid:r,lts:t.lts,success:t.success,elapse:t.lts-i.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:on.API_INVOKE,data:l},!1),!0}appendSessionId(){Wu.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){const e=this.apiInvokeUploadPendingItems.length;for(let i=0;i<e;i++){const s=this.apiInvokeUploadPendingItems.shift();s&&(s.sid=t._sessionId,this.sendApiInvoke(Object.assign({},s)))}}})}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>x("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const i=[],s=[];for(;t.length;){const a=t.shift();i.length<20?i.push(a):s.push(a)}t.push(...s);for(const a of[...i]){var r;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),Ou(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),x("ENABLE_EVENT_REPORT")&&i.length&&(x("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((a=>c=>{x("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>x("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-x("NORMAL_EVENT_QUEUE_CAPACITY")),v.warning("report: drop normal events"))))})(i)),t}async postDataToStatsCollector2(t){On.networkState===ki.OFFLINE&&await K.race([On.onlineWaiter,hi(2*Dn.maxRetryTimeout)]);const e=r=>{let a=new Uint8Array;return r.forEach(c=>{const l=pT(JSON.stringify(c.data)),u=new ArrayBuffer(5),h=(g=>{let S=0;return Object.entries(on).forEach(w=>{let[b,I]=w;I===g.type&&(S=EventNameToID[b])}),S})(c),f=new DataView(u);f.setUint16(0,l.byteLength,!0),f.setUint8(2,255&h),f.setUint8(3,h>>>8&255),f.setUint8(4,h>>>16&255),a=OI(a,new Uint8Array(u)),a=OI(a,l)}),a},i="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(x("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let r=0;r<2;r+=1){r===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(x("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await xT(s,{timeout:1e4,data:e(t),headers:le(le({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(r===1)throw a;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(a=>JSON.stringify(a)),vid:(a=>{const c=a&&a.data.sid&&this.baseInfoMap.get(a.data.sid);return c&&c.info.vid&&+c.info.vid||0})(t[0])};On.networkState===ki.OFFLINE&&await K.race([On.onlineWaiter,hi(2*Dn.maxRetryTimeout)]);const s=e?"/events/proto-raws":"/events/messages";let r=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("EVENT_REPORT_DOMAIN"),"&p=").concat(x("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(x("EVENT_REPORT_DOMAIN"),":").concat(x("STATS_COLLECTOR_PORT")).concat(s));for(let a=0;a<2;a+=1){a===1&&(r=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(x("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(x("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(x("STATS_COLLECTOR_PORT")).concat(s)));try{e?await cj(r,{timeout:1e4,data:i}):await xT(r,{timeout:1e4,data:i})}catch(c){if(a===1)throw c;continue}return}}createBaseInfo(t,e){const i=Object.assign({},pj);return i.sid=t,this.baseInfoMap.set(t,{info:i,startTime:e}),i}reportResourceTiming(t,e){const i=performance.getEntriesByName(t),s=i[i.length-1];s&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:s,tag:un.TRACER}).onSuccess()}}function Ht(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,e,i){const s=i.value;if(typeof s=="function"){const r=n.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];let u=c;if(n.argsMap)try{u=n.argsMap(this,...c)}catch(f){v.warning(f),u=[]}try{JSON.stringify(u)}catch{v.warning("arguments for method ".concat(r,".").concat(String(e)," not serializable for apiInvoke.")),u=[]}const h=(n.report||Dt).reportApiInvoke(this._sessionId||null,{name:"".concat(r,".").concat(String(e)),options:u,tag:un.TRACER,reportResult:n.reportResult},n.throttleTime);try{const f=s.apply(this,c);return f instanceof K?f.then(g=>(h.onSuccess(n.reportResult&&g),g)).catch(g=>{throw h.onError(g),g}):(h.onSuccess(n.reportResult&&f),f)}catch(f){throw h.onError(f),f}}}return i}}m(Wu,"__CLIENT_LIST__",[]);const Dt=new Wu;Bf.on("REPORT_LOG_UPLOAD",n=>{n.networkState=On.networkState,Dt.reportApiInvoke(null,{name:"logUploadError",options:n,tag:un.TRACER})});const fj=["CHINA","GLOBAL"],ks=function(){const n="us".concat("erna","me"),t="pa".concat("sswo","rd"),e=["t","s","t"];e.splice(1,0,"e");const i=e.join(""),s=[];for(let c=0;c<6;c++)s.push("1");const r=s.join(""),a={};return a[n]=i,a[t]=r,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ks,VT||(ji.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ji.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ji.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ji.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ji.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ji.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ji.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ji.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ji.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ji.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ji.AREAS=["NORTH_AMERICA","OVERSEA"]);const KA=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Pa=[];function Vc(n,t){return!!t&&Pa.some(e=>e.uid===n&&e.channelName===t)}Wu.__CLIENT_LIST__=Pa;var jT,os,Zd,Hu,Ms,bi,Ft,ue,pt,Nt,as,te,qA,tl,Jt,jn,La,_j=Ic("Array").values,mj=Ac,Ej=Li,gj=Cn,Tj=_j,GT=Array.prototype,Sj={DOMTokenList:!0,NodeList:!0},_o=rt(function(n){var t=n.values;return n===GT||gj(GT,n)&&t===GT.values||Ej(Sj,mj(n))?Tj:t});function et(n,t,e,i){var s,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(n,t,e,i);else for(var c=n.length-1;c>=0;c--)(s=n[c])&&(a=(r<3?s(a):r>3?s(t,e,a):s(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a}function A(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}(function(n){n.L1T1="L1T1",n.L1T2="L1T2",n.L1T3="L1T3",n.L2T1_KEY="L2T1_KEY",n.L2T2_KEY="L2T2_KEY",n.L2T3_KEY="L2T3_KEY",n.L3T1_KEY="L3T1_KEY",n.L3T2_KEY="L3T2_KEY",n.L3T3_KEY="L3T3_KEY"})(jT||(jT={})),function(n){n.CERTIFICATE="certificate",n.CODEC="codec",n.CANDIDATE_PAIR="candidate-pair",n.LOCAL_CANDIDATE="local-candidate",n.REMOTE_CANDIDATE="remote-candidate",n.INBOUND="inbound-rtp",n.TRACK="track",n.OUTBOUND="outbound-rtp",n.PC="peer-connection",n.REMOTE_INBOUND="remote-inbound-rtp",n.REMOTE_OUTBOUND="remote-outbound-rtp",n.TRANSPORT="transport",n.CSRC="csrc",n.DATA_CHANNEL="data-channel",n.STREAM="stream",n.SENDER="sender",n.RECEIVER="receiver"}(os||(os={})),function(n){n[n.ACCESS_POINT=101]="ACCESS_POINT",n[n.UNILBS=201]="UNILBS",n[n.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Zd||(Zd={})),function(n){n[n.IIIEGAL_APPID=1]="IIIEGAL_APPID",n[n.IIIEGAL_UID=2]="IIIEGAL_UID",n[n.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Hu||(Hu={})),function(n){n[n.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",n[n.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",n[n.INTERNAL_ERROR=8]="INTERNAL_ERROR",n[n.NO_AUTHORIZED=9]="NO_AUTHORIZED",n[n.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",n[n.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",n[n.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",n[n.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",n[n.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",n[n.USER_OVERLOAD=16]="USER_OVERLOAD",n[n.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",n[n.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Ms||(Ms={})),function(n){n[n.NO_FLAG_SET=100]="NO_FLAG_SET",n[n.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",n[n.INVALID_FALG_SET=102]="INVALID_FALG_SET",n[n.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",n[n.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",n[n.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",n[n.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",n[n.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",n[n.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",n[n.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",n[n.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",n[n.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",n[n.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",n[n.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",n[n.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",n[n.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",n[n.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",n[n.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",n[n.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(bi||(bi={})),function(n){n[n.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",n[n.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",n[n.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",n[n.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",n[n.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",n[n.K_TICKET_INVALID=7]="K_TICKET_INVALID",n[n.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",n[n.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",n[n.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",n[n.K_UID_BANNED=14]="K_UID_BANNED",n[n.K_IP_BANNED=15]="K_IP_BANNED",n[n.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",n[n.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",n[n.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",n[n.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",n[n.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",n[n.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",n[n.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",n[n.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",n[n.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",n[n.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",n[n.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",n[n.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",n[n.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",n[n.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",n[n.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",n[n.ERR_INVALID_UID=117]="ERR_INVALID_UID",n[n.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",n[n.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",n[n.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",n[n.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",n[n.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",n[n.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",n[n.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",n[n.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",n[n.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",n[n.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",n[n.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",n[n.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",n[n.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",n[n.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",n[n.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",n[n.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",n[n.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",n[n.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",n[n.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",n[n.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",n[n.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",n[n.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",n[n.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",n[n.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",n[n.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",n[n.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",n[n.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",n[n.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",n[n.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",n[n.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",n[n.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",n[n.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",n[n.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",n[n.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",n[n.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",n[n.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",n[n.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ft||(Ft={})),function(n){n.CONNECTING="connecting",n.CONNECTED="connected",n.RECONNECTING="reconnecting",n.CLOSED="closed"}(ue||(ue={})),function(n){n.WS_CONNECTED="ws_connected",n.WS_RECONNECTING="ws_reconnecting",n.WS_CLOSED="ws_closed",n.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",n.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",n.ON_BINARY_DATA="on_binary_data",n.REQUEST_RECOVER="request_recover",n.REQUEST_JOIN_INFO="request_join_info",n.REQUEST_REJOIN_INFO="req_rejoin_info",n.IS_P2P_DISCONNECTED="is_p2p_dis",n.DISCONNECT_P2P="dis_p2p",n.ABORT_P2P_EXECUTION="abort_p2p_execution",n.NEED_RENEW_SESSION="need-sid",n.REPORT_JOIN_GATEWAY="report_join_gateway",n.REQUEST_TIMEOUT="request_timeout",n.REQUEST_SUCCESS="request_success",n.JOIN_RESPONSE="join_response",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_CONNECTING="datachannel_connecting",n.DATACHANNEL_FAILBACK="datachannel_failback",n.P2P_START="p2p_start",n.P2P_CONNECTION="p2p_connection",n.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",n.P2P_SUBSCRIBE="p2p_subscribe",n.P2P_UNSUBSCRIBE="p2p_unsubscribe",n.P2P_EXCHANGE_SDP="p2p_exchange_sdp",n.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",n.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(pt||(pt={})),function(n){n.PING="ping",n.PING_BACK="ping_back",n.JOIN="join_v3",n.REJOIN="rejoin_v3",n.LEAVE="leave",n.SET_CLIENT_ROLE="set_client_role",n.PUBLISH="publish",n.PUBLISH_DATASTREAM="publish_datastream",n.UNPUBLISH="unpublish",n.UNPUBLISH_DATASTREAM="unpublish_datastream",n.SUBSCRIBE="subscribe",n.SUBSCRIBE_DATASTREAM="subscribe_datastream",n.SUBSCRIBE_STREAMS="subscribe_streams",n.UNSUBSCRIBE="unsubscribe",n.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",n.UNSUBSCRIBE_STREAMS="unsubscribe_streams",n.SUBSCRIBE_CHANGE="subscribe_change",n.TRAFFIC_STATS="traffic_stats",n.RENEW_TOKEN="renew_token",n.SWITCH_VIDEO_STREAM="switch_video_stream",n.DEFAULT_VIDEO_STREAM="default_video_stream",n.SET_FALLBACK_OPTION="set_fallback_option",n.GATEWAY_INFO="gateway_info",n.CONTROL="control",n.SEND_METADATA="send_metadata",n.DATA_STREAM="data_stream",n.PICK_SVC_LAYER="pick_svc_layer",n.RESTART_ICE="restart_ice",n.CONNECT_PC="connect_pc",n.SET_VIDEO_PROFILE="set_video_profile",n.SET_PARAMETER="set_parameter",n.SET_RTM2_FLAG="set_rtm2_flag"}(Nt||(Nt={})),function(n){n.PUBLISH_STATS="publish_stats",n.PUBLISH_RELATED_STATS="publish_related_stats",n.SUBSCRIBE_STATS="subscribe_stats",n.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",n.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",n.DENOISER_STATS="denoiser_stats",n.TRANSPORT_STATS="transport_stats",n.EXTENSION_USAGE_STATS="extension_usage_stats"}(as||(as={})),function(n){n.ON_USER_ONLINE="on_user_online",n.ON_USER_OFFLINE="on_user_offline",n.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",n.ON_PUBLISH_STREAM="on_publish_stream",n.ON_UPLINK_STATS="on_uplink_stats",n.ON_P2P_LOST="on_p2p_lost",n.ON_REMOVE_STREAM="on_remove_stream",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",n.ON_USER_BANNED="on_user_banned",n.ON_USER_LICENSE_BANNED="on_user_license_banned",n.ON_NOTIFICATION="on_notification",n.ON_CRYPT_ERROR="on_crypt_error",n.MUTE_AUDIO="mute_audio",n.MUTE_VIDEO="mute_video",n.UNMUTE_AUDIO="unmute_audio",n.UNMUTE_VIDEO="unmute_video",n.ON_P2P_OK="on_p2p_ok",n.RECEIVE_METADATA="receive_metadata",n.ON_DATA_STREAM="on_data_stream",n.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",n.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",n.ENABLE_LOCAL_VIDEO="enable_local_video",n.DISABLE_LOCAL_VIDEO="disable_local_video",n.ENABLE_LOCAL_AUDIO="enable_local_audio",n.DISABLE_LOCAL_AUDIO="disable_local_audio",n.ON_PUBLISHED_USER_LIST="on_published_user_list"}(te||(te={})),function(n){n.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",n.NEED_ANSWER="NEED_ANSWER",n.NEED_RENEGOTIATE="NEED_RENEGOTIATE",n.P2P_LOST="P2P_LOST",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NEED_UNPUB="NEED_UNPUB",n.NEED_UNSUB="NEED_UNSUB",n.NEED_UPLOAD="NEED_UPLOAD",n.NEED_CONTROL="NEED_CONTROL",n.START_RECONNECT="START_RECONNECT",n.END_RECONNECT="END_RECONNECT",n.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(qA||(qA={})),function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"}(tl||(tl={})),function(n){n.CONNECTED="websocket:connected",n.RECONNECTING="websocket:reconnecting",n.WILL_RECONNECT="websocket:will_reconnect",n.CLOSED="websocket:closed",n.FAILED="websocket:failed",n.ON_MESSAGE="websocket:on_message",n.REQUEST_NEW_URLS="websocket:request_new_urls",n.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Jt||(Jt={}));class G extends Q{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),m(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,v)}throw(){super.throw(v)}}function WT(n){if(typeof n!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n))throw v.error("Invalid Channel Name ".concat(n)),new G(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function HT(n){if(t=n,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||bI(n,1,255)))throw new G(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof n=="string"&&v.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(n){n.TRANSCODE="mix_streaming",n.RAW="raw_streaming",n.INJECT="inject_streaming"})(jn||(jn={})),function(n){n[n.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",n[n.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",n[n.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",n[n.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",n[n.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",n[n.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",n[n.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",n[n.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",n[n.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(La||(La={}));const vj={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},KT={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function qT(n,t){_i(n.url,"".concat(t,".url"),1,1e3,!1),ln(n.x)||je(n.x,"".concat(t,".x"),0,1e4),ln(n.y)||je(n.y,"".concat(t,".y"),0,1e4),ln(n.width)||je(n.width,"".concat(t,".width"),0,1e4),ln(n.height)||je(n.height,"".concat(t,".height"),0,1e4),ln(n.zOrder)||je(n.zOrder,"".concat(t,".zOrder"),0,255),ln(n.alpha)||je(n.alpha,"".concat(t,".alpha"),0,1,!1)}const yj={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Cj={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var yr,el,Rn,YA,Ii,Gr,Gi,ka,xe,fn,Fc,Un,Gf,ye;function zA(n){if(!n.channelName)throw new G(O.INVALID_PARAMS,"invalid channelName in info");if(typeof n.uid!="number")throw new G(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return n.token&&_i(n.token,"info.token",1,2047),HT(n.uid),WT(n.channelName),!0}(function(n){n.WARNING="@live_uap-warning",n.ERROR="@line_uap-error",n.PUBLISH_STREAM_STATUS="@live_uap-publish-status",n.INJECT_STREAM_STATUS="@live_uap-inject-status",n.WORKER_STATUS="@live_uap-worker-status",n.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(yr||(yr={})),function(n){n.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(el||(el={})),function(n){n[n.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",n[n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",n[n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",n[n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",n[n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",n[n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",n[n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",n[n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",n[n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",n[n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",n[n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",n[n.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",n[n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",n[n.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",n[n.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",n[n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Rn||(Rn={})),function(n){n.CONNECT_FAILED="connect failed",n.CONNECT_TIMEOUT="connect timeout",n.WS_DISCONNECTED="websocket disconnected",n.REQUEST_TIMEOUT="request timeout",n.REQUEST_FAILED="request failed",n.WAIT_STATUS_TIMEOUT="wait status timeout",n.WAIT_STATUS_ERROR="wait status error",n.BAD_STATE="bad state",n.WS_ABORT="ws abort",n.AP_REQUEST_TIMEOUT="AP request timeout",n.AP_JSON_PARSE_ERROR="AP json parse error",n.AP_REQUEST_ERROR="AP request error",n.AP_REQUEST_ABORT="AP request abort"}(YA||(YA={})),function(n){n[n.SetSdkProfile=0]="SetSdkProfile",n[n.SetSourceChannel=1]="SetSourceChannel",n[n.SetSourceUserId=2]="SetSourceUserId",n[n.SetDestChannel=3]="SetDestChannel",n[n.StartPacketTransfer=4]="StartPacketTransfer",n[n.StopPacketTransfer=5]="StopPacketTransfer",n[n.UpdateDestChannel=6]="UpdateDestChannel",n[n.Reconnect=7]="Reconnect",n[n.SetVideoProfile=8]="SetVideoProfile"}(Ii||(Ii={})),function(n){n.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",n.NETWORK_CONNECTED="NETWORK_CONNECTED",n.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",n.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",n.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",n.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",n.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",n.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",n.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",n.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(Gr||(Gr={})),function(n){n.RELAY_STATE_IDLE="RELAY_STATE_IDLE",n.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",n.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",n.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Gi||(Gi={})),function(n){n.RELAY_OK="RELAY_OK",n.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",n.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",n.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(ka||(ka={})),function(n){n.High="high",n.Low="low",n.Audio="audio",n.Screen="screen",n.ScreenLow="screen_low"}(xe||(xe={})),function(n){n.DISCONNECT="disconnect",n.CONNECTION_STATE_CHANGE="connection-state-change",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGE="stream-type-change",n.IS_P2P_DISCONNECTED="is-p2p-dis",n.DISCONNECT_P2P="dis-p2p",n.REQUEST_NEW_GATEWAY_LIST="req-gate-url",n.NEED_RENEW_SESSION="need-sid",n.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",n.JOIN_RESPONSE="join-response",n.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",n.RESET_CONNECTION_EVENTS="reset-connection-events",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_FAILBACK="datachannel_failback",n.RESET_SIGNAL="reset-signal"}(fn||(fn={})),function(n){n.P2P_DISCONNECTED="P2P_DISCONNECTED",n.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",n.TIMEOUT="TIMEOUT",n.UNKNOWN_REASON="UNKNOWN_REASON"}(Fc||(Fc={})),function(n){n[n.Nothing=0]="Nothing",n[n.Audio=1]="Audio",n[n.LwoVideo=2]="LwoVideo",n[n.Video=4]="Video",n[n.Data=8]="Data",n[n.DataStream0=256]="DataStream0",n[n.DataStream1=512]="DataStream1",n[n.DataStream2=1024]="DataStream2",n[n.DataStream3=2048]="DataStream3",n[n.DataStream4=4096]="DataStream4",n[n.DataStream5=8192]="DataStream5",n[n.DataStream6=16384]="DataStream6",n[n.DataStream7=32768]="DataStream7"}(Un||(Un={})),function(n){n[n.websocket=0]="websocket",n[n.datachannel=1]="datachannel"}(Gf||(Gf={})),function(n){n.CHINA="CHINA",n.ASIA="ASIA",n.NORTH_AMERICA="NORTH_AMERICA",n.EUROPE="EUROPE",n.JAPAN="JAPAN",n.INDIA="INDIA",n.KOREA="KOREA",n.HKMC="HKMC",n.US="US",n.OCEANIA="OCEANIA",n.SOUTH_AMERICA="SOUTH_AMERICA",n.AFRICA="AFRICA",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="EXTENSIONS"}(ye||(ye={}));const JA=[ye.AFRICA,ye.ASIA,ye.CHINA,ye.EUROPE,ye.GLOBAL,ye.INDIA,ye.JAPAN,ye.NORTH_AMERICA,ye.OCEANIA,ye.OVERSEA,ye.SOUTH_AMERICA];var ci;(function(n){n.CHINA="CN",n.ASIA="AS",n.NORTH_AMERICA="NA",n.EUROPE="EU",n.JAPAN="JP",n.INDIA="IN",n.KOREA="KR",n.HKMC="HK",n.US="US",n.OCEANIA="OC",n.SOUTH_AMERICA="SA",n.AFRICA="AF",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="GLOBAL"})(ci||(ci={}));const Wf={CHINA:{},ASIA:{CODE:ci.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ci.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ci.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ci.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ci.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ci.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ci.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ci.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ci.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ci.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ci.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ci.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ci.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var Ku,XA,bt,mi,Wr,st,Ce,Gt,$A,Us,xs,Gn,mo,gn,Hr,QA,ms,er,Ma,Xe,Eo,ZA;VT&&(Wf.CHINA={CODE:ci.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(n){n.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Ku||(Ku={}));class tw extends rn{constructor(t,e){super(),m(this,"onICEConnectionStateChange",void 0),m(this,"onConnectionStateChange",void 0),m(this,"onDTLSTransportStateChange",void 0),m(this,"onDTLSTransportError",void 0),m(this,"onICETransportStateChange",void 0),m(this,"onFirstAudioReceived",void 0),m(this,"onFirstVideoReceived",void 0),m(this,"onFirstAudioDecoded",void 0),m(this,"onFirstVideoDecoded",void 0),m(this,"onFirstVideoDecodedTimeout",void 0),m(this,"onSelectedLocalCandidateChanged",void 0),m(this,"onSelectedRemoteCandidateChanged",void 0)}}class Hf extends tw{constructor(t,e){super(t,e)}}(function(n){n.SEND="sendonly",n.RECV="recvonly",n.SENDRECV="sendrecv",n.INACTIVE="inactive"})(XA||(XA={})),function(n){n.VIDEO="video",n.AUDIO="audio"}(bt||(bt={})),function(n){n[n.UDP=0]="UDP",n[n.TCP=1]="TCP",n[n.RELAY=2]="RELAY"}(mi||(mi={})),function(n){n[n.FIRST_CONNECTION=0]="FIRST_CONNECTION",n[n.TCP_RESTART=1]="TCP_RESTART",n[n.RELAY_RESTART=2]="RELAY_RESTART",n[n.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",n[n.OLD_RESTART=11]="OLD_RESTART",n[n.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Wr||(Wr={})),function(n){n.LocalVideoTrack="videoTrack",n.LocalAudioTrack="audioTrack",n.LocalVideoLowTrack="videoLowTrack"}(st||(st={})),function(n){n.New="new",n.Connected="connected",n.Reconnecting="reconnecting",n.Disconnected="disconnected"}(Ce||(Ce={})),function(n){n.StateChange="stateChange",n.IceConnectionStateChange="iceConnectionStateChange",n.RequestMuteLocal="requestMuteLocal",n.RequestUnmuteLocal="requestUnmuteLocal",n.RequestRePublish="requestRePublish",n.RequestRePublishDataChannel="requestRePublishDataChannel",n.RequestReSubscribe="requestReSubscribe",n.RequestUploadStats="requestUploadStats",n.MediaReconnectStart="MediaReconnectStart",n.MediaReconnectEnd="MediaReconnectEnd",n.NeedSignalRTT="NeedSignalRTT",n.RequestRestartICE="RequestRestartIce",n.PeerConnectionStateChange="PeerConnectionStateChange",n.RequestReconnect="RequestReconnect",n.RequestReconnectPC="RequestReconnectPC",n.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",n.P2PLost="P2PLost",n.UpdateVideoEncoder="UpdateVideoEncoder",n.ConnectionTypeChange="ConnectionTypeChange",n.RequestLowStreamParameter="RequestLowStreamParameter",n.QueryClientConnectionState="QueryClientConnectionState",n.LocalCandidate="LocalCandidate",n.RequestP2PMuteLocal="requestP2PMuteLocal",n.RequestP2PPublish="RequestP2PPublish",n.RequestP2PUnPublish="RequestP2PUnPublish",n.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",n.RequestP2PMuteRemote="RequestP2PMuteRemote",n.RequestP2PRestartICE="RequestP2PRestartICE"}(Gt||(Gt={})),function(n){n.MUTE_LOCAL_VIDEO="mute_local_video",n.MUTE_LOCAL_AUDIO="mute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.MUTE_REMOTE_VIDEO="mute_remote_video",n.MUTE_REMOTE_AUDIO="mute_remote_audio",n.UNMUTE_REMOTE_VIDEO="unmute_remote_video",n.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}($A||($A={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(Us||(Us={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(xs||(xs={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Gn||(Gn={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}(mo||(mo={})),function(n){n.CONNECTED="transmitter:connected",n.RECONNECTING="transmitter:reconnecting",n.WILL_RECONNECT="transmitter:will_reconnect",n.CLOSED="transmitter:closed",n.FAILED="transmitter:failed",n.ON_MESSAGE="transmitter:on_message",n.REQUEST_NEW_URLS="transmitter:request_new_urls",n.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",n.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",n.FAILBACK="transmitter:failback"}(gn||(gn={})),function(n){n.CAMERA_CHANGED="camera-changed",n.MICROPHONE_CHANGED="microphone-changed",n.PLAYBACK_DEVICE_CHANGED="playback-device-changed",n.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",n.AUTOPLAY_FAILED="autoplay-failed",n.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Hr||(Hr={})),function(n){n[n.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",n[n.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",n[n.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",n[n.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",n[n.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",n[n.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",n[n.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",n[n.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",n[n.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",n[n.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",n[n.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",n[n.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",n[n.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",n[n.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",n[n.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",n[n.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",n[n.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",n[n.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",n[n.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",n[n.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(QA||(QA={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(ms||(ms={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(er||(er={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(Ma||(Ma={})),function(n){n.CALL="call",n.CANDIDATE="candidate",n.PUBLISH="publish",n.UNPUBLISH="unpublish",n.SUBSCRIBE="subscribe",n.UNSUBSCRIBE="unsubscribe",n.CONTROL="control",n.RESTART_ICE="restart_ice",n.ACK="ack",n.JOIN="join",n.EXCHANGE_SDP="exchange_sdp",n.DO_SUBSCRIBE="do_subscribe",n.DO_UNSUBSCRIBE="do_unsubscribe"}(Xe||(Xe={})),function(n){n.MUTE_LOCAL_AUDIO="mute_local_audio",n.MUTE_LOCAL_VIDEO="mute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Eo||(Eo={})),function(n){n[n.SUCCESS=1]="SUCCESS",n[n.FAILED=0]="FAILED"}(ZA||(ZA={}));const Rj={[Zd.ACCESS_POINT]:{[bi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[bi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[bi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[bi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[bi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[bi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Zd.UNILBS]:{[Ms.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ms.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ms.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ms.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ms.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ms.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ms.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ms.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ms.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ms.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ms.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ms.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Zd.STRING_UID_ALLOCATOR]:{[Hu.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Hu.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Hu.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Kf(n){const t=Rj[Math.floor(n/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const e=t[n%1e4];if(!e){if(Math.floor(n/1e4)===Zd.ACCESS_POINT){const i=n%1e4;if(i.toString()[0]==="1")return{desc:n.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:n.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return e}const bj={[Ft.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ft.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ft.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ft.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ft.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ft.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ft.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ft.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ft.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ft.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ft.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ft.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ft.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ft.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ft.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ft.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ft.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ft.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ft.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ft.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ft.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ft.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ft.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ft.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ft.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ft.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ft.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ft.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ft.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ft.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ft.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ft.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ft.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ft.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ft.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ft.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ft.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ft.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ft.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ft.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ft.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ft.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ft.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ft.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ft.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ft.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ft.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ft.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ft.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ft.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ft.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ft.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ft.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ft.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ft.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ft.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ft.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ft.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ft.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ft.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ft.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ft.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ft.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Bc(n){return bj[n]||{desc:"UNKNOW_ERROR_".concat(n),action:"failed"}}function ew(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function YT(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ew(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):ew(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function nw(n){return n.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function iw(n,t){if(typeof n=="string")return n;const{proxy:e,host:i,port:s}=n;if(t){const r=x("JOIN_GATEWAY_FALLBACK_PORT")||443;return r===443?"wss://".concat(i,"/ws/?p=").concat(Number(s)+150):"wss://".concat(i,":").concat(r,"/ws/?p=").concat(Number(s)+150)}return e?"wss://".concat(e,"/ws/?h=").concat(i,"&p=").concat(s):"wss://".concat(i,":").concat(s)}const Ij=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Aj=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,wj=/wss:\/\/(.+):([0-9]+)\/?/,Oj=/wss:\/\/(.[^\/]+)\/?/;let Nj=0;class Dj{constructor(t,e){m(this,"id",0),m(this,"store",void 0),m(this,"recordIndex",void 0),m(this,"websockets",[]),m(this,"try443PortDuration",2e3),m(this,"forceCloseWSDuration",5e3),m(this,"try443PortTimeout",null),m(this,"forceCloseTimeout",null),m(this,"isTry443PortFailed",!1),m(this,"isNormalPortFailed",!1),m(this,"useDoubleDomain",!1),m(this,"useProxy",!1),m(this,"startTime",Date.now()),this.id=++Nj,this.try443PortDuration=x("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=e}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;const e=Date.now()-this.startTime;for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];v.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(e,"ms:"),...s)}createWebSocket(t,e,i){this.logger("createWebSocket:",t,{isTry443Port:e,hasTimeoutDetection:i});const s=x("GATEWAY_DOMAINS"),r=Date.now(),a=[],c=s.find(h=>{var f;return Wt(f=t.host).call(f,h)});c||(this.useDoubleDomain=!1);const l=[];if(this.useDoubleDomain)s.forEach(h=>{l.push(iw(YT(YT({},t),{},{host:t.host.replace(c,h)}),e))});else{const h=YT({},t);if(e&&c){const f=s.find(g=>g!==c);f&&(h.host=h.host.replace(c,f))}l.push(iw(h,e))}try{l.forEach(h=>{const f=new WebSocket(h);f.binaryType="arraybuffer",a.push(f),this.logger("ws is connecting:",f.url)})}catch(h){if(this.logger("ws create failed"),a.forEach(f=>f.close()),a.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,e,i);if(!e&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new G(O.WS_ERR,"init websocket failed! Error: ".concat(h.toString()))}const u=Vu();return this.store&&this.store.recordJoinChannelService({urls:a.map(h=>h.url),service:"gateway"},this.recordIndex),a.forEach(h=>{h.onopen=()=>{this.logger("onopen: ws ".concat(h.url," open cost ").concat(Date.now()-r,"ms")),this.websockets.forEach(f=>{f!==h&&(f.onopen=null,f.onclose=null,f.onmessage=null,f.close(),this.logger("close backup websocket: ".concat(f.url)))}),this.websockets.length=0,u.resolve(h)},h.onclose=f=>{this.logger("onclose: ws ".concat(h.url," closed cost ").concat(Date.now()-r,"ms state: ").concat(h.readyState)),e?this.isTry443PortFailed=nw(a):this.isNormalPortFailed=nw(a),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(e&&this.isTry443PortFailed||!e&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(f.reason)),u.reject({code:f.code,reason:Fc.A_ROUND_WS_FAILED}))},h.onmessage=f=>this.logger("".concat(h.url," onmessage: ").concat(f.data))}),this.websockets.push(...a),i||(()=>{const h=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u.isResolved),this.websockets.forEach(f=>f.readyState!==WebSocket.OPEN&&f.close())};if(e||this.useProxy)return this.logger("add 5s timeout at ".concat(e?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(h,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",u.isResolved),u.isResolved)return h();Pe().os===Qn.MAC_OS&&nn()&&h(),this.createWebSocket(t,!0,!0).then(f=>u.resolve(f)).catch(f=>{this.isNormalPortFailed&&u.reject(f),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(h,this.forceCloseWSDuration)},this.try443PortDuration)})(),u.promise}chooseBestWebsocket(t,e,i,s){return this.useDoubleDomain=!!e,typeof t=="string"&&(t=function(r){let a,c,l;return[,a,c,l]=r.match(Ij)||[],a||([,c,l]=r.match(Aj)||[]),c&&l||([,c,l]=r.match(wj)||[]),c&&l||([,c]=r.match(Oj)||[]),c||v.warning("un-destructible url: ",r),{proxy:a,host:c,port:l||"443"}}(t)),this.recordIndex=s,this.useProxy=!!t.proxy,i&&this.useProxy&&(v.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function sw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}class rw extends rn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var e;Wt(e=["tryNext","recover"]).call(e,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Jt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Jt.CONNECTED):this._state==="closed"?this.emit(Jt.CLOSED):this._state==="failed"&&this.emit(Jt.FAILED))}resetReconnectCount(t){v.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],r=arguments.length>4&&arguments[4]!==void 0&&arguments[4],a=arguments.length>5?arguments[5]:void 0;super(),m(this,"connectionID",0),m(this,"currentURLIndex",0),m(this,"urls",[]),m(this,"_reconnectMode","tryNext"),m(this,"reconnectReason",void 0),m(this,"_initMutex",new Zn("websocket")),m(this,"name",void 0),m(this,"_state","closed"),m(this,"reconnectInterrupter",void 0),m(this,"websocket",void 0),m(this,"retryConfig",void 0),m(this,"reconnectCount",0),m(this,"forceCloseTimeout",5e3),m(this,"onlineReconnectListener",void 0),m(this,"useCompress",void 0),m(this,"tryDoubleDomain",!1),m(this,"use443PortOnly",!1),m(this,"wsInflateLength",0),m(this,"wsDeflateLength",0),m(this,"closeEstablishingWs",()=>{}),m(this,"store",void 0),m(this,"joinGatewayRecordIndex",void 0),this.store=a,this.name=t,this.retryConfig=function(f){for(var g=1;g<arguments.length;g++){var S=arguments[g]!=null?arguments[g]:{};g%2?sw(Object(S),!0).forEach(function(w){m(f,w,S[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(S)):sw(Object(S)).forEach(function(w){Object.defineProperty(f,w,Object.getOwnPropertyDescriptor(S,w))})}return f}({},e),this.useCompress=i,this.tryDoubleDomain=s,this.use443PortOnly=r;const{timeout:c,timeoutFactor:l}=e,u=Math.max(300,Math.floor(3*c/5)),h=Math.max(1.2,Math.floor(8*l)/10);ki.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h),On.on(Jo.NETWORK_STATE_CHANGE,(f,g)=>{f!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(f)),f===ki.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}async init(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this.forceCloseTimeout=e,this.urls=t,this.state="connecting";try{const s=Vu(),r=this.urls[this.currentURLIndex];this.createWebSocketConnection(r).then(s.resolve).catch(s.reject),this.once(Jt.CLOSED,()=>{s.reject(new Q(O.WS_DISCONNECT))}),this.once(Jt.CONNECTED,s.resolve),await s.promise}catch{}finally{i()}}close(t,e){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;e?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,e){if(!this.websocket)return void v.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(e)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:e})}sendMessage(t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Q(O.WS_ABORT,"websocket is not ready");try{e||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new Q(O.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,e=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:e}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var e;const i=Vu();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=h=>{var f;(f=this.store)===null||f===void 0||f.signalChannelOpen(),v.debug("[".concat(this.name,"] websocket opened:"),h),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},r=async h=>{var f;if(v.debug("[".concat(this.name,"] websocket close ").concat((f=this.websocket)===null||f===void 0?void 0:f.url,", code: ").concat(h.code,", reason: ").concat(h.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new Q(O.WS_DISCONNECT,"websocket close: ".concat(h.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=h.reason,this.state="reconnecting");const g=_s(this,Jt.WILL_RECONNECT,this.reconnectMode,h.reason)||this.reconnectMode,S=await this.reconnectWithAction(g);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!S)return i.reject(new Q(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(h.code))),this.close(!0);i.resolve()}},a=h=>{this.emit(Jt.ON_MESSAGE,h)},c=h=>{v.warn("[".concat(this.connectionID,"] ws open error ").concat(h))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),x("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=x("GATEWAY_WSS_ADDRESS")),v.debug("[".concat(this.name,"] start connect, url:"),t);const l=(e=this.store)===null||e===void 0?void 0:e.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u;const h=await this.chooseBestWebsocketConnection(t);this.websocket=h,s&&s(this.websocket.url),this.websocket.onclose=r,this.websocket.onmessage=a,this.websocket.onerror=c,(u=this.store)===null||u===void 0||u.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l}catch(h){const f=this.state==="closed",g=h instanceof Q,S=g&&h.code===O.WS_ABORT,w=g&&h.code===O.WS_ERR,b=g?h.message:h&&(h.reason||h.toString());v.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(b)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:S?"aborted":"error",errors:[h]},l),f||w?(i.reject(f?new Q(O.WS_DISCONNECT,"websocket is closed: ".concat(b)):new Q(O.WS_ERR,"init websocket failed: ".concat(b))),w&&v.error("[".concat(this.name,"] init websocket failed: ").concat(b))):r&&r(h)}return i.promise}async reconnectWithAction(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;v.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||On.isOnline||!On.onlineWaiter||(this.onlineReconnectListener=On.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,e){const a=Nf(this.reconnectCount,this.retryConfig);v.debug("[".concat(this.name,"] wait ").concat(a,"ms to reconnect websocket, mode: ").concat(t)),await K.race([hi(a),this.onlineReconnectListener||new K(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const s=async(a,c)=>{this.emit(Jt.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(a)};try{if(t==="retry")this.emit(Jt.RECONNECT_WAITTING_FINISH,t),await s(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);v.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Jt.RECONNECT_WAITTING_FINISH,t),await s(this.urls[this.currentURLIndex],t)}else t==="recover"&&(v.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Jt.RECONNECT_WAITTING_FINISH,t),this.urls=await hn(this,Jt.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],t))}catch(a){var r;v.error("[".concat(this.name,"] reconnect failed ").concat(a&&a.toString()));const c=a==null||(r=a.data)===null||r===void 0?void 0:r.desc;return Array.isArray(c)&&Wt(c).call(c,"dynamic key expired")?(this.emit(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,e)}return!0}}class qu extends rw{constructor(t,e){super(t,e,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,e){const i=Vu(),s=function(a,c){return new Dj(a,c)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),i.reject(new Q(O.WS_ABORT,"choose best websocket aborted"))};const r=x("GATEWAY_DOMAINS");return v.debug("[choose-best-ws] currentDomain: ",t,", domains: ",r,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,e).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Yu extends rw{constructor(t,e){super(t,e,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,e){return new K((i,s)=>{let r=!1;const a=[];this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),a.forEach(w=>{w.onclose=null,w.onopen=null,w.onmessage=null,w.close()}),s(new Q(O.WS_ABORT,"choose best websocket aborted"))};const c=x("GATEWAY_DOMAINS");let l;const u=t.indexOf("?h="),h=c.find(w=>u!==-1?Wt(t).call(t,w,u):Wt(t).call(t,w));v.debug("[choose-best-ws] currentDomain: ",h,", domains: ",c);let f=!this.tryDoubleDomain||!h;if(!f&&h){var g;const w=Date.now();try{c.forEach(b=>{const I=u===-1?t.replace(h,b):t.substr(0,u)+t.substr(u).replace(h,b),U=new WebSocket(I);U.binaryType="arraybuffer",a.push(U),v.debug("[choose-best-ws] ws is connecting:",U.url)})}catch{for(v.debug("[choose-best-ws] ws create failed, fallback to single url"),a.forEach(I=>I.close());a.length;)a.pop();f=!0}(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:a.map(b=>b.url),service:"gateway"},e),a.forEach(b=>{b.onopen=()=>{if(r)return;const I=Date.now()-w;v.debug("[choose-best-ws] ws open cost ".concat(I,"ms")),a.filter(U=>U!==b).forEach(U=>{v.debug("[choose-best-ws]close backup websocket: ".concat(U.url)),U.close()}),r=!0,i(b)},b.onclose=I=>{l=I,!r&&(a.find(U=>!(U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING))||(v.debug("[choose-best-ws] all websocket is closed"),r=!0,s(l)))},b.onmessage=I=>{v.debug("[choose-best-ws]".concat(b.url," onmessage: ").concat(I.data))}}),hi(this.forceCloseTimeout).then(()=>{a.forEach(b=>{b.readyState!==WebSocket.OPEN&&b.close()})})}if(f){var S;let w;v.debug("[choose-best-ws] use single url: ",t),(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:[t],service:"gateway"},e);try{w=new WebSocket(t),a.push(w),w.binaryType="arraybuffer"}catch(b){const I=new Q(O.WS_ERR,"init websocket failed! Error: ".concat(b.toString()));return v.error("[".concat(this.name,"]").concat(I)),void s(I)}w.onopen=()=>{i(w)},w.onclose=b=>{s(b)},w.onmessage=b=>{v.debug("[choose-best-ws]".concat(w.url," onmessage: ").concat(b.data))},hi(this.forceCloseTimeout).then(()=>{w&&w.readyState!==WebSocket.OPEN&&w.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class ow extends rn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ue.CONNECTED?this.emit(pt.WS_CONNECTED):t===ue.RECONNECTING?this.emit(pt.WS_RECONNECTING,this._websocketReconnectReason):t===ue.CLOSED&&this.emit(pt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),m(this,"_disconnectedReason",void 0),m(this,"_websocketReconnectReason",void 0),m(this,"_connectionState",ue.CLOSED),m(this,"reconnectToken",void 0),m(this,"websocket",void 0),m(this,"openConnectionTime",void 0),m(this,"clientId",void 0),m(this,"lastMsgTime",Date.now()),m(this,"uploadCache",[]),m(this,"uploadCacheInterval",void 0),m(this,"rttRolling",new TT(5)),m(this,"pingpongTimer",void 0),m(this,"wsInflateDataTimer",void 0),m(this,"pingpongTimeoutCount",0),m(this,"joinResponse",void 0),m(this,"multiIpOption",void 0),m(this,"initError",void 0),m(this,"spec",void 0),m(this,"store",void 0),m(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(pt.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const r="res-@".concat(s._id);this.emit(r,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===te.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===te.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(fe.UID_BANNED);break;case 15:this.close(fe.IP_BANNED);break;case 16:this.close(fe.CHANNEL_BANNED)}if(s._type===te.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Ft.ERR_LICENSE_MISSING:this.close(fe.LICENSE_MISSING);break;case Ft.ERR_LICENSE_EXPIRED:this.close(fe.LICENSE_EXPIRED);break;case Ft.ERR_LICENSE_MINUTES_EXCEEDED:this.close(fe.LICENSE_MINUTES_EXCEEDED);break;case Ft.ERR_LICENSE_PERIOD_INVALID:this.close(fe.LICENSE_PERIOD_INVALID);break;case Ft.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(fe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ft.ERR_LICENSE_ILLEGAL:this.close(fe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new qu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),e),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ue.CONNECTED&&this.reconnect("retry",qn.OFFLINE)})}async request(t,e,i,s){const r=Ge(6,""),a={_id:r,_type:t,_message:e},c=this.websocket.connectionID,l=()=>new K((w,b)=>{if(this.connectionState===ue.CONNECTED)return w();const I=()=>{this.off(pt.WS_CLOSED,U),w()},U=()=>{this.off(pt.WS_CONNECTED,I),b(new G(O.WS_ABORT))};this.once(pt.WS_CONNECTED,I),this.once(pt.WS_CLOSED,U),t!==Nt.PUBLISH&&t!==Nt.SUBSCRIBE&&t!==Nt.UNSUBSCRIBE&&t!==Nt.UNPUBLISH&&t!==Nt.CONTROL&&t!==Nt.RESTART_ICE||this.once(pt.DISCONNECT_P2P,()=>{b(new G(O.DISCONNECT_P2P))}),t!==Nt.PUBLISH&&t!==Nt.RESTART_ICE||this.once(pt.ABORT_P2P_EXECUTION,()=>{b(new G(O.DISCONNECT_P2P))})});if(this.connectionState!==ue.CONNECTING&&this.connectionState!==ue.RECONNECTING||t===Nt.JOIN||t===Nt.REJOIN||await l(),this.websocket.sendMessage(a,!0),s)return;const u=new K((w,b)=>{let I=!1;const U=(V,Z)=>{I=!0,w({isSuccess:V==="success",message:Z||{}}),this.off(pt.WS_CLOSED,F),this.off(pt.WS_RECONNECTING,F),this.emit(pt.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(r),U);const F=()=>{b(new G(O.WS_ABORT,"type: ".concat(t))),this.off(pt.WS_CLOSED,F),this.off(pt.WS_RECONNECTING,F),this.off("res-@".concat(r),U)};this.once(pt.WS_CLOSED,F),this.once(pt.WS_RECONNECTING,F),hi(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||I||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(pt.REQUEST_TIMEOUT,t,e))})});let h=null;try{h=await u}catch(w){if(this.connectionState===ue.CLOSED||t===Nt.LEAVE)throw new G(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():t===Nt.JOIN||t===Nt.REJOIN?null:(await l(),await this.request(t,e))}if(h.isSuccess)return h.message;const f=Number(h.message.error_code||h.message.code),g=Bc(f),S=new G(O.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(h.message.error_str),{code:f,data:h.message});return g.action==="success"?h.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(f,", message: ").concat(g.desc,", action: ").concat(g.action)),f===Ft.ERR_TOO_MANY_BROADCASTERS?((t===Nt.JOIN||t===Nt.REJOIN)&&(this.initError=S,this.close()),S.throw()):g.action==="failed"?S.throw():g.action==="quit"?(this.initError=S,this.close(),S.throw()):(f===Ft.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",qn.MULTI_IP)):this.reconnect(g.action,qn.SERVER_ERROR),t===Nt.JOIN||t===Nt.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new K(i=>{const s=r=>{(!e||e(r))&&(this.off(t,s),i(r))};this.on(t,s)})}upload(t,e){const i={_type:t,_message:e};try{this.websocket.sendMessage(i)}catch{const r=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ue.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const i={_type:t,_message:e};this.websocket.sendMessage(i)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new K((i,s)=>{this.once(pt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(pt.WS_CLOSED,()=>s(this.initError||new G(O.WS_ABORT))),this.connectionState=ue.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||fe.LEAVE,this.connectionState=ue.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===fe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new qu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(pt.ABORT_P2P_EXECUTION);const t=await hn(this,pt.REQUEST_JOIN_INFO),e=await this.request(Nt.JOIN,t);if(!e)return this.emit(pt.REPORT_JOIN_GATEWAY,Fc.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(pt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ue.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new G(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Xo(this,pt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const e=await this.request(Nt.REJOIN,t);return!!e&&(this.connectionState=ue.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),e.peers&&e.peers.forEach(i=>{this.emit(te.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(te.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(te.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(te.MUTE_AUDIO,{uid:i.uid}):this.emit(te.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(te.MUTE_VIDEO,{uid:i.uid}):this.emit(te.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(te.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(te.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(te.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(te.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(te.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const e=Bc(t.code);if(e.action!=="success"){if(e.action!=="failed")return e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(fe.UID_BANNED),void this.close()):void this.reconnect(e.action,qn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=x("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",qn.TIMEOUT):this.request(Nt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-e;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(Nt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:e}=this.websocket.getWsInflateData();t!==0&&e!==0&&this.upload(as.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Jt.RECONNECT_WAITTING_FINISH,t=>{this.emit(pt.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Jt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(pt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Jt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Jt.CLOSED,()=>{this.connectionState=ue.CLOSED}),this.websocket.on(Jt.FAILED,()=>{this._disconnectedReason=fe.NETWORK_ERROR,this.connectionState=ue.CLOSED}),this.websocket.on(Jt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ue.CONNECTED?this.connectionState=ue.RECONNECTING:this.connectionState=ue.CONNECTING}),this.websocket.on(Jt.WILL_RECONNECT,(t,e,i)=>{const s=Xo(this,pt.IS_P2P_DISCONNECTED),r=s||t!=="retry";s&&t==="retry"&&(v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",e=Fc.P2P_DISCONNECTED),r&&(v.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(pt.REPORT_JOIN_GATEWAY,e||Fc.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(pt.NEED_RENEW_SESSION),this.emit(pt.DISCONNECT_P2P)),i(t)}),this.websocket.on(Jt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",qn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(pt.REPORT_JOIN_GATEWAY,t.message||t.code||Fc.UNKNOWN_REASON,this.url||""),t instanceof G&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ft.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",qn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",qn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Jt.REQUEST_NEW_URLS,(t,e)=>{hn(this,pt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)}),this.websocket.on(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(te.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var aw=`	
\v\f\r                　\u2028\u2029\uFEFF`,Pj=ga,Lj=Ko,zT=aw,cw=wn("".replace),kj=RegExp("^["+zT+"]+"),Mj=RegExp("(^|[^"+zT+"])["+zT+"]+$"),JT=function(n){return function(t){var e=Lj(Pj(t));return 1&n&&(e=cw(e,kj,"")),2&n&&(e=cw(e,Mj,"$1")),e}},Uj={start:JT(1),end:JT(2),trim:JT(3)},xj=SR.PROPER,Vj=ce,dw=aw,Fj=Uj.trim;y({target:"String",proto:!0,forced:function(n){return Vj(function(){return!!dw[n]()||"​᠎"[n]()!=="​᠎"||xj&&dw[n].name!==n})}("trim")},{trim:function(){return Fj(this)}});var ti,ei,Bj=Ic("String").trim,jj=Cn,Gj=Bj,XT=String.prototype,$T=rt(function(n){var t=n.trim;return typeof n=="string"||n===XT||jj(XT,n)&&t===XT.trim?Gj:t});function nl(n,t,e){return{sampleRate:n,stereo:t,bitrate:e}}function Re(n,t,e,i,s){return{width:n,height:t,frameRate:e,bitrateMin:i,bitrateMax:s}}function Cr(n,t,e,i,s){return{width:{max:n},height:{max:t},frameRate:e,bitrateMin:i,bitrateMax:s}}function QT(n,t){return{numSpatialLayers:n,numTemporalLayers:t}}(function(n){n[n.CHOOSE_SERVER=11]="CHOOSE_SERVER",n[n.CLOUD_PROXY=18]="CLOUD_PROXY",n[n.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",n[n.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(ti||(ti={})),function(n){n.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",n.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",n.IOS_INTERRUPTION_START="ios-interruption-start",n.IOS_INTERRUPTION_END="ios-interruption-end",n.STATE_CHANGE="state-change"}(ei||(ei={}));const Wj={"90p":Re(160,90),"90p_1":Re(160,90),"120p":Re(160,120,15,30,65),"120p_1":Re(160,120,15,30,65),"120p_3":Re(120,120,15,30,50),"120p_4":Re(212,120),"180p":Re(320,180,15,30,140),"180p_1":Re(320,180,15,30,140),"180p_3":Re(180,180,15,30,100),"180p_4":Re(240,180,15,30,120),"240p":Re(320,240,15,40,200),"240p_1":Re(320,240,15,40,200),"240p_3":Re(240,240,15,40,140),"240p_4":Re(424,240,15,40,220),"360p":Re(640,360,15,80,400),"360p_1":Re(640,360,15,80,400),"360p_3":Re(360,360,15,80,260),"360p_4":Re(640,360,30,80,600),"360p_6":Re(360,360,30,80,400),"360p_7":Re(480,360,15,80,320),"360p_8":Re(480,360,30,80,490),"360p_9":Re(640,360,15,80,800),"360p_10":Re(640,360,24,80,800),"360p_11":Re(640,360,24,80,1e3),"480p":Re(640,480,15,100,500),"480p_1":Re(640,480,15,100,500),"480p_2":Re(640,480,30,100,1e3),"480p_3":Re(480,480,15,100,400),"480p_4":Re(640,480,30,100,750),"480p_6":Re(480,480,30,100,600),"480p_8":Re(848,480,15,100,610),"480p_9":Re(848,480,30,100,930),"480p_10":Re(640,480,10,100,400),"720p":Re(1280,720,15,120,1130),"720p_1":Re(1280,720,15,120,1130),"720p_2":Re(1280,720,30,120,2e3),"720p_3":Re(1280,720,30,120,1710),"720p_5":Re(960,720,15,120,910),"720p_6":Re(960,720,30,120,1380),"1080p":Re(1920,1080,15,120,2080),"1080p_1":Re(1920,1080,15,120,2080),"1080p_2":Re(1920,1080,30,120,3e3),"1080p_3":Re(1920,1080,30,120,3150),"1080p_5":Re(1920,1080,60,120,4780),"1440p":Re(2560,1440,30,120,4850),"1440p_1":Re(2560,1440,30,120,4850),"1440p_2":Re(2560,1440,60,120,7350),"4k":Re(3840,2160,30,120,8910),"4k_1":Re(3840,2160,30,120,8910),"4k_3":Re(3840,2160,60,120,13500)},Hj={"480p":Cr(640,480,5),"480p_1":Cr(640,480,5),"480p_2":Cr(640,480,30),"480p_3":Cr(640,480,15),"720p":Cr(1280,720,5),"720p_1":Cr(1280,720,5),"720p_2":Cr(1280,720,30),"720p_3":Cr(1280,720,15),"1080p":Cr(1920,1080,5),"1080p_1":Cr(1920,1080,5),"1080p_2":Cr(1920,1080,30),"1080p_3":Cr(1920,1080,15)},Kj={"1SL1TL":QT(1,1),"3SL3TL":QT(3,3),"2SL3TL":QT(2,3)};function $o(n){return n||(n="480p_1"),typeof n=="string"?Object.assign({},Wj[n]):n}function ZT(n){return typeof n=="string"?Object.assign({},Hj[n]):n}function qf(n){return typeof n=="string"?Object.assign({},Kj[n]):n}const qj={speech_low_quality:nl(16e3,!1),speech_standard:nl(32e3,!1,18),music_standard:nl(48e3,!1),standard_stereo:nl(48e3,!0,56),high_quality:nl(48e3,!1,128),high_quality_stereo:nl(48e3,!0,192)};function Yf(n){return typeof n=="string"?Object.assign({},qj[n]):n}const il=[];function lw(n){return Kn(n,"mediaSource",["screen","window","application"]),!0}var yt,Qe,Ua,zf,tS,sl,xa,jc,cs,Jf;(function(n){n.NEED_RENEGOTIATE="@need_renegotiate",n.NEED_REPLACE_TRACK="@need_replace_track",n.NEED_CLOSE="@need_close",n.NEED_ENABLE_TRACK="@need_enable_track",n.NEED_DISABLE_TRACK="@need_disable_track",n.NEED_SESSION_ID="@need_sid",n.SET_OPTIMIZATION_MODE="@set_optimization_mode",n.GET_STATS="@get_stats",n.GET_LOW_VIDEO_TRACK="@get_low_video_track",n.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",n.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",n.NEED_MUTE_TRACK="@need_mute_track",n.NEED_UNMUTE_TRACK="@need_unmute_track"})(yt||(yt={})),function(n){n.SCREEN_TRACK="screen_track",n.CUSTOM_TRACK="custome_track",n.LOW_STREAM="low_stream"}(Qe||(Qe={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(Ua||(Ua={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(zf||(zf={})),function(n){n[n.DISABLE=0]="DISABLE",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.AUDIO_ONLY=2]="AUDIO_ONLY"}(tS||(tS={})),function(n){n.TRANSCEIVER_UPDATED="transceiver-updated"}(sl||(sl={})),function(n){n.SOURCE_STATE_CHANGE="source-state-change",n.TRACK_ENDED="track-ended",n.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.CLOSED="closed"}(xa||(xa={})),function(n){n.FIRST_FRAME_DECODED="first-frame-decoded",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(jc||(jc={})),function(n){n.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",n.RECEIVE_TRACK_BUFFER="receive_track_buffer",n.ON_AUDIO_BUFFER="on_audio_buffer",n.UPDATE_SOURCE="update_source"}(cs||(cs={})),function(n){n.UPDATE_TRACK_SOURCE="update-track-source"}(Jf||(Jf={}));const eS={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},nS={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},uw={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Yj={uplinkNetworkQuality:0,downlinkNetworkQuality:0},hw={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Ai,ds,Gc,Qo,wi;(function(n){n.ON_TRACK="on_track",n.ON_NODE="on_node"})(Ai||(Ai={})),function(n){n.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",n.REQUEST_CONSTRAINTS="request_constraints"}(ds||(ds={})),function(n){n.IDLE="IDLE",n.INITING="INITING",n.INITEND="INITEND"}(Gc||(Gc={})),function(n){n.STATE_CHANGE="state_change",n.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",n.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",n.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Qo||(Qo={})),function(n){n.NONE="none",n.INIT="init",n.CANPLAY="canplay",n.PLAYING="playing",n.PAUSED="paused",n.SUSPEND="suspend",n.STALLED="stalled",n.WAITING="waiting",n.ERROR="error",n.DESTROYED="destroyed",n.ABORT="abort",n.ENDED="ended",n.EMPTIED="emptied",n.LOADEDDATA="loadeddata"}(wi||(wi={}));const iS={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var rl;(function(n){n.OPEN="open",n.MESSAGE="message",n.CLOSE="close",n.CLOSING="closing",n.ERROR="error"})(rl||(rl={}));class pw extends rn{constructor(t,e){super(),m(this,"_ID",void 0),m(this,"_rtpTransceiver",void 0),m(this,"_lowRtpTransceiver",void 0),m(this,"_hints",[]),m(this,"_isClosed",!1),m(this,"_originMediaStreamTrack",void 0),m(this,"_mediaStreamTrack",void 0),m(this,"_external",{}),this._ID=e||Ge(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,function(i){Wt(il).call(il,i)||il.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const e=Dt.reportApiInvoke(null,{name:Mn.GET_MEDIA_STREAM_TRACK,options:[],tag:un.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?e.onSuccess(this._mediaStreamTrack.label):e.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Ua.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const e=il.indexOf(t);e!==-1&&il.splice(e,1)}(this),this.emit(xa.CLOSED)}_updateRtpTransceiver(t,e){if(e===Ua.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(sl.TRANSCEIVER_UPDATED,t,e)}}class Ei extends pw{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}constructor(t,e){super(t,e),m(this,"_enabled",!0),m(this,"_muted",!1),m(this,"_isExternalTrack",!1),m(this,"_isClosed",!1),m(this,"_enabledMutex",void 0),m(this,"processor",void 0),m(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Zn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,e;return(t=(e=this._originMediaStreamTrack)===null||e===void 0?void 0:e.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,v.debug("[".concat(this.getTrackId(),"] close")),this.emit(yt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await qe(this,yt.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(xa.TRACK_ENDED)}stateCheck(t,e){if(v.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(e,"]")),Lc(e,t),this._enabled&&this._muted&&t==="enabled"&&e===!1)throw new Q(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",v);if(!this._enabled&&!this._muted&&t==="muted"&&e===!0)throw new Q(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",v)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function fw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}const _w=window.AudioContext||window.webkitAudioContext;let Vs=null;const Ve=new class extends rn{constructor(){super(...arguments),m(this,"prevState",void 0),m(this,"curState",void 0),m(this,"currentTime",void 0),m(this,"currentTimeStuckAt",void 0),m(this,"interruptDetectorTrack",void 0),m(this,"onLocalAudioTrackMute",()=>{v.info("ios15-interruption-start"),this.emit(ei.IOS_15_16_INTERRUPTION_START)}),m(this,"onLocalAudioTrackUnmute",async()=>{v.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?v.info("ios15-interruption-end-canceled"):(Vs&&await Vs.suspend(),this.emit(ei.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(n){v.debug("webaudio bindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=n,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(n){v.debug("webaudio unbindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===n&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function zj(){if(!_w)return void v.error("your browser is not support web audio");v.info("create audio context");const n=function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?fw(Object(i),!0).forEach(function(s){m(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):fw(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}({},x("WEBAUDIO_INIT_OPTIONS"));v.debug("audio context init option:",JSON.stringify(n)),Vs=new _w(n),Ve.curState=Vs.state,Vs.onstatechange=()=>{Ve.prevState=Ve.curState,Ve.curState=Vs?Vs.state:void 0;const{prevState:t,curState:e}=Ve,i=e==="running",s=e==="interrupted",r=t==="running",a=t==="suspended",c=t==="interrupted",l=Pe().osVersion;(Fi()||po())&&r&&s&&(v.info("ios".concat(l,"-interruption-start")),Ve.emit(ei.IOS_INTERRUPTION_START)),(Fi()||po())&&(a||c)&&i&&(v.info("ios".concat(l,"-interruption-end")),Ve.emit(ei.IOS_INTERRUPTION_END)),t!==e&&(v.debug("AudioContext State Change","".concat(t,"=>").concat(e)),Ve.emit(ei.STATE_CHANGE))},setInterval(()=>{var t;const e=(t=Vs)===null||t===void 0?void 0:t.currentTime;Ve.currentTime!==e?(Ve.currentTimeStuckAt&&(v.debug("AudioContext current time resume at ".concat(e)),Ve.currentTimeStuckAt=void 0),Ve.currentTime=e):(e!==Ve.currentTimeStuckAt&&(Dt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:e},tag:un.TRACER}).onSuccess(),v.warning("AudioContext current time stuck at ".concat(e))),Ve.currentTimeStuckAt=e)},5e3),async function(t){const e=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,s=!1,r=!1,a=!1;function c(I){t.state==="running"?l(!1):Fi()||po()?t.state==="suspended"&&(l(!0),I&&t.resume().then(h,h)):t.state!=="closed"&&(l(!0),I&&t.resume().then(h,h))}function l(I){if(s!==I){s=I;for(let U=0,F=e;U<F.length;U+=1){const V=F[U];I?window.addEventListener(V,f,{capture:!0,passive:!0}):window.removeEventListener(V,f,{capture:!0,passive:!0})}}}function u(){c(!0)}function h(){c(!1)}function f(){c(!0)}function g(I){if(!a)if(i.paused)if(I){let U;S(!1),a=!0;try{U=i.play(),U?U.then(w,w):(i.addEventListener("playing",w),i.addEventListener("abort",w),i.addEventListener("error",w))}catch{w()}}else S(!0);else S(!1)}function S(I){if(r!==I){r=I;for(let U=0,F=e;U<F.length;U++){const V=F[U];I?window.addEventListener(V,b,{capture:!0,passive:!0}):window.removeEventListener(V,b,{capture:!0,passive:!0})}}}function w(){i.removeEventListener("playing",w),i.removeEventListener("abort",w),i.removeEventListener("error",w),a=!1,g(!1)}function b(){g(!0)}if(Fi()){const I=t.createMediaStreamDestination(),U=document.createElement("div");U.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=U.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=I.stream,g(!0)}Ve.on(ei.STATE_CHANGE,u),c(!1)}(Vs)}function ol(){if(!Vs){if(zj(),!Vs)throw new Q(O.NOT_SUPPORTED,"can not create audio context");return Vs}return Vs}function mw(){return!!Vs}function Wc(n){if(function(){if(sS!==null)return sS;const i=ol(),s=i.createBufferSource(),r=i.createGain(),a=i.createGain();s.connect(r),s.connect(a),s.disconnect(r);let c=!1;try{s.disconnect(r)}catch{c=!0}return s.disconnect(),sS=c,c}())return;const t=n.connect,e=n.disconnect;n.connect=(i,s,r)=>{var a;return n._inputNodes||(n._inputNodes=[]),Wt(a=n._inputNodes).call(a,i)||(i instanceof AudioNode?(n._inputNodes.push(i),t.call(n,i,s,r)):t.call(n,i,s)),n},n.disconnect=(i,s,r)=>{e.call(n),i?_T(n._inputNodes,i):n._inputNodes=[];for(const a of n._inputNodes)t.call(n,a)}}let sS=null;function rS(n,t){let e=!1;const i=1/t;if(x("DISABLE_WEBAUDIO")){const s=window.setInterval(()=>{e?window.clearInterval(s):n(performance.now()/1e3)},1e3*i)}else{const s=ol();let r=s.createGain();r.gain.value=0,r.connect(s.destination);const a=()=>{if(e)return void(r=null);const c=s.createOscillator();c.onended=a,c.connect(r),c.start(0),c.stop(s.currentTime+i),n(s.currentTime)};a()}return()=>{e=!0}}const Oi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function Ye(){return Oi}class Ew{constructor(){m(this,"context",void 0),m(this,"analyserNode",void 0),m(this,"sourceNode",void 0),this.context=ol(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Fi()||po()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let s=0;s<t.length;++s)t[s]=i[s]/128-1}const e=Uc(t).call(t,(i,s)=>i+s*s,0)/t.length;return Math.max(10*Math.log10(e)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,e;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(e=this.sourceNode)===null||e===void 0||e.connect(this.analyserNode)}catch{v.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class gw extends rn{get processSourceNode(){return this.sourceNode}set processedNode(t){var e;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(e=this._processedNode)===null||e===void 0||e.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),m(this,"outputNode",void 0),m(this,"outputTrack",void 0),m(this,"isPlayed",!1),m(this,"context",void 0),m(this,"audioBufferNode",void 0),m(this,"destNode",void 0),m(this,"audioOutputLevel",0),m(this,"volumeLevelAnalyser",void 0),m(this,"_processedNode",void 0),m(this,"playNode",void 0),m(this,"isDestroyed",!1),m(this,"onNoAudioInput",void 0),m(this,"isNoAudioInput",!1),m(this,"_noAudioInputCount",0),this.context=ol(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Wc(this.outputNode),this.volumeLevelAnalyser=new Ew}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(cs.ON_AUDIO_BUFFER,function(i){for(let s=0;s<i.outputBuffer.numberOfChannels;s+=1){const r=i.outputBuffer.getChannelData(s);for(let a=0;a<r.length;a+=1)r[a]=0}return i.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ye().webAudioMediaStreamDest)throw new Q(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&vr(()=>{Ve.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Fi()||po()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const e=this.volumeLevelAnalyser.getAnalyserNode();let i;e.getFloatTimeDomainData?(i=new Float32Array(e.fftSize),e.getFloatTimeDomainData(i)):(i=new Uint8Array(e.fftSize),e.getByteTimeDomainData(i));let s=!1;for(let r=0;r<i.length;r++)i[r]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await hi(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,e;(t=this.processedNode)===null||t===void 0||t.disconnect(),(e=this.sourceNode)===null||e===void 0||e.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class oS extends gw{get isFreeze(){return!1}constructor(t,e,i){var s;if(super(),m(this,"sourceNode",void 0),m(this,"track",void 0),m(this,"clonedTrack",void 0),m(this,"audioElement",void 0),m(this,"isCurrentTrackCloned",!1),m(this,"isRemoteTrack",!1),m(this,"originVolumeLevelAnalyser",void 0),m(this,"rebuildWebAudio",async()=>{if(v.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void v.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>v.info("resume success")),v.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const l=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(l),Wc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),Wc(this.outputNode),this.emit(cs.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=l,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Q(O.UNEXPECTED_ERROR);this.track=t;const r=new MediaStream([this.track]);if(this.isRemoteTrack=!!e,this.sourceNode=this.context.createMediaStreamSource(r),Wc(this.sourceNode),i){const c=i.clone();c.enabled=!0,this.clonedTrack=c,v.debug("create an unmuted track ".concat(c.id," from the original track ").concat(i.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([c]));Wc(l),this.originVolumeLevelAnalyser=new Ew,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=r;const a=Pe();e&&a.os===Qn.IOS&&Number((s=a.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(Ve.on(ei.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const e=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(e),Wc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(cs.UPDATE_SOURCE),this.audioElement.srcObject=e}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Ve.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const e=t.clone();e.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=e),v.debug("create an unmuted track ".concat(e.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([e]));Wc(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Tw(n,t,e){const i=(r,a)=>r?typeof r!="number"?r.max||r.exact||r.ideal||r.min||a:r:a,s={audio:!!e&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function Jj(n,t){const e=await Sw(n.mediaSource),{sourceId:i,audio:s}=await function(r){let a=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new K((c,l)=>{const u=document.createElement("div");u.innerText="share screen",u.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const h=document.createElement("div");h.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const f=document.createElement("div");f.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",f.setAttribute("style","height: 12%;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const S=document.createElement("div");S.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const w=document.createElement("button");w.innerHTML="cancel",w.setAttribute("style","width: 85px;"),w.onclick=()=>{document.body.removeChild(U);const F=new Error("NotAllowedError");F.name="NotAllowedError",l(F)};let b=a;const I=document.createElement("div");if(a){const F=document.createElement("input");F.setAttribute("type","checkbox");const V=document.createElement("span");F.setAttribute("style","margin-right: 6px;"),V.innerText="Share audio",F.checked=b,F.onchange=()=>{b=F.checked},I.appendChild(F),I.appendChild(V)}S.appendChild(I),S.appendChild(w),h.appendChild(f),h.appendChild(g),h.appendChild(S);const U=document.createElement("div");U.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),U.appendChild(u),U.appendChild(h),document.body.appendChild(U),r.map(F=>{if(F.id){const V=document.createElement("div");V.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Z=F.thumbnail;try{const{width:$}=Z.getSize();$>1920&&(Z=Z.resize({width:1920}))}catch($){throw $&&$.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),$}V.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Z.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+F.name.replace(/[\u00A0-\u9999<>\&]/g,function($){return"&#"+$.charCodeAt(0)+";"})+"</span>",V.onclick=()=>{document.body.removeChild(U),c({sourceId:F.id,audio:b})},g.appendChild(V)}})})}(e,t);return await Tw(i,n,s)}async function Sw(n){let t=["window","screen"];n!=="application"&&n!=="window"||(t=["window"]),n==="screen"&&(t=["screen"]);const e=NI();if(!e)throw console.error("failed to fetch electron, please mount it to window"),new Q(O.ELECTRON_IS_NULL);let i=null;try{var s;i=((s=e.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:t}))||e.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new K((r,a)=>{e.desktopCapturer.getSources({types:t},(c,l)=>{c?a(c):r(l)})}));try{return await i}catch(r){throw new Q(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,r.toString())}}function vw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}const aS=new Zn("safari");let yw=!1,Cw=!1;async function Fs(n,t){let e=0,i=null;for(;e<2;)try{i=await Xj(n,t,e>0);break}catch(s){if(s instanceof Q)throw v.error("[".concat(t,"] ").concat(s.toString())),s;const r=Xf(s.name||s.code||s,s.message);if(r.code===O.MEDIA_OPTION_INVALID){v.debug("[".concat(t,"] detect media option invalid, retry")),e+=1,await hi(500);continue}throw v.error("[".concat(t,"] ").concat(r.toString())),r}if(!i)throw new Q(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function Xj(n,t,e){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Q(O.NOT_SUPPORTED,"can not find getUserMedia");e&&(n.video&&(delete n.video.width,delete n.video.height),n.screen&&(delete n.screen.width,delete n.screen.height));const i=Ye(),s=new MediaStream;if(n.audioSource&&s.addTrack(n.audioSource),n.videoSource&&s.addTrack(n.videoSource),!n.audio&&!n.video&&!n.screen)return v.debug("Using Video Source/ Audio Source"),s;if(n.screen)if(NI())n.screen.sourceId?al(s,await Tw(n.screen.sourceId,n.screen,n.screenAudio)):al(s,await Jj(n.screen,n.screenAudio));else if(dT()&&n.screen.extensionId&&n.screen.mandatory){if(!i.getStreamFromExtension)throw new Q(O.NOT_SUPPORTED,"This browser does not support screen sharing");v.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const g=await(a=n.screen.extensionId,c=t,new K((S,w)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},b=>{if(!b||!b.streamId)return v.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),b),void w(new Q(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));S(b.streamId)})}catch(b){v.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),b.toString()),w(new Q(O.CHROME_PLUGIN_NOT_INSTALL))}}));n.screen.mandatory.chromeMediaSourceId=g,al(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:n.screen.mandatory}}))}else if(i.getDisplayMedia){var r;n.screen.mediaSource&&lw(n.screen.mediaSource);const g={width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate,displaySurface:(r=n.screen.displaySurface)!==null&&r!==void 0?r:n.screen.mediaSource==="screen"?"monitor":n.screen.mediaSource},{selfBrowserSurface:S,surfaceSwitching:w,systemAudio:b}=n.screen,I={selfBrowserSurface:S,surfaceSwitching:w,systemAudio:b};!S&&delete I.selfBrowserSurface,!w&&delete I.surfaceSwitching,!b&&delete I.systemAudio,v.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:g,audio:!!n.screenAudio,controls:I}));const U=await navigator.mediaDevices.getDisplayMedia(function(F){for(var V=1;V<arguments.length;V++){var Z=arguments[V]!=null?arguments[V]:{};V%2?vw(Object(Z),!0).forEach(function($){m(F,$,Z[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(Z)):vw(Object(Z)).forEach(function($){Object.defineProperty(F,$,Object.getOwnPropertyDescriptor(Z,$))})}return F}({video:g,audio:!!n.screenAudio},I));al(s,U)}else{if(!nn())throw v.error("[".concat(t,"] This browser does not support screenSharing")),new Q(O.NOT_SUPPORTED,"This browser does not support screen sharing");{n.screen.mediaSource&&lw(n.screen.mediaSource);const g={video:{mediaSource:n.screen.mediaSource,width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate}};v.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(g))),al(s,await navigator.mediaDevices.getUserMedia(g))}}var a,c;if(!n.video&&!n.audio)return s;let l={video:n.video,audio:n.audio},u=x("MEDIA_DEVICE_CONSTRAINTS");if(u)try{typeof u=="string"&&(u=JSON.parse(u)),l=ET(l,u)}catch{}v.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(l)),Pe();let h,f=null;(Vi()||Fi()||Cf())&&(f=await aS.lock());try{h=await navigator.mediaDevices.getUserMedia(l)}catch(g){throw f&&f(),g}return l.audio&&(yw=!0),l.video&&(Cw=!0),al(s,h),f&&f(),s}function Xf(n,t){switch(n){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Q(O.MEDIA_OPTION_INVALID,"".concat(n,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Q(O.DEVICE_NOT_FOUND,"".concat(n,": ").concat(t));case"NotSupportedError":return new Q(O.NOT_SUPPORTED,"".concat(n,": ").concat(t));case"NotReadableError":return new Q(O.NOT_READABLE,"".concat(n,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Q(O.PERMISSION_DENIED,"".concat(n,": ").concat(t));case"ConstraintNotSatisfiedError":return new Q(O.CONSTRAINT_NOT_SATISFIED,"".concat(n,": ").concat(t));default:return v.error("getUserMedia unexpected error",n),new Q(O.UNEXPECTED_ERROR,"".concat(n,": ").concat(t))}}function al(n,t){const e=n.getVideoTracks()[0],i=n.getAudioTracks()[0],s=t.getVideoTracks()[0],r=t.getAudioTracks()[0];r&&(i&&n.removeTrack(i),n.addTrack(r)),s&&(e&&n.removeTrack(e),n.addTrack(s))}const Bs=new class extends rn{get state(){return this._state}set state(n){n!==this._state&&(this.emit(Qo.STATE_CHANGE,n),this._state=n)}constructor(){super(),m(this,"_state",Gc.IDLE),m(this,"isAccessMicrophonePermission",!1),m(this,"isAccessCameraPermission",!1),m(this,"lastAccessMicrophonePermission",!1),m(this,"lastAccessCameraPermission",!1),m(this,"checkdeviceMatched",!1),m(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(x("ENUMERATE_DEVICES_INTERVAL")||(Rf()||yf()===Qn.HARMONY_OS)&&Oa())&&this.updateDevicesInfo()},x("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(n=>v.error(n.toString()))}async enumerateDevices(n,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Q(O.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i);let r=!this.isAccessMicrophonePermission&&n,a=!this.isAccessCameraPermission&&t;s.audio&&(r=!1),s.video&&(a=!1);let c=null,l=null,u=null;if(!e&&(r||a)){if(aS.isLocked&&(v.debug("[device manager] wait GUM lock"),(await aS.lock())(),v.debug("[device manager] GUM unlock")),yw&&(r=!1,this.isAccessMicrophonePermission=!0),Cw&&(a=!1,this.isAccessCameraPermission=!0),v.debug("[device manager] check media device permissions",n,t,r,a),r&&a){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(h){const f=Xf(h.name||h.code||h,h.message);if(f.code===O.PERMISSION_DENIED)throw f;v.warning("getUserMedia failed in getDevices",f)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(r){try{c=await navigator.mediaDevices.getUserMedia({audio:n})}catch(h){const f=Xf(h.name||h.code||h,h.message);if(f.code===O.PERMISSION_DENIED)throw f;v.warning("getUserMedia failed in getDevices",f)}this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({video:t})}catch(h){const f=Xf(h.name||h.code||h,h.message);if(f.code===O.PERMISSION_DENIED)throw f;v.warning("getUserMedia failed in getDevices",f)}this.isAccessCameraPermission=!0}v.debug("[device manager] mic permission",n,"cam permission",t)}try{const h=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach(f=>f.stop()),l&&l.getTracks().forEach(f=>f.stop()),u&&u.getTracks().forEach(f=>f.stop()),c=null,l=null,u=null,h}catch(h){return c&&c.getTracks().forEach(f=>f.stop()),l&&l.getTracks().forEach(f=>f.stop()),u&&u.getTracks().forEach(f=>f.stop()),c=null,l=null,u=null,new Q(O.ENUMERATE_DEVICES_FAILED,h.toString()).throw()}}async getRecordingDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,n)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(n){let t=null;return this.deviceInfoMap.forEach(e=>{e.device.label===n&&(t=e.device.deviceId)}),t}async getDeviceById(n){const t=(await this.enumerateDevices(!0,!0,!0)).find(e=>e.deviceId===n);if(!t)throw new Q(O.DEVICE_NOT_FOUND,"deviceId: ".concat(n));return t}async init(){this.state=Gc.INITING;try{await this.updateDevicesInfo(),this.state=Gc.INITEND}catch(n){throw v.warning("Device Detection functionality cannot start properly.",n.toString()),this.state=Gc.IDLE,!(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")&&new Q(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}}async updateDevicesInfo(){const n=await this.enumerateDevices(!0,!0,!0),t=Date.now(),e=[];if(n[0]&&n[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=n.find(a=>a.kind==="audioinput"&&a.deviceId==="default"),r=n.find(a=>a.kind==="audiooutput"&&a.deviceId==="default");s&&r?r.groupId===s.groupId?v.debug("[device-check] default input ".concat(s.label," and output ").concat(r.label," is the same group")):v.warning("[device-check] default input ".concat(s.label," and output ").concat(r.label," is not the same group")):v.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(n);if(n.forEach(s=>{if(!s.deviceId)return;const r=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((r?r.state:"INACTIVE")!=="ACTIVE"){const a={initAt:t,updateAt:t,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),a),e.push(a)}r&&(r.updateAt=t)}),this.deviceInfoMap.forEach((s,r)=>{s.state==="ACTIVE"&&s.updateAt!==t&&(s.state="INACTIVE",e.push(s))}),this.state!==Gc.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));e.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Qo.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Qo.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Qo.PLAYOUT_DEVICE_CHANGED,s)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(n){const t=n.filter(s=>s.kind==="audioinput"),e=n.filter(s=>s.kind==="videoinput"),i={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){i.audio=!0;break}for(const s of e)if(s.label&&s.deviceId){i.video=!0;break}return i}};let cS=!1;const js=new class extends rn{constructor(){super(...arguments),m(this,"onAutoplayFailed",void 0),m(this,"onAudioAutoplayFailed",void 0)}};function Rw(){if(Pe(),!cS){const n=t=>{t.preventDefault(),cS=!1,Fu()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};cS=!0,Fu()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),v.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),js.onAutoplayFailed?js.onAutoplayFailed():js.onAudioAutoplayFailed?v.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):v.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),js.emit("autoplay-failed")}}function bw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Iw(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?bw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):bw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function Aw(n,t,e,i){if(!n)return;const s=Dt.getBaseInfoBySessionId(n);if(!s)return;const r=s.info,a=Date.now(),c=Iw(Iw({},r),{},{vid:r.vid===void 0?0:Number(r.vid),lts:a,elapse:a-s.startTime,cbRegistered:js.onAutoplayFailed||js.onAudioAutoplayFailed?1:-1,errorMsg:e,mediaType:t,trackId:i,extend:void 0});Dt.send({type:on.AUTOPLAY_FAILED,data:c},!0)}const $j=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Es=new class{constructor(){m(this,"onAutoplayFailed",void 0),m(this,"elementMap",new Map),m(this,"elementStateMap",new Map),m(this,"elementsNeedToResume",[]),m(this,"sinkIdMap",new Map),m(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[t,e]=n;const i=this.elementStateMap.get(t),s=e.srcObject.getAudioTracks()[0];Hd()?s&&s.readyState==="live"&&Ve.curState==="running"&&(v.debug("auto resume after interruption for iOS 15"),e.pause(),e.play()):i&&i==="paused"&&s&&s.readyState==="live"&&Ve.curState==="running"&&(v.debug("auto resume after interruption for iOS"),e.play())})}),m(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[t,e]=n;const i=e.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(v.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),e.pause(),e.play())})}),this.autoResumeAudioElement(),Ve.on(ei.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ve.on(ei.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Ve.on(ei.STATE_CHANGE,()=>{Fi()&&Ve.prevState==="suspended"&&Ve.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(n,t){const e=this.elementMap.get(n);if(this.sinkIdMap.set(n,t),e)try{await e.setSinkId(t)}catch(i){throw new Q(O.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(n,t,e,i){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([n]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,wi.INIT),this.setVolume(t,e);const r=this.sinkIdMap.get(t);if(r)try{s.setSinkId(r).catch(c=>{v.warning("[".concat(t,"] set sink id failed"),c.toString())})}catch(c){v.warning("[".concat(t,"] set sink id failed"),c.toString())}const a=s.play();a&&a.then&&a.catch(c=>{i&&Aw(i,"audio",c.message,t),v.warning("audio element play warning",c.toString()),this.elementMap.has(t)&&c.name==="NotAllowedError"&&(v.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),vr(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Rw()}))})}updateTrack(n,t){const e=this.elementMap.get(n);e&&(e.srcObject=new MediaStream([t]))}isPlaying(n){return this.elementMap.has(n)&&this.elementStateMap.get(n)==="playing"}setVolume(n,t){const e=this.elementMap.get(n);e&&(t=Math.max(0,Math.min(100,t)),e.volume=t/100)}stop(n){const t=this.elementMap.get(n);if(this.sinkIdMap.delete(n),!t)return;const e=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(e,1),t.srcObject=null,t.remove(),this.elementMap.delete(n),this.elementStateMap.delete(n)}bindAudioElementEvents(n,t){$j.forEach(e=>{t.addEventListener(e,i=>{const s=this.elementStateMap.get(n),r=i.type==="pause"?"paused":i.type;if(v.debug("[".concat(n,"] audio-element-status change ").concat(s," => ").concat(r)),i.type==="error"){const a=t==null?void 0:t.error;a&&v.error("[".concat(n,"] media error, code: ").concat(a.code,", message: ").concat(a.message))}this.elementStateMap.set(n,r)})})}getPlayerState(n){return this.elementStateMap.get(n)||"uninit"}autoResumeAudioElement(){const n=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(e=>{v.debug("Auto resume audio element success")}).catch(e=>{v.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new K(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Fu()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0))})}};function Tn(){return function(n,t,e){const i=e.value;return typeof i=="function"&&(e.value=function(){this._isClosed&&new Q(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",v);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];const c=i.apply(this,r);return c instanceof K?new K((l,u)=>{c.then(l).catch(u)}):c}),e}}function ww(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function $f(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ww(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):ww(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Ow extends rn{constructor(t){super(),m(this,"name","VideoProcessorDestination"),m(this,"ID","0"),m(this,"_source",void 0),m(this,"videoContext",void 0),m(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Q(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Q(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Ai.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ai.ON_TRACK,void 0)}}class Nw extends rn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,e){super(),m(this,"constraintsMap",new Map),m(this,"statsRegistry",[]),m(this,"usageRegistry",[]),m(this,"trackId",void 0),m(this,"direction",void 0),m(this,"_chained",!1),this.trackId=t,this.direction=e}async getConstraints(){return await hn(this,ds.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,e){var i;return v.info("processor ".concat(e.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(e,t),qe(this,ds.REQUEST_UPDATE_CONSTRAINTS,Array.from(_o(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var e;if(this.constraintsMap.has(t))return v.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),qe(this,ds.REQUEST_UPDATE_CONSTRAINTS,Array.from(_o(e=this.constraintsMap).call(e)))}registerStats(t,e,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:e,cb:i})}unregisterStats(t,e){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:e,processorName:i,type:s,cb:r}of this.statsRegistry)try{const a=r();t.push({processorID:e,processorName:i,type:s,stats:a})}catch(a){v.error(new Q(O.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,e){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:e})}unregisterUsage(t){const e=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);e!==-1&&this.usageRegistry.splice(e,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:e}of this.usageRegistry)try{let i=e();i instanceof K&&(i=await i),t.push($f($f({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class Qf extends rn{constructor(t){super(),m(this,"name","AudioProcessorDestination"),m(this,"ID","0"),m(this,"inputTrack",void 0),m(this,"inputNode",void 0),m(this,"audioProcessorContext",void 0),m(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Q(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Q(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ai.ON_TRACK,void 0),this.emit(Ai.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Ai.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Ai.ON_NODE,this.inputNode))}}class Zf extends rn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,e,i){super(),m(this,"constraintsMap",new Map),m(this,"statsRegistry",[]),m(this,"audioContext",void 0),m(this,"trackId",void 0),m(this,"direction",void 0),m(this,"usageRegistry",[]),m(this,"_chained",!1),this.audioContext=t,this.trackId=e,this.direction=i}async getConstraints(){return hn(this,ds.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,e){var i;return v.info("processor ".concat(e.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(e,t),qe(this,ds.REQUEST_UPDATE_CONSTRAINTS,Array.from(_o(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var e;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),qe(this,ds.REQUEST_UPDATE_CONSTRAINTS,Array.from(_o(e=this.constraintsMap).call(e)))}registerStats(t,e,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:e,cb:i})}unregisterStats(t,e){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:e,processorName:i,type:s,cb:r}of this.statsRegistry)try{const a=r();t.push({processorID:e,processorName:i,type:s,stats:a})}catch(a){v.error(new Q(O.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,e){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:e})}unregisterUsage(t){const e=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);e!==-1&&this.usageRegistry.splice(e,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:e}of this.usageRegistry)try{let i=e();i instanceof K&&(i=await i),t.push($f($f({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class dS extends rn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),m(this,"context",void 0),m(this,"processSourceNode",void 0),m(this,"outputTrack",void 0),m(this,"processedNode",void 0),m(this,"clonedTrack",void 0),m(this,"outputNode",void 0),this.outputNode=new Qj}setVolume(){}createOutputTrack(){throw new Q(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Qj{disconnect(){}connect(){}}let cl=null;class Zj{constructor(){m(this,"state","open"),m(this,"trigger",void 0),m(this,"tasks",[]),v.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",v.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(t=>t.key),"]")),this.trigger=void 0,this.tasks.forEach(t=>{let{func:e}=t;return e()}),this.tasks.length=0,v.debug("[macro-task-queue] is closed.")})}enqueue(t,e){this.state!=="closed"&&(this.tasks.push({key:t,func:e}),v.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")))}runTask(t){if(this.state==="closed")return;const e=this.tasks.findIndex(i=>i.key===t);if(e!==-1){const i=this.tasks.splice(e,1);v.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")),i[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,v.debug("[macro-task-queue] is closed."))}}function lS(n){return function(t,e,i){var s;const r=(s=i.value)!==null&&s!==void 0?s:i.get,a=function(){cl&&cl.state==="open"&&cl.runTask(n);for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return r==null?void 0:r.apply(this,...l)};return i.value?i.value=a:i.get=a,i}}function Dw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function uS(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Dw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Dw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Le extends Ei{get _source(){return this._trackSource}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get processorDestination(){return this._processorDestination}set processorDestination(t){this._processorDestination=t}get isPlaying(){return this._useAudioElement?Es.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,i,s,r){super(t,i),m(this,"trackMediaType","audio"),m(this,"_encoderConfig",void 0),m(this,"_trackSource",void 0),m(this,"_enabled",!0),m(this,"_volume",100),m(this,"_useAudioElement",!1),m(this,"_bypassWebAudio",!1),m(this,"processor",void 0),m(this,"_processorContext",void 0),m(this,"_processorDestination",void 0),m(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!s;const a=()=>{this.processorContext=new Zf(this._source.context,this.getTrackId(),"local"),this.processorDestination=new Qf(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(cs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},c=r&&Vi()&&!mw();x("DISABLE_WEBAUDIO")?(this._source=new dS,this._useAudioElement=!0,this._bypassWebAudio=!0):c?this._source=new dS:(this._source=new oS(t,!1,this._getOriginVolumeLevel?t:void 0),x("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),a(),!x("DISABLE_WEBAUDIO")&&c&&(cl||(cl=new Zj),cl).enqueue("INIT_WEBAUDIO",()=>{this._source=new oS(t,!1,this._getOriginVolumeLevel?t:void 0),x("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),a(),this.emit(Jf.UPDATE_TRACK_SOURCE)})}setVolume(t){je(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Es.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void v.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,qe(this,yt.NEED_REPLACE_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{v.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement)throw new Q(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Es.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,i){return this._setEnabled(t,e,i)}async _setEnabled(t,e,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await qe(this,yt.NEED_ENABLE_TRACK,this),v.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(s){throw i||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await qe(this,yt.NEED_DISABLE_TRACK,this)}catch(s){throw i||(this._enabled=!0),v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await qe(this,yt.NEED_MUTE_TRACK,this):await qe(this,yt.NEED_UNMUTE_TRACK,this))}getStats(){return ju(()=>{v.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),_s(this,yt.GET_STATS)||uS({},eS)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(cs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(cs.ON_AUDIO_BUFFER),this._source.on(cs.ON_AUDIO_BUFFER,i=>t(i))}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Es.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Es.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Es.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:t,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await qe(this,yt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return K.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Q(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ai.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await qe(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await qe(this,yt.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(Ai.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ai.ON_TRACK),this.processorDestination.removeAllListeners(Ai.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ds.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ds.REQUEST_CONSTRAINTS)}}et([lS("INIT_WEBAUDIO"),A("design:type",Object),A("design:paramtypes",[Object])],Le.prototype,"_source",null),et([lS("INIT_WEBAUDIO"),A("design:type",Zf),A("design:paramtypes",[Zf])],Le.prototype,"processorContext",null),et([lS("INIT_WEBAUDIO"),A("design:type",Qf),A("design:paramtypes",[Qf])],Le.prototype,"processorDestination",null),et([Ht({argsMap:(n,t)=>[n.getTrackId(),t],throttleTime:300}),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Le.prototype,"setVolume",null),et([Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Le.prototype,"setPlaybackDevice",null),et([zd("LocalAudioTrack","_enabledMutex"),Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[Boolean,Object,Boolean]),A("design:returntype",K)],Le.prototype,"setEnabled",null),et([zd("LocalAudioTrack","_enabledMutex"),Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",K)],Le.prototype,"setMuted",null),et([Tn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Object)],Le.prototype,"getStats",null),et([Tn(),A("design:type",Function),A("design:paramtypes",[Object,Number]),A("design:returntype",void 0)],Le.prototype,"setAudioFrameCallback",null),et([Ht({argsMap:n=>[n.getTrackId()]}),Tn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Le.prototype,"play",null),et([Ht({argsMap:n=>[n.getTrackId()]}),Tn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Le.prototype,"stop",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Le.prototype,"close",null),et([Ht({argsMap:(n,t)=>[n.getTrackId(),t.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],Le.prototype,"pipe",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Le.prototype,"unpipe",null);class Va extends Le{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,i,s){super(t,e.encoderConfig?Yf(e.encoderConfig):{},s,x("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),m(this,"_config",void 0),m(this,"_deviceName","default"),m(this,"_constraints",void 0),m(this,"_originalConstraints",void 0),m(this,"_enabled",!0),this._config=e,this._constraints=i,this._originalConstraints=i,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Hd()||uT())&&Ve.bindInterruptDetectorTrack(this),this.on(Jf.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),mw()&&this.bindProcessorContextEvents()}async setDevice(t){if(v.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await Bs.getDeviceById(t),i={};i.audio=uS({},this._constraints),i.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let s=null;try{s=await Fs(i,this.getTrackId())}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),s=await Fs({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await Bs.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}v.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,i){if(e)return v.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),i||(this._enabled=!1);try{await qe(this,yt.NEED_DISABLE_TRACK,this)}catch(c){throw v.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=uS({},this._constraints),a=Bs.searchDeviceIdByName(this._deviceName);a&&!r.deviceId&&(r.deviceId=a);try{i||(this._enabled=!0);const c=await Fs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await qe(this,yt.NEED_ENABLE_TRACK,this)}catch(c){throw i||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}v.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Hd()||uT())&&Ve.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Fi()||po())&&this._enabled&&!this._isClosed&&Ve.duringInterruption){const t=async()=>{Ve.off(ei.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ve.on(ei.IOS_INTERRUPTION_END,t)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(xa.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,i=Bs.searchDeviceIdByName(this._deviceName);if(i&&!e.deviceId&&(e.deviceId=i),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const s=await Fs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(ds.REQUEST_UPDATE_CONSTRAINTS,async(t,e,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),e()}catch(s){i(s)}}),this.processorContext.on(ds.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}}et([Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Va.prototype,"setDevice",null),et([zd("MicrophoneAudioTrack","_enabledMutex"),Ht({argsMap:(n,t,e)=>[n.getTrackId(),t,e]}),Tn(),A("design:type",Function),A("design:paramtypes",[Boolean,Boolean,Boolean]),A("design:returntype",K)],Va.prototype,"setEnabled",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Va.prototype,"close",null);class Fa extends Le{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,i,s){super(e.createOutputTrack(),i,s),m(this,"source",void 0),m(this,"_bufferSource",void 0),this.source=t,this._bufferSource=e,this._bufferSource.on(cs.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(xa.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){je(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}et([Ht({argsMap:(n,t)=>[n.getTrackId(),t,n.duration]}),Tn(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],Fa.prototype,"startProcessAudioBuffer",null),et([Ht({argsMap:n=>[n.getTrackId()]}),Tn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Fa.prototype,"pauseProcessAudioBuffer",null),et([Ht({argsMap:n=>[n.getTrackId()]}),Tn(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Fa.prototype,"seekAudioBuffer",null),et([Ht({argsMap:n=>[n.getTrackId()]}),Tn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Fa.prototype,"resumeProcessAudioBuffer",null),et([Ht({argsMap:n=>[n.getTrackId()]}),Tn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Fa.prototype,"stopProcessAudioBuffer",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Fa.prototype,"close",null),et([Ht({argsMap:n=>[n.getTrackId()]}),Tn(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Fa.prototype,"setAudioBufferPlaybackSpeed",null);class Pn extends Le{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=ol().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Ge(8,"track-mix-")),m(this,"trackList",void 0),m(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(v.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):v.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){v.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}_T(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(e=>{e._encoderConfig&&((e._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=e._encoderConfig.bitrate),(e._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=e._encoderConfig.sampleRate),(e._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=e._encoderConfig.sampleSize),e._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(e=>{e instanceof Pn?e.emit(sl.TRANSCEIVER_UPDATED,t):e._updateRtpTransceiver(t)}))}}function t_(n){const t={};n.facingMode&&(t.facingMode=n.facingMode),n.cameraId&&(t.deviceId={exact:n.cameraId});const e=$o(n.encoderConfig);return e.width!=null&&(t.width=e.width),e.height!=null&&(t.height=e.height),!RI()&&e.frameRate&&(t.frameRate=e.frameRate),Pe().name===ke.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),nn()&&(t.frameRate={ideal:30,max:30}),t}function Pw(n){const t={};if(RI()||(n.AGC!==void 0&&(t.autoGainControl=n.AGC),n.AEC!==void 0&&(t.echoCancellation=n.AEC),n.ANS!==void 0&&(t.noiseSuppression=n.ANS,dT()&&n.ANS&&(t.googHighpassFilter=n.ANS))),n.encoderConfig){const e=Yf(n.encoderConfig);t.channelCount=e.stereo?2:1,t.sampleRate=e.sampleRate,t.sampleSize=e.sampleSize}return n.microphoneId&&(t.deviceId={exact:n.microphoneId}),Rf()&&(t.sampleRate=void 0),t}class t3 extends gw{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(cs.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),m(this,"audioBuffer",void 0),m(this,"sourceNode",void 0),m(this,"startPlayTime",0),m(this,"startPlayOffset",0),m(this,"pausePlayTime",0),m(this,"options",void 0),m(this,"currentLoopCount",0),m(this,"currentPlaybackSpeed",100),m(this,"_currentState","stopped"),this.audioBuffer=t,this.options=e,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):v.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Lw=new Map;async function e3(n,t){let e=null;if(typeof n=="string"){const s=Lw.get(n);if(s)return v.debug("use cached audio resource: ",n),s;try{e=(await jr(()=>rs.get(n,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(r){throw new Q(O.FETCH_AUDIO_FILE_FAILED,r.toString())}}else e=await new K((r,a)=>{const c=new FileReader;c.onload=l=>{l.target?r(l.target.result):a(new Q(O.READ_LOCAL_AUDIO_FILE_ERROR))},c.onerror=()=>{a(new Q(O.READ_LOCAL_AUDIO_FILE_ERROR))},c.readAsArrayBuffer(n)});const i=await function(s){const r=ol();return new K((a,c)=>{r.decodeAudioData(s,l=>{a(l)},l=>{c(new Q(O.DECODE_AUDIO_FILE_FAILED,l.toString()))})})}(e);return typeof n=="string"&&t&&Lw.set(n,i),i}const hS=n=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new K((e,i)=>{t.toBlob(async s=>{if(t.remove(),s){const r=await kw(s);e({buffer:r,width:t.width,height:t.height})}else i(new Q(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,1)})},kw=async n=>{const t=await n.arrayBuffer();return new Uint8Array(t)},Zo=new class extends rn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),m(this,"_lastHiddenTime",0),m(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),v.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function Mw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Uw(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Mw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Mw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class pS{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(v.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}constructor(t){m(this,"trackId",void 0),m(this,"config",void 0),m(this,"onFirstVideoFrameDecoded",void 0),m(this,"freezeTimeCounterList",[]),m(this,"renderFreezeAccTime",0),m(this,"isKeepLastFrame",!1),m(this,"timeUpdatedCount",0),m(this,"freezeTime",0),m(this,"playbackTime",0),m(this,"lastTimeUpdatedTime",0),m(this,"autoplayFailed",!1),m(this,"videoTrack",void 0),m(this,"videoElement",void 0),m(this,"cacheVideoElement",void 0),m(this,"videoElementCheckInterval",void 0),m(this,"_videoElementStatus",wi.NONE),m(this,"isGettingVideoDimensions",!1),m(this,"startGetVideoDimensions",()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return v.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()}),m(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Ve.curState==="running"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(EI())),yI()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),m(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=wi.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=wi.CANPLAY;break;case"stalled":this.videoElementStatus=wi.STALLED;break;case"suspend":this.videoElementStatus=wi.SUSPEND;break;case"pause":this.videoElementStatus=wi.PAUSED,Fi()||po()||Vi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=wi.WAITING;break;case"abort":this.videoElementStatus=wi.ABORT;break;case"ended":this.videoElementStatus=wi.ENDED;break;case"emptied":this.videoElementStatus=wi.EMPTIED;break;case"error":{this.videoElementStatus=wi.ERROR;const i=this.videoElement.error;i&&v.error("[".concat(this.trackId,"] media error, code: ").concat(i.code,", message: ").concat(i.message));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const s=i-this.lastTimeUpdatedTime,r=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Zo.lastVisibleTime<Zo.lastHiddenTime||r<Zo.lastHiddenTime||r<Zo.lastVisibleTime)return;for(s>x("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const a=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(a),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),m(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(EI())),yI()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Ve.on(ei.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ve.on(ei.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const e=this.videoElement.play();e&&e.catch&&e.catch(s=>{t&&Aw(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(v.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):v.warning("[".concat(this.trackId,"] play warning: "),s)});const i=Pe();if((i.name==="Safari"&&Number(i.version)===15||Hd())&&e&&e.then){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};e.then(s).catch(s)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const e=t.getContext("2d");if(!e)return v.error("create canvas context failed!"),new ImageData(2,2);e.drawImage(this.videoElement,0,0,t.width,t.height);const i=e.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,i.width,i.height),new K((r,a)=>{i.toBlob(async c=>{if(i.remove(),c){const l=await kw(c);r({buffer:l,width:i.width,height:i.height})}else a(new Q(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,e<0?.1:e>1?1:e)})):await hS(t)}destroy(){Ve.off(ei.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ve.off(ei.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=wi.INIT,!this.videoElementCheckInterval&&(xw.forEach(r=>{this.videoElement.addEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(r){return r!==document.body&&document.body.contains(r)})(this.videoElement)||(this.videoElementStatus=wi.DESTROYED)},1e3),x("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,e;let r;const a=(c,l)=>{if(this.videoElementStatus===wi.PLAYING){if(r){const f=l.presentationTime-r.presentationTime;f>x("VIDEO_FREEZE_DURATION")&&Zo.lastVisibleTime>=Zo.lastHiddenTime&&r.timestamp>Zo.lastVisibleTime&&r.timestamp>Zo.lastHiddenTime&&(this.renderFreezeAccTime+=f)}r=Uw(Uw({},l),{},{timestamp:c})}var u,h;x("ENABLE_VIDEO_FRAME_CALLBACK")&&((u=(h=this.videoElement).requestVideoFrameCallback)===null||u===void 0||u.call(h,a))};(t=(e=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(e,a)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Rf()&&(this.videoElement.poster="noposter");const i=Pe();i.name==="Safari"&&Number(i.version)===15||Hd()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nn()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch(r=>{v.debug("[".concat(this.trackId,"] playback interrupted"),r.toString())})}resetVideoElement(){xw.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=wi.NONE}handleAutoPlayFailed(){const t=e=>{e.preventDefault(),this.videoElement.play().then(()=>{v.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{v.error(i)}),this.autoplayFailed=!1,Fu()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Fu()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),Rw()}}const xw=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Vw extends pS{constructor(t){super(t),m(this,"container",void 0),m(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const e=t.element;e!==this.slot&&(this.destroy(),this.slot=e),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var e;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await hS(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",x("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function Fw(n){return new K((t,e)=>{let i=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const r=Fi()?"canplay":"playing";s.addEventListener(r,()=>{const a=s.videoWidth,c=s.videoHeight;!a&&nn()||(i=!0,s.srcObject=null,s.remove(),t([a,c]))}),s.srcObject=new MediaStream([n]),s.play().catch(wf),setTimeout(()=>{i||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}const n3=async(n,t,e)=>{const i=function(a){const c=[];for(let l=0;l<a.length;l+=2)c.push(parseInt(a.slice(l,l+2),16));return Uint8Array.from(c)}(function(a){const c="0123456789abcdef";function l(mt){let ut,ee="";for(ut=0;ut<=3;ut++)ee+=c.charAt(mt>>8*ut+4&15)+c.charAt(mt>>8*ut&15);return ee}function u(mt,ut){const ee=(65535&mt)+(65535&ut);return(mt>>16)+(ut>>16)+(ee>>16)<<16|65535&ee}function h(mt,ut,ee,Te,be,Fe){return u(function(_e,xn){return _e<<xn|_e>>>32-xn}(u(u(ut,mt),u(Te,Fe)),be),ee)}function f(mt,ut,ee,Te,be,Fe,_e){return h(ut&ee|~ut&Te,mt,ut,be,Fe,_e)}function g(mt,ut,ee,Te,be,Fe,_e){return h(ut&Te|ee&~Te,mt,ut,be,Fe,_e)}function S(mt,ut,ee,Te,be,Fe,_e){return h(ut^ee^Te,mt,ut,be,Fe,_e)}function w(mt,ut,ee,Te,be,Fe,_e){return h(ee^(ut|~Te),mt,ut,be,Fe,_e)}const b=function(mt){let ut;const ee=1+(mt.length+8>>6),Te=new Array(16*ee);for(ut=0;ut<16*ee;ut++)Te[ut]=0;for(ut=0;ut<mt.length;ut++)Te[ut>>2]|=mt.charCodeAt(ut)<<ut%4*8;return Te[ut>>2]|=128<<ut%4*8,Te[16*ee-2]=8*mt.length,Te}(a);let I,U,F,V,Z,$=1732584193,W=-271733879,Y=-1732584194,nt=271733878;for(I=0;I<b.length;I+=16)U=$,F=W,V=Y,Z=nt,$=f($,W,Y,nt,b[I+0],7,-680876936),nt=f(nt,$,W,Y,b[I+1],12,-389564586),Y=f(Y,nt,$,W,b[I+2],17,606105819),W=f(W,Y,nt,$,b[I+3],22,-1044525330),$=f($,W,Y,nt,b[I+4],7,-176418897),nt=f(nt,$,W,Y,b[I+5],12,1200080426),Y=f(Y,nt,$,W,b[I+6],17,-1473231341),W=f(W,Y,nt,$,b[I+7],22,-45705983),$=f($,W,Y,nt,b[I+8],7,1770035416),nt=f(nt,$,W,Y,b[I+9],12,-1958414417),Y=f(Y,nt,$,W,b[I+10],17,-42063),W=f(W,Y,nt,$,b[I+11],22,-1990404162),$=f($,W,Y,nt,b[I+12],7,1804603682),nt=f(nt,$,W,Y,b[I+13],12,-40341101),Y=f(Y,nt,$,W,b[I+14],17,-1502002290),W=f(W,Y,nt,$,b[I+15],22,1236535329),$=g($,W,Y,nt,b[I+1],5,-165796510),nt=g(nt,$,W,Y,b[I+6],9,-1069501632),Y=g(Y,nt,$,W,b[I+11],14,643717713),W=g(W,Y,nt,$,b[I+0],20,-373897302),$=g($,W,Y,nt,b[I+5],5,-701558691),nt=g(nt,$,W,Y,b[I+10],9,38016083),Y=g(Y,nt,$,W,b[I+15],14,-660478335),W=g(W,Y,nt,$,b[I+4],20,-405537848),$=g($,W,Y,nt,b[I+9],5,568446438),nt=g(nt,$,W,Y,b[I+14],9,-1019803690),Y=g(Y,nt,$,W,b[I+3],14,-187363961),W=g(W,Y,nt,$,b[I+8],20,1163531501),$=g($,W,Y,nt,b[I+13],5,-1444681467),nt=g(nt,$,W,Y,b[I+2],9,-51403784),Y=g(Y,nt,$,W,b[I+7],14,1735328473),W=g(W,Y,nt,$,b[I+12],20,-1926607734),$=S($,W,Y,nt,b[I+5],4,-378558),nt=S(nt,$,W,Y,b[I+8],11,-2022574463),Y=S(Y,nt,$,W,b[I+11],16,1839030562),W=S(W,Y,nt,$,b[I+14],23,-35309556),$=S($,W,Y,nt,b[I+1],4,-1530992060),nt=S(nt,$,W,Y,b[I+4],11,1272893353),Y=S(Y,nt,$,W,b[I+7],16,-155497632),W=S(W,Y,nt,$,b[I+10],23,-1094730640),$=S($,W,Y,nt,b[I+13],4,681279174),nt=S(nt,$,W,Y,b[I+0],11,-358537222),Y=S(Y,nt,$,W,b[I+3],16,-722521979),W=S(W,Y,nt,$,b[I+6],23,76029189),$=S($,W,Y,nt,b[I+9],4,-640364487),nt=S(nt,$,W,Y,b[I+12],11,-421815835),Y=S(Y,nt,$,W,b[I+15],16,530742520),W=S(W,Y,nt,$,b[I+2],23,-995338651),$=w($,W,Y,nt,b[I+0],6,-198630844),nt=w(nt,$,W,Y,b[I+7],10,1126891415),Y=w(Y,nt,$,W,b[I+14],15,-1416354905),W=w(W,Y,nt,$,b[I+5],21,-57434055),$=w($,W,Y,nt,b[I+12],6,1700485571),nt=w(nt,$,W,Y,b[I+3],10,-1894986606),Y=w(Y,nt,$,W,b[I+10],15,-1051523),W=w(W,Y,nt,$,b[I+1],21,-2054922799),$=w($,W,Y,nt,b[I+8],6,1873313359),nt=w(nt,$,W,Y,b[I+15],10,-30611744),Y=w(Y,nt,$,W,b[I+6],15,-1560198380),W=w(W,Y,nt,$,b[I+13],21,1309151649),$=w($,W,Y,nt,b[I+4],6,-145523070),nt=w(nt,$,W,Y,b[I+11],10,-1120210379),Y=w(Y,nt,$,W,b[I+2],15,718787259),W=w(W,Y,nt,$,b[I+9],21,-343485551),$=u($,U),W=u(W,F),Y=u(Y,V),nt=u(nt,Z);return l($)+l(W)+l(Y)+l(nt)}(""+t+e)).slice(0,16),s=i.slice(0,12),r=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},r,n))},Bw=async(n,t,e)=>await n3(n.buffer,t,e);function jw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Gs(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?jw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):jw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class he extends Ei{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==wi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,e,i,s,r,a){if(super(t,r),m(this,"trackMediaType","video"),m(this,"_player",void 0),m(this,"_videoVisibleTimer",null),m(this,"_previousVideoVisibleStatus",void 0),m(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),m(this,"_encoderConfig",void 0),m(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),m(this,"_optimizationMode",void 0),m(this,"_videoHeight",void 0),m(this,"_videoWidth",void 0),m(this,"_forceBitrateLimit",void 0),m(this,"_enabled",!0),m(this,"processorDestination",void 0),m(this,"_processorContext",void 0),Vi()){const{width:c,height:l}=t.getSettings();this._videoWidth=c,this._videoHeight=l}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=e,this._scalabilityMode=i,this._optimizationMode=s,this._hints=a||[],this._hints.indexOf(Qe.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(c,l,u){const h=Pe();return!(h.name!==c||!h.osVersion)&&(u?Number(h.version)>=l&&Number(h.version)<=u:Number(h.version)===l)}(ke.CHROME,115)&&yf().indexOf("Windows")!==-1){const c=function(l,u){if("VideoFrame"in window&&"TransformStream"in window&&Ye().supportWebRTCInsertableStream){const h=new MediaStreamTrackProcessor(l),f=new MediaStreamTrackGenerator({kind:"video"});let g,S,w=Date.now();const b=()=>{I&&(clearInterval(I),I=void 0),g&&(g.close(),g=void 0),l.stop(),S=void 0,f.removeEventListener("ended",b)};let I=window.setInterval(()=>{if(S&&g&&Date.now()-w>(u??1e3))try{f.readyState==="live"?S.enqueue(g.clone()):b()}catch{b()}},u??1e3);const U=new TransformStream({transform:(F,V)=>{f.readyState==="live"?(S=V,w=Date.now(),g===void 0?(g=F,V.enqueue(F.clone())):(V.enqueue(g),g=F)):F.close()}});return f.addEventListener("ended",b),h.readable.pipeThrough(U).pipeTo(f.writable),f}}(t);c&&(v.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}e&&this._hints.indexOf(Qe.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(e),this.processorContext=new Nw(this.getTrackId(),"local"),this.processorDestination=new Ow(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const i=Gs(Gs(Gs({},this._getDefaultPlayerConfig()),e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new pS(i):this._player=new Vw(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(xa.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},x("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await qe(this,yt.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return e||(this._enabled=!1),void v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await qe(this,yt.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),e||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await qe(this,yt.NEED_MUTE_TRACK,this):await qe(this,yt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,e){if(!this._enabled)throw new Q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=$o(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=t_({encoderConfig:t});(Vi()||Fi()||po())&&(i.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const r=new Q(O.UNEXPECTED_ERROR,s.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),r.toString()),r}}this._encoderConfig=t,this._hints.indexOf(Qe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await qe(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(v)}}getStats(){return ju(()=>{v.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),_s(this,yt.GET_STATS)||Gs({},nS)}async setBeautyEffect(t){v.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,e):await hS(t)}async setBitrateLimit(t){if(v.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await qe(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(v)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void v.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const e=this._optimizationMode;try{this._optimizationMode=t,await qe(this,yt.SET_OPTIMIZATION_MODE,this)}catch(i){throw this._optimizationMode=e,v.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return v.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,v.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){Fw(this._originMediaStreamTrack).then(t=>{let[e,i]=t;this._videoHeight=i,this._videoWidth=e}).catch(wf)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:e,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!e||!i)return;const[s,r]=function(a,c,l,u){let h;const f=200*Math.pow(l/15,.6)*Math.pow(a*c/640/360,.75),g=f;if(u==="STANDARD_BITRATE")h=4*f;else{if(u!=="COMPATIABLE_BITRATE")return;h=2*f}return[Math.floor(h),Math.floor(g)]}(t,e,i,x("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=r,this._encoderConfig.bitrateMax=s,v.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(e,", fps: ").concat(i,"] => [brMax: ").concat(s,", brMin: ").concat(r,"]")))}getVideoElementVisibleStatus(){try{var t,e;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:r,slot:a}=s;if(this.isPlaying&&r instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=wI.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(i){throw new Q(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Gs(Gs({},i),$o(t))),i=Mc(i);const s=Ge(8,"track-video-cloned-"),r=new he(e?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Mc(this._scalabilityMode),this._optimizationMode,s,Mc(this._hints));return t&&i&&r.setEncoderConfiguration(i),v.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(e)),r}async replaceTrack(t,e){if(!(t instanceof MediaStreamTrack))throw new Q(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Q(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,e,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(Ai.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await qe(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await qe(this,yt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ai.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ds.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ds.REQUEST_CONSTRAINTS)}}et([Ht({argsMap:(n,t,e)=>[n.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",e]}),Tn(),A("design:type",Function),A("design:paramtypes",[Object,Object]),A("design:returntype",void 0)],he.prototype,"play",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],he.prototype,"stop",null),et([zd("LocalVideoTrack","_enabledMutex"),Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[Boolean,Boolean]),A("design:returntype",K)],he.prototype,"setEnabled",null),et([zd("LocalVideoTrack","_enabledMutex"),Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",K)],he.prototype,"setMuted",null),et([Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",K)],he.prototype,"setEncoderConfiguration",null),et([Tn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Object)],he.prototype,"getStats",null),et([Ht({argsMap:(n,t,e)=>[n.getTrackId(),t,e]}),Tn(),A("design:type",Function),A("design:paramtypes",[Boolean,Object]),A("design:returntype",K)],he.prototype,"setBeautyEffect",null),et([Tn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",ImageData)],he.prototype,"getCurrentFrameData",null),et([Tn(),A("design:type",Function),A("design:paramtypes",[String,Number]),A("design:returntype",K)],he.prototype,"getCurrentFrameImage",null),et([Tn(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],he.prototype,"setBitrateLimit",null),et([Tn(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],he.prototype,"setOptimizationMode",null),et([Tn(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],he.prototype,"setScalabiltyMode",null),et([Tn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],he.prototype,"updateMediaStreamTrackResolution",null),et([Ht({argsMap:(n,t)=>[n.getTrackId(),t.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],he.prototype,"pipe",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],he.prototype,"unpipe",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],he.prototype,"close",null),et([Ht({argsMap:(n,t,e)=>[n.getTrackId(),t.label,e]}),A("design:type",Function),A("design:paramtypes",[MediaStreamTrack,Boolean]),A("design:returntype",K)],he.prototype,"replaceTrack",null);class Ba extends he{get __className__(){return"CameraVideoTrack"}constructor(t,e,i,s,r,a){super(t,$o(e.encoderConfig),s,r,a),m(this,"_config",void 0),m(this,"_originalConstraints",void 0),m(this,"_constraints",void 0),m(this,"_enabled",!0),m(this,"_deviceName","default"),m(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Hd()||uT())&&!function(){const c=Pe();if(c.os!==Qn.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2}()&&CI()&&this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=e,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=$o(this._config.encoderConfig),Ve.on(ei.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ve.on(ei.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(v.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const e=await Bs.getDeviceById(t),i={};i.video=Gs({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await Fs(i,this.getTrackId())}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),s=await Fs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=e.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await Bs.getDeviceById(t);this._deviceName=e.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}v.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){v.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const e={video:Gs(Gs({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Fs(e,this.getTrackId())}catch(s){throw v.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),i=await Fs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Gs({},e.video),v.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Fs({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await qe(this,yt.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),e||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),e||(this._enabled=!1);try{await qe(this,yt.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,e){if(!this._enabled)throw new Q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=$o(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin);const i=Nn(this._config);i.encoderConfig=t;const s=t_(i);(Vi()||Fi()||po())&&(s.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(r){const a=new Q(O.UNEXPECTED_ERROR,r.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=i,this._constraints=s,this._originalConstraints=s,this._encoderConfig=t,this._hints.indexOf(Qe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await qe(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(v)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Fi()||po())&&this._enabled&&!this._isClosed&&Ve.duringInterruption){const t=async()=>{Ve.off(ei.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ve.on(ei.IOS_INTERRUPTION_END,t)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(xa.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,i=Bs.searchDeviceIdByName(this._deviceName);if(i&&!e.deviceId&&(e.deviceId={exact:i}),this._enabled){const s=await Fs({video:e},this.getTrackId());this._constraints=e,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Ve.off(ei.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ve.off(ei.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Gs(Gs({},i),$o(t))),i=Mc(i);const s=Ge(8,"track-cam-cloned-"),r=new Ba(e?this._mediaStreamTrack.clone():this._mediaStreamTrack,Mc(Gs(Gs({},this._config),{},{encoderConfig:i})),Mc(this._constraints),Mc(this._scalabilityMode),this._optimizationMode,s);return t&&i&&r.setEncoderConfiguration(i),v.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(e)),r}bindProcessorContextEvents(){this.processorContext.on(ds.REQUEST_UPDATE_CONSTRAINTS,async(t,e,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),e()}catch(s){i(s)}}),this.processorContext.on(ds.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}}function Gw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function e_(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Gw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Gw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function fS(n,t,e,i){e.optimizationMode&&(i&&i.width&&i.height?(e.encoderConfig=e_(e_({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),e.optimizationMode!=="motion"&&e.optimizationMode!=="detail"||(t.contentHint=e.optimizationMode,t.contentHint===e.optimizationMode?v.debug("[".concat(n,"] set content hint to"),e.optimizationMode):v.debug("[".concat(n,"] set content hint failed")))):v.warning("[".concat(n,"] can not apply optimization mode bitrate config, no encoderConfig")))}function Ww(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function n_(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Ww(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Ww(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}et([Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],Ba.prototype,"setDevice",null),et([zd("CameraVideoTrack","_enabledMutex"),Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[Boolean,Boolean]),A("design:returntype",K)],Ba.prototype,"setEnabled",null),et([Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),Tn(),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",K)],Ba.prototype,"setEncoderConfiguration",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ba.prototype,"close",null);class Hw extends pw{getUserId(){return this._userId}constructor(t,e,i,s){super(t,"track-".concat(t.kind,"-").concat(e,"-").concat(s.clientId,"_").concat(Ge(5,""))),m(this,"_userId",void 0),m(this,"_uintId",void 0),m(this,"_isDestroyed",!1),m(this,"store",void 0),m(this,"processor",void 0),this._userId=e,this._uintId=i,this.store=s}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,v.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class go extends Hw{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==wi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,i,s){super(t,e,i,s),m(this,"_videoVisibleTimer",null),m(this,"_previousVideoVisibleStatus",void 0),m(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),m(this,"trackMediaType","video"),m(this,"_videoWidth",void 0),m(this,"_videoHeight",void 0),m(this,"_player",void 0),m(this,"processorDestination",void 0),m(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Nw(this.getTrackId(),"remote"),this.processorDestination=new Ow(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return ju(()=>{v.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),_s(this,yt.GET_STATS)||n_({},hw)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const i=n_(n_({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new pS(i):this._player=new Vw(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(jc.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(jc.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},x("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Fw(this._originMediaStreamTrack).then(t=>{let[e,i]=t;this._videoHeight=i,this._videoWidth=e}).catch(wf)}_updatePlayerSource(){v.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:r,slot:a}=s;if(this.isPlaying&&r instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=wI.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(i){throw new Q(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ai.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ai.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}et([Ht({argsMap:(n,t,e)=>[n.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",e]}),A("design:type",Function),A("design:paramtypes",[Object,Object]),A("design:returntype",void 0)],go.prototype,"play",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],go.prototype,"stop",null),et([Ht({argsMap:(n,t)=>[n.getTrackId(),t.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],go.prototype,"pipe",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],go.prototype,"unpipe",null);class Rr extends Hw{get isPlaying(){return this._useAudioElement?Es.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,i,s){super(t,e,i,s),m(this,"trackMediaType","audio"),m(this,"_source",void 0),m(this,"_useAudioElement",!0),m(this,"_volume",100),m(this,"processorContext",void 0),m(this,"processorDestination",void 0),m(this,"_played",!1),m(this,"_bypassWebAudio",!1),x("DISABLE_WEBAUDIO")?(this._source=new dS,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new oS(t,!0),x("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(cs.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(jc.FIRST_FRAME_DECODED)}),this.processorContext=new Zf(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Qf(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(cs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(cs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(cs.ON_AUDIO_BUFFER),this._source.on(cs.ON_AUDIO_BUFFER,i=>t(i))}setVolume(t){this._volume=t,this._useAudioElement?Es.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement)throw new Q(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Es.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ju(()=>{v.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),_s(this,yt.GET_STATS)||n_({},uw)}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] use audio element to play")),Es.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Es.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Es.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ai.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ai.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ai.ON_TRACK),this.processorDestination.removeAllListeners(Ai.ON_NODE)}}et([Ht({argsMap:(n,t)=>[n.getTrackId(),t],throttleTime:300}),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Rr.prototype,"setVolume",null),et([Ht({argsMap:(n,t)=>[n.getTrackId(),t]}),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Rr.prototype,"setPlaybackDevice",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Rr.prototype,"play",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Rr.prototype,"stop",null),et([Ht({argsMap:(n,t)=>[n.getTrackId(),t.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],Rr.prototype,"pipe",null),et([Ht({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Rr.prototype,"unpipe",null);function dl(n){let t=n.length;for(;--t>=0;)n[t]=0}const _S=256,Kw=286,zu=30,Ju=15,mS=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),i_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),i3=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),qw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ta=new Array(576);dl(ta);const Xu=new Array(60);dl(Xu);const $u=new Array(512);dl($u);const Qu=new Array(256);dl(Qu);const ES=new Array(29);dl(ES);const s_=new Array(zu);function gS(n,t,e,i,s){this.static_tree=n,this.extra_bits=t,this.extra_base=e,this.elems=i,this.max_length=s,this.has_stree=n&&n.length}let Yw,zw,Jw;function TS(n,t){this.dyn_tree=n,this.max_code=0,this.stat_desc=t}dl(s_);const Xw=n=>n<256?$u[n]:$u[256+(n>>>7)],Zu=(n,t)=>{n.pending_buf[n.pending++]=255&t,n.pending_buf[n.pending++]=t>>>8&255},Ws=(n,t,e)=>{n.bi_valid>16-e?(n.bi_buf|=t<<n.bi_valid&65535,Zu(n,n.bi_buf),n.bi_buf=t>>16-n.bi_valid,n.bi_valid+=e-16):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=e)},To=(n,t,e)=>{Ws(n,e[2*t],e[2*t+1])},$w=(n,t)=>{let e=0;do e|=1&n,n>>>=1,e<<=1;while(--t>0);return e>>>1},Qw=(n,t,e)=>{const i=new Array(16);let s,r,a=0;for(s=1;s<=Ju;s++)a=a+e[s-1]<<1,i[s]=a;for(r=0;r<=t;r++){let c=n[2*r+1];c!==0&&(n[2*r]=$w(i[c]++,c))}},Zw=n=>{let t;for(t=0;t<Kw;t++)n.dyn_ltree[2*t]=0;for(t=0;t<zu;t++)n.dyn_dtree[2*t]=0;for(t=0;t<19;t++)n.bl_tree[2*t]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},t0=n=>{n.bi_valid>8?Zu(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},e0=(n,t,e,i)=>{const s=2*t,r=2*e;return n[s]<n[r]||n[s]===n[r]&&i[t]<=i[e]},SS=(n,t,e)=>{const i=n.heap[e];let s=e<<1;for(;s<=n.heap_len&&(s<n.heap_len&&e0(t,n.heap[s+1],n.heap[s],n.depth)&&s++,!e0(t,i,n.heap[s],n.depth));)n.heap[e]=n.heap[s],e=s,s<<=1;n.heap[e]=i},n0=(n,t,e)=>{let i,s,r,a,c=0;if(n.sym_next!==0)do i=255&n.pending_buf[n.sym_buf+c++],i+=(255&n.pending_buf[n.sym_buf+c++])<<8,s=n.pending_buf[n.sym_buf+c++],i===0?To(n,s,t):(r=Qu[s],To(n,r+_S+1,t),a=mS[r],a!==0&&(s-=ES[r],Ws(n,s,a)),i--,r=Xw(i),To(n,r,e),a=i_[r],a!==0&&(i-=s_[r],Ws(n,i,a)));while(c<n.sym_next);To(n,256,t)},vS=(n,t)=>{const e=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let a,c,l,u=-1;for(n.heap_len=0,n.heap_max=573,a=0;a<r;a++)e[2*a]!==0?(n.heap[++n.heap_len]=u=a,n.depth[a]=0):e[2*a+1]=0;for(;n.heap_len<2;)l=n.heap[++n.heap_len]=u<2?++u:0,e[2*l]=1,n.depth[l]=0,n.opt_len--,s&&(n.static_len-=i[2*l+1]);for(t.max_code=u,a=n.heap_len>>1;a>=1;a--)SS(n,e,a);l=r;do a=n.heap[1],n.heap[1]=n.heap[n.heap_len--],SS(n,e,1),c=n.heap[1],n.heap[--n.heap_max]=a,n.heap[--n.heap_max]=c,e[2*l]=e[2*a]+e[2*c],n.depth[l]=(n.depth[a]>=n.depth[c]?n.depth[a]:n.depth[c])+1,e[2*a+1]=e[2*c+1]=l,n.heap[1]=l++,SS(n,e,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((h,f)=>{const g=f.dyn_tree,S=f.max_code,w=f.stat_desc.static_tree,b=f.stat_desc.has_stree,I=f.stat_desc.extra_bits,U=f.stat_desc.extra_base,F=f.stat_desc.max_length;let V,Z,$,W,Y,nt,mt=0;for(W=0;W<=Ju;W++)h.bl_count[W]=0;for(g[2*h.heap[h.heap_max]+1]=0,V=h.heap_max+1;V<573;V++)Z=h.heap[V],W=g[2*g[2*Z+1]+1]+1,W>F&&(W=F,mt++),g[2*Z+1]=W,Z>S||(h.bl_count[W]++,Y=0,Z>=U&&(Y=I[Z-U]),nt=g[2*Z],h.opt_len+=nt*(W+Y),b&&(h.static_len+=nt*(w[2*Z+1]+Y)));if(mt!==0){do{for(W=F-1;h.bl_count[W]===0;)W--;h.bl_count[W]--,h.bl_count[W+1]+=2,h.bl_count[F]--,mt-=2}while(mt>0);for(W=F;W!==0;W--)for(Z=h.bl_count[W];Z!==0;)$=h.heap[--V],$>S||(g[2*$+1]!==W&&(h.opt_len+=(W-g[2*$+1])*g[2*$],g[2*$+1]=W),Z--)}})(n,t),Qw(e,u,n.bl_count)},i0=(n,t,e)=>{let i,s,r=-1,a=t[1],c=0,l=7,u=4;for(a===0&&(l=138,u=3),t[2*(e+1)+1]=65535,i=0;i<=e;i++)s=a,a=t[2*(i+1)+1],++c<l&&s===a||(c<u?n.bl_tree[2*s]+=c:s!==0?(s!==r&&n.bl_tree[2*s]++,n.bl_tree[32]++):c<=10?n.bl_tree[34]++:n.bl_tree[36]++,c=0,r=s,a===0?(l=138,u=3):s===a?(l=6,u=3):(l=7,u=4))},s0=(n,t,e)=>{let i,s,r=-1,a=t[1],c=0,l=7,u=4;for(a===0&&(l=138,u=3),i=0;i<=e;i++)if(s=a,a=t[2*(i+1)+1],!(++c<l&&s===a)){if(c<u)do To(n,s,n.bl_tree);while(--c!=0);else s!==0?(s!==r&&(To(n,s,n.bl_tree),c--),To(n,16,n.bl_tree),Ws(n,c-3,2)):c<=10?(To(n,17,n.bl_tree),Ws(n,c-3,3)):(To(n,18,n.bl_tree),Ws(n,c-11,7));c=0,r=s,a===0?(l=138,u=3):s===a?(l=6,u=3):(l=7,u=4)}};let r0=!1;const o0=(n,t,e,i)=>{Ws(n,0+(i?1:0),3),t0(n),Zu(n,e),Zu(n,~e),e&&n.pending_buf.set(n.window.subarray(t,t+e),n.pending),n.pending+=e};var s3=n=>{r0||((()=>{let t,e,i,s,r;const a=new Array(16);for(i=0,s=0;s<28;s++)for(ES[s]=i,t=0;t<1<<mS[s];t++)Qu[i++]=s;for(Qu[i-1]=s,r=0,s=0;s<16;s++)for(s_[s]=r,t=0;t<1<<i_[s];t++)$u[r++]=s;for(r>>=7;s<zu;s++)for(s_[s]=r<<7,t=0;t<1<<i_[s]-7;t++)$u[256+r++]=s;for(e=0;e<=Ju;e++)a[e]=0;for(t=0;t<=143;)ta[2*t+1]=8,t++,a[8]++;for(;t<=255;)ta[2*t+1]=9,t++,a[9]++;for(;t<=279;)ta[2*t+1]=7,t++,a[7]++;for(;t<=287;)ta[2*t+1]=8,t++,a[8]++;for(Qw(ta,287,a),t=0;t<zu;t++)Xu[2*t+1]=5,Xu[2*t]=$w(t,5);Yw=new gS(ta,mS,257,Kw,Ju),zw=new gS(Xu,i_,0,zu,Ju),Jw=new gS(new Array(0),i3,0,19,7)})(),r0=!0),n.l_desc=new TS(n.dyn_ltree,Yw),n.d_desc=new TS(n.dyn_dtree,zw),n.bl_desc=new TS(n.bl_tree,Jw),n.bi_buf=0,n.bi_valid=0,Zw(n)},r3=(n,t,e,i)=>{let s,r,a=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(c=>{let l,u=4093624447;for(l=0;l<=31;l++,u>>>=1)if(1&u&&c.dyn_ltree[2*l]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(l=32;l<_S;l++)if(c.dyn_ltree[2*l]!==0)return 1;return 0})(n)),vS(n,n.l_desc),vS(n,n.d_desc),a=(c=>{let l;for(i0(c,c.dyn_ltree,c.l_desc.max_code),i0(c,c.dyn_dtree,c.d_desc.max_code),vS(c,c.bl_desc),l=18;l>=3&&c.bl_tree[2*qw[l]+1]===0;l--);return c.opt_len+=3*(l+1)+5+5+4,l})(n),s=n.opt_len+3+7>>>3,r=n.static_len+3+7>>>3,r<=s&&(s=r)):s=r=e+5,e+4<=s&&t!==-1?o0(n,t,e,i):n.strategy===4||r===s?(Ws(n,2+(i?1:0),3),n0(n,ta,Xu)):(Ws(n,4+(i?1:0),3),((c,l,u,h)=>{let f;for(Ws(c,l-257,5),Ws(c,u-1,5),Ws(c,h-4,4),f=0;f<h;f++)Ws(c,c.bl_tree[2*qw[f]+1],3);s0(c,c.dyn_ltree,l-1),s0(c,c.dyn_dtree,u-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,a+1),n0(n,n.dyn_ltree,n.dyn_dtree)),Zw(n),i&&t0(n)},o3=(n,t,e)=>(n.pending_buf[n.sym_buf+n.sym_next++]=t,n.pending_buf[n.sym_buf+n.sym_next++]=t>>8,n.pending_buf[n.sym_buf+n.sym_next++]=e,t===0?n.dyn_ltree[2*e]++:(n.matches++,t--,n.dyn_ltree[2*(Qu[e]+_S+1)]++,n.dyn_dtree[2*Xw(t)]++),n.sym_next===n.sym_end),a3={_tr_init:s3,_tr_stored_block:o0,_tr_flush_block:r3,_tr_tally:o3,_tr_align:n=>{Ws(n,2,3),To(n,256,ta),(t=>{t.bi_valid===16?(Zu(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(n)}},th=(n,t,e,i)=>{let s=65535&n|0,r=n>>>16&65535|0,a=0;for(;e!==0;){a=e>2e3?2e3:e,e-=a;do s=s+t[i++]|0,r=r+s|0;while(--a);s%=65521,r%=65521}return s|r<<16|0};const c3=new Uint32Array((()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var i=0;i<8;i++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t})());var Wi=(n,t,e,i)=>{const s=c3,r=i+e;n^=-1;for(let a=i;a<r;a++)n=n>>>8^s[255&(n^t[a])];return-1^n},Hc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ll={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:d3,_tr_stored_block:yS,_tr_flush_block:l3,_tr_tally:ja,_tr_align:u3}=a3,{Z_NO_FLUSH:Ga,Z_PARTIAL_FLUSH:h3,Z_FULL_FLUSH:p3,Z_FINISH:br,Z_BLOCK:a0,Z_OK:$i,Z_STREAM_END:c0,Z_STREAM_ERROR:So,Z_DATA_ERROR:f3,Z_BUF_ERROR:CS,Z_DEFAULT_COMPRESSION:_3,Z_FILTERED:m3,Z_HUFFMAN_ONLY:r_,Z_RLE:E3,Z_FIXED:g3,Z_DEFAULT_STRATEGY:T3,Z_UNKNOWN:S3,Z_DEFLATED:o_}=ll,RS=286,v3=30,y3=19,C3=2*RS+1,R3=15,Kc=258,vo=262,ul=42,qc=113,eh=666,Yc=(n,t)=>(n.msg=Hc[t],t),d0=n=>2*n-(n>4?9:0),Wa=n=>{let t=n.length;for(;--t>=0;)n[t]=0},b3=n=>{let t,e,i,s=n.w_size;t=n.hash_size,i=t;do e=n.head[--i],n.head[i]=e>=s?e-s:0;while(--t);t=s,i=t;do e=n.prev[--i],n.prev[i]=e>=s?e-s:0;while(--t)};let Ha=(n,t,e)=>(t<<n.hash_shift^e)&n.hash_mask;const nr=n=>{const t=n.state;let e=t.pending;e>n.avail_out&&(e=n.avail_out),e!==0&&(n.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),n.next_out),n.next_out+=e,t.pending_out+=e,n.total_out+=e,n.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},ir=(n,t)=>{l3(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,nr(n.strm)},mn=(n,t)=>{n.pending_buf[n.pending++]=t},nh=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=255&t},bS=(n,t,e,i)=>{let s=n.avail_in;return s>i&&(s=i),s===0?0:(n.avail_in-=s,t.set(n.input.subarray(n.next_in,n.next_in+s),e),n.state.wrap===1?n.adler=th(n.adler,t,s,e):n.state.wrap===2&&(n.adler=Wi(n.adler,t,s,e)),n.next_in+=s,n.total_in+=s,s)},l0=(n,t)=>{let e,i,s=n.max_chain_length,r=n.strstart,a=n.prev_length,c=n.nice_match;const l=n.strstart>n.w_size-vo?n.strstart-(n.w_size-vo):0,u=n.window,h=n.w_mask,f=n.prev,g=n.strstart+Kc;let S=u[r+a-1],w=u[r+a];n.prev_length>=n.good_match&&(s>>=2),c>n.lookahead&&(c=n.lookahead);do if(e=t,u[e+a]===w&&u[e+a-1]===S&&u[e]===u[r]&&u[++e]===u[r+1]){r+=2,e++;do;while(u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&r<g);if(i=Kc-(g-r),r=g-Kc,i>a){if(n.match_start=t,a=i,i>=c)break;S=u[r+a-1],w=u[r+a]}}while((t=f[t&h])>l&&--s!=0);return a<=n.lookahead?a:n.lookahead},hl=n=>{const t=n.w_size;let e,i,s;do{if(i=n.window_size-n.lookahead-n.strstart,n.strstart>=t+(t-vo)&&(n.window.set(n.window.subarray(t,t+t-i),0),n.match_start-=t,n.strstart-=t,n.block_start-=t,n.insert>n.strstart&&(n.insert=n.strstart),b3(n),i+=t),n.strm.avail_in===0)break;if(e=bS(n.strm,n.window,n.strstart+n.lookahead,i),n.lookahead+=e,n.lookahead+n.insert>=3)for(s=n.strstart-n.insert,n.ins_h=n.window[s],n.ins_h=Ha(n,n.ins_h,n.window[s+1]);n.insert&&(n.ins_h=Ha(n,n.ins_h,n.window[s+3-1]),n.prev[s&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=s,s++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<vo&&n.strm.avail_in!==0)},u0=(n,t)=>{let e,i,s,r=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,a=0,c=n.strm.avail_in;do{if(e=65535,s=n.bi_valid+42>>3,n.strm.avail_out<s||(s=n.strm.avail_out-s,i=n.strstart-n.block_start,e>i+n.strm.avail_in&&(e=i+n.strm.avail_in),e>s&&(e=s),e<r&&(e===0&&t!==br||t===Ga||e!==i+n.strm.avail_in)))break;a=t===br&&e===i+n.strm.avail_in?1:0,yS(n,0,0,a),n.pending_buf[n.pending-4]=e,n.pending_buf[n.pending-3]=e>>8,n.pending_buf[n.pending-2]=~e,n.pending_buf[n.pending-1]=~e>>8,nr(n.strm),i&&(i>e&&(i=e),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+i),n.strm.next_out),n.strm.next_out+=i,n.strm.avail_out-=i,n.strm.total_out+=i,n.block_start+=i,e-=i),e&&(bS(n.strm,n.strm.output,n.strm.next_out,e),n.strm.next_out+=e,n.strm.avail_out-=e,n.strm.total_out+=e)}while(a===0);return c-=n.strm.avail_in,c&&(c>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=c&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-c,n.strm.next_in),n.strstart),n.strstart+=c,n.insert+=c>n.w_size-n.insert?n.w_size-n.insert:c),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),a?4:t!==Ga&&t!==br&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(s=n.window_size-n.strstart,n.strm.avail_in>s&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,s+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),s>n.strm.avail_in&&(s=n.strm.avail_in),s&&(bS(n.strm,n.window,n.strstart,s),n.strstart+=s,n.insert+=s>n.w_size-n.insert?n.w_size-n.insert:s),n.high_water<n.strstart&&(n.high_water=n.strstart),s=n.bi_valid+42>>3,s=n.pending_buf_size-s>65535?65535:n.pending_buf_size-s,r=s>n.w_size?n.w_size:s,i=n.strstart-n.block_start,(i>=r||(i||t===br)&&t!==Ga&&n.strm.avail_in===0&&i<=s)&&(e=i>s?s:i,a=t===br&&n.strm.avail_in===0&&e===i?1:0,yS(n,n.block_start,e,a),n.block_start+=e,nr(n.strm)),a?3:1)},IS=(n,t)=>{let e,i;for(;;){if(n.lookahead<vo){if(hl(n),n.lookahead<vo&&t===Ga)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=Ha(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),e!==0&&n.strstart-e<=n.w_size-vo&&(n.match_length=l0(n,e)),n.match_length>=3)if(i=ja(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=Ha(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=Ha(n,n.ins_h,n.window[n.strstart+1]);else i=ja(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(i&&(ir(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,t===br?(ir(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(ir(n,!1),n.strm.avail_out===0)?1:2},pl=(n,t)=>{let e,i,s;for(;;){if(n.lookahead<vo){if(hl(n),n.lookahead<vo&&t===Ga)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=Ha(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,e!==0&&n.prev_length<n.max_lazy_match&&n.strstart-e<=n.w_size-vo&&(n.match_length=l0(n,e),n.match_length<=5&&(n.strategy===m3||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){s=n.strstart+n.lookahead-3,i=ja(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=s&&(n.ins_h=Ha(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,i&&(ir(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(i=ja(n,0,n.window[n.strstart-1]),i&&ir(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(i=ja(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,t===br?(ir(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(ir(n,!1),n.strm.avail_out===0)?1:2};function yo(n,t,e,i,s){this.good_length=n,this.max_lazy=t,this.nice_length=e,this.max_chain=i,this.func=s}const ih=[new yo(0,0,0,0,u0),new yo(4,4,8,4,IS),new yo(4,5,16,8,IS),new yo(4,6,32,32,IS),new yo(4,4,16,16,pl),new yo(8,16,32,32,pl),new yo(8,16,128,128,pl),new yo(8,32,128,256,pl),new yo(32,128,258,1024,pl),new yo(32,258,258,4096,pl)];function I3(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=o_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*C3),this.dyn_dtree=new Uint16Array(2*(2*v3+1)),this.bl_tree=new Uint16Array(2*(2*y3+1)),Wa(this.dyn_ltree),Wa(this.dyn_dtree),Wa(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(R3+1),this.heap=new Uint16Array(2*RS+1),Wa(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*RS+1),Wa(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const sh=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.status!==ul&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==qc&&t.status!==eh?1:0},h0=n=>{if(sh(n))return Yc(n,So);n.total_in=n.total_out=0,n.data_type=S3;const t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?ul:qc,n.adler=t.wrap===2?0:1,t.last_flush=-2,d3(t),$i},p0=n=>{const t=h0(n);var e;return t===$i&&((e=n.state).window_size=2*e.w_size,Wa(e.head),e.max_lazy_match=ih[e.level].max_lazy,e.good_match=ih[e.level].good_length,e.nice_match=ih[e.level].nice_length,e.max_chain_length=ih[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t},f0=(n,t,e,i,s,r)=>{if(!n)return So;let a=1;if(t===_3&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),s<1||s>9||e!==o_||i<8||i>15||t<0||t>9||r<0||r>g3||i===8&&a!==1)return Yc(n,So);i===8&&(i=9);const c=new I3;return n.state=c,c.strm=n,c.status=ul,c.wrap=a,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=t,c.strategy=r,c.method=e,p0(n)};var A3=(n,t)=>{if(sh(n)||t>a0||t<0)return n?Yc(n,So):So;const e=n.state;if(!n.output||n.avail_in!==0&&!n.input||e.status===eh&&t!==br)return Yc(n,n.avail_out===0?CS:So);const i=e.last_flush;if(e.last_flush=t,e.pending!==0){if(nr(n),n.avail_out===0)return e.last_flush=-1,$i}else if(n.avail_in===0&&d0(t)<=d0(i)&&t!==br)return Yc(n,CS);if(e.status===eh&&n.avail_in!==0)return Yc(n,CS);if(e.status===ul&&e.wrap===0&&(e.status=qc),e.status===ul){let s=o_+(e.w_bits-8<<4)<<8,r=-1;if(r=e.strategy>=r_||e.level<2?0:e.level<6?1:e.level===6?2:3,s|=r<<6,e.strstart!==0&&(s|=32),s+=31-s%31,nh(e,s),e.strstart!==0&&(nh(e,n.adler>>>16),nh(e,65535&n.adler)),n.adler=1,e.status=qc,nr(n),e.pending!==0)return e.last_flush=-1,$i}if(e.status===57){if(n.adler=0,mn(e,31),mn(e,139),mn(e,8),e.gzhead)mn(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),mn(e,255&e.gzhead.time),mn(e,e.gzhead.time>>8&255),mn(e,e.gzhead.time>>16&255),mn(e,e.gzhead.time>>24&255),mn(e,e.level===9?2:e.strategy>=r_||e.level<2?4:0),mn(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(mn(e,255&e.gzhead.extra.length),mn(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(n.adler=Wi(n.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69;else if(mn(e,0),mn(e,0),mn(e,0),mn(e,0),mn(e,0),mn(e,e.level===9?2:e.strategy>=r_||e.level<2?4:0),mn(e,3),e.status=qc,nr(n),e.pending!==0)return e.last_flush=-1,$i}if(e.status===69){if(e.gzhead.extra){let s=e.pending,r=(65535&e.gzhead.extra.length)-e.gzindex;for(;e.pending+r>e.pending_buf_size;){let c=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+c),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(n.adler=Wi(n.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=c,nr(n),e.pending!==0)return e.last_flush=-1,$i;s=0,r-=c}let a=new Uint8Array(e.gzhead.extra);e.pending_buf.set(a.subarray(e.gzindex,e.gzindex+r),e.pending),e.pending+=r,e.gzhead.hcrc&&e.pending>s&&(n.adler=Wi(n.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=73}if(e.status===73){if(e.gzhead.name){let s,r=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(n.adler=Wi(n.adler,e.pending_buf,e.pending-r,r)),nr(n),e.pending!==0)return e.last_flush=-1,$i;r=0}s=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,mn(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>r&&(n.adler=Wi(n.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=91}if(e.status===91){if(e.gzhead.comment){let s,r=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(n.adler=Wi(n.adler,e.pending_buf,e.pending-r,r)),nr(n),e.pending!==0)return e.last_flush=-1,$i;r=0}s=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,mn(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>r&&(n.adler=Wi(n.adler,e.pending_buf,e.pending-r,r))}e.status=103}if(e.status===103){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(nr(n),e.pending!==0))return e.last_flush=-1,$i;mn(e,255&n.adler),mn(e,n.adler>>8&255),n.adler=0}if(e.status=qc,nr(n),e.pending!==0)return e.last_flush=-1,$i}if(n.avail_in!==0||e.lookahead!==0||t!==Ga&&e.status!==eh){let s=e.level===0?u0(e,t):e.strategy===r_?((r,a)=>{let c;for(;;){if(r.lookahead===0&&(hl(r),r.lookahead===0)){if(a===Ga)return 1;break}if(r.match_length=0,c=ja(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,c&&(ir(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,a===br?(ir(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(ir(r,!1),r.strm.avail_out===0)?1:2})(e,t):e.strategy===E3?((r,a)=>{let c,l,u,h;const f=r.window;for(;;){if(r.lookahead<=Kc){if(hl(r),r.lookahead<=Kc&&a===Ga)return 1;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=3&&r.strstart>0&&(u=r.strstart-1,l=f[u],l===f[++u]&&l===f[++u]&&l===f[++u])){h=r.strstart+Kc;do;while(l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&u<h);r.match_length=Kc-(h-u),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=3?(c=ja(r,1,r.match_length-3),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(c=ja(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),c&&(ir(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,a===br?(ir(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(ir(r,!1),r.strm.avail_out===0)?1:2})(e,t):ih[e.level].func(e,t);if(s!==3&&s!==4||(e.status=eh),s===1||s===3)return n.avail_out===0&&(e.last_flush=-1),$i;if(s===2&&(t===h3?u3(e):t!==a0&&(yS(e,0,0,!1),t===p3&&(Wa(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),nr(n),n.avail_out===0))return e.last_flush=-1,$i}return t!==br?$i:e.wrap<=0?c0:(e.wrap===2?(mn(e,255&n.adler),mn(e,n.adler>>8&255),mn(e,n.adler>>16&255),mn(e,n.adler>>24&255),mn(e,255&n.total_in),mn(e,n.total_in>>8&255),mn(e,n.total_in>>16&255),mn(e,n.total_in>>24&255)):(nh(e,n.adler>>>16),nh(e,65535&n.adler)),nr(n),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?$i:c0)},w3=(n,t)=>{let e=t.length;if(sh(n))return So;const i=n.state,s=i.wrap;if(s===2||s===1&&i.status!==ul||i.lookahead)return So;if(s===1&&(n.adler=th(n.adler,t,e,0)),i.wrap=0,e>=i.w_size){s===0&&(Wa(i.head),i.strstart=0,i.block_start=0,i.insert=0);let l=new Uint8Array(i.w_size);l.set(t.subarray(e-i.w_size,e),0),t=l,e=i.w_size}const r=n.avail_in,a=n.next_in,c=n.input;for(n.avail_in=e,n.next_in=0,n.input=t,hl(i);i.lookahead>=3;){let l=i.strstart,u=i.lookahead-2;do i.ins_h=Ha(i,i.ins_h,i.window[l+3-1]),i.prev[l&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=l,l++;while(--u);i.strstart=l,i.lookahead=2,hl(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,n.next_in=a,n.input=c,n.avail_in=r,i.wrap=s,$i},rh={deflateInit:(n,t)=>f0(n,t,o_,15,8,T3),deflateInit2:f0,deflateReset:p0,deflateResetKeep:h0,deflateSetHeader:(n,t)=>sh(n)||n.state.wrap!==2?So:(n.state.gzhead=t,$i),deflate:A3,deflateEnd:n=>{if(sh(n))return So;const t=n.state.status;return n.state=null,t===qc?Yc(n,f3):$i},deflateSetDictionary:w3,deflateInfo:"pako deflate (from Nodeca project)"};const O3=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var a_={assign:function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const i in e)O3(e,i)&&(n[i]=e[i])}}return n},flattenChunks:n=>{let t=0;for(let i=0,s=n.length;i<s;i++)t+=n[i].length;const e=new Uint8Array(t);for(let i=0,s=0,r=n.length;i<r;i++){let a=n[i];e.set(a,s),s+=a.length}return e}};let _0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{_0=!1}const oh=new Uint8Array(256);for(let n=0;n<256;n++)oh[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;oh[254]=oh[254]=1;var ah={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,i,s,r,a=n.length,c=0;for(s=0;s<a;s++)e=n.charCodeAt(s),(64512&e)==55296&&s+1<a&&(i=n.charCodeAt(s+1),(64512&i)==56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),c+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(c),r=0,s=0;r<c;s++)e=n.charCodeAt(s),(64512&e)==55296&&s+1<a&&(i=n.charCodeAt(s+1),(64512&i)==56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),e<128?t[r++]=e:e<2048?(t[r++]=192|e>>>6,t[r++]=128|63&e):e<65536?(t[r++]=224|e>>>12,t[r++]=128|e>>>6&63,t[r++]=128|63&e):(t[r++]=240|e>>>18,t[r++]=128|e>>>12&63,t[r++]=128|e>>>6&63,t[r++]=128|63&e);return t},buf2string:(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let i,s;const r=new Array(2*e);for(s=0,i=0;i<e;){let a=n[i++];if(a<128){r[s++]=a;continue}let c=oh[a];if(c>4)r[s++]=65533,i+=c-1;else{for(a&=c===2?31:c===3?15:7;c>1&&i<e;)a=a<<6|63&n[i++],c--;c>1?r[s++]=65533:a<65536?r[s++]=a:(a-=65536,r[s++]=55296|a>>10&1023,r[s++]=56320|1023&a)}}return((a,c)=>{if(c<65534&&a.subarray&&_0)return String.fromCharCode.apply(null,a.length===c?a:a.subarray(0,c));let l="";for(let u=0;u<c;u++)l+=String.fromCharCode(a[u]);return l})(r,s)},utf8border:(n,t)=>{(t=t||n.length)>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(192&n[e])==128;)e--;return e<0||e===0?t:e+oh[n[e]]>t?e:t}},m0=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const E0=Object.prototype.toString,{Z_NO_FLUSH:N3,Z_SYNC_FLUSH:D3,Z_FULL_FLUSH:P3,Z_FINISH:L3,Z_OK:c_,Z_STREAM_END:k3,Z_DEFAULT_COMPRESSION:M3,Z_DEFAULT_STRATEGY:U3,Z_DEFLATED:x3}=ll;function ch(n){this.options=a_.assign({level:M3,method:x3,chunkSize:16384,windowBits:15,memLevel:8,strategy:U3},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m0,this.strm.avail_out=0;let e=rh.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==c_)throw new Error(Hc[e]);if(t.header&&rh.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?ah.string2buf(t.dictionary):E0.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,e=rh.deflateSetDictionary(this.strm,i),e!==c_)throw new Error(Hc[e]);this._dict_set=!0}}function AS(n,t){const e=new ch(t);if(e.push(n,!0),e.err)throw e.msg||Hc[e.err];return e.result}ch.prototype.push=function(n,t){const e=this.strm,i=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=t===~~t?t:t===!0?L3:N3,typeof n=="string"?e.input=ah.string2buf(n):E0.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;)if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(r===D3||r===P3)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(s=rh.deflate(e,r),s===k3)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=rh.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===c_;if(e.avail_out!==0){if(r>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(e.avail_in===0)break}else this.onData(e.output)}return!0},ch.prototype.onData=function(n){this.chunks.push(n)},ch.prototype.onEnd=function(n){n===c_&&(this.result=a_.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var V3={Deflate:ch,deflate:AS,deflateRaw:function(n,t){return(t=t||{}).raw=!0,AS(n,t)},gzip:function(n,t){return(t=t||{}).gzip=!0,AS(n,t)},constants:ll};const d_=16209;var F3=function(n,t){let e,i,s,r,a,c,l,u,h,f,g,S,w,b,I,U,F,V,Z,$,W,Y,nt,mt;const ut=n.state;e=n.next_in,nt=n.input,i=e+(n.avail_in-5),s=n.next_out,mt=n.output,r=s-(t-n.avail_out),a=s+(n.avail_out-257),c=ut.dmax,l=ut.wsize,u=ut.whave,h=ut.wnext,f=ut.window,g=ut.hold,S=ut.bits,w=ut.lencode,b=ut.distcode,I=(1<<ut.lenbits)-1,U=(1<<ut.distbits)-1;t:do{S<15&&(g+=nt[e++]<<S,S+=8,g+=nt[e++]<<S,S+=8),F=w[g&I];e:for(;;){if(V=F>>>24,g>>>=V,S-=V,V=F>>>16&255,V===0)mt[s++]=65535&F;else{if(!(16&V)){if(!(64&V)){F=w[(65535&F)+(g&(1<<V)-1)];continue e}if(32&V){ut.mode=16191;break t}n.msg="invalid literal/length code",ut.mode=d_;break t}Z=65535&F,V&=15,V&&(S<V&&(g+=nt[e++]<<S,S+=8),Z+=g&(1<<V)-1,g>>>=V,S-=V),S<15&&(g+=nt[e++]<<S,S+=8,g+=nt[e++]<<S,S+=8),F=b[g&U];n:for(;;){if(V=F>>>24,g>>>=V,S-=V,V=F>>>16&255,!(16&V)){if(!(64&V)){F=b[(65535&F)+(g&(1<<V)-1)];continue n}n.msg="invalid distance code",ut.mode=d_;break t}if($=65535&F,V&=15,S<V&&(g+=nt[e++]<<S,S+=8,S<V&&(g+=nt[e++]<<S,S+=8)),$+=g&(1<<V)-1,$>c){n.msg="invalid distance too far back",ut.mode=d_;break t}if(g>>>=V,S-=V,V=s-r,$>V){if(V=$-V,V>u&&ut.sane){n.msg="invalid distance too far back",ut.mode=d_;break t}if(W=0,Y=f,h===0){if(W+=l-V,V<Z){Z-=V;do mt[s++]=f[W++];while(--V);W=s-$,Y=mt}}else if(h<V){if(W+=l+h-V,V-=h,V<Z){Z-=V;do mt[s++]=f[W++];while(--V);if(W=0,h<Z){V=h,Z-=V;do mt[s++]=f[W++];while(--V);W=s-$,Y=mt}}}else if(W+=h-V,V<Z){Z-=V;do mt[s++]=f[W++];while(--V);W=s-$,Y=mt}for(;Z>2;)mt[s++]=Y[W++],mt[s++]=Y[W++],mt[s++]=Y[W++],Z-=3;Z&&(mt[s++]=Y[W++],Z>1&&(mt[s++]=Y[W++]))}else{W=s-$;do mt[s++]=mt[W++],mt[s++]=mt[W++],mt[s++]=mt[W++],Z-=3;while(Z>2);Z&&(mt[s++]=mt[W++],Z>1&&(mt[s++]=mt[W++]))}break}}break}}while(e<i&&s<a);Z=S>>3,e-=Z,S-=Z<<3,g&=(1<<S)-1,n.next_in=e,n.next_out=s,n.avail_in=e<i?i-e+5:5-(e-i),n.avail_out=s<a?a-s+257:257-(s-a),ut.hold=g,ut.bits=S};const l_=15,B3=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),j3=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),G3=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),W3=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var dh=(n,t,e,i,s,r,a,c)=>{const l=c.bits;let u,h,f,g,S,w,b=0,I=0,U=0,F=0,V=0,Z=0,$=0,W=0,Y=0,nt=0,mt=null;const ut=new Uint16Array(16),ee=new Uint16Array(16);let Te,be,Fe,_e=null;for(b=0;b<=l_;b++)ut[b]=0;for(I=0;I<i;I++)ut[t[e+I]]++;for(V=l,F=l_;F>=1&&ut[F]===0;F--);if(V>F&&(V=F),F===0)return s[r++]=20971520,s[r++]=20971520,c.bits=1,0;for(U=1;U<F&&ut[U]===0;U++);for(V<U&&(V=U),W=1,b=1;b<=l_;b++)if(W<<=1,W-=ut[b],W<0)return-1;if(W>0&&(n===0||F!==1))return-1;for(ee[1]=0,b=1;b<l_;b++)ee[b+1]=ee[b]+ut[b];for(I=0;I<i;I++)t[e+I]!==0&&(a[ee[t[e+I]]++]=I);if(n===0?(mt=_e=a,w=20):n===1?(mt=B3,_e=j3,w=257):(mt=G3,_e=W3,w=0),nt=0,I=0,b=U,S=r,Z=V,$=0,f=-1,Y=1<<V,g=Y-1,n===1&&Y>852||n===2&&Y>592)return 1;for(;;){Te=b-$,a[I]+1<w?(be=0,Fe=a[I]):a[I]>=w?(be=_e[a[I]-w],Fe=mt[a[I]-w]):(be=96,Fe=0),u=1<<b-$,h=1<<Z,U=h;do h-=u,s[S+(nt>>$)+h]=Te<<24|be<<16|Fe|0;while(h!==0);for(u=1<<b-1;nt&u;)u>>=1;if(u!==0?(nt&=u-1,nt+=u):nt=0,I++,--ut[b]==0){if(b===F)break;b=t[e+a[I]]}if(b>V&&(nt&g)!==f){for($===0&&($=V),S+=U,Z=b-$,W=1<<Z;Z+$<F&&(W-=ut[Z+$],!(W<=0));)Z++,W<<=1;if(Y+=1<<Z,n===1&&Y>852||n===2&&Y>592)return 1;f=nt&g,s[f]=V<<24|Z<<16|S-r|0}}return nt!==0&&(s[S+nt]=b-$<<24|64<<16|0),c.bits=V,0};const{Z_FINISH:g0,Z_BLOCK:H3,Z_TREES:u_,Z_OK:zc,Z_STREAM_END:K3,Z_NEED_DICT:q3,Z_STREAM_ERROR:Ir,Z_DATA_ERROR:T0,Z_MEM_ERROR:S0,Z_BUF_ERROR:Y3,Z_DEFLATED:v0}=ll,h_=16180,p_=16190,ea=16191,wS=16192,OS=16194,f_=16199,__=16200,NS=16206,ni=16209,y0=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function z3(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Jc=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<h_||t.mode>16211?1:0},C0=n=>{if(Jc(n))return Ir;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=1&t.wrap),t.mode=h_,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,zc},R0=n=>{if(Jc(n))return Ir;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,C0(n)},b0=(n,t)=>{let e;if(Jc(n))return Ir;const i=n.state;return t<0?(e=0,t=-t):(e=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ir:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=e,i.wbits=t,R0(n))},I0=(n,t)=>{if(!n)return Ir;const e=new z3;n.state=e,e.strm=n,e.window=null,e.mode=h_;const i=b0(n,t);return i!==zc&&(n.state=null),i};let DS,PS,A0=!0;const J3=n=>{if(A0){DS=new Int32Array(512),PS=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(dh(1,n.lens,0,288,DS,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;dh(2,n.lens,0,32,PS,0,n.work,{bits:5}),A0=!1}n.lencode=DS,n.lenbits=9,n.distcode=PS,n.distbits=5},w0=(n,t,e,i)=>{let s;const r=n.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(t.subarray(e-r.wsize,e),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>i&&(s=i),r.window.set(t.subarray(e-i,e-i+s),r.wnext),(i-=s)?(r.window.set(t.subarray(e-i,e),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var X3=(n,t)=>{let e,i,s,r,a,c,l,u,h,f,g,S,w,b,I,U,F,V,Z,$,W,Y,nt=0;const mt=new Uint8Array(4);let ut,ee;const Te=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Jc(n)||!n.output||!n.input&&n.avail_in!==0)return Ir;e=n.state,e.mode===ea&&(e.mode=wS),a=n.next_out,s=n.output,l=n.avail_out,r=n.next_in,i=n.input,c=n.avail_in,u=e.hold,h=e.bits,f=c,g=l,Y=zc;t:for(;;)switch(e.mode){case h_:if(e.wrap===0){e.mode=wS;break}for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(2&e.wrap&&u===35615){e.wbits===0&&(e.wbits=15),e.check=0,mt[0]=255&u,mt[1]=u>>>8&255,e.check=Wi(e.check,mt,2,0),u=0,h=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&u)<<8)+(u>>8))%31){n.msg="incorrect header check",e.mode=ni;break}if((15&u)!==v0){n.msg="unknown compression method",e.mode=ni;break}if(u>>>=4,h-=4,W=8+(15&u),e.wbits===0&&(e.wbits=W),W>15||W>e.wbits){n.msg="invalid window size",e.mode=ni;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=512&u?16189:ea,u=0,h=0;break;case 16181:for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(e.flags=u,(255&e.flags)!==v0){n.msg="unknown compression method",e.mode=ni;break}if(57344&e.flags){n.msg="unknown header flags set",e.mode=ni;break}e.head&&(e.head.text=u>>8&1),512&e.flags&&4&e.wrap&&(mt[0]=255&u,mt[1]=u>>>8&255,e.check=Wi(e.check,mt,2,0)),u=0,h=0,e.mode=16182;case 16182:for(;h<32;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.head&&(e.head.time=u),512&e.flags&&4&e.wrap&&(mt[0]=255&u,mt[1]=u>>>8&255,mt[2]=u>>>16&255,mt[3]=u>>>24&255,e.check=Wi(e.check,mt,4,0)),u=0,h=0,e.mode=16183;case 16183:for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.head&&(e.head.xflags=255&u,e.head.os=u>>8),512&e.flags&&4&e.wrap&&(mt[0]=255&u,mt[1]=u>>>8&255,e.check=Wi(e.check,mt,2,0)),u=0,h=0,e.mode=16184;case 16184:if(1024&e.flags){for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.length=u,e.head&&(e.head.extra_len=u),512&e.flags&&4&e.wrap&&(mt[0]=255&u,mt[1]=u>>>8&255,e.check=Wi(e.check,mt,2,0)),u=0,h=0}else e.head&&(e.head.extra=null);e.mode=16185;case 16185:if(1024&e.flags&&(S=e.length,S>c&&(S=c),S&&(e.head&&(W=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(r,r+S),W)),512&e.flags&&4&e.wrap&&(e.check=Wi(e.check,i,S,r)),c-=S,r+=S,e.length-=S),e.length))break t;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(c===0)break t;S=0;do W=i[r+S++],e.head&&W&&e.length<65536&&(e.head.name+=String.fromCharCode(W));while(W&&S<c);if(512&e.flags&&4&e.wrap&&(e.check=Wi(e.check,i,S,r)),c-=S,r+=S,W)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(c===0)break t;S=0;do W=i[r+S++],e.head&&W&&e.length<65536&&(e.head.comment+=String.fromCharCode(W));while(W&&S<c);if(512&e.flags&&4&e.wrap&&(e.check=Wi(e.check,i,S,r)),c-=S,r+=S,W)break t}else e.head&&(e.head.comment=null);e.mode=16188;case 16188:if(512&e.flags){for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(4&e.wrap&&u!==(65535&e.check)){n.msg="header crc mismatch",e.mode=ni;break}u=0,h=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=ea;break;case 16189:for(;h<32;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}n.adler=e.check=y0(u),u=0,h=0,e.mode=p_;case p_:if(e.havedict===0)return n.next_out=a,n.avail_out=l,n.next_in=r,n.avail_in=c,e.hold=u,e.bits=h,q3;n.adler=e.check=1,e.mode=ea;case ea:if(t===H3||t===u_)break t;case wS:if(e.last){u>>>=7&h,h-=7&h,e.mode=NS;break}for(;h<3;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}switch(e.last=1&u,u>>>=1,h-=1,3&u){case 0:e.mode=16193;break;case 1:if(J3(e),e.mode=f_,t===u_){u>>>=2,h-=2;break t}break;case 2:e.mode=16196;break;case 3:n.msg="invalid block type",e.mode=ni}u>>>=2,h-=2;break;case 16193:for(u>>>=7&h,h-=7&h;h<32;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if((65535&u)!=(u>>>16^65535)){n.msg="invalid stored block lengths",e.mode=ni;break}if(e.length=65535&u,u=0,h=0,e.mode=OS,t===u_)break t;case OS:e.mode=16195;case 16195:if(S=e.length,S){if(S>c&&(S=c),S>l&&(S=l),S===0)break t;s.set(i.subarray(r,r+S),a),c-=S,r+=S,l-=S,a+=S,e.length-=S;break}e.mode=ea;break;case 16196:for(;h<14;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(e.nlen=257+(31&u),u>>>=5,h-=5,e.ndist=1+(31&u),u>>>=5,h-=5,e.ncode=4+(15&u),u>>>=4,h-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=ni;break}e.have=0,e.mode=16197;case 16197:for(;e.have<e.ncode;){for(;h<3;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.lens[Te[e.have++]]=7&u,u>>>=3,h-=3}for(;e.have<19;)e.lens[Te[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,ut={bits:e.lenbits},Y=dh(0,e.lens,0,19,e.lencode,0,e.work,ut),e.lenbits=ut.bits,Y){n.msg="invalid code lengths set",e.mode=ni;break}e.have=0,e.mode=16198;case 16198:for(;e.have<e.nlen+e.ndist;){for(;nt=e.lencode[u&(1<<e.lenbits)-1],I=nt>>>24,U=nt>>>16&255,F=65535&nt,!(I<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(F<16)u>>>=I,h-=I,e.lens[e.have++]=F;else{if(F===16){for(ee=I+2;h<ee;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(u>>>=I,h-=I,e.have===0){n.msg="invalid bit length repeat",e.mode=ni;break}W=e.lens[e.have-1],S=3+(3&u),u>>>=2,h-=2}else if(F===17){for(ee=I+3;h<ee;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}u>>>=I,h-=I,W=0,S=3+(7&u),u>>>=3,h-=3}else{for(ee=I+7;h<ee;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}u>>>=I,h-=I,W=0,S=11+(127&u),u>>>=7,h-=7}if(e.have+S>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=ni;break}for(;S--;)e.lens[e.have++]=W}}if(e.mode===ni)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=ni;break}if(e.lenbits=9,ut={bits:e.lenbits},Y=dh(1,e.lens,0,e.nlen,e.lencode,0,e.work,ut),e.lenbits=ut.bits,Y){n.msg="invalid literal/lengths set",e.mode=ni;break}if(e.distbits=6,e.distcode=e.distdyn,ut={bits:e.distbits},Y=dh(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,ut),e.distbits=ut.bits,Y){n.msg="invalid distances set",e.mode=ni;break}if(e.mode=f_,t===u_)break t;case f_:e.mode=__;case __:if(c>=6&&l>=258){n.next_out=a,n.avail_out=l,n.next_in=r,n.avail_in=c,e.hold=u,e.bits=h,F3(n,g),a=n.next_out,s=n.output,l=n.avail_out,r=n.next_in,i=n.input,c=n.avail_in,u=e.hold,h=e.bits,e.mode===ea&&(e.back=-1);break}for(e.back=0;nt=e.lencode[u&(1<<e.lenbits)-1],I=nt>>>24,U=nt>>>16&255,F=65535&nt,!(I<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(U&&!(240&U)){for(V=I,Z=U,$=F;nt=e.lencode[$+((u&(1<<V+Z)-1)>>V)],I=nt>>>24,U=nt>>>16&255,F=65535&nt,!(V+I<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}u>>>=V,h-=V,e.back+=V}if(u>>>=I,h-=I,e.back+=I,e.length=F,U===0){e.mode=16205;break}if(32&U){e.back=-1,e.mode=ea;break}if(64&U){n.msg="invalid literal/length code",e.mode=ni;break}e.extra=15&U,e.mode=16201;case 16201:if(e.extra){for(ee=e.extra;h<ee;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.length+=u&(1<<e.extra)-1,u>>>=e.extra,h-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=16202;case 16202:for(;nt=e.distcode[u&(1<<e.distbits)-1],I=nt>>>24,U=nt>>>16&255,F=65535&nt,!(I<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(!(240&U)){for(V=I,Z=U,$=F;nt=e.distcode[$+((u&(1<<V+Z)-1)>>V)],I=nt>>>24,U=nt>>>16&255,F=65535&nt,!(V+I<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}u>>>=V,h-=V,e.back+=V}if(u>>>=I,h-=I,e.back+=I,64&U){n.msg="invalid distance code",e.mode=ni;break}e.offset=F,e.extra=15&U,e.mode=16203;case 16203:if(e.extra){for(ee=e.extra;h<ee;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.offset+=u&(1<<e.extra)-1,u>>>=e.extra,h-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=ni;break}e.mode=16204;case 16204:if(l===0)break t;if(S=g-l,e.offset>S){if(S=e.offset-S,S>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=ni;break}S>e.wnext?(S-=e.wnext,w=e.wsize-S):w=e.wnext-S,S>e.length&&(S=e.length),b=e.window}else b=s,w=a-e.offset,S=e.length;S>l&&(S=l),l-=S,e.length-=S;do s[a++]=b[w++];while(--S);e.length===0&&(e.mode=__);break;case 16205:if(l===0)break t;s[a++]=e.length,l--,e.mode=__;break;case NS:if(e.wrap){for(;h<32;){if(c===0)break t;c--,u|=i[r++]<<h,h+=8}if(g-=l,n.total_out+=g,e.total+=g,4&e.wrap&&g&&(n.adler=e.check=e.flags?Wi(e.check,s,g,a-g):th(e.check,s,g,a-g)),g=l,4&e.wrap&&(e.flags?u:y0(u))!==e.check){n.msg="incorrect data check",e.mode=ni;break}u=0,h=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;h<32;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(4&e.wrap&&u!==(4294967295&e.total)){n.msg="incorrect length check",e.mode=ni;break}u=0,h=0}e.mode=16208;case 16208:Y=K3;break t;case ni:Y=T0;break t;case 16210:return S0;default:return Ir}return n.next_out=a,n.avail_out=l,n.next_in=r,n.avail_in=c,e.hold=u,e.bits=h,(e.wsize||g!==n.avail_out&&e.mode<ni&&(e.mode<NS||t!==g0))&&w0(n,n.output,n.next_out,g-n.avail_out),f-=n.avail_in,g-=n.avail_out,n.total_in+=f,n.total_out+=g,e.total+=g,4&e.wrap&&g&&(n.adler=e.check=e.flags?Wi(e.check,s,g,n.next_out-g):th(e.check,s,g,n.next_out-g)),n.data_type=e.bits+(e.last?64:0)+(e.mode===ea?128:0)+(e.mode===f_||e.mode===OS?256:0),(f===0&&g===0||t===g0)&&Y===zc&&(Y=Y3),Y},na={inflateReset:R0,inflateReset2:b0,inflateResetKeep:C0,inflateInit:n=>I0(n,15),inflateInit2:I0,inflate:X3,inflateEnd:n=>{if(Jc(n))return Ir;let t=n.state;return t.window&&(t.window=null),n.state=null,zc},inflateGetHeader:(n,t)=>{if(Jc(n))return Ir;const e=n.state;return 2&e.wrap?(e.head=t,t.done=!1,zc):Ir},inflateSetDictionary:(n,t)=>{const e=t.length;let i,s,r;return Jc(n)?Ir:(i=n.state,i.wrap!==0&&i.mode!==p_?Ir:i.mode===p_&&(s=1,s=th(s,t,e,0),s!==i.check)?T0:(r=w0(n,t,e,e),r?(i.mode=16210,S0):(i.havedict=1,zc)))},inflateInfo:"pako inflate (from Nodeca project)"},$3=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const O0=Object.prototype.toString,{Z_NO_FLUSH:Q3,Z_FINISH:Z3,Z_OK:lh,Z_STREAM_END:LS,Z_NEED_DICT:kS,Z_STREAM_ERROR:t4,Z_DATA_ERROR:N0,Z_MEM_ERROR:e4}=ll;function uh(n){this.options=a_.assign({chunkSize:65536,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||n&&n.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m0,this.strm.avail_out=0;let e=na.inflateInit2(this.strm,t.windowBits);if(e!==lh)throw new Error(Hc[e]);if(this.header=new $3,na.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=ah.string2buf(t.dictionary):O0.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=na.inflateSetDictionary(this.strm,t.dictionary),e!==lh)))throw new Error(Hc[e])}function MS(n,t){const e=new uh(t);if(e.push(n),e.err)throw e.msg||Hc[e.err];return e.result}uh.prototype.push=function(n,t){const e=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let r,a,c;if(this.ended)return!1;for(a=t===~~t?t:t===!0?Z3:Q3,O0.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),r=na.inflate(e,a),r===kS&&s&&(r=na.inflateSetDictionary(e,s),r===lh?r=na.inflate(e,a):r===N0&&(r=kS));e.avail_in>0&&r===LS&&e.state.wrap>0&&n[e.next_in]!==0;)na.inflateReset(e),r=na.inflate(e,a);switch(r){case t4:case N0:case kS:case e4:return this.onEnd(r),this.ended=!0,!1}if(c=e.avail_out,e.next_out&&(e.avail_out===0||r===LS))if(this.options.to==="string"){let l=ah.utf8border(e.output,e.next_out),u=e.next_out-l,h=ah.buf2string(e.output,l);e.next_out=u,e.avail_out=i-u,u&&e.output.set(e.output.subarray(l,l+u),0),this.onData(h)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(r!==lh||c!==0){if(r===LS)return r=na.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(e.avail_in===0)break}}return!0},uh.prototype.onData=function(n){this.chunks.push(n)},uh.prototype.onEnd=function(n){n===lh&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a_.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var n4={Inflate:uh,inflate:MS,inflateRaw:function(n,t){return(t=t||{}).raw=!0,MS(n,t)},ungzip:MS,constants:ll};const{Deflate:yz,deflate:i4,deflateRaw:Cz,gzip:Rz}=V3,{Inflate:bz,inflate:s4,inflateRaw:Iz,ungzip:Az}=n4;var US,r4=i4,o4=s4;(function(n){n[n.ONE_BYTE=0]="ONE_BYTE",n[n.TWO_BYTE=1]="TWO_BYTE"})(US||(US={}));class a4{constructor(){m(this,"_sequence",0),m(this,"_startTime",Date.now()),m(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const e={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const l={id:0,length:4,data:c.buffer},u={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[l]};e.commonPacketHeader.extension=1,e.extension=u,e.payload=this.compress(t),e.commonPacketHeader.length=8+(e.extension.length+2)+e.payload.byteLength}else e.commonPacketHeader.length=8+e.payload.byteLength;const i=new ArrayBuffer(e.commonPacketHeader.length),s=new Uint8Array(i),r=new DataView(i);let a=0;if(r.setUint16(a,e.commonPacketHeader.extension<<15|e.commonPacketHeader.reserved<<14|e.commonPacketHeader.length,!0),a+=2,r.setUint32(a,e.commonPacketHeader.sequence,!0),a+=4,r.setUint16(a,e.commonStreamHeader,!0),a+=2,e.extension){const c=this.serializeExtension(e.extension);s.set(new Uint8Array(c),a),a+=c.byteLength}if(s.set(new Uint8Array(e.payload),a),a+=e.payload.byteLength,a!==e.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const e=new DataView(t);let i=0;const s=e.getUint16(i,!0);i+=2;const r=(32768&s)>>15;e.getUint16(i+2,!0),e.getUint16(i,!0);let a,c;if(i+=4,e.getUint16(i,!0),i+=2,r){c=this.deserializeExtension(t.slice(i)),i+=2+c.length,a=t.slice(i);let l=!1;if(c.datas.length>0){const u=c.datas.find(h=>h.id===0);u&&(l=(1&new DataView(u.data).getUint32(0,!0))==1)}a=l?this.decompress(a):a}else a=t.slice(8);return a}serializeExtension(t){const{profile:e,length:i,datas:s}=t,r=new ArrayBuffer(i+2),a=new Uint8Array(r),c=new DataView(r);let l=0;if(c.setUint8(l++,e),c.setUint8(l++,i),s.forEach(u=>{e?(c.setUint8(l++,u.id),c.setUint8(l++,u.length),a.set(new Uint8Array(u.data),l),l+=u.data.byteLength):(c.setUint8(l++,u.id|u.length<<4),a.set(new Uint8Array(u.data),l),l+=u.data.byteLength)}),l!==i+2)throw Error("serialize extension error, is ".concat(l,"!==").concat(i+2));return r}deserializeExtension(t){const e=new DataView(t);let i=0;const s=e.getUint8(i);i++;const r=e.getUint8(i);i++;const a=s===US.TWO_BYTE,c=[],l=new DataView(t,2);let u=0;for(;u<r;){let h=0,f=0,g=new ArrayBuffer(0);a?(h=l.getUint8(u),u++,f=l.getUint8(u),u++):(h=15&l.getUint8(u),f=l.getUint8(u)>>4,u++),f>0&&(g=l.buffer.slice(u+2,u+2+f),u+=g.byteLength),c.push({id:h,length:f,data:g})}if(u!==r)throw Error("parse error");return{profile:s,length:r,datas:c}}decompress(t){return o4(new Uint8Array(t))}compress(t){return r4(new Uint8Array(t))}}class D0 extends rn{constructor(t,e){super(),m(this,"_version",1),m(this,"_type",3),m(this,"_config",void 0),m(this,"_originDataChannel",void 0),m(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),m(this,"_dataStreamPacketHandler",void 0),m(this,"_datachannelEventMap",new Map),this._config=t,e&&(this._originDataChannel=e,this._bandDataChannelEvents(e)),this._initPacketHeader(),this._dataStreamPacketHandler=new a4}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return x("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,e;return(t=(e=this._originDataChannel)===null||e===void 0?void 0:e.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,e;return(t=(e=this._originDataChannel)===null||e===void 0?void 0:e.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new K((t,e)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var s;e(new Q(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new Q(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else e(new Q(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[rl.OPEN,rl.CLOSE,rl.ERROR].forEach(e=>{const i=()=>{this.emit(e)};this._datachannelEventMap.set(e,i),t.addEventListener(e,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(e=>{let[i,s]=e;t.removeEventListener(i,s)}),this._datachannelEventMap.clear()}}class c4 extends D0{constructor(t){super(t),m(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=e.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(i).getUint8(3)!==this.id)return;let s=e.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(rl.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class P0 extends D0{send(t){if(this._originDataChannel){let e=t;e=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+e.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(e),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}class d4 extends rn{constructor(){super(...arguments),m(this,"resultStorage",new Map)}setLocalAudioStats(t,e,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,e)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,e))}setLocalVideoStats(t,e,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,e)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,e)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,e){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(e))}setRemoteVideoStats(t,e){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(e))}record(t,e,i){if(x("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(s&&(s.result.push(i),s.result.length>=5)){var r;const a=Wt(r=s.result).call(r,!0);s.isPrevNormal&&!a&&this.emit("exception",L0[t],t,e),!s.isPrevNormal&&a&&this.emit("exception",L0[t]+2e3,t+"_RECOVER",e),s.isPrevNormal=a,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,e){return e instanceof Pn&&!e.isActive||!!e.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,e){let i=null;e._encoderConfig&&e._encoderConfig.frameRate&&(i=Hs(e._encoderConfig.frameRate));const s=t.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,e){return!!e.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,e){return e instanceof Pn&&!e.isActive||!!e.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const L0={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},gi=new class{markSubscribeStart(n,t){performance.mark("agora-web-sdk/".concat(n,"/subscribe-").concat(t))}markPublishStart(n,t){performance.mark("agora-web-sdk/".concat(n,"/publish-").concat(t))}measureFromSubscribeStart(n,t){const e=performance.getEntriesByName("agora-web-sdk/".concat(n,"/subscribe-").concat(t));if(e.length>0){const i=e[e.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(n,t){const e=performance.getEntriesByName("agora-web-sdk/".concat(n,"/publish-").concat(t));if(e.length>0){const i=e[e.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function k0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Xc(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?k0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):k0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class fl{constructor(t){m(this,"store",void 0),m(this,"onStatsException",void 0),m(this,"onUploadPublishDuration",void 0),m(this,"onStatsChanged",void 0),m(this,"localStats",new Map),m(this,"remoteStats",new Map),m(this,"updateStatsInterval",void 0),m(this,"trafficStats",void 0),m(this,"trafficStatsPeerList",[]),m(this,"uplinkStats",void 0),m(this,"exceptionMonitor",void 0),m(this,"p2pChannel",void 0),m(this,"scalabilityMode",jT.L1T1),m(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new d4,this.exceptionMonitor.on("exception",(e,i,s)=>{this.onStatsException&&this.onStatsException(e,i,s)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(st.LocalAudioTrack)||Xc({},eS)}getLocalVideoTrackStats(){return this.localStats.get(st.LocalVideoTrack)||Xc({},nS)}getRemoteAudioTrackStats(t){const e=(r,a)=>{if(!this.trafficStats)return a;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===r);return c&&(a.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),a},i={};if(t){var s;const r=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;r&&(i[t]=e(t,r))}else Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{audioStats:c}]=r;c&&(i[a]=e(a,c))});return i}getRemoteNetworkQualityStats(t){const e={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;s&&(e[t]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[r,{networkStats:a}]=s;a&&(e[r]=a)});return e}getRemoteVideoTrackStats(t){const e=(r,a)=>{if(!this.trafficStats)return a;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===r);return c&&(a.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),a},i={};if(t){var s;const r=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;r&&(i[t]=e(t,r))}else Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{videoStats:c}]=r;c&&(i[a]=e(a,c))});return i}getRTCStats(){let t=0,e=0,i=0,s=0;const r=this.localStats.get(st.LocalAudioTrack);r&&(t+=r.sendBytes,e+=r.sendBitrate);const a=this.localStats.get(st.LocalVideoTrack);a&&(t+=a.sendBytes,e+=a.sendBitrate);const c=this.localStats.get(st.LocalVideoLowTrack);c&&(t+=c.sendBytes,e+=c.sendBitrate),this.remoteStats.forEach(u=>{let{audioStats:h,videoStats:f}=u;h&&(i+=h.receiveBytes,s+=h.receiveBitrate),f&&(i+=f.receiveBytes,s+=f.receiveBitrate)});let l=1;return this.trafficStats&&(l+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:l,SendBitrate:e,SendBytes:t,RecvBytes:i,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(e=>e.B_ppad!==void 0||e.B_ppvd!==void 0),t.peer_delay.filter(e=>this.trafficStatsPeerList.indexOf(e.peer_uid)===-1).forEach(e=>{var i;const s=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(e.peer_uid),r=s!=null&&s.videoSSRC?gi.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,a=s!=null&&s.audioSSRC?gi.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;e.B_ppad!==void 0&&e.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>a?r:a),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&v.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,e,i){if(!t)return!1;const s=!!i&&e.framesDecodeFreezeTime>i.framesDecodeFreezeTime,r=!i||e.framesDecodeCount>i.framesDecodeCount;return s||!r}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(e=>{let[i,s]=e;switch(i){case st.LocalVideoTrack:case st.LocalVideoLowTrack:{const a=s,c=Xc({},nS),l=t.getStats(),u=t.getLocalMedia(i);if(l){const h=l.videoSend.find(f=>f.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(h){const f=t.getLocalVideoSize(),g=t.getEncoderConfig(st.LocalVideoTrack);h.codec!=="H264"&&h.codec!=="H265"&&h.codec!=="VP8"&&h.codec!=="VP9"&&h.codec!=="AV1X"&&h.codec!=="AV1"||(c.codecType=h.codec),c.sendBytes=h.bytes,c.sendBitrate=a?8*Math.max(0,c.sendBytes-a.sendBytes):0,h.inputFrame?(c.captureFrameRate=h.inputFrame.frameRate,c.captureResolutionHeight=h.inputFrame.height,c.captureResolutionWidth=h.inputFrame.width):f&&(c.captureResolutionWidth=f.width,c.captureResolutionHeight=f.height),h.sentFrame?(c.sendFrameRate=h.sentFrame.frameRate,c.sendResolutionHeight=h.sentFrame.height,c.sendResolutionWidth=h.sentFrame.width):f&&(c.sendResolutionWidth=f.width,c.sendResolutionHeight=f.height),h.avgEncodeMs&&(c.encodeDelay=h.avgEncodeMs),g&&g.bitrateMax&&(c.targetSendBitrate=1e3*g.bitrateMax),c.sendPackets=h.packets,c.sendPacketsLost=h.packetsLost,c.sendJitterMs=h.jitterMs,c.sendRttMs=h.rttMs,c.totalDuration=a?a.totalDuration+1:1,c.totalFreezeTime=a?a.totalFreezeTime:0,this.isLocalVideoFreeze(h)&&(c.totalFreezeTime+=1),h.scalabilityMode&&this.scalabilityMode!==h.scalabilityMode&&(v.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(h.scalabilityMode)),this.scalabilityMode=h.scalabilityMode)}this.trafficStats&&(c.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var r;this.localStats.set(i,c),((a==null?void 0:a.sendResolutionWidth)!==c.sendResolutionWidth||(a==null?void 0:a.sendResolutionHeight)!==c.sendResolutionHeight)&&((r=this.onStatsChanged)===null||r===void 0||r.call(this,"resolution",{width:c.sendResolutionWidth,height:c.sendResolutionHeight})),c&&u&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,u.track,c);break}case st.LocalAudioTrack:{const a=s,c=Xc({},eS),l=t.getStats(),u=t.getLocalMedia(i);if(l){const h=l.audioSend.find(f=>f.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(h){if(h.codec!=="opus"&&h.codec!=="aac"&&h.codec!=="PCMU"&&h.codec!=="PCMA"&&h.codec!=="G722"||(c.codecType=h.codec),h.inputLevel)c.sendVolumeLevel=Math.round(32767*h.inputLevel);else{const f=t.getLocalAudioVolume();f&&(c.sendVolumeLevel=Math.round(32767*f))}c.sendBytes=h.bytes,c.sendPackets=h.packets,c.sendPacketsLost=h.packetsLost,c.sendJitterMs=h.jitterMs,c.sendRttMs=h.rttMs,c.sendBitrate=a?8*Math.max(0,c.sendBytes-a.sendBytes):0}}this.trafficStats&&(c.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(st.LocalAudioTrack,c),c&&u&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,u.track,c);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(e=>{let[i,{videoStats:s,audioStats:r,videoPcStats:a}]=e;const c=r,l=s,u=a,h=Xc({},uw),f=Xc({},hw),g=Xc({},Yj),{audioTrack:S,videoTrack:w,audioSSRC:b,videoSSRC:I}=t.getRemoteMedia(i),U=t.getStats(),F=U==null?void 0:U.audioRecv.find($=>$.ssrc===b),V=U==null?void 0:U.videoRecv.find($=>$.ssrc===I),Z=this.trafficStats&&this.trafficStats.peer_delay.find($=>$.peer_uid===i);if(F&&(F.codec!=="opus"&&F.codec!=="aac"&&F.codec!=="PCMU"&&F.codec!=="PCMA"&&F.codec!=="G722"||(h.codecType=F.codec),F.outputLevel?h.receiveLevel=Math.round(32767*F.outputLevel):S&&(h.receiveLevel=Math.round(32767*S.getVolumeLevel())),h.receiveBytes=F.bytes,h.receivePackets=F.packets,h.receivePacketsLost=F.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.receiveBitrate=c?8*Math.max(0,h.receiveBytes-c.receiveBytes):0,h.totalDuration=c?c.totalDuration+1:1,h.totalFreezeTime=c?c.totalFreezeTime:0,h.freezeRate=h.totalFreezeTime/h.totalDuration,h.receiveDelay=F.jitterBufferMs,h.totalDuration>10&&fl.isRemoteAudioFreeze(S)&&(h.totalFreezeTime+=1)),V){V.codec!=="H264"&&V.codec!=="H265"&&V.codec!=="VP8"&&V.codec!=="VP9"&&V.codec!=="AV1X"&&V.codec!=="AV1"||(f.codecType=V.codec),f.receiveBytes=V.bytes,f.receiveBitrate=l?8*Math.max(0,f.receiveBytes-l.receiveBytes):0,f.decodeFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,f.renderFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,V.outputFrame&&(f.renderFrameRate=V.outputFrame.frameRate),V.receivedFrame?(f.receiveFrameRate=V.receivedFrame.frameRate,f.receiveResolutionHeight=V.receivedFrame.height,f.receiveResolutionWidth=V.receivedFrame.width):w&&(f.receiveResolutionHeight=w._videoHeight||0,f.receiveResolutionWidth=w._videoWidth||0),V.framesRateFirefox!==void 0&&(f.receiveFrameRate=Math.round(V.framesRateFirefox)),f.receivePackets=V.packets,f.receivePacketsLost=V.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost),f.totalDuration=l?l.totalDuration+1:1,f.totalFreezeTime=l?l.totalFreezeTime:0,f.receiveDelay=V.jitterBufferMs||0;const $=!!I&&t.getRemoteVideoIsReady(I);w&&$&&fl.isRemoteVideoFreeze(w,V,u)&&(f.totalFreezeTime+=1),f.freezeRate=f.totalFreezeTime/f.totalDuration}Z&&(h.end2EndDelay=Z.B_ad,f.end2EndDelay=Z.B_vd,h.transportDelay=Z.B_ed,f.transportDelay=Z.B_ed,h.currentPacketLossRate=Z.B_ealr4/100,f.currentPacketLossRate=Z.B_evlr4/100,g.uplinkNetworkQuality=Z.B_punq?Z.B_punq:0,g.downlinkNetworkQuality=Z.B_pdnq?Z.B_pdnq:0),this.remoteStats.set(i,{audioStats:h,videoStats:f,videoPcStats:V,networkStats:g}),S&&this.exceptionMonitor.setRemoteAudioStats(S,h),w&&this.exceptionMonitor.setRemoteVideoStats(w,f)})}}function M0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function m_(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?M0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):M0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function hh(n){return n.match(/^[\.\:\d]+$/)?"".concat(n.replace(/[^\d]/g,"-"),".").concat(x("TURN_DOMAIN")):(v.info("Cannot recognized as IP address ".concat(n,". Used As Host instead")),n)}function U0(n,t){var e,i;const s=x("GATEWAY_DOMAINS");let r=s[1]&&t.indexOf(s[1])!==-1?1:0;n.addresses=n.addresses||[];const a=n.addresses.map(l=>l.domain_prefix?{address:"".concat(l.domain_prefix,".").concat(s[r++%s.length],":").concat(l.port)}:l.ip.match(/^[\.\:\d]+$/)?{ip:l.ip,port:l.port,address:"".concat(l.ip.replace(/[^\d]/g,"-"),".").concat(s[r++%s.length],":").concat(l.port)}:(v.info("Cannot recognized as IP address ".concat(l.ip,". Used As Host instead")),{ip:l.ip,port:l.port,address:"".concat(l.ip,":").concat(l.port)}));if((e=n.detail)!==null&&e!==void 0&&e[18]&&typeof((i=n.detail)===null||i===void 0?void 0:i[18])=="string"){const l=n.detail[18],u=l==null?void 0:l.split(";");for(let h=0;h<u.length;h++){var c;const f=$T(c=u[h]).call(c);a[h]&&f&&(a[h].ip6=f)}}return{gatewayAddrs:a,uid:n.uid,cid:n.cid,cert:n.cert,vid:n.detail&&n.detail[8],uni_lbs_ip:n.detail&&n.detail[1],res:n,csIp:n.detail&&n.detail[502]}}function Hs(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function E_(n){const t=n._encoderConfig;if(!t)return{};const e={resolution:t.width&&t.height?"".concat(Hs(t.width),"x").concat(Hs(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(e.maxFrameRate=t.frameRate,e.minFrameRate=t.frameRate):t.frameRate&&(e.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,e.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),e}function x0(n){const t={connectionType:0,googRtt:n.rtt};switch(n.selectedCandidatePair.localCandidate.candidateType){case"relay":{const e=n.selectedCandidatePair.localCandidate.relayProtocol;e==="udp"&&(t.connectionType=1),e==="tcp"&&(t.connectionType=3),e==="tls"&&(t.connectionType=4);break}case"srflx":t.connectionType=2}return t}function V0(n){return n>=0&&n<.17?1:n>=.17&&n<.36?2:n>=.36&&n<.59?3:n>=.59&&n<=1?4:n>1?5:0}function xS(n,t){let e,i,s;switch(t){case ti.CHOOSE_SERVER:i=4096,s="choose server";break;case ti.CLOUD_PROXY:i=1048576,s="proxy";break;case ti.CLOUD_PROXY_5:i=4194304,s="proxy5";break;case ti.CLOUD_PROXY_FALLBACK:i=4194310,s="proxy fallback";break;default:throw new G(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:n.detail&&n.detail[502],retry:!1})}if(n.response_body.forEach(r=>{r.buffer&&r.buffer.flag===i&&(e={code:r.buffer.code,addresses:(r.buffer.edges_services||[]).map(a=>m_(m_({},a),{},{ticket:r.buffer.cert})),server_ts:n.enter_ts,uid:r.buffer.uid,cid:r.buffer.cid,cname:r.buffer.cname,detail:m_(m_({},r.buffer.detail),n.detail),flag:r.buffer.flag,opid:n.opid,cert:r.buffer.cert})}),!e)throw new G(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:n.detail&&n.detail[502]});return e}async function l4(n,t){return await K.all(n.addresses.map(async e=>({address:hh(e.ip),tcpport:e.port,udpport:e.port,username:t&&x("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ks.username,password:t&&x("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await gB(t.toString()):ks.password})))}function VS(n,t){const e=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height;return e?Math.max(e/Hs(n.height),1):(v.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ka(n){let{candidateType:t,relayProtocol:e,type:i,address:s,port:r,protocol:a}=n;return i==="local-candidate"?{candidateType:t,relayProtocol:e,protocol:a}:{candidateType:t,relayProtocol:e,address:s,port:r,protocol:a}}function F0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}class u4 extends rn{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var e;Wt(e=["tryNext","recover"]).call(e,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(gn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(gn.CONNECTED):this._state==="closed"?this.emit(gn.CLOSED):this._state==="failed"&&this.emit(gn.FAILED))}constructor(t,e,i,s){super(),m(this,"connectionID",0),m(this,"currentURLIndex",0),m(this,"reconnectReason",void 0),m(this,"_reconnectMode","tryNext"),m(this,"_name",void 0),m(this,"_state","closed"),m(this,"_retryConfig",void 0),m(this,"_reconnectCount",0),m(this,"_forceCloseTimeout",5e3),m(this,"_onlineReconnectListener",void 0),m(this,"_closeEstablishingTransmitter",()=>{}),m(this,"_store",void 0),m(this,"_joinChannelServiceRecordIndex",void 0),m(this,"_useCompress",void 0),m(this,"_inflateLength",0),m(this,"_deflateLength",0),this._store=s,this._name=t,this._retryConfig=function(r){for(var a=1;a<arguments.length;a++){var c=arguments[a]!=null?arguments[a]:{};a%2?F0(Object(c),!0).forEach(function(l){m(r,l,c[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(c)):F0(Object(c)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(c,l))})}return r}({},e),this._useCompress=i}resetReconnectCount(t){v.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,e){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;e?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,e){if(!this._transmitter)return void v.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(e)]},this._joinChannelServiceRecordIndex));const s=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),s&&s.bind(this._transmitter)({code:9999,reason:e})}getInflateData(){const t=this._inflateLength,e=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:e}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var sr;(function(n){n[n.Default=0]="Default",n[n.Ack=1]="Ack"})(sr||(sr={}));class h4{constructor(t,e,i){m(this,"version",1),m(this,"initialRTO",void 0),m(this,"maxBatchAckCount",void 0),m(this,"maxRTO",void 0),m(this,"initialRTT",void 0),m(this,"ID",void 0),m(this,"rtt",void 0),m(this,"packetNumber",1),m(this,"rtoRatioMap",new Map),m(this,"timeoutMap",new Map),m(this,"unorderedPacketQueue",[]),m(this,"batchAckPacketQueue",[]),m(this,"lastOrderedPacketNumber",0),m(this,"batchAckTimer",void 0),m(this,"sendImpl",void 0),m(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=e,this.ID=Ge(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:x("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:x("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:x("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:x("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:x("TRANSMITTER_MAX_RTO")}packetize(t,e){return{type:sr.Default,version:this.version,packetNumber:e,payload:t}}serialize(t){switch(t.type){case sr.Default:{let e;typeof t.payload=="string"?e=new TextEncoder().encode(t.payload):e=t.payload;const i=new ArrayBuffer(e.length+15),s=new DataView(i);return s.setUint16(0,t.version),s.setUint8(2,t.type),s.setUint32(3,t.packetNumber),AI(s,7,BigInt(t.sendTs)),new Uint8Array(s.buffer).set(e,15),i}case sr.Ack:{const e=new ArrayBuffer(16),i=new DataView(e);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),AI(i,8,BigInt(t.ackSendTs)),e}}}deserialize(t){const e=new DataView(t),i=e.getUint16(0),s=e.getUint8(2);switch(s){case sr.Default:{const r=e.getUint32(3),a=II(e,7),c=t.slice(15),l=new TextDecoder().decode(c);return{version:i,type:s,packetNumber:r,sendTs:Number(a),payload:l}}case sr.Ack:{const r=e.getUint32(3),a=e.getUint8(7),c=II(e,8);return{version:i,type:s,maxAckPacketNumber:r,shift:a,ackSendTs:Number(c)}}default:throw v.error("[".concat(this.ID,"] Unrecognized packet type ").concat(s)),new Error("Unrecognized packet type ".concat(s))}}sendMessage(t){const e=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(e),s=window.setTimeout(()=>{this.resendMessage(e)},i);this.timeoutMap.set(e.packetNumber,s),this.sendPacket(e)}onData(t){const e=this.deserialize(t);e.type===sr.Default?this.ack(e):e.type===sr.Ack&&(this.updateRTT(e,Math.round(performance.now())),this.clearRTO(e))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[e,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const e=this.calculateRTO(t),i=window.setTimeout(()=>{this.resendMessage(t)},e);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const e=this.rtoRatioMap.get(t.packetNumber);if(e===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*e;return this.rtoRatioMap.set(t.packetNumber,e+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,e){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(e-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const e=this.unorderedPacketQueue[0];if(!e){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(e.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const e={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:sr.Ack,version:this.version};this.sendPacket(e)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const e={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:sr.Ack,version:this.version};this.sendPacket(e)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:sr.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===sr.Default&&(t.sendTs=Math.round(performance.now()));const e=this.serialize(t);this.sendImpl(e)}clearRTO(t){for(let e=t.maxAckPacketNumber-t.shift;e<=t.maxAckPacketNumber;e++){const i=this.timeoutMap.get(e);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(e),this.rtoRatioMap.delete(e)}}}class B0 extends u4{constructor(t,e){super(t,e,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),m(this,"_initMutex",void 0),m(this,"_reconnectInterrupter",void 0),m(this,"_url",void 0),m(this,"_transmitter",void 0),m(this,"_addresses",void 0),m(this,"_reliableTransmission",void 0),this._initMutex=new Zn("datachannel");const{timeout:i,timeoutFactor:s}=e,r=Math.max(300,Math.floor(3*i/5)),a=Math.max(1.2,Math.floor(8*s)/10);ki.ONLINE&&(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=a),On.on(Jo.NETWORK_STATE_CHANGE,(c,l)=>{c!==l&&(this.resetReconnectCount("network state change: ".concat(l," -> ").concat(c)),c===ki.ONLINE?(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=a):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=s))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=e;const i=(s,r)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(c=>c.fingerprint||x("FINGERPRINT"));const a=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(a).then(s).catch(r),this.once(gn.CLOSED,()=>r(new G(O.WS_DISCONNECT))),this.once(gn.CONNECTED,()=>s())};return this._initMutex.lock().then(s=>new K((r,a)=>{i(r,a)}).then(()=>{s()}).catch(()=>{s()}))}sendMessage(t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new G(O.WS_ABORT,"datachannel is not ready");try{e||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(i){throw new G(O.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const e=JSON.stringify(t);return{compressed:e,compressedLength:e.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new K((e,i)=>{var s;const r=()=>{v.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),e()},a=async h=>{var f;if((f=this._closeEstablishingTransmitter)===null||f===void 0||f.call(this),v.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(h.code,", reason: ").concat(h.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=h.reason,this.state="reconnecting");const g=_s(this,gn.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,S=await this.reconnectWithAction(g);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!S)return i(new G(O.WS_DISCONNECT,"datachannel reconnect failed: ".concat(h.code))),void this.close(!0);e()}else i(new G(O.WS_DISCONNECT,"datachannel close: ".concat(h.code))),this.close()},c=h=>{var f;(f=this._reliableTransmission)===null||f===void 0||f.onData(h.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),v.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const l=(s=this._store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),u=Date.now();hn(this,gn.TO_CONNECT_DATACHANNEL,t).then(h=>{var f,g;if(!h)throw new Error("transmissonInfo not exist yet");const{transmitter:S,close:w}=h;this._transmitter=S,(f=this._store)===null||f===void 0||f.signalChannelOpen();const b=Date.now()-u;v.debug("[choose dc] dc open cost ".concat(b,"ms")),this._reliableTransmission=new h4(I=>{var U;this._transmitter&&this._transmitter.readyState==="open"&&((U=this._transmitter)===null||U===void 0||U.send(I))},I=>{typeof I=="string"&&this.emit(gn.ON_MESSAGE,I)}),this._closeEstablishingTransmitter=()=>{var I;(I=this._reliableTransmission)===null||I===void 0||I.close(),this._reliableTransmission=void 0,w()},r&&r(),S.onclose=a,S.onmessage=c,(g=this._store)===null||g===void 0||g.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this._joinChannelServiceRecordIndex=l}).catch(h=>{var f;if((f=this._store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:h instanceof G&&h.code===O.WS_ABORT?"aborted":"error",errors:[h]},l),this.state!=="closed"){if(h instanceof G&&h.code===O.WS_ERR){const g=new G(O.WS_ERR,"init datachannel failed! Error: ".concat(h.toString()));return v.error("[".concat(this._name,"]").concat(g)),void i(g)}a&&a(h)}else i(new G(O.WS_DISCONNECT,"datachannel is closed: ".concat(h.toString())))})})}async reconnectWithAction(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||On.networkState!==ki.OFFLINE||(this._onlineReconnectListener=On.onlineWaiter&&On.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},e){const c=Nf(this._reconnectCount,this._retryConfig);v.debug("[".concat(this._name,"] wait ").concat(c,"ms to reconnect datachannel, mode: ").concat(t)),await K.race([hi(c),this._onlineReconnectListener||new K(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const s=async(c,l)=>{this.emit(gn.RECONNECT_CREATE_CONNECTION,l),await this.createTransmitterConnection(c)};try{if(t==="retry"){const c=this._addresses[this.currentURLIndex];this.emit(gn.RECONNECT_WAITTING_FINISH,t),await s(c,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let l=this.currentURLIndex;l<this._addresses.length;l++){if(this._addresses[l].fingerprint||x("FINGERPRINT")){this.currentURLIndex=l;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return v.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);v.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const c=this._addresses[this.currentURLIndex];this.emit(gn.RECONNECT_WAITTING_FINISH,t),await s(c,t)}else t==="recover"&&(v.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(gn.RECONNECT_WAITTING_FINISH,t),this.emit(gn.FAILBACK));return!0}catch(c){var r,a;return v.error("[".concat(this._name,"] reconnect failed"),c.toString()),c!=null&&(r=c.data)!==null&&r!==void 0&&r.desc&&Array.isArray(c.data.desc)&&c.data.desc.length&&Wt(a=c.data.desc).call(a,"dynamic key expired")?(this.emit(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,e)}}}class ia extends rn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ue.CONNECTED?this.emit(pt.WS_CONNECTED):t===ue.RECONNECTING?this.emit(pt.WS_RECONNECTING,this._websocketReconnectReason):t===ue.CLOSED&&this.emit(pt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),m(this,"_disconnectedReason",void 0),m(this,"_websocketReconnectReason",void 0),m(this,"_connectionState",ue.CLOSED),m(this,"reconnectToken",void 0),m(this,"websocket",void 0),m(this,"openConnectionTime",void 0),m(this,"clientId",void 0),m(this,"lastMsgTime",Date.now()),m(this,"uploadCache",[]),m(this,"uploadCacheInterval",void 0),m(this,"rttRolling",new TT(5)),m(this,"pingpongTimer",void 0),m(this,"inflateDataTimer",void 0),m(this,"pingpongTimeoutCount",0),m(this,"joinResponse",void 0),m(this,"multiIpOption",void 0),m(this,"initError",void 0),m(this,"spec",void 0),m(this,"store",void 0),m(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(pt.ON_BINARY_DATA,i);const s=JSON.parse(i);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const r="res-@".concat(s._id);this.emit(r,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===te.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===te.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close(fe.UID_BANNED);break;case 15:this.close(fe.IP_BANNED);break;case 16:this.close(fe.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new B0("gateway-".concat(this.clientId),this.spec.retryConfig,!0,e),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ue.CONNECTED&&this.reconnect("retry",mo.OFFLINE)})}async request(t,e,i,s){const r=Ge(6,""),a={_id:r,_type:t,_message:e},c=this.websocket.connectionID,l=()=>new K((w,b)=>{if(this.connectionState===ue.CONNECTED)return w();const I=()=>{this.off(pt.WS_CLOSED,U),w()},U=()=>{this.off(pt.WS_CONNECTED,I),b(new G(O.WS_ABORT))};this.once(pt.WS_CONNECTED,I),this.once(pt.WS_CLOSED,U),t!==Nt.PUBLISH&&t!==Nt.SUBSCRIBE&&t!==Nt.UNSUBSCRIBE&&t!==Nt.UNPUBLISH&&t!==Nt.CONTROL&&t!==Nt.RESTART_ICE||this.once(pt.DISCONNECT_P2P,()=>{b(new G(O.DISCONNECT_P2P))}),t!==Nt.PUBLISH&&t!==Nt.RESTART_ICE||this.once(pt.ABORT_P2P_EXECUTION,()=>{b(new G(O.DISCONNECT_P2P))})});if(this.connectionState!==ue.CONNECTING&&this.connectionState!==ue.RECONNECTING||t===Nt.JOIN||t===Nt.REJOIN||await l(),t===Nt.LEAVE&&(this.websocket.unbindDcCloseEventListener(),s=!0),this.websocket.sendMessage(a,!0,!1),s)return;const u=new K((w,b)=>{let I=!1;const U=(V,Z)=>{I=!0,w({isSuccess:V==="success",message:Z||{}}),this.off(pt.WS_CLOSED,F),this.off(pt.WS_RECONNECTING,F),this.emit(pt.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(r),U);const F=()=>{b(new G(O.WS_ABORT,"type: ".concat(t))),this.off(pt.WS_CLOSED,F),this.off(pt.WS_RECONNECTING,F),this.off("res-@".concat(r),U)};this.once(pt.WS_CLOSED,F),this.once(pt.WS_RECONNECTING,F),hi(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||I||(v.warning("dc request timeout, type: ".concat(t)),this.emit(pt.REQUEST_TIMEOUT,t,e))})});let h=null;try{h=await u}catch(w){if(this.connectionState===ue.CLOSED||t===Nt.LEAVE)throw new G(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():t===Nt.JOIN||t===Nt.REJOIN?null:(await l(),await this.request(t,e))}if(h.isSuccess)return h.message;const f=Number(h.message.error_code||h.message.code),g=Bc(f),S=new G(O.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(h.message.error_str),{code:f,data:h.message});return g.action==="success"?h.message:(v.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(f,", message: ").concat(g.desc,", action: ").concat(g.action)),f===Ft.ERR_TOO_MANY_BROADCASTERS?((t===Nt.JOIN||t===Nt.REJOIN)&&(this.initError=S,this.close()),S.throw()):g.action==="failed"?S.throw():g.action==="quit"?(this.initError=S,this.close(),S.throw()):(f===Ft.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",mo.MULTI_IP)):this.reconnect(g.action,mo.SERVER_ERROR),t===Nt.JOIN||t===Nt.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new K(i=>{const s=r=>{(!e||e(r))&&(this.off(t,s),i(r))};this.on(t,s)})}upload(t,e){const i={_type:t,_message:e};try{this.websocket.sendMessage(i)}catch{const r=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ue.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const i={_type:t,_message:e};this.websocket.sendMessage(i)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new K((i,s)=>{this.once(pt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(pt.WS_CLOSED,()=>s(this.initError||new G(O.WS_ABORT))),this.connectionState=ue.CONNECTING,this.websocket.init(t).catch(s),this.websocket.once(gn.FAILBACK,()=>{this.openConnectionTime===void 0&&s(new G(O.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{e&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new G(O.INIT_DATACHANNEL_TIMEOUT)))},x("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||fe.LEAVE,this.connectionState=ue.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===fe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new B0("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(pt.ABORT_P2P_EXECUTION);const t=await hn(this,pt.DATACHANNEL_CONNECTING),e=await this.request(Nt.JOIN,t);if(!e)return this.emit(pt.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(pt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ue.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new G(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Xo(this,pt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const e=await this.request(Nt.REJOIN,t);return!!e&&(this.connectionState=ue.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),e.peers&&e.peers.forEach(i=>{this.emit(te.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(te.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(te.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(te.MUTE_AUDIO,{uid:i.uid}):this.emit(te.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(te.MUTE_VIDEO,{uid:i.uid}):this.emit(te.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(te.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(te.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(te.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(te.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(te.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const e=Bc(t.code);if(e.action!=="success"){if(e.action!=="failed")return e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(fe.UID_BANNED),void this.close()):void this.reconnect(e.action,mo.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=x("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("PINGPONG Timeout. Last Socket Message: ".concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",mo.TIMEOUT):this.request(Nt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-e;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(Nt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:e}=this.websocket.getInflateData();t!==0&&e!==0&&this.upload(as.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(gn.RECONNECT_WAITTING_FINISH,t=>{this.emit(pt.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(gn.RECONNECT_CREATE_CONNECTION,t=>{this.emit(pt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(gn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(gn.CLOSED,()=>{this.connectionState=ue.CLOSED}),this.websocket.on(gn.FAILED,()=>{this._disconnectedReason=fe.NETWORK_ERROR,this.connectionState=ue.CLOSED}),this.websocket.on(gn.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ue.CONNECTED?this.connectionState=ue.RECONNECTING:this.connectionState=ue.CONNECTING}),this.websocket.on(gn.WILL_RECONNECT,(t,e)=>{if(Xo(this,pt.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(pt.NEED_RENEW_SESSION),this.emit(pt.DISCONNECT_P2P),e("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(pt.NEED_RENEW_SESSION),this.emit(pt.DISCONNECT_P2P)),e(t)}),this.websocket.on(gn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",mo.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(pt.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof G&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ft.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",mo.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",mo.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(gn.REQUEST_NEW_URLS,(t,e)=>{hn(this,pt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)}),this.websocket.on(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(te.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(gn.TO_CONNECT_DATACHANNEL,async(t,e,i)=>hn(this,pt.DATACHANNEL_PRECONNECT,t).then(e).catch(i)),this.websocket.on(gn.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(pt.DATACHANNEL_FAILBACK)})}}class g_ extends rn{constructor(t){super(),m(this,"_signal",void 0),m(this,"_sequence",0),m(this,"_userMap",new Map),m(this,"_encoder",new TextEncoder),this._signal=t}async send(t,e,i,s,r){var a,c,l;typeof e!="string"&&(e=JSON.stringify(e)),s=(a=s)!==null&&a!==void 0?a:Ge(6,""),r=(c=r)!==null&&c!==void 0?c:this._sequence++;const u={_id:s,_type:t,_seq:(l=r)!==null&&l!==void 0?l:this._sequence++,_message:e};if(x("SHOW_P2P_LOG")&&v.debug("send message",u),this.sendStreamMessage(JSON.stringify(u)),i)return;const h=new K((g,S)=>{const w=window.setTimeout(()=>{this.off("res-@".concat(s),b),v.warning("[external-signal] request timeout, type: ".concat(t)),this._userMap.size===0?S(new Q(O.INVALID_REMOTE_USER)):S(new Q(O.TIMEOUT))},x("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),b=(I,U)=>{w&&window.clearTimeout(w),I==="success"?g({isSuccess:!0,message:U}):S(new Q(O.UNEXPECTED_ERROR,U))};this.once("res-@".concat(s),b)});let f;try{f=await h}catch(g){if(g.code===O.TIMEOUT)return await this.send(t,e,!1,s,r);throw g}return f.isSuccess?f.message:void 0}sendStreamMessage(t){this._splitMessage(t).forEach(e=>{this._signal.request(Nt.DATA_STREAM,{payload:Af(this._encoder.encode(e))})})}onMessage(t){const{_uid:e}=t;let i;const s=this._userMap.get(e);if(s?i=s.splitMessageMap:(i=new Map,this._userMap.set(e,{isStart:!1,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in t&&"total"in t){var r;const{id:a,total:c}=t,l=(r=i.get(a))!==null&&r!==void 0?r:[];if(l.push(t),i.has(a)||i.set(a,l),l.length!==c)return;{const u=Ou(l).call(l,(h,f)=>h.index-f.index).map(h=>h.payload).join("");i.delete(a),(t=JSON.parse(u))._uid=e}}this.handleReceivedMessage(t)}setStart(t){this._userMap.has(t)?this._userMap.get(t).isStart=!0:this._userMap.set(t,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(t){return this._userMap.delete(t),this._userMap.size===0}ack(t,e,i){this.send(Xe.ACK,JSON.stringify({success:!i,message:e}),!0,t)}handleReceivedMessage(t){const e=()=>{this._userMap.forEach(u=>{const{receivedMessagesMap:h,nextExpectedSequenceNumber:f}=u;for(;h.has(f);){const g=h.get(f);h.delete(f),this.receiveMessage(g),u.nextExpectedSequenceNumber++}})};if(!t)return void e();const{_uid:i,_seq:s}=t,r=this._userMap.get(i),{receivedMessagesMap:a,isStart:c,nextExpectedSequenceNumber:l}=r;s<l?v.debug("[external-signal] receive old message, seq: ".concat(s)):(a.set(s,t),c&&s===l&&(this.receiveMessage(t),a.delete(l),r.nextExpectedSequenceNumber++,e()))}receiveMessage(t){const{_id:e,_type:i,_message:s,_uid:r}=t;if(x("SHOW_P2P_LOG")&&v.debug("收到消息",t),e)switch(t._type){case Xe.PUBLISH:const a=JSON.parse(s);this._signal.emit(i,a,r),this.ack(t._id);break;case Xe.CONTROL:case Xe.UNPUBLISH:case Xe.DO_SUBSCRIBE:case Xe.DO_UNSUBSCRIBE:{const c=JSON.parse(s);c.uid=r,hn(this._signal,i,c).then(l=>{this.ack(t._id,l)}).catch(l=>{this.ack(t._id,void 0,!0)});break}case Xe.ACK:{const{success:c,message:l}=JSON.parse(s);this.emit("res-@".concat(e),c?"success":"failed",l);break}case Xe.CALL:hn(this,i,s).then(c=>{this.ack(e,c)});break;case Xe.RESTART_ICE:case Xe.EXCHANGE_SDP:case Xe.SUBSCRIBE:case Xe.UNSUBSCRIBE:hn(this._signal,i,s).then(c=>{this.ack(e,c)}).catch(c=>{this.ack(t._id,void 0,!0)});break;case Xe.CANDIDATE:this._signal.emit(i,s),this.ack(e);break;case Xe.JOIN:this.emit(i,JSON.parse(s));break;default:this.emit(i,s),this.ack(e)}}_splitMessage(t){if(t.length<g_.MAX_MESSAGE_SIZE)return[t];const e=[],i=Ge(6,"");let s=0;const r=Math.ceil(t.length/800);for(;t.length>0;){s++;const a=t.slice(0,800);e.push({id:i,index:s,total:r,payload:a}),t=t.slice(800)}return e.map(a=>JSON.stringify(a))}clear(){this._sequence=0,this._userMap.clear()}}m(g_,"MAX_MESSAGE_SIZE",1024);class j0 extends rn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ue.CONNECTED?this.emit(pt.WS_CONNECTED):t===ue.RECONNECTING?this.emit(pt.WS_RECONNECTING,this._websocketReconnectReason):t===ue.CLOSED&&this.emit(pt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),m(this,"_disconnectedReason",void 0),m(this,"_websocketReconnectReason",void 0),m(this,"_connectionState",ue.CLOSED),m(this,"reconnectToken",void 0),m(this,"_userInRoom",!1),m(this,"_userOnlineTime",void 0),m(this,"websocket",void 0),m(this,"openConnectionTime",void 0),m(this,"clientId",void 0),m(this,"lastMsgTime",Date.now()),m(this,"uploadCache",[]),m(this,"uploadCacheInterval",void 0),m(this,"rttRolling",new TT(5)),m(this,"pingpongTimer",void 0),m(this,"wsInflateDataTimer",void 0),m(this,"pingpongTimeoutCount",0),m(this,"joinResponse",void 0),m(this,"multiIpOption",void 0),m(this,"initError",void 0),m(this,"spec",void 0),m(this,"store",void 0),m(this,"_external_signal",void 0),m(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(pt.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const r="res-@".concat(s._id);this.emit(r,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case te.ON_DATA_STREAM:return void this.handleDataStream(s._message);case te.MUTE_AUDIO:case te.MUTE_VIDEO:case te.ON_P2P_LOST:return;case te.ON_USER_ONLINE:this.emit(s._type,s._message);const{uid:r}=s._message;return this._external_signal.setStart(r),void this._external_signal.send(Xe.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(s._type,s._message),s._type===te.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===te.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(fe.UID_BANNED);break;case 15:this.close(fe.IP_BANNED);break;case 16:this.close(fe.CHANNEL_BANNED)}if(s._type===te.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Ft.ERR_LICENSE_MISSING:this.close(fe.LICENSE_MISSING);break;case Ft.ERR_LICENSE_EXPIRED:this.close(fe.LICENSE_EXPIRED);break;case Ft.ERR_LICENSE_MINUTES_EXCEEDED:this.close(fe.LICENSE_MINUTES_EXCEEDED);break;case Ft.ERR_LICENSE_PERIOD_INVALID:this.close(fe.LICENSE_PERIOD_INVALID);break;case Ft.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(fe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ft.ERR_LICENSE_ILLEGAL:this.close(fe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new qu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),e),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ue.CONNECTED&&this.reconnect("retry",qn.OFFLINE)}),this._external_signal=new g_(this),this._handleSignalP2PEvents()}async request(t,e,i,s){const r=Ge(6,""),a={_id:r,_type:t,_message:e},c=this.websocket.connectionID,l=()=>new K((w,b)=>{if(this.connectionState===ue.CONNECTED)return w();const I=()=>{this.off(pt.WS_CLOSED,U),w()},U=()=>{this.off(pt.WS_CONNECTED,I),b(new Q(O.WS_ABORT))};this.once(pt.WS_CONNECTED,I),this.once(pt.WS_CLOSED,U),t!==Nt.PUBLISH&&t!==Nt.SUBSCRIBE&&t!==Nt.UNSUBSCRIBE&&t!==Nt.UNPUBLISH&&t!==Nt.CONTROL&&t!==Nt.RESTART_ICE||this.once(pt.DISCONNECT_P2P,()=>{b(new Q(O.DISCONNECT_P2P))}),t!==Nt.PUBLISH&&t!==Nt.RESTART_ICE||this.once(pt.ABORT_P2P_EXECUTION,()=>{b(new Q(O.DISCONNECT_P2P))})});if(this.connectionState!==ue.CONNECTING&&this.connectionState!==ue.RECONNECTING||t===Nt.JOIN||t===Nt.REJOIN||await l(),this.websocket.sendMessage(a,!0),s)return;const u=new K((w,b)=>{let I=!1;const U=(V,Z)=>{I=!0,w({isSuccess:V==="success",message:Z||{}}),this.off(pt.WS_CLOSED,F),this.off(pt.WS_RECONNECTING,F),this.emit(pt.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(r),U);const F=()=>{b(new Q(O.WS_ABORT,"type: ".concat(t))),this.off(pt.WS_CLOSED,F),this.off(pt.WS_RECONNECTING,F),this.off("res-@".concat(r),U)};this.once(pt.WS_CLOSED,F),this.once(pt.WS_RECONNECTING,F),hi(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||I||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(pt.REQUEST_TIMEOUT,t,e))})});let h=null;try{h=await u}catch(w){if(this.connectionState===ue.CLOSED||t===Nt.LEAVE)throw new Q(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():t===Nt.JOIN||t===Nt.REJOIN?null:(await l(),await this.request(t,e))}if(h.isSuccess)return h.message;const f=Number(h.message.error_code||h.message.code),g=Bc(f),S=new Q(O.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(h.message.error_str),{code:f,data:h.message});return g.action==="success"?h.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(f,", message: ").concat(g.desc,", action: ").concat(g.action)),f===Ft.ERR_TOO_MANY_BROADCASTERS?((t===Nt.JOIN||t===Nt.REJOIN)&&(this.initError=S,this.close()),S.throw()):g.action==="failed"?S.throw():g.action==="quit"?(this.initError=S,this.close(),S.throw()):(f===Ft.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",qn.MULTI_IP)):this.reconnect(g.action,qn.SERVER_ERROR),t===Nt.JOIN||t===Nt.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new K(i=>{const s=r=>{(!e||e(r))&&(this.off(t,s),i(r))};this.on(t,s)})}upload(t,e){const i={_type:t,_message:e};try{this.websocket.sendMessage(i)}catch{const r=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ue.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const i={_type:t,_message:e};this.websocket.sendMessage(i)}async sendExtensionMessage(t,e,i){return await this.waitTillUserOnline(),await this._external_signal.send(t,e,i)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new K((i,s)=>{this.once(pt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(pt.WS_CLOSED,()=>s(this.initError||new Q(O.WS_ABORT))),this.connectionState=ue.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||fe.LEAVE,this.connectionState=ue.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===fe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new qu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(pt.ABORT_P2P_EXECUTION);const t=await hn(this,pt.REQUEST_JOIN_INFO),e=await this.request(Nt.JOIN,t);if(!e)return this.emit(pt.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(pt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ue.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),this._userOnlineTime=new Date().getTime(),this._external_signal.clear(),!0}async rejoin(){if(!this.reconnectToken)throw new Q(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Xo(this,pt.REQUEST_REJOIN_INFO);return t.token=this.reconnectToken,!!await this.request(Nt.REJOIN,t)&&(this.connectionState=ue.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleDataStream(t){try{var e;const i=If(t.payload),s=new TextDecoder().decode(i),r=JSON.parse(s);"total"in r&&"id"in r||Wt(e=Object.values(Xe)).call(e,r._type)?(t.seq&&delete t.seq,r._uid=t.uid,this._external_signal.onMessage(r)):this.emit(te.ON_DATA_STREAM,t)}catch{}}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const e=Bc(t.code);if(e.action!=="success"){if(e.action!=="failed")return e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(fe.UID_BANNED),void this.close()):void this.reconnect(e.action,qn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=x("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",qn.TIMEOUT):this.request(Nt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-e;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(Nt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:e}=this.websocket.getWsInflateData();t!==0&&e!==0&&this.upload(as.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Jt.RECONNECT_WAITTING_FINISH,t=>{this.emit(pt.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Jt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(pt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Jt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Jt.CLOSED,()=>{this.connectionState=ue.CLOSED}),this.websocket.on(Jt.FAILED,()=>{this._disconnectedReason=fe.NETWORK_ERROR,this.connectionState=ue.CLOSED}),this.websocket.on(Jt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ue.CONNECTED?this.connectionState=ue.RECONNECTING:this.connectionState=ue.CONNECTING}),this.websocket.on(Jt.WILL_RECONNECT,(t,e,i)=>{if(Xo(this,pt.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(pt.NEED_RENEW_SESSION),this.emit(pt.DISCONNECT_P2P),i("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(pt.NEED_RENEW_SESSION),this.emit(pt.DISCONNECT_P2P)),i(t)}),this.websocket.on(Jt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",qn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(pt.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof Q&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ft.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",qn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",qn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Jt.REQUEST_NEW_URLS,(t,e)=>{hn(this,pt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)}),this.websocket.on(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(te.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){this._external_signal.on(Xe.JOIN,async t=>{if(this._userOnlineTime&&this._userOnlineTime<t.onlineTime){const e=await hn(this,pt.P2P_START,void 0),i=await this._external_signal.send(Xe.CALL,e);this.emit(pt.P2P_CONNECTION,i,!0)}this._userInRoom=!0,this.emit("user-online")}),this.on(te.ON_USER_OFFLINE,async t=>{this._external_signal.clear(),this._userInRoom=!1}),this._external_signal.on(Xe.CALL,async(t,e,i)=>{this._userInRoom=!0,this.emit("user-online");try{e(await hn(this,pt.P2P_START,t))}catch(s){i(s)}})}async waitTillUserOnline(){return new K(t=>{if(this._userInRoom)t();else{const e=()=>{this.off("user-online",e),t()};this.on("user-online",e)}})}}function G0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Ar(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?G0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):G0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}const FS=new Map;class p4 extends rn{get state(){return this._state}set state(t){if(t===this._state)return;const e=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(fn.CONNECTION_STATE_CHANGE,t,e,this._disconnectedReason):this.emit(fn.CONNECTION_STATE_CHANGE,t,e)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){v.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,e){super(),m(this,"store",void 0),m(this,"joinInfo",void 0),m(this,"key",void 0),m(this,"ntpOffset",0),m(this,"signal",void 0),m(this,"role",void 0),m(this,"inChannelInfo",{joinAt:null,duration:0}),m(this,"spec",void 0),m(this,"_state","DISCONNECTED"),m(this,"_statsCollector",void 0),m(this,"_disconnectedReason",void 0),m(this,"isSignalRecover",!1),m(this,"hasChangeBGPAddress",!1),m(this,"trafficStatsInterval",void 0),m(this,"networkQualityInterval",void 0),m(this,"_joinGatewayStartTime",0),m(this,"_signalTimeout",!1),m(this,"_clientRoleOptions",void 0),m(this,"_isProactiveJoin",!1),this.store=t,this.spec=e,this.signal=this.store.useP2P?new j0(Ar(Ar({},e),{},{retryConfig:e.websocketRetryConfig}),t):this.store.useDataChannel?new ia(Ar(Ar({},e),{},{retryConfig:e.websocketRetryConfig}),t):new ow(Ar(Ar({},e),{},{retryConfig:e.websocketRetryConfig}),t),this._statsCollector=e.statsCollector,this.role=e.role||"audience",this._clientRoleOptions=e.clientRoleOptions,this.handleSignalEvents()}async join(t,e,i){if(this.signal instanceof ia){let l=!1;t.cloudProxyServer!=="disabled"?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),l=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),l=!0):t.apResponse.addresses.some(u=>u.fingerprint)||x("FINGERPRINT")||(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),l=!0),l&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let r=FS.get(t.cname);if(r||(r=new Map,FS.set(t.cname,r)),this._isProactiveJoin=!0,r.has(t.uid)){const l=new G(O.UID_CONFLICT);throw Dt.joinGateway(t.sid,{lts:s,succ:!1,ec:l.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof ia?"1":"0"}),this._isProactiveJoin=!1,l}r.set(t.uid,!0),this.joinInfo=t,this.key=e;let a=0;this.joinGatewayStartTime=s;const c=t.proxyServer;try{let l;if(v.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof ia?"datachannel":"websocket"," join uid ").concat(a)),this.signal instanceof ia)l=await this.signal.init(t.apResponse.addresses,i);else{const u=t.gatewayAddrs.map(h=>{let{address:f}=h;const[g,S]=f.split(":"),w={host:g,port:S};return t.proxyServer&&(w.proxy=t.proxyServer),w});l=await this.signal.init(u,i)}a=l.uid,v.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof ia?"datachannel":"websocket"," join uid ").concat(a," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(l){throw l&&l.code===O.INIT_WEBSOCKET_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join failed"),l.toString()),l):l&&l.code===O.INIT_DATACHANNEL_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join datachannel failed"),l.toString()),this.resetSignal(),l):(v.error("[".concat(this.store.clientId,"] User join failed"),l.toString()),Dt.joinGateway(t.sid,{lts:s,succ:!1,ec:l.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!c,signalChannel:this.signal instanceof ia?"1":"0"}),this._isProactiveJoin=!1,r.delete(t.uid),this.signal.close(),l)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),v.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(l=>{v.warning("[".concat(this.store.clientId,"] get traffic stats error"),l.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(fn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(fn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(fn.NETWORK_QUALITY,{uplinkNetworkQuality:V0(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:V0(this._statsCollector.trafficStats.B_dnq)}):this.emit(fn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),a}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){e!==fe.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==ue.CONNECTED||await function(i,s){return s===1/0?i:K.race([i,TB(s)])}(this.signal.request(Nt.LEAVE,void 0,!0),3e3)}catch(i){v.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(e),e!==fe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,e,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:e,mode:this.spec.mode,extend:x("PUB_EXTEND"),twcc:!!x("PUBLISH_TWCC"),rtx:!!x("USE_PUB_RTX")};try{return(await this.signal.request(Nt.PUBLISH,s,!0))._message}catch(r){if(i&&r.data&&r.data.code===Ft.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(t,e),this.publish(t,e,!1);throw r}}async publishDataChannel(t,e,i){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={stream_id:e.streamId,ordered:e.ordered?1:0,max_retrans_times:(s=e.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:e.channelId,metadata:e.metadata};try{await this.signal.request(Nt.PUBLISH_DATASTREAM,r,!0)}catch(a){if(i&&a.data&&a.data.code===Ft.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),a.toString()),await this.tryUnpubDataChannelBeforeRepub(t,e),this.publishDataChannel(t,e,!1);throw a}}async unpublish(t,e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Nt.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await K.all(t.map(e=>this.signal.request(Nt.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){v.warning("unpublish datachannels warning: ",e)}}async subscribe(t,e,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:e.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!x("SUBSCRIBE_TWCC"),rtx:!!x("USE_SUB_RTX"),extend:x("SUB_EXTEND"),ssrcId:e.ssrcId,svc:Array.isArray(x("SVC"))&&x("SVC").length!==0?x("SVC"):void 0};try{return(await this.signal.request(Nt.SUBSCRIBE,s,!0))._message}catch(r){if(i&&r.data&&r.data.code===Ft.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(t,e),await this.subscribe(t,e,!1);throw r}}async subscribeDataChannel(t,e,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:t,stream_id:e.id,channel_id:e.datachannelId};try{return void await this.signal.request(Nt.SUBSCRIBE_DATASTREAM,s,!0)}catch(r){if(i&&r.data&&r.data.code===Ft.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),r.toString()),await this.tryUnsubDataChannelBeforeResub(t,e),await this.subscribeDataChannel(t,e,!1);throw r}}async subscribeAll(t,e){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!x("USE_SUB_RTX")};try{return await this.signal.request(Nt.SUBSCRIBE_STREAMS,i,!0)}catch(s){if(e&&s.data&&s.data.code===Ft.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw s}}async setVideoProfile(t){const e=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let s=i.frameRate,r=i.width,a=i.height,c=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(c=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,s||(c=!1)),c?{stream_type:0,width:r,height:a,fps:s,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(e)return this.signal.request(Nt.SET_VIDEO_PROFILE,e);v.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,e){try{await this.signal.request(Nt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:e},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await K.all(t.map(i=>this.signal.request(Nt.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:e},!0)))}catch(i){v.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(Nt.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){v.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(t){const{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(Nt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Nt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Nt.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,e){if(e&&(this._clientRoleOptions=Object.assign({},e)),this.state!=="CONNECTED")return void(this.role=t);let i,s=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(Nt.SET_CLIENT_ROLE,{role:t,level:s,delay:i,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,e){await this.signal.request(Nt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:e})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Nt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,e){await this.signal.request(Nt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:e})}async pickSVCLayer(t,e){await this.signal.request(Nt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:e.spatialLayer,temporal_layer:e.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Nt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,e,i){if(this.signal instanceof j0)return this.signal.sendExtensionMessage(t,e,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Ar({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Nt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=FS.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(e){let i;return i=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:ks.username,password:ks.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Ar(Ar({},ks),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Nt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(e=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===e.peer_uid);i&&i.B_st!==e.B_st&&vr(()=>{this.emit(fn.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new G(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const e=Object.assign({},this.joinInfo.apResponse);let i=x("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const s=Ar({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Zs,browser:navigator.userAgent,process_id:x("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:e,extend:x("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:x("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:x("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof x("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?x("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof x("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?x("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof x("ENABLE_USER_LICENSE_CHECK")=="boolean"?x("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:x("USE_PUB_RTX")===!0||x("USE_SUB_RTX")===!0||void 0,disableFEC:x("DISABLE_FEC"),enableNTPReport:!!x("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!x("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof x("ENABLE_DATASTREAM_2")=="boolean"?x("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof x("RTM2_FLAG")=="number"?x("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!x("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof x("USE_XR")=="boolean"?x("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,x("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),e.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=e.addresses[this.signal.websocket.currentURLIndex].ticket,delete e.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s.default_video_stream=this.joinInfo.defaultVideoStream),s}getRejoinMessage(){if(!this.joinInfo)throw new G(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(pt.WS_RECONNECT_WAITTING_FINISH,t=>{var e;Wt(e=["tryNext","recover"]).call(e,t)&&this.joinInfo&&Dt.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(pt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(pt.WS_RECONNECTING,t=>{this.joinInfo&&Dt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||qn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Dt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(pt.WS_CLOSED,t=>{let e;switch(t){case fe.LEAVE:e=qn.LEAVE;break;case fe.UID_BANNED:case fe.IP_BANNED:case fe.CHANNEL_BANNED:case fe.SERVER_ERROR:e=qn.SERVER_ERROR;break;case fe.FALLBACK:e=qn.FALLBACK;break;case fe.LICENSE_MISSING:case fe.LICENSE_EXPIRED:case fe.LICENSE_MINUTES_EXCEEDED:case fe.LICENSE_PERIOD_INVALID:case fe.LICENSE_MULTIPLE_SDK_SERVICE:case fe.LICENSE_ILLEGAL:case fe.TOKEN_EXPIRE:e=t;break;default:e=qn.NETWORK_ERROR}v.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(e||"undefined -> "+qn.NETWORK_ERROR)),this.joinInfo&&Dt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===fe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e}),this._disconnectedReason=t,t!==fe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(pt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(v.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Dt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ia?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void v.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));We("EVENT_REPORT_DOMAIN",t[1]),We("EVENT_REPORT_BACKUP_DOMAIN",t[1]),We("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(te.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(pt.REQUEST_RECOVER,(t,e,i)=>{if(!this.joinInfo)return i(new G(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,hn(this,fn.REQUEST_NEW_GATEWAY_LIST).then(e).catch(i)}),this.signal.on(pt.REQUEST_JOIN_INFO,async t=>{var e;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const{iceParameters:i,dtlsParameters:s,rtpCapabilities:r}=await hn(this,fn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(e=this.joinInfo)===null||e===void 0?void 0:e.turnServer});t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:r,version:"2"}}))}),this.signal.on(pt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(pt.REPORT_JOIN_GATEWAY,(t,e)=>{this.joinInfo&&(Dt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:e,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ia?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(pt.IS_P2P_DISCONNECTED,t=>{t(Xo(this,fn.IS_P2P_DISCONNECTED))}),this.signal.on(pt.DISCONNECT_P2P,()=>{this.emit(fn.DISCONNECT_P2P)}),this.signal.on(pt.NEED_RENEW_SESSION,()=>{this.emit(fn.NEED_RENEW_SESSION)}),this.signal.on(pt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(pt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(pt.JOIN_RESPONSE,t=>{const e=this.getCurrentGatewayAddress();this.emit(fn.JOIN_RESPONSE,t,e)}),this.signal.on(pt.DATACHANNEL_PRECONNECT,async(t,e,i)=>{this.updateTurnConfigFromSignal();const s=this.getCurrentGatewayAddress();return hn(this,fn.DATACHANNEL_PRECONNECT,t,s).then(e).catch(i)}),this.signal.on(pt.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}=await hn(this,fn.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:e,dtlsParameters:i,rtpCapabilities:s,version:"2"}}))}),this.signal.on(pt.DATACHANNEL_FAILBACK,()=>{v.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(fn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,e){try{await this.signal.request(Nt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[e]},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,e){try{await this.signal.request(Nt.UNSUBSCRIBE,{stream_id:e.id},!0)}catch(i){throw v.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,e){try{await this.signal.request(Nt.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,e){try{await this.signal.request(Nt.UNPUBLISH_DATASTREAM,{channnel_id:e.channelId},!0)}catch(i){throw v.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const e={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Nt.UNSUBSCRIBE_STREAMS,e,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,e){const i={action:t.find(s=>s.stream_type===xe.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(Nt.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(t,e){const i={action:t.find(s=>s.stream_type===xe.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(Nt.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(t,e){const i={action:t===bt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:e};try{await this.signal.request(Nt.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(t,e){const i={action:t===bt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:e};try{await this.signal.request(Nt.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadStats(t,e){this.signal.upload(t,e)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const e={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Nt.RESTART_ICE,e,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,qn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!x("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Nt.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(fe.FALLBACK)),this.store.useDataChannel=!1,this.signal=new ow(Ar(Ar({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(fn.RESET_SIGNAL,Gf.websocket)}}let T_=0,BS=0;function sa(n,t,e,i){return new K((s,r)=>{t.timeout=t.timeout||x("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!e?(t.data=JSON.stringify(t.data),T_+=fo(t.data)):e&&(t.data.size?T_+=t.data.size:t.data instanceof FormData?T_+=UI(t.data):T_+=fo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=n,rs.request(t).then(a=>{typeof a.data=="string"?BS+=fo(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?BS+=a.data.byteLength:BS+=fo(JSON.stringify(a.data)),i&&s({data:a.data,headers:a.headers}),s(a.data)}).catch(a=>{rs.isCancel(a)?r(new G(O.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?r(new G(O.NETWORK_TIMEOUT,a.message)):a.response?r(new G(O.NETWORK_RESPONSE_ERROR,a.response.status)):r(new G(O.NETWORK_ERROR,a.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var n;function t(it){var dt=0;return function(){return dt<it.length?{done:!1,value:it[dt++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(it,dt,Rt){return it==Array.prototype||it==Object.prototype||(it[dt]=Rt.value),it},i,s=function(it){it=[typeof globalThis=="object"&&globalThis,it,typeof window=="object"&&window,typeof self=="object"&&self,typeof z=="object"&&z];for(var dt=0;dt<it.length;++dt){var Rt=it[dt];if(Rt&&Rt.Math==Math)return Rt}throw Error("Cannot find global object")}(this);function r(it,dt){if(dt)t:{var Rt=s;it=it.split(".");for(var $t=0;$t<it.length-1;$t++){var Ae=it[$t];if(!(Ae in Rt))break t;Rt=Rt[Ae]}(dt=dt($t=Rt[it=it[it.length-1]]))!=$t&&dt!=null&&e(Rt,it,{configurable:!0,writable:!0,value:dt})}}function a(it){return(it={next:it})[Symbol.iterator]=function(){return this},it}function c(it){var dt=typeof Symbol<"u"&&Symbol.iterator&&it[Symbol.iterator];return dt?dt.call(it):{next:t(it)}}if(r("Symbol",function(it){function dt(Ae,ht){this.A=Ae,e(this,"description",{configurable:!0,writable:!0,value:ht})}if(it)return it;dt.prototype.toString=function(){return this.A};var Rt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",$t=0;return function Ae(ht){if(this instanceof Ae)throw new TypeError("Symbol is not a constructor");return new dt(Rt+(ht||"")+"_"+$t++,ht)}}),r("Symbol.iterator",function(it){if(it)return it;it=Symbol("Symbol.iterator");for(var dt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Rt=0;Rt<dt.length;Rt++){var $t=s[dt[Rt]];typeof $t=="function"&&typeof $t.prototype[it]!="function"&&e($t.prototype,it,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return it}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var l;t:{var u={};try{u.__proto__={a:!0},l=u.a;break t}catch{}l=!1}i=l?function(it,dt){if(it.__proto__=dt,it.__proto__!==dt)throw new TypeError(it+" is not extensible");return it}:null}var h=i;function f(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function g(it){if(it.m)throw new TypeError("Generator is already running");it.m=!0}function S(it,dt){return it.h=3,{value:dt}}function w(it){this.g=new f,this.G=it}function b(it,dt,Rt,$t){try{var Ae=dt.call(it.g.j,Rt);if(!(Ae instanceof Object))throw new TypeError("Iterator result "+Ae+" is not an object");if(!Ae.done)return it.g.m=!1,Ae;var ht=Ae.value}catch(C){return it.g.j=null,it.g.s(C),I(it)}return it.g.j=null,$t.call(it.g,ht),I(it)}function I(it){for(;it.g.h;)try{var dt=it.G(it.g);if(dt)return it.g.m=!1,{value:dt.value,done:!1}}catch(Rt){it.g.v=void 0,it.g.s(Rt)}if(it.g.m=!1,it.g.l){if(dt=it.g.l,it.g.l=null,dt.F)throw dt.D;return{value:dt.return,done:!0}}return{value:void 0,done:!0}}function U(it){this.next=function(dt){return it.o(dt)},this.throw=function(dt){return it.s(dt)},this.return=function(dt){return function(Rt,$t){g(Rt.g);var Ae=Rt.g.j;return Ae?b(Rt,"return"in Ae?Ae.return:function(ht){return{value:ht,done:!0}},$t,Rt.g.return):(Rt.g.return($t),I(Rt))}(it,dt)},this[Symbol.iterator]=function(){return this}}function F(it,dt){return dt=new U(new w(dt)),h&&it.prototype&&h(dt,it.prototype),dt}if(f.prototype.o=function(it){this.v=it},f.prototype.s=function(it){this.l={D:it,F:!0},this.h=this.C||this.u},f.prototype.return=function(it){this.l={return:it},this.h=this.u},w.prototype.o=function(it){return g(this.g),this.g.j?b(this,this.g.j.next,it,this.g.o):(this.g.o(it),I(this))},w.prototype.s=function(it){return g(this.g),this.g.j?b(this,this.g.j.throw,it,this.g.o):(this.g.s(it),I(this))},r("Array.prototype.entries",function(it){return it||function(){return function(dt,Rt){dt instanceof String&&(dt+="");var $t=0,Ae=!1,ht={next:function(){if(!Ae&&$t<dt.length){var C=$t++;return{value:Rt(C,dt[C]),done:!1}}return Ae=!0,{done:!0,value:void 0}}};return ht[Symbol.iterator]=function(){return ht},ht}(this,function(dt,Rt){return[dt,Rt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var V=function(it,dt){for(var Rt=0;Rt<it.length;Rt++)dt(it[Rt])},Z=function(it){return it.replace(/\r?\n|\r/g,`\r
`)},$=function(it,dt,Rt){return dt instanceof Blob?(Rt=Rt!==void 0?Rt+"":typeof dt.name=="string"?dt.name:"blob",dt.name===Rt&&Object.prototype.toString.call(dt)!=="[object Blob]"||(dt=new File([dt],Rt)),[String(it),dt]):[String(it),String(dt)]},W=function(it,dt){if(it.length<dt)throw new TypeError(dt+" argument required, but only "+it.length+" present.")},Y=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,nt=Y.FormData,mt=Y.XMLHttpRequest&&Y.XMLHttpRequest.prototype.send,ut=Y.Request&&Y.fetch,ee=Y.navigator&&Y.navigator.sendBeacon,Te=Y.Element&&Y.Element.prototype,be=Y.Symbol&&Symbol.toStringTag;be&&(Blob.prototype[be]||(Blob.prototype[be]="Blob"),"File"in Y&&!File.prototype[be]&&(File.prototype[be]="File"));try{new File([],"")}catch{Y.File=function(dt,Rt,$t){return dt=new Blob(dt,$t||{}),Object.defineProperties(dt,{name:{value:Rt},lastModified:{value:+($t&&$t.lastModified!==void 0?new Date($t.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),be&&Object.defineProperty(dt,be,{value:"File"}),dt}}var Fe=function(it){return it.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},_e=function(it){this.i=[];var dt=this;it&&V(it.elements,function(Rt){if(Rt.name&&!Rt.disabled&&Rt.type!=="submit"&&Rt.type!=="button"&&!Rt.matches("form fieldset[disabled] *"))if(Rt.type==="file"){var $t=Rt.files&&Rt.files.length?Rt.files:[new File([],"",{type:"application/octet-stream"})];V($t,function(Ae){dt.append(Rt.name,Ae)})}else Rt.type==="select-multiple"||Rt.type==="select-one"?V(Rt.options,function(Ae){!Ae.disabled&&Ae.selected&&dt.append(Rt.name,Ae.value)}):Rt.type==="checkbox"||Rt.type==="radio"?Rt.checked&&dt.append(Rt.name,Rt.value):($t=Rt.type==="textarea"?Z(Rt.value):Rt.value,dt.append(Rt.name,$t))})};if((n=_e.prototype).append=function(it,dt,Rt){W(arguments,2),this.i.push($(it,dt,Rt))},n.delete=function(it){W(arguments,1);var dt=[];it=String(it),V(this.i,function(Rt){Rt[0]!==it&&dt.push(Rt)}),this.i=dt},n.entries=function it(){var dt,Rt=this;return F(it,function($t){if($t.h==1&&(dt=0),$t.h!=3)return dt<Rt.i.length?$t=S($t,Rt.i[dt]):($t.h=0,$t=void 0),$t;dt++,$t.h=2})},n.forEach=function(it,dt){W(arguments,1);for(var Rt=c(this),$t=Rt.next();!$t.done;$t=Rt.next()){var Ae=c($t.value);$t=Ae.next().value,Ae=Ae.next().value,it.call(dt,Ae,$t,this)}},n.get=function(it){W(arguments,1);var dt=this.i;it=String(it);for(var Rt=0;Rt<dt.length;Rt++)if(dt[Rt][0]===it)return dt[Rt][1];return null},n.getAll=function(it){W(arguments,1);var dt=[];return it=String(it),V(this.i,function(Rt){Rt[0]===it&&dt.push(Rt[1])}),dt},n.has=function(it){W(arguments,1),it=String(it);for(var dt=0;dt<this.i.length;dt++)if(this.i[dt][0]===it)return!0;return!1},n.keys=function it(){var dt,Rt,$t,Ae,ht=this;return F(it,function(C){if(C.h==1&&(dt=c(ht),Rt=dt.next()),C.h!=3)return Rt.done?void(C.h=0):($t=Rt.value,Ae=c($t),S(C,Ae.next().value));Rt=dt.next(),C.h=2})},n.set=function(it,dt,Rt){W(arguments,2),it=String(it);var $t=[],Ae=$(it,dt,Rt),ht=!0;V(this.i,function(C){C[0]===it?ht&&(ht=!$t.push(Ae)):$t.push(C)}),ht&&$t.push(Ae),this.i=$t},n.values=function it(){var dt,Rt,$t,Ae,ht=this;return F(it,function(C){if(C.h==1&&(dt=c(ht),Rt=dt.next()),C.h!=3)return Rt.done?void(C.h=0):($t=Rt.value,(Ae=c($t)).next(),S(C,Ae.next().value));Rt=dt.next(),C.h=2})},_e.prototype._asNative=function(){for(var it=new nt,dt=c(this),Rt=dt.next();!Rt.done;Rt=dt.next()){var $t=c(Rt.value);Rt=$t.next().value,$t=$t.next().value,it.append(Rt,$t)}return it},_e.prototype._blob=function(){var it="----formdata-polyfill-"+Math.random(),dt=[],Rt="--"+it+`\r
Content-Disposition: form-data; name="`;return this.forEach(function($t,Ae){return typeof $t=="string"?dt.push(Rt+Fe(Z(Ae))+`"\r
\r
`+Z($t)+`\r
`):dt.push(Rt+Fe(Z(Ae))+'"; filename="'+Fe($t.name)+`"\r
Content-Type: `+($t.type||"application/octet-stream")+`\r
\r
`,$t,`\r
`)}),dt.push("--"+it+"--"),new Blob(dt,{type:"multipart/form-data; boundary="+it})},_e.prototype[Symbol.iterator]=function(){return this.entries()},_e.prototype.toString=function(){return"[object FormData]"},Te&&!Te.matches&&(Te.matches=Te.matchesSelector||Te.mozMatchesSelector||Te.msMatchesSelector||Te.oMatchesSelector||Te.webkitMatchesSelector||function(it){for(var dt=(it=(this.document||this.ownerDocument).querySelectorAll(it)).length;0<=--dt&&it.item(dt)!==this;);return-1<dt}),be&&(_e.prototype[be]="FormData"),mt){var xn=Y.XMLHttpRequest.prototype.setRequestHeader;Y.XMLHttpRequest.prototype.setRequestHeader=function(it,dt){xn.call(this,it,dt),it.toLowerCase()==="content-type"&&(this.B=!0)},Y.XMLHttpRequest.prototype.send=function(it){it instanceof _e?(it=it._blob(),this.B||this.setRequestHeader("Content-Type",it.type),mt.call(this,it)):mt.call(this,it)}}ut&&(Y.fetch=function(it,dt){return dt&&dt.body&&dt.body instanceof _e&&(dt.body=dt.body._blob()),ut.call(this,it,dt)}),ee&&(Y.navigator.sendBeacon=function(it,dt){return dt instanceof _e&&(dt=dt._asNative()),ee.call(this,it,dt)}),Y.FormData=_e}})();const S_=()=>{const n=x("AREAS");return n.length===0&&n.push(ye.GLOBAL),Uc(n).call(n,(t,e,i)=>{const s=W0(e);return s?i===0?s:"".concat(t,",").concat(s):t},"")},W0=n=>n===ye.OVERSEA?"".concat(ci.ASIA,",").concat(ci.EUROPE,",").concat(ci.AFRICA,",").concat(ci.NORTH_AMERICA,",").concat(ci.SOUTH_AMERICA,",").concat(ci.OCEANIA):ci[n],f4=n=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return n.map(e=>{const i=Wf[e],s=Object.keys(i);s&&s.map(r=>{r!=="CODE"&&(t[r]=t[r].concat(i[r]))})}),t},v_={GLOBAL:{ASIA:[ye.CHINA,ye.JAPAN,ye.INDIA,ye.KOREA,ye.HKMC],EUROPE:[],NORTH_AMERICA:[ye.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},y_=Object.keys(v_[ye.GLOBAL]),jS=[ye.CHINA,ye.NORTH_AMERICA,ye.EUROPE,ye.ASIA,ye.JAPAN,ye.INDIA,ye.OCEANIA,ye.SOUTH_AMERICA,ye.AFRICA,ye.KOREA,ye.HKMC,ye.US],_4=function(n,t){let e=[];if(Wt(n).call(n,ye.GLOBAL)){const r=[ye.GLOBAL,ye.OVERSEA],a=Object.keys(Wf);if(t===ye.GLOBAL)throw new G(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===ye.CHINA)e=[ye.OVERSEA];else if(s=t,Wt(y_).call(y_,s)){const c=(i=t,v_[ye.GLOBAL][i]||[]),l=[...r,t,...c];e=a.filter(u=>!Wt(l).call(l,u))}else if(function(c){let l=!1;return y_.forEach(u=>{var h;Wt(h=v_[ye.GLOBAL][u]).call(h,c)&&(l=!0)}),l}(t)){const c=function(u){let h;return y_.forEach(f=>{var g;Wt(g=v_[ye.GLOBAL][f]).call(g,u)&&(h=f)}),h}(t),l=[...r,c,t];e=a.filter(u=>!Wt(l).call(l,u))}else e=n;e=function(c){const l=[];return jS.forEach(u=>{Wt(c).call(c,u)&&l.push(u)}),l.concat(c.filter(u=>!Wt(jS).call(jS,u)))}(e)}else e=n;var i,s;return e};function H0(n){var t,e;if(!n&&Wt(t=x("AREAS")).call(t,ye.EXTENSIONS))return v.debug("update area from ap : reset"),void GS(fj,!0);if(!Wt(e=x("AREAS")).call(e,ye.GLOBAL)||!n)return;let i=Wf.EXTENSIONS;i&&(i={CODE:W0(ye.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(n,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(n,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(n,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(n,".agora.io"),"cds-ap-web-2-".concat(n,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(n,".agora.io"),"sua-ap-web-2-".concat(n,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(n,".agora.io"),"uap-ap-web-2-".concat(n,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(n,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(n,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(n,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(n,".agora.io")]},v.debug("update area from ap success: ".concat(n,",config is "),i),We("AREAS",[ye.EXTENSIONS],!0),Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?We(s,i[s][0]):We(s,i[s])}))}function GS(n){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const e=Dt.reportApiInvoke(null,{name:Mn.SET_AREA,options:n,tag:un.TRACER});try{let i=[];if(typeof n=="string"&&(i=[n]),Array.isArray(n)&&(n.forEach(r=>{if(!Wt(JA).call(JA,r))throw new G(O.INVALID_PARAMS,"invalid area code")}),i=n),Object.prototype.toString.call(n)==="[object Object]"){const{areaCode:r,excludedArea:a}=n;if(!r)throw new G(O.INVALID_PARAMS,"area code is needed");let c=r;typeof r=="string"&&(c=[r]),i=a?_4(c,a):c}if(!t){if(Da.AREAS){const r=new G(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return e.onError(r),void v.warning("setArea is prohibited because of config-distribute")}if(Wt(i).call(i,ye.GLOBAL)&&x("AREAS")===ye.EXTENSIONS){const r=new G(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return e.onError(r),void v.warning("setArea is prohibited because of ap extensions")}}We("AREAS",i,t);const s=f4(i);Object.keys(s).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?We(r,s[r][0]):We(r,s[r])}),v.debug("set area success:",i.join(","))}catch(i){throw e.onError(i),i}e.onSuccess()}function K0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function WS(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?K0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):K0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}let HS=1;function m4(n,t,e,i,s){HS+=1;const r={sid:e.sid,command:"convergeAllocateEdge",uid:"666",appId:e.appId,ts:Math.floor(Date.now()/1e3),seq:HS,requestId:HS,version:Zs,cname:e.cname},a={service_name:t,json_body:JSON.stringify(r)};let c,l,u=n[0];return jr(async()=>{c=Date.now();const h=await sa(u,{data:a,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(l=Date.now()-c,h.code!==0){const S=new G(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+h.code,{retry:!0,responseTime:l});throw v.error(S.toString()),S}const f=JSON.parse(h.json_body);if(f.code!==200){const S=new G(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(f.code,", reason: ").concat(f.reason),{code:f.code,responseTime:l});throw v.error(S.toString()),S}if(!f.servers||f.servers.length===0){const S=new G(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:f.code,responseTime:l});throw v.error(S.toString()),S}const g=function(S,w){return{addressList:S.servers.map(b=>"wss://".concat(b.address.replace(/\./g,"-"),".").concat(x("WORKER_DOMAIN"),":").concat(b.wss,"?serviceName=").concat(encodeURIComponent(w))),workerToken:S.workerToken,vid:S.vid}}(f,t);return x("LIVE_STREAMING_ADDRESS")&&(g.addressList=x("LIVE_STREAMING_ADDRESS")instanceof Array?x("LIVE_STREAMING_ADDRESS"):[x("LIVE_STREAMING_ADDRESS")]),WS(WS({},g),{},{responseTime:l})},(h,f)=>(Dt.apworkerEvent(e.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(h.addressList),firstSuccess:f===0,responseTime:l,serverIp:n[f%n.length]}),!1),(h,f)=>(Dt.apworkerEvent(e.sid,{success:!1,sc:h.data&&h.data.code||200,serviceName:t,responseTime:l,serverIp:n[f%n.length]}),!!(h.code!==O.OPERATION_ABORTED&&h.code!==O.UNEXPECTED_RESPONSE||h.data&&h.data.retry)&&(u=n[(f+1)%n.length],!0)),s)}let KS=1;function q0(n,t,e,i){let{url:s,areaCode:r}=n;const a=Date.now();let c;const[l,u]=X0(t,r,[ti.CHOOSE_SERVER]);let h=On.networkState;return jr(async()=>{h&&On.networkState===ki.OFFLINE&&On.onlineWaiter&&await K.race([On.onlineWaiter,hi(i&&i.maxRetryTimeout||Dn.maxRetryTimeout)]),h=On.networkState;const{data:f,headers:g}=await sa(s,{data:l,cancelToken:e,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=g.http3==="1"?1:-1,Dt.reportResourceTiming(s,t.sid),z0(f,s,t,a,[ti.CHOOSE_SERVER],c);const S=xS(f,ti.CHOOSE_SERVER);return J0(S),U0(S,s)},f=>(f&&Dt.joinChooseServer(t.sid,{lts:a,succ:!0,csAddr:s,opid:u,serverList:f.gatewayAddrs.map(g=>g.address),ec:null,cid:f.cid.toString(),uid:f.uid.toString(),csIp:f.csIp,unilbsServerIds:[ti.CHOOSE_SERVER].toString(),isHttp3:c}),!1),f=>f.code!==O.OPERATION_ABORTED&&(f.code===O.CAN_NOT_GET_GATEWAY_SERVER?f.data.retry:(Dt.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:s,serverList:null,opid:u,ec:f.code,csIp:f.data&&f.data.csIp,unilbsServerIds:[ti.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:c}),v.warning("[".concat(t.clientId,"] Choose server network error, retry"),f),!0)),i)}function Y0(n,t,e,i){let s,{url:r,areaCode:a,serviceIds:c}=n;const l=Date.now(),[u,h]=X0(t,a,c);let f;return jr(async()=>{f&&On.networkState===ki.OFFLINE&&On.onlineWaiter&&await K.race([On.onlineWaiter,hi(i&&i.maxRetryTimeout||Dn.maxRetryTimeout)]),f=On.networkState;const{data:g,headers:S}=await sa(r,{data:u,cancelToken:e,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=S.http3==="1"?1:-1,Dt.reportResourceTiming(r,t.sid),z0(g,r,t,l,c,s);const w=xS(g,ti.CHOOSE_SERVER),b=xS(g,t.cloudProxyServer==="proxy5"?ti.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?ti.CLOUD_PROXY:ti.CLOUD_PROXY_FALLBACK);return J0(w),{gatewayInfo:U0(w,r),proxyInfo:b,url:r}},g=>(g.gatewayInfo&&Dt.joinChooseServer(t.sid,{lts:l,succ:!0,csAddr:r,serverList:g.gatewayInfo.gatewayAddrs.map(S=>S.address),ec:null,opid:h,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:s}),g.proxyInfo&&Dt.joinWebProxyAP(t.sid,{lts:l,sucess:1,apServerAddr:r,turnServerAddrList:g.proxyInfo.addresses.map(S=>S.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1),g=>g.code!==O.OPERATION_ABORTED&&(g.code===O.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(Dt.joinWebProxyAP(t.sid,{lts:l,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:g.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:f})}),v.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),g),!0)),i)}const z0=(n,t,e,i,s,r)=>{const a=[],c=l=>{l.flag===4096?Dt.joinChooseServer(e.sid,{lts:i,succ:!1,csAddr:t,opid:n.opid,serverList:null,ec:l.error.message,csIp:l.error.data&&l.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:r}):l.flag!==1048576&&l.flag!==4194304&&l.flag!==4194310||Dt.joinWebProxyAP(e.sid,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:l.error.code,eventType:e.cloudProxyServer,unilbsServerIds:s.toString()})};if(n.response_body.forEach(l=>{const u=l.buffer.code;if(l.uri===23&&u===0&&!l.buffer.edges_services)if(l.buffer.flag===4194310)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),l.buffer.edges_services=[];else{const h={error:new G(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:n.detail[502]}),flag:l.buffer.flag};a.push(h),c(h)}if(u!==0){const h=Kf(u),f={error:new G(O.CAN_NOT_GET_GATEWAY_SERVER,h.desc,{desc:h.desc,retry:h.retry,csIp:n.detail[502]}),flag:l.buffer.flag};l.buffer.flag===4194310?v.warning(f.error.toString()):a.push(f),c(f)}}),a.length)throw v.warning("[".concat(e.clientId,"] multi unilbs ").concat(t," failed, ").concat(a.map(l=>"flag: ".concat(l.flag,", message: ").concat(l.error.message,", retry: ").concat(l.error.data.retry)).join(" | "))),new G(O.CAN_NOT_GET_GATEWAY_SERVER,a.map(l=>"flag: ".concat(l.flag,", message: ").concat(l.error.message)).join(" | "),{retry:!!a.find(l=>l.error.data.retry),csIp:n.detail[502],desc:[...new Set(a.map(l=>{var u;return l==null||(u=l.error)===null||u===void 0||(u=u.data)===null||u===void 0?void 0:u.desc}).filter(l=>!!l))]})},J0=n=>{var t,e,i,s;if(n.addresses&&n.addresses.length===0&&n.code===0)throw new G(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:n.detail&&n.detail[502]});if(x("AP_AREA")&&((i=n.detail)!==null&&i!==void 0&&i[23]&&typeof((s=n.detail)===null||s===void 0?void 0:s[23])=="string"?H0(n.detail[23].toLowerCase()):H0()),(t=n.detail)!==null&&t!==void 0&&t[19]&&typeof((e=n.detail)===null||e===void 0?void 0:e[19])=="string"){const a=n.detail[19],c=a==null?void 0:a.split(";");for(let l=0;l<c.length;l++){var r;const u=$T(r=c[l]).call(r);n.addresses[l]&&c&&(n.addresses[l].fingerprint=u)}}if(x("GATEWAY_ADDRESS")&&x("GATEWAY_ADDRESS").length>0){v.debug("assign gateway address to",x("GATEWAY_ADDRESS"));const a=x("GATEWAY_ADDRESS").map(c=>{var l,u;const h=(l=(u=n.addresses.find(f=>f.ip===c.ip&&f.port===c.port))===null||u===void 0?void 0:u.fingerprint)!==null&&l!==void 0?l:"";return{ip:c.ip,port:c.port,ticket:n.addresses[0]&&n.addresses[0].ticket,fingerprint:h}});n.addresses=a}},E4=(n,t)=>{if(n.response_body&&n.response_body.length){const e=n.response_body[0];if(e.buffer.code!==0){const i=Kf(e.buffer.code);throw new G(O.UPDATE_TICKET_FAILED,"[".concat(e.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return e.buffer.ticket}throw v.debug("update ticket request received ap response without response body:",t),new G(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},X0=(n,t,e)=>{const i=Math.floor(Math.random()*1e12),s={appid:n.appId,client_ts:Date.now(),opid:i,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:WS({6:n.stringUid,11:t,12:x("USE_NEW_TOKEN")?"1":void 0,22:t},x("AP_RTM")?{26:"RTM2"}:{}),key:n.token,service_ids:e,uid:n.uid||0}}]};s.request_bodies.forEach(a=>{n.multiIP&&n.multiIP.gateway_ip&&(a.buffer.detail[5]=JSON.stringify({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]}))});const r=new FormData;return r.append("request",JSON.stringify(s)),[r,i]},g4=(n,t)=>{const e=Math.floor(Math.random()*1e12),i={appid:n.appId,client_ts:Date.now(),opid:e,sid:n.sid,request_bodies:[{uri:28,buffer:{cname:n.cname,detail:{1:"",6:n.stringUid,12:"1"},token:n.token,service_ids:t,uid:n.uid||0,edges_services:n.apResponse.addresses.map(r=>({ip:r.ip,port:r.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(i)),[s,e]};let _l=0;function ml(n){return K.all(n.map(t=>t.then(e=>{throw e},e=>e))).then(t=>{throw t},t=>t)}const ph=async n=>{let{fragementLength:t,referenceList:e,asyncMapHandler:i,allFailedhandler:s,promisesCollector:r}=n,a=0;const c=t;let l,u=0;const h=async()=>{const f=(()=>{const g=a*c,S=g+c;return e.slice(g,S).map(i)})();r&&r.push(...f);try{l=await ml(f)}catch(g){if(u+=c,a++,!(u>=e.length))return void await h();s(g)}f.forEach(g=>g.cancel())};return await h(),l};async function qS(n,t,e,i){return{gatewayInfo:await async function(r,a,c,l){let u=null;const h=[],f=async()=>{const S=x("WEBCS_DOMAIN").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(I=>({url:r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:S_()})),w=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(I=>I.url)}),b=await ph({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:I=>(v.debug("[".concat(r.clientId,"] Connect to choose_server:"),I.url),q0(I,r,a,c)),allFailedhandler:I=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},w),I[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},w),b},g=async()=>{if(await hi(1e3),u!==null)return u;const S=x("WEBCS_DOMAIN_BACKUP_LIST").map(I=>({url:r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:S_()})),w=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(I=>I.url)}),b=await ph({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:I=>(v.debug("[".concat(r.clientId,"] Connect to backup choose_server:"),I.url),q0(I,r,a,c)),allFailedhandler:I=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},w),I[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},w),b};try{return u=await ml([f(),g()]),h.length&&h.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),u}catch(S){throw S[0]}}(n,t,e,i)}}async function $0(n,t,e,i,s){const r=n.cloudProxyServer;if(r==="disabled"){if(!i)return;if(n.useLocalAccessPoint)return await qS(n,t,e,s);if(x("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:u,proxyInfo:h}=await Z0(n,t,e,s);return n.turnServer&&n.turnServer.mode!=="auto"||(n.turnServer={mode:"manual",servers:h.map(f=>({turnServerURL:f.address,tcpport:f.tcpport||ks.tcpport,udpport:f.udpport||ks.udpport,username:f.username||ks.username,password:f.password||ks.password,forceturn:!1,security:!0}))}),{gatewayInfo:u}}return await qS(n,t,e,s)}const{proxyInfo:a,gatewayInfo:c}=await Z0(n,t,e,s),l={gatewayInfo:c};return n.turnServer={mode:"manual",servers:a.map(u=>({turnServerURL:u.address,tcpport:r==="proxy3"?void 0:u.tcpport?u.tcpport:ks.tcpport,udpport:r==="proxy4"?void 0:u.udpport?u.udpport:ks.udpport,username:u.username||ks.username,password:u.password||ks.password,forceturn:r!=="proxy4",security:r==="proxy5"}))},v.debug("[".concat(n.clientId,"] set proxy server: ").concat(n.proxyServer,", mode: ").concat(r)),l}async function Q0(n,t,e,i,s){const r=x("ACCOUNT_REGISTER").slice(0,x("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?r.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):r.map(l=>"https://".concat(l,"/api/v1"));const c=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const l=await async function(u,h,f,g,S){const w=Date.now(),b={sid:f.sid,opid:10,appid:f.appId,string_uid:h};let I=u[0];const U=await jr(()=>sa(I+"".concat(I.indexOf("?")===-1?"?":"&","action=stringuid"),{data:b,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(F,V)=>{if(F.code===0){if(F.uid<=0||F.uid>=Math.pow(2,32))throw v.error("Invalid Uint Uid ".concat(h," => ").concat(F.uid),F),Dt.reqUserAccount(b.sid,{lts:w,success:!1,serverAddr:I,stringUid:b.string_uid,uid:F.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:b}),new G(O.INVALID_UINT_UID_FROM_STRING_UID);return Dt.reqUserAccount(b.sid,{lts:w,success:!0,serverAddr:I,stringUid:b.string_uid,uid:F.uid,errorCode:null,extend:b}),!1}const Z=Kf(F.code);return Z.retry&&(I=u[(V+1)%u.length]),Dt.reqUserAccount(b.sid,{lts:w,success:!1,serverAddr:I,stringUid:b.string_uid,uid:F.uid,errorCode:Z.desc,extend:b}),Z.retry},(F,V)=>F.code!==O.OPERATION_ABORTED&&(Dt.reqUserAccount(b.sid,{lts:w,success:!1,serverAddr:I,stringUid:b.string_uid,uid:null,errorCode:F.code,extend:b}),I=u[(V+1)%u.length],!0),S);if(U.code!==0){const F=Kf(U.code);throw new G(O.UNEXPECTED_RESPONSE,F.desc)}return U}(a,n,t,e,i);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},c),l.uid}catch(l){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[l]},c),l}}async function T4(n,t,e){const i=x("CDS_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(c=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(c+"/api/v1"):"https://".concat(c,"/api/v1?action=config")).map(c=>function(l,u,h,f){const g=Pe(),S={flag:64,cipher_method:0,features:{device:g.name,system:g.os,system_general:navigator.userAgent,vendor:u.appId,version:Zs,cname:u.cname,sid:u.sid,session_id:u.sid,detail:"",proxyServer:u.proxyServer}};return jr(()=>sa(l,{data:S,timeout:1e3,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,w=>w.code!==O.OPERATION_ABORTED,f)}(c,n,t,e));let s=null,r=null,a={};try{s=await ml(i)}catch(c){if(c.code===O.OPERATION_ABORTED)throw c;r=c}if(i.forEach(c=>c.cancel()),Dt.reportApiInvoke(n.sid,{name:Mn.REQUEST_CONFIG_DISTRIBUTE,options:{error:r,res:s}}).onSuccess(),s&&s.test_tags)try{a=function(c){if(!c.test_tags)return{};const l=c.test_tags,u=Object.keys(l),h={};return u.forEach(f=>{var g;const S=$T(g=f.slice(4)).call(g),w=JSON.parse(l[f])[1];h[S]=w}),h}(s)}catch{}return a}async function Z0(n,t,e,i){const s=x("PROXY_SERVER_TYPE3"),r=(S,w,b)=>{let I=b||s;return Array.isArray(I)&&(I=w%2==0?s[1]:s[0]),"https://".concat(I,"/ap/?url=").concat(S)};let a=null;const c=[],l=async()=>{const S=x("WEBCS_DOMAIN").slice(0,x("AJAX_REQUEST_CONCURRENT")).map((I,U)=>{let F;return F=n.cloudProxyServer==="disabled"&&n.proxyServer?r("".concat(I,"/api/v2/transpond/webrtc?v=2"),U,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):r("".concat(I,"/api/v2/transpond/webrtc?v=2"),U),{url:F,areaCode:S_(),serviceIds:[ti.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?ti.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?ti.CLOUD_PROXY:ti.CLOUD_PROXY_FALLBACK]}}),w=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(I=>I.url)}),b=await ph({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:I=>(v.debug("[".concat(n.clientId,"] Connect to choose_server:"),I.url),Y0(I,n,t,e)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},w),I[0]},promisesCollector:c});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},w),b},u=async()=>{if(await hi(1e3),a!==null)return a;const S=x("WEBCS_DOMAIN_BACKUP_LIST").map((I,U)=>{let F;return F=n.cloudProxyServer==="disabled"&&n.proxyServer?r("".concat(I,"/api/v2/transpond/webrtc?v=2"),U,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):r("".concat(I,"/api/v2/transpond/webrtc?v=2"),U),{url:F,areaCode:S_(),serviceIds:[ti.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?ti.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?ti.CLOUD_PROXY:ti.CLOUD_PROXY_FALLBACK]}}),w=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(I=>I.url)}),b=await ph({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:I=>(v.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),I.url),Y0(I,n,t,e)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},w),I[0]},promisesCollector:c});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},w),b};let h,f,g;try{({gatewayInfo:h,proxyInfo:f,url:g}=await ml([l(),u()]))}catch(S){throw S[0]}if(c.length&&c.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),!h||!f)throw new G(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(n.apUrl=g,n.cloudProxyServer!=="disabled"&&Array.isArray(s)&&g){const S=/^https?:\/\/(.+?)(\/.*)?$/.exec(g)[1];Wt(s).call(s,S)&&(n.proxyServer=S,v.setProxyServer(S),Dt.setProxyServer(S))}return a={gatewayInfo:h,proxyInfo:await l4(f,h.uid)},a}async function tO(n,t,e,i){const s=x("UAP_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(r=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(r+"/api/v1?action=uap"):"https://".concat(r,"/api/v1?action=uap"));return await m4(s,n,t,e,i)}async function S4(n,t,e){const i=x("UAP_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(s=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")).map(s=>function(r,a,c,l){const u={command:"convergeAllocateEdge",sid:a.sid,appId:a.appId,token:a.token,ts:Date.now(),version:Zs,cname:a.cname,uid:a.uid.toString(),requestId:KS,seq:KS};KS+=1;const h={service_name:"tele_channel",json_body:JSON.stringify(u)};return jr(async()=>{const f=await sa(r,{data:h,cancelToken:c,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(f.code!==0){const S=new G(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+f.code,{retry:!0});throw v.error(S.toString()),S}const g=JSON.parse(f.json_body);if(g.code!==200){const S=new G(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(g.code,", reason: ").concat(g.reason));throw v.error(S.toString()),S}if(!g.servers||g.servers.length===0){const S=new G(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw v.error(S.toString()),S}return{vid:g.vid,workerToken:g.workerToken,addressList:(x("CHANNEL_MEDIA_RELAY_SERVERS")||g.servers).map(S=>"wss://".concat(S.address.replace(/\./g,"-"),".").concat(x("WORKER_DOMAIN"),":").concat(S.wss))}},void 0,f=>!!(f.code!==O.OPERATION_ABORTED&&f.code!==O.UNEXPECTED_RESPONSE||f.data&&f.data.retry),l)}(s,n,t,e));try{const s=await ml(i);return i.forEach(r=>r.cancel()),s}catch(s){throw s[0]}}async function v4(n,t,e){let i=null;const s=[],r=async a=>{const c=x(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(l=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(l+"/api/v2/transpond/webrtc?v=2"):"https://".concat(l,"/api/v2/transpond/webrtc?v=2"));return a&&(await hi(1e3),i!==null)?i:await ph({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:l=>(v.debug("[".concat(n.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),l),function(u,h,f,g){const[S]=g4(h,[ti.CHOOSE_SERVER]);let w=On.networkState;return jr(async()=>{w&&On.networkState===ki.OFFLINE&&On.onlineWaiter&&await K.race([On.onlineWaiter,hi(g&&g.maxRetryTimeout||Dn.maxRetryTimeout)]),w=On.networkState;const b=await sa(u,{data:S,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0);return E4(b,u)},()=>!1,b=>b.code!==O.OPERATION_ABORTED&&(b.code===O.UPDATE_TICKET_FAILED?b.data.retry:(v.warning("[".concat(h.clientId,"] update ticket network error, retry"),b),!0)),g)}(l,n,t,e)),allFailedhandler:l=>{throw l[0]},promisesCollector:s})};try{return i=await ml([r(!1),r(!0)]),s.length&&s.forEach(a=>a.cancel&&typeof a.cancel=="function"&&a.cancel()),i}catch(a){throw a[0]}}function eO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function nO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?eO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):eO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class y4 extends rn{constructor(){super(),m(this,"configs",void 0),m(this,"joinInfo",void 0),m(this,"cancelToken",void 0),m(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),m(this,"interval",void 0),m(this,"mutex",new Zn("config-distribute")),m(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,e){this.joinInfo=t,this.cancelToken=e,this.interval&&this.stopGetConfigDistribute(),x("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},x("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Dt.reportApiInvoke(null,{options:void 0,name:Mn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:un.TRACER}).onSuccess(JSON.stringify(Da))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void v.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const e=await this.mutex.lock();try{t=await T4(this.joinInfo,this.cancelToken,this.retryConfig),v.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(i){const s=new G(O.NETWORK_RESPONSE_ERROR,i);v.warning("[config-distribute] ".concat(s.toString()))}finally{e()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var e;(e=t)&&e.uplink&&e.id&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(Ku.UPDATE_BITRATE_LIMIT,t):this.emit(Ku.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&nO({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var e;const i=Ou(e=Object.keys(t).filter(r=>/^webrtc_ng_global_parameter/.test(r))).call(e);for(let r=0;r<i.length;r++)for(let a=i.length-1;a>r;a--){const c=i[a];if(typeof t[c].__priority=="number"){const l=t[c].__priority,u=i[a-1];if(typeof t[u].__priority=="number"){if(!(l>t[u].__priority))continue;{const h=c;i[a]=i[a-1],i[a-1]=h}}else{const h=c;i[a]=i[a-1],i[a-1]=h}}}const s={};i.forEach(r=>{const a=t[r],c=a.__expires;Object.keys(a).forEach(l=>{l==="__priority"||l==="__expires"||Object.prototype.hasOwnProperty.call(s,l)||(s[l]=nO({value:a[l]},c&&{expires:c}))})});try{(function(c){try{const l=Date.now();Object.keys(c).forEach(u=>{switch(u){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(ji,u)){const{value:h,expires:f}=c[u];if(f&&f<=l)return;Da[u]=h,ji[u]=h,v.debug("Update global parameters from config distribute",u,h)}}})}catch(l){v.error("Error update config immediately: ".concat(c),l.message)}})(s);const r=JSON.stringify(s),a=window.btoa(r);window.localStorage.setItem("websdk_ng_global_parameter",a),v.debug("Caching global parameters ".concat(r))}catch(r){v.error("Error caching global parameters:",r.message)}}}function iO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function fh(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?iO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):iO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class C4 extends rn{constructor(t,e,i,s){super(),m(this,"spec",void 0),m(this,"token",void 0),m(this,"websocket",void 0),m(this,"pingpongTimer",void 0),m(this,"reconnectMode","retry"),m(this,"serviceMode",void 0),m(this,"reqId",0),m(this,"commandReqId",0),m(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),m(this,"handleWebSocketMessage",r=>{if(!r.data)return;const a=JSON.parse(r.data);a.requestId?this.emit("@".concat(a.requestId,"-").concat(a.sid),a):this.serviceMode===jn.INJECT?this.emit(yr.INJECT_STREAM_STATUS,a):(Dt.workerEvent(this.spec.sid,{actionType:"status",serverCode:a.code,workerType:this.serviceMode===jn.TRANSCODE?1:2}),this.emit(yr.PUBLISH_STREAM_STATUS,a))}),this.spec=e,this.token=t,this.serviceMode=s,this.websocket=new Yu("live-streaming",i),this.websocket.on(Jt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Jt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Jt.REQUEST_NEW_URLS,(r,a)=>{hn(this,yr.REQUEST_NEW_ADDRESS).then(r).catch(a)}),this.websocket.on(Jt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,e,i,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const r=this.commandReqId,a=this.reqId;if(!a||!this.websocket)throw new G(O.UNEXPECTED_ERROR);const c=fh({command:t,sdkVersion:Zs==="4.19.1"?"0.0.1":Zs,seq:a,requestId:a,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},e);if(this.websocket.state==="closed")throw new G(O.WS_DISCONNECT);const l=()=>new K((g,S)=>{this.websocket.once(Jt.CLOSED,()=>S(new G(O.WS_ABORT))),this.websocket.once(Jt.CONNECTED,g)});this.websocket.state!=="connected"&&await l(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const u=new K((g,S)=>{const w=()=>{S(new G(O.WS_ABORT))};this.websocket.once(Jt.RECONNECTING,w),this.websocket.once(Jt.CLOSED,w),this.once("@".concat(a,"-").concat(this.spec.sid),b=>{g(b)})});s&&Dt.workerEvent(this.spec.sid,fh(fh({},s),{},{requestId:r,actionType:"request",payload:JSON.stringify(e.clientRequest),serverCode:0,code:0}));const h=Date.now();this.websocket.sendMessage(c);let f=null;try{f=await u}catch(g){if(this.websocket.state==="closed")throw g;return await l(),await this.request(t,e,i)}return s&&Dt.workerEvent(this.spec.sid,fh(fh({},s),{},{requestId:r,actionType:"response",payload:JSON.stringify(f.serverResponse),serverCode:f.code,success:f.code===200,responseTime:Date.now()-h})),f.code!==200&&this.handleResponseError(f),f}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Zs==="4.19.1"?"0.0.1":Zs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Rn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void v.warning("live stream response already exists stream");case Rn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Rn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Rn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new G(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Rn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Rn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new G(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Rn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new G(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(yr.WARNING,e,t.serverResponse.url)}case Rn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const e=new G(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(yr.WARNING,e,t.serverResponse.url)}case Rn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Rn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new G(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Rn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const e=new G(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(yr.WARNING,e,t.serverResponse.url)}case Rn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Rn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Rn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Rn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Rn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Rn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new G(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(wf)},6e3)}}function sO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Qi(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?sO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):sO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class R4 extends rn{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Dn;super(),m(this,"onLiveStreamWarning",void 0),m(this,"onLiveStreamError",void 0),m(this,"onInjectStatusChange",void 0),m(this,"spec",void 0),m(this,"retryTimeout",1e4),m(this,"connection",void 0),m(this,"httpRetryConfig",void 0),m(this,"wsRetryConfig",void 0),m(this,"streamingTasks",new Map),m(this,"isStartingStreamingTask",!1),m(this,"taskMutex",new Zn("live-streaming")),m(this,"cancelToken",rs.CancelToken.source()),m(this,"transcodingConfig",void 0),m(this,"injectConfig",Qi({},Cj)),m(this,"injectLoopTimes",0),m(this,"uapResponse",void 0),m(this,"lastTaskId",1),m(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=e}async setTranscodingConfig(t){const e=Qi(Qi({},yj),t);e.videoCodecProfile!==66&&e.videoCodecProfile!==77&&e.videoCodecProfile!==100&&(v.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(e.videoCodecProfile," -> 100")),e.videoCodecProfile=100),e.transcodingUsers||(e.transcodingUsers=e.userConfigs),e.transcodingUsers&&(e.transcodingUsers=e.transcodingUsers.map(a=>Qi(Qi(Qi({},vj),a),{},{zOrder:a.zOrder?a.zOrder+1:1}))),function(a){ln(a.width)||je(a.width,"config.width",0,1e4),ln(a.height)||je(a.height,"config.height",0,1e4),ln(a.videoBitrate)||je(a.videoBitrate,"config.videoBitrate",1,1e6),ln(a.videoFrameRate)||je(a.videoFrameRate,"config.videoFrameRate"),ln(a.lowLatency)||Lc(a.lowLatency,"config.lowLatency"),ln(a.audioSampleRate)||Kn(a.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ln(a.audioBitrate)||je(a.audioBitrate,"config.audioBitrate",1,128),ln(a.audioChannels)||Kn(a.audioChannels,"config.audioChannels",[1,2,3,4,5]),ln(a.videoGop)||je(a.videoGop,"config.videoGop"),ln(a.videoCodecProfile)||Kn(a.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ln(a.userCount)||je(a.userCount,"config.userCount",0,17),ln(a.backgroundColor)||je(a.backgroundColor,"config.backgroundColor",0,16777215),ln(a.userConfigExtraInfo)||_i(a.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),a.transcodingUsers&&!ln(a.transcodingUsers)&&(zo(a.transcodingUsers,"config.transcodingUsers"),a.transcodingUsers.forEach((c,l)=>{HT(c.uid),ln(c.x)||je(c.x,"transcodingUser[".concat(l,"].x"),0,1e4),ln(c.y)||je(c.y,"transcodingUser[".concat(l,"].y"),0,1e4),ln(c.width)||je(c.width,"transcodingUser[".concat(l,"].width"),0,1e4),ln(c.height)||je(c.height,"transcodingUser[".concat(l,"].height"),0,1e4),ln(c.zOrder)||je(c.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),ln(c.alpha)||je(c.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)})),ln(a.watermark)||qT(a.watermark,"watermark"),ln(a.backgroundImage)||qT(a.backgroundImage,"backgroundImage"),a.images&&!ln(a.images)&&(zo(a.images,"config.images"),a.images.forEach((c,l)=>{qT(c,"images[".concat(l,"]"))}))}(e);const i=[];e.images&&i.push(...e.images.map(a=>Qi(Qi(Qi({},KT),a),{},{zOrder:255}))),e.backgroundImage&&(i.push(Qi(Qi(Qi({},KT),e.backgroundImage),{},{zOrder:0})),delete e.backgroundImage),e.watermark&&(i.push(Qi(Qi(Qi({},KT),e.watermark),{},{zOrder:255})),delete e.watermark),e.images=i,e.transcodingUsers&&(e.userConfigs=e.transcodingUsers.map(a=>Qi({},a)),e.userCount=e.transcodingUsers.length,delete e.transcodingUsers);const s=(e.userConfigs||[]).map(a=>typeof a.uid=="number"?K.resolve(a.uid):Q0(a.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await K.all(s)).forEach((a,c)=>{e.userConfigs&&e.userConfigs[c]&&(e.userConfigs[c].uid=a)}),this.transcodingConfig=e,this.connection)try{var r;const a=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(_o(r=this.streamingTasks).call(r)).map(c=>c.taskId).join("#")});v.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(a.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(a){if(!a.data||!a.data.retry)throw a;a.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(c=>{v.warning("[".concat(this.spec.clientId,"] live streaming receive error"),a.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,a).then(()=>{v.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(l=>{v.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)})})}}setInjectStreamConfig(t,e){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=e}async startLiveStreamingTask(t,e,i){var s;if(Array.from(_o(s=this.streamingTasks).call(s)).find(l=>l.mode===jn.INJECT)&&e===jn.INJECT)return new G(O.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&e===jn.TRANSCODE)throw new G(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let r={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};v.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(e));const a=await this.taskMutex.lock();if(!this.connection&&i)return void a();if(this.streamingTasks.get(t)&&!i)return a(),new G(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(e))}catch(l){throw a(),l}switch(e){case jn.TRANSCODE:r.transcodingConfig=Qi({},this.transcodingConfig);break;case jn.RAW:break;case jn.INJECT:r={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new K((h,f)=>{hi(this.retryTimeout).then(()=>{if(i)return f(i);const g=this.statusError.get(t);return g?(this.statusError.delete(t),f(g)):void 0})}),u=await K.race([this.connection.request("request",{clientRequest:r},!0,{url:t,command:"PublishStream",workerType:e===jn.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,v.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(u.code)),this.streamingTasks.set(t,{clientRequest:r,mode:e,url:t,taskId:c}),a()}catch(l){if(a(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,e,l)):await this.startLiveStreamingTask(t,e,l)}}stopLiveStreamingTask(t){return new K((e,i)=>{const s=this.streamingTasks.get(t);if(!s||!this.connection)return new G(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const r=s.mode;s.abortTask=()=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),e()},this.connection.request("request",{clientRequest:{command:r===jn.INJECT?"UninjectStream":"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:r===jn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(a=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(a.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&r!==jn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),e(),r===jn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(La.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(i)})}async controlInjectStream(t,e,i,s){const r=this.streamingTasks.get(t);if(!r||!this.connection||r.mode!==jn.INJECT)throw new G(O.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:e,audioVolume:i,position:s}})).serverResponse}resetAllTask(){var t;const e=Array.from(_o(t=this.streamingTasks).call(t));this.terminate();for(const i of e)this.startLiveStreamingTask(i.url,i.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=rs.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new G(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const e=await hn(this,el.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=e,this.connection=new C4(e.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(yr.WARNING,(i,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,i)),this.connection.on(yr.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(yr.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(yr.REQUEST_NEW_ADDRESS,(i,s)=>{if(!this.connection)return s(new G(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));hn(this,el.REQUEST_WORKER_MANAGER_LIST,t).then(r=>{this.uapResponse=r,i(r.addressList)}).catch(s)}),await this.connection.init(e.addressList),this.connection}handlePublishStreamServer(t){const e=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(e),s=t.reason;switch(t.code){case Rn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const a=new G(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return v.error(a.toString()),this.onLiveStreamError&&this.onLiveStreamError(e,a);if(!this.isStartingStreamingTask)return;this.statusError.set(e,a)}case Rn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const a=new G(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(e,a)}case Rn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Rn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var r;if(!this.connection)return;this.connection.tryNextAddress();const a=Array.from(_o(r=this.streamingTasks).call(r));for(const c of a)c.abortTask?c.abortTask():(v.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{v.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)}).catch(l=>{v.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)}));return}}}handleInjectStreamServerStatus(t){const e=Number(t.uid),i=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(La.INJECT_STREAM_STATUS_START_SUCCESS,e,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(La.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,e,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(La.INJECT_STREAM_STATUS_START_UNAUTHORIZED,e,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(La.INJECT_STREAM_STATUS_BROKEN,e,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(La.INJECT_STREAM_STATUS_START_TIMEOUT,e,i),void this.streamingTasks.delete(i);default:return void v.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class C_{constructor(){m(this,"destChannelMediaInfos",new Map),m(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){zA(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){zA(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){WT(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function rO(n){if(!(n instanceof C_))return new G(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=n.getSrcChannelMediaInfo(),e=n.getDestChannelMediaInfo();if(!t)return new G(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(e.size===0)return new G(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class b4 extends rn{constructor(t,e,i){super(),m(this,"ws",void 0),m(this,"requestId",1),m(this,"heartBeatTimer",void 0),m(this,"joinInfo",void 0),m(this,"clientId",void 0),m(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),m(this,"onClose",s=>{this.emit("close"),this.dispose()}),m(this,"onMessage",s=>{const r=JSON.parse(s.data);if(!r||r.command!=="serverResponse"||!r.requestId)return r&&r.command==="serverStatus"&&r.serverStatus&&r.serverStatus.command?(this.emit("status",r.serverStatus),void this.emit(r.serverStatus.command,r.serverStatus)):void 0;this.emit("req_".concat(r.requestId),r)}),this.joinInfo=t,this.clientId=e,this.ws=new Yu("cross-channel-".concat(this.clientId),i),this.ws.on(Jt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Jt.CONNECTED,this.onOpen),this.ws.on(Jt.ON_MESSAGE,this.onMessage),this.ws.on(Jt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const e=this.requestId++;return t.requestId=e,t.seq=e,this.ws.sendMessage(t),e}waitStatus(t){return new K((e,i)=>{const s=window.setTimeout(()=>{i(new G(O.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,r=>{window.clearTimeout(s),r.state&&r.state!==0?i(new G(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):e(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),i(new G(O.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new G(O.WS_DISCONNECT);const e=()=>new K((a,c)=>{this.ws.once(Jt.CLOSED,()=>c(new G(O.WS_ABORT))),this.ws.once(Jt.CONNECTED,a)});this.ws.state!=="connected"&&await e();const i=this.sendMessage(t),s=new K((a,c)=>{const l=()=>{c(new G(O.WS_ABORT))};this.ws.once(Jt.RECONNECTING,l),this.ws.once(Jt.CLOSED,l),this.once("req_".concat(i),a),hi(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Jt.RECONNECTING,l),this.ws.off(Jt.CLOSED,l),c(new G(O.TIMEOUT,"cross channel ws request timeout"))})}),r=await s;if(!r||r.code!==200)throw new G(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(r)));return r}async connect(t){this.ws.removeAllListeners(Jt.REQUEST_NEW_URLS),this.ws.on(Jt.REQUEST_NEW_URLS,e=>{e(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const e=this.requestId++;return t.requestId=e,this.ws.sendMessage(t),e}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class I4 extends rn{set state(t){t!==this._state&&(t!==Gi.RELAY_STATE_FAILURE&&(this.errorCode=ka.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,e,i,s,r){super(),m(this,"joinInfo",void 0),m(this,"sid",void 0),m(this,"clientId",void 0),m(this,"cancelToken",rs.CancelToken.source()),m(this,"workerToken",void 0),m(this,"requestId",0),m(this,"signal",void 0),m(this,"prevChannelMediaConfig",void 0),m(this,"httpRetryConfig",void 0),m(this,"_resolution",void 0),m(this,"_state",Gi.RELAY_STATE_IDLE),m(this,"errorCode",ka.RELAY_OK),m(this,"onStatus",a=>{v.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(a))),a&&a.command&&(a.command==="onAudioPacketReceived"&&this.emit("event",Gr.PACKET_RECEIVED_AUDIO_FROM_SRC),a.command==="onVideoPacketReceived"&&this.emit("event",Gr.PACKET_RECEIVED_VIDEO_FROM_SRC),a.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=ka.SRC_TOKEN_EXPIRED,this.state=Gi.RELAY_STATE_FAILURE),a.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=ka.DEST_TOKEN_EXPIRED,this.state=Gi.RELAY_STATE_FAILURE))}),m(this,"onReconnect",async()=>{v.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Gr.NETWORK_DISCONNECTED),this.state=Gi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(a=>{this.state!==Gi.RELAY_STATE_IDLE&&(v.error("auto restart channel media relay failed",a.toString()),this.errorCode=ka.SERVER_CONNECTION_LOST,this.state=Gi.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=e,this.sid=mT(),this.signal=new b4(this.joinInfo,this.clientId,i),this.httpRetryConfig=s,this._resolution=r}async startChannelMediaRelay(t){if(this.state!==Gi.RELAY_STATE_IDLE)throw new G(O.INVALID_OPERATION);this.state=Gi.RELAY_STATE_CONNECTING,await this.connect(),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(e){throw e.data&&e.data.serverResponse&&e.data.serverResponse.command==="SetSourceChannel"?new G(O.CROSS_CHANNEL_FAILED_JOIN_SRC):e.data&&e.data.serverResponse&&e.serverResponse.command==="SetDestChannelStatus"?new G(O.CROSS_CHANNEL_FAILED_JOIN_DEST):e.data&&e.data.serverResponse&&e.serverResponse.command==="StartPacketTransfer"?new G(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):e}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Gi.RELAY_STATE_RUNNING)throw new G(O.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Gi.RELAY_STATE_RUNNING)throw new G(O.INVALID_OPERATION);const e=this.genMessage(Ii.SetVideoProfile);await this.signal.request(e),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),v.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Gi.RELAY_STATE_IDLE,this.dispose()}dispose(){v.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=rs.CancelToken.source(),this.state=Gi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await S4(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Gr.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const e=this.genMessage(Ii.StopPacketTransfer);await this.signal.request(e),await this.signal.waitStatus("Normal Quit"),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Ii.SetSdkProfile,t);await this.signal.request(i),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Ii.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Gr.PACKET_JOINED_SRC_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const r=this.genMessage(Ii.SetSourceUserId,t);await this.signal.request(r),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const a=this.genMessage(Ii.SetDestChannel,t);await this.signal.request(a),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Gr.PACKET_JOINED_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(Ii.StartPacketTransfer,t);await this.signal.request(c),this.emit("event",Gr.PACKET_SENT_TO_DEST_CHANNEL),this.state=Gi.RELAY_STATE_RUNNING,v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const e=this.genMessage(Ii.UpdateDestChannel,t);await this.signal.request(e),this.emit("event",Gr.PACKET_UPDATE_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Ii.StopPacketTransfer);await this.signal.request(t),v.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,e){const i=[],s=[],r=[];this.requestId+=1;const a={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Zs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};a.sdkVersion==="4.19.1"&&(a.sdkVersion="0.0.1");let c=null,l=null;switch(t){case Ii.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case Ii.SetSourceChannel:if(l=e&&e.getSrcChannelMediaInfo(),!l)throw new G(O.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceChannel",uid:"0",channelName:l.channelName,token:l.token||this.joinInfo.appId},a;case Ii.SetSourceUserId:if(l=e&&e.getSrcChannelMediaInfo(),!l)throw new G(O.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceUserId",uid:l.uid+""},a;case Ii.SetDestChannel:if(c=e&&e.getDestChannelMediaInfo(),!c)throw new G(O.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{i.push(u.channelName),s.push(u.uid+""),r.push(u.token||this.joinInfo.appId)}),a.clientRequest={command:"SetDestChannel",channelName:i,uid:s,token:r},a;case Ii.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case Ii.Reconnect:return a.clientRequest={command:"Reconnect"},a;case Ii.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case Ii.UpdateDestChannel:if(c=e&&e.getDestChannelMediaInfo(),!c)throw new G(O.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{i.push(u.channelName),s.push(u.uid+""),r.push(u.token||this.joinInfo.appId)}),a.clientRequest={command:"UpdateDestChannel",channelName:i,uid:s,token:r},a;case Ii.SetVideoProfile:a.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return a}}class Ti{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,e){m(this,"uid",void 0),m(this,"_uintid",void 0),m(this,"_trust_in_room_",!0),m(this,"_trust_audio_enabled_state_",!0),m(this,"_trust_video_enabled_state_",!0),m(this,"_trust_audio_mute_state_",!0),m(this,"_trust_video_mute_state_",!0),m(this,"_audio_muted_",!1),m(this,"_video_muted_",!1),m(this,"_audio_enabled_",!0),m(this,"_video_enabled_",!0),m(this,"_audio_added_",!1),m(this,"_video_added_",!1),m(this,"_trust_video_stream_added_state_",!0),m(this,"_trust_audio_stream_added_state_",!0),m(this,"_audioTrack",void 0),m(this,"_videoTrack",void 0),m(this,"_dataChannels",[]),m(this,"_audioSSRC",void 0),m(this,"_videoSSRC",void 0),m(this,"_audioOrtc",void 0),m(this,"_videoOrtc",void 0),m(this,"_cname",void 0),m(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=e}}var A4=mI,w4=uo;y({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var n=w4.f(this);return{promise:n.promise,resolve:n.resolve,reject:n.reject}}});var O4=uo,N4=jd;y({target:"Promise",stat:!0,forced:!0},{try:function(n){var t=O4.f(this),e=N4(n);return(e.error?t.reject:t.resolve)(e.value),t.promise}});var YS=rt(A4),oO=Dd.f("asyncIterator"),D4=rt(oO);function zS(n,t){this.v=n,this.k=t}function _h(n){var t,e;function i(r,a){try{var c=n[r](a),l=c.value,u=l instanceof zS;YS.resolve(u?l.v:l).then(function(h){if(u){var f=r==="return"?"return":"next";if(!l.k||h.done)return i(f,h);h=n[f](h).value}s(c.done?"return":"normal",h)},function(h){i("throw",h)})}catch(h){s("throw",h)}}function s(r,a){switch(r){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?i(t.key,t.arg):e=null}this._invoke=function(r,a){return new YS(function(c,l){var u={key:r,arg:a,resolve:c,reject:l,next:null};e?e=e.next=u:(t=e=u,i(r,a))})},typeof n.return!="function"&&(this.return=void 0)}function rr(n){return function(){return new _h(n.apply(this,arguments))}}function Ie(n){return new zS(n,0)}function R_(n){var t={},e=!1;function i(s,r){return e=!0,{done:!1,value:new zS(r=new YS(function(a){a(n[s](r))}),1)}}return t[xd!==void 0&&ZR||"@@iterator"]=function(){return this},t.next=function(s){return e?(e=!1,s):i("next",s)},typeof n.throw=="function"&&(t.throw=function(s){if(e)throw e=!1,s;return i("throw",s)}),typeof n.return=="function"&&(t.return=function(s){return e?(e=!1,s):i("return",s)}),t}_h.prototype[typeof xd=="function"&&D4||"@@asyncIterator"]=function(){return this},_h.prototype.next=function(n){return this._invoke("next",n)},_h.prototype.throw=function(n){return this._invoke("throw",n)},_h.prototype.return=function(n){return this._invoke("return",n)};var aO=rt(oO),cO={exports:{}};(function(n,t){n.exports=(()=>{var e={8:(r,a,c)=>{c.r(a),c.d(a,{Parser:()=>ee,Printer:()=>xn,parse:()=>$t,print:()=>Ae});const l=`
`,u="".concat("\r").concat(l),h=" ";let f;function g(ht){return ht>="0"&&ht<="9"}function S(ht){return ht>="!"&&ht<="~"}function w(ht){return S(ht)||ht>=""&&ht<="ÿ"}function b(ht){return ht==="!"||ht>="#"&&ht<="'"||ht>="*"&&ht<="+"||ht>="-"&&ht<="."||ht>="0"&&ht<="9"||ht>="A"&&ht<="Z"||ht>="^"&&ht<="~"}function I(ht){return ht>="1"&&ht<="9"}function U(ht){return ht>="A"&&ht<="Z"||ht>="a"&&ht<="z"}function F(ht){return ht==="d"||ht==="h"||ht==="m"||ht==="s"}function V(ht){return ht>""&&ht<"	"||ht>"\v"&&ht<"\f"||ht>""&&ht<"ÿ"}function Z(ht){return U(ht)||g(ht)||ht==="+"||ht==="/"}function $(ht){return g(ht)||U(ht)||ht==="+"||ht==="/"||ht==="-"||ht==="_"}function W(ht){return U(ht)||g(ht)||ht==="+"||ht==="/"}function Y(ht,C){var L=Object.keys(ht);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ht);C&&(B=B.filter(function(ct){return Object.getOwnPropertyDescriptor(ht,ct).enumerable})),L.push.apply(L,B)}return L}function nt(ht){for(var C=1;C<arguments.length;C++){var L=arguments[C]!=null?arguments[C]:{};C%2?Y(Object(L),!0).forEach(function(B){mt(ht,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ht,Object.getOwnPropertyDescriptors(L)):Y(Object(L)).forEach(function(B){Object.defineProperty(ht,B,Object.getOwnPropertyDescriptor(L,B))})}return ht}function mt(ht,C,L){return C in ht?Object.defineProperty(ht,C,{value:L,enumerable:!0,configurable:!0,writable:!0}):ht[C]=L,ht}(function(ht){ht.VERSION="v",ht.ORIGIN="o",ht.SESSION_NAME="s",ht.INFORMATION="i",ht.URI="u",ht.EMAIL="e",ht.PHONE="p",ht.CONNECTION="c",ht.BANDWIDTH="b",ht.TIME="t",ht.REPEAT="r",ht.ZONE_ADJUSTMENTS="z",ht.KEY="k",ht.ATTRIBUTE="a",ht.MEDIA="m"})(f||(f={}));class ut{consumeText(C,L){let B=L;for(;B<C.length;){const ct=C[B];if(ct==="\0"||ct==="\r"||ct===l)break;B+=1}if(B-L==0)throw new Error("Invalid text, at ".concat(C));return B}consumeUnicastAddress(C,L,B){return this.consumeTill(C,L,h)}consumeOneOrMore(C,L,B){let ct=L;for(;B(C[ct]);)ct++;if(ct-L==0)throw new Error("Invalid rule at ".concat(L,"."));return ct}consumeSpace(C,L){if(C[L]===h)return L+1;throw new Error("Invalid space at ".concat(L,"."))}consumeIP4Address(C,L){let B=L;for(let ct=0;ct<4;ct++)if(B=this.consumeDecimalUChar(C,B),ct!==3){if(C[B]!==".")throw new Error("Invalid IP4 address.");B++}return B}consumeDecimalUChar(C,L){let B=L;for(let ne=0;ne<3&&g(C[B]);ne++,B++);if(B-L==0)throw new Error("Invalid decimal uchar.");const ct=parseInt(C.slice(L,B));if(ct>=0&&ct<=255)return B;throw new Error("Invalid decimal uchar")}consumeIP6Address(C,L){let B=this.consumeHexpart(C,L);return C[B]===":"&&(B+=1,B=this.consumeIP4Address(C,B)),B}consumeHexpart(C,L){let B=L;if(C[B]===":"&&C[B+1]===":"){B+=2;try{B=this.consumeHexseq(C,B)}catch{}return B}if(B=this.consumeHexseq(C,B),C[B]===":"&&C[B+1]===":"){B+=2;try{B=this.consumeHexseq(C,B)}catch{}return B}return B}consumeHexseq(C,L){let B=L;for(;B=this.consumeHex4(C,B),C[B]===":"&&C[B+1]!==":";)B+=1;return B}consumeHex4(C,L){let B=0;for(;B<4;B++)if(!((ct=C[L+B])>="0"&&ct<="9"||ct>="a"&&ct<="f"||ct>="A"&&ct<="F")){if(B===0)throw new Error("Invalid hex 4");break}var ct;return L+B}consumeFQDN(C,L){let B=L;for(;g(C[B])||U(C[B])||C[B]==="-"||C[B]===".";)B+=1;if(B-L<4)throw new Error("Invalid FQDN");return B}consumeExtnAddr(C,L){return this.consumeOneOrMore(C,L,w)}consumeMulticastAddress(C,L,B){switch(B){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(C,L);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(C,L);default:try{return this.consumeFQDN(C,L)}catch{return this.consumeExtnAddr(C,L)}}}consumeIP6MulticastAddress(C,L){const B=this.consumeHexpart(C,L);return C[B]==="/"?this.consumeInteger(C,B+1):B}consumeIP4MulticastAddress(C,L){let B=L+3;const ct=C.slice(L,B),ne=parseInt(ct);if(ne<224||ne>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Ze=0;Ze<3;Ze++){if(C[B]!==".")throw new Error("Invalid IP4 multicast address.");B+=1,B=this.consumeDecimalUChar(C,B)}return C[B]==="/"&&(B+=1),B=this.consumeTTL(C,B),C[B]==="/"&&(B=this.consumeInteger(C,B)),B}consumeInteger(C,L){if(!I(C[L]))throw new Error("Invalid integer.");for(L+=1;g(C[L]);)L+=1;return L}consumeTTL(C,L){if(C[L]==="0")return L+1;if(!I(C[L]))throw new Error("Invalid TTL.");L+=1;for(let B=0;B<2&&g(C[L]);B++)L+=1;return L}consumeToken(C,L){return this.consumeOneOrMore(C,L,b)}consumeTime(C,L){let B=L;if(C[B]==="0")return B+1;for(I(C[B])&&(B+=1);g(C[B]);)B++;if(B-L<10)throw new Error("Invalid time");return B}consumeAddress(C,L){return this.consumeTill(C,L,h)}consumeTypedTime(C,L){let B=L;return B=this.consumeOneOrMore(C,B,g),F(C[B])?B+1:B}consumeRepeatInterval(C,L){if(!I(C[L]))throw new Error("Invalid repeat interval");for(L+=1;g(C[L]);)L+=1;return F(C[L])&&(L+=1),L}consumePort(C,L){return this.consumeOneOrMore(C,L,g)}consume(C,L,B){for(let ct=0;ct<B.length;ct++){if(L+ct>=C.length)throw new Error("consume exceeding value length");if(C[L+ct]!==B[ct])throw new Error("consume ".concat(B," failed at ").concat(ct))}return L+B.length}consumeTill(C,L,B){let ct=L;for(;ct<C.length&&(typeof B!="string"||C[ct]!==B)&&(typeof B!="function"||!B(C[ct]));)ct++;return ct}}class ee extends ut{constructor(){super(),mt(this,"records",[]),mt(this,"currentLine",0)}parse(C){const L=this.probeEOL(C);this.records=C.split(L).filter(Vn=>!!Vn.trim()).map(this.parseLine),this.currentLine=0;const B=this.parseVersion(),ct=this.parseOrigin(),ne=this.parseSessionName(),Ze=this.parseInformation(),Si=this.parseUri(),Ts=this.parseEmail(),ra=this.parsePhone(),V_=this.parseConnection(),F_=this.parseBandWidth(),ur=this.parseTimeFields(),Qa=this.parseKey(),yl=this.parseSessionAttribute(),Sn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:B,origin:ct,sessionName:ne,information:Ze,uri:Si,emails:Ts,phones:ra,connection:V_,bandwidths:F_,timeFields:ur,key:Qa,attributes:yl,mediaDescriptions:Sn}}getCurrentRecord(){const C=this.records[this.currentLine];if(!C)throw new Error("Record doesn't exit.");return C}probeEOL(C){for(let L=0;L<C.length;L++)if(C[L]===l)return C[L-1]==="\r"?u:l;throw new Error("Invalid newline character.")}parseLine(C,L){if(C.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const B=C[0];if(C[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:B,value:C.slice(2),line:L,cur:0}}parseSessionAttribute(){const C=new be;for(;this.currentLine<this.records.length;){const L=this.getCurrentRecord();if(L.type!==f.ATTRIBUTE)break;const B={attField:this.extractOneOrMore(L,ct=>b(ct)&&ct!==":"),_cur:0};L.value[L.cur]===":"&&(L.cur+=1,B.attValue=this.extractOneOrMore(L,V)),C.parse(B),this.currentLine++}return C.digest()}parseMediaAttributes(C){const L=new Fe(C);for(;this.currentLine<this.records.length;){const B=this.getCurrentRecord();if(B.type!==f.ATTRIBUTE)break;const ct={attField:this.extractOneOrMore(B,ne=>b(ne)&&ne!==":"),_cur:0};B.value[B.cur]===":"&&(B.cur+=1,ct.attValue=this.extractOneOrMore(B,V)),L.parse(ct),this.currentLine++}return L.digest()}parseKey(){const C=this.getCurrentRecord();if(C.type===f.KEY){if(C.value==="prompt"||C.value==="clear:"||C.value==="base64:"||C.value==="uri:")return C.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const C=this.getCurrentRecord();if(C.type===f.ZONE_ADJUSTMENTS){const L=[];for(;;)try{const B=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let ct=!1;C.value[C.cur]==="-"&&(ct=!0,C.cur+=1);const ne=this.extract(C,this.consumeTypedTime);L.push({time:B,typedTime:ne,back:ct})}catch{break}if(L.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,L}return[]}parseRepeat(){const C=[];for(;;){const L=this.getCurrentRecord();if(L.type!==f.REPEAT)break;{const B=this.extract(L,this.consumeRepeatInterval),ct=this.parseTypedTime(L);C.push({repeatInterval:B,typedTimes:ct}),this.currentLine++}}return C}parseTypedTime(C){const L=[];for(;;)try{this.consumeSpaceForRecord(C),L.push(this.extract(C,this.consumeTypedTime))}catch{break}if(L.length===0)throw new Error("Invalid typed time.");return L}parseTime(){const C=this.getCurrentRecord(),L=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);const B=this.extract(C,this.consumeTime);return this.currentLine++,{startTime:L,stopTime:B}}parseBandWidth(){const C=[];for(;this.currentLine<this.records.length;){const L=this.getCurrentRecord();if(L.type!==f.BANDWIDTH)break;{const B=this.extractOneOrMore(L,b);if(L.value[L.cur]!==":")throw new Error("Invalid bandwidth field.");L.cur++;const ct=this.extractOneOrMore(L,g);C.push({bwtype:B,bandwidth:ct}),this.currentLine++}}return C}parseVersion(){const C=this.getCurrentRecord();if(C.type!==f.VERSION)throw new Error("first sdp record must be version");const L=C.value.slice(0,this.consumeOneOrMore(C.value,0,g));if(L.length!==C.value.length)throw new Error('invalid proto version, "v='.concat(C.value,'"'));return this.currentLine++,L}parseOrigin(){const C=this.getCurrentRecord();if(C.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");const L=this.extractOneOrMore(C,w);this.consumeSpaceForRecord(C);const B=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const ct=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const ne=this.extractOneOrMore(C,b);this.consumeSpaceForRecord(C);const Ze=this.extractOneOrMore(C,b);this.consumeSpaceForRecord(C);const Si=this.extract(C,this.consumeUnicastAddress);return this.currentLine++,{username:L,sessId:B,sessVersion:ct,nettype:ne,addrtype:Ze,unicastAddress:Si}}parseSessionName(){const C=this.getCurrentRecord();if(C.type===f.SESSION_NAME){const L=this.extract(C,this.consumeText);return this.currentLine++,L}}parseInformation(){const C=this.getCurrentRecord();if(C.type!==f.INFORMATION)return;const L=this.extract(C,this.consumeText);return this.currentLine++,L}parseUri(){const C=this.getCurrentRecord();if(C.type===f.URI)return this.currentLine++,C.value}parseEmail(){const C=[];for(;;){const L=this.getCurrentRecord();if(L.type!==f.EMAIL)break;C.push(L.value),this.currentLine++}return C}parsePhone(){const C=[];for(;;){const L=this.getCurrentRecord();if(L.type!==f.PHONE)break;C.push(L.value),this.currentLine++}return C}parseConnection(){const C=this.getCurrentRecord();if(C.type===f.CONNECTION){const L=this.extractOneOrMore(C,b);this.consumeSpaceForRecord(C);const B=this.extractOneOrMore(C,b);this.consumeSpaceForRecord(C);const ct=this.extract(C,this.consumeAddress);return this.currentLine++,{nettype:L,addrtype:B,address:ct}}}parseMedia(){const C=this.getCurrentRecord(),L=this.extract(C,this.consumeToken);this.consumeSpaceForRecord(C);let B=this.extract(C,this.consumePort);C.value[C.cur]==="/"&&(C.cur+=1,B+=this.extract(C,this.consumeInteger)),this.consumeSpaceForRecord(C);const ct=[];for(ct.push(this.extract(C,this.consumeToken));C.value[C.cur]==="/";)C.cur+=1,ct.push(this.extract(C,this.consumeToken));if(ct.length===0)throw new Error("Invalid proto");const ne=this.parseFmt(C);return this.currentLine++,{mediaType:L,port:B,protos:ct,fmts:ne}}parseTimeFields(){const C=[];for(;this.getCurrentRecord().type===f.TIME;){const L=this.parseTime(),B=this.parseRepeat(),ct=this.parseZone();C.push({time:L,repeats:B,zones:ct})}return C}parseMediaDescription(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){const L=this.parseMedia(),B=this.parseInformation(),ct=this.parseConnections(),ne=this.parseBandWidth(),Ze=this.parseKey(),Si=this.parseMediaAttributes(L);C.push({media:L,information:B,connections:ct,bandwidths:ne,key:Ze,attributes:Si})}return C}parseConnections(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)C.push(this.parseConnection());return C}parseFmt(C){const L=[];for(;;)try{this.consumeSpaceForRecord(C),L.push(this.extract(C,this.consumeToken))}catch{break}if(L.length===0)throw new Error("Invalid fmts");return L}extract(C,L,...B){const ct=L.call(this,C.value,C.cur,...B),ne=C.value.slice(C.cur,ct);return C.cur=ct,ne}extractOneOrMore(C,L){const B=this.consumeOneOrMore(C.value,C.cur,L),ct=C.value.slice(C.cur,B);return C.cur=B,ct}consumeSpaceForRecord(C){if(C.value[C.cur]!==h)throw new Error("Invalid space at ".concat(C.cur,"."));C.cur+=1}}class Te extends ut{constructor(...C){super(...C),mt(this,"attributes",void 0),mt(this,"digested",!1)}extractOneOrMore(C,L,B){const ct=this.consumeOneOrMore(C.attValue,C._cur,L),ne=C.attValue.slice(C._cur,ct),[Ze,Si]=B||[];if(typeof Ze=="number"&&ne.length<Ze)throw new Error("error in length, should be more or equal than ".concat(Ze," characters."));if(typeof Si=="number"&&ne.length>Si)throw new Error("error in length, should be less or equal than ".concat(Si," characters."));return C._cur=ct,ne}consumeAttributeSpace(C){if(C.attValue[C._cur]!==h)throw new Error("Invalid space at ".concat(C._cur,"."));C._cur+=1}extract(C,L,...B){if(!C.attValue)throw new Error("Nothing to extract from attValue.");const ct=L.call(this,C.attValue,C._cur,...B),ne=C.attValue.slice(C._cur,ct);return C._cur=ct,ne}atEnd(C){if(!C.attValue)throw new Error;return C._cur>=C.attValue.length}peekChar(C){if(!C.attValue)throw new Error;return C.attValue[C._cur]}peek(C,L){if(!C.attValue)throw new Error;for(let B=0;B<L.length;B++)if(L[B]!==C.attValue[C._cur+B])return!1;return!0}parseIceUfrag(C){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(C,Z,[4,256])}parseIcePwd(C){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(C,Z,[22,256])}parseIceOptions(C){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const L=[];for(;!this.atEnd(C);){L.push(this.extractOneOrMore(C,Z));try{this.consumeAttributeSpace(C)}catch(B){if(this.atEnd(C))break;throw B}}this.attributes.iceOptions=L}parseFingerprint(C){const L=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill);this.attributes.fingerprints.push({hashFunction:L,fingerprint:B})}parseExtmap(C){const L=this.extractOneOrMore(C,g);let B;this.peekChar(C)==="/"&&(this.extract(C,this.consume,"/"),B=this.extract(C,this.consumeToken)),this.consumeAttributeSpace(C);const ct=this.extract(C,this.consumeTill,h),ne=nt(nt({entry:parseInt(L,10)},B&&{direction:B}),{},{extensionName:ct});this.peekChar(C)===h&&(this.consumeAttributeSpace(C),ne.extensionAttributes=this.extract(C,this.consumeTill)),this.attributes.extmaps.push(ne)}parseSetup(C){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const L=this.extract(C,this.consumeTill);if(L!=="active"&&L!=="passive"&&L!=="actpass"&&L!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=L}}class be extends Te{constructor(...C){super(...C),mt(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"group":this.parseGroup(C);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"fingerprint":this.parseFingerprint(C);break;case"setup":this.parseSetup(C);break;case"tls-id":this.parseTlsId(C);break;case"identity":this.parseIdentity(C);break;case"extmap":this.parseExtmap(C);break;case"msid-semantic":this.parseMsidSemantic(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(L){throw console.error("parsing session attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),L}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(C){const L=this.extract(C,this.consumeToken),B=[];for(;!this.atEnd(C)&&this.peekChar(C)===h;)this.consumeAttributeSpace(C),B.push(this.extract(C,this.consumeToken));this.attributes.groups.push({semantic:L,identificationTag:B})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(C){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(C,$)}parseIdentity(C){const L=this.extractOneOrMore(C,W),B=[];for(;!this.atEnd(C)&&this.peekChar(C)===h;){this.consumeAttributeSpace(C);const ct=this.extract(C,this.consumeToken);this.extract(C,this.consume,"=");const ne=this.extractOneOrMore(C,Ze=>Ze!==h&&V(Ze));B.push({name:ct,value:ne})}this.attributes.identities.push({assertionValue:L,extensions:B})}parseMsidSemantic(C){this.peekChar(C)===h&&this.consumeAttributeSpace(C);const L={semantic:this.extract(C,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(C)}catch{break}if(this.peekChar(C)==="*"){this.extract(C,this.consume,"*"),L.applyForAll=!0;break}{const B=this.extract(C,this.consumeTill,h);L.identifierList.push(B)}}this.attributes.msidSemantic=L}}class Fe extends Te{constructor(C){super(),mt(this,"attributes",void 0),C.protos.indexOf("RTP")!==-1||C.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"extmap":this.parseExtmap(C);break;case"setup":this.parseSetup(C);break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"candidate":this.parseCandidate(C);break;case"remote-candidate":this.parseRemoteCandidate(C);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(C);break;case"rtpmap":this.parseRtpmap(C);break;case"ptime":this.parsePtime(C);break;case"maxptime":this.parseMaxPtime(C);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(C);break;case"ssrc":this.parseSSRC(C);break;case"fmtp":this.parseFmtp(C);break;case"rtcp-fb":this.parseRtcpFb(C);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(C);break;case"mid":this.parseMid(C);break;case"msid":this.parseMsid(C);break;case"imageattr":this.parseImageAttr(C);break;case"rid":this.parseRid(C);break;case"simulcast":this.parseSimulcast(C);break;case"sctp-port":this.parseSctpPort(C);break;case"max-message-size":this.parseMaxMessageSize(C);break;case"ssrc-group":this.parseSSRCGroup(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(L){throw console.error("parsing media attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),L}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}parseCandidate(C){const L=this.extractOneOrMore(C,Z,[1,32]);this.consumeAttributeSpace(C);const B=this.extractOneOrMore(C,g,[1,5]);this.consumeAttributeSpace(C);const ct=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const ne=this.extractOneOrMore(C,g,[1,10]);this.consumeAttributeSpace(C);const Ze=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const Si=this.extract(C,this.consumePort);this.consumeAttributeSpace(C),this.extract(C,this.consume,"typ"),this.consumeAttributeSpace(C);const Ts={foundation:L,componentId:B,transport:ct,priority:ne,connectionAddress:Ze,port:Si,type:this.extract(C,this.consumeToken),extension:{}};for(this.peek(C," raddr")&&(this.extract(C,this.consume," raddr"),this.consumeAttributeSpace(C),Ts.relAddr=this.extract(C,this.consumeAddress)),this.peek(C," rport")&&(this.extract(C,this.consume," rport"),this.consumeAttributeSpace(C),Ts.relPort=this.extract(C,this.consumePort));this.peekChar(C)===h;){this.consumeAttributeSpace(C);const ra=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C),Ts.extension[ra]=this.extractOneOrMore(C,S)}this.attributes.candidates.push(Ts)}parseRemoteCandidate(C){const L=[];for(;;){const B=this.extractOneOrMore(C,g,[1,5]);this.consumeAttributeSpace(C);const ct=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const ne=this.extract(C,this.consumePort);L.push({componentId:B,connectionAddress:ct,port:ne});try{this.consumeAttributeSpace(C)}catch{break}}this.attributes.remoteCandidatesList.push(L)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(C){const L=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill,"/");this.extract(C,this.consume,"/");const ct={encodingName:B,clockRate:this.extractOneOrMore(C,g)};this.atEnd(C)||this.peekChar(C)!=="/"||(this.extract(C,this.consume,"/"),ct.encodingParameters=parseInt(this.extract(C,this.consumeTill),10));const ne=this.attributes.payloads.find(Ze=>Ze.payloadType===parseInt(L,10));ne?ne.rtpMap=ct:this.attributes.payloads.push({payloadType:parseInt(L,10),rtpMap:ct,rtcpFeedbacks:[]})}parsePtime(C){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(C,this.consumeTill)}parseMaxPtime(C){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(C,this.consumeTill)}parseDirection(C){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=C.attField}parseSSRC(C){const L=this.extractOneOrMore(C,g);this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill,":");let ct;this.peekChar(C)===":"&&(this.extract(C,this.consume,":"),ct=this.extract(C,this.consumeTill));const ne=this.attributes.ssrcs.find(Ze=>Ze.ssrcId===parseInt(L,10));ne?ne.attributes[B]=ct:this.attributes.ssrcs.push({ssrcId:parseInt(L,10),attributes:{[B]:ct}})}parseFmtp(C){const L=this.extract(C,this.consumeTill,h);this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill),ct={};B.split(";").forEach(Ze=>{let[Si,Ts]=Ze.split("=");Si=Si.trim();const ra=typeof Ts=="string"?Ts.trim():null;typeof Si=="string"&&Si.length>0&&(ct[Si]=ra)});const ne=this.attributes.payloads.find(Ze=>Ze.payloadType===parseInt(L,10));ne?ne.fmtp={parameters:ct}:this.attributes.payloads.push({payloadType:parseInt(L,10),rtcpFeedbacks:[],fmtp:{parameters:ct}})}parseFmtParameters(C){const L={},B=this.extract(C,this.consumeTill,"=");C._cur++;const ct=this.extract(C,this.consumeTill,";");for(L[B]=ct;C.attValue[C._cur]===";";){const ne=this.extract(C,this.consumeTill,"=");C._cur++;const Ze=this.extract(C,this.consumeTill,";");L[ne]=Ze}return L}parseRtcpFb(C){let L="";L=this.peekChar(C)==="*"?this.extract(C,this.consume,"*"):this.extract(C,this.consumeTill,h),this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill,h);let ct;if(B==="trr-int")ct={type:B,interval:this.extract(C,this.consumeTill)};else{const ne={type:B};this.peekChar(C)===h&&(this.consumeAttributeSpace(C),ne.parameter=this.extract(C,this.consumeToken),this.peekChar(C)===h&&(ne.additional=this.extract(C,this.consumeTill))),ct=ne}if(L==="*")this.attributes.rtcpFeedbackWildcards.push(ct);else{const ne=this.attributes.payloads.find(Ze=>Ze.payloadType===parseInt(L,10));ne?ne.rtcpFeedbacks.push(ct):this.attributes.payloads.push({payloadType:parseInt(L,10),rtcpFeedbacks:[ct]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(C){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const L={port:this.extract(C,this.consumePort)};this.peekChar(C)===h&&(this.consumeAttributeSpace(C),L.netType=this.extractOneOrMore(C,b),this.consumeAttributeSpace(C),L.addressType=this.extractOneOrMore(C,b),this.consumeAttributeSpace(C),L.address=this.extract(C,this.consumeAddress)),this.attributes.rtcp=L}parseMsid(C){const L={id:this.extractOneOrMore(C,b,[1,64])};this.peekChar(C)===h&&(this.consumeAttributeSpace(C),L.appdata=this.extractOneOrMore(C,b,[1,64])),this.attributes.msids.push(L)}parseImageAttr(C){this.attributes.imageattr.push(C.attValue)}parseRid(C){const L=this.extractOneOrMore(C,ct=>U(ct)||g(ct)||ct==="_"||ct==="-");this.consumeAttributeSpace(C);const B={id:L,direction:this.extract(C,this.consumeToken),params:[]};if(this.peekChar(C)===h){if(this.consumeAttributeSpace(C),this.peek(C,"pt=")){this.extract(C,this.consume,"pt=");const ct=[];for(;;){const ne=this.extract(C,this.consumeToken);ct.push(ne);try{this.extract(C,this.consume,",")}catch{break}}B.payloads=ct,this.peekChar(C)===h&&this.extract(C,this.consume,h)}for(;;){const ct=this.extract(C,this.consumeToken);switch(ct){case"depend":{const ne={type:ct,rids:this.extract(C,this.consume,"=").split(",")};B.params.push(ne);break}default:{const ne={type:ct};this.peekChar(C)==="="&&(this.extract(C,this.consume,"="),ne.val=this.extract(C,this.consumeTill,";")),B.params.push(ne)}}try{this.extract(C,this.consume,";")}catch{break}}}this.attributes.rids.push(B)}parseSimulcast(C){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=C.attValue,this.extract(C,this.consumeTill)}parseSctpPort(C){this.attributes.sctpPort=this.extractOneOrMore(C,g,[1,5])}parseMaxMessageSize(C){this.attributes.maxMessageSize=this.extractOneOrMore(C,g,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(C){this.attributes.mid=this.extract(C,this.consumeToken)}parseSSRCGroup(C){const L=this.extract(C,this.consumeToken),B=[];for(;;)try{this.consumeAttributeSpace(C);const ct=this.extract(C,this.consumeInteger);B.push(parseInt(ct,10))}catch{break}this.attributes.ssrcGroups.push({semantic:L,ssrcIds:B})}}function _e(ht,C,L){return C in ht?Object.defineProperty(ht,C,{value:L,enumerable:!0,configurable:!0,writable:!0}):ht[C]=L,ht}class xn{constructor(){_e(this,"eol",u)}print(C,L){let B="";return L&&(this.eol=L),B+=this.printVersion(C.version),B+=this.printOrigin(C.origin),B+=this.printSessionName(C.sessionName),B+=this.printInformation(C.information),B+=this.printUri(C.uri),B+=this.printEmail(C.emails),B+=this.printPhone(C.phones),B+=this.printConnection(C.connection),B+=this.printBandwidth(C.bandwidths),B+=this.printTimeFields(C.timeFields),B+=this.printKey(C.key),B+=this.printSessionAttributes(C.attributes),B+=this.printMediaDescription(C.mediaDescriptions),B}printVersion(C){return"v=".concat(C).concat(this.eol)}printOrigin(C){return"o=".concat(C.username," ").concat(C.sessId," ").concat(C.sessVersion," ").concat(C.nettype," ").concat(C.addrtype," ").concat(C.unicastAddress).concat(this.eol)}printSessionName(C){return C?"s=".concat(C).concat(this.eol):""}printInformation(C){return C?"i=".concat(C).concat(this.eol):""}printUri(C){return C?"u=".concat(C).concat(this.eol):""}printEmail(C){let L="";for(const B of C)L+="e=".concat(B).concat(this.eol);return L}printPhone(C){let L="";for(const B of C)L+="e=".concat(B).concat(this.eol);return L}printConnection(C){return C?"c=".concat(C.nettype," ").concat(C.addrtype," ").concat(C.address).concat(this.eol):""}printBandwidth(C){let L="";for(const B of C)L+="b=".concat(B.bwtype,":").concat(B.bandwidth).concat(this.eol);return L}printTimeFields(C){let L="";for(const B of C){L+="t=".concat(B.time.startTime," ").concat(B.time.startTime).concat(this.eol);for(const ct of B.repeats)L+="r=".concat(ct.repeatInterval," ").concat(ct.typedTimes.join(" ")).concat(this.eol);B.zoneAdjustments&&(L+="z=",L+="z=".concat(B.zoneAdjustments.map(ct=>"".concat(ct.time," ").concat(ct.back?"-":""," ").concat(ct.typedTime)).join(" ")).concat(this.eol),L+=this.eol)}return L}printKey(C){return C?"k=".concat(C).concat(this.eol):""}printAttributes(C){let L="";for(const B of C)L+="a=".concat(B.attField).concat(B.attValue?":".concat(B.attValue):"").concat(this.eol);return L}printMediaDescription(C){let L="";for(const B of C)L+=this.printMedia(B.media),L+=this.printInformation(B.information),L+=this.printConnections(B.connections),L+=this.printBandwidth(B.bandwidths),L+=this.printKey(B.key),L+=this.printMediaAttributes(B);return L}printConnections(C){let L="";for(const B of C)L+=this.printConnection(B);return L}printMedia(C){return"m=".concat(C.mediaType," ").concat(C.port," ").concat(C.protos.join("/")," ").concat(C.fmts.join(" ")).concat(this.eol)}printSessionAttributes(C){return new dt(this.eol).print(C)}printMediaAttributes(C){return new Rt(this.eol).print(C)}}class it{constructor(C){_e(this,"eol",void 0),this.eol=C}printIceUfrag(C){return C===void 0?"":"a=ice-ufrag:".concat(C).concat(this.eol)}printIcePwd(C){return C===void 0?"":"a=ice-pwd:".concat(C).concat(this.eol)}printIceOptions(C){return C===void 0?"":"a=ice-options:".concat(C.join(h)).concat(this.eol)}printFingerprints(C){return C.length>0?C.map(L=>"a=fingerprint:".concat(L.hashFunction).concat(h).concat(L.fingerprint)).join(this.eol)+this.eol:""}printExtmap(C){return C.map(L=>"a=extmap:".concat(L.entry).concat(L.direction?"/".concat(L.direction):"").concat(h).concat(L.extensionName).concat(L.extensionAttributes?"".concat(h).concat(L.extensionAttributes):"").concat(this.eol)).join("")}printSetup(C){return C===void 0?"":"a=setup:".concat(C).concat(this.eol)}printUnrecognized(C){return C.map(L=>"a=".concat(L.attField).concat(L.attValue?":".concat(L.attValue):"").concat(this.eol)).join("")}}class dt extends it{print(C){let L="";return L+=this.printGroups(C.groups),L+=this.printMsidSemantic(C.msidSemantic),L+=this.printIceLite(C.iceLite),L+=this.printIceUfrag(C.iceUfrag),L+=this.printIcePwd(C.icePwd),L+=this.printIceOptions(C.iceOptions),L+=this.printFingerprints(C.fingerprints),L+=this.printSetup(C.setup),L+=this.printTlsId(C.tlsId),L+=this.printIdentity(C.identities),L+=this.printExtmap(C.extmaps),L+=this.printUnrecognized(C.unrecognized),L}printGroups(C){let L="";return C.length>0&&(L+=C.map(B=>"a=group:".concat(B.semantic).concat(B.identificationTag.map(ct=>"".concat(h).concat(ct)).join("")).concat(this.eol)).join("")),L}printIceLite(C){return C===void 0?"":"a=ice-lite"+this.eol}printTlsId(C){return C?"a=tls-id:".concat(C).concat(this.eol):""}printIdentity(C){return C.length===0?"":C.map(L=>"a=identity:".concat(L.assertionValue).concat(L.extensions.map(B=>"".concat(h).concat(B.name).concat(B.value?"=".concat(B.value):"")))).join(this.eol)+this.eol}printMsidSemantic(C){if(!C)return"";let L="a=msid-semantic:".concat(C.semantic);return C.applyForAll?L+="".concat(h,"*"):C.identifierList.length>0&&(L+=C.identifierList.map(B=>"".concat(h).concat(B))),L+this.eol}}class Rt extends it{print(C){const L=C.attributes;let B="";return B+=this.printRTCP(L.rtcp),B+=this.printIceUfrag(L.iceUfrag),B+=this.printIcePwd(L.icePwd),B+=this.printIceOptions(L.iceOptions),B+=this.printCandidates(L.candidates),B+=this.printRemoteCandidatesList(L.remoteCandidatesList),B+=this.printEndOfCandidates(L.endOfCandidates),B+=this.printFingerprints(L.fingerprints),B+=this.printSetup(L.setup),B+=this.printMid(L.mid),B+=this.printExtmap(L.extmaps),B+=this.printRTPRelated(L),B+=this.printPtime(L.ptime),B+=this.printMaxPtime(L.maxPtime),B+=this.printDirection(L.direction),B+=this.printSSRCGroups(L.ssrcGroups),B+=this.printSSRC(L.ssrcs),B+=this.printRTCPMux(L.rtcpMux),B+=this.printRTCPMuxOnly(L.rtcpMuxOnly),B+=this.printRTCPRsize(L.rtcpRsize),B+=this.printMSId(L.msids),B+=this.printImageattr(L.imageattr),B+=this.printRid(L.rids),B+=this.printSimulcast(L.simulcast),B+=this.printSCTPPort(L.sctpPort),B+=this.printMaxMessageSize(L.maxMessageSize),B+=this.printUnrecognized(L.unrecognized),B}printCandidates(C){return C.map(L=>"a=candidate:".concat(L.foundation).concat(h).concat(L.componentId).concat(h).concat(L.transport).concat(h).concat(L.priority).concat(h).concat(L.connectionAddress).concat(h).concat(L.port).concat(h,"typ").concat(h).concat(L.type).concat(L.relAddr?"".concat(h,"raddr").concat(h).concat(L.relAddr):"").concat(L.relPort?"".concat(h,"rport").concat(h).concat(L.relPort):"").concat(Object.keys(L.extension).map(B=>"".concat(h).concat(B).concat(h).concat(L.extension[B])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(C){return C.map(L=>"a=remote-candidates:".concat(L.join(h)).concat(this.eol)).join("")}printEndOfCandidates(C){return C===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(C){if(!C.payloads)return"";const L=C.payloads;let B="";B+=C.rtcpFeedbackWildcards.map(ct=>this.printRTCPFeedback("*",ct)).join("");for(const ct of L)B+=this.printRtpMap(ct.payloadType,ct.rtpMap),B+=this.printFmtp(ct.payloadType,ct.fmtp),B+=ct.rtcpFeedbacks.map(ne=>this.printRTCPFeedback(ct.payloadType,ne)).join("");return B}printFmtp(C,L){if(!L)return"";const B=Object.keys(L.parameters);return B.length===1&&L.parameters[B[0]]===null?"a=fmtp:".concat(C).concat(h).concat(B[0]).concat(this.eol):"a=fmtp:".concat(C).concat(h).concat(Object.keys(L.parameters).map(ct=>"".concat(ct,"=").concat(L.parameters[ct])).join(";")).concat(this.eol)}printRtpMap(C,L){return L?"a=rtpmap:".concat(C).concat(h).concat(L.encodingName,"/").concat(L.clockRate).concat(L.encodingParameters?"/".concat(L.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(C,L){let B="a=rtcp-fb:".concat(C).concat(h),ct=L;return ct.type==="trr-int"?B+="ttr-int".concat(h).concat(ct.interval):(B+="".concat(ct.type),ct.parameter&&(B+="".concat(h).concat(ct.parameter),ct.additional&&(B+="".concat(h).concat(ct.additional)))),B+this.eol}printPtime(C){return C===void 0?"":"a=ptime:".concat(C).concat(this.eol)}printMaxPtime(C){return C===void 0?"":"a=maxptime:".concat(C).concat(this.eol)}printDirection(C){return C===void 0?"":"a=".concat(C).concat(this.eol)}printSSRC(C){return C.map(L=>Object.keys(L.attributes).map(B=>"a=ssrc:".concat(L.ssrcId.toString(10)).concat(h).concat(B).concat(L.attributes[B]?":".concat(L.attributes[B]):"").concat(this.eol)).join("")).join("")}printRTCPMux(C){return C===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(C){return C===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(C){return C===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(C){if(C===void 0)return"";let L="a=rtcp:".concat(C.port);return C.netType&&(L+="".concat(h).concat(C.netType)),C.addressType&&(L+="".concat(h).concat(C.addressType)),C.address&&(L+="".concat(h).concat(C.address)),L+this.eol}printMSId(C){return C.map(L=>"a=msid:".concat(L.id).concat(L.appdata?"".concat(h).concat(L.appdata):"").concat(this.eol)).join("")}printImageattr(C){return C.map(L=>"a=imageattr:".concat(L).concat(this.eol)).join("")}printRid(C){return C.map(L=>{let B="a=rid:".concat(L.id).concat(h).concat(L.direction);return L.payloads&&(B+="".concat(h,"pt=").concat(L.payloads.join(","))),L.params.length>0&&(B+="".concat(h).concat(L.params.map(ct=>ct.type==="depend"?"depend=".concat(ct.rids.join(",")):"".concat(ct.type,"=").concat(ct.val)).join(";"))),B+this.eol}).join("")}printSimulcast(C){return C===void 0?"":"a=simulcast:".concat(C).concat(this.eol)}printSCTPPort(C){return C===void 0?"":"a=sctp-port:".concat(C).concat(this.eol)}printMaxMessageSize(C){return C===void 0?"":"a=max-message-size:".concat(C).concat(this.eol)}printMid(C){return C===void 0?"":"a=mid:".concat(C).concat(this.eol)}printSSRCGroups(C){return C.map(L=>"a=ssrc-group:".concat(L.semantic).concat(L.ssrcIds.map(B=>"".concat(h).concat(B.toString(10))).join("")).concat(this.eol)).join("")}}function $t(ht){return new ee().parse(ht)}function Ae(ht,C){return new xn().print(ht,C)}}},i={};function s(r){if(i[r])return i[r].exports;var a=i[r]={exports:{}};return e[r](a,a.exports,s),a.exports}return s.d=(r,a)=>{for(var c in a)s.o(a,c)&&!s.o(r,c)&&Object.defineProperty(r,c,{enumerable:!0,get:a[c]})},s.o=(r,a)=>Object.prototype.hasOwnProperty.call(r,a),s.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},s(8)})()})(cO);var En=cO.exports;function dO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function lO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?dO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):dO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function JS(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:r,filterAudioFec:a,filterAudioCodec:c,filterVideoCodec:l}=t,{useXR:u}=e;let h=[],f=[],g=[],S=[],w=!1,b=!1;if(En.parse(n).mediaDescriptions.forEach(I=>{i&&i!==I.attributes.direction||(I.media.mediaType!=="video"||w||(f=I.attributes.payloads,S=I.attributes.extmaps,w=!0),I.media.mediaType!=="audio"||b||(h=I.attributes.payloads,g=I.attributes.extmaps,b=!0))}),!S||f.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!g||h.length===0)throw new Error("Cannot get audio capabilities from SDP.");return f.forEach(I=>{var U;(U=I.rtpMap)!==null&&U!==void 0&&U.clockRate&&(I.rtpMap.clockRate=parseInt(I.rtpMap.clockRate)),u&&I.rtcpFeedbacks.push({type:"rrtr"})}),h.forEach(I=>{var U;(U=I.rtpMap)!==null&&U!==void 0&&U.clockRate&&(I.rtpMap.clockRate=parseInt(I.rtpMap.clockRate)),u&&I.rtcpFeedbacks.push({type:"rrtr"})}),s&&(h=h.filter(I=>{var U;return((U=I.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"}),f=f.filter(I=>{var U;return((U=I.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"})),r&&(f=f.filter(I=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=I.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),a&&(h=h.filter(I=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=I.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),c&&(c==null?void 0:c.length)>0&&(h=h.filter(I=>{var U;return Wt(c).call(c,((U=I.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"")})),l&&(l==null?void 0:l.length)>0&&(f=f.filter(I=>{var U;return Wt(l).call(l,((U=I.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"")})),{audioCodecs:h,videoCodecs:f,audioExtensions:g,videoExtensions:S}}function $c(n){const t=En.parse(n);let e,i;for(const s of t.mediaDescriptions){if(!e){const r=s.attributes.iceUfrag,a=s.attributes.icePwd;if(!r||!a)throw new Error("Cannot get iceUfrag or icePwd from SDP.");e={iceUfrag:r,icePwd:a}}if(!i){const r=s.attributes.fingerprints;r.length>0&&(i={fingerprints:r})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!e)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:e,dtlsParameters:i}}function uO(n,t){const e=[],i=n.attributes.ssrcGroups.filter(a=>a.semantic==="FID"),s=n.attributes.ssrcGroups.find(a=>a.semantic==="SIM"),r=n.attributes.ssrcs;if(s)s.ssrcIds.forEach(a=>{var c;const l=(c=i.find(u=>u.ssrcIds[0]===a))===null||c===void 0?void 0:c.ssrcIds[1];e.push({ssrcId:a,rtx:t?l:void 0})});else if(i.length>0){const a=i[0].ssrcIds[0],c=i[0].ssrcIds[1];e.push({ssrcId:a,rtx:t?c:void 0})}else{if(r.length===0)throw new Error("No ssrcs found on local media description.");e.push({ssrcId:r[0].ssrcId})}return e}function hO(n,t){const{cname:e}=n;let i;t&&t.ip&&typeof t.port=="number"?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):i=n.iceParameters.candidates.map(c=>({foundation:c.foundation,componentId:"1",transport:c.protocol,priority:c.priority.toString(),connectionAddress:c.ip,port:c.port.toString(),type:c.type,extension:{}}));const s={fingerprints:n.dtlsParameters.fingerprints.map(c=>({hashFunction:c.algorithm,fingerprint:c.fingerprint}))},r={iceUfrag:n.iceParameters.iceUfrag,icePwd:n.iceParameters.icePwd};let a;switch(n.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}return{dtlsParameters:s,iceParameters:r,candidates:i,rtpCapabilities:ZS(n.rtpCapabilities),setup:a,cname:e}}function or(n,t,e){const i=[],s=[];return n.forEach(r=>{let{ssrcId:a,rtx:c}=r;const l=Ge(8,"track-"),u={ssrcId:a,attributes:lO({label:l,mslabel:e=e||Ge(10,""),msid:"".concat(e," ").concat(l)},t&&{cname:t})};if(i.push(u),c!==void 0){const h={ssrcId:c,attributes:lO({label:l,mslabel:e,msid:"".concat(e," ").concat(l)},t&&{cname:t})};i.push(h),s.push({semantic:"FID",ssrcIds:[a,c]})}}),n.length>1&&s.push({semantic:"SIM",ssrcIds:n.map(r=>{let{ssrcId:a}=r;return a})}),{ssrcs:i,ssrcGroups:s}}function Qc(n,t){t instanceof Le&&n.attributes.payloads.forEach(e=>{var i;const s=(i=e.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const r=t._encoderConfig;r&&s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(r.bitrate&&!nn()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*r.bitrate))),r.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(r.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(r.sampleRate)),r.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))})}function XS(n){const t=n.attributes.unrecognized.findIndex(e=>e.attField==="x-google-flag"&&e.attValue==="conference");t!==-1&&n.attributes.unrecognized.splice(t,1)}function $S(n,t){var e;if(!(t instanceof he&&t._encoderConfig&&t._hints.indexOf(Qe.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;Ye().supportMinBitrate&&i.bitrateMin&&n.attributes.payloads.forEach(s=>{var r,a;Wt(r=["h264","h265","vp8","vp9","av1"]).call(r,((a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Ye().supportMinBitrate&&!Wt(e=t._hints).call(e,Qe.LOW_STREAM)&&i.bitrateMax&&n.attributes.payloads.forEach(s=>{var r,a;Wt(r=["h264","h265","vp8","vp9","av1"]).call(r,((a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(x("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function pO(n){if(n.media.mediaType!=="video")return;const t=Pe();if(t.name!==ke.SAFARI&&t.os!==Qn.IOS)return;const e=n.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));e!==-1&&n.attributes.extmaps.splice(e,1)}function b_(n,t,e){if(!t)return;let i,s;if(n.media.mediaType==="video"?(i=e.videoExtensions,s=e.videoCodecs):(i=e.audioExtensions,s=e.audioCodecs),t.twcc===!0){const r=i.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");r&&(n.attributes.extmaps.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||n.attributes.extmaps.push({entry:r.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(c,l){return l.filter(u=>!!c.find(h=>h.payloadType===u.payloadType&&!!h.rtcpFeedbacks.find(f=>f.type==="transport-cc")))}(s,n.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="transport-cc")||c.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const r=n.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");r!==-1&&n.attributes.extmaps.splice(r,1),n.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}if(t.remb===!0){const r=i.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");r&&(n.attributes.extmaps.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||n.attributes.extmaps.push({entry:r.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(c,l){return l.filter(u=>!!c.find(h=>h.payloadType===u.payloadType&&!!h.rtcpFeedbacks.find(f=>f.type==="goog-remb")))}(s,n.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="goog-remb")||c.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const r=n.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");r!==-1&&n.attributes.extmaps.splice(r,1),n.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(l=>l.type==="goog-remb");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}}function QS(n,t,e){if(nn()||n.media.mediaType!=="video"||!(t instanceof he)||e!=="vp9"&&e!=="vp8"||e==="vp8"&&!x("SIMULCAST")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=e==="vp8"?2:t._scalabilityMode.numSpatialLayers,s=n.attributes.ssrcs[0],r=n.attributes.ssrcGroups.find(c=>c.semantic==="FID"&&c.ssrcIds[0]===s.ssrcId),a={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let c=1;c<i;c++)n.attributes.ssrcs.push({ssrcId:s.ssrcId+c,attributes:Nn(s.attributes)}),a.ssrcIds.push(s.ssrcId+c),r&&(n.attributes.ssrcs.push({ssrcId:r.ssrcIds[1]+c,attributes:Nn(s.attributes)}),n.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+c,r.ssrcIds[1]+c]}));n.attributes.ssrcGroups.unshift(a)}async function fO(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{filterRTX:e,filterVideoFec:i,filterAudioFec:s,filterAudioCodec:r,filterVideoCodec:a}=n,{useXR:c}=t,l=new RTCPeerConnection;l.addTransceiver("video",{direction:"sendonly"}),l.addTransceiver("audio",{direction:"sendonly"}),l.addTransceiver("video",{direction:"recvonly"}),l.addTransceiver("audio",{direction:"recvonly"});const u=(await l.createOffer()).sdp,h=JS(u,{filterRTX:e,filterVideoFec:i,filterAudioFec:s,filterAudioCodec:r,filterVideoCodec:a},{useXR:c},"sendonly"),f=JS(u,{filterRTX:e,filterVideoFec:i,filterAudioFec:s,filterAudioCodec:r,filterVideoCodec:a},{useXR:c},"recvonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(I_(h,f,"videoExtensions",g,S,w),I_(h,f,"videoCodecs",g,S,w),I_(h,f,"audioExtensions",g,S,w),I_(h,f,"audioCodecs",g,S,w),x("RAISE_H264_BASELINE_PRIORITY")){const b=w.videoCodecs.findIndex(I=>{var U,F;return((U=I.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((F=I.fmtp)===null||F===void 0?void 0:F.parameters["profile-level-id"])==="42001f"});if(b!==-1){const I=w.videoCodecs.findIndex(U=>{var F;return((F=U.rtpMap)===null||F===void 0?void 0:F.encodingName.toLocaleLowerCase())==="h264"});if(I<b){v.debug("raising H264 baseline profile priority");const U=w.videoCodecs[b];w.videoCodecs.splice(b,1),w.videoCodecs.splice(I,0,U)}I!==-1&&(S.videoCodecs=S.videoCodecs.filter(U=>{var F,V;return!(((F=U.rtpMap)===null||F===void 0?void 0:F.encodingName.toLocaleLowerCase())==="h264"&&((V=U.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!=="42001f")})),I!==-1&&x("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(U=>{var F,V;return!(((F=U.rtpMap)===null||F===void 0?void 0:F.encodingName.toLocaleLowerCase())==="h264"&&((V=U.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!=="42001f")}))}}try{l.close()}catch{}return{send:g,recv:S,sendrecv:w}}function I_(n,t,e,i,s,r){if(e==="videoExtensions"||e==="audioExtensions"){const a=[];return n[e].forEach(c=>{t[e].some((l,u)=>{if(c.entry===l.entry&&c.extensionName===l.extensionName)return a.push(u),!0})?r[e].push(c):i[e].push(c)}),void t[e].forEach((c,l)=>{a.indexOf(l)===-1&&s[e].push(c)})}if(e==="videoCodecs"||e==="audioCodecs"){const a=[];return n[e].forEach(c=>{t[e].some((l,u)=>{if(c.payloadType===l.payloadType&&JSON.stringify(c)===JSON.stringify(l))return a.push(u),!0})?r[e].push(c):i[e].push(c)}),void t[e].forEach((c,l)=>{a.indexOf(l)===-1&&s[e].push(c)})}}function ZS(n){const{send:t,recv:e,sendrecv:i}=n;if(!i){if(!t||!e)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:e}}let s,r;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...i.audioCodecs],s.videoCodecs=[...t.videoCodecs,...i.videoCodecs],s.audioExtensions=[...t.audioExtensions,...i.audioExtensions],s.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):s=i,e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,{send:s,recv:r}}function qa(n){n.media.mediaType==="audio"&&n.attributes.payloads.filter(t=>{var e;return((e=t.rtpMap)===null||e===void 0?void 0:e.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function A_(n){n.mediaDescriptions.forEach(t=>{t.media.mediaType!=="video"&&t.media.mediaType!=="audio"||t.attributes.payloads.forEach(e=>{e.rtcpFeedbacks.findIndex(i=>i.type==="rrtr")===-1&&e.rtcpFeedbacks.push({type:"rrtr"})})})}function _O(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function mO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?_O(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):_O(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function wr(n){if(Array.isArray(n))return n.map(e=>e);if(!EO(n))return n;const t={};for(const e in n){const i=n[e];EO(i)||Array.isArray(i)?t[e]=wr(i):t[e]=i}return t}function EO(n){return!(typeof n!="object"||Array.isArray(n)||!n)}class tv{constructor(t){m(this,"input",[]),m(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Co={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},mh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Co,remoteCandidate:Co}},gO={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},TO={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},SO={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},vO={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function yO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function CO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?yO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):yO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class ev{constructor(t,e){m(this,"onFirstVideoReceived",void 0),m(this,"onFirstVideoDecoded",void 0),m(this,"onFirstAudioReceived",void 0),m(this,"onFirstVideoDecodedTimeout",void 0),m(this,"onFirstAudioDecoded",void 0),m(this,"onSelectedLocalCandidateChanged",void 0),m(this,"onSelectedRemoteCandidateChanged",void 0),m(this,"videoIsReady",!1),m(this,"videoIsReady2",{}),m(this,"pc",void 0),m(this,"options",void 0),m(this,"intervalTimer",void 0),m(this,"stats",wr(mh)),m(this,"isFirstVideoReceived",{}),m(this,"isFirstVideoDecoded",{}),m(this,"isFirstAudioReceived",{}),m(this,"isFirstAudioDecoded",{}),m(this,"isFirstVideoDecodedTimeout",{}),m(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new K(t=>{t({local:CO({},Co),remote:CO({},Co)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,r=0,a=0,c=0;for(const l of i)t[l].forEach((u,h)=>{if(!this.lossRateWindowStats[e-1][l][h]||!this.lossRateWindowStats[0][l][h])return;const f=this.lossRateWindowStats[e-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,g=this.lossRateWindowStats[e-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(s+=f,a+=g):(r+=f,c+=g),Number.isNaN(f)||Number.isNaN(f)?u.packetLostRate=0:u.packetLostRate=f<=0||g<=0?0:g/(f+g)});t.sendPacketLossRate=s<=0||a<=0?0:a/(s+a),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}}function RO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function P4(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?RO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):RO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class L4 extends ev{constructor(){super(...arguments),m(this,"_stats",mh),m(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=wr(mh);const i=e.filter(r=>r.type==="ssrc");this.processSSRCStats(i);const s=e.find(r=>r.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var i;const s=Wt(i=e.id).call(i,"send");switch("".concat(e.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const r=wr(TO);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=wr(gO),a=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),a){const c=a.stats,l=Date.now()-a.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<a.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:P4({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=wr(vO);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=wr(SO);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new K((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(r=>{s[r]=i.stat(r)}),e.push(s)}),e}}function bO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Zc(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?bO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):bO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class IO extends ev{constructor(){super(...arguments),m(this,"_stats",mh),m(this,"report",void 0),m(this,"lastDecodeVideoReceiverStats",new Map),m(this,"lastVideoFramesRecv",new Map),m(this,"lastVideoFramesSent",new Map),m(this,"lastVideoFramesDecode",new Map),m(this,"lastVideoJBDelay",new Map),m(this,"lastAudioJBDelay",new Map),m(this,"mediaBytesSent",new Map),m(this,"mediaBytesRetransmit",new Map),m(this,"mediaBytesTargetEncode",new Map),m(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=wr(mh),this.report.forEach(t=>{switch(t.type){case os.OUTBOUND:case os.INBOUND:{const e=t.mediaType||t.kind,i=!e&&"frameWidth"in t,s=!e&&!("frameWidth"in t);t.type===os.OUTBOUND?e==="audio"||s?this.processAudioOutboundStats(t):(e==="video"||i)&&this.processVideoOutboundStats(t):t.type===os.INBOUND&&(e==="audio"||s?this.processAudioInboundStats(t):(e==="video"||i)&&this.processVideoInboundStats(t));break}case os.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case os.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:Zc({},Co),remote:Zc({},Co)};return t.forEach(i=>{let s;if(i.type===os.TRANSPORT&&(s=t.get(i.selectedCandidatePairId)),i.type===os.CANDIDATE_PAIR&&i.selected&&(s=i),s){const r=(a,c)=>{a.type=c.type,a.id=c.id,c.address&&(a.address=c.address),c.candidateType&&(a.candidateType=c.candidateType),c.port&&(a.port=c.port),c.priority&&(a.priority=c.priority),c.protocol&&(a.protocol=c.protocol),c.relayProtocol&&(a.relayProtocol=c.relayProtocol)};if(s.localCandidateId){const a=t.get(s.localCandidateId);a&&r(e.local,a)}if(s.remoteCandidateId){const a=t.get(s.remoteCandidateId);a&&r(e.remote,a)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===os.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===os.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===os.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Zc({},e),Zc({},this.stats.selectedCandidatePair.localCandidate)),t.type===os.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Zc({},e),Zc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=wr(vO),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let e=this._stats.videoRecv.find(a=>a.ssrc===t.ssrc);e||(e=wr(gO),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay;const i=this.lastDecodeVideoReceiverStats.get(e.ssrc),s=this.lastVideoFramesDecode.get(e.ssrc),r=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const a=e.decodedFrame?e.decodedFrame.width:0,c=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,a,c),this.isFirstVideoDecoded[e.ssrc]=!0}if(i){const a=i.stats,c=r-i.lts;e.framesDecodeFreezeTime=a.framesDecodeFreezeTime,e.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(i.lts=Date.now(),e.framesDecodeInterval=c,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<a.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}s&&r-s.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-s.count)/((r-s.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:r,rate:e.decodeFrameRate})):s?e.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:r,rate:0}),t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:Zc({},e),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(s=>s.ssrc===t.ssrc);e||(e=wr(TO),this._stats.videoSend.push(e));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const s=new tv(10);s.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,s)}if(t.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(t.ssrc);if(s)s.add(t.retransmittedBytesSent);else{const r=new tv(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(t.ssrc);if(s)s.add(t.totalEncodedBytesTarget);else{const r=new tv(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const s=this.lastEncoderMs.get(t.ssrc);if(!s||s.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-s.lastFrameCount,a=t.totalEncodeTime-s.lastEncoderTime;e.avgEncodeMs=1e3*a/r}}if(t.framesEncoded&&t.qpSum){const s=this.lastEncoderMs.get(t.ssrc);!s||s.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-s.lastQpSum)/(t.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const s=this.findRemoteStatsId(t.ssrc,os.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(e||(e=wr(SO),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,os.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}findRemoteStatsId(t,e){var i;const s=Array.from(_o(i=this.report).call(i)).find(r=>r.type===e&&r.ssrc===t);return s?s.id:null}processVideoMediaSource(t,e){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(e.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,e){const i=this.report.get(t);i&&(e.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,e,i){var s,r,a,c;const l=e?this.report.get(e):void 0,u=(s=l==null?void 0:l.framesSent)!==null&&s!==void 0?s:t.framesSent;if(typeof u!="number")return;let h=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,f=(a=l==null?void 0:l.frameHeight)!==null&&a!==void 0?a:t.frameHeight,g=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof h=="number"&&typeof f=="number"||(h=0,f=0),g==null){const S=Date.now(),w=this.lastVideoFramesSent.get(i.ssrc);w&&S-w.lts>=800?(g=Math.round((u-w.count)/((S-w.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:S,rate:g})):w?g=w.rate:this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:S,rate:0})}i.sentFrame={width:h,height:f,frameRate:Math.max(0,g)}}processVideoTrackReceiverStats(t,e,i){var s,r,a,c,l;const u=e?this.report.get(e):void 0,h=(s=u==null?void 0:u.framesReceived)!==null&&s!==void 0?s:t.framesReceived,f=(r=u==null?void 0:u.frameWidth)!==null&&r!==void 0?r:t.frameWidth,g=(a=u==null?void 0:u.frameHeight)!==null&&a!==void 0?a:t.frameHeight,S=(c=u==null?void 0:u.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,w=(l=u==null?void 0:u.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof h=="number"){const b=this.lastVideoFramesRecv.get(i.ssrc),I=Date.now();i.framesReceivedCount=h;let U=0;b&&I-b.lts>=800?(U=Math.round((h-b.count)/((I-b.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:I,rate:U})):b?U=b.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:I,rate:0}),i.receivedFrame={width:f||0,height:g||0,frameRate:U||0},i.decodedFrame={width:f||0,height:g||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:f||0,height:g||0,frameRate:i.decodeFrameRate||0}}if(S&&w){const b=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=b.jitterBufferMs;const U=w-b.jitterBufferEmittedCount;U>0&&(I=1e3*(S-b.jitterBufferDelay)/U),i.jitterBufferMs=I,i.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:w,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,e,i){var s,r,a,c;const l=e?this.report.get(e):void 0,u=(s=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&s!==void 0?s:0,h=(a=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&a!==void 0?a:0;i.aecReturnLoss=u,i.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(t,e,i){var s,r,a,c,l,u,h;const f=e?this.report.get(e):void 0,g=(s=f==null?void 0:f.removedSamplesForAcceleration)!==null&&s!==void 0?s:t.removedSamplesForAcceleration,S=(r=f==null?void 0:f.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,w=(a=f==null?void 0:f.jitterBufferDelay)!==null&&a!==void 0?a:t.jitterBufferDelay,b=(c=f==null?void 0:f.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,I=(l=f==null?void 0:f.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,U=(u=f==null?void 0:f.totalSamplesDuration)!==null&&u!==void 0?u:t==null?void 0:t.totalSamplesDuration,F=(h=f==null?void 0:f.concealedSamples)!==null&&h!==void 0?h:t.concealedSamples;if(g&&S&&(i.accelerateRate=g/S),w&&b){const Z=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let $=Z.jitterBufferMs;const W=b-Z.jitterBufferEmittedCount;W>0&&($=1e3*(w-Z.jitterBufferDelay)/W),i.jitterBufferMs=Math.round($),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:b,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=I;let V=1920;U&&S&&(V=S/U/50,i.receivedFrames=Math.round(S/V)),F&&(i.droppedFrames=Math.round(F/V))}processRemoteInboundStats(t,e){const i=this.report.get(t);i&&(e.packetsLost=i.packetsLost,i.roundTripTime&&(e.rttMs=1e3*i.roundTripTime),i.jitter&&(e.jitterMs=1e3*i.jitter),i.timestamp&&(e.timestamp=i.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const i=e.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,e=null,i=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{i=i===null?r.diffMean():i+r.diffMean()});const s=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class k4 extends ev{updateStats(){return K.resolve()}}function w_(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const r=function(){const a=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return a&&a[0]?Number(a[0].split("/")[1]):null}();return r?r<76?new L4(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new IO(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s}):function(a){return!!window.RTCStatsReport&&a.getStats()instanceof K}(n)?new IO(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new k4(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s})}function AO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function wO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?AO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):AO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class ii extends Hf{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,e){super(t,e),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"remoteSDP",void 0),m(this,"initialOffer",void 0),m(this,"statsFilter",void 0),m(this,"useRTX",!1),m(this,"localCapabilities",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"establishPromise",void 0),m(this,"mutex",new Zn("P2PConnection-mutex")),this.store=e,this.peerConnection=new RTCPeerConnection(ii.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=w_(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=$c(t.sdp),i=JS(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,wO(wO({},e),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new Q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,i,s,r,a){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(l){m(this,"sessionDesc",void 0),m(this,"localCapabilities",void 0),m(this,"rtpCapabilities",void 0),m(this,"candidates",void 0),m(this,"iceParameters",void 0),m(this,"dtlsParameters",void 0),m(this,"setup",void 0),m(this,"currentMidIndex",void 0),m(this,"cname",void 0),l=Nn(l);const{remoteIceParameters:u,remoteDtlsParameters:h,candidates:f,remoteRTPCapabilities:g,remoteSetup:S,localCapabilities:w,sdkCodec:b,cname:I}=l,U=En.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=g,this.candidates=f,this.iceParameters=u,this.dtlsParameters=h,this.setup=S,this.localCapabilities=w,this.cname=I;for(let F=0;F<U.mediaDescriptions.length;F++){const V=U.mediaDescriptions[F];V.attributes.iceUfrag=u.iceUfrag,V.attributes.icePwd=u.icePwd,V.attributes.fingerprints=h.fingerprints,V.attributes.candidates=f,V.attributes.setup=S,V.media.mediaType==="video"&&(V.media.fmts=g.videoCodecs.map(Z=>Z.payloadType.toString(10)),V.attributes.payloads=g.videoCodecs,V.attributes.extmaps=g.videoExtensions),V.media.mediaType==="audio"&&(V.media.fmts=g.audioCodecs.map(Z=>Z.payloadType.toString(10)),V.attributes.payloads=g.audioCodecs,V.attributes.extmaps=g.audioExtensions),U.mediaDescriptions[F]=this.mungMediaDesc(V)}this.sessionDesc=U,this.currentMidIndex=U.mediaDescriptions.length-1}toString(){return En.print(this.sessionDesc)}send(l,u,h){const{ssrcs:f,ssrcGroups:g}=or(u,this.cname),S=this.sessionDesc.mediaDescriptions.find(I=>l===bt.VIDEO?I.media.mediaType==="video":I.media.mediaType==="audio"),w=f[0].attributes.label,b=f[0].attributes.mslabel;return S.attributes.ssrcs=S.attributes.ssrcs.concat(f),S.attributes.ssrcGroups=S.attributes.ssrcGroups.concat(g),{id:w,mslabel:b}}batchSend(l){return l.map(u=>{let{kind:h,ssrcMsg:f}=u;return this.send(h,f,void 0)})}stopSending(l){this.sessionDesc.mediaDescriptions.forEach(u=>{const h=[],f=[],g=[];u.attributes.ssrcs.forEach(S=>{Wt(l).call(l,S.attributes.label||"")?g.push(S):h.push(S)}),u.attributes.ssrcGroups.forEach(S=>{var w;Wt(w=g.map(b=>b.ssrcId)).call(w,S.ssrcIds[0])||f.push(S)}),u.attributes.ssrcs=h,u.attributes.ssrcGroups=f})}mute(l){const u=this.sessionDesc.mediaDescriptions.find(h=>h.attributes.mid===l);if(!u)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.mute."));u.attributes.direction="inactive"}unmute(l){const u=this.sessionDesc.mediaDescriptions.find(h=>h.attributes.mid===l);if(!u)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.unmute."));u.attributes.direction="sendonly"}receive(l,u,h){l.forEach((f,g)=>{const S=f._mediaStreamTrack,w=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===S.kind),b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],f);this.sessionDesc.mediaDescriptions[w]=b})}stopReceiving(l){}updateCandidates(l){l===mi.TCP?this.candidates.forEach(u=>{this.candidates.findIndex(h=>h.transport==="tcp"&&h.connectionAddress===u.connectionAddress&&h.port===u.port)===-1&&this.candidates.push(mO(mO({},u),{},{foundation:"tcpcandidate",priority:Number(u.priority)-1+"",transport:"tcp",port:Number(u.port)+90+""}))}):this.candidates=this.candidates.filter(u=>u.transport!=="tcp");for(const u of this.sessionDesc.mediaDescriptions)u.attributes.candidates=this.candidates}restartICE(l){l=Nn(l),this.iceParameters=l,this.sessionDesc.mediaDescriptions.forEach(u=>{u.attributes.iceUfrag=l.iceUfrag,u.attributes.icePwd=l.icePwd})}predictReceivingMids(l){const u=[];for(let h=0;h<l;h++)u.push((this.currentMidIndex+h+1).toString(10));return u}mungRecvMediaDsec(l,u){const h=Nn(l);return Qc(h,u),$S(h,u),h}updateRecvMedia(l,u){const h=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===l);if(h!==-1){const f=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],u);this.sessionDesc.mediaDescriptions[h]=f}}bumpMid(l){this.currentMidIndex+=l}updateTrackLabel(l,u,h){const f=this.sessionDesc.mediaDescriptions.find(S=>l===bt.VIDEO?S.attributes.mid==="video":S.attributes.mid==="audio");if(f){const S=f.attributes.ssrcs.find(w=>w.attributes.label===u);var g;S&&(S.attributes.label=h,(g=S.attributes.msid)===null||g===void 0||g.replace(u,h))}}mungMediaDesc(l){const u=Nn(l);return XS(u),function(h){const f=h.attributes.extmaps.find(g=>g.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");f&&h.attributes.extmaps.splice(h.attributes.extmaps.indexOf(f),1),h.attributes.payloads.forEach(g=>{const S=g.rtcpFeedbacks.findIndex(w=>w.type==="transport-cc");S!==-1&&g.rtcpFeedbacks.splice(S,1)})}(u),u}getSSRC(l){for(const u of this.sessionDesc.mediaDescriptions)for(const h of u.attributes.ssrcs)if(h.attributes.label===l)return[h]}}({remoteIceParameters:t,remoteDtlsParameters:e,candidates:i,remoteRTPCapabilities:s.send,remoteSetup:r,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:a});const c=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(c){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}}send(t,e){var i=this;return rr(function*(){const s=yield Ie(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=t.map(g=>i.peerConnection.addTrack(g._mediaStreamTrack)),a=yield Ie(i.peerConnection.createOffer()),c=En.parse(a.sdp),l=t.map(g=>{const S=g._mediaStreamTrack,w=c.mediaDescriptions.find(b=>b.attributes.mid===S.kind);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return function(b,I,U){const F=b.attributes.ssrcs.filter(Z=>Z.attributes.label===I),V=b.attributes.ssrcGroups;if(F.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(V&&F.length>1){const Z=V.find($=>$.ssrcIds.indexOf(F[0].ssrcId)!==-1);return Z?[{ssrcId:Z.ssrcIds[0],rtx:U?Z.ssrcIds[1]:void 0}]:[{ssrcId:F[0].ssrcId}]}return[{ssrcId:F[0].ssrcId}]}(w,S.id,i.useRTX)});let u;try{u=yield l}catch(g){throw r.forEach(S=>{Vi()&&S.replaceTrack(null),i.peerConnection.removeTrack(S)}),g}const h=i.mungSendOfferSDP(a.sdp,t);i.remoteSDP.receive(t,e,u);const f=i.remoteSDP.toString();return yield Ie(i.peerConnection.setLocalDescription({type:"offer",sdp:h})),yield Ie(i.applySendEncodings(r,t)),yield Ie(i.peerConnection.setRemoteDescription({type:"answer",sdp:f})),t.map((g,S)=>{const w=g._mediaStreamTrack.id;return{localSSRC:l[S],id:w}})}catch(r){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(r.toString()))}finally{s()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const e=this.peerConnection.getSenders().filter(r=>{var a;return t.indexOf(((a=r.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");e.map(r=>{Vi()&&r.replaceTrack(null),this.peerConnection.removeTrack(r)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(t,e,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:r,mslabel:a}=this.remoteSDP.send(t,e,s),c=new K((h,f)=>{const g=setTimeout(()=>{f(new Error("Cannot receive track, id: ".concat(r)))},1e4),S=w=>{const b=Pe();if((b.name==="Safari"&&Number(b.version)===11||Fi())&&w.track.id!==r&&w.streams[0].id===a){var I;const U=w.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(t,r,w.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(g),void h(U)}if(w.track.id===r)return this.peerConnection.removeEventListener("track",S),clearTimeout(g),void h(w.track)};this.peerConnection.addEventListener("track",S)}),l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const u=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u),{track:await c,id:r}}catch(r){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getSenders().filter(i=>{var s;return t.indexOf(((s=i.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(e.length!==t.length)throw new Error("sender' length doesn't match mids' length.");e.map(i=>{if(Vi()&&i.track)i.track.enabled=!1;else{const s=i.getParameters();s.encodings.forEach(r=>r.active=!1),i.setParameters(s)}})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getSenders().filter(r=>{var a;return t.indexOf(((a=r.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(e.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");e.map(async r=>{if(Vi()&&r.track)r.track.enabled=!0;else{const a=r.getParameters();a.encodings.forEach(c=>c.active=!0),await r.setParameters(a)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(t){var e=this;return rr(function*(){const i=yield Ie(e.mutex.lock("From P2PConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ye().supportPCSetConfiguration){const l=e.peerConnection.getConfiguration(),u=t===mi.RELAY?"relay":"all";l.iceTransportPolicy!==u&&(v.debug("[".concat(e.store.clientId,"] restartICE change iceTransportPolicy from [").concat(l.iceTransportPolicy,"] to [").concat(u,"]")),l.iceTransportPolicy=u,e.peerConnection.setConfiguration(l))}else if(t===mi.RELAY)return;t!==mi.RELAY&&e.remoteSDP.updateCandidates(t);const s=yield Ie(e.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=$c(s.sdp),{remoteIceParameters:a}=yield r.iceParameters;e.remoteSDP.restartICE(a);const c=e.remoteSDP.toString();yield Ie(e.peerConnection.setLocalDescription(s)),yield Ie(e.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(s){v.warning("[".concat(e.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[e]);this.remoteSDP.updateRecvMedia(e._mediaStreamTrack.kind,e);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,e){const i=this.peerConnection.getSenders().filter(s=>{var r;return((r=s.track)===null||r===void 0?void 0:r.id)===t});i.length===1&&await this.applySendEncodings(i,[e])}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getSenders().find(s=>{var r;return((r=s.track)===null||r===void 0?void 0:r.id)===e});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,e){throw new Q(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Q(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...ii.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...ii.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}async updateRtpSenderEncodings(t,e){var i;if(e||(e=this.peerConnection.getSenders().find(u=>{var h;return((h=u.track)===null||h===void 0?void 0:h.id)===t._mediaStreamTrack.id})),!e)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ye().supportSetRtpSenderParameters)return v.warn("Browser not support set rtp-sender parameters");const s={},r={};if(t instanceof he)switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(x("DSCP_TYPE")&&Oa()){var a;const u=x("DSCP_TYPE");Wt(a=["very-low","low","medium","high"]).call(a,u)&&(r.networkPriority=u)}const c=e.getParameters(),l=(i=c.encodings)===null||i===void 0?void 0:i[0];l&&Object.assign(l,r),Object.assign(c,s),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await e.setParameters(c)}async applySendEncodings(t,e){try{if(!Ye().supportSetRtpSenderParameters||t.length!==e.length)return;for(let i=0;i<t.length;i++){const s=t[i],r=e[i];s&&r&&await this.updateRtpSenderEncodings(r,s)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e){const i=En.parse(t);return e.forEach((s,r)=>{const a=s._mediaStreamTrack,c=i.mediaDescriptions.find(l=>l.attributes.mid===a.kind);c&&Qc(c,s)}),En.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const e=this.remoteSDP.batchSend(t).map((r,a)=>{let{id:c,mslabel:l}=r;const{kind:u}=t[a];return new K((h,f)=>{const g=setTimeout(()=>{f(new Error("Cannot receive track, id: ".concat(c)))},1e4),S=w=>{const b=Pe();if(b.name==="Safari"&&Number(b.version)===11&&w.track.id!==c&&w.streams[0].id===l){var I;const U=w.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(u,c,w.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(g),void h({track:U,id:c})}if(w.track.id===c)return this.peerConnection.removeEventListener("track",S),clearTimeout(g),void h({track:w.track,id:c})};this.peerConnection.addEventListener("track",S)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await K.all(e)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return e==null?void 0:e[0].ssrcId}setConfiguration(t){if(Ye().supportPCSetConfiguration){const e=ii.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}}function ar(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("Locking from P2PConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function OO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Ya(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?OO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):OO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}et([ar,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],ii.prototype,"connect",null),et([ar,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],ii.prototype,"stopSending",null),et([ar,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",K)],ii.prototype,"receive",null),et([ar,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],ii.prototype,"stopReceiving",null),et([ar,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],ii.prototype,"muteRemote",null),et([ar,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],ii.prototype,"unmuteRemote",null),et([ar,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],ii.prototype,"muteLocal",null),et([ar,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],ii.prototype,"unmuteLocal",null),et([ar,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],ii.prototype,"close",null),et([ar,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],ii.prototype,"updateEncoderConfig",null),et([ar,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],ii.prototype,"updateSendParameters",null),et([ar,A("design:type",Function),A("design:paramtypes",[Ei,String]),A("design:returntype",K)],ii.prototype,"replaceTrack",null),et([ar,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],ii.prototype,"getRemoteSSRC",null);const Eh="9",NO=4e4;function DO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function El(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?DO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):DO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}let si=class wh extends Hf{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,e;return(t=(e=this.peerConnection.getReceivers()[0])===null||e===void 0||(e=e.transport)===null||e===void 0?void 0:e.state)!==null&&t!==void 0?t:null}constructor(t,e){super(t,e),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"remoteSDP",void 0),m(this,"initialOffer",void 0),m(this,"transportEventReceiver",void 0),m(this,"statsFilter",void 0),m(this,"useXR",x("USE_XR")),m(this,"localCapabilities",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"dataStreamChannelMap",new Map),m(this,"establishPromise",void 0),m(this,"mutex",new Zn("P2PConnection-mutex")),this.store=e,this.peerConnection=new RTCPeerConnection(wh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=w_(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=$c(t.sdp),i=await fO({filterRTX:!x("USE_PUB_RTX")&&!x("USE_SUB_RTX"),filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC")},{useXR:this.useXR});return this.localCapabilities=ZS(i),this.initialOffer=t,El(El({},e),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new Q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,i,s,r,a){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return Nn(this._localCapabilities)}get rtpCapabilities(){return Nn(this._rtpCapabilities)}get candidates(){return Nn(this._candidates)}get iceParameters(){return Nn(this._iceParameters)}get dtlsParameters(){return Nn(this._dtlsParameters)}constructor(S){m(this,"sessionDesc",void 0),m(this,"_localCapabilities",void 0),m(this,"_rtpCapabilities",void 0),m(this,"_candidates",void 0),m(this,"_iceParameters",void 0),m(this,"_dtlsParameters",void 0),m(this,"setup",void 0),m(this,"currentMidIndex",void 0),m(this,"cname",void 0),m(this,"firefoxSsrcMidMap",new Map),S=Nn(S);const{remoteIceParameters:w,remoteDtlsParameters:b,candidates:I,remoteRTPCapabilities:U,remoteSetup:F,localCapabilities:V,cname:Z}=S,$=En.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=U,this._candidates=I,this._iceParameters=w,this._dtlsParameters=b,this._localCapabilities=V,this.setup=F,this.cname=Z;const W=this.rtpCapabilities.send;for(const Y of $.mediaDescriptions){if(Y.attributes.iceUfrag=w.iceUfrag,Y.attributes.icePwd=w.icePwd,Y.attributes.fingerprints=b.fingerprints,Y.attributes.candidates=I,Y.attributes.setup=F,Y.media.mediaType==="video"&&(Y.media.fmts=W.videoCodecs.map(nt=>nt.payloadType.toString(10)),Y.attributes.payloads=W.videoCodecs,Y.attributes.extmaps=W.videoExtensions,x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:nt,ssrcGroups:mt}=or([{ssrcId:NO,rtx:x("USE_SUB_RTX")?40001:void 0}],this.cname);Y.attributes.ssrcs=nt,Y.attributes.ssrcGroups=mt}if(Y.media.mediaType==="audio"&&(Y.media.fmts=W.audioCodecs.map(nt=>nt.payloadType.toString(10)),Y.attributes.payloads=W.audioCodecs,Y.attributes.extmaps=W.audioExtensions,qa(Y),x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:nt,ssrcGroups:mt}=or([{ssrcId:2e4}],this.cname);Y.attributes.ssrcs=nt,Y.attributes.ssrcGroups=mt}}this.sessionDesc=$,this.currentMidIndex=$.mediaDescriptions.length-1}preloadRemoteMedia(){const S=x("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const w=this.candidates,b=this.dtlsParameters,I=this.iceParameters,U=this.rtpCapabilities.send;for(let F=1;F<S;F++){const V=2*F+2e4,Z=2*F+NO,{ssrcs:$,ssrcGroups:W}=or([{ssrcId:V}],this.cname),{ssrcs:Y,ssrcGroups:nt}=or([{ssrcId:Z,rtx:x("USE_SUB_RTX")?Z+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Eh,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.videoCodecs.map(mt=>mt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:w,extmaps:U.videoExtensions,fingerprints:b.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:nt,rtcpFeedbackWildcards:[],payloads:U.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*F)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Eh,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.audioCodecs.map(mt=>mt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:w,extmaps:U.audioExtensions,fingerprints:b.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:W,rtcpFeedbackWildcards:[],payloads:U.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*F+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return En.print(this.sessionDesc)}send(S,w,b,I){const{ssrcs:U,ssrcGroups:F}=or(w,this.cname,x("SYNC_GROUP")?b:void 0),V=this.findPreloadMediaDesc(U);if(V){if(nn()&&this.firefoxSsrcMidMap.set(U[0].ssrcId,V.attributes.mid),I&&(I.twcc||I.remb)){const Z=this.sessionDesc.mediaDescriptions.indexOf(V);return this.sessionDesc.mediaDescriptions[Z]=this.mungSendMediaDesc(V,I),{mid:V.attributes.mid,needExchangeSDP:!0}}return{mid:V.attributes.mid,needExchangeSDP:!1}}{const Z=this.findAvailableMediaIndex(S,U);let $;return Z===-1||Z===1&&(Vi()||SI())||Z===0&&x("USE_SUB_RTX")||vI()?($=this.createOrRecycleSendMedia(S,U,F,"sendonly",I),this.updateBundleMids()):($=Nn(this.sessionDesc.mediaDescriptions[Z]),$.attributes.direction="sendonly",$.attributes.ssrcs=U,$.attributes.ssrcGroups=F,this.sessionDesc.mediaDescriptions[Z]=this.mungSendMediaDesc($,I)),nn()&&this.firefoxSsrcMidMap.set(U[0].ssrcId,$.attributes.mid),{mid:$.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:S,needExchangeSDP:w}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:S.attributes.mid,needExchangeSDP:w}}batchSend(S){const w=S.map(U=>{let{kind:F,ssrcMsg:V,mslabel:Z}=U;return this.send(F,V,Z)}),b=[];let I=!1;return w.forEach(U=>{let{mid:F,needExchangeSDP:V}=U;V&&(I=!0),b.push(F)}),{mids:b,needExchangeSDP:I}}stopSending(S){const w=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&S.indexOf(b.attributes.mid)!==-1);if(w.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");w.forEach(b=>{b.attributes.mid==="0"||nn()||vI()?b.attributes.ssrcs=[]:(b.attributes.ssrcs=[],b.attributes.direction="inactive",b.media.port="0")}),this.updateBundleMids()}mute(S){const w=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===S);if(!w)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.mute."));w.attributes.direction="inactive"}unmute(S){const w=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===S);if(!w)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.unmute."));w.attributes.direction="sendonly"}muteRemote(S){const w=this.sessionDesc.mediaDescriptions.filter(b=>Wt(S).call(S,b.attributes.mid||""));if(w.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");w.forEach(b=>{b.attributes.direction="inactive"})}unmuteRemote(S){const w=this.sessionDesc.mediaDescriptions.filter(b=>Wt(S).call(S,b.attributes.mid||""));if(w.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");w.forEach(b=>{b.attributes.direction="recvonly"})}receive(S,w,b,I){S.forEach((U,F)=>{this.createOrRecycleRecvMedia(U,[],"recvonly",w,b,I[F])}),this.updateBundleMids()}stopReceiving(S){const w=this.sessionDesc.mediaDescriptions.filter(b=>S.indexOf(b.attributes.mid)!==-1);if(w.length!==S.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");w.forEach(b=>{b.media.port="0",b.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(S){const w=this._candidates.filter(b=>b.transport==="udp");if(S===mi.TCP){if(w.length===0)return;if(x("TCP_CANDIDATE_ONLY")){const b=this._candidates.filter(I=>I.transport==="tcp");w.forEach(I=>{b.findIndex(U=>U.connectionAddress===I.connectionAddress)===-1&&b.push(Ya(Ya({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),this._candidates=b}else{const b=[];w.forEach(I=>{b.push(Ya(Ya({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),this._candidates=[...w,...b]}}else if(S===mi.RELAY){if(w.length!==0)return;{const b=this._candidates.filter(I=>I.transport==="tcp");b.forEach(I=>{w.push(Ya(Ya({},I),{},{foundation:"udpcandidate",priority:Number(I.priority)+1+"",transport:"udp",port:Number(I.port)-90+""}))}),this._candidates=[...w,...b]}}else w.length===0?(this._candidates.filter(b=>b.transport==="tcp").forEach(b=>{w.push(Ya(Ya({},b),{},{foundation:"udpcandidate",priority:Number(b.priority)+1+"",transport:"udp",port:Number(b.port)-90+""}))}),this._candidates=w):this._candidates=this._candidates.filter(b=>b.transport!=="tcp");for(const b of this.sessionDesc.mediaDescriptions)b.attributes.candidates=this.candidates}restartICE(S){S=Nn(S),this._iceParameters=S,this.sessionDesc.mediaDescriptions.forEach(w=>{w.attributes.iceUfrag=S.iceUfrag,w.attributes.icePwd=S.icePwd})}predictReceivingMids(S){const w=[];for(let b=0;b<S;b++)w.push((this.currentMidIndex+b+1).toString(10));return w}findAvailableMediaIndex(S,w){return this.sessionDesc.mediaDescriptions.findIndex(b=>{const I=b.media.mediaType===S&&b.media.port!=="0"&&(b.attributes.direction==="sendonly"||b.attributes.direction==="sendrecv")&&b.attributes.ssrcs.length===0;if(nn()){if(I){const U=this.firefoxSsrcMidMap.get(w[0].ssrcId);return!(U||b.attributes.mid!=="0"&&b.attributes.mid!=="1")||!(!U||U!==b.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const b of this.sessionDesc.mediaDescriptions)if(b.media.mediaType==="application")return{mediaDesc:b,needExchangeSDP:!1};this.currentMidIndex+=1;const S="".concat(this.currentMidIndex),w={media:{mediaType:"application",port:Eh,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(S),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(w),{mediaDesc:w,needExchangeSDP:!0}}createOrRecycleRecvMedia(S,w,b,I,U,F){const V=S._mediaStreamTrack.kind,Z=this.rtpCapabilities.recv,$=this.localCapabilities.send;let W=[];if(V===bt.VIDEO){var Y,nt;if(x("H264_PROFILE_LEVEL_ID")&&I==="h264"&&(W=Z.videoCodecs.filter(be=>{var Fe,_e,xn;return Wt(Fe=((_e=be.rtpMap)===null||_e===void 0?void 0:_e.encodingName.toLowerCase())||"").call(Fe,I)&&(be==null||(xn=be.fmtp)===null||xn===void 0?void 0:xn.parameters["profile-level-id"])===x("H264_PROFILE_LEVEL_ID")})),!W||((Y=W)===null||Y===void 0?void 0:Y.length)===0){const be=$.videoCodecs.filter(Fe=>{var _e,xn;return Wt(_e=((xn=Fe.rtpMap)===null||xn===void 0?void 0:xn.encodingName.toLowerCase())||"").call(_e,I)});be.length!==0&&(W=Z.videoCodecs.filter(Fe=>be.some(_e=>_e.payloadType===Fe.payloadType)))}if(x("USE_PUB_RTX")){const be=W.map(_e=>_e.payloadType.toString()),Fe=Z.videoCodecs.filter(_e=>{var xn,it;return((xn=_e.rtpMap)===null||xn===void 0?void 0:xn.encodingName)==="rtx"&&Wt(be).call(be,((it=_e.fmtp)===null||it===void 0?void 0:it.parameters.apt)||"")});W=[...W,...Fe]}W.length===0&&(v.warning("codec ".concat(I," not included in rtpCapabilities, fallback to default payloads: ").concat((nt=Z.videoCodecs[0].rtpMap)===null||nt===void 0?void 0:nt.encodingName)),W=Z.videoCodecs)}else W=Z.audioCodecs.filter(be=>{var Fe,_e;return Wt(Fe=((_e=be.rtpMap)===null||_e===void 0?void 0:_e.encodingName.toLowerCase())||"").call(Fe,U)}),W.length===0&&(v.warning("codec ".concat(U," not included in rtpCapabilities, fallback to opus")),W=Z.audioCodecs.filter(be=>{var Fe,_e;return Wt(Fe=((_e=be.rtpMap)===null||_e===void 0?void 0:_e.encodingName.toLowerCase())||"").call(Fe,"opus")}));const mt=V===bt.VIDEO?Z.videoExtensions:Z.audioExtensions;this.currentMidIndex+=1;const ut="".concat(this.currentMidIndex);let ee={media:{mediaType:V,port:Eh,protos:["UDP","TLS","RTP","SAVPF"],fmts:W.map(be=>be.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:mt,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:w,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:W,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:b,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ut)}};ee=this.mungRecvMediaDsec(ee,S,F);const Te=this.findFirstClosedMedia(V);if(Te){const be=this.sessionDesc.mediaDescriptions.indexOf(Te);this.sessionDesc.mediaDescriptions[be]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}createOrRecycleSendMedia(S,w,b,I,U){const F=this.rtpCapabilities.send,V=S===bt.VIDEO?F.videoCodecs:F.audioCodecs,Z=S===bt.VIDEO?F.videoExtensions:F.audioExtensions;this.currentMidIndex+=1;const $="".concat(this.currentMidIndex);let W={media:{mediaType:S,port:Eh,protos:["UDP","TLS","RTP","SAVPF"],fmts:V.map(nt=>nt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:w,ssrcGroups:b,rtcpFeedbackWildcards:[],payloads:V,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($)}};W=this.mungSendMediaDesc(W,U);const Y=this.findFirstClosedMedia(S);if(Y){const nt=this.sessionDesc.mediaDescriptions.indexOf(Y);this.sessionDesc.mediaDescriptions[nt]=W}else this.sessionDesc.mediaDescriptions.push(W);return W}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(S=>S.media.port!=="0").map(S=>S.attributes.mid)}mungRecvMediaDsec(S,w,b){const I=Nn(S);return XS(I),Qc(I,w),$S(I,w),pO(I),b_(I,b,this.localCapabilities.send),I}mungSendMediaDesc(S,w){const b=Nn(S);return b_(b,w,this.localCapabilities.recv),qa(b),b}updateRecvMedia(S,w){const b=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===S);if(b!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[b],w);this.sessionDesc.mediaDescriptions[b]=I}}bumpMid(S){this.currentMidIndex+=S}findFirstClosedMedia(S){return this.sessionDesc.mediaDescriptions.find(w=>nn()?w.media.port==="0"&&w.media.mediaType===S:w.media.port==="0")}findPreloadMediaDesc(S){return this.sessionDesc.mediaDescriptions.find(w=>{var b;return((b=w.attributes)===null||b===void 0||(b=b.ssrcs[0])===null||b===void 0?void 0:b.ssrcId)===S[0].ssrcId})}getSSRC(S){var w;return(w=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===S))===null||w===void 0?void 0:w.attributes.ssrcs}}({remoteIceParameters:t,remoteDtlsParameters:e,candidates:i,remoteRTPCapabilities:s,remoteSetup:r,localCapabilities:this.localCapabilities,cname:a});const c=this.remoteSDP.toString(),l=En.parse(this.initialOffer.sdp),u=l.mediaDescriptions.find(S=>S.media.mediaType==="audio");u&&qa(u),this.useXR&&A_(l);const h=En.print(l),f=this.logSDPExchange(h||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),f==null||f(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const g=this.peerConnection.getTransceivers()[0];if(g!=null&&g.receiver&&this.tryBindTransportEvents(g.receiver),x("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const S=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:S});const w=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(w)}}catch(c){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}}send(t,e,i){var s=this;return rr(function*(){const r=yield Ie(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=[];t.forEach(b=>{const I=s.peerConnection.addTransceiver(b._mediaStreamTrack,{direction:"sendonly"});a.push(I),b._updateRtpTransceiver(I)}),nn()&&x("SIMULCAST")===!0&&(yield Ie(s.applySimulcastForFirefox(a,t)));const c=yield Ie(s.peerConnection.createOffer()),l=s.remoteSDP.predictReceivingMids(t.length),u=s.mungSendOfferSDP(c.sdp,t,l),h=En.parse(u),f=l.map(b=>{const I=h.mediaDescriptions.find(U=>U.attributes.mid===b);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return uO(I,x("USE_PUB_RTX"))});let g;try{g=yield f}catch(b){g=[],s.remoteSDP.receive(t,e,i,g);const I=s.remoteSDP.toString();throw yield Ie(s.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Ie(s.peerConnection.setRemoteDescription({type:"answer",sdp:I})),yield Ie(s.stopSending(l,!0)),b}s.remoteSDP.receive(t,e,i,g);const S=s.remoteSDP.toString(),w=s.logSDPExchange(u,"offer","local","send");return yield Ie(s.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Ie(s.applySimulcastEncodings(a,t)),yield Ie(s.applySendEncodings(a,t)),w==null||w(S),yield Ie(s.peerConnection.setRemoteDescription({type:"answer",sdp:S})),a.map((b,I)=>{const U=l[I];return{localSSRC:f[I],id:U,transceiver:b}})}catch(a){throw a instanceof Q?a:new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{r()}})()}async createDataChannels(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);i&&i.readyState==="open"?v.debug("[P2PConnection] Channels are already available and can be reused directly."):(i=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)),e.forEach(r=>{r._updateOriginDataChannel(i)});const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),v.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else v.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof Q?i:new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const e=this.dataStreamChannelMap.get(t);return e==null||e.close(),void this.dataStreamChannelMap.delete(t)}catch(e){throw e instanceof Q?e:new Q(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(t,e){const i=e?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(l=>{var u;l.direction="inactive",(u=l.stop)===null||u===void 0||u.call(l)});const r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,e,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:r,needExchangeSDP:a}=this.remoteSDP.send(t,e,i,s);if(a){const l=this.remoteSDP.toString(),u=this.logSDPExchange(l,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(h.sdp,r,t);u==null||u(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find(l=>l.mid===r);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:r,transceiver:c}}catch(r){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:e,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();r==null||r(a.sdp||""),await this.peerConnection.setLocalDescription(a),v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return e.map(s=>{const r=this.peerConnection.getTransceivers().find(a=>a.mid===s);if(!r)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:r.receiver.track,id:s,transceiver:r}})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(a=>{a.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const r=this.remoteSDP.toString();s==null||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(async(a,c)=>{a.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const r=this.remoteSDP.toString();s==null||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(t){var e=this;return rr(function*(){const i=yield Ie(e.mutex.lock("From P2PConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ye().supportPCSetConfiguration){const u=e.peerConnection.getConfiguration(),h=t===mi.RELAY?"relay":"all";u.iceTransportPolicy!==h&&(v.debug("[".concat(e.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(h,"]")),u.iceTransportPolicy=h,e.peerConnection.setConfiguration(u))}else if(t===mi.RELAY)return;e.remoteSDP.updateCandidates(t);const s=yield Ie(e.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=$c(s.sdp),{remoteIceParameters:a}=yield r.iceParameters;e.remoteSDP.restartICE(a);const c=e.remoteSDP.toString(),l=e.logSDPExchange(s.sdp||"","offer","local","restartICE");e.store.descriptionStart(),yield Ie(e.peerConnection.setLocalDescription(s)),l==null||l(c),yield Ie(e.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(s){v.warning("[".concat(e.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[e],[t]);this.remoteSDP.updateRecvMedia(t,e);const r=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),a==null||a(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,e){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(e)?nn()||await this.applySimulcastEncodings(i,[e]):await this.applySendEncodings(i,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getTransceivers().find(s=>s.mid===e);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const e=t[0].transport.iceTransport,{local:i,remote:s}=e.getSelectedCandidatePair();return{local:El(El({},Co),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:El(El({},Co),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...wh.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...wh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),x("ENABLE_ENCODED_TRANSFORM")&&Ye().supportWebRTCEncodedTransform&&(e.encodedInsertableStreams=!0),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(hh(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}tryBindTransportEvents(t){const e=t.transport;if(e){this.transportEventReceiver=t,e.onstatechange=()=>{var s;e!=null&&e.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,e.state))},e.onerror=s=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in s?s.error:s)};const i=e.iceTransport;i&&(i.onstatechange=()=>{const s=e==null?void 0:e.iceTransport.state;var r;s&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:r}=i.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,e){var i;if(e||(e=this.peerConnection.getSenders().find(h=>h.track===t._mediaStreamTrack)),!e)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ye().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},r={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var a;const{bitrateMax:h,frameRate:f,scaleResolutionDownBy:g}=t._encoderConfig;h&&(r.maxBitrate=1e3*h),Wt(a=t._hints).call(a,Qe.LOW_STREAM)&&(f&&(r.maxFramerate=Hs(f)),g&&g>=1&&(r.scaleResolutionDownBy=g))}if(x("DSCP_TYPE")&&Oa()){var c;const h=x("DSCP_TYPE");Wt(c=["very-low","low","medium","high"]).call(c,h)&&(r.networkPriority=h)}const l=e.getParameters(),u=(i=l.encodings)===null||i===void 0?void 0:i[0];nn()&&!u&&(s.encodings=[r]),u&&Object.assign(u,r),Object.assign(l,s),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await e.setParameters(l)}async applySendEncodings(t,e){try{if(!Ye().supportSetRtpSenderParameters||t.length!==e.length)return;for(let i=0;i<t.length;i++){const s=t[i],r=e[i];r instanceof he&&!this.isVP8Simulcast(r)&&await this.updateRtpSenderEncodings(r,s.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e,i){const s=En.parse(t);return e.forEach((r,a)=>{const c=i[a],l=s.mediaDescriptions.find(u=>u.attributes.mid===c);l&&(Qc(l,r),QS(l,r,this.store.codec))}),En.print(s)}mungReceiveAnswerSDP(t,e,i){const s=En.parse(t),r=s.mediaDescriptions.find(a=>a.attributes.mid===e);return r&&(i===bt.AUDIO&&r.media.mediaType==="audio"&&qa(r),this.useXR&&A_(s)),En.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;(e=this.onFirstVideoDecodedTimeout)===null||e===void 0||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let l=0;l<t.length;l++){var i,s,r,a,c;const u=t[l],h=e[l];if(h instanceof he&&!Wt(i=h._hints).call(i,Qe.LOW_STREAM)&&(s=h._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((r=h._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=h._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=h._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},g={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const S=u.sender.getParameters();await u.sender.setParameters(Object.assign(S,f))}}}async applySimulcastEncodings(t,e){if(!nn()&&t.length===e.length)for(let i=0;i<t.length;i++){const s=e[i];if(s instanceof he&&this.isVP8Simulcast(s)){const r=t[i],a={},c={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=r.sender.getParameters();await r.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var e,i,s,r,a;return!!(t instanceof he&&x("SIMULCAST")&&this.store.codec==="vp8"&&!Wt(e=t._hints).call(e,Qe.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(r=t._scalabilityMode)!==null&&r!==void 0&&r.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,e,i,s){if(x("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(e," SDP during P2PConnection.").concat(s,`
`),t),e==="offer"?r=>{this.logSDPExchange(r,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return e==null?void 0:e[0].ssrcId}setConfiguration(t){if(Ye().supportPCSetConfiguration){const e=wh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}};function Ks(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function nv(n,t){let e=document.createElement("video"),i=document.createElement("canvas");e.setAttribute("style","display:none"),i.setAttribute("style","display:none"),e.setAttribute("muted",""),e.muted=!0,e.setAttribute("autoplay",""),e.autoplay=!0,e.setAttribute("playsinline",""),i.width=Hs(t.width),i.height=Hs(t.height);const s=Hs(t.framerate||15);document.body.append(e),document.body.append(i);let r=n._mediaStreamTrack;e.srcObject=new MediaStream([r]),e.play();const a=i.getContext("2d");if(!a)throw new G(O.UNEXPECTED_ERROR,"can not get canvas context");const c=Ye(),l=i.captureStream(c.supportRequestFrame?0:s).getVideoTracks()[0];l.canvas||(l.canvas=i),i.startCapture=()=>{if(!e)return i.stopCapture&&i.stopCapture();if(e.paused&&e.play(),e.videoHeight>2&&e.videoWidth>2){const h=e.videoWidth,f=e.videoHeight/h,g=i.width*f;Math.abs(g-i.height)>=2&&(v.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(g)),i.height=g)}a.drawImage(e,0,0,i.width,i.height),l.requestFrame&&l.requestFrame(),r!==n._mediaStreamTrack&&(r=n._mediaStreamTrack,e.srcObject=new MediaStream([r]))},i.stopCapture=rS(()=>i.startCapture&&i.startCapture(),s);const u=l.stop;return l.stop=()=>{u.call(l),e&&(e.remove(),e.srcObject=null,e=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),v.debug("clean low stream renderer")},l}function PO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function LO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?PO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):PO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}et([Ks,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],si.prototype,"connect",null),et([Ks,A("design:type",Function),A("design:paramtypes",[Object,Array]),A("design:returntype",K)],si.prototype,"createDataChannels",null),et([Ks,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",K)],si.prototype,"receive",null),et([Ks,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],si.prototype,"batchReceive",null),et([Ks,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],si.prototype,"stopReceiving",null),et([Ks,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],si.prototype,"muteRemote",null),et([Ks,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],si.prototype,"unmuteRemote",null),et([Ks,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],si.prototype,"muteLocal",null),et([Ks,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],si.prototype,"unmuteLocal",null),et([Ks,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],si.prototype,"close",null),et([Ks,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],si.prototype,"updateEncoderConfig",null),et([Ks,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],si.prototype,"updateSendParameters",null),et([Ks,A("design:type",Function),A("design:paramtypes",[Ei,String]),A("design:returntype",K)],si.prototype,"replaceTrack",null),et([Ks,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],si.prototype,"getRemoteSSRC",null);const kO=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,O_="9",iv=2e4,sv=4e4;class M4{get localCapabilities(){return Nn(this._localCapabilities)}get rtpCapabilities(){return Nn(this._rtpCapabilities)}get candidates(){return Nn(this._candidates)}get iceParameters(){return Nn(this._iceParameters)}get dtlsParameters(){return Nn(this._dtlsParameters)}constructor(t){m(this,"sessionDesc",void 0),m(this,"_localCapabilities",void 0),m(this,"_rtpCapabilities",void 0),m(this,"_candidates",void 0),m(this,"_iceParameters",void 0),m(this,"_dtlsParameters",void 0),m(this,"setup",void 0),m(this,"currentMidIndex",void 0),m(this,"cname",void 0),m(this,"firefoxSsrcMidMap",new Map),t=Nn(t);const{remoteIceParameters:e,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:r,remoteSetup:a,localCapabilities:c,cname:l}=t,u=En.parse(kO);this._rtpCapabilities=r,this._candidates=s,this._iceParameters=e,this._dtlsParameters=i,this._localCapabilities=c,this.setup=a,this.cname=l;const h=this.rtpCapabilities.send;for(const f of u.mediaDescriptions){if(f.attributes.iceUfrag=e.iceUfrag,f.attributes.icePwd=e.icePwd,f.attributes.fingerprints=i.fingerprints,f.attributes.candidates=s,f.attributes.setup=a,f.media.mediaType==="application"&&(f.attributes.sctpPort="5000"),f.media.mediaType==="video"&&(f.media.fmts=h.videoCodecs.map(g=>g.payloadType.toString(10)),f.attributes.payloads=h.videoCodecs,f.attributes.extmaps=h.videoExtensions,x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:g,ssrcGroups:S}=or([{ssrcId:sv,rtx:x("USE_SUB_RTX")?40001:void 0}],this.cname);f.attributes.ssrcs=g,f.attributes.ssrcGroups=S}if(f.media.mediaType==="audio"&&(f.media.fmts=h.audioCodecs.map(g=>g.payloadType.toString(10)),f.attributes.payloads=h.audioCodecs,f.attributes.extmaps=h.audioExtensions,qa(f),x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:g,ssrcGroups:S}=or([{ssrcId:iv}],this.cname);f.attributes.ssrcs=g,f.attributes.ssrcGroups=S}}this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const e=En.parse(kO);this._rtpCapabilities=t;const i=this.rtpCapabilities.send;for(const s of e.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"&&(s.media.fmts=i.videoCodecs.map(r=>r.payloadType.toString(10)),s.attributes.payloads=i.videoCodecs,s.attributes.extmaps=i.videoExtensions,x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:r,ssrcGroups:a}=or([{ssrcId:sv,rtx:x("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=r,s.attributes.ssrcGroups=a}if(s.media.mediaType==="audio"&&(s.media.fmts=i.audioCodecs.map(r=>r.payloadType.toString(10)),s.attributes.payloads=i.audioCodecs,s.attributes.extmaps=i.audioExtensions,x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:r,ssrcGroups:a}=or([{ssrcId:iv}],this.cname);s.attributes.ssrcs=r,s.attributes.ssrcGroups=a}}this.sessionDesc=e,this.currentMidIndex=e.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const e=this.candidates,i=this.dtlsParameters,s=this.iceParameters,r=this.rtpCapabilities.send;for(let a=1;a<t;a++){const c=2*a+iv,l=2*a+sv,{ssrcs:u,ssrcGroups:h}=or([{ssrcId:c}],this.cname),{ssrcs:f,ssrcGroups:g}=or([{ssrcId:l,rtx:x("USE_SUB_RTX")?l+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:O_,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.videoCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:e,extmaps:r.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:g,rtcpFeedbackWildcards:[],payloads:r.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:O_,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.audioCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:e,extmaps:r.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:h,rtcpFeedbackWildcards:[],payloads:r.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return En.print(this.sessionDesc)}send(t,e,i,s){const{ssrcs:r,ssrcGroups:a}=or(e,this.cname,x("SYNC_GROUP")?i:void 0),c=this.findPreloadMediaDesc(r);if(c){if(nn()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,c.attributes.mid),s&&(s.twcc||s.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(c,s),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(t,r);let u;return l===-1||Vi()||Fi()||SI()||l===0&&x("USE_SUB_RTX")?(u=this.createOrRecycleSendMedia(t,r,a,"sendonly",s),this.updateBundleMids()):(u=Nn(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="sendonly",u.attributes.ssrcs=r,u.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(u,s)),nn()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const e=t.map(r=>{let{kind:a,ssrcMsg:c,mslabel:l}=r;return this.send(a,c,l)}),i=[];let s=!1;return e.forEach(r=>{let{mid:a,needExchangeSDP:c}=r;c&&(s=!0),i.push(a)}),{mids:i,needExchangeSDP:s}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(i=>{i.attributes.mid==="0"||nn()||Vi()||Fi()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const e=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));e.attributes.direction="inactive"}unmute(t){const e=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));e.attributes.direction="sendonly"}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>Wt(t).call(t,i.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>Wt(t).call(t,i.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,e,i,s){t.forEach((r,a)=>{this.createOrRecycleRecvMedia(r,[],"recvonly",e,i,s[a])}),this.updateBundleMids()}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===mi.TCP?this._candidates.forEach(e=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===e.connectionAddress&&i.port===e.port)===-1&&this._candidates.push(LO(LO({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}):this._candidates=this._candidates.filter(e=>e.transport!=="tcp");for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(t){t=Nn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const e=[];for(let i=0;i<t;i++)e.push((this.currentMidIndex+i+1).toString(10));return e}findAvailableMediaIndex(t,e){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(nn()){if(s){const r=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(r||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!r||r!==i.attributes.mid)}return!1}return s})}createOrRecycleRecvMedia(t,e,i,s,r,a){const c=t._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=this.localCapabilities.send;let h=[];if(c===bt.VIDEO){var f,g;if(x("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(h=l.videoCodecs.filter(U=>{var F,V,Z;return Wt(F=((V=U.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").call(F,s)&&(U==null||(Z=U.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"])===x("H264_PROFILE_LEVEL_ID")})),!h||((f=h)===null||f===void 0?void 0:f.length)===0){const U=u.videoCodecs.filter(F=>{var V,Z;return Wt(V=((Z=F.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())||"").call(V,s)});U.length!==0&&(h=l.videoCodecs.filter(F=>U.some(V=>V.payloadType===F.payloadType)))}if(x("USE_PUB_RTX")){const U=h.map(V=>V.payloadType.toString()),F=l.videoCodecs.filter(V=>{var Z,$;return((Z=V.rtpMap)===null||Z===void 0?void 0:Z.encodingName)==="rtx"&&Wt(U).call(U,(($=V.fmtp)===null||$===void 0?void 0:$.parameters.apt)||"")});h=[...h,...F]}h.length===0&&(v.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat((g=l.videoCodecs[0].rtpMap)===null||g===void 0?void 0:g.encodingName)),h=l.videoCodecs)}else h=l.audioCodecs.filter(U=>{var F,V;return Wt(F=((V=U.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").call(F,r)}),h.length===0&&(v.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),h=l.audioCodecs.filter(U=>{var F,V;return Wt(F=((V=U.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").call(F,"opus")}));const S=c===bt.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let b={media:{mediaType:c,port:O_,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:S,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};b=this.mungRecvMediaDsec(b,t,a);const I=this.findFirstClosedMedia(c);if(I){const U=this.sessionDesc.mediaDescriptions.indexOf(I);this.sessionDesc.mediaDescriptions[U]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}createOrRecycleSendMedia(t,e,i,s,r){const a=this.rtpCapabilities.send,c=t===bt.VIDEO?a.videoCodecs:a.audioCodecs,l=t===bt.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let h={media:{mediaType:t,port:O_,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};h=this.mungSendMediaDesc(h,r);const f=this.findFirstClosedMedia(t);if(f){const g=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[g]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,e,i){const s=Nn(t);return XS(s),Qc(s,e),$S(s,e),pO(s),b_(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,e){const i=Nn(t);return b_(i,e,this.localCapabilities.recv),qa(i),i}updateRecvMedia(t,e){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],e);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>nn()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var i;return((i=e.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var e;return(e=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||e===void 0?void 0:e.attributes.ssrcs}}function MO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function N_(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?MO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):MO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Ni extends Hf{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,e,i){super(t,e),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"remoteSDP",void 0),m(this,"initialOffer",void 0),m(this,"transportEventReceiver",void 0),m(this,"statsFilter",void 0),m(this,"useXR",x("USE_XR")),m(this,"localCapabilities",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"dataStreamChannelMap",new Map),m(this,"establishPromise",void 0),m(this,"mutex",new Zn("NVExtentionsConnection-mutex")),m(this,"rtcMedia",void 0),this.store=e,this.peerConnection=i,this.statsFilter=w_(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=$c(e.sdp),s=await fO({filterRTX:!x("USE_PUB_RTX")&&!x("USE_SUB_RTX"),filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC")},{useXR:this.useXR});return this.localCapabilities=s,this.initialOffer=e,N_(N_({},i),{},{rtpCapabilities:s,offerSDP:e.sdp})}catch(e){throw new G(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(t,e,i,s,r,a){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new M4({remoteIceParameters:t,remoteDtlsParameters:e,candidates:i,remoteRTPCapabilities:s,remoteSetup:r,localCapabilities:ZS(this.localCapabilities),cname:a});const c=this.remoteSDP.toString(),l=En.parse(this.initialOffer.sdp),u=l.mediaDescriptions.find(g=>g.media.mediaType==="audio");u&&qa(u),this.useXR&&A_(l);const h=En.print(l),f=this.logSDPExchange(h||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),f==null||f(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(c){throw new G(O.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(c.toString()))}}async updateRemoteConnect(t){var e,i,s;(e=this.remoteSDP)===null||e===void 0||e.updateRemoteRTPCapabilities(t),(i=this.remoteSDP)===null||i===void 0||i.preloadRemoteMedia(2);const r=(s=this.remoteSDP)===null||s===void 0?void 0:s.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),v.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,e,i){var s=this;return rr(function*(){const r=yield Ie(s.mutex.lock("From NVExtentionsConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const a=[];t.forEach(b=>{const I=s.peerConnection.addTransceiver(b._mediaStreamTrack,{direction:"sendonly"});a.push(I)}),nn()&&x("SIMULCAST")===!0&&(yield Ie(s.applySimulcastForFirefox(a,t)));const c=yield Ie(s.peerConnection.createOffer()),l=s.remoteSDP.predictReceivingMids(t.length),u=s.mungSendOfferSDP(c.sdp,t,l),h=En.parse(u),f=l.map(b=>{const I=h.mediaDescriptions.find(U=>U.attributes.mid===b);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return uO(I,x("USE_PUB_RTX"))});let g;try{g=yield f}catch(b){g=[],s.remoteSDP.receive(t,e,i,g);const I=s.remoteSDP.toString();throw yield Ie(s.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Ie(s.peerConnection.setRemoteDescription({type:"answer",sdp:I})),yield Ie(s.stopSending(l,!0)),b}s.remoteSDP.receive(t,e,i,g);const S=s.remoteSDP.toString(),w=s.logSDPExchange(u,"offer","local","send");return yield Ie(s.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Ie(s.applySimulcastEncodings(a,t)),yield Ie(s.applySendEncodings(a,t)),w==null||w(S),yield Ie(s.peerConnection.setRemoteDescription({type:"answer",sdp:S})),a.map((b,I)=>{const U=l[I];return{localSSRC:f[I],id:U,transceiver:b}})}catch(a){throw a instanceof G?a:new G(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(a.toString()))}finally{r()}})()}async stopSending(t,e){const i=e?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");s.map(l=>{var u;l.direction="inactive",(u=l.stop)===null||u===void 0||u.call(l)});const r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async createDataChannels(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);return i&&i.readyState==="open"?v.debug("[P2PConnection] Channels are already available and can be reused directly."):(i=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)),void e.forEach(s=>{s._updateOriginDataChannel(i)})}catch(i){throw i instanceof G?i:new G(O.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const e=this.dataStreamChannelMap.get(t);return e==null||e.close(),void this.dataStreamChannelMap.delete(t)}catch(e){throw e instanceof G?e:new G(O.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(e.toString()))}}async receive(t,e,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:r,needExchangeSDP:a}=this.remoteSDP.send(t,e,i,s);if(a){const l=this.remoteSDP.toString(),u=this.logSDPExchange(l,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(h.sdp,r,t);u==null||u(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),v.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else v.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find(l=>l.mid===r);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:r}}catch(r){throw new G(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(r.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:e,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();r==null||r(a.sdp||""),await this.peerConnection.setLocalDescription(a),v.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else v.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return e.map(s=>{const r=this.peerConnection.getTransceivers().find(a=>a.mid===s);if(!r)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:r.receiver.track,id:s}})}catch(e){throw new G(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new G(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new G(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new G(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(a=>{a.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const r=this.remoteSDP.toString();s==null||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new G(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(async(a,c)=>{a.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const r=this.remoteSDP.toString();s==null||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new G(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(t){var e=this;return rr(function*(){const i=yield Ie(e.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ye().supportPCSetConfiguration){const u=e.peerConnection.getConfiguration(),h=t===mi.RELAY?"relay":"all";u.iceTransportPolicy!==h&&(v.debug("restartICE change iceTransportPolicy from [".concat(u.iceTransportPolicy,"] to [").concat(h,"]")),u.iceTransportPolicy=h,e.peerConnection.setConfiguration(u))}else if(t===mi.RELAY)return;t!==mi.RELAY&&e.remoteSDP.updateCandidates(t);const s=yield Ie(e.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=$c(s.sdp),{remoteIceParameters:a}=yield r.iceParameters;e.remoteSDP.restartICE(a);const c=e.remoteSDP.toString(),l=e.logSDPExchange(s.sdp||"","offer","local","restartICE");yield Ie(e.peerConnection.setLocalDescription(s)),l==null||l(c),yield Ie(e.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(s){v.warning("restart ICE failed, abort operation",s)}finally{i()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[e],[t]);this.remoteSDP.updateRecvMedia(t,e);const r=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),a==null||a(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(i){throw new G(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,e){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(e)?nn()||await this.applySimulcastEncodings(i,[e]):await this.applySendEncodings(i,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getTransceivers().find(s=>s.mid===e);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return N_(N_({},$c(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...Ni.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...Ni.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(hh(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}async applySendEncodings(t,e){try{if(!Ye().supportSetRtpSenderParameters||t.length!==e.length)return;for(let f=0;f<t.length;f++){const g=t[f],S=e[f];if(S&&S instanceof he){var i,s,r;if(this.isVP8Simulcast(S))continue;const w={},b={};switch(S._optimizationMode){case"motion":w.degradationPreference="maintain-framerate";break;case"detail":w.degradationPreference="maintain-resolution";break;default:w.degradationPreference="balanced"}var a,c,l,u;if((i=S._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(b.maxBitrate=1e3*((a=S._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),Wt(s=S._hints).call(s,Qe.LOW_STREAM)&&((c=S._encoderConfig)!==null&&c!==void 0&&c.frameRate&&(b.maxFramerate=Hs(S._encoderConfig.frameRate)),(l=S._encoderConfig)!==null&&l!==void 0&&l.scaleResolutionDownBy&&((u=S._encoderConfig)===null||u===void 0?void 0:u.scaleResolutionDownBy)>1&&(b.scaleResolutionDownBy=S._encoderConfig.scaleResolutionDownBy)),x("DSCP_TYPE")&&Oa()){var h;const F=x("DSCP_TYPE");Wt(h=["very-low","low","medium","high"]).call(h,F)&&(b.networkPriority=F)}const I=g.sender.getParameters(),U=(r=I.encodings)===null||r===void 0?void 0:r[0];nn()&&!U&&(w.encodings=[b]),U&&Object.assign(U,b),Object.assign(I,w),await g.sender.setParameters(I)}}}catch{v.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,e,i){const s=En.parse(t);return e.forEach((r,a)=>{const c=i[a],l=s.mediaDescriptions.find(u=>u.attributes.mid===c);l&&(Qc(l,r),QS(l,r,this.store.codec))}),En.print(s)}mungReceiveAnswerSDP(t,e,i){const s=En.parse(t),r=s.mediaDescriptions.find(a=>a.attributes.mid===e);return r&&i===bt.AUDIO&&r.media.mediaType==="audio"&&qa(r),this.useXR&&A_(s),En.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;(e=this.onFirstVideoDecodedTimeout)===null||e===void 0||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let l=0;l<t.length;l++){var i,s,r,a,c;const u=t[l],h=e[l];if(h instanceof he&&!Wt(i=h._hints).call(i,Qe.LOW_STREAM)&&(s=h._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((r=h._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=h._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=h._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},g={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const S=u.sender.getParameters();await u.sender.setParameters(Object.assign(S,f))}}}async applySimulcastEncodings(t,e){if(!nn()&&t.length===e.length)for(let i=0;i<t.length;i++){const s=e[i];if(s instanceof he&&this.isVP8Simulcast(s)){const r=t[i],a={},c={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=r.sender.getParameters();await r.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var e,i,s,r,a;return!!(t instanceof he&&x("SIMULCAST")&&this.store.codec==="vp8"&&!Wt(e=t._hints).call(e,Qe.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(r=t._scalabilityMode)!==null&&r!==void 0&&r.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,e,i,s){if(x("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(e," SDP during NVExtentionsConnection.").concat(s,`
`),t),e==="offer"?r=>{this.logSDPExchange(r,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return e==null?void 0:e[0].ssrcId}setConfiguration(t){if(Ye().supportPCSetConfiguration){const e=Ni.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}}function gs(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From NVExtentionsConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function UO(n){var t,e,i,s=2;for(typeof Symbol<"u"&&(e=aO,i=Symbol.iterator);s--;){if(e&&(t=n[e])!=null)return t.call(n);if(i&&(t=n[i])!=null)return new D_(t.call(n));e="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function D_(n){function t(e){if(Object(e)!==e)return K.reject(new TypeError(e+" is not an object."));var i=e.done;return K.resolve(e.value).then(function(s){return{value:s,done:i}})}return D_=function(e){this.s=e,this.n=e.next},D_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var i=this.s.return;return i===void 0?K.resolve({value:e,done:!0}):t(i.apply(this.s,arguments))},throw:function(e){var i=this.s.return;return i===void 0?K.reject(e):t(i.apply(this.s,arguments))}},new D_(n)}et([gs,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],Ni.prototype,"connect",null),et([gs,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],Ni.prototype,"updateRemoteConnect",null),et([gs,A("design:type",Function),A("design:paramtypes",[Object,Array]),A("design:returntype",K)],Ni.prototype,"createDataChannels",null),et([gs,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",K)],Ni.prototype,"receive",null),et([gs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Ni.prototype,"batchReceive",null),et([gs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Ni.prototype,"stopReceiving",null),et([gs,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Ni.prototype,"muteRemote",null),et([gs,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Ni.prototype,"unmuteRemote",null),et([gs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Ni.prototype,"muteLocal",null),et([gs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Ni.prototype,"unmuteLocal",null),et([gs,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ni.prototype,"close",null),et([gs,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],Ni.prototype,"updateEncoderConfig",null),et([gs,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],Ni.prototype,"updateSendParameters",null),et([gs,A("design:type",Function),A("design:paramtypes",[Ei,String]),A("design:returntype",K)],Ni.prototype,"replaceTrack",null),et([gs,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Ni.prototype,"getRemoteSSRC",null);class zn extends Hf{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,e){super(t,e),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"cname",void 0),m(this,"mutex",new Zn("DataChannelConnection-mutex")),m(this,"dataChannel",void 0),m(this,"_p2pConnection",void 0),m(this,"establishPromise",void 0),m(this,"_nvMedia",void 0),this.store=e,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(zn.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Ni(t,e,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const e=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(e)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,e,i,s,r,a){return this.cname=a,await this._p2pConnection.connect(t,e,i,s,r,a),await new K((c,l)=>{const u=setTimeout(()=>{this.closeSignal(),l(new G(O.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(u),void c()},this.dataChannel.onerror=h=>{this.closeSignal(),l(h)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(t,e,i){var s=this;return rr(function*(){const r=yield Ie(s.mutex.lock("From DataChannelConnection.send"));try{return yield*R_(UO(s._p2pConnection.send(t,e,i)))}finally{r()}})()}async stopSending(t,e){return this._p2pConnection.stopSending(t,e)}async createDataChannels(t,e){return this._p2pConnection.createDataChannels(t,e)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,e,i,s){return this._nvMedia?(v.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,e,this.cname)):(v.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,e,i,s))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var e=this;return rr(function*(){return yield*R_(UO(e._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var e;(e=this._nvMedia)===null||e===void 0||e.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,e){return await this._p2pConnection.updateEncoderConfig(t,e)}async updateSendParameters(t,e){return await this._p2pConnection.updateSendParameters(t,e)}setStatsRemoteVideoIsReady(t,e){this._p2pConnection.setStatsRemoteVideoIsReady(t,e)}async replaceTrack(t,e){return await this._p2pConnection.replaceTrack(t,e)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,e,i,s){if(x("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(e," SDP during DataChannelConnection.").concat(s,`
`),t),e==="offer"?r=>{this.logSDPExchange(r,"answer",i==="local"?"remote":"local",s)}:void 0}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...zn.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...zn.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(hh(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var e;return(e=this.onICEConnectionStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var e;return(e=this.onConnectionStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var e;return(e=this.onDTLSTransportStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var e;return(e=this.onDTLSTransportError)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var e;return(e=this.onICETransportStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var e;return(e=this.onFirstAudioReceived)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var e;return(e=this.onFirstVideoReceived)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var e;return(e=this.onFirstAudioDecoded)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,e,i)=>{var s;return(s=this.onFirstVideoDecoded)===null||s===void 0?void 0:s.call(this,t,e,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var e;return(e=this.onFirstVideoDecodedTimeout)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,e)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,e)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,e)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,e)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}}function cr(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From DataChannelConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function xO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function VO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?xO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):xO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}et([cr,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],zn.prototype,"connect",null),et([cr,A("design:type",Function),A("design:paramtypes",[Object,Array]),A("design:returntype",K)],zn.prototype,"createDataChannels",null),et([cr,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",K)],zn.prototype,"receive",null),et([cr,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],zn.prototype,"stopReceiving",null),et([cr,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],zn.prototype,"muteRemote",null),et([cr,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],zn.prototype,"unmuteRemote",null),et([cr,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],zn.prototype,"muteLocal",null),et([cr,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],zn.prototype,"unmuteLocal",null),et([cr,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],zn.prototype,"close",null),et([cr,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],zn.prototype,"updateEncoderConfig",null),et([cr,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],zn.prototype,"updateSendParameters",null),et([cr,A("design:type",Function),A("design:paramtypes",[Ei,String]),A("design:returntype",K)],zn.prototype,"replaceTrack",null),et([cr,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],zn.prototype,"getRemoteSSRC",null);class FO extends rn{constructor(){super(),m(this,"uplinkStatsUploadInterval",void 0),m(this,"uplinkRelatedStatsUploadInterval",void 0),m(this,"uplinkDenoiserStatsUploadInterval",void 0),m(this,"transportStatsUploadInterval",void 0),m(this,"uplinkExtensionStatsUploadInterval",void 0),m(this,"downlinkExtensionStatsUploadInterval",void 0),m(this,"extensionUsageStatsUploadInterval",void 0),m(this,"downlinkStatsUploadInterval",void 0),m(this,"downlinkRelatedStatsUploadInterval",void 0),m(this,"lastStats",void 0),m(this,"uploadUnplinkStarted",!1),m(this,"uploadDownlinkStarted",!1),m(this,"uploadTransportStarted",!1),m(this,"uploadExtensionUsageStarted",!1),m(this,"requestStats",void 0),m(this,"requestTransportStats",void 0),m(this,"requestLocalMedia",void 0),m(this,"requestRemoteMedia",void 0),m(this,"requestAllTracks",void 0),m(this,"requestVideoIsReady",void 0),m(this,"requestUpload",void 0)}startUploadTransportStats(t){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var e;const i=(e=this.requestStats)===null||e===void 0?void 0:e.call(this);if(i){const r=x0(i);if(t){var s;const a=(s=this.requestStats)===null||s===void 0?void 0:s.call(this,!0);if(a){const c=x0(a);r.connectionType+=c.connectionType<<3}r.connectionType+=110}else r.connectionType+=100;vr(()=>{var a;(a=this.requestUpload)===null||a===void 0||a.call(this,as.TRANSPORT_STATS,r)})}},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var e,i,s;const r=Date.now(),a={connectionInterval:x("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let c=[];const l=((e=this.requestAllTracks)===null||e===void 0?void 0:e.call(this))||[];for(const g of l)!g.muted&&g.enabled&&(c=c.concat(await g.getProcessorUsage()));const u=((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[];for(const[g,S]of u)S.has(bt.VIDEO)&&g.videoTrack&&(c=c.concat(await g.videoTrack.getProcessorUsage())),S.has(bt.AUDIO)&&g.audioTrack&&(c=c.concat(await g.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(g,S){const w={};for(const{id:F,value:V,level:Z,direction:$}of g){var b;const W=(b=S.get(F))!==null&&b!==void 0?b:0,Y=V===2?W+x("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:W;var I,U;S.set(F,Y),w[F]?(V===2&&(w[F].value=V),Z>w[F].level&&(w[F].level=Z),$==="remote"&&(w[F].remoteUidCount+=1),w[F].totalTs=(I=S.get(F))!==null&&I!==void 0?I:0):w[F]={value:V,level:Z,remoteUidCount:$==="local"?0:1,totalTs:(U=S.get(F))!==null&&U!==void 0?U:0}}return Object.keys(w).map(F=>{const{level:V,value:Z,totalTs:$}=w[F];return{id:F,level:V,value:Z,totalTs:$}})}(c,t);const h=Date.now(),f=h>r?h:r+1;(s=this.requestUpload)===null||s===void 0||s.call(this,as.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:f})},x("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);e&&(this.uploadUplinkStats(e),this.lastStats=e)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);e&&this.uploadRelatedUplinkStats(e,this.lastStats),this.lastStats=e},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);e&&this.uploadDenoiserStats(e)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);e&&this.uploadExtensionStats(e)},2e3))}uploadUplinkStats(t){var e;(((e=this.requestLocalMedia)===null||e===void 0?void 0:e.call(this))||[]).forEach(i=>{let[s,{track:r,ssrcs:a}]=i;switch(s){case st.LocalVideoLowTrack:case st.LocalVideoTrack:{const c=function(h,f,g){var S;const w=f.videoSend.find(I=>I.ssrc===h);if(!w)return null;const b={id:Ge(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:w.ssrc.toString()};switch(b.A_vstd=g._originMediaStreamTrack&&!g._originMediaStreamTrack.enabled||g._mediaStreamTrack&&!g._mediaStreamTrack.enabled?"1":"0",w.sentFrame&&(b.A_fhs=w.sentFrame.height.toString(),b.A_frs=w.sentFrame.frameRate.toString(),b.A_fws=w.sentFrame.width.toString()),w.adaptionChangeReason){case"none":b.A_ac="0";break;case"cpu":b.A_ac="1";break;case"bandwidth":b.A_ac="2";break;case"other":b.A_ac="3"}return b.A_lvps=iS[g._player?g._player.videoElementStatus:"uninit"].toString(),b.A_nr=(S=w.nacksCount)===null||S===void 0?void 0:S.toString(),w.avgEncodeMs&&(b.A_aem=w.avgEncodeMs.toFixed(0).toString()),x("P2P")&&(w.bytes&&(b.bytesSent=w.bytes.toString()),typeof w.packetsLost=="number"&&(b.packetsLost=w.packetsLost.toString()),w.packets&&(b.packetsSent=w.packets.toString())),b}(a[0].ssrcId,t,r),l=s===st.LocalVideoTrack?function(h,f,g){var S,w,b,I,U,F,V,Z;const $=f.videoSend.find(ut=>ut.ssrc===h);if(!$)return null;const W={id:Ge(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:$.ssrc.toString()},Y=(S=(w=(b=$.inputFrame)===null||b===void 0?void 0:b.height)!==null&&w!==void 0?w:g==null?void 0:g._videoHeight)!==null&&S!==void 0?S:0,nt=(I=(U=(F=$.inputFrame)===null||F===void 0?void 0:F.width)!==null&&U!==void 0?U:g==null?void 0:g._videoWidth)!==null&&I!==void 0?I:0,mt=(V=(Z=$.inputFrame)===null||Z===void 0?void 0:Z.frameRate)!==null&&V!==void 0?V:0;return Y&&(W.A_fhi=Y+""),nt&&(W.A_fwi=nt+""),mt&&(W.A_fri=mt+""),W}(a[0].ssrcId,t,r):null;c&&vr(()=>{var h;return(h=this.requestUpload)===null||h===void 0?void 0:h.call(this,as.PUBLISH_STATS,{stream_type:s===st.LocalVideoLowTrack?"low":"high",stats:VO(VO({},c),l)})});const u=function(h){const f={id:"bweforvideo",timestamp:new Date(h.timestamp).toISOString(),type:"VideoBwe"};return h.bitrate.retransmit&&(f.A_rb=h.bitrate.retransmit.toString()),h.bitrate.targetEncoded&&(f.A_teb=h.bitrate.targetEncoded.toString()),f.A_aeb=h.bitrate.actualEncoded.toString(),f.A_tb=h.bitrate.transmit.toString(),h.sendBandwidth!==void 0&&(f.A_asb=h.sendBandwidth.toString()),f}(t);u&&setTimeout(()=>{var h;return(h=this.requestUpload)===null||h===void 0?void 0:h.call(this,as.PUBLISH_STATS,{stream_type:s===st.LocalVideoLowTrack?"low":"high",stats:u})},1e3);break}case st.LocalAudioTrack:{const c=function(l,u,h){const f=u.audioSend.find(S=>S.ssrc===l);if(!f)return null;const g={id:Ge(10,""),timestamp:new Date(u.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:f.ssrc.toString()};return g.A_astd=h._originMediaStreamTrack&&!h._originMediaStreamTrack.enabled||h._mediaStreamTrack&&!h._mediaStreamTrack.enabled?"1":"0",f.inputLevel?g.A_ail=Math.round(100*f.inputLevel).toString():g.A_ail=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),g.A_apil=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),f.aecReturnLoss&&(g.A_ecrl=Math.round(f.aecReturnLoss).toString()),f.aecReturnLossEnhancement&&(g.A_ecrle=Math.round(f.aecReturnLossEnhancement).toString()),x("P2P")&&(f.bytes&&(g.bytesSent=f.bytes.toString()),typeof f.packetsLost=="number"&&(g.packetsLost=f.packetsLost.toString()),f.packets&&(g.packetsSent=f.packets.toString())),g}(a[0].ssrcId,t,r);c&&vr(()=>{var l;return(l=this.requestUpload)===null||l===void 0?void 0:l.call(this,as.PUBLISH_STATS,{stream_type:"high",stats:c})});break}}})}uploadRelatedUplinkStats(t,e){var i;(((i=this.requestLocalMedia)===null||i===void 0?void 0:i.call(this))||[]).filter(s=>{let[r]=s;return r===st.LocalVideoLowTrack||r===st.LocalVideoTrack}).forEach(s=>{let[r,{ssrcs:a}]=s;const c=function(l,u){const h=u.videoSend.find(f=>f.ssrc===l);return h?{mediaType:"video",isVideoMute:!1,frameRateInput:h.inputFrame&&h.inputFrame.frameRate.toString(),frameRateSent:h.sentFrame&&h.sentFrame.frameRate.toString(),googRtt:h.rttMs.toString(),qpSumPerFrame:Math.floor(h.qpSumPerFrame).toString()}:null}(a[0].ssrcId,t);c&&vr(()=>{var l;(l=this.requestUpload)===null||l===void 0||l.call(this,as.PUBLISH_RELATED_STATS,{stream_type:r===st.LocalVideoLowTrack?"low":"high",stats:c})})})}uploadDenoiserStats(t){for(let r=0;r<t.length;r++){const a=t[r];if(a instanceof Va){var e,i,s;const c=(e=(i=a._external).getDenoiserStats)===null||e===void 0?void 0:e.call(i);return void(c&&((s=this.requestUpload)===null||s===void 0||s.call(this,as.DENOISER_STATS,c)))}}}uploadExtensionStats(t){for(let e=0;e<t.length;e++)t[e].getProcessorStats().forEach(i=>{var s;(s=this.requestUpload)===null||s===void 0||s.call(this,i.type,i.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this,!0);s&&(this.uploadDownlinkStats(s,e,t),t=s),e=!e},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this,!0);s&&(this.uploadRelatedDownlinkStats(s,this.lastStats),this.lastStats=s)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this);s&&this.uploadDownlinkExtensionStats(s)},2e3)}uploadDownlinkStats(t,e,i){var s;(((s=this.requestRemoteMedia)===null||s===void 0?void 0:s.call(this))||[]).forEach(r=>{let[a,c]=r;if(c.has(bt.VIDEO)&&a.videoTrack){const l=a.videoTrack?function(u,h,f,g,S){const w=h.videoRecv.find(F=>F.ssrc===u);if(!w)return null;const b={id:Ge(10,""),timestamp:new Date(h.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:w.ssrc.toString()};var I,U;if(b.bytesReceived=w.bytes.toString(),b.packetsLost=w.packetsLost.toString(),b.packetsReceived=w.packets.toString(),w.framesRateFirefox&&(b.A_frr=w.framesRateFirefox.toString()),w.receivedFrame?(b.A_frr=w.receivedFrame.frameRate.toString(),b.A_fhr=w.receivedFrame.height.toString(),b.A_fwr=w.receivedFrame.width.toString()):(b.A_fhr=(I=g._videoHeight)===null||I===void 0?void 0:I.toString(),b.A_fwr=(U=g._videoWidth)===null||U===void 0?void 0:U.toString()),b.A_frd=w.decodeFrameRate.toString(),w.outputFrame&&(b.A_fro=w.outputFrame.frameRate.toString()),w.jitterBufferMs!==void 0&&(b.A_jbm=Math.floor(w.jitterBufferMs).toString()),w.currentDelayMs!==void 0&&(b.A_cdm=Math.floor(w.currentDelayMs).toString()),b.A_fs=w.firsCount.toString(),b.A_ns=w.nacksCount.toString(),b.A_ps=w.plisCount.toString(),g&&(b.A_vrtd=g._originMediaStreamTrack.enabled&&g._mediaStreamTrack.enabled?"0":"1"),g._player&&g._player.freezeTimeCounterList.length>0&&(b.A_vrft=Math.round(g._player.freezeTimeCounterList.splice(0,1)[0]).toString()),S&&g._player&&Zo.visibility==="visible"){const F=Math.min(6e3,g._player.renderFreezeAccTime);b.A_vrrft=Math.round(F).toString(),g._player.renderFreezeAccTime=Math.max(0,g._player.renderFreezeAccTime-F)}if(b.A_rvps=iS[g._player?g._player.videoElementStatus:"uninit"].toString(),f){const F=f.videoRecv.find(V=>V.ssrc===u);if(F&&w.totalInterFrameDelay!==void 0&&w.totalSquaredInterFrameDelay!==void 0&&F.totalInterFrameDelay!==void 0&&F.totalSquaredInterFrameDelay!==void 0){const V=w.totalInterFrameDelay-F.totalInterFrameDelay,Z=w.totalSquaredInterFrameDelay-F.totalSquaredInterFrameDelay,$=w.framesDecodeCount-F.framesDecodeCount,W=V/$*1e3,Y=Math.round(1e3*Math.sqrt((Z-Math.pow(V,2)/$)/$));!isNaN(Y)&&W+Y>Math.max(3*W,W+150)&&(b.A_ifdsd=Y.toString())}}return b}(a._videoSSRC,t,i,a.videoTrack,e):void 0;l&&vr(()=>{var u;return(u=this.requestUpload)===null||u===void 0?void 0:u.call(this,as.SUBSCRIBE_STATS,{stream_id:a.uid,stats:l})})}if(c.has(bt.AUDIO)&&a.audioTrack){const l=a.audioTrack?function(u,h,f,g){const S=h.audioRecv.find(b=>b.ssrc===u);if(!S)return null;const w={id:Ge(10,""),timestamp:new Date(h.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:S.ssrc.toString()};if(w.bytesReceived=S.bytes.toString(),w.packetsLost=S.packetsLost.toString(),w.packetsReceived=S.packets.toString(),S.outputLevel?w.A_aol=Math.round(100*S.outputLevel).toString():w.A_aol=Math.round(100*g._source.getAccurateVolumeLevel()).toString(),w.A_apol=Math.round(100*g._source.getAccurateVolumeLevel()).toString(),g&&(w.A_artd=g._originMediaStreamTrack.enabled&&g._mediaStreamTrack.enabled?"0":"1"),w.A_jr=S.jitterMs.toString(),w.A_jbm=Math.floor(S.jitterBufferMs).toString(),w.A_cdm=Math.floor(S.jitterBufferMs).toString(),w.A_raps=iS[Es.getPlayerState(g.getTrackId())].toString(),f){const b=f.audioRecv.find(I=>I.ssrc===u);if(b){const I=S.concealedSamples-b.concealedSamples;I>0&&(w.A_cs=Math.round(I).toString())}}return w}(a._audioSSRC,t,i,a.audioTrack):void 0;l&&vr(()=>{var u;return(u=this.requestUpload)===null||u===void 0?void 0:u.call(this,as.SUBSCRIBE_STATS,{stream_id:a.uid,stats:l})})}})}uploadRelatedDownlinkStats(t,e){var i;(((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[]).forEach(s=>{let[r,a]=s;if(a.has(bt.VIDEO)&&r.videoTrack){var c;const l=(r._videoSSRC&&((c=this.requestVideoIsReady)===null||c===void 0?void 0:c.call(this,r._videoSSRC))||!1)===!0,u=function(h,f,g,S,w,b){const I=g.videoRecv.find(Z=>Z.ssrc===h),U=w?w.videoRecv.find(Z=>Z.ssrc===h):void 0;if(!I)return null;const F=fl.isRemoteVideoFreeze(b,I,U)&&f,V={mediaType:"video",isVideoMute:!1,peerId:S,frameRateReceived:I.receivedFrame&&I.receivedFrame.frameRate.toString(),frameRateDecoded:I.decodedFrame&&I.decodedFrame.frameRate.toString(),isFreeze:F,bytesReceived:I.bytes.toString(),packetsReceived:I.packets.toString(),packetsLost:I.packetsLost.toString(),qpSumPerFrame:Math.floor(I.qpSumPerFrame).toString()};return I.framesRateFirefox&&(V.frameRateDecoded=I.framesRateFirefox.toString(),V.frameRateReceived=I.framesRateFirefox.toString()),V}(r._videoSSRC,l,t,r.uid,e,r.videoTrack);u&&vr(()=>{var h;(h=this.requestUpload)===null||h===void 0||h.call(this,as.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:u})})}if(a.has(bt.AUDIO)&&r.audioTrack){const l=function(u,h,f,g){const S=h.audioRecv.find(b=>b.ssrc===u);if(!S)return null;const w=fl.isRemoteAudioFreeze(g);return{mediaType:"audio",isAudioMute:!1,peerId:f,googJitterReceived:S.jitterMs.toString(),isFreeze:w,bytesReceived:S.bytes.toString(),packetsReceived:S.packets.toString(),packetsLost:S.packetsLost.toString(),frameReceived:S.receivedFrames.toString(),frameDropped:S.droppedFrames.toString()}}(r._audioSSRC,t,r.uid,r.audioTrack);l&&vr(()=>{var u;(u=this.requestUpload)===null||u===void 0||u.call(this,as.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:l})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(t){t.forEach(e=>{let[i,s]=e;s.has(bt.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(r=>{var a;(a=this.requestUpload)===null||a===void 0||a.call(this,r.type,r.stats)}),s.has(bt.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(r=>{var a;(a=this.requestUpload)===null||a===void 0||a.call(this,r.type,r.stats)})})}}function BO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function za(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?BO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):BO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function jO(n){var t,e,i,s=2;for(typeof Symbol<"u"&&(e=aO,i=Symbol.iterator);s--;){if(e&&(t=n[e])!=null)return t.call(n);if(i&&(t=n[i])!=null)return new P_(t.call(n));e="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function P_(n){function t(e){if(Object(e)!==e)return K.reject(new TypeError(e+" is not an object."));var i=e.done;return K.resolve(e.value).then(function(s){return{value:s,done:i}})}return P_=function(e){this.s=e,this.n=e.next},P_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var i=this.s.return;return i===void 0?K.resolve({value:e,done:!0}):t(i.apply(this.s,arguments))},throw:function(e){var i=this.s.return;return i===void 0?K.reject(e):t(i.apply(this.s,arguments))}},new P_(n)}class pi extends rn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Gt.StateChange,e,this._state)}constructor(t,e){super(),m(this,"store",void 0),m(this,"statsUploader",void 0),m(this,"connection",void 0),m(this,"localTrackMap",new Map),m(this,"remoteUserMap",new Map),m(this,"localDataChannels",[]),m(this,"remoteDataChannelMap",new Map),m(this,"pendingLocalTracks",[]),m(this,"pendingRemoteTracks",[]),m(this,"pendingLocalDataChannels",[]),m(this,"pendingRemoteDataChannels",[]),m(this,"statsCollector",void 0),m(this,"isPlanB",!1),m(this,"shouldForwardP2PCreation",void 0),m(this,"iceFailedCount",0),m(this,"dtlsFailedCount",0),m(this,"mutex",new Zn("P2PChannel-mutex")),m(this,"_state",Ce.Disconnected),m(this,"_pcStatsUploadType",x("NEW_ICE_RESTART")?Wr.FIRST_CONNECTION:Wr.OLD_FIRST_CONNECTION),m(this,"_isInRestartIce",!1),m(this,"_isStartRestartIce",!1),m(this,"_restartStates",["disconnected","failed"]),m(this,"_restartTimer",void 0),m(this,"_isFirstConnected",!0),m(this,"handleMuteLocalTrack",async(i,s,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ce.Connected)return void r(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(i);if(c.length===0)return void s();const l=c.find(h=>h[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(h=>{let[,{id:f}]=h;return f}));const u=this.createMuteMessage(c);await qe(this,Gt.RequestMuteLocal,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleUnmuteLocalTrack",async(i,s,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ce.Connected)return void r(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void s();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];if(h.track._originMediaStreamTrack.stop(),!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding){const f=i._mediaStreamTrack.clone();h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f}else{const f=nv(i,Xo(this,Gt.RequestLowStreamParameter));h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f}await new K((f,g)=>{this.handleReplaceTrack(h.track,f,g,!0)})}await this.connection.unmuteLocal(c.map(h=>{let[,{id:f}]=h;return f}));const u=this.createUnmuteMessage(c);await qe(this,Gt.RequestUnmuteLocal,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleUpdateVideoEncoder",async(i,s,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const c=this.localTrackMap.get(st.LocalVideoTrack);if(!this.connection||!c||c.track!==i||this.state!==Ce.Connected)return void s();const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),await this.connection.updateEncoderConfig(l,u),this.emit(Gt.UpdateVideoEncoder,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleSetOptimizationMode",async(i,s,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const c=this.localTrackMap.get(st.LocalVideoTrack);if(!this.connection||!c||c.track!==i||this.state!==Ce.Connected)return;const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleReplaceTrack",async(i,s,r,a)=>{let c;v.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:g}]=f;return i===g});if(!this.connection||!h||this.state!==Ce.Connected)return void s();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),this.isPlanB){const f=h[1];f.id=i._mediaStreamTrack.id,this.localTrackMap.set(h[0],f)}if(h[0]===st.LocalVideoTrack&&!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding){const f=this.localTrackMap.get(st.LocalVideoLowTrack);if(f){const g=i._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=g,f.track._originMediaStreamTrack=g,await new K((S,w)=>{this.handleReplaceTrack(f.track,S,w,!0)})}}s()}catch(h){r(h)}finally{var u;(u=c)===null||u===void 0||u()}}),m(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),m(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),m(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),m(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new FO,this.bindStatsUploaderEvents(),this.isPlanB=!Ye().supportUnifiedPlan||x("CHROME_FORCE_PLAN_B")&&Oa(),this.shouldForwardP2PCreation=x("FORWARD_P2P_CREATION")&&Ye().supportPCSetConfiguration&&function(){const i=yf();return i===Qn.ANDROID||i===Qn.IOS||i===Qn.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new zn({},this.store):this.isPlanB?new ii({},this.store):new si({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,e){var i;this.state=Ce.New;const s=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new zn(t,this.store):this.isPlanB?new ii(t,this.store):new si(t,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=x("NEW_ICE_RESTART")?Wr.FIRST_CONNECTION:Wr.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t,e,i,s,r,a){if(!this.connection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof zn?this.connection.updateRemoteConnect(s):(this.store.peerConnectionStart(),await this.connection.connect(t,e,i,s,r,a),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ce.Connected)}async preConnect(t,e,i,s,r,a){if(!this.connection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const c=await this.connection.connect(t,e,i,s,r,a);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ce.Connected,c}getEstablishParams(){if(this.connection instanceof zn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(t){if(!this.connection){if(this.state===Ce.Disconnected)throw new Q(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const i=t.filter(s=>this.pendingLocalDataChannels.findIndex(r=>r.id===s.id)!==-1);return void(this.pendingLocalDataChannels=this.pendingLocalDataChannels.concat(i))}const e=this.filterTobePublishedDataChannels(t);e.length!==0&&(e.forEach(i=>{const s=Date.now();this.store.publish(i.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(i=>{this.localDataChannels.push(i);const s=Date.now();this.store.publish(i.id+"","datachannel",void 0,s)}))}publish(t,e,i){var s=this;return rr(function*(){const r=yield Ie(s.mutex.lock("From P2PChannel.publish"));try{if(!s.connection||s.state!==Ce.Connected){if(s.state===Ce.Disconnected)throw new Q(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(t);const c=t.filter(l=>s.pendingLocalTracks.indexOf(l)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(c))}s.store.pubId=s.store.pubId+1,gi.markPublishStart(s.store.clientId,s.store.pubId);const a=s.filterTobePublishedTracks(t,e,i);if(a.length===0)return void(yield Ie(s.tryToUnmuteAudio(t)));yield*R_(jO(s.doPublish(s.connection,a)))}finally{r()}})()}doPublish(t,e){var i=this;return rr(function*(){e.forEach(h=>{let{track:f,type:g}=h;const S=Date.now();i.store.publish(f.getTrackId(),g===st.LocalAudioTrack?"audio":"video",S)}),i.bindLocalTrackEvents(e);const s=yield Ie(t.send(e.map(h=>{let{track:f}=h;return f}),i.store.codec,i.store.audioCodec)),r=(yield Ie(s.next())).value,a=i.createGatewayPublishMessage(e,r);let c;try{c=yield a}catch(h){throw s.throw(h),(h==null?void 0:h.code)===O.WS_ABORT&&e.forEach(f=>{let{track:g}=f;i.pendingLocalTracks.indexOf(g)===-1&&i.pendingLocalTracks.push(g)}),i.unbindLocalTrackEvents(e),h}const l=i.mapPubResToRemoteConfig(a,c),u=(yield Ie(s.next(l))).value;e.forEach(h=>{let{type:f}=h;i.statsCollector.addLocalStats(f)}),i.assignLocalTracks(e,u),i.statsUploader.startUploadUplinkStats(),e.forEach(h=>{let{track:f,type:g}=h;const S=Date.now();i.store.publish(f.getTrackId(),g===st.LocalAudioTrack?"audio":"video",void 0,S)})})()}async updateVideoStreamParameter(t,e){const i=this.localTrackMap.get(e);if(!i)return;if(!(i.track instanceof he))return v.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof si||this.connection instanceof ii))return v.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:s}=i,r=function(a,c){const l={};return a.height&&a.width&&(l.scaleResolutionDownBy=VS(a,c)),l.maxFramerate=a.framerate?Hs(a.framerate):void 0,l.maxBitrate=a.bitrate?1e3*a.bitrate:void 0,l}(t,s);if(s._encoderConfig||(s._encoderConfig={}),e!==st.LocalVideoLowTrack||!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const a=s._originMediaStreamTrack;if(!a.canvas)return v.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(c,l){const u=c.canvas;l.width&&(u.width=Hs(l.width)),l.height&&(u.height=Hs(l.height)),l.framerate&&(u.stopCapture&&u.stopCapture(),u.stopCapture=rS(()=>{!u.startCapture&&u.stopCapture&&u.stopCapture(),u.startCapture&&u.startCapture()},Hs(l.framerate)))})(a,t)}r.maxBitrate!=null&&(s._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=r.maxFramerate:s._encoderConfig.frameRate={max:r.maxFramerate}),v.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(t){var e=this;return rr(function*(){if(!e.connection||e.state!==Ce.Connected)return;const i=yield Ie(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(st.LocalVideoTrack);if(!r)throw new Q(O.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(st.LocalVideoLowTrack))throw new Q(O.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:e.getLowVideoTrack(r.track,t),type:st.LocalVideoLowTrack}];if(yield*R_(jO(e.doPublish(e.connection,a))),r.track.muted||!r.track.enabled){var s;const c=(s=e.localTrackMap.get(st.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;c!==void 0&&(yield Ie(e.connection.muteLocal([c])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await hn(this,Gt.RequestRePublish,this.pendingLocalTracks),this.emit(Gt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(v.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await hn(this,Gt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:i,kind:s}=this.pendingRemoteTracks[e];(s!==bt.AUDIO||i._audio_added_&&i._audioSSRC)&&(s!==bt.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await hn(this,Gt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:i}of this.pendingRemoteTracks)await this.subscribe(e,i,i===bt.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:i}=e;this.emit(Gt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Ce.Connected)return void t.forEach(s=>{const r=this.pendingLocalTracks.indexOf(s);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const i=e.find(s=>s[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Ce.Connected)return void t.forEach(i=>{const s=this.pendingLocalDataChannels.indexOf(i);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(i=>{const s=this.localDataChannels.indexOf(i);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ce.Connected)return;const t=this.localTrackMap.get(st.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[st.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const i=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(s=>{let[,{id:r}]=s;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(s=>{let[r,{track:a}]=s;return{type:r,track:a}})),e.forEach(s=>{let[r]=s;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),i}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Ce.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=e.filter(s=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(s.id))});if(i.length!==0)return await this.connection.createDataChannels(t.uid,i),i.forEach(s=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(s.id,s):this.remoteDataChannelMap.set(t,new Map([[s.id,s]]));const a=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:u}=c;return l.uid===t.uid&&u===s.id});a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),i.map(s=>s.id)}async subscribe(t,e,i,s,r){var a;if(!this.connection||this.state!==Ce.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(t))!==null&&a!==void 0&&a.has(e))return;let c,l,u;if(r){const g=r.find(w=>{let{stream_type:b}=w;return b===e});if(!g)throw new Q(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const S=await this.connection.receive(e,g.ssrcs,String(t._uintid),g.attributes);this.connection instanceof si&&(u=S.transceiver),c=S.track,l=S.id}else{const g=await this.connection.receive(e,[{ssrcId:i,rtx:s}],String(t._uintid),void 0);this.connection instanceof si&&(u=g.transceiver),c=g.track,l=g.id}e===bt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new Rr(c,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),u&&t._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new go(c,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),u&&t._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._videoTrack));const h=this.remoteUserMap.get(t);h?h.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats();const f=this.pendingRemoteTracks.findIndex(g=>{let{user:S,kind:w}=g;return S.uid===t.uid&&e===w});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Gt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Ce.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(i=>{var s;let{user:r,mediaType:a}=i;return!((s=this.remoteUserMap.get(r))!==null&&s!==void 0&&s.has(a))});const e=await this.connection.batchReceive(t.map(i=>{let{user:s,mediaType:r,ssrcId:a,rtxSsrcId:c}=i;return{kind:r,ssrcMsg:[{ssrcId:a,rtx:c}],mslabel:String(s._uintid)}}));t.forEach((i,s)=>{let{user:r,mediaType:a}=i;const{track:c,id:l,transceiver:u}=e[s];a===bt.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(c):(r._audioTrack=new Rr(c,r.uid,r._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),u&&r._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(c):(r._videoTrack=new go(c,r.uid,r._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),u&&r._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(r,r._videoTrack));const h=this.remoteUserMap.get(r);h?h.set(a,l):this.remoteUserMap.set(r,new Map([[a,l]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadDownlinkStats();const f=this.pendingRemoteTracks.findIndex(g=>{let{user:S,kind:w}=g;return S.uid===r.uid&&a===w});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Gt.MediaReconnectEnd,r.uid))})}async unsubscribe(t,e,i){const s=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return e!==void 0?l.uid===t.uid&&e===u:l.uid===t.uid});if(s.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Ce.Connected||i||s.forEach(c=>{let{kind:l}=c;var u;if(l===bt.AUDIO)(u=t._audioTrack)===null||u===void 0||u._destroy(),t._audioTrack=void 0;else if(l===bt.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Ce.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const a=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),r.forEach(c=>{let[l,{kind:u}]=c;var h,f;if(u===bt.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===bt.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),i||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(u===bt.AUDIO){var g;this.unbindRemoteTrackEvents(l._audioTrack),!i&&((g=l._audioTrack)===null||g===void 0||g._destroy(),l._audioTrack=void 0)}}),a}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const a=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(t,e);if(i.length===0)return;e.forEach(r=>{r._close()});const s=this.remoteDataChannelMap.get(t);return i.forEach(r=>{s&&s.delete(r.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),i.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:a}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return a!==void 0?u.uid===r.uid&&a===h:u.uid===r.uid});c.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),e=e.concat(c)}if(!this.connection||this.state!==Ce.Connected)return void e.forEach(r=>{let{user:a,kind:c}=r;var l;if(c===bt.AUDIO)(l=a._audioTrack)===null||l===void 0||l._destroy(),a._audioTrack=void 0;else if(c===bt.VIDEO){var u;(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0}});const i=Uc(t).call(t,(r,a)=>{let{user:c,mediaType:l}=a;const u=this.filterTobeUnSubscribedTracks(c,l);return r.concat(u)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(r=>{let[,{id:a}]=r;return a}));const s=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),i.forEach(r=>{let[a,{kind:c}]=r;var l,u;if(c===bt.VIDEO&&a._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===bt.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0;else if(c===bt.AUDIO){var h;this.unbindRemoteTrackEvents(a._audioTrack),(h=a._audioTrack)===null||h===void 0||h._destroy(),a._audioTrack=void 0}}),s}async muteRemote(t,e){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(e))return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const s=e===bt.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(e)||v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(st.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Pn){const i=e.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[r]=s;return r!==st.LocalAudioTrack}).filter(s=>{let[r]=s;return!(t&&r===st.LocalVideoLowTrack)}).map(s=>{let[,{track:r}]=s;return r}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===st.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,i,s,r){if(t){const c=this.localTrackMap.get(st.LocalAudioTrack),l=s?this.localTrackMap.get(st.LocalVideoLowTrack):this.localTrackMap.get(st.LocalVideoTrack);Dt.publish(this.store.sessionId,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Qe.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;i||(i=[]);const c=i.find(u=>u instanceof Le),l=s?(a=this.localTrackMap.get(st.LocalVideoTrack))===null||a===void 0?void 0:a.track:i.find(u=>u instanceof he);Dt.publish(this.store.sessionId,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Qe.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,i,s){const r=s===bt.VIDEO?i._videoSSRC:i._audioSSRC;r&&Dt.subscribe(this.store.sessionId,{succ:t,ec:e,video:s===bt.VIDEO,audio:s===bt.AUDIO,peerid:i.uid,subscribeRequestid:s===bt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:gi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Zn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new zn({},this.store):this.isPlanB?new ii({},this.store):new si({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(st.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Pn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(i=>{e.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ce.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(st.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(st.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof he||e&&e.track instanceof Le?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}getRemoteMedia(t){var e;const i=Array.from(Ps(e=this.remoteUserMap).call(e)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(st.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Ou(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.connection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ce.Reconnecting,x("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var i;e._videoTrack&&e._videoTrack._player&&((i=e._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new zn({},this.store):this.isPlanB?new ii({},this.store):new si({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[i,{track:s}]=t;switch(i){case st.LocalVideoTrack:Wt(e=s._hints).call(e,Qe.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case st.LocalAudioTrack:s instanceof Pn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case st.LocalVideoLowTrack:}}),this.emit(Gt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;Array.from(Ps(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(e,s)}),this.emit(Gt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,i]=t;Array.from(Ps(i).call(i)).forEach(s=>{this.setPendingRemoteDataChannel(e,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const i of this.pendingRemoteDataChannels){const{user:s,id:r}=i;if((t instanceof Ti?t.uid:t)===s.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const i of this.pendingRemoteTracks){const{user:s,kind:r}=i;if((t instanceof Ti?t.uid:t)===s.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return rr(function*(){if(!e.connection||e.state!==Ce.Connected||e.connection instanceof zn)return;const i=yield Ie(e.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield Ie(e.connection.restartICE(t));const a=yield Ie(s.next());if(a.done)return;const c=a.value,l=yield c;switch(e.reportPCDisconnectedOrFailed(t),t){case mi.TCP:e._pcStatsUploadType=Wr.TCP_RESTART;break;case mi.RELAY:e._pcStatsUploadType=Wr.RELAY_RESTART;break;default:e._pcStatsUploadType=Wr.OLD_RESTART}e._isInRestartIce=!0,s.next(l)}catch(a){var r;(r=s)===null||r===void 0||r.throw(a)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(st.LocalVideoTrack),i=this.localTrackMap.get(st.LocalAudioTrack),s=t.videoSend.find(w=>w.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(w=>w.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!s||!r)return 1;const a=_s(this,Gt.NeedSignalRTT),c=s?s.rttMs:void 0,l=r?r.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&a?(u+a)/2:u||a)||0,f=100*t.sendPacketLossRate*.7/50+.3*h/1500,g=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,S=e==null?void 0:e.track;if(S&&S._encoderConfig&&S._hints.indexOf(Qe.SCREEN_TRACK)===-1){const w=S._encoderConfig.bitrateMax,b=t.bitrate.actualEncoded;if(w&&b){const I=(1e3*w-b)/(1e3*w);return KA[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const r=s._audioSSRC,a=s._videoSSRC,c=t.audioRecv.find(b=>b.ssrc===r),l=t.videoRecv.find(b=>b.ssrc===a);if(!c&&!l)return void(e+=1);const u=_s(this,Gt.NeedSignalRTT),h=t.rtt,f=(h&&u?(h+u)/2:h||u)||0,g=c?c.jitterMs:void 0,S=t.recvPacketLossRate;let w=.7*S*100/50+.3*f/1500;g&&(w=.6*S*100/50+.2*f/1500+.2*g/400),e+=w<.1?1:w<.17?2:w<.36?3:w<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new K((e,i)=>{this.handleMuteLocalTrack(t,e,i)})}filterTobePublishedTracks(t,e,i){const s=[],r=Ye(),a=this.getAllTracks();t=Yd(t=t.filter(u=>a.indexOf(u)===-1));let c=!1,l=!1;for(const u of t){if(u instanceof he&&(this.localTrackMap.has(st.LocalVideoTrack)||c?new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:u,type:st.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(u,i);s.push({track:h,type:st.LocalVideoLowTrack})}if(u instanceof Le){const h=this.localTrackMap.get(st.LocalAudioTrack);if(h){if(!(h.track instanceof Pn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){const f=s.find(g=>{let{type:S}=g;return S===st.LocalAudioTrack});if(!(f.track instanceof Pn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(u)}else{if(!r.webAudioMediaStreamDest||u instanceof Pn||u._bypassWebAudio)s.push({track:u,type:st.LocalAudioTrack});else{const f=new Pn;f.addAudioTrack(u),s.push({track:f,type:st.LocalAudioTrack})}l=!0}}}return s}filterTobeUnpublishedTracks(t){const e=[],i=this.getAllTracks();t=Yd(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Le){const r=this.localTrackMap.get(st.LocalAudioTrack);if(!r)continue;r.track instanceof Pn?(r.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),r.track.trackList.length===0&&(e.push([st.LocalAudioTrack,r]),r.track.close())):e.push([st.LocalAudioTrack,r])}if(s instanceof he){const r=this.localTrackMap.get(st.LocalVideoTrack);if(!r)continue;e.push([st.LocalVideoTrack,r]);const a=this.localTrackMap.get(st.LocalVideoLowTrack);a&&e.push([st.LocalVideoLowTrack,a])}}return e}filterTobePublishedDataChannels(t){return t=(t=Yd(t)).filter(e=>this.localDataChannels.findIndex(i=>i.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Yd(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:i,type:s}=e;switch(s){case st.LocalVideoTrack:i.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(yt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case st.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Pn?t.trackList.forEach(i=>{i.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[i,{track:s}]=e;return{track:s,type:i}})),t.forEach(e=>{let{track:i,type:s}=e;switch(s){case st.LocalVideoTrack:i.off(yt.GET_STATS,this.handleGetLocalVideoStats),i.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(yt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case st.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Pn?t.trackList.forEach(e=>{e.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(yt.GET_STATS,this.handleGetLocalAudioStats),e.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof go&&e.addListener(yt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),e instanceof Rr&&e.addListener(yt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;i.has(bt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),i.has(bt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((i,s)=>{var r;let a,c,{track:l,type:u}=i;switch(u){case st.LocalAudioTrack:a=xe.Audio,c={dtx:l instanceof Va&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case st.LocalVideoTrack:a=Wt(r=l._hints).call(r,Qe.SCREEN_TRACK)?xe.Screen:xe.High,c=za(za({},E_(l)),{},{codec:this.store.codec});break;case st.LocalVideoLowTrack:a=xe.Low,c=za(za({},E_(l)),{},{codec:this.store.codec})}return{stream_type:a,attributes:c,ssrcs:e[s]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case st.LocalVideoTrack:s=Wt(i=a._hints).call(i,Qe.SCREEN_TRACK)?xe.Screen:xe.High;break;case st.LocalAudioTrack:s=xe.Audio;break;case st.LocalVideoLowTrack:s=xe.Low}return{stream_type:s,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((i,s)=>{let{track:r,type:a}=i;this.localTrackMap.set(a,{track:r,id:e[s].id,ssrcs:e[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[i]=e;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(Gt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),x("NEW_ICE_RESTART")){var i;if(Wt(i=this._restartStates).call(i,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(c)),_s(this,Gt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Gt.RequestRestartICE,c))},r=()=>{t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="checking"&&t.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),v.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Gt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},a=x("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(x("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ye().supportPCSetConfiguration)s(mi.RELAY),this._restartTimer=window.setTimeout(r,a);else if(nn())s(mi.UDP),this._restartTimer=window.setTimeout(r,4e3);else{if(s(mi.TCP),Ye().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{s(mi.RELAY),this._restartTimer=window.setTimeout(r,a)},a));this._restartTimer=window.setTimeout(r,a)}},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&x("ICE_RESTART")&&_s(this,Gt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Gt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Gt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Gt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Dt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:un.TRACER}).onSuccess(),this.emit(Gt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var i;const s=Array.from(Ps(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===e);var r;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(r=s.audioTrack)===null||r===void 0||r.emit(jc.FIRST_FRAME_DECODED),Dt.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_DECODE,on.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var i;const s=Array.from(Ps(i=this.remoteUserMap).call(i)).find(r=>r._audioSSRC===e);s&&Dt.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_RECEIVED,on.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,i,s)=>{this.reportVideoFirstFrameDecoded(e,i,s)},t.onFirstVideoReceived=e=>{var i;const s=Array.from(Ps(i=this.remoteUserMap).call(i)).find(r=>r._videoSSRC===e);s&&Dt.firstRemoteFrame(this.store.sessionId,Yn.FIRST_VIDEO_RECEIVED,on.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,i)=>{const s=e.candidateType==="relay",r=i.candidateType==="relay";i.candidateType!=="unknown"&&s===r||this.emit(Gt.ConnectionTypeChange,s),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ka(i))," -> ").concat(JSON.stringify(Ka(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,i)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ka(i))," -> ").concat(JSON.stringify(Ka(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const i=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof Le&&(i==null?void 0:i.track)instanceof Pn)return i.track.isActive||e.push([st.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(s&&(e.push(s),s[0]===st.LocalVideoTrack)){const r=this.localTrackMap.get(st.LocalVideoLowTrack);r&&e.push([st.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],i=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof Le&&(i==null?void 0:i.track)instanceof Pn)return i.track.isActive&&e.push([st.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(s)if(s[0]===st.LocalVideoTrack){e.push(s);const r=this.localTrackMap.get(st.LocalVideoLowTrack);r&&e.push([st.LocalVideoLowTrack,r])}else e.push(s);return e}createMuteMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case st.LocalAudioTrack:s=xe.Audio;break;case st.LocalVideoTrack:s=Wt(i=a._hints).call(i,Qe.SCREEN_TRACK)?xe.Screen:xe.High;break;case st.LocalVideoLowTrack:s=xe.Low}return{stream_type:s,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case st.LocalAudioTrack:s=xe.Audio;break;case st.LocalVideoTrack:s=Wt(i=a._hints).call(i,Qe.SCREEN_TRACK)?xe.Screen:xe.High;break;case st.LocalVideoLowTrack:s=xe.Low}return{stream_type:s,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(e){const r=s.get(e);if(!r)return i;i.push([t,{kind:e,id:r}])}else Array.from(s.entries()).forEach(r=>{let[a,c]=r;i.push([t,{kind:a,id:c}])});return i}filterTobeUnSubscribedDataChannels(t,e){const i=[];return e.forEach(s=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(s.id)&&i.push(s)}),i}createUnsubscribeMessage(t){const e=[];return t.forEach(i=>{let[s,{kind:r,id:a}]=i;switch(r){case bt.VIDEO:return void(s._videoSSRC&&e.push({stream_type:bt.VIDEO,ssrcId:s._videoSSRC}));case bt.AUDIO:return void(s._audioSSRC&&e.push({stream_type:bt.AUDIO,ssrcId:s._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(i=>{let[s,{kind:r}]=i;if(e.has(s)){let a=e.get(s);r===bt.VIDEO?a|=Un.Video:a|=Un.Audio,e.set(s,a)}else r===bt.VIDEO?e.set(s,Un.Video):e.set(s,Un.Audio)}),{users:Array.from(e.entries()).map(i=>{let[s,r]=i;return{stream_id:s.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[i,{kind:s}]=e;const r=this.remoteUserMap.get(i);r&&(r.delete(s),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(st.LocalVideoTrack),i=this.localTrackMap.get(st.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),i&&t.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e){return t.map((i,s)=>{var r;let{stream_type:a}=i;return(r=e.find(c=>{let{stream_type:l}=c;return a===l}))===null||r===void 0?void 0:r.attributes})}async tryToUnmuteAudio(t){for(let i=0;i<t.length;i++)if(t[i]instanceof Le){var e;const s=this.filterTobeUnmutedTracks(t[i]);if(s.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(s.map(a=>{let[,{id:c}]=a;return c})));const r=this.createUnmuteMessage(s);return void await qe(this,Gt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Gt.RequestUploadStats,t,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await hi(Nf(this.dtlsFailedCount,Dn)),this.emit(Gt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await hn(this,Gt.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(Gt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(st.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof he)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof he).length>1)throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Le).length>1&&(t.some(e=>e instanceof Le&&e._bypassWebAudio)||!Ye().webAudioMediaStreamDest))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof he&&this.pendingLocalTracks.some(i=>i instanceof he))throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Le&&this.pendingLocalTracks.some(i=>i instanceof Le)&&(!Ye().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Le&&i._bypassWebAudio)))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const i=!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding,s=za(za({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=i?t._mediaStreamTrack.clone():nv(t,s);const a=Ge(8,"track-low-"),c=new he(r,za(za({},i&&{scaleResolutionDownBy:VS(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,a);return c.on(sl.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,Ua.LOW_STREAM)}),c._hints.push(Qe.LOW_STREAM),t.addListener(yt.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof si){var r,a,c,l;const u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:f,peerConnectionState:g}=this.connection,{local:S,remote:w}=await this.connection.getSelectedCandidatePair();Dt.pcStats(this.store.sessionId,{startTime:u,eventElapse:t-u||0,iceconnectionsate:h,dtlsstate:f,connectionstate:g,intSucc:e?1:2,error:s,selectedLocalCandidateProtocol:(r=S==null?void 0:S.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(a=S.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(c=w.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=w.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(w.address,":").concat(w.port),restartCnt:i})}}reportVideoFirstFrameDecoded(t,e,i,s){var r;const a=Array.from(Ps(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(a){s||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");Dt.firstRemoteVideoDecode(this.store.sessionId,Yn.FIRST_VIDEO_DECODE,on.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:i,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,e,i){if(!this.connection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const r=s.get(e);if(!r)return!1;const a=await this.connection.getRemoteSSRC(r);return a!==void 0&&a!==i}resetConnection(t){v.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(t)),this.state===Ce.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=t===Gf.datachannel?new zn({},this.store):this.isPlanB?new ii({},this.store):new si({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:i}]=t;e===st.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Ua.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(t){this.connection&&this.connection instanceof si&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Wr.TCP_RESTART&&t===mi.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Wr.DISCONNECTED_OR_FAILED)))}}function Mi(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From P2PChannel.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function U4(n){let t=HO();return function(e,i){let s=e.appId;s!==void 0&&(Me(i,10),Ro(i,s));let r=e.cid;r!==void 0&&(Me(i,16),Me(i,r));let a=e.cname;a!==void 0&&(Me(i,26),Ro(i,a));let c=e.deviceId;c!==void 0&&(Me(i,34),Ro(i,c));let l=e.elapse;l!==void 0&&(Me(i,40),Ja(i,l));let u=e.fileSize;u!==void 0&&(Me(i,48),Ja(i,gl(u)));let h=e.height;h!==void 0&&(Me(i,56),Ja(i,gl(h)));let f=e.jpg;f!==void 0&&(Me(i,66),Me(i,f.length),function(xn,it){let dt=Tl(xn,it.length);xn.bytes.set(it,dt)}(i,f));let g=e.networkType;g!==void 0&&(Me(i,72),Ja(i,gl(g)));let S=e.osType;S!==void 0&&(Me(i,80),Ja(i,gl(S)));let w=e.requestId;w!==void 0&&(Me(i,90),Ro(i,w));let b=e.sdkVersion;b!==void 0&&(Me(i,98),Ro(i,b));let I=e.sequence;I!==void 0&&(Me(i,104),Ja(i,gl(I)));let U=e.sid;U!==void 0&&(Me(i,114),Ro(i,U));let F=e.timestamp;F!==void 0&&(Me(i,120),Ja(i,F));let V=e.uid;V!==void 0&&(Me(i,128),Me(i,V));let Z=e.vid;Z!==void 0&&(Me(i,136),Me(i,Z));let $=e.width;$!==void 0&&(Me(i,144),Ja(i,gl($)));let W=e.service;W!==void 0&&(Me(i,152),Me(i,W));let Y=e.callbackData;Y!==void 0&&(Me(i,162),Ro(i,Y));let nt=e.jpgEncryption;nt!==void 0&&(Me(i,168),Me(i,nt));let mt=e.requestType;mt!==void 0&&(Me(i,176),Me(i,mt));let ut=e.scorePorn;ut!==void 0&&(Me(i,185),dv(i,ut));let ee=e.scoreSexy;ee!==void 0&&(Me(i,193),dv(i,ee));let Te=e.scoreNeutral;Te!==void 0&&(Me(i,201),dv(i,Te));let be=e.scene;be!==void 0&&(Me(i,208),Me(i,be));let Fe=e.ossFilePrefix;Fe!==void 0&&(Me(i,218),Ro(i,Fe));let _e=e.serviceVendor;if(_e!==void 0)for(let xn of _e){Me(i,226);let it=HO();F4(xn,it),Me(i,it.limit),W4(i,it),G4(it)}}(n,t),function(e){let i=e.bytes,s=e.limit;return i.length===s?i:i.subarray(0,s)}(t)}function x4(n){return function(e){let i={};t:for(;!KO(e);){let s=bo(e);switch(s>>>3){case 0:break t;case 1:i.code=bo(e);break;case 2:i.msg=qO(e,bo(e));break;case 3:{let r=B4(e);i.data=V4(e),e.limit=r;break}default:GO(e,7&s)}}return i}({bytes:t=n,offset:0,limit:t.length});var t}function V4(n){let t={};t:for(;!KO(n);){let e=bo(n);switch(e>>>3){case 0:break t;case 1:t.requestId=qO(n,bo(n));break;case 2:t.requestType=bo(n)>>>0;break;case 3:t.scorePorn=cv(n);break;case 4:t.scoreSexy=cv(n);break;case 5:t.scoreNeutral=cv(n);break;case 6:t.requestScene=bo(n)>>>0;break;case 7:t.scene=bo(n)>>>0;break;default:GO(n,7&e)}}return t}function F4(n,t){let e=n.service;e!==void 0&&(Me(t,8),Me(t,e));let i=n.vendor;i!==void 0&&(Me(t,16),Me(t,i));let s=n.token;s!==void 0&&(Me(t,26),Ro(t,s));let r=n.callbackUrl;r!==void 0&&(Me(t,34),Ro(t,r))}function B4(n){let t=bo(n),e=n.limit;return n.limit=n.offset+t,e}function GO(n,t){switch(t){case 0:for(;128&YO(n););break;case 2:ov(n,bo(n));break;case 5:ov(n,4);break;case 1:ov(n,8);break;default:throw new Error("Unimplemented type: "+t)}}et([Mi,A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",K)],pi.prototype,"startP2PConnection",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],pi.prototype,"connect",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],pi.prototype,"preConnect",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],pi.prototype,"publishDataChannel",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],pi.prototype,"unpublish",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],pi.prototype,"unpublishDataChannel",null),et([Mi,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],pi.prototype,"unpublishLowStream",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Ti,Array]),A("design:returntype",K)],pi.prototype,"subscribeDataChannel",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Ti,String,Number,Number,Array]),A("design:returntype",K)],pi.prototype,"subscribe",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],pi.prototype,"massSubscribe",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Ti,String,Boolean]),A("design:returntype",K)],pi.prototype,"unsubscribe",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Ti,Array]),A("design:returntype",K)],pi.prototype,"unsubscribeDataChannel",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],pi.prototype,"massUnsubscribe",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Ti,String]),A("design:returntype",K)],pi.prototype,"muteRemote",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Ti,String]),A("design:returntype",K)],pi.prototype,"unmuteRemote",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Ti,String]),A("design:returntype",K)],pi.prototype,"hasRemoteMediaWithLock",null),et([Mi,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],pi.prototype,"disconnectForReconnect",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],pi.prototype,"updateBitrateLimit",null),et([Mi,A("design:type",Function),A("design:paramtypes",[Ti,String,Number]),A("design:returntype",K)],pi.prototype,"remoteMediaSsrcChanged",null);let j4=new Float32Array(1);new Uint8Array(j4.buffer);let rv=new Float64Array(1),ls=new Uint8Array(rv.buffer);function gl(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let WO=[];function HO(){const n=WO.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}function G4(n){WO.push(n)}function ov(n,t){if(n.offset+t>n.limit)throw new Error("Skip past limit");n.offset+=t}function KO(n){return n.offset>=n.limit}function Tl(n,t){let e=n.bytes,i=n.offset,s=n.limit,r=i+t;if(r>e.length){let a=new Uint8Array(2*r);a.set(e),n.bytes=a}return n.offset=r,r>s&&(n.limit=r),i}function av(n,t){let e=n.offset;if(e+t>n.limit)throw new Error("Read past limit");return n.offset+=t,e}function qO(n,t){let e=av(n,t),i=String.fromCharCode,s=n.bytes,r="�",a="";for(let c=0;c<t;c++){let l,u,h,f,g=s[c+e];128&g?(224&g)==192?c+1>=t?a+=r:(l=s[c+e+1],(192&l)!=128?a+=r:(f=(31&g)<<6|63&l,f<128?a+=r:(a+=i(f),c++))):(240&g)==224?c+2>=t?a+=r:(l=s[c+e+1],u=s[c+e+2],(49344&(l|u<<8))!=32896?a+=r:(f=(15&g)<<12|(63&l)<<6|63&u,f<2048||f>=55296&&f<=57343?a+=r:(a+=i(f),c+=2))):(248&g)==240?c+3>=t?a+=r:(l=s[c+e+1],u=s[c+e+2],h=s[c+e+3],(12632256&(l|u<<8|h<<16))!=8421504?a+=r:(f=(7&g)<<18|(63&l)<<12|(63&u)<<6|63&h,f<65536||f>1114111?a+=r:(f-=65536,a+=i(55296+(f>>10),56320+(1023&f)),c+=3))):a+=r:a+=i(g)}return a}function Ro(n,t){let e=t.length,i=0;for(let a=0;a<e;a++){let c=t.charCodeAt(a);c>=55296&&c<=56319&&a+1<e&&(c=(c<<10)+t.charCodeAt(++a)-56613888),i+=c<128?1:c<2048?2:c<65536?3:4}Me(n,i);let s=Tl(n,i),r=n.bytes;for(let a=0;a<e;a++){let c=t.charCodeAt(a);c>=55296&&c<=56319&&a+1<e&&(c=(c<<10)+t.charCodeAt(++a)-56613888),c<128?r[s++]=c:(c<2048?r[s++]=c>>6&31|192:(c<65536?r[s++]=c>>12&15|224:(r[s++]=c>>18&7|240,r[s++]=c>>12&63|128),r[s++]=c>>6&63|128),r[s++]=63&c|128)}}function W4(n,t){let e=Tl(n,t.limit),i=n.bytes,s=t.bytes;for(let r=0,a=t.limit;r<a;r++)i[r+e]=s[r]}function YO(n){return n.bytes[av(n,1)]}function zO(n,t){let e=Tl(n,1);n.bytes[e]=t}function cv(n){let t=av(n,8),e=n.bytes;return ls[0]=e[t++],ls[1]=e[t++],ls[2]=e[t++],ls[3]=e[t++],ls[4]=e[t++],ls[5]=e[t++],ls[6]=e[t++],ls[7]=e[t++],rv[0]}function dv(n,t){let e=Tl(n,8),i=n.bytes;rv[0]=t,i[e++]=ls[0],i[e++]=ls[1],i[e++]=ls[2],i[e++]=ls[3],i[e++]=ls[4],i[e++]=ls[5],i[e++]=ls[6],i[e++]=ls[7]}function bo(n){let t,e=0,i=0;do t=YO(n),e<32&&(i|=(127&t)<<e),e+=7;while(128&t);return i}function Me(n,t){for(t>>>=0;t>=128;)zO(n,127&t|128),t>>>=7;zO(n,t)}function Ja(n,t){let e=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,r=s===0?i===0?e<16384?e<128?1:2:e<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,a=Tl(n,r),c=n.bytes;switch(r){case 10:c[a+9]=s>>>7&1;case 9:c[a+8]=r!==9?128|s:127&s;case 8:c[a+7]=r!==8?i>>>21|128:i>>>21&127;case 7:c[a+6]=r!==7?i>>>14|128:i>>>14&127;case 6:c[a+5]=r!==6?i>>>7|128:i>>>7&127;case 5:c[a+4]=r!==5?128|i:127&i;case 4:c[a+3]=r!==4?e>>>21|128:e>>>21&127;case 3:c[a+2]=r!==3?e>>>14|128:e>>>14&127;case 2:c[a+1]=r!==2?e>>>7|128:e>>>7&127;case 1:c[a]=r!==1?128|e:127&e}}function JO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}const H4=new Map([["moderation",1],["supervise",2]]);class L_ extends rn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const e=this._connectionState;this._connectionState=t,this.emit(Gn.CONNECTION_STATE_CHANGE,e,t)}get inspectType(){return this._inspectType}set inspectType(t){var e;this._inspectMode=Uc(e=t.map(i=>H4.get(i)||0)).call(e,(i,s)=>i+s),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),m(this,"name","AgoraRTCVideoContentInspect"),m(this,"_connectionState",Us.CONNECTING),m(this,"_innerConnectionState",void 0),m(this,"sequence",0),m(this,"inspectStartTime",void 0),m(this,"workerManagerConnection",void 0),m(this,"workerConnection",void 0),m(this,"workerMessageLengthLimit",void 0),m(this,"inspectIntervalMinimum",void 0),m(this,"qualityRatio",void 0),m(this,"_connectInfo",void 0),m(this,"_cancelTokenSource",rs.CancelToken.source()),m(this,"_retryConfig",void 0),m(this,"wmSequence",0),m(this,"inspectInterval",void 0),m(this,"inspectTimer",null),m(this,"ossFilePrefix",void 0),m(this,"extraInfo",void 0),m(this,"_inspectType",void 0),m(this,"_inspectMode",void 0),m(this,"_quality",1),m(this,"qualityTimer",null),m(this,"_inspectId",void 0),m(this,"_needWorkUrlOnly",!1),m(this,"inspectImage",()=>{if(this.connectionState!==Us.CONNECTED)throw new G(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Us.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ge(5,"inspect-"),this.workerMessageLengthLimit=x("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=x("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=x("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Yu("worker-manager-"+this._inspectId,Dn),this.on(Gn.STATE_CHANGE,(e,i)=>{this._innerConnectionState=e,v.debug("[".concat(this._inspectId,"] Inspect operation :").concat(xs[e]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Yu("worker-"+this._inspectId,Dn),this.handleWorkerEvents()}async init(t,e){this.emit(Gn.STATE_CHANGE,xs.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=e,new K((s,r)=>{this.on(Gn.CONNECTION_STATE_CHANGE,(a,c)=>{c===Us.CONNECTED&&s()}),this.requestAP(t,i,e).then(a=>{this.connectWorkerManager(a)}).catch(a=>{r(a)})})}async requestAP(t,e,i){const s=x("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),r=await function(c,l,u,h){let{appId:f,areaCode:g,cname:S,sid:w,token:b,uid:I}=l;_l++;const U="image_moderation_api",F={service_name:U,json_body:JSON.stringify({appId:f,areaCode:g,cname:S,command:"allocateEdge",requestId:_l,seq:_l,sid:w,token:b,ts:Date.now(),uid:I+""})};let V,Z,$=c[0];return jr(async()=>{V=Date.now();const W=await sa($,{data:F,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-V,W.code!==0){const ut=new G(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+W.code,{retry:!0,responseTime:Z});throw v.error(ut.toString()),ut}const Y=JSON.parse(W.json_body);if(Y.code!==200){const ut=new G(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Y.code,", reason: ").concat(Y.reason),{code:Y.code,responseTime:Z});throw v.error(ut.toString()),ut}if(!Y.servers||!Array.isArray(Y.servers)||Y.servers.length===0){const ut=new G(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Y.code,responseTime:Z});throw v.error(ut.toString()),ut}const nt=x("VIDEO_INSPECT_WORKER_MANAGER_HOST"),mt=x("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Y.servers.map(ut=>{let{address:ee,wss:Te}=ut;if(ee&&Te)return"wss://".concat(ee.replace(/\./g,"-"),".").concat(nt,":").concat(mt||Te)}).filter(ut=>!!ut),workerToken:Y.workerToken,vid:Y.vid,responseTime:Z}},(W,Y)=>(Dt.apworkerEvent(w,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(W.addressList),firstSuccess:Y===0,responseTime:Z,serverIp:c[Y%c.length]}),!1),(W,Y)=>(Dt.apworkerEvent(w,{success:!1,sc:W.data&&W.data.code||200,serviceName:U,responseTime:Z,serverIp:c[Y%c.length]}),!!(W.code!==O.OPERATION_ABORTED&&W.code!==O.UNEXPECTED_RESPONSE||W.data&&W.data.retry)&&($=c[(Y+1)%c.length],!0)),h)}(s,t,e,i);this.emit(Gn.STATE_CHANGE,xs.AP_CONNECTED);const{addressList:a}=r;return this.wmSequence++,a}async connectWorkerManager(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=e,this.emit(Gn.STATE_CHANGE,xs.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Jt.CONNECTED,async()=>{this.emit(Gn.STATE_CHANGE,xs.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.19.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Jt.CLOSED,()=>{this._innerConnectionState<xs.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Jt.FAILED,()=>{this._innerConnectionState<xs.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Jt.RECONNECTING,()=>{this._innerConnectionState<xs.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Jt.ON_MESSAGE,async t=>{this.emit(Gn.STATE_CHANGE,xs.GET_WORKER_MANAGER_RESPONSE);const e=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw v.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new G(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&e))throw v.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new G(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const s=x("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,r=e.replace(/:\d+\/?$/,":".concat(s));this.emit(Gn.STATE_CHANGE,xs.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(Gn.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}}),this.workerManagerConnection.on(Jt.WILL_RECONNECT,(t,e,i)=>{i(t)}),this.workerManagerConnection.on(Jt.REQUEST_NEW_URLS,(t,e)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(e)})}handleWorkerEvents(){this.workerConnection.on(Jt.CONNECTED,async()=>{this.emit(Gn.STATE_CHANGE,xs.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Us.CONNECTED}),this.workerConnection.on(Jt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=x4(new Uint8Array(t.data));if(x("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&v.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Gn.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var e;const s={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},r=Uc(e=Object.keys(s)).call(e,(c,l)=>s[c]>s[l]?c:l,"porn"),a=Object.keys(s).find(c=>c===r);this.emit(Gn.INSPECT_RESULT,a)}else this.emit(Gn.INSPECT_RESULT,void 0,new G(O.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Gn.INSPECT_RESULT,void 0,new G(O.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else v.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Gn.INSPECT_RESULT,void 0,new G(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Jt.CLOSED,()=>{this.connectionState=Us.CLOSED}),this.workerConnection.on(Jt.FAILED,()=>{this.connectionState=Us.CLOSED}),this.workerConnection.on(Jt.RECONNECTING,()=>{this.connectionState=this.connectionState===Us.CONNECTED?Us.RECONNECTING:Us.CONNECTING}),this.workerConnection.on(Jt.WILL_RECONNECT,(t,e,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(Jt.REQUEST_NEW_URLS,(t,e)=>{this.workerManagerConnection.close(),this.once(Gn.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{e(i)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=_s(this,Gn.CLIENT_LOCAL_VIDEO_TRACK),e={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Gn.INSPECT_RESULT,void 0,new G(O.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,e);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Gn.INSPECT_RESULT,void 0,new G(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,e){let{appId:i,cname:s,cid:r,vid:a,sid:c,uid:l}=e;const u=Date.now(),h=await t.getCurrentFrameImage("image/jpeg",this.quality),f=await Bw(h,i,s),g=this.sequence+"-"+r+"-"+l+"-"+u+"-"+Ge(12,""),S={appId:i,cid:r,cname:s,deviceId:"",elapse:L_.intToLong(Number(u-this.inspectStartTime)),fileSize:f.byteLength,jpgEncryption:2,height:h.height,width:h.width,jpg:f,networkType:6,osType:7,requestId:g,sdkVersion:"4.19.1",sequence:this.sequence,sid:c,timestamp:L_.intToLong(u),uid:l,vid:a,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete S.callbackData,this.ossFilePrefix===void 0&&delete S.ossFilePrefix;const w=U4(S);if(w.byteLength<this.workerMessageLengthLimit){if(x("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const b=function(I){for(var U=1;U<arguments.length;U++){var F=arguments[U]!=null?arguments[U]:{};U%2?JO(Object(F),!0).forEach(function(V){m(I,V,F[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(F)):JO(Object(F)).forEach(function(V){Object.defineProperty(I,V,Object.getOwnPropertyDescriptor(F,V))})}return I}({},S);delete b.jpg,v.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(b))}return w}{const b=this.quality*this.qualityRatio;return this.quality=b,await this.generateRequestData(t,{appId:i,cname:s,cid:r,vid:a,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=rs.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Us.CLOSED,this.emit(Gn.STATE_CHANGE,xs.CLOSED)}}function K4(n){let t=function(){const e=z4.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,i){let s=e.appId;s!==void 0&&(Ln(i,10),td(i,s));let r=e.cid;r!==void 0&&(Ln(i,16),Ln(i,r));let a=e.cname;a!==void 0&&(Ln(i,26),td(i,a));let c=e.deviceId;c!==void 0&&(Ln(i,34),td(i,c));let l=e.elapse;l!==void 0&&(Ln(i,40),Xa(i,l));let u=e.fileSize;u!==void 0&&(Ln(i,48),Xa(i,Sl(u)));let h=e.height;h!==void 0&&(Ln(i,56),Xa(i,Sl(h)));let f=e.jpg;f!==void 0&&(Ln(i,66),Ln(i,f.length),$O(i,f));let g=e.networkType;g!==void 0&&(Ln(i,72),Xa(i,Sl(g)));let S=e.osType;S!==void 0&&(Ln(i,80),Xa(i,Sl(S)));let w=e.requestId;w!==void 0&&(Ln(i,90),td(i,w));let b=e.sdkVersion;b!==void 0&&(Ln(i,98),td(i,b));let I=e.sequence;I!==void 0&&(Ln(i,104),Xa(i,Sl(I)));let U=e.sid;U!==void 0&&(Ln(i,114),td(i,U));let F=e.timestamp;F!==void 0&&(Ln(i,120),Xa(i,F));let V=e.uid;V!==void 0&&(Ln(i,128),Ln(i,V));let Z=e.vid;Z!==void 0&&(Ln(i,136),Ln(i,Z));let $=e.width;$!==void 0&&(Ln(i,144),Xa(i,Sl($)));let W=e.service;W!==void 0&&(Ln(i,152),Ln(i,W));let Y=e.callbackData;Y!==void 0&&(Ln(i,162),Ln(i,Y.length),$O(i,Y));let nt=e.ticket;nt!==void 0&&(Ln(i,170),td(i,nt))}(n,t),function(e){let i=e.bytes,s=e.limit;return i.length===s?i:i.subarray(0,s)}(t)}function q4(n){return function(e){let i={};t:for(;!J4(e);){let s=gh(e);switch(s>>>3){case 0:break t;case 1:i.code=gh(e);break;case 2:i.msg=QO(e,gh(e));break;case 3:i.requestId=QO(e,gh(e));break;case 4:i.timestamp=X4(e,!1);break;default:Y4(e,7&s)}}return i}({bytes:t=n,offset:0,limit:t.length});var t}function Y4(n,t){switch(t){case 0:for(;128&Or(n););break;case 2:lv(n,gh(n));break;case 5:lv(n,4);break;case 1:lv(n,8);break;default:throw new Error("Unimplemented type: "+t)}}function Sl(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let z4=[];function lv(n,t){if(n.offset+t>n.limit)throw new Error("Skip past limit");n.offset+=t}function J4(n){return n.offset>=n.limit}function k_(n,t){let e=n.bytes,i=n.offset,s=n.limit,r=i+t;if(r>e.length){let a=new Uint8Array(2*r);a.set(e),n.bytes=a}return n.offset=r,r>s&&(n.limit=r),i}function XO(n,t){let e=n.offset;if(e+t>n.limit)throw new Error("Read past limit");return n.offset+=t,e}function $O(n,t){let e=k_(n,t.length);n.bytes.set(t,e)}function QO(n,t){let e=XO(n,t),i=String.fromCharCode,s=n.bytes,r="�",a="";for(let c=0;c<t;c++){let l,u,h,f,g=s[c+e];128&g?(224&g)==192?c+1>=t?a+=r:(l=s[c+e+1],(192&l)!=128?a+=r:(f=(31&g)<<6|63&l,f<128?a+=r:(a+=i(f),c++))):(240&g)==224?c+2>=t?a+=r:(l=s[c+e+1],u=s[c+e+2],(49344&(l|u<<8))!=32896?a+=r:(f=(15&g)<<12|(63&l)<<6|63&u,f<2048||f>=55296&&f<=57343?a+=r:(a+=i(f),c+=2))):(248&g)==240?c+3>=t?a+=r:(l=s[c+e+1],u=s[c+e+2],h=s[c+e+3],(12632256&(l|u<<8|h<<16))!=8421504?a+=r:(f=(7&g)<<18|(63&l)<<12|(63&u)<<6|63&h,f<65536||f>1114111?a+=r:(f-=65536,a+=i(55296+(f>>10),56320+(1023&f)),c+=3))):a+=r:a+=i(g)}return a}function td(n,t){let e=t.length,i=0;for(let a=0;a<e;a++){let c=t.charCodeAt(a);c>=55296&&c<=56319&&a+1<e&&(c=(c<<10)+t.charCodeAt(++a)-56613888),i+=c<128?1:c<2048?2:c<65536?3:4}Ln(n,i);let s=k_(n,i),r=n.bytes;for(let a=0;a<e;a++){let c=t.charCodeAt(a);c>=55296&&c<=56319&&a+1<e&&(c=(c<<10)+t.charCodeAt(++a)-56613888),c<128?r[s++]=c:(c<2048?r[s++]=c>>6&31|192:(c<65536?r[s++]=c>>12&15|224:(r[s++]=c>>18&7|240,r[s++]=c>>12&63|128),r[s++]=c>>6&63|128),r[s++]=63&c|128)}}function Or(n){return n.bytes[XO(n,1)]}function ZO(n,t){let e=k_(n,1);n.bytes[e]=t}function gh(n){let t,e=0,i=0;do t=Or(n),e<32&&(i|=(127&t)<<e),e+=7;while(128&t);return i}function Ln(n,t){for(t>>>=0;t>=128;)ZO(n,127&t|128),t>>>=7;ZO(n,t)}function X4(n,t){let e,i=0,s=0,r=0;return e=Or(n),i=127&e,128&e&&(e=Or(n),i|=(127&e)<<7,128&e&&(e=Or(n),i|=(127&e)<<14,128&e&&(e=Or(n),i|=(127&e)<<21,128&e&&(e=Or(n),s=127&e,128&e&&(e=Or(n),s|=(127&e)<<7,128&e&&(e=Or(n),s|=(127&e)<<14,128&e&&(e=Or(n),s|=(127&e)<<21,128&e&&(e=Or(n),r=127&e,128&e&&(e=Or(n),r|=(127&e)<<7))))))))),{low:i|s<<28,high:s>>>4|r<<24,unsigned:t}}function Xa(n,t){let e=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,r=s===0?i===0?e<16384?e<128?1:2:e<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,a=k_(n,r),c=n.bytes;switch(r){case 10:c[a+9]=s>>>7&1;case 9:c[a+8]=r!==9?128|s:127&s;case 8:c[a+7]=r!==8?i>>>21|128:i>>>21&127;case 7:c[a+6]=r!==7?i>>>14|128:i>>>14&127;case 6:c[a+5]=r!==6?i>>>7|128:i>>>7&127;case 5:c[a+4]=r!==5?128|i:127&i;case 4:c[a+3]=r!==4?e>>>21|128:e>>>21&127;case 3:c[a+2]=r!==3?e>>>14|128:e>>>14&127;case 2:c[a+1]=r!==2?e>>>7|128:e>>>7&127;case 1:c[a]=r!==1?128|e:127&e}}const tN={},eN={},M_=4294967296,nN=M_*M_,iN=nN/2,uv=rN(0,!0),sN=rN(0),$4=vl(0,-2147483648,!1),Q4=vl(-1,2147483647,!1),Z4=vl(-1,-1,!0);function rN(n,t){let e,i,s;return t?(s=0<=(n>>>=0)&&n<256)&&(i=eN[n],i)?i:(e=vl(n,0,!0),s&&(eN[n]=e),e):(s=-128<=(n|=0)&&n<128)&&(i=tN[n],i)?i:(e=vl(n,n<0?-1:0,!1),s&&(tN[n]=e),e)}function vl(n,t,e){return{low:0|n,high:0|t,unsigned:!!e}}function t5(n,t){if(isNaN(n))return t?uv:sN;if(t){if(n<0)return uv;if(n>=nN)return Z4}else{if(n<=-iN)return $4;if(n+1>=iN)return Q4}return n<0?t?uv:sN:vl(n%M_|0,n/M_|0,t)}function oN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}class hv extends rn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const e=this._connectionState;this._connectionState=t,this.emit(er.CONNECTION_STATE_CHANGE,t,e)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var e;super(),m(this,"name","AgoraRTCImageModeration"),m(this,"_connectionState",ms.CONNECTING),m(this,"_sequence",0),m(this,"_moderationStartTime",void 0),m(this,"_workerConnection",void 0),m(this,"_workerMessageLengthLimit",void 0),m(this,"_qualityRatio",void 0),m(this,"_connectInfo",void 0),m(this,"_cancelTokenSource",rs.CancelToken.source()),m(this,"_retryConfig",void 0),m(this,"_moderationInterval",void 0),m(this,"_moderationTimer",null),m(this,"_moderationMode",1),m(this,"_quality",1),m(this,"_qualityTimer",null),m(this,"_ticket",void 0),m(this,"_moderationIntervalMinimum",void 0),m(this,"_uploadFailedNum",0),m(this,"_uploadNum",0),m(this,"_uploadTimer",null),m(this,"_moderationId",void 0),m(this,"inspectImage",()=>{if(this.connectionState!==ms.CONNECTED)throw new G(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ms.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ge(5,"image-moderation-"),this._workerMessageLengthLimit=x("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=x("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(e=t.interval)!==null&&e!==void 0?e:1e3,this._qualityRatio=x("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Yu("worker-"+this._moderationId,Dn),this.on(er.STATE_CHANGE,(i,s)=>{v.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Ma[i]," ").concat(s||""))}),this.handleWorkerEvents()}async init(t,e){this.emit(er.STATE_CHANGE,Ma.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=e,new K((s,r)=>{this.on(er.CONNECTION_STATE_CHANGE,(a,c)=>{a===ms.CONNECTED&&s()}),this.requestAP(t,i,e).then(a=>{this.connectWorker(a)}).catch(a=>{r(a)})})}updateConfig(t){var e;this._moderationInterval=(e=t.interval)!==null&&e!==void 0?e:1e3,v.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===ms.CONNECTED&&this.inspectImage()}async requestAP(t,e,i){const s=x("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),r=await function(l,u,h,f){let{appId:g,areaCode:S,cname:w,sid:b,token:I,uid:U}=u;_l++;const F="moderation_plugin",V={service_name:F,json_body:JSON.stringify({appId:g,areaCode:S,cname:w,command:"allocateEdge",requestId:_l,seq:_l,sid:b,appToken:I,ts:Date.now(),uid:U+""})};let Z,$,W=l[0];return jr(async()=>{Z=Date.now();const Y=await sa(W,{data:V,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-Z,Y.code!==0){const ut=new G(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Y.code,{retry:!0,responseTime:$});throw v.error(ut.toString()),ut}const nt=JSON.parse(Y.json_body);if(nt.code!==200){const ut=new G(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(nt.code,", reason: ").concat(nt.reason),{code:nt.code,responseTime:$});throw v.error(ut.toString()),ut}if(!nt.servers||!Array.isArray(nt.servers)||nt.servers.length===0){const ut=new G(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:nt.code,responseTime:$});throw v.error(ut.toString()),ut}if(!nt.servers.some(ut=>!!ut.wss)){const ut=new G(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:nt.code,responseTime:$});throw v.error(ut.toString()),ut}const mt=x("IMAGE_MODERATION_WORKER_HOST");return{addressList:nt.servers.map(ut=>{let{address:ee,wss:Te}=ut;if(ee&&Te)return"wss://".concat(ee.replace(/\./g,"-"),".").concat(mt,":").concat(Te,"/moderation")}).filter(ut=>!!ut),workerToken:nt.workerToken,vid:nt.vid,ticket:nt.appTicket,responseTime:$}},(Y,nt)=>(Dt.apworkerEvent(b,{success:!0,sc:200,serviceName:F,responseDetail:JSON.stringify(Y.addressList),firstSuccess:nt===0,responseTime:$,serverIp:l[nt%l.length]}),!1),(Y,nt)=>(Dt.apworkerEvent(b,{success:!1,sc:Y.data&&Y.data.code||200,serviceName:F,responseTime:$,serverIp:l[nt%l.length]}),!!(Y.code!==O.OPERATION_ABORTED&&Y.code!==O.UNEXPECTED_RESPONSE||Y.data&&Y.data.retry)&&(W=l[(nt+1)%l.length],!0)),f)}(s,t,e,i);this.emit(er.STATE_CHANGE,Ma.AP_CONNECTED);const{addressList:a,ticket:c}=r;return this._ticket=c,a}async connectWorker(t){this.emit(er.STATE_CHANGE,Ma.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Jt.CONNECTED,async()=>{this.emit(er.STATE_CHANGE,Ma.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ms.CONNECTED}),this._workerConnection.on(Jt.CLOSED,()=>{this.connectionState=ms.CLOSED}),this._workerConnection.on(Jt.FAILED,()=>{this.connectionState=ms.CLOSED}),this._workerConnection.on(Jt.RECONNECTING,()=>{this.connectionState=this.connectionState===ms.CONNECTED?ms.RECONNECTING:ms.CONNECTING}),this._workerConnection.on(Jt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const e=q4(new Uint8Array(t.data));x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(e)),this._uploadNum++,e.code===void 0||e.code===0||(this._uploadFailedNum++,v.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(e.code,", msg is ").concat(e.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Dt.reportApiInvoke(this._connectInfo.sid||null,{name:Mn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,e.code],tag:un.TRACER}).onError(new G(O.IMAGE_MODERATION_UPLOAD_FAILED,e.msg)),this._uploadTimer=null},x("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else v.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Jt.WILL_RECONNECT,(t,e,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(Jt.REQUEST_NEW_URLS,(t,e)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(e)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=_s(this,er.CLIENT_LOCAL_VIDEO_TRACK),e={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,e);this._workerConnection.sendMessage(i,!0,!0)}else x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being published can be inspected")}async generateRequestData(t,e){let{appId:i,cname:s,cid:r,vid:a,sid:c,uid:l}=e;const u=Date.now(),h=await t.getCurrentFrameImage("image/jpeg",this.quality),f=await Bw(h,i,s),g=this._sequence+"-"+r+"-"+l+"-"+u+"-"+Ge(12,""),S={appId:i,cid:r,cname:s,deviceId:"",elapse:hv.intToLong(Number(u-this._moderationStartTime)),fileSize:h.buffer.byteLength,height:h.height,width:h.width,jpg:f,networkType:6,osType:7,requestId:g,sdkVersion:"4.19.1",sequence:this._sequence,sid:c,timestamp:t5(u),uid:l,vid:a,service:this._moderationMode,ticket:this._ticket},w=K4(S);if(w.byteLength<this._workerMessageLengthLimit){if(x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const b=function(I){for(var U=1;U<arguments.length;U++){var F=arguments[U]!=null?arguments[U]:{};U%2?oN(Object(F),!0).forEach(function(V){m(I,V,F[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(F)):oN(Object(F)).forEach(function(V){Object.defineProperty(I,V,Object.getOwnPropertyDescriptor(F,V))})}return I}({},S);delete b.jpg,v.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(b))}return w}{const b=this.quality*this._qualityRatio;return this.quality=b,await this.generateRequestData(t,{appId:i,cname:s,cid:r,vid:a,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=rs.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ms.CLOSED,this.emit(er.STATE_CHANGE,Ma.CLOSED)}}function aN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function U_(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?aN(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):aN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Hi extends tw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,e;return(t=(e=this.peerConnection.getReceivers()[0])===null||e===void 0||(e=e.transport)===null||e===void 0?void 0:e.state)!==null&&t!==void 0?t:null}constructor(t,e,i){super(t,e),m(this,"direction",void 0),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"transportEventReceiver",void 0),m(this,"statsFilter",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"mutex",new Zn("P2PConnection-mutex")),m(this,"dataChannel",void 0),m(this,"onLocalCandidate",void 0),this.store=e,this.peerConnection=new RTCPeerConnection(Hi.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.direction=i??tl.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=w_(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{if(t){await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const e=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(e),!e.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return e.sdp}{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return await this.peerConnection.setLocalDescription(e),e.sdp}}catch(e){throw new Q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(t){try{await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(t){try{await this.peerConnection.addIceCandidate(t)}catch(e){throw new Q(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}async send(t){try{const e=[];t.forEach(r=>{const a=this.peerConnection.addTransceiver(r._mediaStreamTrack,{direction:"sendonly"});e.push(a)}),nn()&&x("SIMULCAST")===!0&&await this.applySimulcastForFirefox(e,t),await this.applySimulcastEncodings(e,t),await this.applySendEncodings(e,t);const i=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(i),!i.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const s=e.map(r=>{const a=this.getLocalSSRC(r.mid,i.sdp);if(!a)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:r.mid,localSSRC:[{ssrcId:a}]}});return{sdp:i.sdp,trackMessage:s}}catch(e){throw e instanceof Q?e:new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}}async stopSending(t,e){const i=e?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{const s=this.peerConnection.getTransceivers().filter(a=>t.indexOf(a.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));s.map(a=>{var c;a.direction="inactive",(c=a.stop)===null||c===void 0||c.call(a),this.peerConnection.removeTrack(a.sender)});const r=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(r),!r.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return r.sdp}catch(s){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,e,i){try{await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");await this.peerConnection.setLocalDescription(s),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."));const r=this.getRemoteMid(i,e);if(r===void 0)throw new Error("Cannot get transceiver mid when trying to receive track.");const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!a||a.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,sdp:s.sdp}}catch(s){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async setDescription(t,e){try{if(t==="remote"){await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return await this.peerConnection.setLocalDescription(i),v.debug("[".concat(this.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(t)),i.sdp}await this.peerConnection.setRemoteDescription({type:"answer",sdp:e})}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(i.toString()))}}async stopReceiving(t,e){try{const i=this.peerConnection.getTransceivers().filter(r=>t.indexOf(r.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(r=>{var a;r.direction="inactive",(a=r.stop)===null||a===void 0||a.call(r)}),await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(s),!s.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return s.sdp}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(){try{const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return this.store.descriptionStart(),await this.peerConnection.setLocalDescription(t),t.sdp}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){}async updateSendParameters(t,e){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(e)?nn()||await this.applySimulcastEncodings(i,[e]):await this.applySendEncodings(i,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getTransceivers().find(s=>s.mid===e);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const e=t[0].transport.iceTransport,{local:i,remote:s}=e.getSelectedCandidatePair();return{local:U_(U_({},Co),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:U_(U_({},Co),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{var e;t.candidate&&((e=this.onLocalCandidate)===null||e===void 0||e.call(this,t.candidate)),t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...Hi.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...Hi.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),x("ENABLE_ENCODED_TRANSFORM")&&Ye().supportWebRTCEncodedTransform&&(e.encodedInsertableStreams=!0),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.tcpport&&(e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(hh(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}),e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=udp")}),e.push({username:i.username,credential:i.password,credentialType:"password",urls:"stun:".concat(i.turnServerURL,":").concat(i.tcpport)}))}),e}tryBindTransportEvents(t){const e=t.transport;if(e){this.transportEventReceiver=t,e.onstatechange=()=>{var s;e!=null&&e.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,e.state))},e.onerror=s=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in s?s.error:s)};const i=e.iceTransport;i&&(i.onstatechange=()=>{const s=e==null?void 0:e.iceTransport.state;var r;s&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:r}=i.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,e){var i;if(e||(e=this.peerConnection.getSenders().find(h=>h.track===t._mediaStreamTrack)),!e)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ye().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},r={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var a;const{bitrateMax:h,frameRate:f,scaleResolutionDownBy:g}=t._encoderConfig;h&&(r.maxBitrate=1e3*h),Wt(a=t._hints).call(a,Qe.LOW_STREAM)&&(f&&(r.maxFramerate=Hs(f)),g&&g>=1&&(r.scaleResolutionDownBy=g))}if(x("DSCP_TYPE")&&Oa()){var c;const h=x("DSCP_TYPE");Wt(c=["very-low","low","medium","high"]).call(c,h)&&(r.networkPriority=h)}const l=e.getParameters(),u=(i=l.encodings)===null||i===void 0?void 0:i[0];nn()&&!u&&(s.encodings=[r]),u&&Object.assign(u,r),Object.assign(l,s),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await e.setParameters(l)}async applySendEncodings(t,e){try{if(!Ye().supportSetRtpSenderParameters||t.length!==e.length)return;for(let i=0;i<t.length;i++){const s=t[i],r=e[i];r instanceof he&&!this.isVP8Simulcast(r)&&await this.updateRtpSenderEncodings(r,s.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e,i){const s=En.parse(t);return e.forEach((r,a)=>{const c=i[a],l=s.mediaDescriptions.find(u=>u.attributes.mid===c);l&&(Qc(l,r),QS(l,r,this.store.codec))}),En.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;(e=this.onFirstVideoDecodedTimeout)===null||e===void 0||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let l=0;l<t.length;l++){var i,s,r,a,c;const u=t[l],h=e[l];if(h instanceof he&&!Wt(i=h._hints).call(i,Qe.LOW_STREAM)&&(s=h._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((r=h._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=h._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=h._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},g={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const S=u.sender.getParameters();await u.sender.setParameters(Object.assign(S,f))}}}async applySimulcastEncodings(t,e){if(!nn()&&t.length===e.length)for(let i=0;i<t.length;i++){const s=e[i];if(s instanceof he&&this.isVP8Simulcast(s)){const r=t[i],a={},c={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=r.sender.getParameters();await r.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var e,i,s,r,a;return!!(t instanceof he&&x("SIMULCAST")&&this.store.codec==="vp8"&&!Wt(e=t._hints).call(e,Qe.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(r=t._scalabilityMode)!==null&&r!==void 0&&r.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,e,i,s){if(x("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(e," SDP during P2PConnection.").concat(s,`
`),t),e==="offer"?r=>{this.logSDPExchange(r,"answer",i==="local"?"remote":"local",s)}:void 0}getLocalSSRC(t,e){var i,s;if(e=(i=e)!==null&&i!==void 0?i:(s=this.currentLocalDescription)===null||s===void 0?void 0:s.sdp){var r;const a=(r=En.parse(e).mediaDescriptions.find(c=>c.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs;return a==null?void 0:a[0].ssrcId}}getRemoteMid(t,e){var i,s;if(e=(i=e)!==null&&i!==void 0?i:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var r;return(r=En.parse(e).mediaDescriptions.find(a=>a.attributes.ssrcs.some(c=>c.ssrcId===t)))===null||r===void 0?void 0:r.attributes.mid}}async getRemoteSSRC(t,e){var i,s;if(e=(i=e)!==null&&i!==void 0?i:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var r;const a=(r=En.parse(e).mediaDescriptions.find(c=>c.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs;return a==null?void 0:a[0].ssrcId}}}function Nr(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}var dr;function cN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function $a(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?cN(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):cN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}et([Nr,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Hi.prototype,"establish",null),et([Nr,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Hi.prototype,"connect",null),et([Nr,A("design:type",Function),A("design:paramtypes",[RTCIceCandidate]),A("design:returntype",K)],Hi.prototype,"addRemoteCandidate",null),et([Nr,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Hi.prototype,"send",null),et([Nr,A("design:type",Function),A("design:paramtypes",[String,String,Number]),A("design:returntype",K)],Hi.prototype,"receive",null),et([Nr,A("design:type",Function),A("design:paramtypes",[String,String]),A("design:returntype",K)],Hi.prototype,"setDescription",null),et([Nr,A("design:type",Function),A("design:paramtypes",[Array,String]),A("design:returntype",K)],Hi.prototype,"stopReceiving",null),et([Nr,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],Hi.prototype,"restartICE",null),et([Nr,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Hi.prototype,"close",null),et([Nr,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],Hi.prototype,"updateEncoderConfig",null),et([Nr,A("design:type",Function),A("design:paramtypes",[String,Ei]),A("design:returntype",K)],Hi.prototype,"updateSendParameters",null),et([Nr,A("design:type",Function),A("design:paramtypes",[Ei,String]),A("design:returntype",K)],Hi.prototype,"replaceTrack",null),function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"}(dr||(dr={}));class _n extends rn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Gt.StateChange,e,this._state)}constructor(t,e){super(),m(this,"store",void 0),m(this,"statsUploader",void 0),m(this,"sendConnection",void 0),m(this,"recvConnection",void 0),m(this,"localTrackMap",new Map),m(this,"remoteUserMap",new Map),m(this,"localDataChannels",[]),m(this,"pendingLocalTracks",[]),m(this,"pendingRemoteTracks",[]),m(this,"statsCollector",void 0),m(this,"dtlsFailedCount",0),m(this,"sendMutex",new Zn("P2PChannel2-send-mutex")),m(this,"recvMutex",new Zn("P2PChannel2-recv-mutex")),m(this,"_state",Ce.Disconnected),m(this,"_restartStates",["disconnected","failed"]),m(this,"_restartTimer",void 0),m(this,"handleMuteLocalTrack",async(i,s,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ce.Connected)return void r(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const u=this.filterTobeMutedTracks(i);if(u.length===0)return void s();const h=u.find(U=>U[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop();let f=!1;var c,l;i.trackMediaType==="video"?f=!((c=this.localTrackMap.get(st.LocalAudioTrack))===null||c===void 0||!c.track._muted):f=((l=this.localTrackMap.get(st.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const g=u.filter(U=>{let[F,V]=U;return(F!==st.LocalAudioTrack||f)&&V.id!==void 0}).map(U=>{let[,F]=U;return F});let S;g.length>0&&(S=await this.sendConnection.stopSending(g.map(U=>U.id)),g.forEach(U=>{U.id=void 0,U.ssrcs=void 0}));const w=this.createMuteMessage(u),b=i.trackMediaType==="video"?Eo.MUTE_LOCAL_VIDEO:Eo.MUTE_LOCAL_AUDIO,I=await hn(this,Gt.RequestP2PMuteLocal,{action:b,sdp:S,message:w,isMuteAll:f});I&&await this.sendConnection.setDescription("local",I),(S||i.trackMediaType==="audio")&&await qe(this,Gt.RequestMuteLocal,w),s()}catch(u){r(u)}finally{a()}}),m(this,"handleUnmuteLocalTrack",async(i,s,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ce.Connected)return void r(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void s();const l=this.createUnmuteMessage(c),u=i.trackMediaType==="video"?Eo.UNMUTE_LOCAL_VIDEO:Eo.UNMUTE_LOCAL_AUDIO;await qe(this,Gt.RequestP2PMuteLocal,{action:u,message:l}),s()}catch(c){r(c)}finally{a()}}),m(this,"handleUpdateVideoEncoder",async(i,s,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const c=this.localTrackMap.get(st.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==i||this.state!==Ce.Connected)return void s();const{id:l,track:u}=c;l&&(await this.sendConnection.updateSendParameters(l,u),await this.sendConnection.updateEncoderConfig(l,u),this.emit(Gt.UpdateVideoEncoder,u)),s()}catch(c){r(c)}finally{a()}}),m(this,"handleSetOptimizationMode",async(i,s,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const c=this.localTrackMap.get(st.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==i||this.state!==Ce.Connected)return;const{id:l,track:u}=c;l&&await this.sendConnection.updateSendParameters(l,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleReplaceTrack",async(i,s,r,a)=>{let c;v.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:g}]=f;return i===g});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==Ce.Connected)return void s();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),h[0]===st.LocalVideoTrack&&Ye().supportDualStreamEncoding){const f=this.localTrackMap.get(st.LocalVideoLowTrack);if(f){const g=i._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=g,f.track._originMediaStreamTrack=g,await new K((S,w)=>{this.handleReplaceTrack(f.track,S,w,!0)})}}s()}catch(h){r(h)}finally{var u;(u=c)===null||u===void 0||u()}}),m(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),m(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),m(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),m(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new FO,this.bindStatsUploaderEvents()}async startP2PConnection(t,e){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t,e,i,s,r,a){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){if(this.state=Ce.New,this.sendConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),this.recvConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),this.sendConnection=new Hi(t,this.store),this.bindConnectionEvents(this.sendConnection),this.recvConnection=new Hi(t,this.store,tl.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection),e){this.store.peerConnectionStart(),await this.recvConnection.establish(e);const i=await this.sendConnection.establish(e);return this.statsUploader.startUploadTransportStats(!0),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ce.Connected,i}return await this.recvConnection.establish(e),this.sendConnection.establish(e)}async p2pConnect(t){if(!this.sendConnection||!this.recvConnection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.recvConnection.connect(t),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ce.Connected}async addRemoteCandidate(t){if(!this.sendConnection||!this.recvConnection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t),await this.sendConnection.addRemoteCandidate(t)}async publish(t,e,i){if(!this.sendConnection||this.state!==Ce.Connected){this.throwIfTrackTypeNotMatch(t);const a=t.filter(c=>this.pendingLocalTracks.indexOf(c)===-1);return void(this.pendingLocalTracks=this.pendingLocalTracks.concat(a))}this.store.pubId=this.store.pubId+1,gi.markPublishStart(this.store.clientId,this.store.pubId);const s=this.filterTobePublishedTracks(t,e,i);if(s.length===0)return void await this.tryToUnmuteAudio(t);s.forEach(a=>{let{track:c,type:l}=a;const u=Date.now();this.store.publish(c.getTrackId(),l===st.LocalAudioTrack?"audio":"video",u)}),this.bindLocalTrackEvents(s);const r=this.createGatewayPublishMessage(s);return this.assignLocalTracks(s),s.forEach(a=>{let{track:c,type:l}=a;const u=Date.now();this.store.publish(c.getTrackId(),l===st.LocalAudioTrack?"audio":"video",void 0,u)}),r}async dopublish(t){if(!this.sendConnection||this.state!==Ce.Connected)return;const e=this.localTrackMap.get(t);if(e){const{sdp:i,trackMessage:s}=await this.sendConnection.send([e.track]),{mid:r,localSSRC:a}=s[0];e.id=r,e.ssrcs=a,this.statsCollector.addLocalStats(t),this.statsUploader.startUploadUplinkStats();const c=await hn(this,Gt.RequestP2PPublish,{kind:t===st.LocalAudioTrack?bt.AUDIO:bt.VIDEO,sdp:i,ssrcId:a[0].ssrcId});await this.sendConnection.setDescription("local",c);const l=this.createUnmuteMessage([[t,e]]);await qe(this,Gt.RequestUnmuteLocal,l)}}async setDescription(t,e){let i,s;t==="local"?(i=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection):(i=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection);try{return!s||this.state!==Ce.Connected?void 0:await s.setDescription(t,e)}finally{i()}}publishLowStream(t){return rr(function*(){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await hn(this,Gt.RequestRePublish,this.pendingLocalTracks),this.emit(Gt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublish(t){if(!this.sendConnection||this.state!==Ce.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(l=>!Wt(t).call(t,l)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;this.unbindLocalTrackEvents(e.map(l=>{let[u,{track:h}]=l;return{type:u,track:h}}));const i=e.filter(l=>{let[,{id:u}]=l;return u!==void 0});if(!this.sendConnection||this.state!==Ce.Connected)return void t.forEach(l=>{const u=this.pendingLocalTracks.indexOf(l);u!==-1&&this.pendingLocalTracks.splice(u,1)});const s=e.find(l=>l[0]==="videoLowTrack");s&&s[1].track.close();let r;const a=this.createGatewayUnpublishMessage(e);i.length>0&&(r=await this.sendConnection.stopSending(i.map(l=>{let[,{id:u}]=l;return u}))),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(l=>{let[u,{track:h}]=l;return{type:u,track:h}})),e.forEach(l=>{let[u]=l;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats();const c=this.createMuteMessage(e);return await K.all(c.map(async l=>{await qe(this,Gt.RequestMuteLocal,[l])})),{sdp:r,unpubMsg:a}}async unpublishLowStream(){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async doUnpublish(t){if(!this.sendConnection||this.state!==Ce.Connected)return;const e=[];if(t!==bt.AUDIO){const i=this.localTrackMap.get(st.LocalVideoTrack);(i==null?void 0:i.id)!==void 0&&e.push([st.LocalVideoTrack,i]);const s=this.localTrackMap.get(st.LocalVideoLowTrack);(s==null?void 0:s.id)!==void 0&&e.push([st.LocalVideoLowTrack,s]),this.statsCollector.removeLocalStats(st.LocalVideoTrack),this.statsCollector.removeLocalStats(st.LocalVideoLowTrack)}if(t!==bt.VIDEO){const i=this.localTrackMap.get(st.LocalAudioTrack);(i==null?void 0:i.id)!==void 0&&e.push([st.LocalAudioTrack,i]),this.statsCollector.removeLocalStats(st.LocalAudioTrack)}if(e.length>0){const i=await this.sendConnection.stopSending(e.map(a=>{let[,c]=a;return c.id}));e.forEach(a=>{let[,c]=a;c.id=void 0,c.ssrcs=void 0});const s=await hn(this,Gt.RequestP2PUnPublish,{sdp:i,kind:t});await this.sendConnection.setDescription("local",s);const r=this.createMuteMessage(e);await K.all(r.map(async a=>{await qe(this,Gt.RequestMuteLocal,[a])}))}}async subscribe(t,e,i,s){var r;if(!this.recvConnection||this.state!==Ce.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:a,mid:c,sdp:l}=await this.recvConnection.receive(e,i,s);e===bt.AUDIO?(t._audioSSRC=s,t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(a):(t._audioTrack=new Rr(a,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(a):(t._videoTrack=new go(a,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._videoTrack));const u=this.remoteUserMap.get(t);u?u.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats(),await qe(this,Gt.RequestP2PUnmuteRemote,e);const h=this.pendingRemoteTracks.findIndex(f=>{let{user:g,kind:S}=f;return g.uid===t.uid&&e===S});return h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Gt.MediaReconnectEnd,t.uid)),l}async unsubscribe(t,e,i,s){const r=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return i!==void 0?u.uid===t.uid&&i===h:u.uid===t.uid});if(r.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.recvConnection&&this.state===Ce.Connected||s||r.forEach(l=>{let{kind:u}=l;var h;if(u===bt.AUDIO)(h=t._audioTrack)===null||h===void 0||h._destroy(),t._audioTrack=void 0;else if(u===bt.VIDEO){var f;(f=t._videoTrack)===null||f===void 0||f._destroy(),t._videoTrack=void 0}}),!this.recvConnection||this.state!==Ce.Connected)return;const a=this.filterTobeUnSubscribedTracks(t,i);if(a.length===0)return void(i!==bt.VIDEO&&qe(this,Gt.RequestP2PMuteRemote,bt.AUDIO));const c=await this.recvConnection.stopReceiving(a.map(l=>{let[,{id:u}]=l;return u}),e);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),a.forEach(l=>{let[u,{kind:h}]=l;var f,g;if(h===bt.VIDEO&&u._videoSSRC&&((f=this.recvConnection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===bt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),s||((g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0);else if(h===bt.AUDIO){var S;this.unbindRemoteTrackEvents(u._audioTrack),!s&&((S=u._audioTrack)===null||S===void 0||S._destroy(),u._audioTrack=void 0)}}),a.filter(l=>{let[,{kind:u}]=l;return u!==bt.AUDIO}).forEach(l=>{let[,{kind:u}]=l;qe(this,Gt.RequestP2PMuteRemote,u)}),i!==bt.VIDEO&&qe(this,Gt.RequestP2PMuteRemote,bt.AUDIO),c}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(e))return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const s=e===bt.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(e)||v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(st.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Pn){const i=e.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[r]=s;return r!==st.LocalAudioTrack}).filter(s=>{let[r]=s;return!(t&&r===st.LocalVideoLowTrack)}).map(s=>{let[,{track:r}]=s;return r}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===st.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(t,e,i,s,r){if(t){const c=this.localTrackMap.get(st.LocalAudioTrack),l=s?this.localTrackMap.get(st.LocalVideoLowTrack):this.localTrackMap.get(st.LocalVideoTrack);Dt.publish(this.store.sessionId,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Qe.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;i||(i=[]);const c=i.find(u=>u instanceof Le),l=s?(a=this.localTrackMap.get(st.LocalVideoTrack))===null||a===void 0?void 0:a.track:i.find(u=>u instanceof he);Dt.publish(this.store.sessionId,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Qe.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,i,s){const r=s===bt.VIDEO?i._videoSSRC:i._audioSSRC;r&&Dt.subscribe(this.store.sessionId,{succ:t,ec:e,video:s===bt.VIDEO,audio:s===bt.AUDIO,peerid:i.uid,subscribeRequestid:s===bt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:gi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Zn("P2PChannel2-send-mutex"),this.sendMutex=new Zn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(st.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Pn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(i=>{e.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Ce.Disconnected}getStats(t){var e,i;return t?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(st.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(st.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof he||e&&e.track instanceof Le?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}getRemoteMedia(t){var e;const i=Array.from(Ps(e=this.remoteUserMap).call(e)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(st.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Ou(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ce.Reconnecting,x("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var i;e._videoTrack&&e._videoTrack._player&&((i=e._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[i,{track:s}]=t;switch(i){case st.LocalVideoTrack:Wt(e=s._hints).call(e,Qe.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case st.LocalAudioTrack:s instanceof Pn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case st.LocalVideoLowTrack:}}),this.emit(Gt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;Array.from(Ps(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(e,s)}),this.emit(Gt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const i of this.pendingRemoteTracks){const{user:s,kind:r}=i;if((t instanceof Ti?t.uid:t)===s.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t){let e;e=t.direction===tl.SEND_ONLY?await this.sendMutex.lock("From P2PChannel.restartICE"):await this.recvMutex.lock("From P2PChannel.restartICE");try{const i=await t.restartICE(),s=await hn(this,Gt.RequestP2PRestartICE,i);t.setDescription("local",s)}finally{e()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(st.LocalVideoTrack),i=this.localTrackMap.get(st.LocalAudioTrack),s=t.videoSend.find(w=>{var b;return w.ssrc===(e==null||(b=e.ssrcs)===null||b===void 0?void 0:b[0].ssrcId)}),r=t.audioSend.find(w=>{var b;return w.ssrc===(i==null||(b=i.ssrcs)===null||b===void 0?void 0:b[0].ssrcId)});if(!s||!r)return 1;const a=_s(this,Gt.NeedSignalRTT),c=s?s.rttMs:void 0,l=r?r.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&a?(u+a)/2:u||a)||0,f=100*t.sendPacketLossRate*.7/50+.3*h/1500,g=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,S=e==null?void 0:e.track;if(S&&S._encoderConfig&&S._hints.indexOf(Qe.SCREEN_TRACK)===-1){const w=S._encoderConfig.bitrateMax,b=t.bitrate.actualEncoded;if(w&&b){const I=(1e3*w-b)/(1e3*w);return KA[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const r=s._audioSSRC,a=s._videoSSRC,c=t.audioRecv.find(b=>b.ssrc===r),l=t.videoRecv.find(b=>b.ssrc===a);if(!c&&!l)return void(e+=1);const u=_s(this,Gt.NeedSignalRTT),h=t.rtt,f=(h&&u?(h+u)/2:h||u)||0,g=c?c.jitterMs:void 0,S=t.recvPacketLossRate;let w=.7*S*100/50+.3*f/1500;g&&(w=.6*S*100/50+.2*f/1500+.2*g/400),e+=w<.1?1:w<.17?2:w<.36?3:w<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new K((e,i)=>{this.handleMuteLocalTrack(t,e,i)})}filterTobePublishedTracks(t,e,i){const s=[],r=Ye(),a=this.getAllTracks();t=Yd(t=t.filter(u=>a.indexOf(u)===-1));let c=!1,l=!1;for(const u of t){if(u instanceof he&&(this.localTrackMap.has(st.LocalVideoTrack)||c?new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:u,type:st.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(u,i);s.push({track:h,type:st.LocalVideoLowTrack})}if(u instanceof Le){const h=this.localTrackMap.get(st.LocalAudioTrack);if(h){if(!(h.track instanceof Pn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){const f=s.find(g=>{let{type:S}=g;return S===st.LocalAudioTrack});if(!(f.track instanceof Pn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(u)}else{if(!r.webAudioMediaStreamDest||u instanceof Pn||u._bypassWebAudio)s.push({track:u,type:st.LocalAudioTrack});else{const f=new Pn;f.addAudioTrack(u),s.push({track:f,type:st.LocalAudioTrack})}l=!0}}}return s}filterTobeUnpublishedTracks(t){const e=[],i=this.getAllTracks();t=Yd(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Le){const r=this.localTrackMap.get(st.LocalAudioTrack);if(!r)continue;r.track instanceof Pn?(r.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),r.track.trackList.length===0&&(e.push([st.LocalAudioTrack,r]),r.track.close())):e.push([st.LocalAudioTrack,r])}if(s instanceof he){const r=this.localTrackMap.get(st.LocalVideoTrack);if(!r)continue;e.push([st.LocalVideoTrack,r]);const a=this.localTrackMap.get(st.LocalVideoLowTrack);a&&e.push([st.LocalVideoLowTrack,a])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:i,type:s}=e;switch(s){case st.LocalVideoTrack:i.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(yt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case st.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Pn?t.trackList.forEach(i=>{i.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[i,{track:s}]=e;return{track:s,type:i}})),t.forEach(e=>{let{track:i,type:s}=e;switch(s){case st.LocalVideoTrack:i.off(yt.GET_STATS,this.handleGetLocalVideoStats),i.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(yt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case st.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Pn?t.trackList.forEach(e=>{e.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(yt.GET_STATS,this.handleGetLocalAudioStats),e.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof go&&e.addListener(yt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),e instanceof Rr&&e.addListener(yt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;i.has(bt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),i.has(bt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t){return t.map(e=>{var i;let s,r,{track:a,type:c}=e;switch(c){case st.LocalAudioTrack:s=xe.Audio,r={dtx:a instanceof Va&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case st.LocalVideoTrack:s=Wt(i=a._hints).call(i,Qe.SCREEN_TRACK)?xe.Screen:xe.High,r=$a($a({},E_(a)),{},{codec:this.store.codec});break;case st.LocalVideoLowTrack:s=xe.Low,r=$a($a({},E_(a)),{},{codec:this.store.codec})}return{kind:c===st.LocalAudioTrack?bt.AUDIO:bt.VIDEO,stream_type:s,attributes:r,isMuted:a.muted||!a.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case st.LocalVideoTrack:s=Wt(i=a._hints).call(i,Qe.SCREEN_TRACK)?xe.Screen:xe.High;break;case st.LocalAudioTrack:s=xe.Audio;break;case st.LocalVideoLowTrack:s=xe.Low}return{stream_type:s,ssrcs:c,mid:l}})}assignLocalTracks(t){t.forEach(e=>{let{track:i,type:s}=e;this.localTrackMap.set(s,{track:i})})}withdrawLocalTracks(t){t.forEach(e=>{let[i]=e;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var i;if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(Gt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),Wt(i=this._restartStates).call(i,e)||t.direction===tl.SEND_ONLY){if(this._restartTimer)return;const s=()=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE")),_s(this,Gt.QueryClientConnectionState)==="CONNECTED"&&this.restartICE(t))};this._restartTimer=window.setTimeout(()=>{s(),this._restartTimer=void 0},800)}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Dt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:un.TRACER}).onSuccess(),this.emit(Gt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var i;const s=Array.from(Ps(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===e);var r;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(r=s.audioTrack)===null||r===void 0||r.emit(jc.FIRST_FRAME_DECODED),Dt.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_DECODE,on.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var i;const s=Array.from(Ps(i=this.remoteUserMap).call(i)).find(r=>r._audioSSRC===e);s&&Dt.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_RECEIVED,on.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,i,s)=>{this.reportVideoFirstFrameDecoded(e,i,s)},t.onFirstVideoReceived=e=>{var i;const s=Array.from(Ps(i=this.remoteUserMap).call(i)).find(r=>r._videoSSRC===e);s&&Dt.firstRemoteFrame(this.store.sessionId,Yn.FIRST_VIDEO_RECEIVED,on.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,i)=>{const s=e.candidateType==="relay",r=i.candidateType==="relay";i.candidateType!=="unknown"&&s===r||this.emit(Gt.ConnectionTypeChange,s),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ka(i))," -> ").concat(JSON.stringify(Ka(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,i)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ka(i))," -> ").concat(JSON.stringify(Ka(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(Gt.LocalCandidate,e)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const i=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof Le&&(i==null?void 0:i.track)instanceof Pn)return i.track.isActive||e.push([st.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(s&&(e.push(s),s[0]===st.LocalVideoTrack)){const r=this.localTrackMap.get(st.LocalVideoLowTrack);r&&e.push([st.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],i=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof Le&&(i==null?void 0:i.track)instanceof Pn)return i.track.isActive&&e.push([st.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(s)if(s[0]===st.LocalVideoTrack){e.push(s);const r=this.localTrackMap.get(st.LocalVideoLowTrack);r&&e.push([st.LocalVideoLowTrack,r])}else e.push(s);return e}createMuteMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case st.LocalAudioTrack:s=xe.Audio;break;case st.LocalVideoTrack:s=Wt(i=a._hints).call(i,Qe.SCREEN_TRACK)?xe.Screen:xe.High;break;case st.LocalVideoLowTrack:s=xe.Low}return{stream_type:s,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case st.LocalAudioTrack:s=xe.Audio;break;case st.LocalVideoTrack:s=Wt(i=a._hints).call(i,Qe.SCREEN_TRACK)?xe.Screen:xe.High;break;case st.LocalVideoLowTrack:s=xe.Low}return{stream_type:s,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(e){const r=s.get(e);if(!r)return i;i.push([t,{kind:e,id:r}])}else Array.from(s.entries()).forEach(r=>{let[a,c]=r;i.push([t,{kind:a,id:c}])});return i}createUnsubscribeMessage(t){const e=[];return t.forEach(i=>{let[s,{kind:r,id:a}]=i;switch(r){case bt.VIDEO:return void(s._videoSSRC&&e.push({stream_type:bt.VIDEO,ssrcId:s._videoSSRC}));case bt.AUDIO:return void(s._audioSSRC&&e.push({stream_type:bt.AUDIO,ssrcId:s._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[i,{kind:s}]=e;const r=this.remoteUserMap.get(i);r&&(r.delete(s),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(st.LocalVideoTrack),i=this.localTrackMap.get(st.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),i&&t.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof Le){const i=this.filterTobeUnmutedTracks(t[e]);if(i.length===0)continue;const s=this.createUnmuteMessage(i);return void await qe(this,Gt.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Gt.RequestUploadStats,t,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await hi(Nf(this.dtlsFailedCount,Dn)),this.emit(Gt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(st.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof he)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof he).length>1)throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Le).length>1&&(t.some(e=>e instanceof Le&&e._bypassWebAudio)||!Ye().webAudioMediaStreamDest))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof he&&this.pendingLocalTracks.some(i=>i instanceof he))throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Le&&this.pendingLocalTracks.some(i=>i instanceof Le)&&(!Ye().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Le&&i._bypassWebAudio)))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const i=!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding,s=$a($a({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=i?t._mediaStreamTrack.clone():nv(t,s);const a=Ge(8,"track-low-"),c=new he(r,$a($a({},i&&{scaleResolutionDownBy:VS(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,a);return c.on(sl.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,Ua.LOW_STREAM)}),c._hints.push(Qe.LOW_STREAM),t.addListener(yt.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,i,s){var r;const a=Array.from(Ps(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(a){s||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");Dt.firstRemoteVideoDecode(this.store.sessionId,Yn.FIRST_VIDEO_DECODE,on.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:i,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,e,i){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const r=s.get(e);if(!r)return!1;const a=await this.recvConnection.getRemoteSSRC(r);return a!==void 0&&a!==i}resetConnection(t){v.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(t)),this.state===Ce.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(t){throw new Q(O.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Q(O.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new Q(O.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new Q(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new Q(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new Q(O.NOT_SUPPORTED)}async preConnect(t,e,i,s,r,a){throw new Q(O.NOT_SUPPORTED)}getEstablishParams(){throw new Q(O.NOT_SUPPORTED)}async reSubscribe(t){throw new Q(O.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new Q(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:i}]=t;e===st.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Ua.LOW_STREAM):i._updateRtpTransceiver(void 0)})}}function lr(n){return function(t,e,i){const s=t[e];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];switch(n){case dr.SEND_ONLY:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(e));try{return await s.apply(this,a)}finally{l()}}case dr.RECEIVE_ONLY:{const l=await this.recvMutex.lock("From P2PChannel2.".concat(e));try{return await s.apply(this,a)}finally{l()}}default:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(e)),u=await this.recvMutex.lock("From P2PChannel2.".concat(e));try{return await s.apply(this,a)}finally{l(),u()}}}},i}}function dN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function lN(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?dN(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):dN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}et([lr(),A("design:type",Function),A("design:paramtypes",[Object,String]),A("design:returntype",K)],_n.prototype,"startP2P",null),et([lr(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],_n.prototype,"p2pConnect",null),et([lr(dr.SEND_ONLY),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],_n.prototype,"dopublish",null),et([lr(dr.SEND_ONLY),A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],_n.prototype,"unpublish",null),et([lr(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],_n.prototype,"unpublishLowStream",null),et([lr(dr.SEND_ONLY),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],_n.prototype,"doUnpublish",null),et([lr(dr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[Ti,String,String,Number]),A("design:returntype",K)],_n.prototype,"subscribe",null),et([lr(dr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[Ti,String,String,Boolean]),A("design:returntype",K)],_n.prototype,"unsubscribe",null),et([lr(dr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[Ti,String]),A("design:returntype",K)],_n.prototype,"muteRemote",null),et([lr(dr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[Ti,String]),A("design:returntype",K)],_n.prototype,"unmuteRemote",null),et([lr(dr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[Ti,String]),A("design:returntype",K)],_n.prototype,"hasRemoteMediaWithLock",null),et([lr(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],_n.prototype,"disconnectForReconnect",null),et([lr(dr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[Ti,String,Number]),A("design:returntype",K)],_n.prototype,"remoteMediaSsrcChanged",null);const e5=Date.now(),n5=20,pv=new Map,x_=new Map;async function uN(n){const t=pv.get(n),e=Array.isArray(t)&&t[t.length-1],i=x_.get(n);if(!e)return void(i.isSyncing=!1);const s={uid:e.uid,payload:If(e.payload)};i.firstRecvTs===0&&(i.firstRecvTs=e.recvTs,i.firstSendTs=e.sendTs);const r=e.sendTs-i.firstSendTs,a=r-(Date.now()-i.firstRecvTs);a>0&&(i.firstRecvTs=Date.now()-r);let c=e.mediaDelay+a;c<=0?(t.pop(),hN(e.context,s),c=0):c=Math.min(c,n5),setTimeout(()=>t.length&&uN(n),c)}function hN(n,t){n.safeEmit(me.STREAM_MESSAGE,t.uid,t.payload),n.onStreamMessage&&n.onStreamMessage(t)}function i5(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;if(!n.syncWithAudio)return hN(e,{uid:n.uid,payload:If(n.payload)});const i="".concat(e.id,"-").concat(n.uid),s=pv.get(i)||[],r=s.findIndex(u=>n.sendTs>=u.sendTs),a=lN(lN({},n),{},{context:e,mediaDelay:t,recvTs:Date.now()});r===-1?s.push(a):s.splice(r,0,a),pv.set(i,s);let c=!1;var l;x_.has(i)?c=!((l=x_.get(i))===null||l===void 0||!l.isSyncing):x_.set(i,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||uN(i)}function pN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Th(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?pN(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):pN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}Zn.setLogger(v);class He extends rn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t){let e;if(super(),m(this,"store",void 0),m(this,"_uid",void 0),m(this,"_channelName",void 0),m(this,"_uintUid",void 0),m(this,"_users",[]),m(this,"_config",void 0),m(this,"_clientId",void 0),m(this,"_appId",void 0),m(this,"_sessionId",null),m(this,"_key",void 0),m(this,"_joinInfo",void 0),m(this,"_gateway",void 0),m(this,"_statsCollector",void 0),m(this,"_configDistribute",void 0),m(this,"_leaveMutex",new Zn("client-leave")),m(this,"_publishMutex",new Zn("client-publish")),m(this,"_renewTokenMutex",new Zn("client-renewtoken")),m(this,"_subscribeMutex",new Zn("client-subscribe")),m(this,"_encryptionMode","none"),m(this,"_encryptionSecret",null),m(this,"_encryptionSalt",null),m(this,"_proxyServer",void 0),m(this,"_turnServer",{servers:[],mode:"auto"}),m(this,"_cloudProxyServerMode","disabled"),m(this,"_isDualStreamEnabled",!1),m(this,"_defaultStreamFallbackType",void 0),m(this,"_lowStreamParameter",void 0),m(this,"_streamFallbackTypeCacheMap",new Map),m(this,"_remoteStreamTypeCacheMap",new Map),m(this,"_axiosCancelSource",rs.CancelToken.source()),m(this,"_audioVolumeIndicationInterval",void 0),m(this,"_networkQualityInterval",void 0),m(this,"_userOfflineTimeout",void 0),m(this,"_streamRemovedTimeout",void 0),m(this,"_injectStreamingClient",void 0),m(this,"_liveTranscodeStreamingClient",void 0),m(this,"_liveRawStreamingClient",void 0),m(this,"_channelMediaRelayClient",void 0),m(this,"_networkQualitySensitivity","normal"),m(this,"_p2pChannel",void 0),m(this,"_useLocalAccessPoint",!1),m(this,"_setLocalAPVersion",void 0),m(this,"_joinAndNotLeaveYet",!1),m(this,"_numberOfJoinCount",0),m(this,"_remoteDefaultVideoStreamType",void 0),m(this,"_inspect",void 0),m(this,"_moderation",void 0),m(this,"_license",void 0),m(this,"_pendingPublishedUsers",[]),m(this,"ntpAlignErrorCount",0),m(this,"remoteInboundOffset",0),m(this,"_handleLocalTrackEnable",(i,s,r)=>{this.publish(i,!1).then(s).catch(r)}),m(this,"_handleLocalTrackDisable",(i,s,r)=>{this.unpublish(i).then(s).catch(r)}),m(this,"_handleUserOnline",i=>{if(x("BLOCK_LOCAL_CLIENT")&&Vc(i.uid,this.channelName))return void v.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&v.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(r=>r.uid===i.uid);if(s)s._trust_in_room_=!0;else{const r=new Ti(i.uid,i.uint_id||i.uid);this._users.push(r),v.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(me.USER_JOINED,r)}}),m(this,"_handleUserOffline",i=>{if(x("BLOCK_LOCAL_CLIENT")&&Vc(i.uid,this.channelName))return;const s=this._users.find(r=>r.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),_T(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),v.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(me.USER_LEAVED,s,i.reason))}),m(this,"_handleAddAudioOrVideoStream",(i,s,r,a,c,l,u)=>{if(x("BLOCK_LOCAL_CLIENT")&&Vc(s,this.channelName))return;const h=this._users.find(g=>g.uid===s);if(!h)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(h.uid,i,void 0,void 0,void 0,Date.now());const f=i==="audio"?h.hasAudio:h.hasVideo;h._uintid||(h._uintid=c||s),i==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,i==="audio"?(h._audio_added_=!0,r!==void 0&&(h._audioSSRC=r),a!==void 0&&(h._cname=a),l&&(h._audioOrtc=l)):(h._video_added_=!0,r!==void 0&&(h._videoSSRC=r),a!==void 0&&(h._cname=a),u!==void 0&&(h._rtxSsrcId=u),l&&(h._videoOrtc=l)),(i==="audio"?h.hasAudio:h.hasVideo)&&!f&&(v.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(i)),this.safeEmit(me.USER_PUBLISHED,h,i)),i==="video"?Dt.onGatewayStream(this._sessionId,Yn.ON_ADD_VIDEO_STREAM,on.ON_ADD_VIDEO_STREAM,{peer:c||s,ssrc:h._videoSSRC}):Dt.onGatewayStream(this._sessionId,Yn.ON_ADD_AUDIO_STREAM,on.ON_ADD_AUDIO_STREAM,{peer:c||s,ssrc:h._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(h,i,r).then(g=>{if(g&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(h.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof pi))return this._p2pChannel.unsubscribe(h,i,!0).then(()=>this._subscribe(h,i,!0).catch(S=>{v.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(h,i)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,i,!0).catch(g=>{v.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),m(this,"_handleRemoveStream",(i,s,r)=>{if(x("BLOCK_LOCAL_CLIENT")&&Vc(i.uid,this.channelName))return;const a=this._users.find(l=>l.uid===i.uid);if(!a)return void v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));v.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let c=()=>{};if(a.hasAudio&&a.hasVideo?c=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(me.USER_UNPUBLISHED,a,"audio"),v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(me.USER_UNPUBLISHED,a,"video")}:a.hasVideo?c=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(me.USER_UNPUBLISHED,a,"video")}:a.hasAudio&&(c=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(me.USER_UNPUBLISHED,a,"audio")}),a._trust_audio_stream_added_state_=!0,a._trust_video_stream_added_state_=!0,a._audio_added_=!1,a._video_added_=!1,this._p2pChannel instanceof pi)this._p2pChannel.unsubscribe(a).then(l=>{if(l)return this._gateway.unsubscribe(l,a.uid)});else if(s&&r)if(i.sdp){const{sdp:l}=i;this._p2pChannel.unsubscribe(a,l).then(u=>{u&&s(u)}).catch(r)}else s&&s();a._audioSSRC=void 0,a._videoSSRC=void 0,a._audioOrtc=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0,Dt.onGatewayStream(this._sessionId,Yn.ON_REMOVE_STREAM,on.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),c()}),m(this,"_handleSetStreamLocalEnable",(i,s,r)=>{if(x("BLOCK_LOCAL_CLIENT")&&Vc(s,this.channelName))return;const a=this._users.find(u=>u.uid===s);if(!a)return void v.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));v.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(r?"enabled":"disabled"," with uid ").concat(s));const c=i==="audio"?a.hasAudio:a.hasVideo;if(i==="audio"){a._trust_audio_enabled_state_=!0;const u=a._audio_enabled_;if(a._audio_enabled_=r,a._audio_enabled_===u)return;{const h=a._audio_enabled_?"enable-local-audio":"disable-local-audio";v.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(h)),this.safeEmit(me.USER_INFO_UPDATED,s,h)}}else{a._trust_video_enabled_state_=!0;const u=a._video_enabled_;if(a._video_enabled_=r,a._video_enabled_===u)return;{const h=a._video_enabled_?"enable-local-video":"disable-local-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(h)),this.safeEmit(me.USER_INFO_UPDATED,s,h)}}const l=i==="audio"?a.hasAudio:a.hasVideo;return c!==l?!c&&l?(v.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(me.USER_PUBLISHED,a,i)):(i==="video"&&a._videoTrack&&a._videoTrack._destroy(),i==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,i),v.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(me.USER_UNPUBLISHED,a,i)):void 0}),m(this,"_handleMuteStream",(i,s,r,a,c,l)=>{if(x("BLOCK_LOCAL_CLIENT")&&Vc(i,this.channelName))return;v.debug("[".concat(this._clientId,"] receive mute message"),i,s,r);const u=this._users.find(g=>g.uid===i);if(!u)return void v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const h=s==="audio"?u.hasAudio:u.hasVideo;if(s==="audio"){u._trust_audio_mute_state_=!0;const g=u._audio_muted_;if(u._audio_muted_=r,u._audio_muted_===g)return;{const S=u._audio_muted_?"mute-audio":"unmute-audio";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(S)),this.safeEmit(me.USER_INFO_UPDATED,i,S)}}else{u._trust_video_mute_state_=!0;const g=u._video_muted_;if(u._video_muted_=r,u._video_muted_===g)return;{const S=u._video_muted_?"mute-video":"unmute-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(S)),this.safeEmit(me.USER_INFO_UPDATED,i,S)}}const f=s==="audio"?u.hasAudio:u.hasVideo;if(h!==f){if(!h&&f)return!this.store.useP2P&&!(s==="audio"?u._audioSSRC:u._videoSSRC)?void v.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet.")):(v.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(me.USER_PUBLISHED,u,s));s==="video"&&u._videoTrack&&u._videoTrack._destroy(),s==="audio"&&u._audioTrack,c&&l&&this._p2pChannel instanceof _n&&(a?this._p2pChannel.unsubscribe(u,a,s).then(g=>{c(g)}).catch(l):c()),this._p2pChannel.muteRemote(u,s),v.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(me.USER_UNPUBLISHED,u,s)}}),m(this,"_handleP2PLost",async i=>{v.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():v.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),m(this,"_handleTokenWillExpire",()=>{v.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(me.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),m(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),v.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),m(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(me.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(me.NETWORK_QUALITY,i)}),m(this,"_handleP2PAddAudioOrVideoStream",(i,s)=>{const r=this._users.find(c=>c.uid===s);if(!r)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(r.uid,i,void 0,void 0,void 0,Date.now());const a=i==="audio"?r.hasAudio:r.hasVideo;i==="audio"?r._trust_audio_stream_added_state_=!0:r._trust_video_stream_added_state_=!0,i==="audio"?r._audio_added_=!0:r._video_added_=!0,(i==="audio"?r.hasAudio:r.hasVideo)&&!a&&(v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published ").concat(i)),this.safeEmit(me.USER_PUBLISHED,r,i)),this._p2pChannel.hasPendingRemoteMedia(r,i)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(r.uid," after reconnect.")),this._subscribe(r,i,!0).catch(c=>{v.error("[".concat(this._clientId,"] resubscribe error"),c.toString())}))}),this._config=t,this._clientId=Ge(5,"client-"),this.store=new lj(t.codec,t.audioCodec,t.mode,this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),v.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Zs," build: ").concat(FT,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{LI(t.clientRoleOptions),e=Object.assign({},t.clientRoleOptions)}catch(i){v.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new fl(this.store),this._statsCollector.onStatsException=(i,s,r)=>{v.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(r)),this.safeEmit(me.EXCEPTION,{code:i,msg:s,uid:r})},this._statsCollector.onUploadPublishDuration=(i,s,r,a)=>{const c=this._users.find(l=>l.uid===i);c&&Dt.peerPublishStatus(this._sessionId,{subscribeElapse:a,audioPublishDuration:s,videoPublishDuration:r,peer:c._uintid})},this.store.useDataChannel=Ye().supportDataChannel&&x("SIGNAL_CHANNEL"),this.store.useP2P=x("P2P"),this._gateway=new p4(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Dn,httpRetryConfig:t.httpRetryConfig||Dn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:e}),this._configDistribute=new y4,this.store.useP2P?(this._p2pChannel=new _n(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new pi(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,i,s,r){let a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];We("JOIN_GATEWAY_USE_443PORT_ONLY",a),We("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof qu&&(l.use443PortOnly=a,l.tryDoubleDomain=c),async function(u,h,f){Sf.get(u)||Sf.set(u,[]),vf.get(u)||vf.set(u,h),ho.get(u)||ho.set(u,0);const g=Sf.get(u),S=vf.get(u);if(!g||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ho.get(u)===S){const F=Vu();g.push(F),await F.promise}ho.set(u,ho.get(u)+1);for(var w=arguments.length,b=new Array(w>3?w-3:0),I=3;I<w;I++)b[I-3]=arguments[I];const U=await f(...b);return ho.set(u,ho.get(u)-1),ho.get(u)===S-1&&g.length>0&&(g[0].resolve(),g.shift()),ho.get(u)===0&&(Sf.set(u,[]),vf.set(u,0),ho.set(u,0)),U}("client.join",x("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,i,s,r)}async join(t,e,i,s,r){const a=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const c=dj(),l=xA()?window.isSecureContext:"Browser Not Support";if(!xA()&&!c||!window.isSecureContext){const b="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";v.warning(b)}const u=mT();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),v.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const h=Dt.reportApiInvoke(u,{name:Mn.JOIN,options:[t,e,i,s],states:{isHttps:c,isSecureContext:l},tag:un.TRACER});Dt.setAppId(t);try{if(!i&&i!==null)throw new G(O.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&_i(i,"token",1,2047),_i(t,"appid",1,2047),WT(e),s&&HT(s),r&&_i(r,"optionalInfo",1,2047)}catch(b){throw h.onError(b),b}if(v.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(a)),this._leaveMutex.isLocked&&(v.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),v.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const b=new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw h.onError(b),b}this._sessionId||(this._sessionId=u,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const f=Th({clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(f.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(f.stringUid=s,this._uintUid?(f.uid=this._uintUid,this._uintUid=void 0):f.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(f.aesmode=this._encryptionMode,f.aespassword=await EB(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(f.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:e,appId:t});const g=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&g===this._sessionId&&Dt.joinChannelTimeout(this._sessionId,5)},5e3);try{var S;let b;const I=f.cloudProxyServer;if(Wt(S=["proxy3","proxy4","proxy5"]).call(S,I)){const Z=x("PROXY_SERVER_TYPE3");Array.isArray(Z)?f.proxyServer=Z[0]:f.proxyServer=Z}if(Dt.setProxyServer(f.proxyServer),v.setProxyServer(f.proxyServer),this.store.requestAPStart(),f.stringUid&&!f.uid){const Z=await Q0(f.stringUid,f,this._axiosCancelSource.token,this._config.httpRetryConfig||Dn,this.store);v.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(f.stringUid," => ").concat(Z)),f.uid=Z,b=await $0(f,this._axiosCancelSource.token,this._config.httpRetryConfig||Dn,!0,this.store)}else b=await $0(f,this._axiosCancelSource.token,this._config.httpRetryConfig||Dn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(f,this._axiosCancelSource.token),this._configDistribute.on(Ku.UPDATE_BITRATE_LIMIT,Z=>{this._p2pChannel.updateBitrateLimit(Z)})},0),this._key=i||t;const U=b.gatewayInfo;this._joinInfo=Th(Th({},f),{},{cid:U.cid,uid:f.uid?f.uid:U.uid,vid:U.vid,apResponse:U.res,uni_lbs_ip:U.uni_lbs_ip,gatewayAddrs:U.gatewayAddrs});const F=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));h.onSuccess(F),this._appId=t,this._channelName=f.cname,this._uid=F,this.store.uid=F,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Vi()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const V=f.stringUid?"string uid: ".concat(f.stringUid,",uid: ").concat(f.uid):"uid: ".concat(this._uid);return v.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(V)),setTimeout(()=>{v.startUpload()},5e3),this.store.joinEnd(),w=this,Wt(Pa).call(Pa,w)||Pa.push(w),F}catch(b){const I=Array.isArray(b)?b[0]:b;throw I&&I.code===O.OPERATION_ABORTED?v.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),I):v.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),I),I.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),h.onError(I),I}var w}_joinGateway(){if(!this._joinInfo||!this._key)throw new G(O.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!x("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(t=>t).catch(t=>{if(t.code===O.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,fe.FALLBACK),t;if(t.code===O.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,fe.FALLBACK),t;throw t}).then(t=>{if(t instanceof G){if(t.code===O.INIT_WEBSOCKET_TIMEOUT){if(v.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new G(O.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const e=x("PROXY_SERVER_TYPE3");if(Array.isArray(e))if(this._joinInfo.apUrl){const s=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),r=s.slice(s.length-2).join(".");e.forEach(a=>{this._joinInfo&&Wt(a).call(a,r)&&(this._joinInfo.proxyServer=a)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;const i=x("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return i&&i[1]&&i[1]!=="443"&&v.setProxyServer(this._joinInfo.proxyServer),x("STATS_COLLECTOR_PORT").toString()!=="443"&&Dt.setProxyServer(this._joinInfo.proxyServer),Dt.reportApiInvoke(this._sessionId,{name:Mn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:un.TRACER}).onSuccess(),this.safeEmit(me.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),x("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(s=>{"forceturn"in s&&(s.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(v.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new G(O.INVALID_OPERATION);return Dt.reportApiInvoke(this._sessionId,{name:Mn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:un.TRACER}).onSuccess(),this._joinGateway()}return t}).then(t=>t)}async leave(){v.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Vi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const i=Pa.indexOf(e);i!==-1&&Pa.splice(i,1)}(this);const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return v.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED"),v.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Ei))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new G(O.INVALID_PARAMS,"param list is empty");const i=t;if(this._gateway.role==="audience")throw new G(O.INVALID_OPERATION,"audience can not publish stream");for(const r of i){if(!(r instanceof Ei))throw new G(O.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new G(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}v.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(r=>"".concat(r.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&i.forEach(r=>{const a=this._configDistribute.getBitrateLimit();r instanceof he&&a&&r.setBitrateLimit(a.uplink)});try{await this._publishHighStream(i),v.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw v.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{s()}}async _publishDataChannel(t){je(t.id,"id",0,65535,!0),Lc(t.ordered,"ordered"),_i(t.metadata,"metadata",0,512),v.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(s=>s.id===t.id)!==-1)throw new G(O.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new G(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&x("FORCE_TURN")&&!x("TURN_ENABLE_TCP")&&!x("TURN_ENABLE_UDP"))throw new G(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=new P0(t);await this._p2pChannel.publishDataChannel([i]);try{const s={streamId:t.id,ordered:t.ordered,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS"),metadata:t.metadata,channelId:i._originDataChannelId};await this._gateway.publishDataChannel(this._uid,s,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw s}return await i._waitTillOpen(),v.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw v.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new G(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Ei))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);v.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof _n){const s=await this._p2pChannel.unpublish(e);if(s){const r=await this._gateway.sendExtensionMessage(Xe.UNPUBLISH,s);r&&await this._p2pChannel.setDescription("local",r)}}else{const s=await this._p2pChannel.unpublish(e);s&&await this._gateway.unpublish(s,this._uid),v.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(s){throw v.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),v.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(i=>"".concat(i.id," "))," "));const e=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(t);i&&await this._gateway.unpublishDataChannel(i),v.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(s=>"".concat(s.id))))}catch(i){throw v.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{e&&e()}}async subscribe(t,e,i){return e==="datachannel"?this._subscribeDataChannel(t,i):this._subscribe(t,e)}async _subscribeDataChannel(t,e){var i;if(je(e,"channelId",0,65535,!0),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===t))throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new G(O.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new G(O.INVALID_REMOTE_USER,"user is not published");const s=(i=t._dataChannels)===null||i===void 0?void 0:i.find(c=>c.id===e);if(!s)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new G(O.REMOTE_USER_IS_NOT_PUBLISHED);const r=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(t,[s]);if(c&&Wt(c).call(c,s.id))try{var a;if(!s._originDataChannelId)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new G(O.REMOTE_USER_IS_NOT_PUBLISHED);const l={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(a=s.metadata)!==null&&a!==void 0?a:""};await this._gateway.subscribeDataChannel(t.uid,l,!0)}catch(l){if((l==null?void 0:l.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[s]),l;await this._p2pChannel.unsubscribeDataChannel(t,[s]),this._p2pChannel.setPendingRemoteDataChannel(t,s.id)}return await s._waitTillOpen(),v.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),s}finally{r()}}async _p2pSubscribe(t,e,i){if(Kn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===t)){const a=new G(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),a}if(!t.hasAudio&&!t.hasVideo){const a=new G(O.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),a}if(!i&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const a=new G(O.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),a}const s=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));const r=e==="audio"?st.LocalAudioTrack:this._joinInfo.defaultVideoStream===zf.LOW_STREAM?st.LocalVideoLowTrack:st.LocalVideoTrack;try{await this._p2pChannel.hasRemoteMediaWithLock(t,e)?await this._p2pChannel.unmuteRemote(t,e):(this.store.subscribe(t.uid,e,Date.now()),this._p2pChannel instanceof _n&&await this._gateway.sendExtensionMessage(Xe.SUBSCRIBE,{trackType:r})),v.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const a=e==="audio"?t._audioTrack:t._videoTrack;if(!a)throw new G(O.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),a),a}finally{s()}}async _subscribe(t,e,i){if(this._p2pChannel instanceof _n)return this._p2pSubscribe(t,e);if(Kn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new G(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new G(O.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!(i||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const u=new G(O.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),u}let s=e==="audio"?t._audioSSRC:t._videoSSRC,r=e==="audio"?t._audioOrtc:t._videoOrtc,a=e==="video"?t._rtxSsrcId:void 0,c={stream_type:e==="audio"?bt.AUDIO:bt.VIDEO,ssrcId:s};const l=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const h=e==="audio"?t._audioSSRC:t._videoSSRC;h!==void 0&&h!==s&&(s=h,r=e==="audio"?t._audioOrtc:t._videoOrtc,a=e==="video"?t._rtxSsrcId:void 0,c={stream_type:e==="audio"?bt.AUDIO:bt.VIDEO,ssrcId:s}),gi.markSubscribeStart(this.store.clientId,s),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,s,a,r);try{await this._gateway.subscribe(t.uid,c,!0)}catch(f){if((f==null?void 0:f.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),f;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(h){throw this._p2pChannel.reportSubscribeEvent(!1,h==null?void 0:h.code,t,e),h}v.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=e==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new G(O.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{l()}}async massSubscribe(t){if(zo(t,"subscribeList"),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),i=new Map,s=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:u,mediaType:h}=l;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(h)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:u,mediaType:h}=l;return{user:u,mediaType:h}}),a=await this._p2pChannel.globalLock();try{var c;for(let u=t.length-1;u>=0;u--){const h=t[u],{user:f,mediaType:g}=h;if(Kn(g,"mediaType",["audio","video"]),!f){const b=new G(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),b}if(!this._users.find(b=>b===f)){const b=new G(O.INVALID_REMOTE_USER,"user is not in the channel");v.error("[".concat(this._clientId,"] can not massSubscribe ").concat(f.uid,", this user is not in the channel")),r[u].error=b,t.splice(u,1);continue}if(g==="audio"&&(!f.hasAudio||f._audioSSRC===void 0)||g==="video"&&(!f.hasVideo||f._videoSSRC===void 0)){const b=new G(O.REMOTE_USER_IS_NOT_PUBLISHED);v.error("[".concat(this._clientId,"] can not subscribe ").concat(f.uid," with mediaType ").concat(g,", remote user is not published")),r[u].error=b,t.splice(u,1);continue}const S=Un.Video|Un.LwoVideo,w=i.get(f);if(w){if(g==="video"?w&S:w&Un.Audio){t.splice(u,1),v.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(f.uid,", mediaType:").concat(g," twice"));continue}i.set(f,w|(g==="video"?S:Un.Audio))}else i.set(f,g==="video"?S:Un.Audio)}for(let u=t.length-1;u>=0;u--){const h=t[u],{user:f,mediaType:g}=h,S=Un.Video|Un.LwoVideo;if(this._p2pChannel.hasRemoteMedia(f,g)){await this._p2pChannel.unmuteRemoteNoLock(f,g);const w=i.get(f);i.set(f,g==="video"?w^S:w^Un.Audio),t.splice(u,1)}}this.store.massSubscribe(t.map(u=>({userId:u.user.uid,type:u.mediaType})),e);const l=Uc(c=Array.from(i.entries())).call(c,(u,h)=>{let[f,g]=h;if(g===0)return u;const S={stream_id:f.uid,stream_type:g};return g&Un.Audio&&(S.audio_ssrc=f._audioSSRC),g&Un.Video&&(S.video_ssrc=f._videoSSRC),u.push(S),u},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(h=>{let{user:f,mediaType:g}=h;return{user:f,mediaType:g,ssrcId:g===bt.VIDEO?f._videoSSRC:f._audioSSRC,rtxSsrcId:g===bt.VIDEO?f._rtxSsrcId:void 0}}));const u=new Map;if(l.length>0){const h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(f=>{let{stream_id:g,video_error_code:S,audio_error_code:w,error_code:b}=f;(S||w||b)&&u.set(g,{video_error_code:S,audio_error_code:w,error_code:b})})}if(Array.from(u.entries()).length>0){const h=Array.from(u.entries()).map(f=>{let g,[S,w]=f;return w.error_code||w.video_error_code&&w.audio_error_code?g=void 0:w.video_error_code?g=bt.VIDEO:w.audio_error_code&&(g=bt.AUDIO),{user:this.remoteUsers.find(b=>b.uid===S),mediaType:g}});await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of r){const f=u.get(h.user.uid);if(f){const g=f.error_code||h.mediaType==="audio"&&f.audio_error_code||h.mediaType==="video"&&f.video_error_code;if(g){const S=Bc(g);v.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(S.desc)),h.error=new G(O.SUBSCRIBE_FAILED,"code ".concat(g,": ").concat(S.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var f;Dt.subscribe(this.store.sessionId,{succ:!!h.error,ec:((f=h.error)===null||f===void 0?void 0:f.code)||null,video:h.mediaType===bt.VIDEO,audio:h.mediaType===bt.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===bt.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e)},!0)}),v.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(h=>{let{user:f,mediaType:g}=h;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(g)}).join("; "))),r}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(t),u}}finally{a(),s()}}async unsubscribe(t,e,i){if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,i)}else await this._unsubscribeDataChannel(t,i);if(e&&Kn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new G(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const s=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof _n)await this._gateway.sendExtensionMessage(Xe.UNSUBSCRIBE,{mediaType:e});else{const r=await this._p2pChannel.unsubscribe(t,e);r&&await this._gateway.unsubscribe(r,t.uid),v.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(r){if(r.code===O.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}finally{s()}}async _unsubscribeDataChannel(t,e){if(e&&je(e,"id",0,65535,!0),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new G(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}let i;if(typeof e=="number"){const s=t._dataChannels.find(r=>r.id===e);s&&(i=[s])}else i=t._dataChannels;if(i===void 0){const s=new G(O.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),s}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(s=>s.id)));try{const s=await this._p2pChannel.unsubscribeDataChannel(t,i);s&&await this._gateway.unsubscribeDataChannel(s,t.uid),v.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===O.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}}async massUnsubscribe(t){if(zo(t,"unsubscribeList"),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");v.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(i=>{let{user:s,mediaType:r}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let i=t.length-1;i>=0;i--){const{user:s,mediaType:r}=t[i];if(!s){const c=new G(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(Kn(r,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===s)){v.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),t.splice(i,1);continue}const a=Un.Video|Un.LwoVideo;if(e.has(s)){const c=e.get(s);let l;switch(r){case"video":l=c&a;break;case"audio":l=c&Un.Audio;break;default:l=c&(Un.Audio|a)}if(l){v.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(r," twice.")),t.splice(i,1);continue}r?r==="audio"?e.set(s,c|Un.Audio):r==="video"&&e.set(s,c|a):e.set(s,c|Un.Audio|a)}else r?r==="audio"?e.set(s,Un.Audio):r==="video"&&e.set(s,a):e.set(s,Un.Audio|a)}try{const i=await this._p2pChannel.massUnsubscribe(t);i&&await this._gateway.massUnsubscribe(i),v.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(s=>{let{user:r,mediaType:a}=s;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(a,";")}).join()))}catch(i){if(i.code===O.DISCONNECT_P2P)return void v.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw v.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(t){(function(i){if(!i)throw new Q(O.INVALID_PARAMS);ln(i.width)||hT(i.width,"streamParameter.width"),ln(i.height)||hT(i.height,"streamParameter.height"),ln(i.framerate)||hT(i.framerate,"streamParameter.framerate"),ln(i.bitrate)||je(i.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&v.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),v.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,st.LocalVideoLowTrack)}async enableDualStream(){if(!Ye().supportDualStream)throw Dt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new G(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new G(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Dt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Dt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),v.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(st.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Dt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Dt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),v.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){Kn(i,"role",["audience","host"])}(t),e&&LI(e),this.mode==="rtc")throw v.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new G(O.INVALID_OPERATION,"rtc mode can not use setClientRole");if(e&&e.level&&t==="host")throw new G(O.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new G(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(t,e),this._config.role=t,v.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const i=e.timestamp-Date.now();return Math.abs(i)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(_i(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new G(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Dt.setProxyServer(this._proxyServer),v.setProxyServer(this._proxyServer),v.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new G(O.INVALID_OPERATION,"You have already set the proxy")}if(qd(t))return this._turnServer={servers:t,mode:"original-manual"},void v.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(i=>i.urls).join(","),"."));t.forEach(i=>PI(i)),this._turnServer={servers:t,mode:"manual"},v.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"you should set license before join channel");if(_i(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new G(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,v.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new G(O.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let i;switch(t===void 0&&(t=3),t){case 1:case 2:throw new G(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new G(O.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"Stop proxy server after leave channel");Dt.setProxyServer(),v.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new G(O.INVALID_PARAMS,"accessPoints is required.");zo(t.accessPoints.serverList,"accessPoints.serverList"),_i(t.accessPoints.domain,"accessPoints.domain");const e=(S,w)=>{je(S,w,0,65535,!0)};let i=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),i=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new G(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");x("CLOSE_AFB_FOR_LOCAL_AP")&&(We("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),We("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,a=t.accessPoints.serverList.map(S=>s.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(r):S),c=a.map(S=>"".concat(S,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,We("WEBCS_DOMAIN",c),We("WEBCS_DOMAIN_BACKUP_LIST",c),We("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(zo(t.report.hostname,"report.hostname"),We("EVENT_REPORT_DOMAIN",t.report.hostname[0]),We("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(We("EVENT_REPORT_DOMAIN",a[0]),We("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),We("STATS_COLLECTOR_PORT",l),t.report?We("ENABLE_EVENT_REPORT",!0):We("ENABLE_EVENT_REPORT",!1);let u="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(zo(t.log.hostname,"log.hostname"),u=t.log.hostname[0]):u=a[0];let h=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),h=t.log.port),We("LOG_UPLOAD_SERVER","".concat(u,":").concat(h));let f=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(zo(t.cds.hostname,"cds.hostname"),f=t.cds.hostname):f=a;let g=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),g=t.cds.port),We("CDS_AP",f.map(S=>"".concat(S,":").concat(g))),t.cds?We("ENABLE_CONFIG_DISTRIBUTE",!0):We("ENABLE_CONFIG_DISTRIBUTE",!1),v.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(zo(t,"serverList"),_i(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new G(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(e):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,We("WEBCS_DOMAIN",t),We("WEBCS_DOMAIN_BACKUP_LIST",t),We("GATEWAY_DOMAINS",[e]),We("EVENT_REPORT_DOMAIN",t[0]),We("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),We("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),v.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Kn(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw v.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else v.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Kn(e,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const i=this._users.find(s=>s.uid===t);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw v.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}v.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Kn(e,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(i){throw v.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}v.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,i){(function(r){Kn(r,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),_i(e,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(Wt(s).call(s,t)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new G(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new G(O.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||v.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,i&&(this._encryptionSalt=Af(i))}async renewToken(t){if(_i(t,"token",1,2047),!this._key||!this._joinInfo)throw new G(O.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const i=await this._renewTokenMutex.lock();try{if(x("USE_NEW_TOKEN")){v.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await v4(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Dn);v.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:s})}else v.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});v.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=e,this._joinInfo.token=e,v.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?v.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(me.VOLUME_INDICATOR,t)},x("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new G(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new G(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new G(O.LIVE_STREAMING_TASK_CONFLICT);const i=e?jn.TRANSCODE:jn.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(t,i)}setLiveTranscoding(t){return this._createLiveStreamingClient(jn.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(t));if(!e.length)throw new G(O.INVALID_PARAMS,"can not find live streaming url to stop");await K.all(e.map(i=>i&&i.stopLiveStreamingTask(t)))}async addInjectStreamUrl(t,e){if(!this._joinInfo)throw new G(O.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const i=this._createLiveStreamingClient(jn.INJECT);i.setInjectStreamConfig(e,0),await i.startLiveStreamingTask(t,jn.INJECT)}async removeInjectStreamUrl(){var t;const e=this._createLiveStreamingClient(jn.INJECT),i=Array.from(_o(t=e.streamingTasks).call(t)).find(s=>s.mode===jn.INJECT);if(!this._joinInfo||!i)throw new G(O.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await e.stopLiveStreamingTask(i.url)}async startChannelMediaRelay(t){rO(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){rO(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new G(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const i=new TextEncoder;t.payload=i.encode(t.payload)}if(new Blob([t.payload]).size>1024)throw new G(O.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Nt.DATA_STREAM,{payload:Af(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-e5},!e)}sendMetadata(t){if(!this._joinInfo)throw new G(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new G(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Nt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Af(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(hj),!this._joinInfo)throw new G(O.INVALID_OPERATION,"can not send custom report, not joined");await Dt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Kn(e.spatialLayer,"spatialLayer",[0,1,2,3]),Kn(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(i){throw v.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}setRTM2Flag(t){if(Kn(t,"flag",[0,1]),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(t)}_reset(){if(v.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=rs.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Zn("client-publish"),this._subscribeMutex=new Zn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){const i=t||mT();t?v.debug("[".concat(this._clientId,"] new Session ").concat(i)):v.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i)),this._sessionId=i,this.store.sessionId=i,e?Dt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:e.channel,appid:e.appId,mode:this.mode}):this._joinInfo?Dt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&Dt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new G(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&x("FORCE_TURN")&&!x("TURN_ENABLE_TCP")&&!x("TURN_ENABLE_UDP"))throw new G(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");v.debug("[".concat(this._clientId,"] publish high stream"));try{if(this._p2pChannel instanceof _n){const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(i)try{await this._gateway.sendExtensionMessage(Xe.PUBLISH,i)}catch(s){throw this._p2pChannel.unpublish(t),s}}else{const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter),s=(await i.next()).value;if(s){var e;let r;try{r=await this._gateway.publish(this._uid,s,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw i.throw(a),a}await i.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof he&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,t),(i==null?void 0:i.code)===O.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new G(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));v.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var e;let r;try{r=await this._gateway.publish(this._uid,s,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw i.throw(a),a}i.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===O.WS_ABORT)return;throw i}}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new G(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=()=>new R4(this._joinInfo,this._config.websocketRetryConfig||Dn,this._config.httpRetryConfig||Dn),i=s=>{s.onLiveStreamError=(r,a)=>{Dt.reportApiInvoke(this._sessionId,{name:Mn.ON_LIVE_STREAM_ERROR,options:[r,a],tag:un.TRACER}).onSuccess(),this.safeEmit(me.LIVE_STREAMING_ERROR,r,a)},s.onLiveStreamWarning=(r,a)=>{Dt.reportApiInvoke(this._sessionId,{name:Mn.ON_LIVE_STREAM_WARNING,options:[r,a],tag:un.TRACER}).onSuccess(),this.safeEmit(me.LIVE_STREAMING_WARNING,r,a)},s.on(el.REQUEST_WORKER_MANAGER_LIST,(r,a,c)=>{if(!this._joinInfo)return c(new G(O.INVALID_OPERATION,"can not find join info to get worker manager"));tO(r,this._joinInfo,this._axiosCancelSource.token,Dn).then(a).catch(c)})};switch(t){case jn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=e(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case jn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=e(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case jn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=e(),this._injectStreamingClient.on(el.REQUEST_WORKER_MANAGER_LIST,(s,r,a)=>{if(!this._joinInfo)return a(new G(O.INVALID_OPERATION,"can not find join info to get worker manager"));tO(s,this._joinInfo,this._axiosCancelSource.token,Dn).then(r).catch(a)}),this._injectStreamingClient.onInjectStatusChange=(s,r,a)=>{this.safeEmit(me.INJECT_STREAM_STATUS,s,r,a)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new G(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:e}=this.getLocalVideoStats(),i={width:t,height:e};this._channelMediaRelayClient=new I4(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Dn,this._config.httpRetryConfig||Dn,i),this._channelMediaRelayClient.on("state",s=>{s===Gi.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(me.CHANNEL_MEDIA_RELAY_STATE,s)}),this._channelMediaRelayClient.on("event",s=>{this.safeEmit(me.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._statsCollector.onStatsChanged=(s,r)=>{var a;s==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(r))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:i,deleted:s}=t,r=[];Array.isArray(i)&&i.length>0&&i.forEach(a=>{const{uid:c,stream_id:l,ordered:u,max_retrans_times:h,metadata:f}=a,g=this._users.find(S=>S._uintid===c);if(!g)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(v.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),Wt(r).call(r,g)||r.push(g),g._uintid||(g._uintid=c),g._dataChannels.findIndex(S=>S.id===a.stream_id)===-1){const S={id:l,ordered:!!u,maxRetransmits:h,metadata:f},w=new c4(S);g._dataChannels.push(w),v.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published datachannel")),e||this.safeEmit(me.USER_PUBLISHED,g,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(g,a.stream_id)&&(v.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(g.uid," after reconnect.")),this._subscribeDataChannel(g,a.stream_id).catch(S=>{v.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),e&&(this.safeEmit(me.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(a=>{const{uid:c,stream_id:l}=a,u=this._users.find(f=>f._uintid===c);if(!u)return void v.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=u._dataChannels.find(f=>f.id===a.stream_id);h&&(v.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(u,[h]).then(f=>{if(f)return u._dataChannels=u._dataChannels.filter(g=>g!==h),this._gateway.unsubscribeDataChannel(f,u.uid)}),v.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(me.USER_UNPUBLISHED,u,"datachannel",h._config))})}_handleRemoveDataChannels(t){const e=this._users.find(i=>i.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){v.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const i=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(s=>{this.safeEmit(me.USER_UNPUBLISHED,e,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,e.uid)}),i()}}else v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(fn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(fn.CONNECTION_STATE_CHANGE,(t,e,i)=>{var s;if(i===fe.FALLBACK)return;const r=()=>{this.safeEmit(me.CONNECTION_STATE_CHANGE,t,e,i)};if(Dt.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:Mn.CONNECTION_STATE_CHANGE,options:[t,e,i],tag:un.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:i})),v.info("[".concat(this._clientId,"] connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._audioSSRC=void 0,c._videoSSRC=void 0,c._videoOrtc=void 0,c._audioOrtc=void 0,c._cname=void 0,c._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(u=>{v.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(u=>{v.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{v.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{v.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{v.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,bt.AUDIO,!1)),c._trust_video_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,bt.VIDEO,!1)),c._trust_audio_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(v.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(fn.REQUEST_NEW_GATEWAY_LIST,(t,e)=>{if(!this._joinInfo)return e(new G(O.UNEXPECTED_ERROR,"can not recover, no join info"));qS(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Dn,this.store).then(i=>{this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const s=[];i.gatewayInfo.gatewayAddrs.forEach(r=>{let{address:a}=r;const[c,l]=a.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:c,port:l}):s.push({host:c,port:l})}),t(s)}).catch(e)}),this._gateway.on(fn.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(me.NETWORK_QUALITY,t)}),this._gateway.on(fn.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(me.STREAM_TYPE_CHANGED,t,e),Dt.reportApiInvoke(this._sessionId,{name:Mn.STREAM_TYPE_CHANGE,options:[t,e],tag:un.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(fn.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(fn.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(fn.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,i)=>{try{e(await this._p2pChannel.startP2PConnection(t))}catch(s){i(s)}}),this._gateway.on(fn.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;const{dtlsParameters:i,iceParameters:s,candidates:r,rtpCapabilities:a,setup:c,cname:l}=hO(t.ortc,e);this._p2pChannel.connect(s,i,r,a,c,l)}),this._gateway.on(fn.REQUEST_DC_CONNECTION_PARAMS,t=>{t(this._p2pChannel.getEstablishParams())}),this._gateway.on(fn.RESET_SIGNAL,t=>{this._p2pChannel.resetConnection(t),this._handleGatewaySignalEvents()}),this._gateway.on(fn.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(fn.DATACHANNEL_PRECONNECT,async(t,e,i,s)=>{var r,a,c,l,u,h;await this._p2pChannel.startP2PConnection({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},!0);const f=function(g,S){let w;return S&&S.ip&&typeof S.port=="number"?(w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip,port:S.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(S.ip,":").concat(S.port)),S.ip6&&(w.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip6,port:S.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(S.ip6,":").concat(S.port)))):w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:g.ip,port:g.port.toString(),type:"host",extension:{}}],w}(t,e);return this._p2pChannel.preConnect({iceUfrag:"".concat((a=this._joinInfo)===null||a===void 0?void 0:a.apResponse.cid,"_").concat((c=this._joinInfo)===null||c===void 0?void 0:c.apResponse.cert),icePwd:"".concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cid,"_").concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(h=x("FINGERPRINT"))!==null&&h!==void 0?h:t.fingerprint}]},f,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(i).catch(s)})}_handleGatewaySignalEvents(){this._gateway.signal.on(te.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(te.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(te.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(te.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(te.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(te.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams,deleted:[]},!0)}),this._gateway.signal.on(te.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(te.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(te.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,bt.AUDIO,!0)),this._gateway.signal.on(te.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,bt.AUDIO,!1)),this._gateway.signal.on(te.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,bt.VIDEO,!0)),this._gateway.signal.on(te.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,bt.VIDEO,!1)),this._gateway.signal.on(te.RECEIVE_METADATA,t=>{const e=If(t.metadata);this.safeEmit(me.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(te.ON_DATA_STREAM,async t=>{if(!t)return;let e=0;if(t.ordered||t.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(a=>a.uid===t.uid),r=i==null?void 0:i.audioRecv.find(a=>a.ssrc===(s==null?void 0:s._audioSSRC));e=r==null?void 0:r.jitterBufferMs}e==null&&(e=0),i5(t,e,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(te.ON_CRYPT_ERROR,()=>{ju(()=>{v.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(me.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(te.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(te.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{v.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,fe.TOKEN_EXPIRE),this.safeEmit(me.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(te.ON_STREAM_FALLBACK_UPDATE,t=>{v.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(me.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(te.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),v.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(te.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(te.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(pt.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case Nt.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var i,s;const a=r.some(u=>{let{stream_type:h}=u;return h===xe.Audio}),c=r.some(u=>{let{stream_type:h}=u;return h!==xe.Audio}),l=r.some(u=>{let{stream_type:h}=u;return h===xe.Screen||h===xe.ScreenLow});e.state==="offer"&&Dt.publish(this._joinInfo.sid,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:a,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:a?(i=r.find(u=>{let{stream_type:h}=u;return h===xe.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:c?(s=r.find(u=>{let{stream_type:h}=u;return h!==xe.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case Nt.SUBSCRIBE:e&&Dt.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:e.stream_type===bt.AUDIO,video:e.stream_type===bt.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:gi.measureFromSubscribeStart(this.store.clientId,e.ssrcId)})}}),this._gateway.signal.on(te.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(te.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;x("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(s=>!Vc(s.string_id||s.stream_id,this.channelName)));const e=[],i=[];for(const s of t.users){let r=this._users.find(f=>f._uintid===s.stream_id);r?r._trust_in_room_=!0:(r=new Ti(s.string_id||s.stream_id,s.stream_id),this._users.push(r),this.getListeners(me.PUBLISHED_USER_LIST).length===0&&(v.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(me.USER_JOINED,r)));const a=Un.Audio&s.stream_type,c=(Un.Video|Un.LwoVideo)&s.stream_type,l=(65280&s.stream_type)!=0,u=a&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=s.video_ssrc,r._rtxSsrcId=s.video_rtx),a&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=s.audio_ssrc),a&&!u&&this.getListeners(me.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(me.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(me.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(me.USER_PUBLISHED,r,"video")),(a&&!u||c&&!h||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&i.push({user:r,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&i.push({user:r,mediaType:"audio"})}i.length>0&&(v.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{v.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(me.PUBLISHED_USER_LIST).length>0?x("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(v.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(s=>s.uid).join(", "))),this.safeEmit(me.PUBLISHED_USER_LIST,e)):v.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(s=>s.uid).join(", ")))})}_handleP2PEvents(){this._gateway.signal.on(te.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Xe.PUBLISH,async(t,e)=>{t.forEach(i=>i.kind===bt.VIDEO?(this._handleP2PAddAudioOrVideoStream("video",e),i.isMuted?this._handleMuteStream(e,bt.VIDEO,!0):this._handleMuteStream(e,bt.VIDEO,!1)):(this._handleP2PAddAudioOrVideoStream("audio",e),i.isMuted?this._handleMuteStream(e,bt.AUDIO,!0):this._handleMuteStream(e,bt.AUDIO,!1)))}),this._gateway.signal.on(pt.P2P_START,async(t,e)=>{if(this._p2pChannel instanceof _n){var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}}),this._gateway.signal.on(pt.P2P_CONNECTION,async t=>{this._p2pChannel instanceof _n&&await this._p2pChannel.p2pConnect(t)}),this._gateway.signal.on(pt.P2P_REMOTE_CANDIDATE_UPDATE,t=>{this._p2pChannel instanceof _n&&this._p2pChannel.addRemoteCandidate(JSON.parse(t))}),this._gateway.signal.on(Xe.SUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof _n){const{trackType:s}=JSON.parse(t);try{await this._p2pChannel.dopublish(s),e()}catch(r){i(r)}}}),this._gateway.signal.on(Xe.UNSUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof _n){const{mediaType:s}=JSON.parse(t);try{await this._p2pChannel.doUnpublish(s),e()}catch(r){i(r)}}}),this._gateway.signal.on(Xe.EXCHANGE_SDP,async(t,e,i)=>{if(this._p2pChannel instanceof _n){const{type:s,sdp:r}=JSON.parse(t);try{e(await this._p2pChannel.setDescription(s,r))}catch(a){i(a)}}}),this._gateway.signal.on(Xe.UNPUBLISH,async(t,e,i)=>{if(this._p2pChannel instanceof _n){const{unpubMsg:s,uid:r}=t;if(s.length===1){const a=s[0].stream_type===xe.Audio?bt.AUDIO:bt.VIDEO;this._handleMuteStream(r,a,!0);const{sdp:c}=t;if(this._p2pChannel instanceof _n&&c){const l=this._users.find(u=>u.uid===r);if(!l)return v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();this._p2pChannel.unsubscribe(l,c,a).then(u=>{u&&e(u)}).catch(i)}else e()}else this._handleRemoveStream(t,e,i)}}),this._gateway.signal.on(Xe.CONTROL,async(t,e,i)=>{const{action:s,sdp:r,isMuteAll:a,uid:c}=t;switch(s){case Eo.MUTE_LOCAL_VIDEO:this._handleMuteStream(c,bt.VIDEO,!0,r,e,i);break;case Eo.MUTE_LOCAL_AUDIO:e(),this._handleMuteStream(c,bt.AUDIO,!0);break;case Eo.UNMUTE_LOCAL_VIDEO:e(),this._handleP2PAddAudioOrVideoStream("video",c),this._handleMuteStream(c,bt.VIDEO,!1);break;case Eo.UNMUTE_LOCAL_AUDIO:e(),this._handleP2PAddAudioOrVideoStream("audio",c),this._handleMuteStream(c,bt.AUDIO,!1)}a&&this._handleRemoveStream(t,e,i)}),this._gateway.signal.on(Xe.DO_SUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof _n){const{kind:s,sdp:r,ssrcId:a,uid:c}=t,l=this._users.find(u=>u.uid===c);if(!l)return v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void e();try{e(await this._p2pChannel.subscribe(l,s,r,a))}catch(u){i(u)}}}),this._gateway.signal.on(Xe.DO_UNSUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof _n){const{uid:s,kind:r,sdp:a}=t,c=this._users.find(l=>l.uid===s);if(!c)return v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void e();try{e(await this._p2pChannel.unsubscribe(c,a,r))}catch(l){i(l)}}}),this._gateway.signal.on(Xe.RESTART_ICE,async(t,e,i)=>{if(this._p2pChannel instanceof _n)try{e(await this._p2pChannel.setDescription("remote",t))}catch(s){i(s)}}),this._p2pChannel.on(Gt.RequestP2PRestartICE,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(Xe.RESTART_ICE,t))}catch(s){i(s)}}),this._p2pChannel.on(Gt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Xe.CANDIDATE,JSON.stringify(t))}),this._p2pChannel.on(Gt.RequestP2PMuteLocal,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(Xe.CONTROL,t))}catch(s){i(s)}}),this._p2pChannel.on(Gt.RequestP2PPublish,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(Xe.DO_SUBSCRIBE,t))}catch(s){i(s)}}),this._p2pChannel.on(Gt.RequestP2PUnPublish,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(Xe.DO_UNSUBSCRIBE,t))}catch(s){i(s)}}),this._p2pChannel.on(Gt.RequestP2PUnmuteRemote,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(Gt.RequestP2PMuteRemote,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(Gt.StateChange,(t,e)=>{e===Ce.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Gt.RequestMuteLocal,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(Gt.RequestUnmuteLocal,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(Gt.RequestRePublish,(t,e,i)=>{this.publish(t,!1).then(e).catch(i)}),this._p2pChannel.on(Gt.RequestRePublishDataChannel,(t,e,i)=>{K.all(t.map(async s=>{await this._p2pChannel.publishDataChannel([s]);const r={streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,r,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw a}})).then(e).catch(i)}),this._p2pChannel.on(Gt.RequestReSubscribe,async(t,e,i)=>{try{for(const{user:s,kind:r}of t)r===bt.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");e()}catch(s){i(s)}}),this._p2pChannel.on(Gt.RequestUploadStats,(t,e)=>{this._gateway.uploadStats(t,e)}),this._p2pChannel.on(Gt.MediaReconnectStart,t=>{this.safeEmit(me.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Gt.MediaReconnectEnd,t=>{this.safeEmit(me.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Gt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Gt.RequestRestartICE,async t=>{if(this._p2pChannel instanceof _n)return;const e=await this._p2pChannel.restartICE(t),i=await e.next();if(i.done)return;const s=i.value;let r;try{r=await this._gateway.restartICE({iceParameters:s})}catch(c){return void e.throw(c)}const{iceParameters:a}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:a})}),this._p2pChannel.on(Gt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Gt.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:i,rtpCapabilities:s}),{dtlsParameters:c,iceParameters:l,candidates:u,rtpCapabilities:h,setup:f,cname:g}=hO(r,a);await this._p2pChannel.connect(l,c,u,h,f,g),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Gt.RequestUnpublishForReconnectPC,async(t,e,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):i()}),this._p2pChannel.on(Gt.P2PLost,()=>{this.safeEmit(me.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Gt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Gt.ConnectionTypeChange,t=>{this.safeEmit(me.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Gt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Gt.QueryClientConnectionState,t=>{t(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!t)throw new G(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!t.inspectType||!Array.isArray(t.inspectType))throw new G(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const e=[...new Set(t.inspectType)];e.forEach(i=>{var s;if(!Wt(s=["supervise","moderation"]).call(s,i))throw new G(O.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(i," is not a valid inspect type."))}),t.inspectType=e}if(t&&t.extraInfo&&t.extraInfo.length>1024)throw new G(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const e=new L_(t);this._inspect=e,this.handleVideoInspectEvents(this._inspect),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Dn)}catch(e){throw Array.isArray(e)?e[0]:e}}async disableContentInspect(){if(!this._inspect)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Lc(t,"enabled"),t){if(!e)throw new G(O.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(je(e.interval,"interval",1e3,1/0),this.connectionState!=="CONNECTED"||!this._joinInfo)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(e);const i=new hv(e);this._moderation=i,this.handleImageModerationEvents(this._moderation),await i.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Dn)}catch(i){throw Array.isArray(i)?i[0]:i}}else{if(!this._moderation)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(er.CONNECTION_STATE_CHANGE,(e,i)=>{if(this.safeEmit(me.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,i),e===ms.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new G(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(er.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}handleVideoInspectEvents(t){t.on(Gn.CONNECTION_STATE_CHANGE,(e,i)=>{if(this.safeEmit(me.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,i),i===Us.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(me.CONTENT_INSPECT_ERROR,new G(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Gn.INSPECT_RESULT,(e,i)=>{var s;if((i==null?void 0:i.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return v.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(me.CONTENT_INSPECT_RESULT,e,i)}),t.on(Gn.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return v.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Lc(t,"enabled"),We("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}}et([Ht(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],He.prototype,"leave",null),et([Ht({argsMap:(n,t)=>{if(!Array.isArray(t)){if(!(t instanceof Ei))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",K)],He.prototype,"publish",null),et([Ht({argsMap:(n,t)=>(t||(t=[]),t instanceof P0?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())))}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],He.prototype,"unpublish",null),et([Ht({argsMap:(n,t,e,i)=>[t.uid,e,i]}),A("design:type",Function),A("design:paramtypes",[Ti,String,Number]),A("design:returntype",K)],He.prototype,"subscribe",null),et([Ht({argsMap:(n,t)=>t.map(e=>{let{user:i,mediaType:s}=e;return[i==null?void 0:i.uid,s]})}),A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],He.prototype,"massSubscribe",null),et([Ht({argsMap:(n,t,e,i)=>[t.uid,e,i]}),A("design:type",Function),A("design:paramtypes",[Ti,String,Number]),A("design:returntype",K)],He.prototype,"unsubscribe",null),et([Ht({argsMap:(n,t)=>t.map(e=>{let{user:i,mediaType:s}=e;return{uid:i==null?void 0:i.uid,mediaType:s}})}),A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],He.prototype,"massUnsubscribe",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],He.prototype,"setLowStreamParameter",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],He.prototype,"enableDualStream",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],He.prototype,"disableDualStream",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[String,Object]),A("design:returntype",K)],He.prototype,"setClientRole",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[String,Boolean]),A("design:returntype",void 0)],He.prototype,"setProxyServer",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",void 0)],He.prototype,"setTurnServer",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",void 0)],He.prototype,"setLicense",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],He.prototype,"startProxyServer",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],He.prototype,"stopProxyServer",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],He.prototype,"setLocalAccessPointsV2",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Array,String]),A("design:returntype",void 0)],He.prototype,"setLocalAccessPoints",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",K)],He.prototype,"setRemoteDefaultVideoStreamType",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Object,Number]),A("design:returntype",K)],He.prototype,"setRemoteVideoStreamType",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Object,Number]),A("design:returntype",K)],He.prototype,"setStreamFallbackOption",null),et([Ht({argsMap:(n,t)=>[t]}),A("design:type",Function),A("design:paramtypes",[String,String,Uint8Array]),A("design:returntype",void 0)],He.prototype,"setEncryptionConfig",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],He.prototype,"renewToken",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],He.prototype,"enableAudioVolumeIndicator",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[String,Boolean]),A("design:returntype",K)],He.prototype,"startLiveStreaming",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],He.prototype,"setLiveTranscoding",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],He.prototype,"stopLiveStreaming",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[String,Object]),A("design:returntype",K)],He.prototype,"addInjectStreamUrl",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],He.prototype,"removeInjectStreamUrl",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[C_]),A("design:returntype",K)],He.prototype,"startChannelMediaRelay",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[C_]),A("design:returntype",K)],He.prototype,"updateChannelMediaRelay",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],He.prototype,"stopChannelMediaRelay",null),et([Ht({argsMap:(n,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],He.prototype,"sendCustomReportMessage",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Object,Object]),A("design:returntype",K)],He.prototype,"pickSVCLayer",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",K)],He.prototype,"setRTM2Flag",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],He.prototype,"enableContentInspect",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],He.prototype,"disableContentInspect",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Boolean,Object]),A("design:returntype",K)],He.prototype,"setImageModeration",null),et([Ht({reportResult:!0}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Array)],He.prototype,"getJoinChannelServiceRecords",null),et([Ht(),A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",K)],He.prototype,"setPublishAudioFilterEnabled",null);const s5=Pe().name;class Sh{constructor(t,e){m(this,"id",0),m(this,"element",void 0),m(this,"peerPair",void 0),m(this,"context",void 0),m(this,"audioPlayerElement",void 0),m(this,"audioTrack",void 0),Sh.count+=1,this.id=Sh.count,this.element=t,this.context=e}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const e=document.createElement("audio");e.srcObject=new MediaStream([t.track]),e.play(),this.audioPlayerElement=e}}async switchSdp(){if(!this.peerPair)return;const t=async(i,s)=>{const r=s==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(r),i.iceGatheringState==="complete"?i.localDescription:new K(a=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&a(i.localDescription)}})},e=async(i,s)=>await i.setRemoteDescription(s);try{const i=await t(this.peerPair[0],"offer");await e(this.peerPair[1],i);const s=await t(this.peerPair[1],"answer");await e(this.peerPair[0],s)}catch(i){throw new G(O.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let e;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),e=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(e)}catch(s){throw new G(O.LOCAL_AEC_ERROR,s.toString()).print()}if(!e)throw new G(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=e.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,e=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(e),await this.switchSdp()}close(){v.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}m(Sh,"count",0);const r5=window.AudioContext||window.webkitAudioContext;class fN{constructor(){m(this,"units",[]),m(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return v.debug("the system does not need to process local aec"),-1;this.context||(this.context=new r5);let e=this.units.find(i=>i&&i.getElement()===t);return e||(e=new Sh(t,this.context),this.units.push(e)),e.startEchoCancellation(),v.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Pe().name!==ke.SAFARI}}et([Ht({report:Dt}),A("design:type",Function),A("design:paramtypes",[HTMLAudioElement]),A("design:returntype",Number)],fN.prototype,"processExternalMediaAEC",null);const o5=new fN;function _N(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function mN(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?_N(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):_N(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}const fv=window||document;function EN(n){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!fv)return;const e=Jn._cspEventHandlerPointer;if(e&&t)return void console.error(e,t);const i=s=>{if(!(s&&s.blockedURI&&(Jn.onSecurityPolicyViolation||Jn.getListeners(Hr.SECURITY_POLICY_VIOLATION).length>0)))return;const r=s.blockedURI;x("CSP_DETECTED_HOSTNAME_LIST").some(a=>Wt(r).call(r,a))&&(Jn.onSecurityPolicyViolation&&typeof Jn.onSecurityPolicyViolation=="function"&&Jn.onSecurityPolicyViolation(s),Jn.getListeners(Hr.SECURITY_POLICY_VIOLATION).length>0&&Jn.safeEmit(Hr.SECURITY_POLICY_VIOLATION,s))};e&&fv.removeEventListener("securitypolicyviolation",e),(t||n&&typeof n=="function"||Jn.getListeners(Hr.SECURITY_POLICY_VIOLATION).length>0)&&fv.addEventListener("securitypolicyviolation",i),Jn._cspEventHandlerPointer=i}We("PROCESS_ID","process-".concat(Ge(8,""),"-").concat(Ge(4,""),"-").concat(Ge(4,""),"-").concat(Ge(4,""),"-").concat(Ge(12,""))),function(){const n=Pe();Oi.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Oi.getStreamFromExtension=n.name===ke.CHROME&&Number(n.version)>34,Oi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let e=!1;try{t.addTransceiver("audio"),e=!0}catch{}return t.close(),e}(),Oi.supportMinBitrate=n.name===ke.CHROME||n.name===ke.EDGE,Oi.supportSetRtpSenderParameters=function(){const t=Pe();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!Oa()||!(!Vi()&&!Cf())||t.name===ke.FIREFOX&&Number(t.version)>=64}(),n.name===ke.SAFARI&&(Number(n.version)>=14?Oi.supportDualStream=!0:Oi.supportDualStream=!1),Oi.webAudioMediaStreamDest=function(){const t=Pe();return!(t.name===ke.SAFARI&&Number(t.version)<12)}(),Oi.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Oi.supportWebGL=typeof WebGLRenderingContext<"u",Oi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Oa()||(Oi.webAudioWithAEC=!0),Oi.supportShareAudio=function(){const t=Pe();return(t.os===Qn.WIN_10||t.os===Qn.WIN_81||t.os===Qn.WIN_7||t.os===Qn.LINUX||t.os===Qn.MAC_OS)&&t.name===ke.CHROME&&Number(t.version)>=74}(),Oi.supportDataChannel=function(){return!!(lT(76)||function(t){const e=Pe();return!(e.name!==ke.FIREFOX||!e.osVersion)&&Number(e.version)>=t}(68)||function(t){const e=Pe();return!(e.name!==ke.SAFARI||!e.osVersion)&&Number(e.version)>=t}(14))}(),Oi.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!nn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Oi.supportWebRTCEncodedTransform=function(){const t=Pe();return t.name==="Chrome"&&Number(t.version)>=86}(),Oi.supportWebRTCInsertableStream=function(){const t=Pe();return(t.name===ke.CHROME||t.name===ke.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),vr(()=>{Oi.supportDualStreamEncoding=function(){const t=Pe();return x("DISABLE_WEBAUDIO")?!0:t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&x("CHROME_DUAL_STREAM_USE_ENCODING"))}(),v.info("browser compatibility",JSON.stringify(Oi),JSON.stringify(n))})}(),function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void v.error("Error loading sdk config",t.message)}if(n)try{const t=JSON.parse(window.atob(n)),e=Date.now();v.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(ji,i)){const{value:s,expires:r}=t[i];if(r&&r<=e)return;Da[i]=s,ji[i]=s}})}catch(t){v.error("Error loading mutableParamsCache: ".concat(n),t.message)}}(),Array.isArray(Da.AREAS)&&Da.AREAS.length>0&&GS(Da.AREAS,!0);const Jn=function(n){const t=new rn,e=n,i={getListeners:t.getListeners.bind(t),on:(s,r)=>(function(a,c){a===Hr.SECURITY_POLICY_VIOLATION&&EN(c,!0)}(s,r),t.on.bind(t)(s,r)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return mN(mN({},e),i)}({__TRACK_LIST__:il,VERSION:Zs,BUILD:FT,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(n,t,e)=>{v.debug("setParameter key:".concat(n,", value:").concat(JSON.stringify(t))),We(n,t,e)},getParameter:x,getSupportedCodec:async function(){let n={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const e=(await t.createOffer()).sdp;if(!e)return n;t.close(),t=null,n=function(i){const s={video:[],audio:[]};return i.match(/ VP8/i)&&s.video.push("VP8"),i.match(/ VP9/i)&&s.video.push("VP9"),i.match(/ AV1/i)&&s.video.push("AV1"),i.match(/ H264/i)&&s.video.push("H264"),i.match(/ H265/i)&&s.video.push("H265"),i.match(/ opus/i)&&s.audio.push("OPUS"),i.match(/ PCMU/i)&&s.audio.push("PCMU"),i.match(/ PCMA/i)&&s.audio.push("PCMA"),i.match(/ G722/i)&&s.audio.push("G722"),s}(e)}catch(t){throw new G(O.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return n},checkSystemRequirements:function(){const n=Dt.reportApiInvoke(null,{name:Mn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:un.TRACER});let t=!1;try{const r=window.RTCPeerConnection,a=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;t=!!(r&&a&&c)}catch(r){return v.error("check system requirement failed: ",r),!1}let e=!1;const i=Pe();i.name===ke.CHROME&&Number(i.version)>=58&&(!mB()||_B())&&(e=!0),i.name===ke.FIREFOX&&Number(i.version)>=56&&(e=!0),i.name===ke.OPERA&&Number(i.version)>=45&&(e=!0),i.name===ke.SAFARI&&Number(i.version)>=11&&(e=!0),(CI()||Pe().name===ke.QQ)&&(e=!0),v.debug("checkSystemRequirements, api:",t,"browser",e);const s=t&&e;return n.onSuccess(s),s},getDevices:function(n){return Bs.enumerateDevices(!0,!0,n)},getMicrophones:function(n){return Bs.getRecordingDevices(n)},getCameras:function(n){return Bs.getCamerasDevices(n)},getElectronScreenSources:Sw,getPlaybackDevices:function(n){return Bs.getSpeakers(n)},createClient:function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=Dt.reportApiInvoke(null,{name:Mn.CREATE_CLIENT,options:[n],tag:un.TRACER});try{(function(e){Kn(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Kn(e.mode,"config.mode",["rtc","live"]),e.audioCodec!==void 0&&Kn(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),e.proxyServer!==void 0&&_i(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&PI(e.turnServer),e.httpRetryConfig!==void 0&&DI(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&DI(e.websocketRetryConfig)})(n)}catch(e){throw t.onError(e),e}return n.audioCodec===void 0&&(n.audioCodec="opus"),t.onSuccess(),new He(Th(Th({forceWaitGatewayResponse:!0},n),{},{role:n.mode==="rtc"?"host":n.role||"audience"}))},createCameraVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.CREATE_CAM_VIDEO_TRACK,options:[e_({},n)]}),e=t_(n),i=Ge(8,"track-cam-");let s=null;v.info("start create camera video track with config",JSON.stringify(n),"trackId",i);try{s=(await Fs({video:e},i)).getVideoTracks()[0]||null}catch(a){throw t.onError(a),a}if(!s){const a=new Q(O.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(a),a.throw(v)}n.optimizationMode&&fS(i,s,n,$o(n.encoderConfig));const r=new Ba(s,n,e,n.scalabiltyMode?qf(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,i);return t.onSuccess(r.getTrackId()),v.info("create camera video success, trackId:",i),r},createCustomVideoTrack:function(n){const t=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.CREATE_CUSTOM_VIDEO_TRACK,options:[n]}),e=new he(n.mediaStreamTrack,{width:n.width,height:n.height,frameRate:n.frameRate,bitrateMax:n.bitrateMax,bitrateMin:n.bitrateMin},n.scalabiltyMode?qf(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,Ge(8,"track-cus-"),[Qe.CUSTOM_TRACK]);return t.onSuccess(e.getTrackId()),v.info("create custom video track success with config",n,"trackId",e.getTrackId()),e},createScreenVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const e=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.CREATE_SCREEN_VIDEO_TRACK,options:[e_({},n),t]});n.encoderConfig?typeof n.encoderConfig=="string"||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const i=function(h){const f={};h.screenSourceType&&(f.mediaSource=h.screenSourceType),h.extensionId&&dT()&&(f.extensionId=h.extensionId);const{displaySurface:g,selfBrowserSurface:S,surfaceSwitching:w,systemAudio:b}=h;(lT(107)||gI(107)||TI(93))&&(g&&(Kn(g,"displaySurface",["browser","window","monitor"]),f.displaySurface=g),S?(Kn(S,"selfBrowserSurface",["exclude","include"]),f.selfBrowserSurface=S):f.selfBrowserSurface="include",w&&(Kn(w,"surfaceSwitching",["exclude","include"]),f.surfaceSwitching=w)),(lT(105)||gI(105)||TI(91))&&b&&(Kn(b,"systemAudio",["exclude","include"]),f.systemAudio=b),h.electronScreenSourceId&&(f.sourceId=h.electronScreenSourceId);const I=h.encoderConfig?ZT(h.encoderConfig):null;return f.mandatory={chromeMediaSource:"desktop",maxWidth:I?I.width:void 0,maxHeight:I?I.height:void 0},I&&(I.frameRate&&(typeof I.frameRate=="number"?(f.mandatory.maxFrameRate=I.frameRate,f.mandatory.minFrameRate=I.frameRate):(f.mandatory.maxFrameRate=I.frameRate.max||I.frameRate.ideal||I.frameRate.exact||void 0,f.mandatory.minFrameRate=I.frameRate.min||I.frameRate.ideal||I.frameRate.exact||void 0),f.frameRate=I.frameRate),I.width&&(f.width=I.width),I.height&&(f.height=I.height)),f}(n),s=Ge(8,"track-scr-v-");let r=null,a=null;const c=Ye();if(!c.supportShareAudio&&t==="enable"){const h=new Q(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return e.onError(h),h.throw(v)}v.info("start create screen video track with config",n,"withAudio",t,"trackId",s);try{const h=await Fs({screen:i,screenAudio:t==="auto"?c.supportShareAudio:t==="enable"},s);r=h.getVideoTracks()[0]||null,a=h.getAudioTracks()[0]||null}catch(h){throw e.onError(h),h}if(!r){const h=new Q(O.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(h),h.throw(v)}if(!a&&t==="enable"){r&&r.stop();const h=new Q(O.SHARE_AUDIO_NOT_ALLOWED);return e.onError(h),h.throw(v)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(fS(s,r,n,n.encoderConfig&&ZT(n.encoderConfig)||void 0),n.encoderConfig&&typeof n.encoderConfig!="string"&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const l=new he(r,n.encoderConfig?ZT(n.encoderConfig):{},n.scalabiltyMode?qf(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,s,[Qe.SCREEN_TRACK]);if(!a)return e.onSuccess(l.getTrackId()),v.info("create screen video track success","video:",l.getTrackId()),l;const u=new Le(a,void 0,Ge(8,"track-scr-a-"),!1,!0);return e.onSuccess([l.getTrackId(),u.getTrackId()]),v.info("create screen video track success","video:",l.getTrackId(),"audio:",u.getTrackId()),[l,u]},createMicrophoneAndCameraTracks:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.CREATE_MIC_AND_CAM_TRACKS,options:[n,t]}),i=t_(t),s=Pw(n),r=Ge(8,"track-mic-"),a=Ge(8,"track-cam-");let c=null,l=null;v.info("start create camera video track(".concat(a,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(t)));try{const f=await Fs({audio:s,video:i},"".concat(r,"-").concat(a));c=f.getAudioTracks()[0],l=f.getVideoTracks()[0]}catch(f){throw e.onError(f),f}if(!c||!l){const f=new Q(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return e.onError(f),f.throw(v)}t.optimizationMode&&fS(a,l,t,$o(t.encoderConfig));const u=new Va(c,n,s,r),h=new Ba(l,t,i,t.scalabiltyMode?qf(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return e.onSuccess([u.getTrackId(),h.getTrackId()]),v.info("create camera video track(".concat(a,") and microphone audio track(").concat(r,") success")),[u,h]},createMicrophoneAudioTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.CREATE_MIC_AUDIO_TRACK,options:[n]}),e=Pw(n),i=Ge(8,"track-mic-");let s=null;v.info("start create microphone audio track with config",JSON.stringify(n),"trackId",i);try{s=(await Fs({audio:e},i)).getAudioTracks()[0]||null}catch(a){throw t.onError(a),a}if(!s){const a=new Q(O.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(a),a.throw(v)}const r=new Va(s,n,e,i);return t.onSuccess(r.getTrackId()),v.info("create microphone audio track success, trackId:",i),r},createCustomAudioTrack:function(n){const t=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.CREATE_CUSTOM_AUDIO_TRACK,options:[n]}),e=new Le(n.mediaStreamTrack,n.encoderConfig?Yf(n.encoderConfig):{},Ge(8,"track-cus-"),!1,!0);return v.info("create custom audio track success with config",n,"trackId",e.getTrackId()),t.onSuccess(e.getTrackId()),e},createBufferSourceAudioTrack:async function(n){var t;const{cacheOnlineFile:e,encoderConfig:i}=n;let{source:s}=n;const r={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":s,cacheOnlineFile:e,encoderConfig:i},a=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.CREATE_BUFFER_AUDIO_TRACK,options:[r]});if(x("DISABLE_WEBAUDIO"))throw new Q(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const c=Ge(8,"track-buf-");v.info("start create buffer source audio track with config",JSON.stringify(r),"trackId",c);const l=s;if(!(s instanceof AudioBuffer))try{s=await e3(s,e)}catch(f){return a.onError(f),f.throw(v)}const u=new t3(s),h=new Fa(l,u,i?Yf(i):{},c);return v.info("create buffer source audio track success, trackId:",c),a.onSuccess(h.getTrackId()),h},setAppType:function(n){if(v.debug("setAppType: ".concat(n)),!(Number.isInteger(n)&&n>=0))throw v.debug("Invalid appType"),new G(O.INVALID_PARAMS,"invalid app type",n);We("APP_TYPE",Math.floor(n))},setLogLevel:function(n){v.setLogLevel(n)},enableLogUpload:function(){x("USE_NEW_LOG")?We("UPLOAD_LOG",!0):v.enableLogUpload()},disableLogUpload:function(){x("USE_NEW_LOG")?We("UPLOAD_LOG",!1):v.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new C_},checkAudioTrackIsActive:async function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const e=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(n instanceof Le||n instanceof Rr)){const l=new G(O.INVALID_TRACK,"the parameter is not a audio track");return e.onError(l),l.throw()}t&&t<1e3&&(t=1e3);const i=n instanceof Le?n.getTrackLabel():"remote_track",s=n.getVolumeLevel();let r=s,a=s;const c=Date.now();return new K(l=>{const u=setInterval(()=>{const h=n.getVolumeLevel();r=h>r?h:r,a=h<a?h:a;const f=r-a>1e-4,g=Date.now()-c;if(f||g>t){clearInterval(u);const S=f,w={duration:g,deviceLabel:i,maxVolumeLevel:r,result:S};v.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(w))),e.onSuccess(w),l(S)}},200)})},checkVideoTrackIsActive:async function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const e=Dt.reportApiInvoke(null,{tag:un.TRACER,name:Mn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(n instanceof he||n instanceof go)){const f=new G(O.INVALID_TRACK,"the parameter is not a video track");return e.onError(f),f.throw()}t&&t<1e3&&(t=1e3);const i=n instanceof he?n.getTrackLabel():"remote_track",s=n.getMediaStreamTrack(!0),r=document.createElement("video");r.style.width="1px",r.style.height="1px",r.setAttribute("muted",""),r.muted=!0,r.setAttribute("playsinline",""),r.controls=!1,(Vi()||Cf())&&(r.style.opacity="0.01",r.style.position="fixed",r.style.left="0",r.style.top="0",document.body.appendChild(r)),r.srcObject=new MediaStream([s]),r.play();const a=document.createElement("canvas");a.width=160,a.height=120;let c=0,l=0;try{const f=Date.now();c=await function(g,S,w,b){let I,U=0,F=null;return new K((V,Z)=>{function $(){U>b&&I&&(I(),V(U));const W=w.getContext("2d");if(!W){const mt=new G(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return v.error(mt.toString()),void Z(mt)}W.drawImage(g,0,0,160,120);const Y=W.getImageData(0,0,w.width,w.height),nt=Math.floor(Y.data.length/3);if(F){for(let mt=0;mt<nt;mt+=3)if(Y.data[mt]!==F[mt])return U+=1,void(F=Y.data);F=Y.data}else F=Y.data}setTimeout(()=>{I&&(I(),V(U))},S),I=rS(()=>{$()},30)})}(r,t,a,4),l=Date.now()-f}catch(f){throw e.onError(f),f}s5===ke.SAFARI&&(r.pause(),r.remove()),r.srcObject=null;const u=c>4,h={duration:l,changedPicNum:c,deviceLabel:i,result:u};return v.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(h))),e.onSuccess(h),u},setArea:GS,audioElementPlayCenter:Es,processExternalMediaAEC:function(n){o5.processExternalMediaAEC(n)},registerExtensions:function(n){n.forEach(t=>{const e=t;e.__registered__=!0,e.logger.hookLog=v.extLog,e.reporter.hookApiInvoke=Dt.extApiInvoke,e.parameters&&Object.keys(e.parameters).forEach(i=>{e.parameters[i]=x(i)})})},ChannelMediaRelayError:ka,ChannelMediaRelayEvent:Gr,ChannelMediaRelayState:Gi,RemoteStreamFallbackType:tS,RemoteStreamType:zf,ConnectionDisconnectedReason:fe,AudienceLatencyLevelType:fT,AREAS:ye});return Object.defineProperties(Jn,{onAudioAutoplayFailed:{get:()=>js.onAudioAutoplayFailed,set:n=>{js.onAudioAutoplayFailed=n}},onAutoplayFailed:{get:()=>js.onAutoplayFailed,set:n=>{js.onAutoplayFailed=n}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Jn._onSecurityPolicyViolation,set(n){Jn._onSecurityPolicyViolation=n,EN(n)}},__CLIENT_LIST__:{get:()=>x("SHOW_GLOBAL_CLIENT_LIST")?Pa:[]}}),Bs.on(Qo.CAMERA_DEVICE_CHANGED,n=>{v.info("camera device changed",JSON.stringify(n)),Jn.onCameraChanged&&Jn.onCameraChanged(n),Jn.safeEmit(Hr.CAMERA_CHANGED,n)}),Bs.on(Qo.RECORDING_DEVICE_CHANGED,n=>{v.info("microphone device changed",JSON.stringify(n)),Jn.onMicrophoneChanged&&Jn.onMicrophoneChanged(n),Jn.safeEmit(Hr.MICROPHONE_CHANGED,n)}),Bs.on(Qo.PLAYOUT_DEVICE_CHANGED,n=>{v.debug("playout device changed",JSON.stringify(n)),Jn.onPlaybackDeviceChanged&&Jn.onPlaybackDeviceChanged(n),Jn.safeEmit(Hr.PLAYBACK_DEVICE_CHANGED,n)}),Es.onAutoplayFailed=()=>{v.info("detect audio element autoplay failed"),js.onAudioAutoplayFailed&&js.onAudioAutoplayFailed()},Ve.on("autoplay-failed",()=>{v.info("detect webaudio autoplay failed"),js.onAudioAutoplayFailed&&js.onAudioAutoplayFailed(),Jn.safeEmit(Hr.AUTOPLAY_FAILED)}),On.on(Jo.NETWORK_STATE_CHANGE,(n,t)=>{v.info("[network-indicator] network state changed, ".concat(t," => ").concat(n))}),window&&(window.__ARTC__=Jn),Jn})})(rk);var l8=rk.exports;const Fh=Q6(l8),u8={class:"container-fluid row text-center mt-1 mb-2"},h8={class:"col-6 bg-info-subtle"},p8={class:"row input-group mt-2"},f8={class:"col-4"},_8={class:"input-group offset-1 mb-3"},m8=ot("span",{class:"input-group-text",id:"basic-addon1"},"room",-1),E8={class:"container-fluid row"},g8={class:"col-12 object-fit: fill",id:"camera-video"},T8={class:"col-12 object-fit: fill",id:"remote-video"},S8={key:0,class:"waiting"},v8={class:"col-6 bg-primary-subtle"},y8=ot("nav",null,[ot("div",{class:"nav nav-tabs row",id:"nav-tab",role:"tablist"},[ot("button",{class:"nav-link active col",id:"nav-setting-tab","data-bs-toggle":"tab","data-bs-target":"#nav-home",type:"button",role:"tab","aria-controls":"nav-home","aria-selected":"true"},"Setting"),ot("button",{class:"nav-link col",id:"nav-chat-tab","data-bs-toggle":"tab","data-bs-target":"#nav-chat",type:"button",role:"tab","aria-controls":"nav-chat","aria-selected":"false"},"Chat")])],-1),C8={class:"tab-content",id:"nav-tabContent"},R8={class:"tab-pane fade show active",id:"nav-home",role:"tabpanel","aria-labelledby":"nav-setting-tab",tabindex:"0"},b8=ot("div",{class:"bg-info"},[ot("h4",{class:"left-align text-start mt-1 mb-1"},"Connect Toys")],-1),I8=ot("h5",{class:"mb-2 text-center bg-info"},"VibCrafter APP",-1),A8={class:"row g-3 bg-info mb-2"},w8=yy('<div class="col-sm-4 text-start"><label for="firstName" class="form-label text-start">User ID</label><input type="text" class="form-control" id="firstName" placeholder="" value="" required><div class="invalid-feedback"> Valid first name is required. </div></div><div class="col-sm-4 text-start"><label for="lastName" class="form-label text-start">Password</label><input type="text" class="form-control" id="lastName" placeholder="" value="" required><div class="invalid-feedback"> Valid last name is required. </div></div>',2),O8=ot("label",{for:"devLogin",class:"form-label text-start"}," Login ",-1),N8={class:"container mt-4"},D8=ot("h5",{class:"mb-4 text-center"},"Login Success",-1),P8=[D8],L8={class:"container bg-info mt-4 mb-4"},k8=ot("h4",{class:"left-align"},"Tip Setting",-1),M8={class:"table mt-2 mb-4"},U8=ot("thead",null,[ot("tr",null,[ot("th",{scope:"col"},"#"),ot("th",{scope:"col"},"Activity"),ot("th",{scope:"col"},"Vibration"),ot("th",{scope:"col"},"Tokens")])],-1),x8={scope:"row"},V8={class:"tab-pane fade",id:"nav-chat",role:"tabpanel","aria-labelledby":"nav-chat-tab",tabindex:"0"},F8=bs({__name:"LiveRoom",setup(o){const d=Yl(),p=ql(),_=sk(),E=ts("axios");E.defaults.withCredentials=!0;const T=la+"api/v1/dev/login",R=la+"api/v1/dev/set",N=la+"api/v1/room/create",D=Kl();let M=ze(""),P=ze(""),j=ze(!0),q=ze(!1);const tt=ze([]);E.get(R,{headers:{Token:p.getToken()}},{withCredentials:!0},{model_name:"host"}).then(Be=>{console.log("res data",Be.data),Be.data===401&&(console.log("get 401, push to login"),D.push({name:"login"})),tt.value=Be.data.data}).catch(Be=>{console.log("res err",Be),Be.response.status===401&&(console.log("res err, get 401, push to login"),D.push({name:"login"}))});function at(){console.log("devName is ",M.value),console.log("devPassword is ",P.value),E.post(T,{dev_name:M.value,password:P.value,model_name:d.getUserName()},{headers:{Token:p.getToken()}},{withCredentials:!0}).then(Be=>{console.log("res data",Be.data),Be.data===401&&(console.log("get 401, push to login"),D.push({name:"login"})),j.value=!1,q.value=!0,_.setDevName(M.value)}).catch(Be=>{console.log("res err",Be),Be.response.status===401&&(console.log("res err, get 401, push to login"),D.push({name:"login"}))})}function lt(){}let vt,wt,It,Bt=ze(!1),Et=ze(!1),jt=ze(!1),re=ze(!1),pe=ze(!1),Mt=ze(!1),qt=ze(!1),Xt=ze("");async function Qt(){if(Mt.value=!Mt.value,vt)return vt.setEnabled(!vt.enabled);vt=await Fh.createCameraVideoTrack(),vt.play("camera-video")}async function Lt(){if(qt.value=!qt.value,wt)return wt.setEnabled(!wt.enabled);wt=await Fh.createMicrophoneAudioTrack(),wt.play()}const de=ze("fatbear");async function Ne(){de.value||(de.value="fatbear"),Bt.value&&await dn(),It||(It=Fh.createClient({mode:"rtc",codec:"vp8"}),It.setClientRole("host"),It.on("user-published",Ee)),await It.join(nk,de.value,ik,123),Bt.value=!0}async function dn(){Bt.value=!1,Et.value=!1,jt.value=!1,Mt.value=!1,It&&await It.leave()}async function Ee(Be,kn){kn==="video"&&((await It.subscribe(Be,kn)).play("remote-video"),pe.value=!0),kn==="audio"&&((await It.subscribe(Be,kn)).play(),re.value=!0)}async function Oe(){Mt.value||await Qt(),Bt.value||await Ne(),await It.publish(vt),jt.value=!0}async function Ue(){qt.value||await Lt(),Bt.value||await Ne(),await It.publish(wt),Et.value=!0}async function Wn(){Ue(),Oe(),E.post(N,{name:Xt.value,creator:d.getUserName()},{headers:{Token:p.getToken()}}).then(Be=>{console.log("res data",Be.data)}).catch(Be=>{console.log("res err",Be)})}return(Be,kn)=>(Je(),In($n,null,[ri(By),ot("main",null,[ot("div",u8,[ot("div",h8,[ot("div",p8,[ot("div",f8,[ot("div",_8,[m8,ys(ot("input",{type:"text",class:"form-control",placeholder:"room","aria-label":"room","aria-describedby":"basic-addon1","onUpdate:modelValue":kn[0]||(kn[0]=tn=>di(Xt)?Xt.value=tn:Xt=tn)},null,512),[[zh,Zi(Xt)]])])]),ot("div",{class:"col-2"},[ot("button",{class:"btn btn-primary w-45 me-1",onClick:Wn},"Join")])]),ot("div",E8,[ot("div",null,[ys(ot("video",g8,null,512),[[Ah,Zi(Mt)]]),ys(ot("video",T8,null,512),[[Ah,Zi(pe)]]),Zi(Bt)&&!Zi(pe)?(Je(),In("div",S8)):Z_("",!0)])])]),ot("div",v8,[y8,ot("div",C8,[ot("div",R8,[b8,I8,ys(ot("div",A8,[w8,ot("div",{class:"col-sm-4 text-start"},[O8,ot("button",{id:"devLogin",type:"submit",class:"form-control btn btn-primary text-center",onClick:at},"Login")])],512),[[Ah,Zi(j)]]),ys(ot("div",N8,P8,512),[[Ah,Zi(q)]]),ot("div",L8,[k8,ot("table",M8,[U8,ot("tbody",null,[(Je(!0),In($n,null,pd(tt.value,(tn,Tt)=>(Je(),In("tr",{key:tn.id},[ot("th",x8,fi(Tt),1),ot("td",null,fi(tn.duration)+" Sec",1),ot("td",null,fi(tn.vibration),1),ot("td",null,fi(tn.token),1)]))),128))])]),ot("div",{class:"col-auto"},[ot("button",{type:"submit",class:"btn btn-primary mb-2 text-center",onClick:lt},"Save")])])])]),ot("div",V8,[ri(jy)])])])])],64))}}),fc=o=>(my("data-v-9f3ed7c4"),o=o(),Ey(),o),B8={class:"d-flex align-items-center py-4 bg-body-tertiary"},j8=yy('<svg xmlns="http://www.w3.org/2000/svg" class="d-none" data-v-9f3ed7c4><symbol id="check2" viewBox="0 0 16 16" data-v-9f3ed7c4><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" data-v-9f3ed7c4></path></symbol><symbol id="circle-half" viewBox="0 0 16 16" data-v-9f3ed7c4><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z" data-v-9f3ed7c4></path></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16" data-v-9f3ed7c4><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z" data-v-9f3ed7c4></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z" data-v-9f3ed7c4></path></symbol><symbol id="sun-fill" viewBox="0 0 16 16" data-v-9f3ed7c4><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z" data-v-9f3ed7c4></path></symbol></svg>',1),G8={class:"form-signin w-100 m-auto"},W8=fc(()=>ot("img",{class:"mb-3",src:ek,alt:"",width:"72",height:"57"},null,-1)),H8=fc(()=>ot("h1",{class:"h3 mb-3 fw-normal fw-bold"},"Livestream Demo System",-1)),K8=fc(()=>ot("h4",{class:"h5 mb-3 fw-normal"},"Just for demo Using",-1)),q8={class:"form-floating"},Y8=fc(()=>ot("label",{for:"user_id"},"User ID",-1)),z8={class:"form-floating"},J8=fc(()=>ot("label",{for:"password"},"Password",-1)),X8={class:"form-check mt-2"},$8={class:"row"},Q8={class:"col form-check"},Z8=fc(()=>ot("label",{class:"form-check-label",for:"flexRadioDefault1"}," User ",-1)),tq={class:"col form-check"},eq=fc(()=>ot("label",{class:"form-check-label",for:"flexRadioDefault2"}," Model ",-1)),nq=fc(()=>ot("p",{class:"mt-5 mb-3 text-body-secondary"},"© 2023",-1)),iq=bs({__name:"Login",setup(o){const d=ql(),p=Yl(),_=la+"api/v1/user/login",E=ts("axios"),T=Kl(),R=ze(""),N=ze("");ze("");let D="";const M=ze("");async function P(){console.log("start login"),console.log(R),console.log(N),console.log("radioUser : ",M.value),M.value==="user"?D="user":M.value==="model"&&(D="host"),console.log("host is ",D),E.post(_,{user_name:R.value,password:N.value,role:D}).then(j=>{console.log(j.data),j.data.code!==0?(console.log("toast come"),alert("login failed")):(console.log("login success ,push to live"),d.setToken(j.data.data),p.setHost(D),p.setUserName(R.value),console.log("token is  :",d.getToken()),console.log("host is  :",p.getHost()),p.getHost()==="host"?T.push({name:"live"}):T.push({name:"model"}))}).catch(j=>{console.log(j),alert("[ex]login failed")})}return(j,q)=>(Je(),In("body",B8,[j8,ot("main",G8,[W8,H8,K8,ot("div",q8,[ys(ot("input",{type:"text",class:"form-control",id:"user_id",placeholder:"123456","onUpdate:modelValue":q[0]||(q[0]=tt=>R.value=tt)},null,512),[[zh,R.value]]),Y8]),ot("div",z8,[ys(ot("input",{type:"password",class:"form-control",id:"password",placeholder:"Password","onUpdate:modelValue":q[1]||(q[1]=tt=>N.value=tt)},null,512),[[zh,N.value]]),J8]),ot("div",X8,[ot("div",$8,[ot("div",Q8,[ys(ot("input",{class:"form-check-input",type:"radio",name:"flexRadioDefault","onUpdate:modelValue":q[2]||(q[2]=tt=>M.value=tt),id:"flexRadioDefault1",value:"user"},null,512),[[Lh,M.value]]),Z8]),ot("div",tq,[ys(ot("input",{class:"form-check-input",type:"radio",name:"flexRadioDefault","onUpdate:modelValue":q[3]||(q[3]=tt=>M.value=tt),id:"flexRadioDefault2",value:"model"},null,512),[[Lh,M.value]]),eq])])]),ot("button",{class:"btn btn-primary w-100 py-2 mt-2",onClick:P},"Sign in"),nq])]))}}),sq=rp(iq,[["__scopeId","data-v-9f3ed7c4"]]),rq="/assets/zhubo-3ff52482.jpeg",oq=o=>(my("data-v-b384000e"),o=o(),Ey(),o),aq={album:"","py-5":"","bg-body-tertiary":""},cq={class:"container-fluid row mb-4 ms-4 me-4"},dq=oq(()=>ot("img",{src:rq,class:"img-fluid"},null,-1)),lq={class:"card-body"},uq={class:"card-text"},hq=bs({__name:"ModelList",setup(o){const d=Kl(),p=Yl(),_=ql();p.getHost();const E=ze([]),T=ts("axios"),R=la+"api/v1/room/list";T.get(R,{headers:{Token:_.getToken()}},{withCredentials:!0}).then(D=>{console.log("res data",D.data),D.data===401&&(console.log("get 401, push to login"),d.push({name:"login"})),E.value=D.data.data}).catch(D=>{console.log("res err",D),D.response.status===401&&(console.log("res err, get 401, push to login"),d.push({name:"login"}))});async function N(){d.push({name:"view"})}return(D,M)=>(Je(),In($n,null,[ri(By),ot("div",aq,[ot("div",cq,[(Je(!0),In($n,null,pd(E.value,(P,j)=>(Je(),In("div",{key:P.id,class:"col-2 card shadow-sm"},[dq,ot("div",lq,[ot("p",uq,fi(j)+", "+fi(P.room_name)+", "+fi(P.creator),1),ot("div",{class:"d-flex justify-content-between align-items-center"},[ot("div",{class:"btn-group"},[ot("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:N},"Join")])])])]))),128))])])],64))}}),pq=rp(hq,[["__scopeId","data-v-b384000e"]]),fq=ot("div",{class:"bg-info mb-1 mt-1 text-start"},[ot("h4",{class:"mt-2 text-start"},"Add Tokens")],-1),_q=ot("h4",{class:"left-align mt-2 col-4"},"Token left: ",-1),mq={class:"container-fluid bg-info mb-1"},Eq=ot("h4",{class:"left-align mt-2 text-start"},"Recently 100 times action",-1),gq={class:"table mb-2"},Tq=ot("thead",null,[ot("tr",null,[ot("th",{scope:"col"},"#"),ot("th",{scope:"col"},"Time"),ot("th",{scope:"col"},"Model"),ot("th",{scope:"col"},"Duration"),ot("th",{scope:"col"},"Vibration"),ot("th",{scope:"col"},"Tokens")])],-1),Sq={scope:"row"},ok=bs({__name:"Order",setup(o){Kl();const d=Yl(),p=ql();d.getHost();const _=ze([]),E=ts("axios"),T=la+"api/v1/dev/order";E.get(T+"?send_user="+d.getUserName(),{headers:{Token:p.getToken()}},{withCredentials:!0}).then(N=>{_.value=N.data.data}).catch(N=>{});function R(){}return(N,D)=>(Je(),In($n,null,[ri(By),ot("div",null,[fq,ot("div",{class:"container row text-center"},[_q,ot("button",{type:"button",class:"btn btn-sm btn-warning col-4",onClick:R},"Apply for 1000 Tokens")])]),ot("div",mq,[Eq,ot("table",gq,[Tq,ot("tbody",null,[(Je(!0),In($n,null,pd(_.value,(M,P)=>(Je(),In("tr",{key:M.id},[ot("th",Sq,fi(P),1),ot("td",null,fi(M.createdAt),1),ot("td",null,fi(M.model_name),1),ot("td",null,fi(M.duration)+" Sec",1),ot("td",null,fi(M.vibration),1),ot("td",null,fi(M.token),1)]))),128))])])])],64))}}),vq=yy('<svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="arrow-right-short" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z"></path></symbol><symbol id="x-lg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0Z"></path><path fill-rule="evenodd" d="M2.146 2.146a.5.5 0 0 0 0 .708l11 11a.5.5 0 0 0 .708-.708l-11-11a.5.5 0 0 0-.708 0Z"></path></symbol></svg>',1),yq={class:"container-fluid row mt-1 mb-2"},Cq={class:"col-6 bg-info-subtle"},Rq=ot("div",{class:"col-2"},null,-1),bq={class:"container-fluid"},Iq={class:"col-12 object-fit: fill",id:"remote-video"},Aq={class:"col-6 bg-primary-subtle"},wq=ot("nav",null,[ot("div",{class:"nav nav-tabs row",id:"nav-tab",role:"tablist"},[ot("button",{class:"nav-link active col",id:"nav-setting-tab","data-bs-toggle":"tab","data-bs-target":"#nav-home",type:"button",role:"tab","aria-controls":"nav-home","aria-selected":"true"},"Send"),ot("button",{class:"nav-link col",id:"nav-chat-tab","data-bs-toggle":"tab","data-bs-target":"#nav-chat",type:"button",role:"tab","aria-controls":"nav-chat","aria-selected":"false"},"Chat")])],-1),Oq={class:"tab-content",id:"nav-tabContent"},Nq={class:"tab-pane fade show active",id:"nav-home",role:"tabpanel","aria-labelledby":"nav-setting-tab",tabindex:"0"},Dq=ot("h4",{class:"left-align mt-1"},"Tip Menu",-1),Pq={class:"table mb-2"},Lq=ot("thead",null,[ot("tr",null,[ot("th",{scope:"col"},"#"),ot("th",{scope:"col"},"Activity"),ot("th",{scope:"col"},"Vibration"),ot("th",{scope:"col"},"Tokens")])],-1),kq={scope:"row"},Mq={class:"container mt-2 text-center"},Uq={class:"form-check btn-group text-center",role:"group","aria-label":"Basic radio toggle button group"},xq=ot("label",{class:"btn btn-outline-primary me-4",for:"btnradio1"},"20",-1),Vq=ot("label",{class:"btn btn-outline-primary me-4",for:"btnradio2"},"50",-1),Fq=ot("label",{class:"btn btn-outline-primary me-4",for:"btnradio3"},"100",-1),Bq={class:"text-center mt-2"},jq={class:"input-group mb-3"},Gq=ot("span",{class:"input-group-text",id:"basic-addon1"},"Custom Amount",-1),Wq=ot("svg",{class:"bi ms-1",width:"20",height:"20"},[ot("use",{"xlink:href":"#arrow-right-short"})],-1),Hq=ot("button",{type:"button",class:"col-4 btn btn-primary ms-2","data-bs-toggle":"modal","data-bs-target":"#exampleModal"}," Setting ",-1),Kq={class:"modal fade modal-xl",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},qq={class:"modal-dialog"},Yq={class:"modal-content"},zq=ot("div",{class:"modal-header"},[ot("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Setting"),ot("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Jq={class:"modal-body"},Xq=ot("div",{class:"modal-footer"},[ot("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1),$q={class:"tab-pane fade",id:"nav-chat",role:"tabpanel","aria-labelledby":"nav-chat-tab",tabindex:"0"},Qq=bs({__name:"ViewRoom",setup(o){const d=Yl(),p=ql(),_=sk(),E=ts("axios");E.defaults.withCredentials=!0;const T=la+"api/v1/dev/order",R=la+"api/v1/dev/set",N=Kl(),D=ze([]);E.get(R+"?model_name=host",{headers:{Token:p.getToken()}},{withCredentials:!0}).then(Qt=>{console.log("res data",Qt.data),Qt.data===401&&(console.log("get 401, push to login"),N.push({name:"login"})),D.value=Qt.data.data}).catch(Qt=>{console.log("res err",Qt),Qt.response.status===401&&(console.log("res err, get 401, push to login"),N.push({name:"login"}))});const M=ze(""),P=ze(0);let j=0;function q(){console.log("tselect : ",M.value),M.value==="20"?j=20:M.value==="50"?j=50:M.value==="100"&&(j=100),P.value!==0&&(j=P.value),console.log("lastToken is ",j),console.log("send tip , token is  ",p.getToken()),E.post(T,{dev_name:_.getDevName(),model_name:"host",send_user:d.getUserName(),vibration:"Medium",duration:10,token:j},{headers:{Token:p.getToken()}},{withCredentials:!0}).then(Qt=>{console.log("res data",Qt.data),Qt.data===401&&(console.log("get 401, push to login"),N.push({name:"login"}))}).catch(Qt=>{console.log("res err",Qt),Qt.response.status===401&&(console.log("res err, get 401, push to login"),N.push({name:"login"}))})}let tt,at,lt=ze(!1),vt=ze(!1),wt=ze(!1),It=ze(!1),Bt=ze(!1),Et=ze(!1);ze(!1);async function jt(){if(Et.value=!Et.value,tt)return tt.setEnabled(!tt.enabled);tt=await Fh.createCameraVideoTrack(),tt.play("camera-video")}const re=ze("fatbear");async function pe(){re.value||(re.value="fatbear"),lt.value&&await Mt(),at||(at=Fh.createClient({mode:"rtc",codec:"vp8"}),at.on("user-published",qt)),await at.join(nk,re.value,ik,1234567890),console.log("client join the live channle ok"),lt.value=!0}async function Mt(){lt.value=!1,vt.value=!1,wt.value=!1,Et.value=!1,at&&await at.leave()}async function qt(Qt,Lt){Lt==="video"&&((await at.subscribe(Qt,Lt)).play("remote-video"),Bt.value=!0),Lt==="audio"&&((await at.subscribe(Qt,Lt)).play(),It.value=!0)}async function Xt(){Et.value||await jt(),lt.value||await pe()}return(Qt,Lt)=>{const de=ld("Upper");return Je(),In($n,null,[ri(de),vq,ot("div",yq,[ot("div",Cq,[ot("div",{class:"row input-group"},[Rq,ot("div",{class:"col-4"},[ot("button",{class:"btn btn-primary w-45 me-1",onClick:Xt},"Join")])]),ot("div",bq,[ys(ot("video",Iq,"remote",512),[[Ah,Zi(lt)]])])]),ot("div",Aq,[wq,ot("div",Oq,[ot("div",Nq,[Dq,ot("div",null,[ot("table",Pq,[Lq,ot("tbody",null,[(Je(!0),In($n,null,pd(D.value,(Ne,dn)=>(Je(),In("tr",{key:Ne.id},[ot("th",kq,fi(dn),1),ot("td",null,fi(Ne.duration)+" Sec",1),ot("td",null,fi(Ne.vibration),1),ot("td",null,fi(Ne.token),1)]))),128))])])]),ot("div",null," User ID: "+fi(Zi(d).getUserName())+", Token Left: ",1),ot("div",Mq,[ot("div",Uq,[ys(ot("input",{type:"radio",class:"form-check-input btn-check",name:"btnradio",id:"btnradio1",autocomplete:"off",checked:"",value:"20","onUpdate:modelValue":Lt[0]||(Lt[0]=Ne=>M.value=Ne)},null,512),[[Lh,M.value]]),xq,ys(ot("input",{type:"radio",class:"form-check-input btn-check",name:"btnradio",id:"btnradio2",autocomplete:"off",value:"50","onUpdate:modelValue":Lt[1]||(Lt[1]=Ne=>M.value=Ne)},null,512),[[Lh,M.value]]),Vq,ys(ot("input",{type:"radio",class:"form-check-input btn-check",name:"btnradio",id:"btnradio3",autocomplete:"off",value:"100","onUpdate:modelValue":Lt[2]||(Lt[2]=Ne=>M.value=Ne)},null,512),[[Lh,M.value]]),Fq])]),ot("div",Bq,[ot("div",jq,[Gq,ys(ot("input",{type:"text",class:"form-control",placeholder:"","aria-label":"room","aria-describedby":"basic-addon1","onUpdate:modelValue":Lt[3]||(Lt[3]=Ne=>P.value=Ne)},null,512),[[zh,P.value]])]),ot("div",{class:"row text-center mt-2"},[ot("button",{class:"offset-2 col-4 btn btn-primary d-inline-flex align-items-center",type:"button",onClick:q},[np(" Send "),Wq]),Hq]),ot("div",null,[ot("div",Kq,[ot("div",qq,[ot("div",Yq,[zq,ot("div",Jq,[ri(ok)]),Xq])])])])])])]),ot("div",$q,[ri(jy)])])])],64)}}}),Zq=zK({history:lK("/"),routes:[{path:"/:catchAll(.*)",redirect:{name:"live"}},{path:"/login",name:"login",component:sq},{path:"/live",name:"live",component:F8},{path:"/model",name:"model",component:pq},{path:"/view",name:"view",component:Qq},{path:"/order",name:"order",component:ok},{path:"/chat",name:"chat",component:jy}]});function ak(o,d){return function(){return o.apply(d,arguments)}}const{toString:tY}=Object.prototype,{getPrototypeOf:Gy}=Object,Gm=(o=>d=>{const p=tY.call(d);return o[p]||(o[p]=p.slice(8,-1).toLowerCase())})(Object.create(null)),Mo=o=>(o=o.toLowerCase(),d=>Gm(d)===o),Wm=o=>d=>typeof d===o,{isArray:zl}=Array,$h=Wm("undefined");function eY(o){return o!==null&&!$h(o)&&o.constructor!==null&&!$h(o.constructor)&&Mr(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const ck=Mo("ArrayBuffer");function nY(o){let d;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?d=ArrayBuffer.isView(o):d=o&&o.buffer&&ck(o.buffer),d}const iY=Wm("string"),Mr=Wm("function"),dk=Wm("number"),Hm=o=>o!==null&&typeof o=="object",sY=o=>o===!0||o===!1,im=o=>{if(Gm(o)!=="object")return!1;const d=Gy(o);return(d===null||d===Object.prototype||Object.getPrototypeOf(d)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)},rY=Mo("Date"),oY=Mo("File"),aY=Mo("Blob"),cY=Mo("FileList"),dY=o=>Hm(o)&&Mr(o.pipe),lY=o=>{let d;return o&&(typeof FormData=="function"&&o instanceof FormData||Mr(o.append)&&((d=Gm(o))==="formdata"||d==="object"&&Mr(o.toString)&&o.toString()==="[object FormData]"))},uY=Mo("URLSearchParams"),hY=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ap(o,d,{allOwnKeys:p=!1}={}){if(o===null||typeof o>"u")return;let _,E;if(typeof o!="object"&&(o=[o]),zl(o))for(_=0,E=o.length;_<E;_++)d.call(null,o[_],_,o);else{const T=p?Object.getOwnPropertyNames(o):Object.keys(o),R=T.length;let N;for(_=0;_<R;_++)N=T[_],d.call(null,o[N],N,o)}}function lk(o,d){d=d.toLowerCase();const p=Object.keys(o);let _=p.length,E;for(;_-- >0;)if(E=p[_],d===E.toLowerCase())return E;return null}const uk=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),hk=o=>!$h(o)&&o!==uk;function $v(){const{caseless:o}=hk(this)&&this||{},d={},p=(_,E)=>{const T=o&&lk(d,E)||E;im(d[T])&&im(_)?d[T]=$v(d[T],_):im(_)?d[T]=$v({},_):zl(_)?d[T]=_.slice():d[T]=_};for(let _=0,E=arguments.length;_<E;_++)arguments[_]&&ap(arguments[_],p);return d}const pY=(o,d,p,{allOwnKeys:_}={})=>(ap(d,(E,T)=>{p&&Mr(E)?o[T]=ak(E,p):o[T]=E},{allOwnKeys:_}),o),fY=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),_Y=(o,d,p,_)=>{o.prototype=Object.create(d.prototype,_),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:d.prototype}),p&&Object.assign(o.prototype,p)},mY=(o,d,p,_)=>{let E,T,R;const N={};if(d=d||{},o==null)return d;do{for(E=Object.getOwnPropertyNames(o),T=E.length;T-- >0;)R=E[T],(!_||_(R,o,d))&&!N[R]&&(d[R]=o[R],N[R]=!0);o=p!==!1&&Gy(o)}while(o&&(!p||p(o,d))&&o!==Object.prototype);return d},EY=(o,d,p)=>{o=String(o),(p===void 0||p>o.length)&&(p=o.length),p-=d.length;const _=o.indexOf(d,p);return _!==-1&&_===p},gY=o=>{if(!o)return null;if(zl(o))return o;let d=o.length;if(!dk(d))return null;const p=new Array(d);for(;d-- >0;)p[d]=o[d];return p},TY=(o=>d=>o&&d instanceof o)(typeof Uint8Array<"u"&&Gy(Uint8Array)),SY=(o,d)=>{const _=(o&&o[Symbol.iterator]).call(o);let E;for(;(E=_.next())&&!E.done;){const T=E.value;d.call(o,T[0],T[1])}},vY=(o,d)=>{let p;const _=[];for(;(p=o.exec(d))!==null;)_.push(p);return _},yY=Mo("HTMLFormElement"),CY=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(p,_,E){return _.toUpperCase()+E}),LD=(({hasOwnProperty:o})=>(d,p)=>o.call(d,p))(Object.prototype),RY=Mo("RegExp"),pk=(o,d)=>{const p=Object.getOwnPropertyDescriptors(o),_={};ap(p,(E,T)=>{let R;(R=d(E,T,o))!==!1&&(_[T]=R||E)}),Object.defineProperties(o,_)},bY=o=>{pk(o,(d,p)=>{if(Mr(o)&&["arguments","caller","callee"].indexOf(p)!==-1)return!1;const _=o[p];if(Mr(_)){if(d.enumerable=!1,"writable"in d){d.writable=!1;return}d.set||(d.set=()=>{throw Error("Can not rewrite read-only method '"+p+"'")})}})},IY=(o,d)=>{const p={},_=E=>{E.forEach(T=>{p[T]=!0})};return zl(o)?_(o):_(String(o).split(d)),p},AY=()=>{},wY=(o,d)=>(o=+o,Number.isFinite(o)?o:d),Rv="abcdefghijklmnopqrstuvwxyz",kD="0123456789",fk={DIGIT:kD,ALPHA:Rv,ALPHA_DIGIT:Rv+Rv.toUpperCase()+kD},OY=(o=16,d=fk.ALPHA_DIGIT)=>{let p="";const{length:_}=d;for(;o--;)p+=d[Math.random()*_|0];return p};function NY(o){return!!(o&&Mr(o.append)&&o[Symbol.toStringTag]==="FormData"&&o[Symbol.iterator])}const DY=o=>{const d=new Array(10),p=(_,E)=>{if(Hm(_)){if(d.indexOf(_)>=0)return;if(!("toJSON"in _)){d[E]=_;const T=zl(_)?[]:{};return ap(_,(R,N)=>{const D=p(R,E+1);!$h(D)&&(T[N]=D)}),d[E]=void 0,T}}return _};return p(o,0)},PY=Mo("AsyncFunction"),LY=o=>o&&(Hm(o)||Mr(o))&&Mr(o.then)&&Mr(o.catch),Ct={isArray:zl,isArrayBuffer:ck,isBuffer:eY,isFormData:lY,isArrayBufferView:nY,isString:iY,isNumber:dk,isBoolean:sY,isObject:Hm,isPlainObject:im,isUndefined:$h,isDate:rY,isFile:oY,isBlob:aY,isRegExp:RY,isFunction:Mr,isStream:dY,isURLSearchParams:uY,isTypedArray:TY,isFileList:cY,forEach:ap,merge:$v,extend:pY,trim:hY,stripBOM:fY,inherits:_Y,toFlatObject:mY,kindOf:Gm,kindOfTest:Mo,endsWith:EY,toArray:gY,forEachEntry:SY,matchAll:vY,isHTMLForm:yY,hasOwnProperty:LD,hasOwnProp:LD,reduceDescriptors:pk,freezeMethods:bY,toObjectSet:IY,toCamelCase:CY,noop:AY,toFiniteNumber:wY,findKey:lk,global:uk,isContextDefined:hk,ALPHABET:fk,generateString:OY,isSpecCompliantForm:NY,toJSONObject:DY,isAsyncFn:PY,isThenable:LY};function cn(o,d,p,_,E){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",d&&(this.code=d),p&&(this.config=p),_&&(this.request=_),E&&(this.response=E)}Ct.inherits(cn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ct.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const _k=cn.prototype,mk={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{mk[o]={value:o}});Object.defineProperties(cn,mk);Object.defineProperty(_k,"isAxiosError",{value:!0});cn.from=(o,d,p,_,E,T)=>{const R=Object.create(_k);return Ct.toFlatObject(o,R,function(D){return D!==Error.prototype},N=>N!=="isAxiosError"),cn.call(R,o.message,d,p,_,E),R.cause=o,R.name=o.name,T&&Object.assign(R,T),R};const kY=null;function Qv(o){return Ct.isPlainObject(o)||Ct.isArray(o)}function Ek(o){return Ct.endsWith(o,"[]")?o.slice(0,-2):o}function MD(o,d,p){return o?o.concat(d).map(function(E,T){return E=Ek(E),!p&&T?"["+E+"]":E}).join(p?".":""):d}function MY(o){return Ct.isArray(o)&&!o.some(Qv)}const UY=Ct.toFlatObject(Ct,{},null,function(d){return/^is[A-Z]/.test(d)});function Km(o,d,p){if(!Ct.isObject(o))throw new TypeError("target must be an object");d=d||new FormData,p=Ct.toFlatObject(p,{metaTokens:!0,dots:!1,indexes:!1},!1,function(lt,vt){return!Ct.isUndefined(vt[lt])});const _=p.metaTokens,E=p.visitor||P,T=p.dots,R=p.indexes,D=(p.Blob||typeof Blob<"u"&&Blob)&&Ct.isSpecCompliantForm(d);if(!Ct.isFunction(E))throw new TypeError("visitor must be a function");function M(at){if(at===null)return"";if(Ct.isDate(at))return at.toISOString();if(!D&&Ct.isBlob(at))throw new cn("Blob is not supported. Use a Buffer instead.");return Ct.isArrayBuffer(at)||Ct.isTypedArray(at)?D&&typeof Blob=="function"?new Blob([at]):Buffer.from(at):at}function P(at,lt,vt){let wt=at;if(at&&!vt&&typeof at=="object"){if(Ct.endsWith(lt,"{}"))lt=_?lt:lt.slice(0,-2),at=JSON.stringify(at);else if(Ct.isArray(at)&&MY(at)||(Ct.isFileList(at)||Ct.endsWith(lt,"[]"))&&(wt=Ct.toArray(at)))return lt=Ek(lt),wt.forEach(function(Bt,Et){!(Ct.isUndefined(Bt)||Bt===null)&&d.append(R===!0?MD([lt],Et,T):R===null?lt:lt+"[]",M(Bt))}),!1}return Qv(at)?!0:(d.append(MD(vt,lt,T),M(at)),!1)}const j=[],q=Object.assign(UY,{defaultVisitor:P,convertValue:M,isVisitable:Qv});function tt(at,lt){if(!Ct.isUndefined(at)){if(j.indexOf(at)!==-1)throw Error("Circular reference detected in "+lt.join("."));j.push(at),Ct.forEach(at,function(wt,It){(!(Ct.isUndefined(wt)||wt===null)&&E.call(d,wt,Ct.isString(It)?It.trim():It,lt,q))===!0&&tt(wt,lt?lt.concat(It):[It])}),j.pop()}}if(!Ct.isObject(o))throw new TypeError("data must be an object");return tt(o),d}function UD(o){const d={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(_){return d[_]})}function Wy(o,d){this._pairs=[],o&&Km(o,this,d)}const gk=Wy.prototype;gk.append=function(d,p){this._pairs.push([d,p])};gk.toString=function(d){const p=d?function(_){return d.call(this,_,UD)}:UD;return this._pairs.map(function(E){return p(E[0])+"="+p(E[1])},"").join("&")};function xY(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Tk(o,d,p){if(!d)return o;const _=p&&p.encode||xY,E=p&&p.serialize;let T;if(E?T=E(d,p):T=Ct.isURLSearchParams(d)?d.toString():new Wy(d,p).toString(_),T){const R=o.indexOf("#");R!==-1&&(o=o.slice(0,R)),o+=(o.indexOf("?")===-1?"?":"&")+T}return o}class VY{constructor(){this.handlers=[]}use(d,p,_){return this.handlers.push({fulfilled:d,rejected:p,synchronous:_?_.synchronous:!1,runWhen:_?_.runWhen:null}),this.handlers.length-1}eject(d){this.handlers[d]&&(this.handlers[d]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(d){Ct.forEach(this.handlers,function(_){_!==null&&d(_)})}}const xD=VY,Sk={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},FY=typeof URLSearchParams<"u"?URLSearchParams:Wy,BY=typeof FormData<"u"?FormData:null,jY=typeof Blob<"u"?Blob:null,GY=(()=>{let o;return typeof navigator<"u"&&((o=navigator.product)==="ReactNative"||o==="NativeScript"||o==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),WY=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),No={isBrowser:!0,classes:{URLSearchParams:FY,FormData:BY,Blob:jY},isStandardBrowserEnv:GY,isStandardBrowserWebWorkerEnv:WY,protocols:["http","https","file","blob","url","data"]};function HY(o,d){return Km(o,new No.classes.URLSearchParams,Object.assign({visitor:function(p,_,E,T){return No.isNode&&Ct.isBuffer(p)?(this.append(_,p.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},d))}function KY(o){return Ct.matchAll(/\w+|\[(\w*)]/g,o).map(d=>d[0]==="[]"?"":d[1]||d[0])}function qY(o){const d={},p=Object.keys(o);let _;const E=p.length;let T;for(_=0;_<E;_++)T=p[_],d[T]=o[T];return d}function vk(o){function d(p,_,E,T){let R=p[T++];const N=Number.isFinite(+R),D=T>=p.length;return R=!R&&Ct.isArray(E)?E.length:R,D?(Ct.hasOwnProp(E,R)?E[R]=[E[R],_]:E[R]=_,!N):((!E[R]||!Ct.isObject(E[R]))&&(E[R]=[]),d(p,_,E[R],T)&&Ct.isArray(E[R])&&(E[R]=qY(E[R])),!N)}if(Ct.isFormData(o)&&Ct.isFunction(o.entries)){const p={};return Ct.forEachEntry(o,(_,E)=>{d(KY(_),E,p,0)}),p}return null}function YY(o,d,p){if(Ct.isString(o))try{return(d||JSON.parse)(o),Ct.trim(o)}catch(_){if(_.name!=="SyntaxError")throw _}return(p||JSON.stringify)(o)}const Hy={transitional:Sk,adapter:["xhr","http"],transformRequest:[function(d,p){const _=p.getContentType()||"",E=_.indexOf("application/json")>-1,T=Ct.isObject(d);if(T&&Ct.isHTMLForm(d)&&(d=new FormData(d)),Ct.isFormData(d))return E&&E?JSON.stringify(vk(d)):d;if(Ct.isArrayBuffer(d)||Ct.isBuffer(d)||Ct.isStream(d)||Ct.isFile(d)||Ct.isBlob(d))return d;if(Ct.isArrayBufferView(d))return d.buffer;if(Ct.isURLSearchParams(d))return p.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),d.toString();let N;if(T){if(_.indexOf("application/x-www-form-urlencoded")>-1)return HY(d,this.formSerializer).toString();if((N=Ct.isFileList(d))||_.indexOf("multipart/form-data")>-1){const D=this.env&&this.env.FormData;return Km(N?{"files[]":d}:d,D&&new D,this.formSerializer)}}return T||E?(p.setContentType("application/json",!1),YY(d)):d}],transformResponse:[function(d){const p=this.transitional||Hy.transitional,_=p&&p.forcedJSONParsing,E=this.responseType==="json";if(d&&Ct.isString(d)&&(_&&!this.responseType||E)){const R=!(p&&p.silentJSONParsing)&&E;try{return JSON.parse(d)}catch(N){if(R)throw N.name==="SyntaxError"?cn.from(N,cn.ERR_BAD_RESPONSE,this,null,this.response):N}}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:No.classes.FormData,Blob:No.classes.Blob},validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ct.forEach(["delete","get","head","post","put","patch"],o=>{Hy.headers[o]={}});const Ky=Hy,zY=Ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),JY=o=>{const d={};let p,_,E;return o&&o.split(`
`).forEach(function(R){E=R.indexOf(":"),p=R.substring(0,E).trim().toLowerCase(),_=R.substring(E+1).trim(),!(!p||d[p]&&zY[p])&&(p==="set-cookie"?d[p]?d[p].push(_):d[p]=[_]:d[p]=d[p]?d[p]+", "+_:_)}),d},VD=Symbol("internals");function Rh(o){return o&&String(o).trim().toLowerCase()}function sm(o){return o===!1||o==null?o:Ct.isArray(o)?o.map(sm):String(o)}function XY(o){const d=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=p.exec(o);)d[_[1]]=_[2];return d}const $Y=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function bv(o,d,p,_,E){if(Ct.isFunction(_))return _.call(this,d,p);if(E&&(d=p),!!Ct.isString(d)){if(Ct.isString(_))return d.indexOf(_)!==-1;if(Ct.isRegExp(_))return _.test(d)}}function QY(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(d,p,_)=>p.toUpperCase()+_)}function ZY(o,d){const p=Ct.toCamelCase(" "+d);["get","set","has"].forEach(_=>{Object.defineProperty(o,_+p,{value:function(E,T,R){return this[_].call(this,d,E,T,R)},configurable:!0})})}class qm{constructor(d){d&&this.set(d)}set(d,p,_){const E=this;function T(N,D,M){const P=Rh(D);if(!P)throw new Error("header name must be a non-empty string");const j=Ct.findKey(E,P);(!j||E[j]===void 0||M===!0||M===void 0&&E[j]!==!1)&&(E[j||D]=sm(N))}const R=(N,D)=>Ct.forEach(N,(M,P)=>T(M,P,D));return Ct.isPlainObject(d)||d instanceof this.constructor?R(d,p):Ct.isString(d)&&(d=d.trim())&&!$Y(d)?R(JY(d),p):d!=null&&T(p,d,_),this}get(d,p){if(d=Rh(d),d){const _=Ct.findKey(this,d);if(_){const E=this[_];if(!p)return E;if(p===!0)return XY(E);if(Ct.isFunction(p))return p.call(this,E,_);if(Ct.isRegExp(p))return p.exec(E);throw new TypeError("parser must be boolean|regexp|function")}}}has(d,p){if(d=Rh(d),d){const _=Ct.findKey(this,d);return!!(_&&this[_]!==void 0&&(!p||bv(this,this[_],_,p)))}return!1}delete(d,p){const _=this;let E=!1;function T(R){if(R=Rh(R),R){const N=Ct.findKey(_,R);N&&(!p||bv(_,_[N],N,p))&&(delete _[N],E=!0)}}return Ct.isArray(d)?d.forEach(T):T(d),E}clear(d){const p=Object.keys(this);let _=p.length,E=!1;for(;_--;){const T=p[_];(!d||bv(this,this[T],T,d,!0))&&(delete this[T],E=!0)}return E}normalize(d){const p=this,_={};return Ct.forEach(this,(E,T)=>{const R=Ct.findKey(_,T);if(R){p[R]=sm(E),delete p[T];return}const N=d?QY(T):String(T).trim();N!==T&&delete p[T],p[N]=sm(E),_[N]=!0}),this}concat(...d){return this.constructor.concat(this,...d)}toJSON(d){const p=Object.create(null);return Ct.forEach(this,(_,E)=>{_!=null&&_!==!1&&(p[E]=d&&Ct.isArray(_)?_.join(", "):_)}),p}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([d,p])=>d+": "+p).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(d){return d instanceof this?d:new this(d)}static concat(d,...p){const _=new this(d);return p.forEach(E=>_.set(E)),_}static accessor(d){const _=(this[VD]=this[VD]={accessors:{}}).accessors,E=this.prototype;function T(R){const N=Rh(R);_[N]||(ZY(E,R),_[N]=!0)}return Ct.isArray(d)?d.forEach(T):T(d),this}}qm.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ct.reduceDescriptors(qm.prototype,({value:o},d)=>{let p=d[0].toUpperCase()+d.slice(1);return{get:()=>o,set(_){this[p]=_}}});Ct.freezeMethods(qm);const ua=qm;function Iv(o,d){const p=this||Ky,_=d||p,E=ua.from(_.headers);let T=_.data;return Ct.forEach(o,function(N){T=N.call(p,T,E.normalize(),d?d.status:void 0)}),E.normalize(),T}function yk(o){return!!(o&&o.__CANCEL__)}function cp(o,d,p){cn.call(this,o??"canceled",cn.ERR_CANCELED,d,p),this.name="CanceledError"}Ct.inherits(cp,cn,{__CANCEL__:!0});function tz(o,d,p){const _=p.config.validateStatus;!p.status||!_||_(p.status)?o(p):d(new cn("Request failed with status code "+p.status,[cn.ERR_BAD_REQUEST,cn.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))}const ez=No.isStandardBrowserEnv?function(){return{write:function(p,_,E,T,R,N){const D=[];D.push(p+"="+encodeURIComponent(_)),Ct.isNumber(E)&&D.push("expires="+new Date(E).toGMTString()),Ct.isString(T)&&D.push("path="+T),Ct.isString(R)&&D.push("domain="+R),N===!0&&D.push("secure"),document.cookie=D.join("; ")},read:function(p){const _=document.cookie.match(new RegExp("(^|;\\s*)("+p+")=([^;]*)"));return _?decodeURIComponent(_[3]):null},remove:function(p){this.write(p,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function nz(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function iz(o,d){return d?o.replace(/\/+$/,"")+"/"+d.replace(/^\/+/,""):o}function Ck(o,d){return o&&!nz(d)?iz(o,d):d}const sz=No.isStandardBrowserEnv?function(){const d=/(msie|trident)/i.test(navigator.userAgent),p=document.createElement("a");let _;function E(T){let R=T;return d&&(p.setAttribute("href",R),R=p.href),p.setAttribute("href",R),{href:p.href,protocol:p.protocol?p.protocol.replace(/:$/,""):"",host:p.host,search:p.search?p.search.replace(/^\?/,""):"",hash:p.hash?p.hash.replace(/^#/,""):"",hostname:p.hostname,port:p.port,pathname:p.pathname.charAt(0)==="/"?p.pathname:"/"+p.pathname}}return _=E(window.location.href),function(R){const N=Ct.isString(R)?E(R):R;return N.protocol===_.protocol&&N.host===_.host}}():function(){return function(){return!0}}();function rz(o){const d=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return d&&d[1]||""}function oz(o,d){o=o||10;const p=new Array(o),_=new Array(o);let E=0,T=0,R;return d=d!==void 0?d:1e3,function(D){const M=Date.now(),P=_[T];R||(R=M),p[E]=D,_[E]=M;let j=T,q=0;for(;j!==E;)q+=p[j++],j=j%o;if(E=(E+1)%o,E===T&&(T=(T+1)%o),M-R<d)return;const tt=P&&M-P;return tt?Math.round(q*1e3/tt):void 0}}function FD(o,d){let p=0;const _=oz(50,250);return E=>{const T=E.loaded,R=E.lengthComputable?E.total:void 0,N=T-p,D=_(N),M=T<=R;p=T;const P={loaded:T,total:R,progress:R?T/R:void 0,bytes:N,rate:D||void 0,estimated:D&&R&&M?(R-T)/D:void 0,event:E};P[d?"download":"upload"]=!0,o(P)}}const az=typeof XMLHttpRequest<"u",cz=az&&function(o){return new Promise(function(p,_){let E=o.data;const T=ua.from(o.headers).normalize(),R=o.responseType;let N;function D(){o.cancelToken&&o.cancelToken.unsubscribe(N),o.signal&&o.signal.removeEventListener("abort",N)}let M;Ct.isFormData(E)&&(No.isStandardBrowserEnv||No.isStandardBrowserWebWorkerEnv?T.setContentType(!1):T.getContentType(/^\s*multipart\/form-data/)?Ct.isString(M=T.getContentType())&&T.setContentType(M.replace(/^\s*(multipart\/form-data);+/,"$1")):T.setContentType("multipart/form-data"));let P=new XMLHttpRequest;if(o.auth){const at=o.auth.username||"",lt=o.auth.password?unescape(encodeURIComponent(o.auth.password)):"";T.set("Authorization","Basic "+btoa(at+":"+lt))}const j=Ck(o.baseURL,o.url);P.open(o.method.toUpperCase(),Tk(j,o.params,o.paramsSerializer),!0),P.timeout=o.timeout;function q(){if(!P)return;const at=ua.from("getAllResponseHeaders"in P&&P.getAllResponseHeaders()),vt={data:!R||R==="text"||R==="json"?P.responseText:P.response,status:P.status,statusText:P.statusText,headers:at,config:o,request:P};tz(function(It){p(It),D()},function(It){_(It),D()},vt),P=null}if("onloadend"in P?P.onloadend=q:P.onreadystatechange=function(){!P||P.readyState!==4||P.status===0&&!(P.responseURL&&P.responseURL.indexOf("file:")===0)||setTimeout(q)},P.onabort=function(){P&&(_(new cn("Request aborted",cn.ECONNABORTED,o,P)),P=null)},P.onerror=function(){_(new cn("Network Error",cn.ERR_NETWORK,o,P)),P=null},P.ontimeout=function(){let lt=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const vt=o.transitional||Sk;o.timeoutErrorMessage&&(lt=o.timeoutErrorMessage),_(new cn(lt,vt.clarifyTimeoutError?cn.ETIMEDOUT:cn.ECONNABORTED,o,P)),P=null},No.isStandardBrowserEnv){const at=(o.withCredentials||sz(j))&&o.xsrfCookieName&&ez.read(o.xsrfCookieName);at&&T.set(o.xsrfHeaderName,at)}E===void 0&&T.setContentType(null),"setRequestHeader"in P&&Ct.forEach(T.toJSON(),function(lt,vt){P.setRequestHeader(vt,lt)}),Ct.isUndefined(o.withCredentials)||(P.withCredentials=!!o.withCredentials),R&&R!=="json"&&(P.responseType=o.responseType),typeof o.onDownloadProgress=="function"&&P.addEventListener("progress",FD(o.onDownloadProgress,!0)),typeof o.onUploadProgress=="function"&&P.upload&&P.upload.addEventListener("progress",FD(o.onUploadProgress)),(o.cancelToken||o.signal)&&(N=at=>{P&&(_(!at||at.type?new cp(null,o,P):at),P.abort(),P=null)},o.cancelToken&&o.cancelToken.subscribe(N),o.signal&&(o.signal.aborted?N():o.signal.addEventListener("abort",N)));const tt=rz(j);if(tt&&No.protocols.indexOf(tt)===-1){_(new cn("Unsupported protocol "+tt+":",cn.ERR_BAD_REQUEST,o));return}P.send(E||null)})},Zv={http:kY,xhr:cz};Ct.forEach(Zv,(o,d)=>{if(o){try{Object.defineProperty(o,"name",{value:d})}catch{}Object.defineProperty(o,"adapterName",{value:d})}});const BD=o=>`- ${o}`,dz=o=>Ct.isFunction(o)||o===null||o===!1,Rk={getAdapter:o=>{o=Ct.isArray(o)?o:[o];const{length:d}=o;let p,_;const E={};for(let T=0;T<d;T++){p=o[T];let R;if(_=p,!dz(p)&&(_=Zv[(R=String(p)).toLowerCase()],_===void 0))throw new cn(`Unknown adapter '${R}'`);if(_)break;E[R||"#"+T]=_}if(!_){const T=Object.entries(E).map(([N,D])=>`adapter ${N} `+(D===!1?"is not supported by the environment":"is not available in the build"));let R=d?T.length>1?`since :
`+T.map(BD).join(`
`):" "+BD(T[0]):"as no adapter specified";throw new cn("There is no suitable adapter to dispatch the request "+R,"ERR_NOT_SUPPORT")}return _},adapters:Zv};function Av(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new cp(null,o)}function jD(o){return Av(o),o.headers=ua.from(o.headers),o.data=Iv.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),Rk.getAdapter(o.adapter||Ky.adapter)(o).then(function(_){return Av(o),_.data=Iv.call(o,o.transformResponse,_),_.headers=ua.from(_.headers),_},function(_){return yk(_)||(Av(o),_&&_.response&&(_.response.data=Iv.call(o,o.transformResponse,_.response),_.response.headers=ua.from(_.response.headers))),Promise.reject(_)})}const GD=o=>o instanceof ua?o.toJSON():o;function Bl(o,d){d=d||{};const p={};function _(M,P,j){return Ct.isPlainObject(M)&&Ct.isPlainObject(P)?Ct.merge.call({caseless:j},M,P):Ct.isPlainObject(P)?Ct.merge({},P):Ct.isArray(P)?P.slice():P}function E(M,P,j){if(Ct.isUndefined(P)){if(!Ct.isUndefined(M))return _(void 0,M,j)}else return _(M,P,j)}function T(M,P){if(!Ct.isUndefined(P))return _(void 0,P)}function R(M,P){if(Ct.isUndefined(P)){if(!Ct.isUndefined(M))return _(void 0,M)}else return _(void 0,P)}function N(M,P,j){if(j in d)return _(M,P);if(j in o)return _(void 0,M)}const D={url:T,method:T,data:T,baseURL:R,transformRequest:R,transformResponse:R,paramsSerializer:R,timeout:R,timeoutMessage:R,withCredentials:R,adapter:R,responseType:R,xsrfCookieName:R,xsrfHeaderName:R,onUploadProgress:R,onDownloadProgress:R,decompress:R,maxContentLength:R,maxBodyLength:R,beforeRedirect:R,transport:R,httpAgent:R,httpsAgent:R,cancelToken:R,socketPath:R,responseEncoding:R,validateStatus:N,headers:(M,P)=>E(GD(M),GD(P),!0)};return Ct.forEach(Object.keys(Object.assign({},o,d)),function(P){const j=D[P]||E,q=j(o[P],d[P],P);Ct.isUndefined(q)&&j!==N||(p[P]=q)}),p}const bk="1.5.1",qy={};["object","boolean","number","function","string","symbol"].forEach((o,d)=>{qy[o]=function(_){return typeof _===o||"a"+(d<1?"n ":" ")+o}});const WD={};qy.transitional=function(d,p,_){function E(T,R){return"[Axios v"+bk+"] Transitional option '"+T+"'"+R+(_?". "+_:"")}return(T,R,N)=>{if(d===!1)throw new cn(E(R," has been removed"+(p?" in "+p:"")),cn.ERR_DEPRECATED);return p&&!WD[R]&&(WD[R]=!0,console.warn(E(R," has been deprecated since v"+p+" and will be removed in the near future"))),d?d(T,R,N):!0}};function lz(o,d,p){if(typeof o!="object")throw new cn("options must be an object",cn.ERR_BAD_OPTION_VALUE);const _=Object.keys(o);let E=_.length;for(;E-- >0;){const T=_[E],R=d[T];if(R){const N=o[T],D=N===void 0||R(N,T,o);if(D!==!0)throw new cn("option "+T+" must be "+D,cn.ERR_BAD_OPTION_VALUE);continue}if(p!==!0)throw new cn("Unknown option "+T,cn.ERR_BAD_OPTION)}}const ty={assertOptions:lz,validators:qy},ic=ty.validators;class gm{constructor(d){this.defaults=d,this.interceptors={request:new xD,response:new xD}}request(d,p){typeof d=="string"?(p=p||{},p.url=d):p=d||{},p=Bl(this.defaults,p);const{transitional:_,paramsSerializer:E,headers:T}=p;_!==void 0&&ty.assertOptions(_,{silentJSONParsing:ic.transitional(ic.boolean),forcedJSONParsing:ic.transitional(ic.boolean),clarifyTimeoutError:ic.transitional(ic.boolean)},!1),E!=null&&(Ct.isFunction(E)?p.paramsSerializer={serialize:E}:ty.assertOptions(E,{encode:ic.function,serialize:ic.function},!0)),p.method=(p.method||this.defaults.method||"get").toLowerCase();let R=T&&Ct.merge(T.common,T[p.method]);T&&Ct.forEach(["delete","get","head","post","put","patch","common"],at=>{delete T[at]}),p.headers=ua.concat(R,T);const N=[];let D=!0;this.interceptors.request.forEach(function(lt){typeof lt.runWhen=="function"&&lt.runWhen(p)===!1||(D=D&&lt.synchronous,N.unshift(lt.fulfilled,lt.rejected))});const M=[];this.interceptors.response.forEach(function(lt){M.push(lt.fulfilled,lt.rejected)});let P,j=0,q;if(!D){const at=[jD.bind(this),void 0];for(at.unshift.apply(at,N),at.push.apply(at,M),q=at.length,P=Promise.resolve(p);j<q;)P=P.then(at[j++],at[j++]);return P}q=N.length;let tt=p;for(j=0;j<q;){const at=N[j++],lt=N[j++];try{tt=at(tt)}catch(vt){lt.call(this,vt);break}}try{P=jD.call(this,tt)}catch(at){return Promise.reject(at)}for(j=0,q=M.length;j<q;)P=P.then(M[j++],M[j++]);return P}getUri(d){d=Bl(this.defaults,d);const p=Ck(d.baseURL,d.url);return Tk(p,d.params,d.paramsSerializer)}}Ct.forEach(["delete","get","head","options"],function(d){gm.prototype[d]=function(p,_){return this.request(Bl(_||{},{method:d,url:p,data:(_||{}).data}))}});Ct.forEach(["post","put","patch"],function(d){function p(_){return function(T,R,N){return this.request(Bl(N||{},{method:d,headers:_?{"Content-Type":"multipart/form-data"}:{},url:T,data:R}))}}gm.prototype[d]=p(),gm.prototype[d+"Form"]=p(!0)});const rm=gm;class Yy{constructor(d){if(typeof d!="function")throw new TypeError("executor must be a function.");let p;this.promise=new Promise(function(T){p=T});const _=this;this.promise.then(E=>{if(!_._listeners)return;let T=_._listeners.length;for(;T-- >0;)_._listeners[T](E);_._listeners=null}),this.promise.then=E=>{let T;const R=new Promise(N=>{_.subscribe(N),T=N}).then(E);return R.cancel=function(){_.unsubscribe(T)},R},d(function(T,R,N){_.reason||(_.reason=new cp(T,R,N),p(_.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]}unsubscribe(d){if(!this._listeners)return;const p=this._listeners.indexOf(d);p!==-1&&this._listeners.splice(p,1)}static source(){let d;return{token:new Yy(function(E){d=E}),cancel:d}}}const uz=Yy;function hz(o){return function(p){return o.apply(null,p)}}function pz(o){return Ct.isObject(o)&&o.isAxiosError===!0}const ey={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ey).forEach(([o,d])=>{ey[d]=o});const fz=ey;function Ik(o){const d=new rm(o),p=ak(rm.prototype.request,d);return Ct.extend(p,rm.prototype,d,{allOwnKeys:!0}),Ct.extend(p,d,null,{allOwnKeys:!0}),p.create=function(E){return Ik(Bl(o,E))},p}const Di=Ik(Ky);Di.Axios=rm;Di.CanceledError=cp;Di.CancelToken=uz;Di.isCancel=yk;Di.VERSION=bk;Di.toFormData=Km;Di.AxiosError=cn;Di.Cancel=Di.CanceledError;Di.all=function(d){return Promise.all(d)};Di.spread=hz;Di.isAxiosError=pz;Di.mergeConfig=Bl;Di.AxiosHeaders=ua;Di.formToJSON=o=>vk(Ct.isHTMLForm(o)?new FormData(o):o);Di.getAdapter=Rk.getAdapter;Di.HttpStatusCode=fz;Di.default=Di;const _z=Di;function Tm(o){return Tm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},Tm(o)}function om(o,d){if(!o.vueAxiosInstalled){var p=Ak(d)?gz(d):d;if(Tz(p)){var _=Sz(o);if(_){var E=_<3?mz:Ez;Object.keys(p).forEach(function(T){E(o,T,p[T])}),o.vueAxiosInstalled=!0}else console.error("[vue-axios] unknown Vue version")}else console.error("[vue-axios] configuration is invalid, expected options are either <axios_instance> or { <registration_key>: <axios_instance> }")}}function mz(o,d,p){Object.defineProperty(o.prototype,d,{get:function(){return p}}),o[d]=p}function Ez(o,d,p){o.config.globalProperties[d]=p,o[d]=p}function Ak(o){return o&&typeof o.get=="function"&&typeof o.post=="function"}function gz(o){return{axios:o,$http:o}}function Tz(o){return Tm(o)==="object"&&Object.keys(o).every(function(d){return Ak(o[d])})}function Sz(o){return o&&o.version&&Number(o.version.split(".")[0])}(typeof ny>"u"?"undefined":Tm(ny))=="object"?wk.exports=om:typeof define=="function"&&define.amd?define([],function(){return om}):window.Vue&&window.axios&&window.Vue.use&&Vue.use(om,window.axios);const Ed=QP(qH);Ed.use(YW());Ed.use(Zq);Ed.use(om,_z);Ed.provide("axios",Ed.config.globalProperties.axios);Ed.use($6,{});Ed.mount("#app");/*!
 * Color mode toggler for Bootstrap's docs (https://getbootstrap.com/)
 * Copyright 2011-2023 The Bootstrap Authors
 * Licensed under the Creative Commons Attribution 3.0 Unported License.
 */(()=>{const o=()=>localStorage.getItem("theme"),d=T=>localStorage.setItem("theme",T),p=()=>{const T=o();return T||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")},_=T=>{T==="auto"&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-bs-theme","dark"):document.documentElement.setAttribute("data-bs-theme",T)};_(p());const E=(T,R=!1)=>{const N=document.querySelector("#bd-theme");if(!N)return;const D=document.querySelector("#bd-theme-text"),M=document.querySelector(".theme-icon-active use"),P=document.querySelector(`[data-bs-theme-value="${T}"]`),j=P.querySelector("svg use").getAttribute("href");document.querySelectorAll("[data-bs-theme-value]").forEach(tt=>{tt.classList.remove("active"),tt.setAttribute("aria-pressed","false")}),P.classList.add("active"),P.setAttribute("aria-pressed","true"),M.setAttribute("href",j);const q=`${D.textContent} (${P.dataset.bsThemeValue})`;N.setAttribute("aria-label",q),R&&N.focus()};window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{const T=o();T!=="light"&&T!=="dark"&&_(p())}),window.addEventListener("DOMContentLoaded",()=>{E(p()),document.querySelectorAll("[data-bs-theme-value]").forEach(T=>{T.addEventListener("click",()=>{const R=T.getAttribute("data-bs-theme-value");d(R),_(R),E(R,!0)})})})})()});export default vz();
