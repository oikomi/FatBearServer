var V4=(o,d)=>()=>(d||o((d={exports:{}}).exports,d),d.exports);var Rq=V4((xv,rk)=>{(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))_(E);new MutationObserver(E=>{for(const T of E)if(T.type==="childList")for(const R of T.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&_(R)}).observe(document,{childList:!0,subtree:!0});function p(E){const T={};return E.integrity&&(T.integrity=E.integrity),E.referrerPolicy&&(T.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?T.credentials="include":E.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function _(E){if(E.ep)return;E.ep=!0;const T=p(E);fetch(E.href,T)}})();function Vv(o,d){const p=Object.create(null),_=o.split(",");for(let E=0;E<_.length;E++)p[_[E]]=!0;return d?E=>!!p[E.toLowerCase()]:E=>!!p[E]}const Wn={},Sl=[],Jr=()=>{},F4=()=>!1,B4=/^on[^a-z]/,tm=o=>B4.test(o),Fv=o=>o.startsWith("onUpdate:"),pi=Object.assign,Bv=(o,d)=>{const p=o.indexOf(d);p>-1&&o.splice(p,1)},j4=Object.prototype.hasOwnProperty,on=(o,d)=>j4.call(o,d),ye=Array.isArray,vl=o=>em(o)==="[object Map]",ID=o=>em(o)==="[object Set]",We=o=>typeof o=="function",fi=o=>typeof o=="string",jv=o=>typeof o=="symbol",Hn=o=>o!==null&&typeof o=="object",bD=o=>Hn(o)&&We(o.then)&&We(o.catch),AD=Object.prototype.toString,em=o=>AD.call(o),G4=o=>em(o).slice(8,-1),wD=o=>em(o)==="[object Object]",Gv=o=>fi(o)&&o!=="NaN"&&o[0]!=="-"&&""+parseInt(o,10)===o,w_=Vv(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),nm=o=>{const d=Object.create(null);return p=>d[p]||(d[p]=o(p))},W4=/-(\w)/g,Do=nm(o=>o.replace(W4,(d,p)=>p?p.toUpperCase():"")),H4=/\B([A-Z])/g,Ml=nm(o=>o.replace(H4,"-$1").toLowerCase()),im=nm(o=>o.charAt(0).toUpperCase()+o.slice(1)),O_=nm(o=>o?`on${im(o)}`:""),Ah=(o,d)=>!Object.is(o,d),N_=(o,d)=>{for(let p=0;p<o.length;p++)o[p](d)},W_=(o,d,p)=>{Object.defineProperty(o,d,{configurable:!0,enumerable:!1,value:p})},dv=o=>{const d=parseFloat(o);return isNaN(d)?o:d},K4=o=>{const d=fi(o)?Number(o):NaN;return isNaN(d)?o:d};let Q0;const lv=()=>Q0||(Q0=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Uh(o){if(ye(o)){const d={};for(let p=0;p<o.length;p++){const _=o[p],E=fi(_)?J4(_):Uh(_);if(E)for(const T in E)d[T]=E[T]}return d}else{if(fi(o))return o;if(Hn(o))return o}}const q4=/;(?![^(]*\))/g,Y4=/:([^]+)/,z4=/\/\*[^]*?\*\//g;function J4(o){const d={};return o.replace(z4,"").split(q4).forEach(p=>{if(p){const _=p.split(Y4);_.length>1&&(d[_[0].trim()]=_[1].trim())}}),d}function oc(o){let d="";if(fi(o))d=o;else if(ye(o))for(let p=0;p<o.length;p++){const _=oc(o[p]);_&&(d+=_+" ")}else if(Hn(o))for(const p in o)o[p]&&(d+=p+" ");return d.trim()}const X4="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",$4=Vv(X4);function OD(o){return!!o||o===""}const ND=o=>fi(o)?o:o==null?"":ye(o)||Hn(o)&&(o.toString===AD||!We(o.toString))?JSON.stringify(o,DD,2):String(o),DD=(o,d)=>d&&d.__v_isRef?DD(o,d.value):vl(d)?{[`Map(${d.size})`]:[...d.entries()].reduce((p,[_,E])=>(p[`${_} =>`]=E,p),{})}:ID(d)?{[`Set(${d.size})`]:[...d.values()]}:Hn(d)&&!ye(d)&&!wD(d)?String(d):d;let jr;class PD{constructor(d=!1){this.detached=d,this._active=!0,this.effects=[],this.cleanups=[],this.parent=jr,!d&&jr&&(this.index=(jr.scopes||(jr.scopes=[])).push(this)-1)}get active(){return this._active}run(d){if(this._active){const p=jr;try{return jr=this,d()}finally{jr=p}}}on(){jr=this}off(){jr=this.parent}stop(d){if(this._active){let p,_;for(p=0,_=this.effects.length;p<_;p++)this.effects[p].stop();for(p=0,_=this.cleanups.length;p<_;p++)this.cleanups[p]();if(this.scopes)for(p=0,_=this.scopes.length;p<_;p++)this.scopes[p].stop(!0);if(!this.detached&&this.parent&&!d){const E=this.parent.scopes.pop();E&&E!==this&&(this.parent.scopes[this.index]=E,E.index=this.index)}this.parent=void 0,this._active=!1}}}function Q4(o){return new PD(o)}function Z4(o,d=jr){d&&d.active&&d.effects.push(o)}function tG(){return jr}const Wv=o=>{const d=new Set(o);return d.w=0,d.n=0,d},LD=o=>(o.w&ac)>0,kD=o=>(o.n&ac)>0,eG=({deps:o})=>{if(o.length)for(let d=0;d<o.length;d++)o[d].w|=ac},nG=o=>{const{deps:d}=o;if(d.length){let p=0;for(let _=0;_<d.length;_++){const E=d[_];LD(E)&&!kD(E)?E.delete(o):d[p++]=E,E.w&=~ac,E.n&=~ac}d.length=p}},uv=new WeakMap;let mh=0,ac=1;const hv=30;let Wr;const nd=Symbol(""),pv=Symbol("");class Hv{constructor(d,p=null,_){this.fn=d,this.scheduler=p,this.active=!0,this.deps=[],this.parent=void 0,Z4(this,_)}run(){if(!this.active)return this.fn();let d=Wr,p=sc;for(;d;){if(d===this)return;d=d.parent}try{return this.parent=Wr,Wr=this,sc=!0,ac=1<<++mh,mh<=hv?eG(this):Z0(this),this.fn()}finally{mh<=hv&&nG(this),ac=1<<--mh,Wr=this.parent,sc=p,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Wr===this?this.deferStop=!0:this.active&&(Z0(this),this.onStop&&this.onStop(),this.active=!1)}}function Z0(o){const{deps:d}=o;if(d.length){for(let p=0;p<d.length;p++)d[p].delete(o);d.length=0}}let sc=!0;const MD=[];function Ul(){MD.push(sc),sc=!1}function xl(){const o=MD.pop();sc=o===void 0?!0:o}function Gs(o,d,p){if(sc&&Wr){let _=uv.get(o);_||uv.set(o,_=new Map);let E=_.get(p);E||_.set(p,E=Wv()),UD(E)}}function UD(o,d){let p=!1;mh<=hv?kD(o)||(o.n|=ac,p=!LD(o)):p=!o.has(Wr),p&&(o.add(Wr),Wr.deps.push(o))}function da(o,d,p,_,E,T){const R=uv.get(o);if(!R)return;let N=[];if(d==="clear")N=[...R.values()];else if(p==="length"&&ye(o)){const D=Number(_);R.forEach((x,P)=>{(P==="length"||P>=D)&&N.push(x)})}else switch(p!==void 0&&N.push(R.get(p)),d){case"add":ye(o)?Gv(p)&&N.push(R.get("length")):(N.push(R.get(nd)),vl(o)&&N.push(R.get(pv)));break;case"delete":ye(o)||(N.push(R.get(nd)),vl(o)&&N.push(R.get(pv)));break;case"set":vl(o)&&N.push(R.get(nd));break}if(N.length===1)N[0]&&fv(N[0]);else{const D=[];for(const x of N)x&&D.push(...x);fv(Wv(D))}}function fv(o,d){const p=ye(o)?o:[...o];for(const _ of p)_.computed&&tN(_);for(const _ of p)_.computed||tN(_)}function tN(o,d){(o!==Wr||o.allowRecurse)&&(o.scheduler?o.scheduler():o.run())}const iG=Vv("__proto__,__v_isRef,__isVue"),xD=new Set(Object.getOwnPropertyNames(Symbol).filter(o=>o!=="arguments"&&o!=="caller").map(o=>Symbol[o]).filter(jv)),sG=Kv(),rG=Kv(!1,!0),oG=Kv(!0),eN=aG();function aG(){const o={};return["includes","indexOf","lastIndexOf"].forEach(d=>{o[d]=function(...p){const _=an(this);for(let T=0,R=this.length;T<R;T++)Gs(_,"get",T+"");const E=_[d](...p);return E===-1||E===!1?_[d](...p.map(an)):E}}),["push","pop","shift","unshift","splice"].forEach(d=>{o[d]=function(...p){Ul();const _=an(this)[d].apply(this,p);return xl(),_}}),o}function cG(o){const d=an(this);return Gs(d,"has",o),d.hasOwnProperty(o)}function Kv(o=!1,d=!1){return function(_,E,T){if(E==="__v_isReactive")return!o;if(E==="__v_isReadonly")return o;if(E==="__v_isShallow")return d;if(E==="__v_raw"&&T===(o?d?RG:GD:d?jD:BD).get(_))return _;const R=ye(_);if(!o){if(R&&on(eN,E))return Reflect.get(eN,E,T);if(E==="hasOwnProperty")return cG}const N=Reflect.get(_,E,T);return(jv(E)?xD.has(E):iG(E))||(o||Gs(_,"get",E),d)?N:as(N)?R&&Gv(E)?N:N.value:Hn(N)?o?HD(N):rm(N):N}}const dG=VD(),lG=VD(!0);function VD(o=!1){return function(p,_,E,T){let R=p[_];if(Il(R)&&as(R)&&!as(E))return!1;if(!o&&(!H_(E)&&!Il(E)&&(R=an(R),E=an(E)),!ye(p)&&as(R)&&!as(E)))return R.value=E,!0;const N=ye(p)&&Gv(_)?Number(_)<p.length:on(p,_),D=Reflect.set(p,_,E,T);return p===an(T)&&(N?Ah(E,R)&&da(p,"set",_,E):da(p,"add",_,E)),D}}function uG(o,d){const p=on(o,d);o[d];const _=Reflect.deleteProperty(o,d);return _&&p&&da(o,"delete",d,void 0),_}function hG(o,d){const p=Reflect.has(o,d);return(!jv(d)||!xD.has(d))&&Gs(o,"has",d),p}function pG(o){return Gs(o,"iterate",ye(o)?"length":nd),Reflect.ownKeys(o)}const FD={get:sG,set:dG,deleteProperty:uG,has:hG,ownKeys:pG},fG={get:oG,set(o,d){return!0},deleteProperty(o,d){return!0}},_G=pi({},FD,{get:rG,set:lG}),qv=o=>o,sm=o=>Reflect.getPrototypeOf(o);function v_(o,d,p=!1,_=!1){o=o.__v_raw;const E=an(o),T=an(d);p||(d!==T&&Gs(E,"get",d),Gs(E,"get",T));const{has:R}=sm(E),N=_?qv:p?Xv:wh;if(R.call(E,d))return N(o.get(d));if(R.call(E,T))return N(o.get(T));o!==E&&o.get(d)}function C_(o,d=!1){const p=this.__v_raw,_=an(p),E=an(o);return d||(o!==E&&Gs(_,"has",o),Gs(_,"has",E)),o===E?p.has(o):p.has(o)||p.has(E)}function y_(o,d=!1){return o=o.__v_raw,!d&&Gs(an(o),"iterate",nd),Reflect.get(o,"size",o)}function nN(o){o=an(o);const d=an(this);return sm(d).has.call(d,o)||(d.add(o),da(d,"add",o,o)),this}function iN(o,d){d=an(d);const p=an(this),{has:_,get:E}=sm(p);let T=_.call(p,o);T||(o=an(o),T=_.call(p,o));const R=E.call(p,o);return p.set(o,d),T?Ah(d,R)&&da(p,"set",o,d):da(p,"add",o,d),this}function sN(o){const d=an(this),{has:p,get:_}=sm(d);let E=p.call(d,o);E||(o=an(o),E=p.call(d,o)),_&&_.call(d,o);const T=d.delete(o);return E&&da(d,"delete",o,void 0),T}function rN(){const o=an(this),d=o.size!==0,p=o.clear();return d&&da(o,"clear",void 0,void 0),p}function R_(o,d){return function(_,E){const T=this,R=T.__v_raw,N=an(R),D=d?qv:o?Xv:wh;return!o&&Gs(N,"iterate",nd),R.forEach((x,P)=>_.call(E,D(x),D(P),T))}}function I_(o,d,p){return function(..._){const E=this.__v_raw,T=an(E),R=vl(T),N=o==="entries"||o===Symbol.iterator&&R,D=o==="keys"&&R,x=E[o](..._),P=p?qv:d?Xv:wh;return!d&&Gs(T,"iterate",D?pv:nd),{next(){const{value:G,done:z}=x.next();return z?{value:G,done:z}:{value:N?[P(G[0]),P(G[1])]:P(G),done:z}},[Symbol.iterator](){return this}}}}function $a(o){return function(...d){return o==="delete"?!1:this}}function mG(){const o={get(T){return v_(this,T)},get size(){return y_(this)},has:C_,add:nN,set:iN,delete:sN,clear:rN,forEach:R_(!1,!1)},d={get(T){return v_(this,T,!1,!0)},get size(){return y_(this)},has:C_,add:nN,set:iN,delete:sN,clear:rN,forEach:R_(!1,!0)},p={get(T){return v_(this,T,!0)},get size(){return y_(this,!0)},has(T){return C_.call(this,T,!0)},add:$a("add"),set:$a("set"),delete:$a("delete"),clear:$a("clear"),forEach:R_(!0,!1)},_={get(T){return v_(this,T,!0,!0)},get size(){return y_(this,!0)},has(T){return C_.call(this,T,!0)},add:$a("add"),set:$a("set"),delete:$a("delete"),clear:$a("clear"),forEach:R_(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(T=>{o[T]=I_(T,!1,!1),p[T]=I_(T,!0,!1),d[T]=I_(T,!1,!0),_[T]=I_(T,!0,!0)}),[o,p,d,_]}const[EG,gG,TG,SG]=mG();function Yv(o,d){const p=d?o?SG:TG:o?gG:EG;return(_,E,T)=>E==="__v_isReactive"?!o:E==="__v_isReadonly"?o:E==="__v_raw"?_:Reflect.get(on(p,E)&&E in _?p:_,E,T)}const vG={get:Yv(!1,!1)},CG={get:Yv(!1,!0)},yG={get:Yv(!0,!1)},BD=new WeakMap,jD=new WeakMap,GD=new WeakMap,RG=new WeakMap;function IG(o){switch(o){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function bG(o){return o.__v_skip||!Object.isExtensible(o)?0:IG(G4(o))}function rm(o){return Il(o)?o:zv(o,!1,FD,vG,BD)}function WD(o){return zv(o,!1,_G,CG,jD)}function HD(o){return zv(o,!0,fG,yG,GD)}function zv(o,d,p,_,E){if(!Hn(o)||o.__v_raw&&!(d&&o.__v_isReactive))return o;const T=E.get(o);if(T)return T;const R=bG(o);if(R===0)return o;const N=new Proxy(o,R===2?_:p);return E.set(o,N),N}function Cl(o){return Il(o)?Cl(o.__v_raw):!!(o&&o.__v_isReactive)}function Il(o){return!!(o&&o.__v_isReadonly)}function H_(o){return!!(o&&o.__v_isShallow)}function KD(o){return Cl(o)||Il(o)}function an(o){const d=o&&o.__v_raw;return d?an(d):o}function Jv(o){return W_(o,"__v_skip",!0),o}const wh=o=>Hn(o)?rm(o):o,Xv=o=>Hn(o)?HD(o):o;function qD(o){sc&&Wr&&(o=an(o),UD(o.dep||(o.dep=Wv())))}function YD(o,d){o=an(o);const p=o.dep;p&&fv(p)}function as(o){return!!(o&&o.__v_isRef===!0)}function js(o){return zD(o,!1)}function AG(o){return zD(o,!0)}function zD(o,d){return as(o)?o:new wG(o,d)}class wG{constructor(d,p){this.__v_isShallow=p,this.dep=void 0,this.__v_isRef=!0,this._rawValue=p?d:an(d),this._value=p?d:wh(d)}get value(){return qD(this),this._value}set value(d){const p=this.__v_isShallow||H_(d)||Il(d);d=p?d:an(d),Ah(d,this._rawValue)&&(this._rawValue=d,this._value=p?d:wh(d),YD(this))}}function Kr(o){return as(o)?o.value:o}const OG={get:(o,d,p)=>Kr(Reflect.get(o,d,p)),set:(o,d,p,_)=>{const E=o[d];return as(E)&&!as(p)?(E.value=p,!0):Reflect.set(o,d,p,_)}};function JD(o){return Cl(o)?o:new Proxy(o,OG)}class NG{constructor(d,p,_,E){this._setter=p,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new Hv(d,()=>{this._dirty||(this._dirty=!0,YD(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!E,this.__v_isReadonly=_}get value(){const d=an(this);return qD(d),(d._dirty||!d._cacheable)&&(d._dirty=!1,d._value=d.effect.run()),d._value}set value(d){this._setter(d)}}function DG(o,d,p=!1){let _,E;const T=We(o);return T?(_=o,E=Jr):(_=o.get,E=o.set),new NG(_,E,T||!E,p)}function rc(o,d,p,_){let E;try{E=_?o(..._):o()}catch(T){om(T,d,p)}return E}function Ar(o,d,p,_){if(We(o)){const T=rc(o,d,p,_);return T&&bD(T)&&T.catch(R=>{om(R,d,p)}),T}const E=[];for(let T=0;T<o.length;T++)E.push(Ar(o[T],d,p,_));return E}function om(o,d,p,_=!0){const E=d?d.vnode:null;if(d){let T=d.parent;const R=d.proxy,N=p;for(;T;){const x=T.ec;if(x){for(let P=0;P<x.length;P++)if(x[P](o,R,N)===!1)return}T=T.parent}const D=d.appContext.config.errorHandler;if(D){rc(D,null,10,[o,R,N]);return}}PG(o,p,E,_)}function PG(o,d,p,_=!0){console.error(o)}let Oh=!1,_v=!1;const os=[];let Ao=0;const yl=[];let oa=null,Qc=0;const XD=Promise.resolve();let $v=null;function Qv(o){const d=$v||XD;return o?d.then(this?o.bind(this):o):d}function LG(o){let d=Ao+1,p=os.length;for(;d<p;){const _=d+p>>>1;Nh(os[_])<o?d=_+1:p=_}return d}function Zv(o){(!os.length||!os.includes(o,Oh&&o.allowRecurse?Ao+1:Ao))&&(o.id==null?os.push(o):os.splice(LG(o.id),0,o),$D())}function $D(){!Oh&&!_v&&(_v=!0,$v=XD.then(ZD))}function kG(o){const d=os.indexOf(o);d>Ao&&os.splice(d,1)}function MG(o){ye(o)?yl.push(...o):(!oa||!oa.includes(o,o.allowRecurse?Qc+1:Qc))&&yl.push(o),$D()}function oN(o,d=Oh?Ao+1:0){for(;d<os.length;d++){const p=os[d];p&&p.pre&&(os.splice(d,1),d--,p())}}function QD(o){if(yl.length){const d=[...new Set(yl)];if(yl.length=0,oa){oa.push(...d);return}for(oa=d,oa.sort((p,_)=>Nh(p)-Nh(_)),Qc=0;Qc<oa.length;Qc++)oa[Qc]();oa=null,Qc=0}}const Nh=o=>o.id==null?1/0:o.id,UG=(o,d)=>{const p=Nh(o)-Nh(d);if(p===0){if(o.pre&&!d.pre)return-1;if(d.pre&&!o.pre)return 1}return p};function ZD(o){_v=!1,Oh=!0,os.sort(UG);const d=Jr;try{for(Ao=0;Ao<os.length;Ao++){const p=os[Ao];p&&p.active!==!1&&rc(p,null,14)}}finally{Ao=0,os.length=0,QD(),Oh=!1,$v=null,(os.length||yl.length)&&ZD()}}function xG(o,d,...p){if(o.isUnmounted)return;const _=o.vnode.props||Wn;let E=p;const T=d.startsWith("update:"),R=T&&d.slice(7);if(R&&R in _){const P=`${R==="modelValue"?"model":R}Modifiers`,{number:G,trim:z}=_[P]||Wn;z&&(E=p.map(rt=>fi(rt)?rt.trim():rt)),G&&(E=p.map(dv))}let N,D=_[N=O_(d)]||_[N=O_(Do(d))];!D&&T&&(D=_[N=O_(Ml(d))]),D&&Ar(D,o,6,E);const x=_[N+"Once"];if(x){if(!o.emitted)o.emitted={};else if(o.emitted[N])return;o.emitted[N]=!0,Ar(x,o,6,E)}}function tP(o,d,p=!1){const _=d.emitsCache,E=_.get(o);if(E!==void 0)return E;const T=o.emits;let R={},N=!1;if(!We(o)){const D=x=>{const P=tP(x,d,!0);P&&(N=!0,pi(R,P))};!p&&d.mixins.length&&d.mixins.forEach(D),o.extends&&D(o.extends),o.mixins&&o.mixins.forEach(D)}return!T&&!N?(Hn(o)&&_.set(o,null),null):(ye(T)?T.forEach(D=>R[D]=null):pi(R,T),Hn(o)&&_.set(o,R),R)}function am(o,d){return!o||!tm(d)?!1:(d=d.slice(2).replace(/Once$/,""),on(o,d[0].toLowerCase()+d.slice(1))||on(o,Ml(d))||on(o,d))}let zi=null,cm=null;function K_(o){const d=zi;return zi=o,cm=o&&o.type.__scopeId||null,d}function VG(o){cm=o}function FG(){cm=null}function xh(o,d=zi,p){if(!d||o._n)return o;const _=(...E)=>{_._d&&gN(-1);const T=K_(d);let R;try{R=o(...E)}finally{K_(T),_._d&&gN(1)}return R};return _._n=!0,_._c=!0,_._d=!0,_}function zS(o){const{type:d,vnode:p,proxy:_,withProxy:E,props:T,propsOptions:[R],slots:N,attrs:D,emit:x,render:P,renderCache:G,data:z,setupState:rt,ctx:at,inheritAttrs:dt}=o;let bt,Ot;const Dt=K_(o);try{if(p.shapeFlag&4){const Tt=E||_;bt=bo(P.call(Tt,Tt,G,T,rt,z,at)),Ot=D}else{const Tt=d;bt=bo(Tt.length>1?Tt(T,{attrs:D,slots:N,emit:x}):Tt(T,null)),Ot=d.props?D:BG(D)}}catch(Tt){Ch.length=0,om(Tt,o,1),bt=Ni(la)}let Gt=bt;if(Ot&&dt!==!1){const Tt=Object.keys(Ot),{shapeFlag:Kt}=Gt;Tt.length&&Kt&7&&(R&&Tt.some(Fv)&&(Ot=jG(Ot,R)),Gt=rd(Gt,Ot))}return p.dirs&&(Gt=rd(Gt),Gt.dirs=Gt.dirs?Gt.dirs.concat(p.dirs):p.dirs),p.transition&&(Gt.transition=p.transition),bt=Gt,K_(Dt),bt}const BG=o=>{let d;for(const p in o)(p==="class"||p==="style"||tm(p))&&((d||(d={}))[p]=o[p]);return d},jG=(o,d)=>{const p={};for(const _ in o)(!Fv(_)||!(_.slice(9)in d))&&(p[_]=o[_]);return p};function GG(o,d,p){const{props:_,children:E,component:T}=o,{props:R,children:N,patchFlag:D}=d,x=T.emitsOptions;if(d.dirs||d.transition)return!0;if(p&&D>=0){if(D&1024)return!0;if(D&16)return _?aN(_,R,x):!!R;if(D&8){const P=d.dynamicProps;for(let G=0;G<P.length;G++){const z=P[G];if(R[z]!==_[z]&&!am(x,z))return!0}}}else return(E||N)&&(!N||!N.$stable)?!0:_===R?!1:_?R?aN(_,R,x):!0:!!R;return!1}function aN(o,d,p){const _=Object.keys(d);if(_.length!==Object.keys(o).length)return!0;for(let E=0;E<_.length;E++){const T=_[E];if(d[T]!==o[T]&&!am(p,T))return!0}return!1}function WG({vnode:o,parent:d},p){for(;d&&d.subTree===o;)(o=d.vnode).el=p,d=d.parent}const HG=o=>o.__isSuspense;function KG(o,d){d&&d.pendingBranch?ye(o)?d.effects.push(...o):d.effects.push(o):MG(o)}const b_={};function D_(o,d,p){return eP(o,d,p)}function eP(o,d,{immediate:p,deep:_,flush:E,onTrack:T,onTrigger:R}=Wn){var N;const D=tG()===((N=Bi)==null?void 0:N.scope)?Bi:null;let x,P=!1,G=!1;if(as(o)?(x=()=>o.value,P=H_(o)):Cl(o)?(x=()=>o,_=!0):ye(o)?(G=!0,P=o.some(Tt=>Cl(Tt)||H_(Tt)),x=()=>o.map(Tt=>{if(as(Tt))return Tt.value;if(Cl(Tt))return td(Tt);if(We(Tt))return rc(Tt,D,2)})):We(o)?d?x=()=>rc(o,D,2):x=()=>{if(!(D&&D.isUnmounted))return z&&z(),Ar(o,D,3,[rt])}:x=Jr,d&&_){const Tt=x;x=()=>td(Tt())}let z,rt=Tt=>{z=Dt.onStop=()=>{rc(Tt,D,4)}},at;if(Ph)if(rt=Jr,d?p&&Ar(d,D,3,[x(),G?[]:void 0,rt]):x(),E==="sync"){const Tt=x5();at=Tt.__watcherHandles||(Tt.__watcherHandles=[])}else return Jr;let dt=G?new Array(o.length).fill(b_):b_;const bt=()=>{if(Dt.active)if(d){const Tt=Dt.run();(_||P||(G?Tt.some((Kt,Zt)=>Ah(Kt,dt[Zt])):Ah(Tt,dt)))&&(z&&z(),Ar(d,D,3,[Tt,dt===b_?void 0:G&&dt[0]===b_?[]:dt,rt]),dt=Tt)}else Dt.run()};bt.allowRecurse=!!d;let Ot;E==="sync"?Ot=bt:E==="post"?Ot=()=>Bs(bt,D&&D.suspense):(bt.pre=!0,D&&(bt.id=D.uid),Ot=()=>Zv(bt));const Dt=new Hv(x,Ot);d?p?bt():dt=Dt.run():E==="post"?Bs(Dt.run.bind(Dt),D&&D.suspense):Dt.run();const Gt=()=>{Dt.stop(),D&&D.scope&&Bv(D.scope.effects,Dt)};return at&&at.push(Gt),Gt}function qG(o,d,p){const _=this.proxy,E=fi(o)?o.includes(".")?nP(_,o):()=>_[o]:o.bind(_,_);let T;We(d)?T=d:(T=d.handler,p=d);const R=Bi;bl(this);const N=eP(E,T.bind(_),p);return R?bl(R):id(),N}function nP(o,d){const p=d.split(".");return()=>{let _=o;for(let E=0;E<p.length&&_;E++)_=_[p[E]];return _}}function td(o,d){if(!Hn(o)||o.__v_skip||(d=d||new Set,d.has(o)))return o;if(d.add(o),as(o))td(o.value,d);else if(ye(o))for(let p=0;p<o.length;p++)td(o[p],d);else if(ID(o)||vl(o))o.forEach(p=>{td(p,d)});else if(wD(o))for(const p in o)td(o[p],d);return o}function Th(o,d){const p=zi;if(p===null)return o;const _=pm(p)||p.proxy,E=o.dirs||(o.dirs=[]);for(let T=0;T<d.length;T++){let[R,N,D,x=Wn]=d[T];R&&(We(R)&&(R={mounted:R,updated:R}),R.deep&&td(N),E.push({dir:R,instance:_,value:N,oldValue:void 0,arg:D,modifiers:x}))}return o}function Jc(o,d,p,_){const E=o.dirs,T=d&&d.dirs;for(let R=0;R<E.length;R++){const N=E[R];T&&(N.oldValue=T[R].value);let D=N.dir[_];D&&(Ul(),Ar(D,p,8,[o.el,N,o,d]),xl())}}function YG(){const o={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return oP(()=>{o.isMounted=!0}),cP(()=>{o.isUnmounting=!0}),o}const br=[Function,Array],zG={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:br,onEnter:br,onAfterEnter:br,onEnterCancelled:br,onBeforeLeave:br,onLeave:br,onAfterLeave:br,onLeaveCancelled:br,onBeforeAppear:br,onAppear:br,onAfterAppear:br,onAppearCancelled:br};function JG(o,d){const{leavingVNodes:p}=o;let _=p.get(d.type);return _||(_=Object.create(null),p.set(d.type,_)),_}function mv(o,d,p,_){const{appear:E,mode:T,persisted:R=!1,onBeforeEnter:N,onEnter:D,onAfterEnter:x,onEnterCancelled:P,onBeforeLeave:G,onLeave:z,onAfterLeave:rt,onLeaveCancelled:at,onBeforeAppear:dt,onAppear:bt,onAfterAppear:Ot,onAppearCancelled:Dt}=d,Gt=String(o.key),Tt=JG(p,o),Kt=($t,Ce)=>{$t&&Ar($t,_,9,Ce)},Zt=($t,Ce)=>{const _e=Ce[1];Kt($t,Ce),ye($t)?$t.every(Le=>Le.length<=1)&&_e():$t.length<=1&&_e()},me={mode:T,persisted:R,beforeEnter($t){let Ce=N;if(!p.isMounted)if(E)Ce=dt||N;else return;$t._leaveCb&&$t._leaveCb(!0);const _e=Tt[Gt];_e&&ml(o,_e)&&_e.el._leaveCb&&_e.el._leaveCb(),Kt(Ce,[$t])},enter($t){let Ce=D,_e=x,Le=P;if(!p.isMounted)if(E)Ce=bt||D,_e=Ot||x,Le=Dt||P;else return;let qt=!1;const Ee=$t._enterCb=Sn=>{qt||(qt=!0,Sn?Kt(Le,[$t]):Kt(_e,[$t]),me.delayedLeave&&me.delayedLeave(),$t._enterCb=void 0)};Ce?Zt(Ce,[$t,Ee]):Ee()},leave($t,Ce){const _e=String(o.key);if($t._enterCb&&$t._enterCb(!0),p.isUnmounting)return Ce();Kt(G,[$t]);let Le=!1;const qt=$t._leaveCb=Ee=>{Le||(Le=!0,Ce(),Ee?Kt(at,[$t]):Kt(rt,[$t]),$t._leaveCb=void 0,Tt[_e]===o&&delete Tt[_e])};Tt[_e]=o,z?Zt(z,[$t,qt]):qt()},clone($t){return mv($t,d,p,_)}};return me}function Ev(o,d){o.shapeFlag&6&&o.component?Ev(o.component.subTree,d):o.shapeFlag&128?(o.ssContent.transition=d.clone(o.ssContent),o.ssFallback.transition=d.clone(o.ssFallback)):o.transition=d}function iP(o,d=!1,p){let _=[],E=0;for(let T=0;T<o.length;T++){let R=o[T];const N=p==null?R.key:String(p)+String(R.key!=null?R.key:T);R.type===Fi?(R.patchFlag&128&&E++,_=_.concat(iP(R.children,d,N))):(d||R.type!==la)&&_.push(N!=null?rd(R,{key:N}):R)}if(E>1)for(let T=0;T<_.length;T++)_[T].patchFlag=-2;return _}function Nr(o,d){return We(o)?(()=>pi({name:o.name},d,{setup:o}))():o}const Sh=o=>!!o.type.__asyncLoader,sP=o=>o.type.__isKeepAlive;function XG(o,d){rP(o,"a",d)}function $G(o,d){rP(o,"da",d)}function rP(o,d,p=Bi){const _=o.__wdc||(o.__wdc=()=>{let E=p;for(;E;){if(E.isDeactivated)return;E=E.parent}return o()});if(dm(d,_,p),p){let E=p.parent;for(;E&&E.parent;)sP(E.parent.vnode)&&QG(_,d,p,E),E=E.parent}}function QG(o,d,p,_){const E=dm(d,o,_,!0);dP(()=>{Bv(_[d],E)},p)}function dm(o,d,p=Bi,_=!1){if(p){const E=p[o]||(p[o]=[]),T=d.__weh||(d.__weh=(...R)=>{if(p.isUnmounted)return;Ul(),bl(p);const N=Ar(d,p,o,R);return id(),xl(),N});return _?E.unshift(T):E.push(T),T}}const ha=o=>(d,p=Bi)=>(!Ph||o==="sp")&&dm(o,(..._)=>d(..._),p),ZG=ha("bm"),oP=ha("m"),t5=ha("bu"),aP=ha("u"),cP=ha("bum"),dP=ha("um"),e5=ha("sp"),n5=ha("rtg"),i5=ha("rtc");function s5(o,d=Bi){dm("ec",o,d)}const tC="components";function Rl(o,d){return uP(tC,o,!0,d)||o}const lP=Symbol.for("v-ndc");function eC(o){return fi(o)?uP(tC,o,!1)||o:o||lP}function uP(o,d,p=!0,_=!1){const E=zi||Bi;if(E){const T=E.type;if(o===tC){const N=k5(T,!1);if(N&&(N===d||N===Do(d)||N===im(Do(d))))return T}const R=cN(E[o]||T[o],d)||cN(E.appContext[o],d);return!R&&_?T:R}}function cN(o,d){return o&&(o[d]||o[Do(d)]||o[im(Do(d))])}function dN(o,d,p,_){let E;const T=p&&p[_];if(ye(o)||fi(o)){E=new Array(o.length);for(let R=0,N=o.length;R<N;R++)E[R]=d(o[R],R,void 0,T&&T[R])}else if(typeof o=="number"){E=new Array(o);for(let R=0;R<o;R++)E[R]=d(R+1,R,void 0,T&&T[R])}else if(Hn(o))if(o[Symbol.iterator])E=Array.from(o,(R,N)=>d(R,N,void 0,T&&T[N]));else{const R=Object.keys(o);E=new Array(R.length);for(let N=0,D=R.length;N<D;N++){const x=R[N];E[N]=d(o[x],x,N,T&&T[N])}}else E=[];return p&&(p[_]=E),E}function r5(o,d,p={},_,E){if(zi.isCE||zi.parent&&Sh(zi.parent)&&zi.parent.isCE)return d!=="default"&&(p.name=d),Ni("slot",p,_&&_());let T=o[d];T&&T._c&&(T._d=!1),Pn();const R=T&&hP(T(p)),N=Yr(Fi,{key:p.key||R&&R.key||`_${d}`},R||(_?_():[]),R&&o._===1?64:-2);return!E&&N.scopeId&&(N.slotScopeIds=[N.scopeId+"-s"]),T&&T._c&&(T._d=!0),N}function hP(o){return o.some(d=>z_(d)?!(d.type===la||d.type===Fi&&!hP(d.children)):!0)?o:null}function o5(o,d){const p={};for(const _ in o)p[d&&/[A-Z]/.test(_)?`on:${_}`:O_(_)]=o[_];return p}const gv=o=>o?RP(o)?pm(o)||o.proxy:gv(o.parent):null,vh=pi(Object.create(null),{$:o=>o,$el:o=>o.vnode.el,$data:o=>o.data,$props:o=>o.props,$attrs:o=>o.attrs,$slots:o=>o.slots,$refs:o=>o.refs,$parent:o=>gv(o.parent),$root:o=>gv(o.root),$emit:o=>o.emit,$options:o=>nC(o),$forceUpdate:o=>o.f||(o.f=()=>Zv(o.update)),$nextTick:o=>o.n||(o.n=Qv.bind(o.proxy)),$watch:o=>qG.bind(o)}),JS=(o,d)=>o!==Wn&&!o.__isScriptSetup&&on(o,d),a5={get({_:o},d){const{ctx:p,setupState:_,data:E,props:T,accessCache:R,type:N,appContext:D}=o;let x;if(d[0]!=="$"){const rt=R[d];if(rt!==void 0)switch(rt){case 1:return _[d];case 2:return E[d];case 4:return p[d];case 3:return T[d]}else{if(JS(_,d))return R[d]=1,_[d];if(E!==Wn&&on(E,d))return R[d]=2,E[d];if((x=o.propsOptions[0])&&on(x,d))return R[d]=3,T[d];if(p!==Wn&&on(p,d))return R[d]=4,p[d];Tv&&(R[d]=0)}}const P=vh[d];let G,z;if(P)return d==="$attrs"&&Gs(o,"get",d),P(o);if((G=N.__cssModules)&&(G=G[d]))return G;if(p!==Wn&&on(p,d))return R[d]=4,p[d];if(z=D.config.globalProperties,on(z,d))return z[d]},set({_:o},d,p){const{data:_,setupState:E,ctx:T}=o;return JS(E,d)?(E[d]=p,!0):_!==Wn&&on(_,d)?(_[d]=p,!0):on(o.props,d)||d[0]==="$"&&d.slice(1)in o?!1:(T[d]=p,!0)},has({_:{data:o,setupState:d,accessCache:p,ctx:_,appContext:E,propsOptions:T}},R){let N;return!!p[R]||o!==Wn&&on(o,R)||JS(d,R)||(N=T[0])&&on(N,R)||on(_,R)||on(vh,R)||on(E.config.globalProperties,R)},defineProperty(o,d,p){return p.get!=null?o._.accessCache[d]=0:on(p,"value")&&this.set(o,d,p.value,null),Reflect.defineProperty(o,d,p)}};function lN(o){return ye(o)?o.reduce((d,p)=>(d[p]=null,d),{}):o}let Tv=!0;function c5(o){const d=nC(o),p=o.proxy,_=o.ctx;Tv=!1,d.beforeCreate&&uN(d.beforeCreate,o,"bc");const{data:E,computed:T,methods:R,watch:N,provide:D,inject:x,created:P,beforeMount:G,mounted:z,beforeUpdate:rt,updated:at,activated:dt,deactivated:bt,beforeDestroy:Ot,beforeUnmount:Dt,destroyed:Gt,unmounted:Tt,render:Kt,renderTracked:Zt,renderTriggered:me,errorCaptured:$t,serverPrefetch:Ce,expose:_e,inheritAttrs:Le,components:qt,directives:Ee,filters:Sn}=d;if(x&&d5(x,_,null),R)for(const Ne in R){const Ve=R[Ne];We(Ve)&&(_[Ne]=Ve.bind(p))}if(E){const Ne=E.call(p,p);Hn(Ne)&&(o.data=rm(Ne))}if(Tv=!0,T)for(const Ne in T){const Ve=T[Ne],Zn=We(Ve)?Ve.bind(p,p):We(Ve.get)?Ve.get.bind(p,p):Jr,_i=!We(Ve)&&We(Ve.set)?Ve.set.bind(p):Jr,Ii=Hr({get:Zn,set:_i});Object.defineProperty(_,Ne,{enumerable:!0,configurable:!0,get:()=>Ii.value,set:Ln=>Ii.value=Ln})}if(N)for(const Ne in N)pP(N[Ne],_,p,Ne);if(D){const Ne=We(D)?D.call(p):D;Reflect.ownKeys(Ne).forEach(Ve=>{P_(Ve,Ne[Ve])})}P&&uN(P,o,"c");function xe(Ne,Ve){ye(Ve)?Ve.forEach(Zn=>Ne(Zn.bind(p))):Ve&&Ne(Ve.bind(p))}if(xe(ZG,G),xe(oP,z),xe(t5,rt),xe(aP,at),xe(XG,dt),xe($G,bt),xe(s5,$t),xe(i5,Zt),xe(n5,me),xe(cP,Dt),xe(dP,Tt),xe(e5,Ce),ye(_e))if(_e.length){const Ne=o.exposed||(o.exposed={});_e.forEach(Ve=>{Object.defineProperty(Ne,Ve,{get:()=>p[Ve],set:Zn=>p[Ve]=Zn})})}else o.exposed||(o.exposed={});Kt&&o.render===Jr&&(o.render=Kt),Le!=null&&(o.inheritAttrs=Le),qt&&(o.components=qt),Ee&&(o.directives=Ee)}function d5(o,d,p=Jr){ye(o)&&(o=Sv(o));for(const _ in o){const E=o[_];let T;Hn(E)?"default"in E?T=dr(E.from||_,E.default,!0):T=dr(E.from||_):T=dr(E),as(T)?Object.defineProperty(d,_,{enumerable:!0,configurable:!0,get:()=>T.value,set:R=>T.value=R}):d[_]=T}}function uN(o,d,p){Ar(ye(o)?o.map(_=>_.bind(d.proxy)):o.bind(d.proxy),d,p)}function pP(o,d,p,_){const E=_.includes(".")?nP(p,_):()=>p[_];if(fi(o)){const T=d[o];We(T)&&D_(E,T)}else if(We(o))D_(E,o.bind(p));else if(Hn(o))if(ye(o))o.forEach(T=>pP(T,d,p,_));else{const T=We(o.handler)?o.handler.bind(p):d[o.handler];We(T)&&D_(E,T,o)}}function nC(o){const d=o.type,{mixins:p,extends:_}=d,{mixins:E,optionsCache:T,config:{optionMergeStrategies:R}}=o.appContext,N=T.get(d);let D;return N?D=N:!E.length&&!p&&!_?D=d:(D={},E.length&&E.forEach(x=>q_(D,x,R,!0)),q_(D,d,R)),Hn(d)&&T.set(d,D),D}function q_(o,d,p,_=!1){const{mixins:E,extends:T}=d;T&&q_(o,T,p,!0),E&&E.forEach(R=>q_(o,R,p,!0));for(const R in d)if(!(_&&R==="expose")){const N=l5[R]||p&&p[R];o[R]=N?N(o[R],d[R]):d[R]}return o}const l5={data:hN,props:pN,emits:pN,methods:Eh,computed:Eh,beforeCreate:Es,created:Es,beforeMount:Es,mounted:Es,beforeUpdate:Es,updated:Es,beforeDestroy:Es,beforeUnmount:Es,destroyed:Es,unmounted:Es,activated:Es,deactivated:Es,errorCaptured:Es,serverPrefetch:Es,components:Eh,directives:Eh,watch:h5,provide:hN,inject:u5};function hN(o,d){return d?o?function(){return pi(We(o)?o.call(this,this):o,We(d)?d.call(this,this):d)}:d:o}function u5(o,d){return Eh(Sv(o),Sv(d))}function Sv(o){if(ye(o)){const d={};for(let p=0;p<o.length;p++)d[o[p]]=o[p];return d}return o}function Es(o,d){return o?[...new Set([].concat(o,d))]:d}function Eh(o,d){return o?pi(Object.create(null),o,d):d}function pN(o,d){return o?ye(o)&&ye(d)?[...new Set([...o,...d])]:pi(Object.create(null),lN(o),lN(d??{})):d}function h5(o,d){if(!o)return d;if(!d)return o;const p=pi(Object.create(null),o);for(const _ in d)p[_]=Es(o[_],d[_]);return p}function fP(){return{app:null,config:{isNativeTag:F4,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let p5=0;function f5(o,d){return function(_,E=null){We(_)||(_=pi({},_)),E!=null&&!Hn(E)&&(E=null);const T=fP(),R=new Set;let N=!1;const D=T.app={_uid:p5++,_component:_,_props:E,_container:null,_context:T,_instance:null,version:V5,get config(){return T.config},set config(x){},use(x,...P){return R.has(x)||(x&&We(x.install)?(R.add(x),x.install(D,...P)):We(x)&&(R.add(x),x(D,...P))),D},mixin(x){return T.mixins.includes(x)||T.mixins.push(x),D},component(x,P){return P?(T.components[x]=P,D):T.components[x]},directive(x,P){return P?(T.directives[x]=P,D):T.directives[x]},mount(x,P,G){if(!N){const z=Ni(_,E);return z.appContext=T,P&&d?d(z,x):o(z,x,G),N=!0,D._container=x,x.__vue_app__=D,pm(z.component)||z.component.proxy}},unmount(){N&&(o(null,D._container),delete D._container.__vue_app__)},provide(x,P){return T.provides[x]=P,D},runWithContext(x){Y_=D;try{return x()}finally{Y_=null}}};return D}}let Y_=null;function P_(o,d){if(Bi){let p=Bi.provides;const _=Bi.parent&&Bi.parent.provides;_===p&&(p=Bi.provides=Object.create(_)),p[o]=d}}function dr(o,d,p=!1){const _=Bi||zi;if(_||Y_){const E=_?_.parent==null?_.vnode.appContext&&_.vnode.appContext.provides:_.parent.provides:Y_._context.provides;if(E&&o in E)return E[o];if(arguments.length>1)return p&&We(d)?d.call(_&&_.proxy):d}}function _5(o,d,p,_=!1){const E={},T={};W_(T,um,1),o.propsDefaults=Object.create(null),_P(o,d,E,T);for(const R in o.propsOptions[0])R in E||(E[R]=void 0);p?o.props=_?E:WD(E):o.type.props?o.props=E:o.props=T,o.attrs=T}function m5(o,d,p,_){const{props:E,attrs:T,vnode:{patchFlag:R}}=o,N=an(E),[D]=o.propsOptions;let x=!1;if((_||R>0)&&!(R&16)){if(R&8){const P=o.vnode.dynamicProps;for(let G=0;G<P.length;G++){let z=P[G];if(am(o.emitsOptions,z))continue;const rt=d[z];if(D)if(on(T,z))rt!==T[z]&&(T[z]=rt,x=!0);else{const at=Do(z);E[at]=vv(D,N,at,rt,o,!1)}else rt!==T[z]&&(T[z]=rt,x=!0)}}}else{_P(o,d,E,T)&&(x=!0);let P;for(const G in N)(!d||!on(d,G)&&((P=Ml(G))===G||!on(d,P)))&&(D?p&&(p[G]!==void 0||p[P]!==void 0)&&(E[G]=vv(D,N,G,void 0,o,!0)):delete E[G]);if(T!==N)for(const G in T)(!d||!on(d,G))&&(delete T[G],x=!0)}x&&da(o,"set","$attrs")}function _P(o,d,p,_){const[E,T]=o.propsOptions;let R=!1,N;if(d)for(let D in d){if(w_(D))continue;const x=d[D];let P;E&&on(E,P=Do(D))?!T||!T.includes(P)?p[P]=x:(N||(N={}))[P]=x:am(o.emitsOptions,D)||(!(D in _)||x!==_[D])&&(_[D]=x,R=!0)}if(T){const D=an(p),x=N||Wn;for(let P=0;P<T.length;P++){const G=T[P];p[G]=vv(E,D,G,x[G],o,!on(x,G))}}return R}function vv(o,d,p,_,E,T){const R=o[p];if(R!=null){const N=on(R,"default");if(N&&_===void 0){const D=R.default;if(R.type!==Function&&!R.skipFactory&&We(D)){const{propsDefaults:x}=E;p in x?_=x[p]:(bl(E),_=x[p]=D.call(null,d),id())}else _=D}R[0]&&(T&&!N?_=!1:R[1]&&(_===""||_===Ml(p))&&(_=!0))}return _}function mP(o,d,p=!1){const _=d.propsCache,E=_.get(o);if(E)return E;const T=o.props,R={},N=[];let D=!1;if(!We(o)){const P=G=>{D=!0;const[z,rt]=mP(G,d,!0);pi(R,z),rt&&N.push(...rt)};!p&&d.mixins.length&&d.mixins.forEach(P),o.extends&&P(o.extends),o.mixins&&o.mixins.forEach(P)}if(!T&&!D)return Hn(o)&&_.set(o,Sl),Sl;if(ye(T))for(let P=0;P<T.length;P++){const G=Do(T[P]);fN(G)&&(R[G]=Wn)}else if(T)for(const P in T){const G=Do(P);if(fN(G)){const z=T[P],rt=R[G]=ye(z)||We(z)?{type:z}:pi({},z);if(rt){const at=EN(Boolean,rt.type),dt=EN(String,rt.type);rt[0]=at>-1,rt[1]=dt<0||at<dt,(at>-1||on(rt,"default"))&&N.push(G)}}}const x=[R,N];return Hn(o)&&_.set(o,x),x}function fN(o){return o[0]!=="$"}function _N(o){const d=o&&o.toString().match(/^\s*(function|class) (\w+)/);return d?d[2]:o===null?"null":""}function mN(o,d){return _N(o)===_N(d)}function EN(o,d){return ye(d)?d.findIndex(p=>mN(p,o)):We(d)&&mN(d,o)?0:-1}const EP=o=>o[0]==="_"||o==="$stable",iC=o=>ye(o)?o.map(bo):[bo(o)],E5=(o,d,p)=>{if(d._n)return d;const _=xh((...E)=>iC(d(...E)),p);return _._c=!1,_},gP=(o,d,p)=>{const _=o._ctx;for(const E in o){if(EP(E))continue;const T=o[E];if(We(T))d[E]=E5(E,T,_);else if(T!=null){const R=iC(T);d[E]=()=>R}}},TP=(o,d)=>{const p=iC(d);o.slots.default=()=>p},g5=(o,d)=>{if(o.vnode.shapeFlag&32){const p=d._;p?(o.slots=an(d),W_(d,"_",p)):gP(d,o.slots={})}else o.slots={},d&&TP(o,d);W_(o.slots,um,1)},T5=(o,d,p)=>{const{vnode:_,slots:E}=o;let T=!0,R=Wn;if(_.shapeFlag&32){const N=d._;N?p&&N===1?T=!1:(pi(E,d),!p&&N===1&&delete E._):(T=!d.$stable,gP(d,E)),R=d}else d&&(TP(o,d),R={default:1});if(T)for(const N in E)!EP(N)&&!(N in R)&&delete E[N]};function Cv(o,d,p,_,E=!1){if(ye(o)){o.forEach((z,rt)=>Cv(z,d&&(ye(d)?d[rt]:d),p,_,E));return}if(Sh(_)&&!E)return;const T=_.shapeFlag&4?pm(_.component)||_.component.proxy:_.el,R=E?null:T,{i:N,r:D}=o,x=d&&d.r,P=N.refs===Wn?N.refs={}:N.refs,G=N.setupState;if(x!=null&&x!==D&&(fi(x)?(P[x]=null,on(G,x)&&(G[x]=null)):as(x)&&(x.value=null)),We(D))rc(D,N,12,[R,P]);else{const z=fi(D),rt=as(D);if(z||rt){const at=()=>{if(o.f){const dt=z?on(G,D)?G[D]:P[D]:D.value;E?ye(dt)&&Bv(dt,T):ye(dt)?dt.includes(T)||dt.push(T):z?(P[D]=[T],on(G,D)&&(G[D]=P[D])):(D.value=[T],o.k&&(P[o.k]=D.value))}else z?(P[D]=R,on(G,D)&&(G[D]=R)):rt&&(D.value=R,o.k&&(P[o.k]=R))};R?(at.id=-1,Bs(at,p)):at()}}}const Bs=KG;function S5(o){return v5(o)}function v5(o,d){const p=lv();p.__VUE__=!0;const{insert:_,remove:E,patchProp:T,createElement:R,createText:N,createComment:D,setText:x,setElementText:P,parentNode:G,nextSibling:z,setScopeId:rt=Jr,insertStaticContent:at}=o,dt=(H,Y,st,ft=null,mt=null,Rt=null,Wt=!1,Nt=null,Mt=!!Y.dynamicChildren)=>{if(H===Y)return;H&&!ml(H,Y)&&(ft=pt(H),Ln(H,mt,Rt,!0),H=null),Y.patchFlag===-2&&(Mt=!1,Y.dynamicChildren=null);const{type:It,ref:ne,shapeFlag:zt}=Y;switch(It){case lm:bt(H,Y,st,ft);break;case la:Ot(H,Y,st,ft);break;case L_:H==null&&Dt(Y,st,ft,Wt);break;case Fi:qt(H,Y,st,ft,mt,Rt,Wt,Nt,Mt);break;default:zt&1?Kt(H,Y,st,ft,mt,Rt,Wt,Nt,Mt):zt&6?Ee(H,Y,st,ft,mt,Rt,Wt,Nt,Mt):(zt&64||zt&128)&&It.process(H,Y,st,ft,mt,Rt,Wt,Nt,Mt,Lt)}ne!=null&&mt&&Cv(ne,H&&H.ref,Rt,Y||H,!Y)},bt=(H,Y,st,ft)=>{if(H==null)_(Y.el=N(Y.children),st,ft);else{const mt=Y.el=H.el;Y.children!==H.children&&x(mt,Y.children)}},Ot=(H,Y,st,ft)=>{H==null?_(Y.el=D(Y.children||""),st,ft):Y.el=H.el},Dt=(H,Y,st,ft)=>{[H.el,H.anchor]=at(H.children,Y,st,ft,H.el,H.anchor)},Gt=({el:H,anchor:Y},st,ft)=>{let mt;for(;H&&H!==Y;)mt=z(H),_(H,st,ft),H=mt;_(Y,st,ft)},Tt=({el:H,anchor:Y})=>{let st;for(;H&&H!==Y;)st=z(H),E(H),H=st;E(Y)},Kt=(H,Y,st,ft,mt,Rt,Wt,Nt,Mt)=>{Wt=Wt||Y.type==="svg",H==null?Zt(Y,st,ft,mt,Rt,Wt,Nt,Mt):Ce(H,Y,mt,Rt,Wt,Nt,Mt)},Zt=(H,Y,st,ft,mt,Rt,Wt,Nt)=>{let Mt,It;const{type:ne,props:zt,shapeFlag:ie,transition:fe,dirs:Ae}=H;if(Mt=H.el=R(H.type,Rt,zt&&zt.is,zt),ie&8?P(Mt,H.children):ie&16&&$t(H.children,Mt,null,ft,mt,Rt&&ne!=="foreignObject",Wt,Nt),Ae&&Jc(H,null,ft,"created"),me(Mt,H,H.scopeId,Wt,ft),zt){for(const se in zt)se!=="value"&&!w_(se)&&T(Mt,se,null,zt[se],Rt,H.children,ft,mt,mn);"value"in zt&&T(Mt,"value",null,zt.value),(It=zt.onVnodeBeforeMount)&&Io(It,ft,H)}Ae&&Jc(H,null,ft,"beforeMount");const Xe=(!mt||mt&&!mt.pendingBranch)&&fe&&!fe.persisted;Xe&&fe.beforeEnter(Mt),_(Mt,Y,st),((It=zt&&zt.onVnodeMounted)||Xe||Ae)&&Bs(()=>{It&&Io(It,ft,H),Xe&&fe.enter(Mt),Ae&&Jc(H,null,ft,"mounted")},mt)},me=(H,Y,st,ft,mt)=>{if(st&&rt(H,st),ft)for(let Rt=0;Rt<ft.length;Rt++)rt(H,ft[Rt]);if(mt){let Rt=mt.subTree;if(Y===Rt){const Wt=mt.vnode;me(H,Wt,Wt.scopeId,Wt.slotScopeIds,mt.parent)}}},$t=(H,Y,st,ft,mt,Rt,Wt,Nt,Mt=0)=>{for(let It=Mt;It<H.length;It++){const ne=H[It]=Nt?nc(H[It]):bo(H[It]);dt(null,ne,Y,st,ft,mt,Rt,Wt,Nt)}},Ce=(H,Y,st,ft,mt,Rt,Wt)=>{const Nt=Y.el=H.el;let{patchFlag:Mt,dynamicChildren:It,dirs:ne}=Y;Mt|=H.patchFlag&16;const zt=H.props||Wn,ie=Y.props||Wn;let fe;st&&Xc(st,!1),(fe=ie.onVnodeBeforeUpdate)&&Io(fe,st,Y,H),ne&&Jc(Y,H,st,"beforeUpdate"),st&&Xc(st,!0);const Ae=mt&&Y.type!=="foreignObject";if(It?_e(H.dynamicChildren,It,Nt,st,ft,Ae,Rt):Wt||Ve(H,Y,Nt,null,st,ft,Ae,Rt,!1),Mt>0){if(Mt&16)Le(Nt,Y,zt,ie,st,ft,mt);else if(Mt&2&&zt.class!==ie.class&&T(Nt,"class",null,ie.class,mt),Mt&4&&T(Nt,"style",zt.style,ie.style,mt),Mt&8){const Xe=Y.dynamicProps;for(let se=0;se<Xe.length;se++){const vn=Xe[se],Ei=zt[vn],Ji=ie[vn];(Ji!==Ei||vn==="value")&&T(Nt,vn,Ei,Ji,mt,H.children,st,ft,mn)}}Mt&1&&H.children!==Y.children&&P(Nt,Y.children)}else!Wt&&It==null&&Le(Nt,Y,zt,ie,st,ft,mt);((fe=ie.onVnodeUpdated)||ne)&&Bs(()=>{fe&&Io(fe,st,Y,H),ne&&Jc(Y,H,st,"updated")},ft)},_e=(H,Y,st,ft,mt,Rt,Wt)=>{for(let Nt=0;Nt<Y.length;Nt++){const Mt=H[Nt],It=Y[Nt],ne=Mt.el&&(Mt.type===Fi||!ml(Mt,It)||Mt.shapeFlag&70)?G(Mt.el):st;dt(Mt,It,ne,null,ft,mt,Rt,Wt,!0)}},Le=(H,Y,st,ft,mt,Rt,Wt)=>{if(st!==ft){if(st!==Wn)for(const Nt in st)!w_(Nt)&&!(Nt in ft)&&T(H,Nt,st[Nt],null,Wt,Y.children,mt,Rt,mn);for(const Nt in ft){if(w_(Nt))continue;const Mt=ft[Nt],It=st[Nt];Mt!==It&&Nt!=="value"&&T(H,Nt,It,Mt,Wt,Y.children,mt,Rt,mn)}"value"in ft&&T(H,"value",st.value,ft.value)}},qt=(H,Y,st,ft,mt,Rt,Wt,Nt,Mt)=>{const It=Y.el=H?H.el:N(""),ne=Y.anchor=H?H.anchor:N("");let{patchFlag:zt,dynamicChildren:ie,slotScopeIds:fe}=Y;fe&&(Nt=Nt?Nt.concat(fe):fe),H==null?(_(It,st,ft),_(ne,st,ft),$t(Y.children,st,ne,mt,Rt,Wt,Nt,Mt)):zt>0&&zt&64&&ie&&H.dynamicChildren?(_e(H.dynamicChildren,ie,st,mt,Rt,Wt,Nt),(Y.key!=null||mt&&Y===mt.subTree)&&SP(H,Y,!0)):Ve(H,Y,st,ne,mt,Rt,Wt,Nt,Mt)},Ee=(H,Y,st,ft,mt,Rt,Wt,Nt,Mt)=>{Y.slotScopeIds=Nt,H==null?Y.shapeFlag&512?mt.ctx.activate(Y,st,ft,Wt,Mt):Sn(Y,st,ft,mt,Rt,Wt,Mt):Qn(H,Y,Mt)},Sn=(H,Y,st,ft,mt,Rt,Wt)=>{const Nt=H.component=O5(H,ft,mt);if(sP(H)&&(Nt.ctx.renderer=Lt),N5(Nt),Nt.asyncDep){if(mt&&mt.registerDep(Nt,xe),!H.el){const Mt=Nt.subTree=Ni(la);Ot(null,Mt,Y,st)}return}xe(Nt,H,Y,st,mt,Rt,Wt)},Qn=(H,Y,st)=>{const ft=Y.component=H.component;if(GG(H,Y,st))if(ft.asyncDep&&!ft.asyncResolved){Ne(ft,Y,st);return}else ft.next=Y,kG(ft.update),ft.update();else Y.el=H.el,ft.vnode=Y},xe=(H,Y,st,ft,mt,Rt,Wt)=>{const Nt=()=>{if(H.isMounted){let{next:ne,bu:zt,u:ie,parent:fe,vnode:Ae}=H,Xe=ne,se;Xc(H,!1),ne?(ne.el=Ae.el,Ne(H,ne,Wt)):ne=Ae,zt&&N_(zt),(se=ne.props&&ne.props.onVnodeBeforeUpdate)&&Io(se,fe,ne,Ae),Xc(H,!0);const vn=zS(H),Ei=H.subTree;H.subTree=vn,dt(Ei,vn,G(Ei.el),pt(Ei),H,mt,Rt),ne.el=vn.el,Xe===null&&WG(H,vn.el),ie&&Bs(ie,mt),(se=ne.props&&ne.props.onVnodeUpdated)&&Bs(()=>Io(se,fe,ne,Ae),mt)}else{let ne;const{el:zt,props:ie}=Y,{bm:fe,m:Ae,parent:Xe}=H,se=Sh(Y);if(Xc(H,!1),fe&&N_(fe),!se&&(ne=ie&&ie.onVnodeBeforeMount)&&Io(ne,Xe,Y),Xc(H,!0),zt&&kt){const vn=()=>{H.subTree=zS(H),kt(zt,H.subTree,H,mt,null)};se?Y.type.__asyncLoader().then(()=>!H.isUnmounted&&vn()):vn()}else{const vn=H.subTree=zS(H);dt(null,vn,st,ft,H,mt,Rt),Y.el=vn.el}if(Ae&&Bs(Ae,mt),!se&&(ne=ie&&ie.onVnodeMounted)){const vn=Y;Bs(()=>Io(ne,Xe,vn),mt)}(Y.shapeFlag&256||Xe&&Sh(Xe.vnode)&&Xe.vnode.shapeFlag&256)&&H.a&&Bs(H.a,mt),H.isMounted=!0,Y=st=ft=null}},Mt=H.effect=new Hv(Nt,()=>Zv(It),H.scope),It=H.update=()=>Mt.run();It.id=H.uid,Xc(H,!0),It()},Ne=(H,Y,st)=>{Y.component=H;const ft=H.vnode.props;H.vnode=Y,H.next=null,m5(H,Y.props,ft,st),T5(H,Y.children,st),Ul(),oN(),xl()},Ve=(H,Y,st,ft,mt,Rt,Wt,Nt,Mt=!1)=>{const It=H&&H.children,ne=H?H.shapeFlag:0,zt=Y.children,{patchFlag:ie,shapeFlag:fe}=Y;if(ie>0){if(ie&128){_i(It,zt,st,ft,mt,Rt,Wt,Nt,Mt);return}else if(ie&256){Zn(It,zt,st,ft,mt,Rt,Wt,Nt,Mt);return}}fe&8?(ne&16&&mn(It,mt,Rt),zt!==It&&P(st,zt)):ne&16?fe&16?_i(It,zt,st,ft,mt,Rt,Wt,Nt,Mt):mn(It,mt,Rt,!0):(ne&8&&P(st,""),fe&16&&$t(zt,st,ft,mt,Rt,Wt,Nt,Mt))},Zn=(H,Y,st,ft,mt,Rt,Wt,Nt,Mt)=>{H=H||Sl,Y=Y||Sl;const It=H.length,ne=Y.length,zt=Math.min(It,ne);let ie;for(ie=0;ie<zt;ie++){const fe=Y[ie]=Mt?nc(Y[ie]):bo(Y[ie]);dt(H[ie],fe,st,null,mt,Rt,Wt,Nt,Mt)}It>ne?mn(H,mt,Rt,!0,!1,zt):$t(Y,st,ft,mt,Rt,Wt,Nt,Mt,zt)},_i=(H,Y,st,ft,mt,Rt,Wt,Nt,Mt)=>{let It=0;const ne=Y.length;let zt=H.length-1,ie=ne-1;for(;It<=zt&&It<=ie;){const fe=H[It],Ae=Y[It]=Mt?nc(Y[It]):bo(Y[It]);if(ml(fe,Ae))dt(fe,Ae,st,null,mt,Rt,Wt,Nt,Mt);else break;It++}for(;It<=zt&&It<=ie;){const fe=H[zt],Ae=Y[ie]=Mt?nc(Y[ie]):bo(Y[ie]);if(ml(fe,Ae))dt(fe,Ae,st,null,mt,Rt,Wt,Nt,Mt);else break;zt--,ie--}if(It>zt){if(It<=ie){const fe=ie+1,Ae=fe<ne?Y[fe].el:ft;for(;It<=ie;)dt(null,Y[It]=Mt?nc(Y[It]):bo(Y[It]),st,Ae,mt,Rt,Wt,Nt,Mt),It++}}else if(It>ie)for(;It<=zt;)Ln(H[It],mt,Rt,!0),It++;else{const fe=It,Ae=It,Xe=new Map;for(It=Ae;It<=ie;It++){const En=Y[It]=Mt?nc(Y[It]):bo(Y[It]);En.key!=null&&Xe.set(En.key,It)}let se,vn=0;const Ei=ie-Ae+1;let Ji=!1,Ws=0;const pr=new Array(Ei);for(It=0;It<Ei;It++)pr[It]=0;for(It=fe;It<=zt;It++){const En=H[It];if(vn>=Ei){Ln(En,mt,Rt,!0);continue}let ji;if(En.key!=null)ji=Xe.get(En.key);else for(se=Ae;se<=ie;se++)if(pr[se-Ae]===0&&ml(En,Y[se])){ji=se;break}ji===void 0?Ln(En,mt,Rt,!0):(pr[ji-Ae]=It+1,ji>=Ws?Ws=ji:Ji=!0,dt(En,Y[ji],st,null,mt,Rt,Wt,Nt,Mt),vn++)}const Cn=Ji?C5(pr):Sl;for(se=Cn.length-1,It=Ei-1;It>=0;It--){const En=Ae+It,ji=Y[En],ti=En+1<ne?Y[En+1].el:ft;pr[It]===0?dt(null,ji,st,ti,mt,Rt,Wt,Nt,Mt):Ji&&(se<0||It!==Cn[se]?Ii(ji,st,ti,2):se--)}}},Ii=(H,Y,st,ft,mt=null)=>{const{el:Rt,type:Wt,transition:Nt,children:Mt,shapeFlag:It}=H;if(It&6){Ii(H.component.subTree,Y,st,ft);return}if(It&128){H.suspense.move(Y,st,ft);return}if(It&64){Wt.move(H,Y,st,Lt);return}if(Wt===Fi){_(Rt,Y,st);for(let zt=0;zt<Mt.length;zt++)Ii(Mt[zt],Y,st,ft);_(H.anchor,Y,st);return}if(Wt===L_){Gt(H,Y,st);return}if(ft!==2&&It&1&&Nt)if(ft===0)Nt.beforeEnter(Rt),_(Rt,Y,st),Bs(()=>Nt.enter(Rt),mt);else{const{leave:zt,delayLeave:ie,afterLeave:fe}=Nt,Ae=()=>_(Rt,Y,st),Xe=()=>{zt(Rt,()=>{Ae(),fe&&fe()})};ie?ie(Rt,Ae,Xe):Xe()}else _(Rt,Y,st)},Ln=(H,Y,st,ft=!1,mt=!1)=>{const{type:Rt,props:Wt,ref:Nt,children:Mt,dynamicChildren:It,shapeFlag:ne,patchFlag:zt,dirs:ie}=H;if(Nt!=null&&Cv(Nt,null,st,H,!0),ne&256){Y.ctx.deactivate(H);return}const fe=ne&1&&ie,Ae=!Sh(H);let Xe;if(Ae&&(Xe=Wt&&Wt.onVnodeBeforeUnmount)&&Io(Xe,Y,H),ne&6)bi(H.component,st,ft);else{if(ne&128){H.suspense.unmount(st,ft);return}fe&&Jc(H,null,Y,"beforeUnmount"),ne&64?H.type.remove(H,Y,st,mt,Lt,ft):It&&(Rt!==Fi||zt>0&&zt&64)?mn(It,Y,st,!1,!0):(Rt===Fi&&zt&384||!mt&&ne&16)&&mn(Mt,Y,st),ft&&gt(H)}(Ae&&(Xe=Wt&&Wt.onVnodeUnmounted)||fe)&&Bs(()=>{Xe&&Io(Xe,Y,H),fe&&Jc(H,null,Y,"unmounted")},st)},gt=H=>{const{type:Y,el:st,anchor:ft,transition:mt}=H;if(Y===Fi){mi(st,ft);return}if(Y===L_){Tt(H);return}const Rt=()=>{E(st),mt&&!mt.persisted&&mt.afterLeave&&mt.afterLeave()};if(H.shapeFlag&1&&mt&&!mt.persisted){const{leave:Wt,delayLeave:Nt}=mt,Mt=()=>Wt(st,Rt);Nt?Nt(H.el,Rt,Mt):Mt()}else Rt()},mi=(H,Y)=>{let st;for(;H!==Y;)st=z(H),E(H),H=st;E(Y)},bi=(H,Y,st)=>{const{bum:ft,scope:mt,update:Rt,subTree:Wt,um:Nt}=H;ft&&N_(ft),mt.stop(),Rt&&(Rt.active=!1,Ln(Wt,H,Y,st)),Nt&&Bs(Nt,Y),Bs(()=>{H.isUnmounted=!0},Y),Y&&Y.pendingBranch&&!Y.isUnmounted&&H.asyncDep&&!H.asyncResolved&&H.suspenseId===Y.pendingId&&(Y.deps--,Y.deps===0&&Y.resolve())},mn=(H,Y,st,ft=!1,mt=!1,Rt=0)=>{for(let Wt=Rt;Wt<H.length;Wt++)Ln(H[Wt],Y,st,ft,mt)},pt=H=>H.shapeFlag&6?pt(H.component.subTree):H.shapeFlag&128?H.suspense.next():z(H.anchor||H.el),jt=(H,Y,st)=>{H==null?Y._vnode&&Ln(Y._vnode,null,null,!0):dt(Y._vnode||null,H,Y,null,null,null,st),oN(),QD(),Y._vnode=H},Lt={p:dt,um:Ln,m:Ii,r:gt,mt:Sn,mc:$t,pc:Ve,pbc:_e,n:pt,o};let ee,kt;return d&&([ee,kt]=d(Lt)),{render:jt,hydrate:ee,createApp:f5(jt,ee)}}function Xc({effect:o,update:d},p){o.allowRecurse=d.allowRecurse=p}function SP(o,d,p=!1){const _=o.children,E=d.children;if(ye(_)&&ye(E))for(let T=0;T<_.length;T++){const R=_[T];let N=E[T];N.shapeFlag&1&&!N.dynamicChildren&&((N.patchFlag<=0||N.patchFlag===32)&&(N=E[T]=nc(E[T]),N.el=R.el),p||SP(R,N)),N.type===lm&&(N.el=R.el)}}function C5(o){const d=o.slice(),p=[0];let _,E,T,R,N;const D=o.length;for(_=0;_<D;_++){const x=o[_];if(x!==0){if(E=p[p.length-1],o[E]<x){d[_]=E,p.push(_);continue}for(T=0,R=p.length-1;T<R;)N=T+R>>1,o[p[N]]<x?T=N+1:R=N;x<o[p[T]]&&(T>0&&(d[_]=p[T-1]),p[T]=_)}}for(T=p.length,R=p[T-1];T-- >0;)p[T]=R,R=d[R];return p}const y5=o=>o.__isTeleport,Fi=Symbol.for("v-fgt"),lm=Symbol.for("v-txt"),la=Symbol.for("v-cmt"),L_=Symbol.for("v-stc"),Ch=[];let qr=null;function Pn(o=!1){Ch.push(qr=o?null:[])}function R5(){Ch.pop(),qr=Ch[Ch.length-1]||null}let Dh=1;function gN(o){Dh+=o}function vP(o){return o.dynamicChildren=Dh>0?qr||Sl:null,R5(),Dh>0&&qr&&qr.push(o),o}function cs(o,d,p,_,E,T){return vP(ue(o,d,p,_,E,T,!0))}function Yr(o,d,p,_,E){return vP(Ni(o,d,p,_,E,!0))}function z_(o){return o?o.__v_isVNode===!0:!1}function ml(o,d){return o.type===d.type&&o.key===d.key}const um="__vInternal",CP=({key:o})=>o??null,k_=({ref:o,ref_key:d,ref_for:p})=>(typeof o=="number"&&(o=""+o),o!=null?fi(o)||as(o)||We(o)?{i:zi,r:o,k:d,f:!!p}:o:null);function ue(o,d=null,p=null,_=0,E=null,T=o===Fi?0:1,R=!1,N=!1){const D={__v_isVNode:!0,__v_skip:!0,type:o,props:d,key:d&&CP(d),ref:d&&k_(d),scopeId:cm,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:T,patchFlag:_,dynamicProps:E,dynamicChildren:null,appContext:null,ctx:zi};return N?(sC(D,p),T&128&&o.normalize(D)):p&&(D.shapeFlag|=fi(p)?8:16),Dh>0&&!R&&qr&&(D.patchFlag>0||T&6)&&D.patchFlag!==32&&qr.push(D),D}const Ni=I5;function I5(o,d=null,p=null,_=0,E=null,T=!1){if((!o||o===lP)&&(o=la),z_(o)){const N=rd(o,d,!0);return p&&sC(N,p),Dh>0&&!T&&qr&&(N.shapeFlag&6?qr[qr.indexOf(o)]=N:qr.push(N)),N.patchFlag|=-2,N}if(M5(o)&&(o=o.__vccOpts),d){d=b5(d);let{class:N,style:D}=d;N&&!fi(N)&&(d.class=oc(N)),Hn(D)&&(KD(D)&&!ye(D)&&(D=pi({},D)),d.style=Uh(D))}const R=fi(o)?1:HG(o)?128:y5(o)?64:Hn(o)?4:We(o)?2:0;return ue(o,d,p,_,E,R,T,!0)}function b5(o){return o?KD(o)||um in o?pi({},o):o:null}function rd(o,d,p=!1){const{props:_,ref:E,patchFlag:T,children:R}=o,N=d?hm(_||{},d):_;return{__v_isVNode:!0,__v_skip:!0,type:o.type,props:N,key:N&&CP(N),ref:d&&d.ref?p&&E?ye(E)?E.concat(k_(d)):[E,k_(d)]:k_(d):E,scopeId:o.scopeId,slotScopeIds:o.slotScopeIds,children:R,target:o.target,targetAnchor:o.targetAnchor,staticCount:o.staticCount,shapeFlag:o.shapeFlag,patchFlag:d&&o.type!==Fi?T===-1?16:T|16:T,dynamicProps:o.dynamicProps,dynamicChildren:o.dynamicChildren,appContext:o.appContext,dirs:o.dirs,transition:o.transition,component:o.component,suspense:o.suspense,ssContent:o.ssContent&&rd(o.ssContent),ssFallback:o.ssFallback&&rd(o.ssFallback),el:o.el,anchor:o.anchor,ctx:o.ctx,ce:o.ce}}function Vh(o=" ",d=0){return Ni(lm,null,o,d)}function Fh(o,d){const p=Ni(L_,null,o);return p.staticCount=d,p}function M_(o="",d=!1){return d?(Pn(),Yr(la,null,o)):Ni(la,null,o)}function bo(o){return o==null||typeof o=="boolean"?Ni(la):ye(o)?Ni(Fi,null,o.slice()):typeof o=="object"?nc(o):Ni(lm,null,String(o))}function nc(o){return o.el===null&&o.patchFlag!==-1||o.memo?o:rd(o)}function sC(o,d){let p=0;const{shapeFlag:_}=o;if(d==null)d=null;else if(ye(d))p=16;else if(typeof d=="object")if(_&65){const E=d.default;E&&(E._c&&(E._d=!1),sC(o,E()),E._c&&(E._d=!0));return}else{p=32;const E=d._;!E&&!(um in d)?d._ctx=zi:E===3&&zi&&(zi.slots._===1?d._=1:(d._=2,o.patchFlag|=1024))}else We(d)?(d={default:d,_ctx:zi},p=32):(d=String(d),_&64?(p=16,d=[Vh(d)]):p=8);o.children=d,o.shapeFlag|=p}function hm(...o){const d={};for(let p=0;p<o.length;p++){const _=o[p];for(const E in _)if(E==="class")d.class!==_.class&&(d.class=oc([d.class,_.class]));else if(E==="style")d.style=Uh([d.style,_.style]);else if(tm(E)){const T=d[E],R=_[E];R&&T!==R&&!(ye(T)&&T.includes(R))&&(d[E]=T?[].concat(T,R):R)}else E!==""&&(d[E]=_[E])}return d}function Io(o,d,p,_=null){Ar(o,d,7,[p,_])}const A5=fP();let w5=0;function O5(o,d,p){const _=o.type,E=(d?d.appContext:o.appContext)||A5,T={uid:w5++,vnode:o,type:_,parent:d,appContext:E,root:null,next:null,subTree:null,effect:null,update:null,scope:new PD(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:d?d.provides:Object.create(E.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:mP(_,E),emitsOptions:tP(_,E),emit:null,emitted:null,propsDefaults:Wn,inheritAttrs:_.inheritAttrs,ctx:Wn,data:Wn,props:Wn,attrs:Wn,slots:Wn,refs:Wn,setupState:Wn,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return T.ctx={_:T},T.root=d?d.root:T,T.emit=xG.bind(null,T),o.ce&&o.ce(T),T}let Bi=null;const yP=()=>Bi||zi;let rC,_l,TN="__VUE_INSTANCE_SETTERS__";(_l=lv()[TN])||(_l=lv()[TN]=[]),_l.push(o=>Bi=o),rC=o=>{_l.length>1?_l.forEach(d=>d(o)):_l[0](o)};const bl=o=>{rC(o),o.scope.on()},id=()=>{Bi&&Bi.scope.off(),rC(null)};function RP(o){return o.vnode.shapeFlag&4}let Ph=!1;function N5(o,d=!1){Ph=d;const{props:p,children:_}=o.vnode,E=RP(o);_5(o,p,E,d),g5(o,_);const T=E?D5(o,d):void 0;return Ph=!1,T}function D5(o,d){const p=o.type;o.accessCache=Object.create(null),o.proxy=Jv(new Proxy(o.ctx,a5));const{setup:_}=p;if(_){const E=o.setupContext=_.length>1?L5(o):null;bl(o),Ul();const T=rc(_,o,0,[o.props,E]);if(xl(),id(),bD(T)){if(T.then(id,id),d)return T.then(R=>{SN(o,R,d)}).catch(R=>{om(R,o,0)});o.asyncDep=T}else SN(o,T,d)}else IP(o,d)}function SN(o,d,p){We(d)?o.type.__ssrInlineRender?o.ssrRender=d:o.render=d:Hn(d)&&(o.setupState=JD(d)),IP(o,p)}let vN;function IP(o,d,p){const _=o.type;if(!o.render){if(!d&&vN&&!_.render){const E=_.template||nC(o).template;if(E){const{isCustomElement:T,compilerOptions:R}=o.appContext.config,{delimiters:N,compilerOptions:D}=_,x=pi(pi({isCustomElement:T,delimiters:N},R),D);_.render=vN(E,x)}}o.render=_.render||Jr}bl(o),Ul(),c5(o),xl(),id()}function P5(o){return o.attrsProxy||(o.attrsProxy=new Proxy(o.attrs,{get(d,p){return Gs(o,"get","$attrs"),d[p]}}))}function L5(o){const d=p=>{o.exposed=p||{}};return{get attrs(){return P5(o)},slots:o.slots,emit:o.emit,expose:d}}function pm(o){if(o.exposed)return o.exposeProxy||(o.exposeProxy=new Proxy(JD(Jv(o.exposed)),{get(d,p){if(p in d)return d[p];if(p in vh)return vh[p](o)},has(d,p){return p in d||p in vh}}))}function k5(o,d=!0){return We(o)?o.displayName||o.name:o.name||d&&o.__name}function M5(o){return We(o)&&"__vccOpts"in o}const Hr=(o,d)=>DG(o,d,Ph);function bP(o,d,p){const _=arguments.length;return _===2?Hn(d)&&!ye(d)?z_(d)?Ni(o,null,[d]):Ni(o,d):Ni(o,null,d):(_>3?p=Array.prototype.slice.call(arguments,2):_===3&&z_(p)&&(p=[p]),Ni(o,d,p))}const U5=Symbol.for("v-scx"),x5=()=>dr(U5),V5="3.3.4",F5="http://www.w3.org/2000/svg",Zc=typeof document<"u"?document:null,CN=Zc&&Zc.createElement("template"),B5={insert:(o,d,p)=>{d.insertBefore(o,p||null)},remove:o=>{const d=o.parentNode;d&&d.removeChild(o)},createElement:(o,d,p,_)=>{const E=d?Zc.createElementNS(F5,o):Zc.createElement(o,p?{is:p}:void 0);return o==="select"&&_&&_.multiple!=null&&E.setAttribute("multiple",_.multiple),E},createText:o=>Zc.createTextNode(o),createComment:o=>Zc.createComment(o),setText:(o,d)=>{o.nodeValue=d},setElementText:(o,d)=>{o.textContent=d},parentNode:o=>o.parentNode,nextSibling:o=>o.nextSibling,querySelector:o=>Zc.querySelector(o),setScopeId(o,d){o.setAttribute(d,"")},insertStaticContent(o,d,p,_,E,T){const R=p?p.previousSibling:d.lastChild;if(E&&(E===T||E.nextSibling))for(;d.insertBefore(E.cloneNode(!0),p),!(E===T||!(E=E.nextSibling)););else{CN.innerHTML=_?`<svg>${o}</svg>`:o;const N=CN.content;if(_){const D=N.firstChild;for(;D.firstChild;)N.appendChild(D.firstChild);N.removeChild(D)}d.insertBefore(N,p)}return[R?R.nextSibling:d.firstChild,p?p.previousSibling:d.lastChild]}};function j5(o,d,p){const _=o._vtc;_&&(d=(d?[d,..._]:[..._]).join(" ")),d==null?o.removeAttribute("class"):p?o.setAttribute("class",d):o.className=d}function G5(o,d,p){const _=o.style,E=fi(p);if(p&&!E){if(d&&!fi(d))for(const T in d)p[T]==null&&yv(_,T,"");for(const T in p)yv(_,T,p[T])}else{const T=_.display;E?d!==p&&(_.cssText=p):d&&o.removeAttribute("style"),"_vod"in o&&(_.display=T)}}const yN=/\s*!important$/;function yv(o,d,p){if(ye(p))p.forEach(_=>yv(o,d,_));else if(p==null&&(p=""),d.startsWith("--"))o.setProperty(d,p);else{const _=W5(o,d);yN.test(p)?o.setProperty(Ml(_),p.replace(yN,""),"important"):o[_]=p}}const RN=["Webkit","Moz","ms"],XS={};function W5(o,d){const p=XS[d];if(p)return p;let _=Do(d);if(_!=="filter"&&_ in o)return XS[d]=_;_=im(_);for(let E=0;E<RN.length;E++){const T=RN[E]+_;if(T in o)return XS[d]=T}return d}const IN="http://www.w3.org/1999/xlink";function H5(o,d,p,_,E){if(_&&d.startsWith("xlink:"))p==null?o.removeAttributeNS(IN,d.slice(6,d.length)):o.setAttributeNS(IN,d,p);else{const T=$4(d);p==null||T&&!OD(p)?o.removeAttribute(d):o.setAttribute(d,T?"":p)}}function K5(o,d,p,_,E,T,R){if(d==="innerHTML"||d==="textContent"){_&&R(_,E,T),o[d]=p??"";return}const N=o.tagName;if(d==="value"&&N!=="PROGRESS"&&!N.includes("-")){o._value=p;const x=N==="OPTION"?o.getAttribute("value"):o.value,P=p??"";x!==P&&(o.value=P),p==null&&o.removeAttribute(d);return}let D=!1;if(p===""||p==null){const x=typeof o[d];x==="boolean"?p=OD(p):p==null&&x==="string"?(p="",D=!0):x==="number"&&(p=0,D=!0)}try{o[d]=p}catch{}D&&o.removeAttribute(d)}function El(o,d,p,_){o.addEventListener(d,p,_)}function q5(o,d,p,_){o.removeEventListener(d,p,_)}function Y5(o,d,p,_,E=null){const T=o._vei||(o._vei={}),R=T[d];if(_&&R)R.value=_;else{const[N,D]=z5(d);if(_){const x=T[d]=$5(_,E);El(o,N,x,D)}else R&&(q5(o,N,R,D),T[d]=void 0)}}const bN=/(?:Once|Passive|Capture)$/;function z5(o){let d;if(bN.test(o)){d={};let _;for(;_=o.match(bN);)o=o.slice(0,o.length-_[0].length),d[_[0].toLowerCase()]=!0}return[o[2]===":"?o.slice(3):Ml(o.slice(2)),d]}let $S=0;const J5=Promise.resolve(),X5=()=>$S||(J5.then(()=>$S=0),$S=Date.now());function $5(o,d){const p=_=>{if(!_._vts)_._vts=Date.now();else if(_._vts<=p.attached)return;Ar(Q5(_,p.value),d,5,[_])};return p.value=o,p.attached=X5(),p}function Q5(o,d){if(ye(d)){const p=o.stopImmediatePropagation;return o.stopImmediatePropagation=()=>{p.call(o),o._stopped=!0},d.map(_=>E=>!E._stopped&&_&&_(E))}else return d}const AN=/^on[a-z]/,Z5=(o,d,p,_,E=!1,T,R,N,D)=>{d==="class"?j5(o,_,E):d==="style"?G5(o,p,_):tm(d)?Fv(d)||Y5(o,d,p,_,R):(d[0]==="."?(d=d.slice(1),!0):d[0]==="^"?(d=d.slice(1),!1):tW(o,d,_,E))?K5(o,d,_,T,R,N,D):(d==="true-value"?o._trueValue=_:d==="false-value"&&(o._falseValue=_),H5(o,d,_,E))};function tW(o,d,p,_){return _?!!(d==="innerHTML"||d==="textContent"||d in o&&AN.test(d)&&We(p)):d==="spellcheck"||d==="draggable"||d==="translate"||d==="form"||d==="list"&&o.tagName==="INPUT"||d==="type"&&o.tagName==="TEXTAREA"||AN.test(d)&&fi(p)?!1:d in o}const Qa="transition",hh="animation",AP={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},eW=pi({},zG,AP),$c=(o,d=[])=>{ye(o)?o.forEach(p=>p(...d)):o&&o(...d)},wN=o=>o?ye(o)?o.some(d=>d.length>1):o.length>1:!1;function nW(o){const d={};for(const qt in o)qt in AP||(d[qt]=o[qt]);if(o.css===!1)return d;const{name:p="v",type:_,duration:E,enterFromClass:T=`${p}-enter-from`,enterActiveClass:R=`${p}-enter-active`,enterToClass:N=`${p}-enter-to`,appearFromClass:D=T,appearActiveClass:x=R,appearToClass:P=N,leaveFromClass:G=`${p}-leave-from`,leaveActiveClass:z=`${p}-leave-active`,leaveToClass:rt=`${p}-leave-to`}=o,at=iW(E),dt=at&&at[0],bt=at&&at[1],{onBeforeEnter:Ot,onEnter:Dt,onEnterCancelled:Gt,onLeave:Tt,onLeaveCancelled:Kt,onBeforeAppear:Zt=Ot,onAppear:me=Dt,onAppearCancelled:$t=Gt}=d,Ce=(qt,Ee,Sn)=>{ec(qt,Ee?P:N),ec(qt,Ee?x:R),Sn&&Sn()},_e=(qt,Ee)=>{qt._isLeaving=!1,ec(qt,G),ec(qt,rt),ec(qt,z),Ee&&Ee()},Le=qt=>(Ee,Sn)=>{const Qn=qt?me:Dt,xe=()=>Ce(Ee,qt,Sn);$c(Qn,[Ee,xe]),ON(()=>{ec(Ee,qt?D:T),ra(Ee,qt?P:N),wN(Qn)||NN(Ee,_,dt,xe)})};return pi(d,{onBeforeEnter(qt){$c(Ot,[qt]),ra(qt,T),ra(qt,R)},onBeforeAppear(qt){$c(Zt,[qt]),ra(qt,D),ra(qt,x)},onEnter:Le(!1),onAppear:Le(!0),onLeave(qt,Ee){qt._isLeaving=!0;const Sn=()=>_e(qt,Ee);ra(qt,G),OP(),ra(qt,z),ON(()=>{qt._isLeaving&&(ec(qt,G),ra(qt,rt),wN(Tt)||NN(qt,_,bt,Sn))}),$c(Tt,[qt,Sn])},onEnterCancelled(qt){Ce(qt,!1),$c(Gt,[qt])},onAppearCancelled(qt){Ce(qt,!0),$c($t,[qt])},onLeaveCancelled(qt){_e(qt),$c(Kt,[qt])}})}function iW(o){if(o==null)return null;if(Hn(o))return[QS(o.enter),QS(o.leave)];{const d=QS(o);return[d,d]}}function QS(o){return K4(o)}function ra(o,d){d.split(/\s+/).forEach(p=>p&&o.classList.add(p)),(o._vtc||(o._vtc=new Set)).add(d)}function ec(o,d){d.split(/\s+/).forEach(_=>_&&o.classList.remove(_));const{_vtc:p}=o;p&&(p.delete(d),p.size||(o._vtc=void 0))}function ON(o){requestAnimationFrame(()=>{requestAnimationFrame(o)})}let sW=0;function NN(o,d,p,_){const E=o._endId=++sW,T=()=>{E===o._endId&&_()};if(p)return setTimeout(T,p);const{type:R,timeout:N,propCount:D}=wP(o,d);if(!R)return _();const x=R+"end";let P=0;const G=()=>{o.removeEventListener(x,z),T()},z=rt=>{rt.target===o&&++P>=D&&G()};setTimeout(()=>{P<D&&G()},N+1),o.addEventListener(x,z)}function wP(o,d){const p=window.getComputedStyle(o),_=at=>(p[at]||"").split(", "),E=_(`${Qa}Delay`),T=_(`${Qa}Duration`),R=DN(E,T),N=_(`${hh}Delay`),D=_(`${hh}Duration`),x=DN(N,D);let P=null,G=0,z=0;d===Qa?R>0&&(P=Qa,G=R,z=T.length):d===hh?x>0&&(P=hh,G=x,z=D.length):(G=Math.max(R,x),P=G>0?R>x?Qa:hh:null,z=P?P===Qa?T.length:D.length:0);const rt=P===Qa&&/\b(transform|all)(,|$)/.test(_(`${Qa}Property`).toString());return{type:P,timeout:G,propCount:z,hasTransform:rt}}function DN(o,d){for(;o.length<d.length;)o=o.concat(o);return Math.max(...d.map((p,_)=>PN(p)+PN(o[_])))}function PN(o){return Number(o.slice(0,-1).replace(",","."))*1e3}function OP(){return document.body.offsetHeight}const NP=new WeakMap,DP=new WeakMap,PP={name:"TransitionGroup",props:pi({},eW,{tag:String,moveClass:String}),setup(o,{slots:d}){const p=yP(),_=YG();let E,T;return aP(()=>{if(!E.length)return;const R=o.moveClass||`${o.name||"v"}-move`;if(!lW(E[0].el,p.vnode.el,R))return;E.forEach(aW),E.forEach(cW);const N=E.filter(dW);OP(),N.forEach(D=>{const x=D.el,P=x.style;ra(x,R),P.transform=P.webkitTransform=P.transitionDuration="";const G=x._moveCb=z=>{z&&z.target!==x||(!z||/transform$/.test(z.propertyName))&&(x.removeEventListener("transitionend",G),x._moveCb=null,ec(x,R))};x.addEventListener("transitionend",G)})}),()=>{const R=an(o),N=nW(R);let D=R.tag||Fi;E=T,T=d.default?iP(d.default()):[];for(let x=0;x<T.length;x++){const P=T[x];P.key!=null&&Ev(P,mv(P,N,_,p))}if(E)for(let x=0;x<E.length;x++){const P=E[x];Ev(P,mv(P,N,_,p)),NP.set(P,P.el.getBoundingClientRect())}return Ni(D,null,T)}}},rW=o=>delete o.mode;PP.props;const oW=PP;function aW(o){const d=o.el;d._moveCb&&d._moveCb(),d._enterCb&&d._enterCb()}function cW(o){DP.set(o,o.el.getBoundingClientRect())}function dW(o){const d=NP.get(o),p=DP.get(o),_=d.left-p.left,E=d.top-p.top;if(_||E){const T=o.el.style;return T.transform=T.webkitTransform=`translate(${_}px,${E}px)`,T.transitionDuration="0s",o}}function lW(o,d,p){const _=o.cloneNode();o._vtc&&o._vtc.forEach(R=>{R.split(/\s+/).forEach(N=>N&&_.classList.remove(N))}),p.split(/\s+/).forEach(R=>R&&_.classList.add(R)),_.style.display="none";const E=d.nodeType===1?d:d.parentNode;E.appendChild(_);const{hasTransform:T}=wP(_);return E.removeChild(_),T}const LN=o=>{const d=o.props["onUpdate:modelValue"]||!1;return ye(d)?p=>N_(d,p):d};function uW(o){o.target.composing=!0}function kN(o){const d=o.target;d.composing&&(d.composing=!1,d.dispatchEvent(new Event("input")))}const ZS={created(o,{modifiers:{lazy:d,trim:p,number:_}},E){o._assign=LN(E);const T=_||E.props&&E.props.type==="number";El(o,d?"change":"input",R=>{if(R.target.composing)return;let N=o.value;p&&(N=N.trim()),T&&(N=dv(N)),o._assign(N)}),p&&El(o,"change",()=>{o.value=o.value.trim()}),d||(El(o,"compositionstart",uW),El(o,"compositionend",kN),El(o,"change",kN))},mounted(o,{value:d}){o.value=d??""},beforeUpdate(o,{value:d,modifiers:{lazy:p,trim:_,number:E}},T){if(o._assign=LN(T),o.composing||document.activeElement===o&&o.type!=="range"&&(p||_&&o.value.trim()===d||(E||o.type==="number")&&dv(o.value)===d))return;const R=d??"";o.value!==R&&(o.value=R)}},hW=["ctrl","shift","alt","meta"],pW={stop:o=>o.stopPropagation(),prevent:o=>o.preventDefault(),self:o=>o.target!==o.currentTarget,ctrl:o=>!o.ctrlKey,shift:o=>!o.shiftKey,alt:o=>!o.altKey,meta:o=>!o.metaKey,left:o=>"button"in o&&o.button!==0,middle:o=>"button"in o&&o.button!==1,right:o=>"button"in o&&o.button!==2,exact:(o,d)=>hW.some(p=>o[`${p}Key`]&&!d.includes(p))},fW=(o,d)=>(p,..._)=>{for(let E=0;E<d.length;E++){const T=pW[d[E]];if(T&&T(p,d))return}return o(p,..._)},MN={beforeMount(o,{value:d},{transition:p}){o._vod=o.style.display==="none"?"":o.style.display,p&&d?p.beforeEnter(o):ph(o,d)},mounted(o,{value:d},{transition:p}){p&&d&&p.enter(o)},updated(o,{value:d,oldValue:p},{transition:_}){!d!=!p&&(_?d?(_.beforeEnter(o),ph(o,!0),_.enter(o)):_.leave(o,()=>{ph(o,!1)}):ph(o,d))},beforeUnmount(o,{value:d}){ph(o,d)}};function ph(o,d){o.style.display=d?o._vod:"none"}const _W=pi({patchProp:Z5},B5);let UN;function mW(){return UN||(UN=S5(_W))}const LP=(...o)=>{const d=mW().createApp(...o),{mount:p}=d;return d.mount=_=>{const E=EW(_);if(!E)return;const T=d._component;!We(T)&&!T.render&&!T.template&&(T.template=E.innerHTML),E.innerHTML="";const R=p(E,!1,E instanceof SVGElement);return E instanceof Element&&(E.removeAttribute("v-cloak"),E.setAttribute("data-v-app","")),R},d};function EW(o){return fi(o)?document.querySelector(o):o}var gW=!1;/*!
 * pinia v2.1.6
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */const TW=Symbol();var xN;(function(o){o.direct="direct",o.patchObject="patch object",o.patchFunction="patch function"})(xN||(xN={}));function SW(){const o=Q4(!0),d=o.run(()=>js({}));let p=[],_=[];const E=Jv({install(T){E._a=T,T.provide(TW,E),T.config.globalProperties.$pinia=E,_.forEach(R=>p.push(R)),_=[]},use(T){return!this._a&&!gW?_.push(T):p.push(T),this},_p:p,_a:null,_e:o,_s:new Map,state:d});return E}var vW=Object.defineProperty,VN=Object.getOwnPropertySymbols,CW=Object.prototype.hasOwnProperty,yW=Object.prototype.propertyIsEnumerable,FN=(o,d,p)=>d in o?vW(o,d,{enumerable:!0,configurable:!0,writable:!0,value:p}):o[d]=p,kP=(o,d)=>{for(var p in d||(d={}))CW.call(d,p)&&FN(o,p,d[p]);if(VN)for(var p of VN(d))yW.call(d,p)&&FN(o,p,d[p]);return o},fm=o=>typeof o=="function",_m=o=>typeof o=="string",MP=o=>_m(o)&&o.trim().length>0,RW=o=>typeof o=="number",ed=o=>typeof o>"u",Lh=o=>typeof o=="object"&&o!==null,IW=o=>Oo(o,"tag")&&MP(o.tag),UP=o=>window.TouchEvent&&o instanceof TouchEvent,xP=o=>Oo(o,"component")&&VP(o.component),bW=o=>fm(o)||Lh(o),VP=o=>!ed(o)&&(_m(o)||bW(o)||xP(o)),BN=o=>Lh(o)&&["height","width","right","left","top","bottom"].every(d=>RW(o[d])),Oo=(o,d)=>(Lh(o)||fm(o))&&d in o,AW=(o=>()=>o++)(0);function tv(o){return UP(o)?o.targetTouches[0].clientX:o.clientX}function jN(o){return UP(o)?o.targetTouches[0].clientY:o.clientY}var wW=o=>{ed(o.remove)?o.parentNode&&o.parentNode.removeChild(o):o.remove()},Bh=o=>xP(o)?Bh(o.component):IW(o)?Nr({render(){return o}}):typeof o=="string"?o:an(Kr(o)),OW=o=>{if(typeof o=="string")return o;const d=Oo(o,"props")&&Lh(o.props)?o.props:{},p=Oo(o,"listeners")&&Lh(o.listeners)?o.listeners:{};return{component:Bh(o),props:d,listeners:p}},NW=()=>typeof window<"u",oC=class{constructor(){this.allHandlers={}}getHandlers(o){return this.allHandlers[o]||[]}on(o,d){const p=this.getHandlers(o);p.push(d),this.allHandlers[o]=p}off(o,d){const p=this.getHandlers(o);p.splice(p.indexOf(d)>>>0,1)}emit(o,d){this.getHandlers(o).forEach(_=>_(d))}},DW=o=>["on","off","emit"].every(d=>Oo(o,d)&&fm(o[d])),ar;(function(o){o.SUCCESS="success",o.ERROR="error",o.WARNING="warning",o.INFO="info",o.DEFAULT="default"})(ar||(ar={}));var J_;(function(o){o.TOP_LEFT="top-left",o.TOP_CENTER="top-center",o.TOP_RIGHT="top-right",o.BOTTOM_LEFT="bottom-left",o.BOTTOM_CENTER="bottom-center",o.BOTTOM_RIGHT="bottom-right"})(J_||(J_={}));var cr;(function(o){o.ADD="add",o.DISMISS="dismiss",o.UPDATE="update",o.CLEAR="clear",o.UPDATE_DEFAULTS="update_defaults"})(cr||(cr={}));var zr="Vue-Toastification",Gr={type:{type:String,default:ar.DEFAULT},classNames:{type:[String,Array],default:()=>[]},trueBoolean:{type:Boolean,default:!0}},FP={type:Gr.type,customIcon:{type:[String,Boolean,Object,Function],default:!0}},U_={component:{type:[String,Object,Function,Boolean],default:"button"},classNames:Gr.classNames,showOnHover:{type:Boolean,default:!1},ariaLabel:{type:String,default:"close"}},Rv={timeout:{type:[Number,Boolean],default:5e3},hideProgressBar:{type:Boolean,default:!1},isRunning:{type:Boolean,default:!1}},BP={transition:{type:[Object,String],default:`${zr}__bounce`}},PW={position:{type:String,default:J_.TOP_RIGHT},draggable:Gr.trueBoolean,draggablePercent:{type:Number,default:.6},pauseOnFocusLoss:Gr.trueBoolean,pauseOnHover:Gr.trueBoolean,closeOnClick:Gr.trueBoolean,timeout:Rv.timeout,hideProgressBar:Rv.hideProgressBar,toastClassName:Gr.classNames,bodyClassName:Gr.classNames,icon:FP.customIcon,closeButton:U_.component,closeButtonClassName:U_.classNames,showCloseButtonOnHover:U_.showOnHover,accessibility:{type:Object,default:()=>({toastRole:"alert",closeButtonLabel:"close"})},rtl:{type:Boolean,default:!1},eventBus:{type:Object,required:!1,default:()=>new oC}},LW={id:{type:[String,Number],required:!0,default:0},type:Gr.type,content:{type:[String,Object,Function],required:!0,default:""},onClick:{type:Function,default:void 0},onClose:{type:Function,default:void 0}},kW={container:{type:[Object,Function],default:()=>document.body},newestOnTop:Gr.trueBoolean,maxToasts:{type:Number,default:20},transition:BP.transition,toastDefaults:Object,filterBeforeCreate:{type:Function,default:o=>o},filterToasts:{type:Function,default:o=>o},containerClassName:Gr.classNames,onMounted:Function,shareAppContext:[Boolean,Object]},aa={CORE_TOAST:PW,TOAST:LW,CONTAINER:kW,PROGRESS_BAR:Rv,ICON:FP,TRANSITION:BP,CLOSE_BUTTON:U_},jP=Nr({name:"VtProgressBar",props:aa.PROGRESS_BAR,data(){return{hasClass:!0}},computed:{style(){return{animationDuration:`${this.timeout}ms`,animationPlayState:this.isRunning?"running":"paused",opacity:this.hideProgressBar?0:1}},cpClass(){return this.hasClass?`${zr}__progress-bar`:""}},watch:{timeout(){this.hasClass=!1,this.$nextTick(()=>this.hasClass=!0)}},mounted(){this.$el.addEventListener("animationend",this.animationEnded)},beforeUnmount(){this.$el.removeEventListener("animationend",this.animationEnded)},methods:{animationEnded(){this.$emit("close-toast")}}});function MW(o,d){return Pn(),cs("div",{style:Uh(o.style),class:oc(o.cpClass)},null,6)}jP.render=MW;var UW=jP,GP=Nr({name:"VtCloseButton",props:aa.CLOSE_BUTTON,computed:{buttonComponent(){return this.component!==!1?Bh(this.component):"button"},classes(){const o=[`${zr}__close-button`];return this.showOnHover&&o.push("show-on-hover"),o.concat(this.classNames)}}}),xW=Vh(" × ");function VW(o,d){return Pn(),Yr(eC(o.buttonComponent),hm({"aria-label":o.ariaLabel,class:o.classes},o.$attrs),{default:xh(()=>[xW]),_:1},16,["aria-label","class"])}GP.render=VW;var FW=GP,WP={},BW={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"check-circle",class:"svg-inline--fa fa-check-circle fa-w-16",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},jW=ue("path",{fill:"currentColor",d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},null,-1),GW=[jW];function WW(o,d){return Pn(),cs("svg",BW,GW)}WP.render=WW;var HW=WP,HP={},KW={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"info-circle",class:"svg-inline--fa fa-info-circle fa-w-16",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},qW=ue("path",{fill:"currentColor",d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},null,-1),YW=[qW];function zW(o,d){return Pn(),cs("svg",KW,YW)}HP.render=zW;var GN=HP,KP={},JW={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"exclamation-circle",class:"svg-inline--fa fa-exclamation-circle fa-w-16",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},XW=ue("path",{fill:"currentColor",d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},null,-1),$W=[XW];function QW(o,d){return Pn(),cs("svg",JW,$W)}KP.render=QW;var ZW=KP,qP={},tH={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"exclamation-triangle",class:"svg-inline--fa fa-exclamation-triangle fa-w-18",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512"},eH=ue("path",{fill:"currentColor",d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},null,-1),nH=[eH];function iH(o,d){return Pn(),cs("svg",tH,nH)}qP.render=iH;var sH=qP,YP=Nr({name:"VtIcon",props:aa.ICON,computed:{customIconChildren(){return Oo(this.customIcon,"iconChildren")?this.trimValue(this.customIcon.iconChildren):""},customIconClass(){return _m(this.customIcon)?this.trimValue(this.customIcon):Oo(this.customIcon,"iconClass")?this.trimValue(this.customIcon.iconClass):""},customIconTag(){return Oo(this.customIcon,"iconTag")?this.trimValue(this.customIcon.iconTag,"i"):"i"},hasCustomIcon(){return this.customIconClass.length>0},component(){return this.hasCustomIcon?this.customIconTag:VP(this.customIcon)?Bh(this.customIcon):this.iconTypeComponent},iconTypeComponent(){return{[ar.DEFAULT]:GN,[ar.INFO]:GN,[ar.SUCCESS]:HW,[ar.ERROR]:sH,[ar.WARNING]:ZW}[this.type]},iconClasses(){const o=[`${zr}__icon`];return this.hasCustomIcon?o.concat(this.customIconClass):o}},methods:{trimValue(o,d=""){return MP(o)?o.trim():d}}});function rH(o,d){return Pn(),Yr(eC(o.component),{class:oc(o.iconClasses)},{default:xh(()=>[Vh(ND(o.customIconChildren),1)]),_:1},8,["class"])}YP.render=rH;var oH=YP,zP=Nr({name:"VtToast",components:{ProgressBar:UW,CloseButton:FW,Icon:oH},inheritAttrs:!1,props:Object.assign({},aa.CORE_TOAST,aa.TOAST),data(){return{isRunning:!0,disableTransitions:!1,beingDragged:!1,dragStart:0,dragPos:{x:0,y:0},dragRect:{}}},computed:{classes(){const o=[`${zr}__toast`,`${zr}__toast--${this.type}`,`${this.position}`].concat(this.toastClassName);return this.disableTransitions&&o.push("disable-transition"),this.rtl&&o.push(`${zr}__toast--rtl`),o},bodyClasses(){return[`${zr}__toast-${_m(this.content)?"body":"component-body"}`].concat(this.bodyClassName)},draggableStyle(){return this.dragStart===this.dragPos.x?{}:this.beingDragged?{transform:`translateX(${this.dragDelta}px)`,opacity:1-Math.abs(this.dragDelta/this.removalDistance)}:{transition:"transform 0.2s, opacity 0.2s",transform:"translateX(0)",opacity:1}},dragDelta(){return this.beingDragged?this.dragPos.x-this.dragStart:0},removalDistance(){return BN(this.dragRect)?(this.dragRect.right-this.dragRect.left)*this.draggablePercent:0}},mounted(){this.draggable&&this.draggableSetup(),this.pauseOnFocusLoss&&this.focusSetup()},beforeUnmount(){this.draggable&&this.draggableCleanup(),this.pauseOnFocusLoss&&this.focusCleanup()},methods:{hasProp:Oo,getVueComponentFromObj:Bh,closeToast(){this.eventBus.emit(cr.DISMISS,this.id)},clickHandler(){this.onClick&&this.onClick(this.closeToast),this.closeOnClick&&(!this.beingDragged||this.dragStart===this.dragPos.x)&&this.closeToast()},timeoutHandler(){this.closeToast()},hoverPause(){this.pauseOnHover&&(this.isRunning=!1)},hoverPlay(){this.pauseOnHover&&(this.isRunning=!0)},focusPause(){this.isRunning=!1},focusPlay(){this.isRunning=!0},focusSetup(){addEventListener("blur",this.focusPause),addEventListener("focus",this.focusPlay)},focusCleanup(){removeEventListener("blur",this.focusPause),removeEventListener("focus",this.focusPlay)},draggableSetup(){const o=this.$el;o.addEventListener("touchstart",this.onDragStart,{passive:!0}),o.addEventListener("mousedown",this.onDragStart),addEventListener("touchmove",this.onDragMove,{passive:!1}),addEventListener("mousemove",this.onDragMove),addEventListener("touchend",this.onDragEnd),addEventListener("mouseup",this.onDragEnd)},draggableCleanup(){const o=this.$el;o.removeEventListener("touchstart",this.onDragStart),o.removeEventListener("mousedown",this.onDragStart),removeEventListener("touchmove",this.onDragMove),removeEventListener("mousemove",this.onDragMove),removeEventListener("touchend",this.onDragEnd),removeEventListener("mouseup",this.onDragEnd)},onDragStart(o){this.beingDragged=!0,this.dragPos={x:tv(o),y:jN(o)},this.dragStart=tv(o),this.dragRect=this.$el.getBoundingClientRect()},onDragMove(o){this.beingDragged&&(o.preventDefault(),this.isRunning&&(this.isRunning=!1),this.dragPos={x:tv(o),y:jN(o)})},onDragEnd(){this.beingDragged&&(Math.abs(this.dragDelta)>=this.removalDistance?(this.disableTransitions=!0,this.$nextTick(()=>this.closeToast())):setTimeout(()=>{this.beingDragged=!1,BN(this.dragRect)&&this.pauseOnHover&&this.dragRect.bottom>=this.dragPos.y&&this.dragPos.y>=this.dragRect.top&&this.dragRect.left<=this.dragPos.x&&this.dragPos.x<=this.dragRect.right?this.isRunning=!1:this.isRunning=!0}))}}}),aH=["role"];function cH(o,d){const p=Rl("Icon"),_=Rl("CloseButton"),E=Rl("ProgressBar");return Pn(),cs("div",{class:oc(o.classes),style:Uh(o.draggableStyle),onClick:d[0]||(d[0]=(...T)=>o.clickHandler&&o.clickHandler(...T)),onMouseenter:d[1]||(d[1]=(...T)=>o.hoverPause&&o.hoverPause(...T)),onMouseleave:d[2]||(d[2]=(...T)=>o.hoverPlay&&o.hoverPlay(...T))},[o.icon?(Pn(),Yr(p,{key:0,"custom-icon":o.icon,type:o.type},null,8,["custom-icon","type"])):M_("v-if",!0),ue("div",{role:o.accessibility.toastRole||"alert",class:oc(o.bodyClasses)},[typeof o.content=="string"?(Pn(),cs(Fi,{key:0},[Vh(ND(o.content),1)],2112)):(Pn(),Yr(eC(o.getVueComponentFromObj(o.content)),hm({key:1,"toast-id":o.id},o.hasProp(o.content,"props")?o.content.props:{},o5(o.hasProp(o.content,"listeners")?o.content.listeners:{}),{onCloseToast:o.closeToast}),null,16,["toast-id","onCloseToast"]))],10,aH),o.closeButton?(Pn(),Yr(_,{key:1,component:o.closeButton,"class-names":o.closeButtonClassName,"show-on-hover":o.showCloseButtonOnHover,"aria-label":o.accessibility.closeButtonLabel,onClick:fW(o.closeToast,["stop"])},null,8,["component","class-names","show-on-hover","aria-label","onClick"])):M_("v-if",!0),o.timeout?(Pn(),Yr(E,{key:2,"is-running":o.isRunning,"hide-progress-bar":o.hideProgressBar,timeout:o.timeout,onCloseToast:o.timeoutHandler},null,8,["is-running","hide-progress-bar","timeout","onCloseToast"])):M_("v-if",!0)],38)}zP.render=cH;var dH=zP,JP=Nr({name:"VtTransition",props:aa.TRANSITION,emits:["leave"],methods:{hasProp:Oo,leave(o){o instanceof HTMLElement&&(o.style.left=o.offsetLeft+"px",o.style.top=o.offsetTop+"px",o.style.width=getComputedStyle(o).width,o.style.position="absolute")}}});function lH(o,d){return Pn(),Yr(oW,{tag:"div","enter-active-class":o.transition.enter?o.transition.enter:`${o.transition}-enter-active`,"move-class":o.transition.move?o.transition.move:`${o.transition}-move`,"leave-active-class":o.transition.leave?o.transition.leave:`${o.transition}-leave-active`,onLeave:o.leave},{default:xh(()=>[r5(o.$slots,"default")]),_:3},8,["enter-active-class","move-class","leave-active-class","onLeave"])}JP.render=lH;var uH=JP,XP=Nr({name:"VueToastification",devtools:{hide:!0},components:{Toast:dH,VtTransition:uH},props:Object.assign({},aa.CORE_TOAST,aa.CONTAINER,aa.TRANSITION),data(){return{count:0,positions:Object.values(J_),toasts:{},defaults:{}}},computed:{toastArray(){return Object.values(this.toasts)},filteredToasts(){return this.defaults.filterToasts(this.toastArray)}},beforeMount(){const o=this.eventBus;o.on(cr.ADD,this.addToast),o.on(cr.CLEAR,this.clearToasts),o.on(cr.DISMISS,this.dismissToast),o.on(cr.UPDATE,this.updateToast),o.on(cr.UPDATE_DEFAULTS,this.updateDefaults),this.defaults=this.$props},mounted(){this.setup(this.container)},methods:{async setup(o){fm(o)&&(o=await o()),wW(this.$el),o.appendChild(this.$el)},setToast(o){ed(o.id)||(this.toasts[o.id]=o)},addToast(o){o.content=OW(o.content);const d=Object.assign({},this.defaults,o.type&&this.defaults.toastDefaults&&this.defaults.toastDefaults[o.type],o),p=this.defaults.filterBeforeCreate(d,this.toastArray);p&&this.setToast(p)},dismissToast(o){const d=this.toasts[o];!ed(d)&&!ed(d.onClose)&&d.onClose(),delete this.toasts[o]},clearToasts(){Object.keys(this.toasts).forEach(o=>{this.dismissToast(o)})},getPositionToasts(o){const d=this.filteredToasts.filter(p=>p.position===o).slice(0,this.defaults.maxToasts);return this.defaults.newestOnTop?d.reverse():d},updateDefaults(o){ed(o.container)||this.setup(o.container),this.defaults=Object.assign({},this.defaults,o)},updateToast({id:o,options:d,create:p}){this.toasts[o]?(d.timeout&&d.timeout===this.toasts[o].timeout&&d.timeout++,this.setToast(Object.assign({},this.toasts[o],d))):p&&this.addToast(Object.assign({},{id:o},d))},getClasses(o){return[`${zr}__container`,o].concat(this.defaults.containerClassName)}}});function hH(o,d){const p=Rl("Toast"),_=Rl("VtTransition");return Pn(),cs("div",null,[(Pn(!0),cs(Fi,null,dN(o.positions,E=>(Pn(),cs("div",{key:E},[Ni(_,{transition:o.defaults.transition,class:oc(o.getClasses(E))},{default:xh(()=>[(Pn(!0),cs(Fi,null,dN(o.getPositionToasts(E),T=>(Pn(),Yr(p,hm({key:T.id},T),null,16))),128))]),_:2},1032,["transition","class"])]))),128))])}XP.render=hH;var pH=XP,WN=(o={},d=!0)=>{const p=o.eventBus=o.eventBus||new oC;d&&Qv(()=>{const T=LP(pH,kP({},o)),R=T.mount(document.createElement("div")),N=o.onMounted;if(ed(N)||N(R,T),o.shareAppContext){const D=o.shareAppContext;D===!0?console.warn(`[${zr}] App to share context with was not provided.`):(T._context.components=D._context.components,T._context.directives=D._context.directives,T._context.mixins=D._context.mixins,T._context.provides=D._context.provides,T.config.globalProperties=D.config.globalProperties)}});const _=(T,R)=>{const N=Object.assign({},{id:AW(),type:ar.DEFAULT},R,{content:T});return p.emit(cr.ADD,N),N.id};_.clear=()=>p.emit(cr.CLEAR,void 0),_.updateDefaults=T=>{p.emit(cr.UPDATE_DEFAULTS,T)},_.dismiss=T=>{p.emit(cr.DISMISS,T)};function E(T,{content:R,options:N},D=!1){const x=Object.assign({},N,{content:R});p.emit(cr.UPDATE,{id:T,options:x,create:D})}return _.update=E,_.success=(T,R)=>_(T,Object.assign({},R,{type:ar.SUCCESS})),_.info=(T,R)=>_(T,Object.assign({},R,{type:ar.INFO})),_.error=(T,R)=>_(T,Object.assign({},R,{type:ar.ERROR})),_.warning=(T,R)=>_(T,Object.assign({},R,{type:ar.WARNING})),_},fH=()=>{const o=()=>console.warn(`[${zr}] This plugin does not support SSR!`);return new Proxy(o,{get(){return o}})};function Iv(o){return NW()?DW(o)?WN({eventBus:o},!1):WN(o,!0):fH()}var $P=Symbol("VueToastification"),QP=new oC,_H=(o,d)=>{(d==null?void 0:d.shareAppContext)===!0&&(d.shareAppContext=o);const p=Iv(kP({eventBus:QP},d));o.provide($P,p)},mH=o=>{if(o)return Iv(o);const d=yP()?dr($P,void 0):void 0;return d||Iv(QP)},EH=_H,x_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gH(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function TH(o){if(o.__esModule)return o;var d=o.default;if(typeof d=="function"){var p=function _(){return this instanceof _?Reflect.construct(d,arguments,this.constructor):d.apply(this,arguments)};p.prototype=d.prototype}else p={};return Object.defineProperty(p,"__esModule",{value:!0}),Object.keys(o).forEach(function(_){var E=Object.getOwnPropertyDescriptor(o,_);Object.defineProperty(p,_,E.get?E:{enumerable:!0,get:function(){return o[_]}})}),p}var SH={exports:{}},gs="top",lr="bottom",ur="right",Ts="left",mm="auto",Vl=[gs,lr,ur,Ts],od="start",Al="end",ZP="clippingParents",aC="viewport",gl="popper",tL="reference",bv=Vl.reduce(function(o,d){return o.concat([d+"-"+od,d+"-"+Al])},[]),cC=[].concat(Vl,[mm]).reduce(function(o,d){return o.concat([d,d+"-"+od,d+"-"+Al])},[]),eL="beforeRead",nL="read",iL="afterRead",sL="beforeMain",rL="main",oL="afterMain",aL="beforeWrite",cL="write",dL="afterWrite",lL=[eL,nL,iL,sL,rL,oL,aL,cL,dL];function Po(o){return o?(o.nodeName||"").toLowerCase():null}function hr(o){if(o==null)return window;if(o.toString()!=="[object Window]"){var d=o.ownerDocument;return d&&d.defaultView||window}return o}function ad(o){var d=hr(o).Element;return o instanceof d||o instanceof Element}function wr(o){var d=hr(o).HTMLElement;return o instanceof d||o instanceof HTMLElement}function dC(o){if(typeof ShadowRoot>"u")return!1;var d=hr(o).ShadowRoot;return o instanceof d||o instanceof ShadowRoot}function vH(o){var d=o.state;Object.keys(d.elements).forEach(function(p){var _=d.styles[p]||{},E=d.attributes[p]||{},T=d.elements[p];!wr(T)||!Po(T)||(Object.assign(T.style,_),Object.keys(E).forEach(function(R){var N=E[R];N===!1?T.removeAttribute(R):T.setAttribute(R,N===!0?"":N)}))})}function CH(o){var d=o.state,p={popper:{position:d.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(d.elements.popper.style,p.popper),d.styles=p,d.elements.arrow&&Object.assign(d.elements.arrow.style,p.arrow),function(){Object.keys(d.elements).forEach(function(_){var E=d.elements[_],T=d.attributes[_]||{},R=Object.keys(d.styles.hasOwnProperty(_)?d.styles[_]:p[_]),N=R.reduce(function(D,x){return D[x]="",D},{});!wr(E)||!Po(E)||(Object.assign(E.style,N),Object.keys(T).forEach(function(D){E.removeAttribute(D)}))})}}const lC={name:"applyStyles",enabled:!0,phase:"write",fn:vH,effect:CH,requires:["computeStyles"]};function No(o){return o.split("-")[0]}var sd=Math.max,X_=Math.min,wl=Math.round;function Av(){var o=navigator.userAgentData;return o!=null&&o.brands&&Array.isArray(o.brands)?o.brands.map(function(d){return d.brand+"/"+d.version}).join(" "):navigator.userAgent}function uL(){return!/^((?!chrome|android).)*safari/i.test(Av())}function Ol(o,d,p){d===void 0&&(d=!1),p===void 0&&(p=!1);var _=o.getBoundingClientRect(),E=1,T=1;d&&wr(o)&&(E=o.offsetWidth>0&&wl(_.width)/o.offsetWidth||1,T=o.offsetHeight>0&&wl(_.height)/o.offsetHeight||1);var R=ad(o)?hr(o):window,N=R.visualViewport,D=!uL()&&p,x=(_.left+(D&&N?N.offsetLeft:0))/E,P=(_.top+(D&&N?N.offsetTop:0))/T,G=_.width/E,z=_.height/T;return{width:G,height:z,top:P,right:x+G,bottom:P+z,left:x,x,y:P}}function uC(o){var d=Ol(o),p=o.offsetWidth,_=o.offsetHeight;return Math.abs(d.width-p)<=1&&(p=d.width),Math.abs(d.height-_)<=1&&(_=d.height),{x:o.offsetLeft,y:o.offsetTop,width:p,height:_}}function hL(o,d){var p=d.getRootNode&&d.getRootNode();if(o.contains(d))return!0;if(p&&dC(p)){var _=d;do{if(_&&o.isSameNode(_))return!0;_=_.parentNode||_.host}while(_)}return!1}function ua(o){return hr(o).getComputedStyle(o)}function yH(o){return["table","td","th"].indexOf(Po(o))>=0}function cc(o){return((ad(o)?o.ownerDocument:o.document)||window.document).documentElement}function Em(o){return Po(o)==="html"?o:o.assignedSlot||o.parentNode||(dC(o)?o.host:null)||cc(o)}function HN(o){return!wr(o)||ua(o).position==="fixed"?null:o.offsetParent}function RH(o){var d=/firefox/i.test(Av()),p=/Trident/i.test(Av());if(p&&wr(o)){var _=ua(o);if(_.position==="fixed")return null}var E=Em(o);for(dC(E)&&(E=E.host);wr(E)&&["html","body"].indexOf(Po(E))<0;){var T=ua(E);if(T.transform!=="none"||T.perspective!=="none"||T.contain==="paint"||["transform","perspective"].indexOf(T.willChange)!==-1||d&&T.willChange==="filter"||d&&T.filter&&T.filter!=="none")return E;E=E.parentNode}return null}function jh(o){for(var d=hr(o),p=HN(o);p&&yH(p)&&ua(p).position==="static";)p=HN(p);return p&&(Po(p)==="html"||Po(p)==="body"&&ua(p).position==="static")?d:p||RH(o)||d}function hC(o){return["top","bottom"].indexOf(o)>=0?"x":"y"}function yh(o,d,p){return sd(o,X_(d,p))}function IH(o,d,p){var _=yh(o,d,p);return _>p?p:_}function pL(){return{top:0,right:0,bottom:0,left:0}}function fL(o){return Object.assign({},pL(),o)}function _L(o,d){return d.reduce(function(p,_){return p[_]=o,p},{})}var bH=function(d,p){return d=typeof d=="function"?d(Object.assign({},p.rects,{placement:p.placement})):d,fL(typeof d!="number"?d:_L(d,Vl))};function AH(o){var d,p=o.state,_=o.name,E=o.options,T=p.elements.arrow,R=p.modifiersData.popperOffsets,N=No(p.placement),D=hC(N),x=[Ts,ur].indexOf(N)>=0,P=x?"height":"width";if(!(!T||!R)){var G=bH(E.padding,p),z=uC(T),rt=D==="y"?gs:Ts,at=D==="y"?lr:ur,dt=p.rects.reference[P]+p.rects.reference[D]-R[D]-p.rects.popper[P],bt=R[D]-p.rects.reference[D],Ot=jh(T),Dt=Ot?D==="y"?Ot.clientHeight||0:Ot.clientWidth||0:0,Gt=dt/2-bt/2,Tt=G[rt],Kt=Dt-z[P]-G[at],Zt=Dt/2-z[P]/2+Gt,me=yh(Tt,Zt,Kt),$t=D;p.modifiersData[_]=(d={},d[$t]=me,d.centerOffset=me-Zt,d)}}function wH(o){var d=o.state,p=o.options,_=p.element,E=_===void 0?"[data-popper-arrow]":_;E!=null&&(typeof E=="string"&&(E=d.elements.popper.querySelector(E),!E)||hL(d.elements.popper,E)&&(d.elements.arrow=E))}const mL={name:"arrow",enabled:!0,phase:"main",fn:AH,effect:wH,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Nl(o){return o.split("-")[1]}var OH={top:"auto",right:"auto",bottom:"auto",left:"auto"};function NH(o,d){var p=o.x,_=o.y,E=d.devicePixelRatio||1;return{x:wl(p*E)/E||0,y:wl(_*E)/E||0}}function KN(o){var d,p=o.popper,_=o.popperRect,E=o.placement,T=o.variation,R=o.offsets,N=o.position,D=o.gpuAcceleration,x=o.adaptive,P=o.roundOffsets,G=o.isFixed,z=R.x,rt=z===void 0?0:z,at=R.y,dt=at===void 0?0:at,bt=typeof P=="function"?P({x:rt,y:dt}):{x:rt,y:dt};rt=bt.x,dt=bt.y;var Ot=R.hasOwnProperty("x"),Dt=R.hasOwnProperty("y"),Gt=Ts,Tt=gs,Kt=window;if(x){var Zt=jh(p),me="clientHeight",$t="clientWidth";if(Zt===hr(p)&&(Zt=cc(p),ua(Zt).position!=="static"&&N==="absolute"&&(me="scrollHeight",$t="scrollWidth")),Zt=Zt,E===gs||(E===Ts||E===ur)&&T===Al){Tt=lr;var Ce=G&&Zt===Kt&&Kt.visualViewport?Kt.visualViewport.height:Zt[me];dt-=Ce-_.height,dt*=D?1:-1}if(E===Ts||(E===gs||E===lr)&&T===Al){Gt=ur;var _e=G&&Zt===Kt&&Kt.visualViewport?Kt.visualViewport.width:Zt[$t];rt-=_e-_.width,rt*=D?1:-1}}var Le=Object.assign({position:N},x&&OH),qt=P===!0?NH({x:rt,y:dt},hr(p)):{x:rt,y:dt};if(rt=qt.x,dt=qt.y,D){var Ee;return Object.assign({},Le,(Ee={},Ee[Tt]=Dt?"0":"",Ee[Gt]=Ot?"0":"",Ee.transform=(Kt.devicePixelRatio||1)<=1?"translate("+rt+"px, "+dt+"px)":"translate3d("+rt+"px, "+dt+"px, 0)",Ee))}return Object.assign({},Le,(d={},d[Tt]=Dt?dt+"px":"",d[Gt]=Ot?rt+"px":"",d.transform="",d))}function DH(o){var d=o.state,p=o.options,_=p.gpuAcceleration,E=_===void 0?!0:_,T=p.adaptive,R=T===void 0?!0:T,N=p.roundOffsets,D=N===void 0?!0:N,x={placement:No(d.placement),variation:Nl(d.placement),popper:d.elements.popper,popperRect:d.rects.popper,gpuAcceleration:E,isFixed:d.options.strategy==="fixed"};d.modifiersData.popperOffsets!=null&&(d.styles.popper=Object.assign({},d.styles.popper,KN(Object.assign({},x,{offsets:d.modifiersData.popperOffsets,position:d.options.strategy,adaptive:R,roundOffsets:D})))),d.modifiersData.arrow!=null&&(d.styles.arrow=Object.assign({},d.styles.arrow,KN(Object.assign({},x,{offsets:d.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:D})))),d.attributes.popper=Object.assign({},d.attributes.popper,{"data-popper-placement":d.placement})}const pC={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:DH,data:{}};var A_={passive:!0};function PH(o){var d=o.state,p=o.instance,_=o.options,E=_.scroll,T=E===void 0?!0:E,R=_.resize,N=R===void 0?!0:R,D=hr(d.elements.popper),x=[].concat(d.scrollParents.reference,d.scrollParents.popper);return T&&x.forEach(function(P){P.addEventListener("scroll",p.update,A_)}),N&&D.addEventListener("resize",p.update,A_),function(){T&&x.forEach(function(P){P.removeEventListener("scroll",p.update,A_)}),N&&D.removeEventListener("resize",p.update,A_)}}const fC={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:PH,data:{}};var LH={left:"right",right:"left",bottom:"top",top:"bottom"};function V_(o){return o.replace(/left|right|bottom|top/g,function(d){return LH[d]})}var kH={start:"end",end:"start"};function qN(o){return o.replace(/start|end/g,function(d){return kH[d]})}function _C(o){var d=hr(o),p=d.pageXOffset,_=d.pageYOffset;return{scrollLeft:p,scrollTop:_}}function mC(o){return Ol(cc(o)).left+_C(o).scrollLeft}function MH(o,d){var p=hr(o),_=cc(o),E=p.visualViewport,T=_.clientWidth,R=_.clientHeight,N=0,D=0;if(E){T=E.width,R=E.height;var x=uL();(x||!x&&d==="fixed")&&(N=E.offsetLeft,D=E.offsetTop)}return{width:T,height:R,x:N+mC(o),y:D}}function UH(o){var d,p=cc(o),_=_C(o),E=(d=o.ownerDocument)==null?void 0:d.body,T=sd(p.scrollWidth,p.clientWidth,E?E.scrollWidth:0,E?E.clientWidth:0),R=sd(p.scrollHeight,p.clientHeight,E?E.scrollHeight:0,E?E.clientHeight:0),N=-_.scrollLeft+mC(o),D=-_.scrollTop;return ua(E||p).direction==="rtl"&&(N+=sd(p.clientWidth,E?E.clientWidth:0)-T),{width:T,height:R,x:N,y:D}}function EC(o){var d=ua(o),p=d.overflow,_=d.overflowX,E=d.overflowY;return/auto|scroll|overlay|hidden/.test(p+E+_)}function EL(o){return["html","body","#document"].indexOf(Po(o))>=0?o.ownerDocument.body:wr(o)&&EC(o)?o:EL(Em(o))}function Rh(o,d){var p;d===void 0&&(d=[]);var _=EL(o),E=_===((p=o.ownerDocument)==null?void 0:p.body),T=hr(_),R=E?[T].concat(T.visualViewport||[],EC(_)?_:[]):_,N=d.concat(R);return E?N:N.concat(Rh(Em(R)))}function wv(o){return Object.assign({},o,{left:o.x,top:o.y,right:o.x+o.width,bottom:o.y+o.height})}function xH(o,d){var p=Ol(o,!1,d==="fixed");return p.top=p.top+o.clientTop,p.left=p.left+o.clientLeft,p.bottom=p.top+o.clientHeight,p.right=p.left+o.clientWidth,p.width=o.clientWidth,p.height=o.clientHeight,p.x=p.left,p.y=p.top,p}function YN(o,d,p){return d===aC?wv(MH(o,p)):ad(d)?xH(d,p):wv(UH(cc(o)))}function VH(o){var d=Rh(Em(o)),p=["absolute","fixed"].indexOf(ua(o).position)>=0,_=p&&wr(o)?jh(o):o;return ad(_)?d.filter(function(E){return ad(E)&&hL(E,_)&&Po(E)!=="body"}):[]}function FH(o,d,p,_){var E=d==="clippingParents"?VH(o):[].concat(d),T=[].concat(E,[p]),R=T[0],N=T.reduce(function(D,x){var P=YN(o,x,_);return D.top=sd(P.top,D.top),D.right=X_(P.right,D.right),D.bottom=X_(P.bottom,D.bottom),D.left=sd(P.left,D.left),D},YN(o,R,_));return N.width=N.right-N.left,N.height=N.bottom-N.top,N.x=N.left,N.y=N.top,N}function gL(o){var d=o.reference,p=o.element,_=o.placement,E=_?No(_):null,T=_?Nl(_):null,R=d.x+d.width/2-p.width/2,N=d.y+d.height/2-p.height/2,D;switch(E){case gs:D={x:R,y:d.y-p.height};break;case lr:D={x:R,y:d.y+d.height};break;case ur:D={x:d.x+d.width,y:N};break;case Ts:D={x:d.x-p.width,y:N};break;default:D={x:d.x,y:d.y}}var x=E?hC(E):null;if(x!=null){var P=x==="y"?"height":"width";switch(T){case od:D[x]=D[x]-(d[P]/2-p[P]/2);break;case Al:D[x]=D[x]+(d[P]/2-p[P]/2);break}}return D}function Dl(o,d){d===void 0&&(d={});var p=d,_=p.placement,E=_===void 0?o.placement:_,T=p.strategy,R=T===void 0?o.strategy:T,N=p.boundary,D=N===void 0?ZP:N,x=p.rootBoundary,P=x===void 0?aC:x,G=p.elementContext,z=G===void 0?gl:G,rt=p.altBoundary,at=rt===void 0?!1:rt,dt=p.padding,bt=dt===void 0?0:dt,Ot=fL(typeof bt!="number"?bt:_L(bt,Vl)),Dt=z===gl?tL:gl,Gt=o.rects.popper,Tt=o.elements[at?Dt:z],Kt=FH(ad(Tt)?Tt:Tt.contextElement||cc(o.elements.popper),D,P,R),Zt=Ol(o.elements.reference),me=gL({reference:Zt,element:Gt,strategy:"absolute",placement:E}),$t=wv(Object.assign({},Gt,me)),Ce=z===gl?$t:Zt,_e={top:Kt.top-Ce.top+Ot.top,bottom:Ce.bottom-Kt.bottom+Ot.bottom,left:Kt.left-Ce.left+Ot.left,right:Ce.right-Kt.right+Ot.right},Le=o.modifiersData.offset;if(z===gl&&Le){var qt=Le[E];Object.keys(_e).forEach(function(Ee){var Sn=[ur,lr].indexOf(Ee)>=0?1:-1,Qn=[gs,lr].indexOf(Ee)>=0?"y":"x";_e[Ee]+=qt[Qn]*Sn})}return _e}function BH(o,d){d===void 0&&(d={});var p=d,_=p.placement,E=p.boundary,T=p.rootBoundary,R=p.padding,N=p.flipVariations,D=p.allowedAutoPlacements,x=D===void 0?cC:D,P=Nl(_),G=P?N?bv:bv.filter(function(at){return Nl(at)===P}):Vl,z=G.filter(function(at){return x.indexOf(at)>=0});z.length===0&&(z=G);var rt=z.reduce(function(at,dt){return at[dt]=Dl(o,{placement:dt,boundary:E,rootBoundary:T,padding:R})[No(dt)],at},{});return Object.keys(rt).sort(function(at,dt){return rt[at]-rt[dt]})}function jH(o){if(No(o)===mm)return[];var d=V_(o);return[qN(o),d,qN(d)]}function GH(o){var d=o.state,p=o.options,_=o.name;if(!d.modifiersData[_]._skip){for(var E=p.mainAxis,T=E===void 0?!0:E,R=p.altAxis,N=R===void 0?!0:R,D=p.fallbackPlacements,x=p.padding,P=p.boundary,G=p.rootBoundary,z=p.altBoundary,rt=p.flipVariations,at=rt===void 0?!0:rt,dt=p.allowedAutoPlacements,bt=d.options.placement,Ot=No(bt),Dt=Ot===bt,Gt=D||(Dt||!at?[V_(bt)]:jH(bt)),Tt=[bt].concat(Gt).reduce(function(mi,bi){return mi.concat(No(bi)===mm?BH(d,{placement:bi,boundary:P,rootBoundary:G,padding:x,flipVariations:at,allowedAutoPlacements:dt}):bi)},[]),Kt=d.rects.reference,Zt=d.rects.popper,me=new Map,$t=!0,Ce=Tt[0],_e=0;_e<Tt.length;_e++){var Le=Tt[_e],qt=No(Le),Ee=Nl(Le)===od,Sn=[gs,lr].indexOf(qt)>=0,Qn=Sn?"width":"height",xe=Dl(d,{placement:Le,boundary:P,rootBoundary:G,altBoundary:z,padding:x}),Ne=Sn?Ee?ur:Ts:Ee?lr:gs;Kt[Qn]>Zt[Qn]&&(Ne=V_(Ne));var Ve=V_(Ne),Zn=[];if(T&&Zn.push(xe[qt]<=0),N&&Zn.push(xe[Ne]<=0,xe[Ve]<=0),Zn.every(function(mi){return mi})){Ce=Le,$t=!1;break}me.set(Le,Zn)}if($t)for(var _i=at?3:1,Ii=function(bi){var mn=Tt.find(function(pt){var jt=me.get(pt);if(jt)return jt.slice(0,bi).every(function(Lt){return Lt})});if(mn)return Ce=mn,"break"},Ln=_i;Ln>0;Ln--){var gt=Ii(Ln);if(gt==="break")break}d.placement!==Ce&&(d.modifiersData[_]._skip=!0,d.placement=Ce,d.reset=!0)}}const TL={name:"flip",enabled:!0,phase:"main",fn:GH,requiresIfExists:["offset"],data:{_skip:!1}};function zN(o,d,p){return p===void 0&&(p={x:0,y:0}),{top:o.top-d.height-p.y,right:o.right-d.width+p.x,bottom:o.bottom-d.height+p.y,left:o.left-d.width-p.x}}function JN(o){return[gs,ur,lr,Ts].some(function(d){return o[d]>=0})}function WH(o){var d=o.state,p=o.name,_=d.rects.reference,E=d.rects.popper,T=d.modifiersData.preventOverflow,R=Dl(d,{elementContext:"reference"}),N=Dl(d,{altBoundary:!0}),D=zN(R,_),x=zN(N,E,T),P=JN(D),G=JN(x);d.modifiersData[p]={referenceClippingOffsets:D,popperEscapeOffsets:x,isReferenceHidden:P,hasPopperEscaped:G},d.attributes.popper=Object.assign({},d.attributes.popper,{"data-popper-reference-hidden":P,"data-popper-escaped":G})}const SL={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:WH};function HH(o,d,p){var _=No(o),E=[Ts,gs].indexOf(_)>=0?-1:1,T=typeof p=="function"?p(Object.assign({},d,{placement:o})):p,R=T[0],N=T[1];return R=R||0,N=(N||0)*E,[Ts,ur].indexOf(_)>=0?{x:N,y:R}:{x:R,y:N}}function KH(o){var d=o.state,p=o.options,_=o.name,E=p.offset,T=E===void 0?[0,0]:E,R=cC.reduce(function(P,G){return P[G]=HH(G,d.rects,T),P},{}),N=R[d.placement],D=N.x,x=N.y;d.modifiersData.popperOffsets!=null&&(d.modifiersData.popperOffsets.x+=D,d.modifiersData.popperOffsets.y+=x),d.modifiersData[_]=R}const vL={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:KH};function qH(o){var d=o.state,p=o.name;d.modifiersData[p]=gL({reference:d.rects.reference,element:d.rects.popper,strategy:"absolute",placement:d.placement})}const gC={name:"popperOffsets",enabled:!0,phase:"read",fn:qH,data:{}};function YH(o){return o==="x"?"y":"x"}function zH(o){var d=o.state,p=o.options,_=o.name,E=p.mainAxis,T=E===void 0?!0:E,R=p.altAxis,N=R===void 0?!1:R,D=p.boundary,x=p.rootBoundary,P=p.altBoundary,G=p.padding,z=p.tether,rt=z===void 0?!0:z,at=p.tetherOffset,dt=at===void 0?0:at,bt=Dl(d,{boundary:D,rootBoundary:x,padding:G,altBoundary:P}),Ot=No(d.placement),Dt=Nl(d.placement),Gt=!Dt,Tt=hC(Ot),Kt=YH(Tt),Zt=d.modifiersData.popperOffsets,me=d.rects.reference,$t=d.rects.popper,Ce=typeof dt=="function"?dt(Object.assign({},d.rects,{placement:d.placement})):dt,_e=typeof Ce=="number"?{mainAxis:Ce,altAxis:Ce}:Object.assign({mainAxis:0,altAxis:0},Ce),Le=d.modifiersData.offset?d.modifiersData.offset[d.placement]:null,qt={x:0,y:0};if(Zt){if(T){var Ee,Sn=Tt==="y"?gs:Ts,Qn=Tt==="y"?lr:ur,xe=Tt==="y"?"height":"width",Ne=Zt[Tt],Ve=Ne+bt[Sn],Zn=Ne-bt[Qn],_i=rt?-$t[xe]/2:0,Ii=Dt===od?me[xe]:$t[xe],Ln=Dt===od?-$t[xe]:-me[xe],gt=d.elements.arrow,mi=rt&&gt?uC(gt):{width:0,height:0},bi=d.modifiersData["arrow#persistent"]?d.modifiersData["arrow#persistent"].padding:pL(),mn=bi[Sn],pt=bi[Qn],jt=yh(0,me[xe],mi[xe]),Lt=Gt?me[xe]/2-_i-jt-mn-_e.mainAxis:Ii-jt-mn-_e.mainAxis,ee=Gt?-me[xe]/2+_i+jt+pt+_e.mainAxis:Ln+jt+pt+_e.mainAxis,kt=d.elements.arrow&&jh(d.elements.arrow),H=kt?Tt==="y"?kt.clientTop||0:kt.clientLeft||0:0,Y=(Ee=Le==null?void 0:Le[Tt])!=null?Ee:0,st=Ne+Lt-Y-H,ft=Ne+ee-Y,mt=yh(rt?X_(Ve,st):Ve,Ne,rt?sd(Zn,ft):Zn);Zt[Tt]=mt,qt[Tt]=mt-Ne}if(N){var Rt,Wt=Tt==="x"?gs:Ts,Nt=Tt==="x"?lr:ur,Mt=Zt[Kt],It=Kt==="y"?"height":"width",ne=Mt+bt[Wt],zt=Mt-bt[Nt],ie=[gs,Ts].indexOf(Ot)!==-1,fe=(Rt=Le==null?void 0:Le[Kt])!=null?Rt:0,Ae=ie?ne:Mt-me[It]-$t[It]-fe+_e.altAxis,Xe=ie?Mt+me[It]+$t[It]-fe-_e.altAxis:zt,se=rt&&ie?IH(Ae,Mt,Xe):yh(rt?Ae:ne,Mt,rt?Xe:zt);Zt[Kt]=se,qt[Kt]=se-Mt}d.modifiersData[_]=qt}}const CL={name:"preventOverflow",enabled:!0,phase:"main",fn:zH,requiresIfExists:["offset"]};function JH(o){return{scrollLeft:o.scrollLeft,scrollTop:o.scrollTop}}function XH(o){return o===hr(o)||!wr(o)?_C(o):JH(o)}function $H(o){var d=o.getBoundingClientRect(),p=wl(d.width)/o.offsetWidth||1,_=wl(d.height)/o.offsetHeight||1;return p!==1||_!==1}function QH(o,d,p){p===void 0&&(p=!1);var _=wr(d),E=wr(d)&&$H(d),T=cc(d),R=Ol(o,E,p),N={scrollLeft:0,scrollTop:0},D={x:0,y:0};return(_||!_&&!p)&&((Po(d)!=="body"||EC(T))&&(N=XH(d)),wr(d)?(D=Ol(d,!0),D.x+=d.clientLeft,D.y+=d.clientTop):T&&(D.x=mC(T))),{x:R.left+N.scrollLeft-D.x,y:R.top+N.scrollTop-D.y,width:R.width,height:R.height}}function ZH(o){var d=new Map,p=new Set,_=[];o.forEach(function(T){d.set(T.name,T)});function E(T){p.add(T.name);var R=[].concat(T.requires||[],T.requiresIfExists||[]);R.forEach(function(N){if(!p.has(N)){var D=d.get(N);D&&E(D)}}),_.push(T)}return o.forEach(function(T){p.has(T.name)||E(T)}),_}function t6(o){var d=ZH(o);return lL.reduce(function(p,_){return p.concat(d.filter(function(E){return E.phase===_}))},[])}function e6(o){var d;return function(){return d||(d=new Promise(function(p){Promise.resolve().then(function(){d=void 0,p(o())})})),d}}function n6(o){var d=o.reduce(function(p,_){var E=p[_.name];return p[_.name]=E?Object.assign({},E,_,{options:Object.assign({},E.options,_.options),data:Object.assign({},E.data,_.data)}):_,p},{});return Object.keys(d).map(function(p){return d[p]})}var XN={placement:"bottom",modifiers:[],strategy:"absolute"};function $N(){for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return!d.some(function(_){return!(_&&typeof _.getBoundingClientRect=="function")})}function gm(o){o===void 0&&(o={});var d=o,p=d.defaultModifiers,_=p===void 0?[]:p,E=d.defaultOptions,T=E===void 0?XN:E;return function(N,D,x){x===void 0&&(x=T);var P={placement:"bottom",orderedModifiers:[],options:Object.assign({},XN,T),modifiersData:{},elements:{reference:N,popper:D},attributes:{},styles:{}},G=[],z=!1,rt={state:P,setOptions:function(Ot){var Dt=typeof Ot=="function"?Ot(P.options):Ot;dt(),P.options=Object.assign({},T,P.options,Dt),P.scrollParents={reference:ad(N)?Rh(N):N.contextElement?Rh(N.contextElement):[],popper:Rh(D)};var Gt=t6(n6([].concat(_,P.options.modifiers)));return P.orderedModifiers=Gt.filter(function(Tt){return Tt.enabled}),at(),rt.update()},forceUpdate:function(){if(!z){var Ot=P.elements,Dt=Ot.reference,Gt=Ot.popper;if($N(Dt,Gt)){P.rects={reference:QH(Dt,jh(Gt),P.options.strategy==="fixed"),popper:uC(Gt)},P.reset=!1,P.placement=P.options.placement,P.orderedModifiers.forEach(function(_e){return P.modifiersData[_e.name]=Object.assign({},_e.data)});for(var Tt=0;Tt<P.orderedModifiers.length;Tt++){if(P.reset===!0){P.reset=!1,Tt=-1;continue}var Kt=P.orderedModifiers[Tt],Zt=Kt.fn,me=Kt.options,$t=me===void 0?{}:me,Ce=Kt.name;typeof Zt=="function"&&(P=Zt({state:P,options:$t,name:Ce,instance:rt})||P)}}}},update:e6(function(){return new Promise(function(bt){rt.forceUpdate(),bt(P)})}),destroy:function(){dt(),z=!0}};if(!$N(N,D))return rt;rt.setOptions(x).then(function(bt){!z&&x.onFirstUpdate&&x.onFirstUpdate(bt)});function at(){P.orderedModifiers.forEach(function(bt){var Ot=bt.name,Dt=bt.options,Gt=Dt===void 0?{}:Dt,Tt=bt.effect;if(typeof Tt=="function"){var Kt=Tt({state:P,name:Ot,instance:rt,options:Gt}),Zt=function(){};G.push(Kt||Zt)}})}function dt(){G.forEach(function(bt){return bt()}),G=[]}return rt}}var i6=gm(),s6=[fC,gC,pC,lC],r6=gm({defaultModifiers:s6}),o6=[fC,gC,pC,lC,vL,TL,CL,mL,SL],a6=gm({defaultModifiers:o6});const c6=Object.freeze(Object.defineProperty({__proto__:null,afterMain:oL,afterRead:iL,afterWrite:dL,applyStyles:lC,arrow:mL,auto:mm,basePlacements:Vl,beforeMain:sL,beforeRead:eL,beforeWrite:aL,bottom:lr,clippingParents:ZP,computeStyles:pC,createPopper:a6,createPopperBase:i6,createPopperLite:r6,detectOverflow:Dl,end:Al,eventListeners:fC,flip:TL,hide:SL,left:Ts,main:rL,modifierPhases:lL,offset:vL,placements:cC,popper:gl,popperGenerator:gm,popperOffsets:gC,preventOverflow:CL,read:nL,reference:tL,right:ur,start:od,top:gs,variationPlacements:bv,viewport:aC,write:cL},Symbol.toStringTag,{value:"Module"})),d6=TH(c6);/*!
  * Bootstrap v5.3.2 (https://getbootstrap.com/)
  * Copyright 2011-2023 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(o,d){(function(p,_){o.exports=_(d6)})(x_,function(p){function _(X){const C=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(X){for(const k in X)if(k!=="default"){const J=Object.getOwnPropertyDescriptor(X,k);Object.defineProperty(C,k,J.get?J:{enumerable:!0,get:()=>X[k]})}}return C.default=X,Object.freeze(C)}const E=_(p),T=new Map,R={set(X,C,k){T.has(X)||T.set(X,new Map);const J=T.get(X);J.has(C)||J.size===0?J.set(C,k):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(J.keys())[0]}.`)},get:(X,C)=>T.has(X)&&T.get(X).get(C)||null,remove(X,C){if(!T.has(X))return;const k=T.get(X);k.delete(C),k.size===0&&T.delete(X)}},N="transitionend",D=X=>(X&&window.CSS&&window.CSS.escape&&(X=X.replace(/#([^\s"#']+)/g,(C,k)=>`#${CSS.escape(k)}`)),X),x=X=>{X.dispatchEvent(new Event(N))},P=X=>!(!X||typeof X!="object")&&(X.jquery!==void 0&&(X=X[0]),X.nodeType!==void 0),G=X=>P(X)?X.jquery?X[0]:X:typeof X=="string"&&X.length>0?document.querySelector(D(X)):null,z=X=>{if(!P(X)||X.getClientRects().length===0)return!1;const C=getComputedStyle(X).getPropertyValue("visibility")==="visible",k=X.closest("details:not([open])");if(!k)return C;if(k!==X){const J=X.closest("summary");if(J&&J.parentNode!==k||J===null)return!1}return C},rt=X=>!X||X.nodeType!==Node.ELEMENT_NODE||!!X.classList.contains("disabled")||(X.disabled!==void 0?X.disabled:X.hasAttribute("disabled")&&X.getAttribute("disabled")!=="false"),at=X=>{if(!document.documentElement.attachShadow)return null;if(typeof X.getRootNode=="function"){const C=X.getRootNode();return C instanceof ShadowRoot?C:null}return X instanceof ShadowRoot?X:X.parentNode?at(X.parentNode):null},dt=()=>{},bt=X=>{X.offsetHeight},Ot=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Dt=[],Gt=()=>document.documentElement.dir==="rtl",Tt=X=>{var C;C=()=>{const k=Ot();if(k){const J=X.NAME,Et=k.fn[J];k.fn[J]=X.jQueryInterface,k.fn[J].Constructor=X,k.fn[J].noConflict=()=>(k.fn[J]=Et,X.jQueryInterface)}},document.readyState==="loading"?(Dt.length||document.addEventListener("DOMContentLoaded",()=>{for(const k of Dt)k()}),Dt.push(C)):C()},Kt=(X,C=[],k=X)=>typeof X=="function"?X(...C):k,Zt=(X,C,k=!0)=>{if(!k)return void Kt(X);const J=(te=>{if(!te)return 0;let{transitionDuration:Ye,transitionDelay:xn}=window.getComputedStyle(te);const Wi=Number.parseFloat(Ye),ls=Number.parseFloat(xn);return Wi||ls?(Ye=Ye.split(",")[0],xn=xn.split(",")[0],1e3*(Number.parseFloat(Ye)+Number.parseFloat(xn))):0})(C)+5;let Et=!1;const Bt=({target:te})=>{te===C&&(Et=!0,C.removeEventListener(N,Bt),Kt(X))};C.addEventListener(N,Bt),setTimeout(()=>{Et||x(C)},J)},me=(X,C,k,J)=>{const Et=X.length;let Bt=X.indexOf(C);return Bt===-1?!k&&J?X[Et-1]:X[0]:(Bt+=k?1:-1,J&&(Bt=(Bt+Et)%Et),X[Math.max(0,Math.min(Bt,Et-1))])},$t=/[^.]*(?=\..*)\.|.*/,Ce=/\..*/,_e=/::\d+$/,Le={};let qt=1;const Ee={mouseenter:"mouseover",mouseleave:"mouseout"},Sn=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function Qn(X,C){return C&&`${C}::${qt++}`||X.uidEvent||qt++}function xe(X){const C=Qn(X);return X.uidEvent=C,Le[C]=Le[C]||{},Le[C]}function Ne(X,C,k=null){return Object.values(X).find(J=>J.callable===C&&J.delegationSelector===k)}function Ve(X,C,k){const J=typeof C=="string",Et=J?k:C||k;let Bt=Ln(X);return Sn.has(Bt)||(Bt=X),[J,Et,Bt]}function Zn(X,C,k,J,Et){if(typeof C!="string"||!X)return;let[Bt,te,Ye]=Ve(C,k,J);C in Ee&&(te=(jo=>function(Ks){if(!Ks.relatedTarget||Ks.relatedTarget!==Ks.delegateTarget&&!Ks.delegateTarget.contains(Ks.relatedTarget))return jo.call(this,Ks)})(te));const xn=xe(X),Wi=xn[Ye]||(xn[Ye]={}),ls=Ne(Wi,te,Bt?k:null);if(ls)return void(ls.oneOff=ls.oneOff&&Et);const Hs=Qn(te,C.replace($t,"")),kr=Bt?function(Hi,jo,Ks){return function gc(Tc){const yp=Hi.querySelectorAll(jo);for(let{target:Go}=Tc;Go&&Go!==this;Go=Go.parentNode)for(const CE of yp)if(CE===Go)return mi(Tc,{delegateTarget:Go}),gc.oneOff&&gt.off(Hi,Tc.type,jo,Ks),Ks.apply(Go,[Tc])}}(X,k,te):function(Hi,jo){return function Ks(gc){return mi(gc,{delegateTarget:Hi}),Ks.oneOff&&gt.off(Hi,gc.type,jo),jo.apply(Hi,[gc])}}(X,te);kr.delegationSelector=Bt?k:null,kr.callable=te,kr.oneOff=Et,kr.uidEvent=Hs,Wi[Hs]=kr,X.addEventListener(Ye,kr,Bt)}function _i(X,C,k,J,Et){const Bt=Ne(C[k],J,Et);Bt&&(X.removeEventListener(k,Bt,!!Et),delete C[k][Bt.uidEvent])}function Ii(X,C,k,J){const Et=C[k]||{};for(const[Bt,te]of Object.entries(Et))Bt.includes(J)&&_i(X,C,k,te.callable,te.delegationSelector)}function Ln(X){return X=X.replace(Ce,""),Ee[X]||X}const gt={on(X,C,k,J){Zn(X,C,k,J,!1)},one(X,C,k,J){Zn(X,C,k,J,!0)},off(X,C,k,J){if(typeof C!="string"||!X)return;const[Et,Bt,te]=Ve(C,k,J),Ye=te!==C,xn=xe(X),Wi=xn[te]||{},ls=C.startsWith(".");if(Bt===void 0){if(ls)for(const Hs of Object.keys(xn))Ii(X,xn,Hs,C.slice(1));for(const[Hs,kr]of Object.entries(Wi)){const Hi=Hs.replace(_e,"");Ye&&!C.includes(Hi)||_i(X,xn,te,kr.callable,kr.delegationSelector)}}else{if(!Object.keys(Wi).length)return;_i(X,xn,te,Bt,Et?k:null)}},trigger(X,C,k){if(typeof C!="string"||!X)return null;const J=Ot();let Et=null,Bt=!0,te=!0,Ye=!1;C!==Ln(C)&&J&&(Et=J.Event(C,k),J(X).trigger(Et),Bt=!Et.isPropagationStopped(),te=!Et.isImmediatePropagationStopped(),Ye=Et.isDefaultPrevented());const xn=mi(new Event(C,{bubbles:Bt,cancelable:!0}),k);return Ye&&xn.preventDefault(),te&&X.dispatchEvent(xn),xn.defaultPrevented&&Et&&Et.preventDefault(),xn}};function mi(X,C={}){for(const[k,J]of Object.entries(C))try{X[k]=J}catch{Object.defineProperty(X,k,{configurable:!0,get:()=>J})}return X}function bi(X){if(X==="true")return!0;if(X==="false")return!1;if(X===Number(X).toString())return Number(X);if(X===""||X==="null")return null;if(typeof X!="string")return X;try{return JSON.parse(decodeURIComponent(X))}catch{return X}}function mn(X){return X.replace(/[A-Z]/g,C=>`-${C.toLowerCase()}`)}const pt={setDataAttribute(X,C,k){X.setAttribute(`data-bs-${mn(C)}`,k)},removeDataAttribute(X,C){X.removeAttribute(`data-bs-${mn(C)}`)},getDataAttributes(X){if(!X)return{};const C={},k=Object.keys(X.dataset).filter(J=>J.startsWith("bs")&&!J.startsWith("bsConfig"));for(const J of k){let Et=J.replace(/^bs/,"");Et=Et.charAt(0).toLowerCase()+Et.slice(1,Et.length),C[Et]=bi(X.dataset[J])}return C},getDataAttribute:(X,C)=>bi(X.getAttribute(`data-bs-${mn(C)}`))};class jt{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(C){return C=this._mergeConfigObj(C),C=this._configAfterMerge(C),this._typeCheckConfig(C),C}_configAfterMerge(C){return C}_mergeConfigObj(C,k){const J=P(k)?pt.getDataAttribute(k,"config"):{};return{...this.constructor.Default,...typeof J=="object"?J:{},...P(k)?pt.getDataAttributes(k):{},...typeof C=="object"?C:{}}}_typeCheckConfig(C,k=this.constructor.DefaultType){for(const[Et,Bt]of Object.entries(k)){const te=C[Et],Ye=P(te)?"element":(J=te)==null?`${J}`:Object.prototype.toString.call(J).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(Bt).test(Ye))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${Et}" provided type "${Ye}" but expected type "${Bt}".`)}var J}}class Lt extends jt{constructor(C,k){super(),(C=G(C))&&(this._element=C,this._config=this._getConfig(k),R.set(this._element,this.constructor.DATA_KEY,this))}dispose(){R.remove(this._element,this.constructor.DATA_KEY),gt.off(this._element,this.constructor.EVENT_KEY);for(const C of Object.getOwnPropertyNames(this))this[C]=null}_queueCallback(C,k,J=!0){Zt(C,k,J)}_getConfig(C){return C=this._mergeConfigObj(C,this._element),C=this._configAfterMerge(C),this._typeCheckConfig(C),C}static getInstance(C){return R.get(G(C),this.DATA_KEY)}static getOrCreateInstance(C,k={}){return this.getInstance(C)||new this(C,typeof k=="object"?k:null)}static get VERSION(){return"5.3.2"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(C){return`${C}${this.EVENT_KEY}`}}const ee=X=>{let C=X.getAttribute("data-bs-target");if(!C||C==="#"){let k=X.getAttribute("href");if(!k||!k.includes("#")&&!k.startsWith("."))return null;k.includes("#")&&!k.startsWith("#")&&(k=`#${k.split("#")[1]}`),C=k&&k!=="#"?D(k.trim()):null}return C},kt={find:(X,C=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(C,X)),findOne:(X,C=document.documentElement)=>Element.prototype.querySelector.call(C,X),children:(X,C)=>[].concat(...X.children).filter(k=>k.matches(C)),parents(X,C){const k=[];let J=X.parentNode.closest(C);for(;J;)k.push(J),J=J.parentNode.closest(C);return k},prev(X,C){let k=X.previousElementSibling;for(;k;){if(k.matches(C))return[k];k=k.previousElementSibling}return[]},next(X,C){let k=X.nextElementSibling;for(;k;){if(k.matches(C))return[k];k=k.nextElementSibling}return[]},focusableChildren(X){const C=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(k=>`${k}:not([tabindex^="-"])`).join(",");return this.find(C,X).filter(k=>!rt(k)&&z(k))},getSelectorFromElement(X){const C=ee(X);return C&&kt.findOne(C)?C:null},getElementFromSelector(X){const C=ee(X);return C?kt.findOne(C):null},getMultipleElementsFromSelector(X){const C=ee(X);return C?kt.find(C):[]}},H=(X,C="hide")=>{const k=`click.dismiss${X.EVENT_KEY}`,J=X.NAME;gt.on(document,k,`[data-bs-dismiss="${J}"]`,function(Et){if(["A","AREA"].includes(this.tagName)&&Et.preventDefault(),rt(this))return;const Bt=kt.getElementFromSelector(this)||this.closest(`.${J}`);X.getOrCreateInstance(Bt)[C]()})},Y=".bs.alert",st=`close${Y}`,ft=`closed${Y}`;class mt extends Lt{static get NAME(){return"alert"}close(){if(gt.trigger(this._element,st).defaultPrevented)return;this._element.classList.remove("show");const C=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,C)}_destroyElement(){this._element.remove(),gt.trigger(this._element,ft),this.dispose()}static jQueryInterface(C){return this.each(function(){const k=mt.getOrCreateInstance(this);if(typeof C=="string"){if(k[C]===void 0||C.startsWith("_")||C==="constructor")throw new TypeError(`No method named "${C}"`);k[C](this)}})}}H(mt,"close"),Tt(mt);const Rt='[data-bs-toggle="button"]';class Wt extends Lt{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(C){return this.each(function(){const k=Wt.getOrCreateInstance(this);C==="toggle"&&k[C]()})}}gt.on(document,"click.bs.button.data-api",Rt,X=>{X.preventDefault();const C=X.target.closest(Rt);Wt.getOrCreateInstance(C).toggle()}),Tt(Wt);const Nt=".bs.swipe",Mt=`touchstart${Nt}`,It=`touchmove${Nt}`,ne=`touchend${Nt}`,zt=`pointerdown${Nt}`,ie=`pointerup${Nt}`,fe={endCallback:null,leftCallback:null,rightCallback:null},Ae={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Xe extends jt{constructor(C,k){super(),this._element=C,C&&Xe.isSupported()&&(this._config=this._getConfig(k),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return fe}static get DefaultType(){return Ae}static get NAME(){return"swipe"}dispose(){gt.off(this._element,Nt)}_start(C){this._supportPointerEvents?this._eventIsPointerPenTouch(C)&&(this._deltaX=C.clientX):this._deltaX=C.touches[0].clientX}_end(C){this._eventIsPointerPenTouch(C)&&(this._deltaX=C.clientX-this._deltaX),this._handleSwipe(),Kt(this._config.endCallback)}_move(C){this._deltaX=C.touches&&C.touches.length>1?0:C.touches[0].clientX-this._deltaX}_handleSwipe(){const C=Math.abs(this._deltaX);if(C<=40)return;const k=C/this._deltaX;this._deltaX=0,k&&Kt(k>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(gt.on(this._element,zt,C=>this._start(C)),gt.on(this._element,ie,C=>this._end(C)),this._element.classList.add("pointer-event")):(gt.on(this._element,Mt,C=>this._start(C)),gt.on(this._element,It,C=>this._move(C)),gt.on(this._element,ne,C=>this._end(C)))}_eventIsPointerPenTouch(C){return this._supportPointerEvents&&(C.pointerType==="pen"||C.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const se=".bs.carousel",vn=".data-api",Ei="next",Ji="prev",Ws="left",pr="right",Cn=`slide${se}`,En=`slid${se}`,ji=`keydown${se}`,ti=`mouseenter${se}`,bm=`mouseleave${se}`,Hh=`dragstart${se}`,Kh=`load${se}${vn}`,qh=`click${se}${vn}`,ld="carousel",dc="active",Yh=".active",zh=".carousel-item",$r=Yh+zh,Am={ArrowLeft:pr,ArrowRight:Ws},wm={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Bl={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Qr extends Lt{constructor(C,k){super(C,k),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=kt.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===ld&&this.cycle()}static get Default(){return wm}static get DefaultType(){return Bl}static get NAME(){return"carousel"}next(){this._slide(Ei)}nextWhenVisible(){!document.hidden&&z(this._element)&&this.next()}prev(){this._slide(Ji)}pause(){this._isSliding&&x(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?gt.one(this._element,En,()=>this.cycle()):this.cycle())}to(C){const k=this._getItems();if(C>k.length-1||C<0)return;if(this._isSliding)return void gt.one(this._element,En,()=>this.to(C));const J=this._getItemIndex(this._getActive());if(J===C)return;const Et=C>J?Ei:Ji;this._slide(Et,k[C])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(C){return C.defaultInterval=C.interval,C}_addEventListeners(){this._config.keyboard&&gt.on(this._element,ji,C=>this._keydown(C)),this._config.pause==="hover"&&(gt.on(this._element,ti,()=>this.pause()),gt.on(this._element,bm,()=>this._maybeEnableCycle())),this._config.touch&&Xe.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const k of kt.find(".carousel-item img",this._element))gt.on(k,Hh,J=>J.preventDefault());const C={leftCallback:()=>this._slide(this._directionToOrder(Ws)),rightCallback:()=>this._slide(this._directionToOrder(pr)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new Xe(this._element,C)}_keydown(C){if(/input|textarea/i.test(C.target.tagName))return;const k=Am[C.key];k&&(C.preventDefault(),this._slide(this._directionToOrder(k)))}_getItemIndex(C){return this._getItems().indexOf(C)}_setActiveIndicatorElement(C){if(!this._indicatorsElement)return;const k=kt.findOne(Yh,this._indicatorsElement);k.classList.remove(dc),k.removeAttribute("aria-current");const J=kt.findOne(`[data-bs-slide-to="${C}"]`,this._indicatorsElement);J&&(J.classList.add(dc),J.setAttribute("aria-current","true"))}_updateInterval(){const C=this._activeElement||this._getActive();if(!C)return;const k=Number.parseInt(C.getAttribute("data-bs-interval"),10);this._config.interval=k||this._config.defaultInterval}_slide(C,k=null){if(this._isSliding)return;const J=this._getActive(),Et=C===Ei,Bt=k||me(this._getItems(),J,Et,this._config.wrap);if(Bt===J)return;const te=this._getItemIndex(Bt),Ye=Hs=>gt.trigger(this._element,Hs,{relatedTarget:Bt,direction:this._orderToDirection(C),from:this._getItemIndex(J),to:te});if(Ye(Cn).defaultPrevented||!J||!Bt)return;const xn=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(te),this._activeElement=Bt;const Wi=Et?"carousel-item-start":"carousel-item-end",ls=Et?"carousel-item-next":"carousel-item-prev";Bt.classList.add(ls),bt(Bt),J.classList.add(Wi),Bt.classList.add(Wi),this._queueCallback(()=>{Bt.classList.remove(Wi,ls),Bt.classList.add(dc),J.classList.remove(dc,ls,Wi),this._isSliding=!1,Ye(En)},J,this._isAnimated()),xn&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return kt.findOne($r,this._element)}_getItems(){return kt.find(zh,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(C){return Gt()?C===Ws?Ji:Ei:C===Ws?Ei:Ji}_orderToDirection(C){return Gt()?C===Ji?Ws:pr:C===Ji?pr:Ws}static jQueryInterface(C){return this.each(function(){const k=Qr.getOrCreateInstance(this,C);if(typeof C!="number"){if(typeof C=="string"){if(k[C]===void 0||C.startsWith("_")||C==="constructor")throw new TypeError(`No method named "${C}"`);k[C]()}}else k.to(C)})}}gt.on(document,qh,"[data-bs-slide], [data-bs-slide-to]",function(X){const C=kt.getElementFromSelector(this);if(!C||!C.classList.contains(ld))return;X.preventDefault();const k=Qr.getOrCreateInstance(C),J=this.getAttribute("data-bs-slide-to");return J?(k.to(J),void k._maybeEnableCycle()):pt.getDataAttribute(this,"slide")==="next"?(k.next(),void k._maybeEnableCycle()):(k.prev(),void k._maybeEnableCycle())}),gt.on(window,Kh,()=>{const X=kt.find('[data-bs-ride="carousel"]');for(const C of X)Qr.getOrCreateInstance(C)}),Tt(Qr);const Zr=".bs.collapse",Om=`show${Zr}`,ii=`shown${Zr}`,lc=`hide${Zr}`,fr=`hidden${Zr}`,Nm=`click${Zr}.data-api`,pa="show",ei="collapse",fa="collapsing",Jh=`:scope .${ei} .${ei}`,ud='[data-bs-toggle="collapse"]',Dm={parent:null,toggle:!0},to={parent:"(null|element)",toggle:"boolean"};class Dr extends Lt{constructor(C,k){super(C,k),this._isTransitioning=!1,this._triggerArray=[];const J=kt.find(ud);for(const Et of J){const Bt=kt.getSelectorFromElement(Et),te=kt.find(Bt).filter(Ye=>Ye===this._element);Bt!==null&&te.length&&this._triggerArray.push(Et)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Dm}static get DefaultType(){return to}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let C=[];if(this._config.parent&&(C=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(Et=>Et!==this._element).map(Et=>Dr.getOrCreateInstance(Et,{toggle:!1}))),C.length&&C[0]._isTransitioning||gt.trigger(this._element,Om).defaultPrevented)return;for(const Et of C)Et.hide();const k=this._getDimension();this._element.classList.remove(ei),this._element.classList.add(fa),this._element.style[k]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const J=`scroll${k[0].toUpperCase()+k.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(fa),this._element.classList.add(ei,pa),this._element.style[k]="",gt.trigger(this._element,ii)},this._element,!0),this._element.style[k]=`${this._element[J]}px`}hide(){if(this._isTransitioning||!this._isShown()||gt.trigger(this._element,lc).defaultPrevented)return;const C=this._getDimension();this._element.style[C]=`${this._element.getBoundingClientRect()[C]}px`,bt(this._element),this._element.classList.add(fa),this._element.classList.remove(ei,pa);for(const k of this._triggerArray){const J=kt.getElementFromSelector(k);J&&!this._isShown(J)&&this._addAriaAndCollapsedClass([k],!1)}this._isTransitioning=!0,this._element.style[C]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(fa),this._element.classList.add(ei),gt.trigger(this._element,fr)},this._element,!0)}_isShown(C=this._element){return C.classList.contains(pa)}_configAfterMerge(C){return C.toggle=!!C.toggle,C.parent=G(C.parent),C}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const C=this._getFirstLevelChildren(ud);for(const k of C){const J=kt.getElementFromSelector(k);J&&this._addAriaAndCollapsedClass([k],this._isShown(J))}}_getFirstLevelChildren(C){const k=kt.find(Jh,this._config.parent);return kt.find(C,this._config.parent).filter(J=>!k.includes(J))}_addAriaAndCollapsedClass(C,k){if(C.length)for(const J of C)J.classList.toggle("collapsed",!k),J.setAttribute("aria-expanded",k)}static jQueryInterface(C){const k={};return typeof C=="string"&&/show|hide/.test(C)&&(k.toggle=!1),this.each(function(){const J=Dr.getOrCreateInstance(this,k);if(typeof C=="string"){if(J[C]===void 0)throw new TypeError(`No method named "${C}"`);J[C]()}})}}gt.on(document,Nm,ud,function(X){(X.target.tagName==="A"||X.delegateTarget&&X.delegateTarget.tagName==="A")&&X.preventDefault();for(const C of kt.getMultipleElementsFromSelector(this))Dr.getOrCreateInstance(C,{toggle:!1}).toggle()}),Tt(Dr);const eo="dropdown",ko=".bs.dropdown",jl=".data-api",Gl="ArrowUp",Xh="ArrowDown",Wl=`hide${ko}`,hd=`hidden${ko}`,Pm=`show${ko}`,Lm=`shown${ko}`,_a=`click${ko}${jl}`,$h=`keydown${ko}${jl}`,km=`keyup${ko}${jl}`,Ss="show",no='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Mm=`${no}.${Ss}`,Gi=".dropdown-menu",Mo=Gt()?"top-end":"top-start",Hl=Gt()?"top-start":"top-end",Kl=Gt()?"bottom-end":"bottom-start",Um=Gt()?"bottom-start":"bottom-end",Qh=Gt()?"left-start":"right-start",Xi=Gt()?"right-start":"left-start",Uo={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Zh={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class ds extends Lt{constructor(C,k){super(C,k),this._popper=null,this._parent=this._element.parentNode,this._menu=kt.next(this._element,Gi)[0]||kt.prev(this._element,Gi)[0]||kt.findOne(Gi,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Uo}static get DefaultType(){return Zh}static get NAME(){return eo}toggle(){return this._isShown()?this.hide():this.show()}show(){if(rt(this._element)||this._isShown())return;const C={relatedTarget:this._element};if(!gt.trigger(this._element,Pm,C).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const k of[].concat(...document.body.children))gt.on(k,"mouseover",dt);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Ss),this._element.classList.add(Ss),gt.trigger(this._element,Lm,C)}}hide(){if(rt(this._element)||!this._isShown())return;const C={relatedTarget:this._element};this._completeHide(C)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(C){if(!gt.trigger(this._element,Wl,C).defaultPrevented){if("ontouchstart"in document.documentElement)for(const k of[].concat(...document.body.children))gt.off(k,"mouseover",dt);this._popper&&this._popper.destroy(),this._menu.classList.remove(Ss),this._element.classList.remove(Ss),this._element.setAttribute("aria-expanded","false"),pt.removeDataAttribute(this._menu,"popper"),gt.trigger(this._element,hd,C)}}_getConfig(C){if(typeof(C=super._getConfig(C)).reference=="object"&&!P(C.reference)&&typeof C.reference.getBoundingClientRect!="function")throw new TypeError(`${eo.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return C}_createPopper(){if(E===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let C=this._element;this._config.reference==="parent"?C=this._parent:P(this._config.reference)?C=G(this._config.reference):typeof this._config.reference=="object"&&(C=this._config.reference);const k=this._getPopperConfig();this._popper=E.createPopper(C,this._menu,k)}_isShown(){return this._menu.classList.contains(Ss)}_getPlacement(){const C=this._parent;if(C.classList.contains("dropend"))return Qh;if(C.classList.contains("dropstart"))return Xi;if(C.classList.contains("dropup-center"))return"top";if(C.classList.contains("dropdown-center"))return"bottom";const k=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return C.classList.contains("dropup")?k?Hl:Mo:k?Um:Kl}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:C}=this._config;return typeof C=="string"?C.split(",").map(k=>Number.parseInt(k,10)):typeof C=="function"?k=>C(k,this._element):C}_getPopperConfig(){const C={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(pt.setDataAttribute(this._menu,"popper","static"),C.modifiers=[{name:"applyStyles",enabled:!1}]),{...C,...Kt(this._config.popperConfig,[C])}}_selectMenuItem({key:C,target:k}){const J=kt.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(Et=>z(Et));J.length&&me(J,k,C===Xh,!J.includes(k)).focus()}static jQueryInterface(C){return this.each(function(){const k=ds.getOrCreateInstance(this,C);if(typeof C=="string"){if(k[C]===void 0)throw new TypeError(`No method named "${C}"`);k[C]()}})}static clearMenus(C){if(C.button===2||C.type==="keyup"&&C.key!=="Tab")return;const k=kt.find(Mm);for(const J of k){const Et=ds.getInstance(J);if(!Et||Et._config.autoClose===!1)continue;const Bt=C.composedPath(),te=Bt.includes(Et._menu);if(Bt.includes(Et._element)||Et._config.autoClose==="inside"&&!te||Et._config.autoClose==="outside"&&te||Et._menu.contains(C.target)&&(C.type==="keyup"&&C.key==="Tab"||/input|select|option|textarea|form/i.test(C.target.tagName)))continue;const Ye={relatedTarget:Et._element};C.type==="click"&&(Ye.clickEvent=C),Et._completeHide(Ye)}}static dataApiKeydownHandler(C){const k=/input|textarea/i.test(C.target.tagName),J=C.key==="Escape",Et=[Gl,Xh].includes(C.key);if(!Et&&!J||k&&!J)return;C.preventDefault();const Bt=this.matches(no)?this:kt.prev(this,no)[0]||kt.next(this,no)[0]||kt.findOne(no,C.delegateTarget.parentNode),te=ds.getOrCreateInstance(Bt);if(Et)return C.stopPropagation(),te.show(),void te._selectMenuItem(C);te._isShown()&&(C.stopPropagation(),te.hide(),Bt.focus())}}gt.on(document,$h,no,ds.dataApiKeydownHandler),gt.on(document,$h,Gi,ds.dataApiKeydownHandler),gt.on(document,_a,ds.clearMenus),gt.on(document,km,ds.clearMenus),gt.on(document,_a,no,function(X){X.preventDefault(),ds.getOrCreateInstance(this).toggle()}),Tt(ds);const ql="backdrop",Yl="show",zl=`mousedown.bs.${ql}`,tp={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},xo={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Jl extends jt{constructor(C){super(),this._config=this._getConfig(C),this._isAppended=!1,this._element=null}static get Default(){return tp}static get DefaultType(){return xo}static get NAME(){return ql}show(C){if(!this._config.isVisible)return void Kt(C);this._append();const k=this._getElement();this._config.isAnimated&&bt(k),k.classList.add(Yl),this._emulateAnimation(()=>{Kt(C)})}hide(C){this._config.isVisible?(this._getElement().classList.remove(Yl),this._emulateAnimation(()=>{this.dispose(),Kt(C)})):Kt(C)}dispose(){this._isAppended&&(gt.off(this._element,zl),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const C=document.createElement("div");C.className=this._config.className,this._config.isAnimated&&C.classList.add("fade"),this._element=C}return this._element}_configAfterMerge(C){return C.rootElement=G(C.rootElement),C}_append(){if(this._isAppended)return;const C=this._getElement();this._config.rootElement.append(C),gt.on(C,zl,()=>{Kt(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(C){Zt(C,this._getElement(),this._config.isAnimated)}}const pd=".bs.focustrap",xm=`focusin${pd}`,ma=`keydown.tab${pd}`,Xl="backward",Vm={autofocus:!0,trapElement:null},Fm={autofocus:"boolean",trapElement:"element"};class ep extends jt{constructor(C){super(),this._config=this._getConfig(C),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Vm}static get DefaultType(){return Fm}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),gt.off(document,pd),gt.on(document,xm,C=>this._handleFocusin(C)),gt.on(document,ma,C=>this._handleKeydown(C)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,gt.off(document,pd))}_handleFocusin(C){const{trapElement:k}=this._config;if(C.target===document||C.target===k||k.contains(C.target))return;const J=kt.focusableChildren(k);J.length===0?k.focus():this._lastTabNavDirection===Xl?J[J.length-1].focus():J[0].focus()}_handleKeydown(C){C.key==="Tab"&&(this._lastTabNavDirection=C.shiftKey?Xl:"forward")}}const np=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Ea=".sticky-top",fd="padding-right",Vo="margin-right";class $l{constructor(){this._element=document.body}getWidth(){const C=document.documentElement.clientWidth;return Math.abs(window.innerWidth-C)}hide(){const C=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,fd,k=>k+C),this._setElementAttributes(np,fd,k=>k+C),this._setElementAttributes(Ea,Vo,k=>k-C)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,fd),this._resetElementAttributes(np,fd),this._resetElementAttributes(Ea,Vo)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(C,k,J){const Et=this.getWidth();this._applyManipulationCallback(C,Bt=>{if(Bt!==this._element&&window.innerWidth>Bt.clientWidth+Et)return;this._saveInitialAttribute(Bt,k);const te=window.getComputedStyle(Bt).getPropertyValue(k);Bt.style.setProperty(k,`${J(Number.parseFloat(te))}px`)})}_saveInitialAttribute(C,k){const J=C.style.getPropertyValue(k);J&&pt.setDataAttribute(C,k,J)}_resetElementAttributes(C,k){this._applyManipulationCallback(C,J=>{const Et=pt.getDataAttribute(J,k);Et!==null?(pt.removeDataAttribute(J,k),J.style.setProperty(k,Et)):J.style.removeProperty(k)})}_applyManipulationCallback(C,k){if(P(C))k(C);else for(const J of kt.find(C,this._element))k(J)}}const vs=".bs.modal",Bm=`hide${vs}`,Cs=`hidePrevented${vs}`,ip=`hidden${vs}`,sp=`show${vs}`,Ql=`shown${vs}`,Zl=`resize${vs}`,tu=`click.dismiss${vs}`,eu=`mousedown.dismiss${vs}`,jm=`keydown.dismiss${vs}`,rp=`click${vs}.data-api`,nu="modal-open",op="show",iu="modal-static",ap={backdrop:!0,focus:!0,keyboard:!0},su={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class io extends Lt{constructor(C,k){super(C,k),this._dialog=kt.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new $l,this._addEventListeners()}static get Default(){return ap}static get DefaultType(){return su}static get NAME(){return"modal"}toggle(C){return this._isShown?this.hide():this.show(C)}show(C){this._isShown||this._isTransitioning||gt.trigger(this._element,sp,{relatedTarget:C}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(nu),this._adjustDialog(),this._backdrop.show(()=>this._showElement(C)))}hide(){this._isShown&&!this._isTransitioning&&(gt.trigger(this._element,Bm).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(op),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){gt.off(window,vs),gt.off(this._dialog,vs),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Jl({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new ep({trapElement:this._element})}_showElement(C){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const k=kt.findOne(".modal-body",this._dialog);k&&(k.scrollTop=0),bt(this._element),this._element.classList.add(op),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,gt.trigger(this._element,Ql,{relatedTarget:C})},this._dialog,this._isAnimated())}_addEventListeners(){gt.on(this._element,jm,C=>{C.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),gt.on(window,Zl,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),gt.on(this._element,eu,C=>{gt.one(this._element,tu,k=>{this._element===C.target&&this._element===k.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(nu),this._resetAdjustments(),this._scrollBar.reset(),gt.trigger(this._element,ip)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(gt.trigger(this._element,Cs).defaultPrevented)return;const C=this._element.scrollHeight>document.documentElement.clientHeight,k=this._element.style.overflowY;k==="hidden"||this._element.classList.contains(iu)||(C||(this._element.style.overflowY="hidden"),this._element.classList.add(iu),this._queueCallback(()=>{this._element.classList.remove(iu),this._queueCallback(()=>{this._element.style.overflowY=k},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const C=this._element.scrollHeight>document.documentElement.clientHeight,k=this._scrollBar.getWidth(),J=k>0;if(J&&!C){const Et=Gt()?"paddingLeft":"paddingRight";this._element.style[Et]=`${k}px`}if(!J&&C){const Et=Gt()?"paddingRight":"paddingLeft";this._element.style[Et]=`${k}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(C,k){return this.each(function(){const J=io.getOrCreateInstance(this,C);if(typeof C=="string"){if(J[C]===void 0)throw new TypeError(`No method named "${C}"`);J[C](k)}})}}gt.on(document,rp,'[data-bs-toggle="modal"]',function(X){const C=kt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&X.preventDefault(),gt.one(C,sp,J=>{J.defaultPrevented||gt.one(C,ip,()=>{z(this)&&this.focus()})});const k=kt.findOne(".modal.show");k&&io.getInstance(k).hide(),io.getOrCreateInstance(C).toggle(this)}),H(io),Tt(io);const $i=".bs.offcanvas",cp=".data-api",Gm=`load${$i}${cp}`,so="show",dp="showing",lp="hiding",Ai=".offcanvas.show",Wm=`show${$i}`,Hm=`shown${$i}`,Km=`hide${$i}`,up=`hidePrevented${$i}`,_d=`hidden${$i}`,qm=`resize${$i}`,hp=`click${$i}${cp}`,Ym=`keydown.dismiss${$i}`,zm={backdrop:!0,keyboard:!0,scroll:!1},Jm={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Qi extends Lt{constructor(C,k){super(C,k),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return zm}static get DefaultType(){return Jm}static get NAME(){return"offcanvas"}toggle(C){return this._isShown?this.hide():this.show(C)}show(C){this._isShown||gt.trigger(this._element,Wm,{relatedTarget:C}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new $l().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(dp),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(so),this._element.classList.remove(dp),gt.trigger(this._element,Hm,{relatedTarget:C})},this._element,!0))}hide(){this._isShown&&(gt.trigger(this._element,Km).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(lp),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(so,lp),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new $l().reset(),gt.trigger(this._element,_d)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const C=!!this._config.backdrop;return new Jl({className:"offcanvas-backdrop",isVisible:C,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:C?()=>{this._config.backdrop!=="static"?this.hide():gt.trigger(this._element,up)}:null})}_initializeFocusTrap(){return new ep({trapElement:this._element})}_addEventListeners(){gt.on(this._element,Ym,C=>{C.key==="Escape"&&(this._config.keyboard?this.hide():gt.trigger(this._element,up))})}static jQueryInterface(C){return this.each(function(){const k=Qi.getOrCreateInstance(this,C);if(typeof C=="string"){if(k[C]===void 0||C.startsWith("_")||C==="constructor")throw new TypeError(`No method named "${C}"`);k[C](this)}})}}gt.on(document,hp,'[data-bs-toggle="offcanvas"]',function(X){const C=kt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&X.preventDefault(),rt(this))return;gt.one(C,_d,()=>{z(this)&&this.focus()});const k=kt.findOne(Ai);k&&k!==C&&Qi.getInstance(k).hide(),Qi.getOrCreateInstance(C).toggle(this)}),gt.on(window,Gm,()=>{for(const X of kt.find(Ai))Qi.getOrCreateInstance(X).show()}),gt.on(window,qm,()=>{for(const X of kt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(X).position!=="fixed"&&Qi.getOrCreateInstance(X).hide()}),H(Qi),Tt(Qi);const md={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Xm=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),kn=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,$m=(X,C)=>{const k=X.nodeName.toLowerCase();return C.includes(k)?!Xm.has(k)||!!kn.test(X.nodeValue):C.filter(J=>J instanceof RegExp).some(J=>J.test(k))},pp={allowList:md,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},fp={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Qm={entry:"(string|element|function|null)",selector:"(string|element)"};class Zm extends jt{constructor(C){super(),this._config=this._getConfig(C)}static get Default(){return pp}static get DefaultType(){return fp}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(C=>this._resolvePossibleFunction(C)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(C){return this._checkContent(C),this._config.content={...this._config.content,...C},this}toHtml(){const C=document.createElement("div");C.innerHTML=this._maybeSanitize(this._config.template);for(const[Et,Bt]of Object.entries(this._config.content))this._setContent(C,Bt,Et);const k=C.children[0],J=this._resolvePossibleFunction(this._config.extraClass);return J&&k.classList.add(...J.split(" ")),k}_typeCheckConfig(C){super._typeCheckConfig(C),this._checkContent(C.content)}_checkContent(C){for(const[k,J]of Object.entries(C))super._typeCheckConfig({selector:k,entry:J},Qm)}_setContent(C,k,J){const Et=kt.findOne(J,C);Et&&((k=this._resolvePossibleFunction(k))?P(k)?this._putElementInTemplate(G(k),Et):this._config.html?Et.innerHTML=this._maybeSanitize(k):Et.textContent=k:Et.remove())}_maybeSanitize(C){return this._config.sanitize?function(k,J,Et){if(!k.length)return k;if(Et&&typeof Et=="function")return Et(k);const Bt=new window.DOMParser().parseFromString(k,"text/html"),te=[].concat(...Bt.body.querySelectorAll("*"));for(const Ye of te){const xn=Ye.nodeName.toLowerCase();if(!Object.keys(J).includes(xn)){Ye.remove();continue}const Wi=[].concat(...Ye.attributes),ls=[].concat(J["*"]||[],J[xn]||[]);for(const Hs of Wi)$m(Hs,ls)||Ye.removeAttribute(Hs.nodeName)}return Bt.body.innerHTML}(C,this._config.allowList,this._config.sanitizeFn):C}_resolvePossibleFunction(C){return Kt(C,[this])}_putElementInTemplate(C,k){if(this._config.html)return k.innerHTML="",void k.append(C);k.textContent=C.textContent}}const tE=new Set(["sanitize","allowList","sanitizeFn"]),ru="fade",Ed="show",_p=".modal",uc="hide.bs.modal",ga="hover",hc="focus",eE={AUTO:"auto",TOP:"top",RIGHT:Gt()?"left":"right",BOTTOM:"bottom",LEFT:Gt()?"right":"left"},ou={allowList:md,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},nE={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class ro extends Lt{constructor(C,k){if(E===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(C,k),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return ou}static get DefaultType(){return nE}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),gt.off(this._element.closest(_p),uc,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const C=gt.trigger(this._element,this.constructor.eventName("show")),k=(at(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(C.defaultPrevented||!k)return;this._disposePopper();const J=this._getTipElement();this._element.setAttribute("aria-describedby",J.getAttribute("id"));const{container:Et}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(Et.append(J),gt.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(J),J.classList.add(Ed),"ontouchstart"in document.documentElement)for(const Bt of[].concat(...document.body.children))gt.on(Bt,"mouseover",dt);this._queueCallback(()=>{gt.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!gt.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Ed),"ontouchstart"in document.documentElement)for(const C of[].concat(...document.body.children))gt.off(C,"mouseover",dt);this._activeTrigger.click=!1,this._activeTrigger[hc]=!1,this._activeTrigger[ga]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),gt.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(C){const k=this._getTemplateFactory(C).toHtml();if(!k)return null;k.classList.remove(ru,Ed),k.classList.add(`bs-${this.constructor.NAME}-auto`);const J=(Et=>{do Et+=Math.floor(1e6*Math.random());while(document.getElementById(Et));return Et})(this.constructor.NAME).toString();return k.setAttribute("id",J),this._isAnimated()&&k.classList.add(ru),k}setContent(C){this._newContent=C,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(C){return this._templateFactory?this._templateFactory.changeContent(C):this._templateFactory=new Zm({...this._config,content:C,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(C){return this.constructor.getOrCreateInstance(C.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(ru)}_isShown(){return this.tip&&this.tip.classList.contains(Ed)}_createPopper(C){const k=Kt(this._config.placement,[this,C,this._element]),J=eE[k.toUpperCase()];return E.createPopper(this._element,C,this._getPopperConfig(J))}_getOffset(){const{offset:C}=this._config;return typeof C=="string"?C.split(",").map(k=>Number.parseInt(k,10)):typeof C=="function"?k=>C(k,this._element):C}_resolvePossibleFunction(C){return Kt(C,[this._element])}_getPopperConfig(C){const k={placement:C,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:J=>{this._getTipElement().setAttribute("data-popper-placement",J.state.placement)}}]};return{...k,...Kt(this._config.popperConfig,[k])}}_setListeners(){const C=this._config.trigger.split(" ");for(const k of C)if(k==="click")gt.on(this._element,this.constructor.eventName("click"),this._config.selector,J=>{this._initializeOnDelegatedTarget(J).toggle()});else if(k!=="manual"){const J=k===ga?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),Et=k===ga?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");gt.on(this._element,J,this._config.selector,Bt=>{const te=this._initializeOnDelegatedTarget(Bt);te._activeTrigger[Bt.type==="focusin"?hc:ga]=!0,te._enter()}),gt.on(this._element,Et,this._config.selector,Bt=>{const te=this._initializeOnDelegatedTarget(Bt);te._activeTrigger[Bt.type==="focusout"?hc:ga]=te._element.contains(Bt.relatedTarget),te._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},gt.on(this._element.closest(_p),uc,this._hideModalHandler)}_fixTitle(){const C=this._element.getAttribute("title");C&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",C),this._element.setAttribute("data-bs-original-title",C),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(C,k){clearTimeout(this._timeout),this._timeout=setTimeout(C,k)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(C){const k=pt.getDataAttributes(this._element);for(const J of Object.keys(k))tE.has(J)&&delete k[J];return C={...k,...typeof C=="object"&&C?C:{}},C=this._mergeConfigObj(C),C=this._configAfterMerge(C),this._typeCheckConfig(C),C}_configAfterMerge(C){return C.container=C.container===!1?document.body:G(C.container),typeof C.delay=="number"&&(C.delay={show:C.delay,hide:C.delay}),typeof C.title=="number"&&(C.title=C.title.toString()),typeof C.content=="number"&&(C.content=C.content.toString()),C}_getDelegateConfig(){const C={};for(const[k,J]of Object.entries(this._config))this.constructor.Default[k]!==J&&(C[k]=J);return C.selector=!1,C.trigger="manual",C}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(C){return this.each(function(){const k=ro.getOrCreateInstance(this,C);if(typeof C=="string"){if(k[C]===void 0)throw new TypeError(`No method named "${C}"`);k[C]()}})}}Tt(ro);const iE={...ro.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},sE={...ro.DefaultType,content:"(null|string|element|function)"};class gd extends ro{static get Default(){return iE}static get DefaultType(){return sE}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(C){return this.each(function(){const k=gd.getOrCreateInstance(this,C);if(typeof C=="string"){if(k[C]===void 0)throw new TypeError(`No method named "${C}"`);k[C]()}})}}Tt(gd);const au=".bs.scrollspy",rE=`activate${au}`,mp=`click${au}`,oE=`load${au}.data-api`,Ta="active",Td="[href]",Ep=".nav-link",aE=`${Ep}, .nav-item > ${Ep}, .list-group-item`,cE={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},pc={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class fc extends Lt{constructor(C,k){super(C,k),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return cE}static get DefaultType(){return pc}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const C of this._observableSections.values())this._observer.observe(C)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(C){return C.target=G(C.target)||document.body,C.rootMargin=C.offset?`${C.offset}px 0px -30%`:C.rootMargin,typeof C.threshold=="string"&&(C.threshold=C.threshold.split(",").map(k=>Number.parseFloat(k))),C}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(gt.off(this._config.target,mp),gt.on(this._config.target,mp,Td,C=>{const k=this._observableSections.get(C.target.hash);if(k){C.preventDefault();const J=this._rootElement||window,Et=k.offsetTop-this._element.offsetTop;if(J.scrollTo)return void J.scrollTo({top:Et,behavior:"smooth"});J.scrollTop=Et}}))}_getNewObserver(){const C={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(k=>this._observerCallback(k),C)}_observerCallback(C){const k=te=>this._targetLinks.get(`#${te.target.id}`),J=te=>{this._previousScrollData.visibleEntryTop=te.target.offsetTop,this._process(k(te))},Et=(this._rootElement||document.documentElement).scrollTop,Bt=Et>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=Et;for(const te of C){if(!te.isIntersecting){this._activeTarget=null,this._clearActiveClass(k(te));continue}const Ye=te.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(Bt&&Ye){if(J(te),!Et)return}else Bt||Ye||J(te)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const C=kt.find(Td,this._config.target);for(const k of C){if(!k.hash||rt(k))continue;const J=kt.findOne(decodeURI(k.hash),this._element);z(J)&&(this._targetLinks.set(decodeURI(k.hash),k),this._observableSections.set(k.hash,J))}}_process(C){this._activeTarget!==C&&(this._clearActiveClass(this._config.target),this._activeTarget=C,C.classList.add(Ta),this._activateParents(C),gt.trigger(this._element,rE,{relatedTarget:C}))}_activateParents(C){if(C.classList.contains("dropdown-item"))kt.findOne(".dropdown-toggle",C.closest(".dropdown")).classList.add(Ta);else for(const k of kt.parents(C,".nav, .list-group"))for(const J of kt.prev(k,aE))J.classList.add(Ta)}_clearActiveClass(C){C.classList.remove(Ta);const k=kt.find(`${Td}.${Ta}`,C);for(const J of k)J.classList.remove(Ta)}static jQueryInterface(C){return this.each(function(){const k=fc.getOrCreateInstance(this,C);if(typeof C=="string"){if(k[C]===void 0||C.startsWith("_")||C==="constructor")throw new TypeError(`No method named "${C}"`);k[C]()}})}}gt.on(window,oE,()=>{for(const X of kt.find('[data-bs-spy="scroll"]'))fc.getOrCreateInstance(X)}),Tt(fc);const Fo=".bs.tab",dE=`hide${Fo}`,lE=`hidden${Fo}`,gp=`show${Fo}`,uE=`shown${Fo}`,hE=`click${Fo}`,pE=`keydown${Fo}`,_c=`load${Fo}`,ys="ArrowLeft",cu="ArrowRight",fE="ArrowUp",Tp="ArrowDown",du="Home",Rs="End",Bo="active",Sp="fade",lu="show",mc=".dropdown-toggle",Sd=`:not(${mc})`,vp='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Ec=`.nav-link${Sd}, .list-group-item${Sd}, [role="tab"]${Sd}, ${vp}`,_E=`.${Bo}[data-bs-toggle="tab"], .${Bo}[data-bs-toggle="pill"], .${Bo}[data-bs-toggle="list"]`;class Pr extends Lt{constructor(C){super(C),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),gt.on(this._element,pE,k=>this._keydown(k)))}static get NAME(){return"tab"}show(){const C=this._element;if(this._elemIsActive(C))return;const k=this._getActiveElem(),J=k?gt.trigger(k,dE,{relatedTarget:C}):null;gt.trigger(C,gp,{relatedTarget:k}).defaultPrevented||J&&J.defaultPrevented||(this._deactivate(k,C),this._activate(C,k))}_activate(C,k){C&&(C.classList.add(Bo),this._activate(kt.getElementFromSelector(C)),this._queueCallback(()=>{C.getAttribute("role")==="tab"?(C.removeAttribute("tabindex"),C.setAttribute("aria-selected",!0),this._toggleDropDown(C,!0),gt.trigger(C,uE,{relatedTarget:k})):C.classList.add(lu)},C,C.classList.contains(Sp)))}_deactivate(C,k){C&&(C.classList.remove(Bo),C.blur(),this._deactivate(kt.getElementFromSelector(C)),this._queueCallback(()=>{C.getAttribute("role")==="tab"?(C.setAttribute("aria-selected",!1),C.setAttribute("tabindex","-1"),this._toggleDropDown(C,!1),gt.trigger(C,lE,{relatedTarget:k})):C.classList.remove(lu)},C,C.classList.contains(Sp)))}_keydown(C){if(![ys,cu,fE,Tp,du,Rs].includes(C.key))return;C.stopPropagation(),C.preventDefault();const k=this._getChildren().filter(Et=>!rt(Et));let J;if([du,Rs].includes(C.key))J=k[C.key===du?0:k.length-1];else{const Et=[cu,Tp].includes(C.key);J=me(k,C.target,Et,!0)}J&&(J.focus({preventScroll:!0}),Pr.getOrCreateInstance(J).show())}_getChildren(){return kt.find(Ec,this._parent)}_getActiveElem(){return this._getChildren().find(C=>this._elemIsActive(C))||null}_setInitialAttributes(C,k){this._setAttributeIfNotExists(C,"role","tablist");for(const J of k)this._setInitialAttributesOnChild(J)}_setInitialAttributesOnChild(C){C=this._getInnerElement(C);const k=this._elemIsActive(C),J=this._getOuterElement(C);C.setAttribute("aria-selected",k),J!==C&&this._setAttributeIfNotExists(J,"role","presentation"),k||C.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(C,"role","tab"),this._setInitialAttributesOnTargetPanel(C)}_setInitialAttributesOnTargetPanel(C){const k=kt.getElementFromSelector(C);k&&(this._setAttributeIfNotExists(k,"role","tabpanel"),C.id&&this._setAttributeIfNotExists(k,"aria-labelledby",`${C.id}`))}_toggleDropDown(C,k){const J=this._getOuterElement(C);if(!J.classList.contains("dropdown"))return;const Et=(Bt,te)=>{const Ye=kt.findOne(Bt,J);Ye&&Ye.classList.toggle(te,k)};Et(mc,Bo),Et(".dropdown-menu",lu),J.setAttribute("aria-expanded",k)}_setAttributeIfNotExists(C,k,J){C.hasAttribute(k)||C.setAttribute(k,J)}_elemIsActive(C){return C.classList.contains(Bo)}_getInnerElement(C){return C.matches(Ec)?C:kt.findOne(Ec,C)}_getOuterElement(C){return C.closest(".nav-item, .list-group-item")||C}static jQueryInterface(C){return this.each(function(){const k=Pr.getOrCreateInstance(this);if(typeof C=="string"){if(k[C]===void 0||C.startsWith("_")||C==="constructor")throw new TypeError(`No method named "${C}"`);k[C]()}})}}gt.on(document,hE,vp,function(X){["A","AREA"].includes(this.tagName)&&X.preventDefault(),rt(this)||Pr.getOrCreateInstance(this).show()}),gt.on(window,_c,()=>{for(const X of kt.find(_E))Pr.getOrCreateInstance(X)}),Tt(Pr);const _r=".bs.toast",uu=`mouseover${_r}`,mE=`mouseout${_r}`,EE=`focusin${_r}`,oo=`focusout${_r}`,vd=`hide${_r}`,gE=`hidden${_r}`,TE=`show${_r}`,SE=`shown${_r}`,Cp="hide",Cd="show",Lr="showing",vE={animation:"boolean",autohide:"boolean",delay:"number"},Sa={animation:!0,autohide:!0,delay:5e3};class va extends Lt{constructor(C,k){super(C,k),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Sa}static get DefaultType(){return vE}static get NAME(){return"toast"}show(){gt.trigger(this._element,TE).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Cp),bt(this._element),this._element.classList.add(Cd,Lr),this._queueCallback(()=>{this._element.classList.remove(Lr),gt.trigger(this._element,SE),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(gt.trigger(this._element,vd).defaultPrevented||(this._element.classList.add(Lr),this._queueCallback(()=>{this._element.classList.add(Cp),this._element.classList.remove(Lr,Cd),gt.trigger(this._element,gE)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Cd),super.dispose()}isShown(){return this._element.classList.contains(Cd)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(C,k){switch(C.type){case"mouseover":case"mouseout":this._hasMouseInteraction=k;break;case"focusin":case"focusout":this._hasKeyboardInteraction=k}if(k)return void this._clearTimeout();const J=C.relatedTarget;this._element===J||this._element.contains(J)||this._maybeScheduleHide()}_setListeners(){gt.on(this._element,uu,C=>this._onInteraction(C,!0)),gt.on(this._element,mE,C=>this._onInteraction(C,!1)),gt.on(this._element,EE,C=>this._onInteraction(C,!0)),gt.on(this._element,oo,C=>this._onInteraction(C,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(C){return this.each(function(){const k=va.getOrCreateInstance(this,C);if(typeof C=="string"){if(k[C]===void 0)throw new TypeError(`No method named "${C}"`);k[C](this)}})}}return H(va),Tt(va),{Alert:mt,Button:Wt,Carousel:Qr,Collapse:Dr,Dropdown:ds,Modal:io,Offcanvas:Qi,Popover:gd,ScrollSpy:fc,Tab:Pr,Toast:va,Tooltip:ro}})})(SH);const TC=(o,d)=>{const p=o.__vccOpts||o;for(const[_,E]of d)p[_]=E;return p},l6={};function u6(o,d){const p=Rl("router-view");return Pn(),Yr(p)}const h6=TC(l6,[["render",u6]]);/*!
  * vue-router v4.2.5
  * (c) 2023 Eduardo San Martin Morote
  * @license MIT
  */const Tl=typeof window<"u";function p6(o){return o.__esModule||o[Symbol.toStringTag]==="Module"}const Tn=Object.assign;function ev(o,d){const p={};for(const _ in d){const E=d[_];p[_]=Xr(E)?E.map(o):o(E)}return p}const Ih=()=>{},Xr=Array.isArray,f6=/\/$/,_6=o=>o.replace(f6,"");function nv(o,d,p="/"){let _,E={},T="",R="";const N=d.indexOf("#");let D=d.indexOf("?");return N<D&&N>=0&&(D=-1),D>-1&&(_=d.slice(0,D),T=d.slice(D+1,N>-1?N:d.length),E=o(T)),N>-1&&(_=_||d.slice(0,N),R=d.slice(N,d.length)),_=T6(_??d,p),{fullPath:_+(T&&"?")+T+R,path:_,query:E,hash:R}}function m6(o,d){const p=d.query?o(d.query):"";return d.path+(p&&"?")+p+(d.hash||"")}function QN(o,d){return!d||!o.toLowerCase().startsWith(d.toLowerCase())?o:o.slice(d.length)||"/"}function E6(o,d,p){const _=d.matched.length-1,E=p.matched.length-1;return _>-1&&_===E&&Pl(d.matched[_],p.matched[E])&&yL(d.params,p.params)&&o(d.query)===o(p.query)&&d.hash===p.hash}function Pl(o,d){return(o.aliasOf||o)===(d.aliasOf||d)}function yL(o,d){if(Object.keys(o).length!==Object.keys(d).length)return!1;for(const p in o)if(!g6(o[p],d[p]))return!1;return!0}function g6(o,d){return Xr(o)?ZN(o,d):Xr(d)?ZN(d,o):o===d}function ZN(o,d){return Xr(d)?o.length===d.length&&o.every((p,_)=>p===d[_]):o.length===1&&o[0]===d}function T6(o,d){if(o.startsWith("/"))return o;if(!o)return d;const p=d.split("/"),_=o.split("/"),E=_[_.length-1];(E===".."||E===".")&&_.push("");let T=p.length-1,R,N;for(R=0;R<_.length;R++)if(N=_[R],N!==".")if(N==="..")T>1&&T--;else break;return p.slice(0,T).join("/")+"/"+_.slice(R-(R===_.length?1:0)).join("/")}var kh;(function(o){o.pop="pop",o.push="push"})(kh||(kh={}));var bh;(function(o){o.back="back",o.forward="forward",o.unknown=""})(bh||(bh={}));function S6(o){if(!o)if(Tl){const d=document.querySelector("base");o=d&&d.getAttribute("href")||"/",o=o.replace(/^\w+:\/\/[^\/]+/,"")}else o="/";return o[0]!=="/"&&o[0]!=="#"&&(o="/"+o),_6(o)}const v6=/^[^#]+#/;function C6(o,d){return o.replace(v6,"#")+d}function y6(o,d){const p=document.documentElement.getBoundingClientRect(),_=o.getBoundingClientRect();return{behavior:d.behavior,left:_.left-p.left-(d.left||0),top:_.top-p.top-(d.top||0)}}const Tm=()=>({left:window.pageXOffset,top:window.pageYOffset});function R6(o){let d;if("el"in o){const p=o.el,_=typeof p=="string"&&p.startsWith("#"),E=typeof p=="string"?_?document.getElementById(p.slice(1)):document.querySelector(p):p;if(!E)return;d=y6(E,o)}else d=o;"scrollBehavior"in document.documentElement.style?window.scrollTo(d):window.scrollTo(d.left!=null?d.left:window.pageXOffset,d.top!=null?d.top:window.pageYOffset)}function tD(o,d){return(history.state?history.state.position-d:-1)+o}const Ov=new Map;function I6(o,d){Ov.set(o,d)}function b6(o){const d=Ov.get(o);return Ov.delete(o),d}let A6=()=>location.protocol+"//"+location.host;function RL(o,d){const{pathname:p,search:_,hash:E}=d,T=o.indexOf("#");if(T>-1){let N=E.includes(o.slice(T))?o.slice(T).length:1,D=E.slice(N);return D[0]!=="/"&&(D="/"+D),QN(D,"")}return QN(p,o)+_+E}function w6(o,d,p,_){let E=[],T=[],R=null;const N=({state:z})=>{const rt=RL(o,location),at=p.value,dt=d.value;let bt=0;if(z){if(p.value=rt,d.value=z,R&&R===at){R=null;return}bt=dt?z.position-dt.position:0}else _(rt);E.forEach(Ot=>{Ot(p.value,at,{delta:bt,type:kh.pop,direction:bt?bt>0?bh.forward:bh.back:bh.unknown})})};function D(){R=p.value}function x(z){E.push(z);const rt=()=>{const at=E.indexOf(z);at>-1&&E.splice(at,1)};return T.push(rt),rt}function P(){const{history:z}=window;z.state&&z.replaceState(Tn({},z.state,{scroll:Tm()}),"")}function G(){for(const z of T)z();T=[],window.removeEventListener("popstate",N),window.removeEventListener("beforeunload",P)}return window.addEventListener("popstate",N),window.addEventListener("beforeunload",P,{passive:!0}),{pauseListeners:D,listen:x,destroy:G}}function eD(o,d,p,_=!1,E=!1){return{back:o,current:d,forward:p,replaced:_,position:window.history.length,scroll:E?Tm():null}}function O6(o){const{history:d,location:p}=window,_={value:RL(o,p)},E={value:d.state};E.value||T(_.value,{back:null,current:_.value,forward:null,position:d.length-1,replaced:!0,scroll:null},!0);function T(D,x,P){const G=o.indexOf("#"),z=G>-1?(p.host&&document.querySelector("base")?o:o.slice(G))+D:A6()+o+D;try{d[P?"replaceState":"pushState"](x,"",z),E.value=x}catch(rt){console.error(rt),p[P?"replace":"assign"](z)}}function R(D,x){const P=Tn({},d.state,eD(E.value.back,D,E.value.forward,!0),x,{position:E.value.position});T(D,P,!0),_.value=D}function N(D,x){const P=Tn({},E.value,d.state,{forward:D,scroll:Tm()});T(P.current,P,!0);const G=Tn({},eD(_.value,D,null),{position:P.position+1},x);T(D,G,!1),_.value=D}return{location:_,state:E,push:N,replace:R}}function N6(o){o=S6(o);const d=O6(o),p=w6(o,d.state,d.location,d.replace);function _(T,R=!0){R||p.pauseListeners(),history.go(T)}const E=Tn({location:"",base:o,go:_,createHref:C6.bind(null,o)},d,p);return Object.defineProperty(E,"location",{enumerable:!0,get:()=>d.location.value}),Object.defineProperty(E,"state",{enumerable:!0,get:()=>d.state.value}),E}function D6(o){return typeof o=="string"||o&&typeof o=="object"}function IL(o){return typeof o=="string"||typeof o=="symbol"}const Za={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},bL=Symbol("");var nD;(function(o){o[o.aborted=4]="aborted",o[o.cancelled=8]="cancelled",o[o.duplicated=16]="duplicated"})(nD||(nD={}));function Ll(o,d){return Tn(new Error,{type:o,[bL]:!0},d)}function sa(o,d){return o instanceof Error&&bL in o&&(d==null||!!(o.type&d))}const iD="[^/]+?",P6={sensitive:!1,strict:!1,start:!0,end:!0},L6=/[.+*?^${}()[\]/\\]/g;function k6(o,d){const p=Tn({},P6,d),_=[];let E=p.start?"^":"";const T=[];for(const x of o){const P=x.length?[]:[90];p.strict&&!x.length&&(E+="/");for(let G=0;G<x.length;G++){const z=x[G];let rt=40+(p.sensitive?.25:0);if(z.type===0)G||(E+="/"),E+=z.value.replace(L6,"\\$&"),rt+=40;else if(z.type===1){const{value:at,repeatable:dt,optional:bt,regexp:Ot}=z;T.push({name:at,repeatable:dt,optional:bt});const Dt=Ot||iD;if(Dt!==iD){rt+=10;try{new RegExp(`(${Dt})`)}catch(Tt){throw new Error(`Invalid custom RegExp for param "${at}" (${Dt}): `+Tt.message)}}let Gt=dt?`((?:${Dt})(?:/(?:${Dt}))*)`:`(${Dt})`;G||(Gt=bt&&x.length<2?`(?:/${Gt})`:"/"+Gt),bt&&(Gt+="?"),E+=Gt,rt+=20,bt&&(rt+=-8),dt&&(rt+=-20),Dt===".*"&&(rt+=-50)}P.push(rt)}_.push(P)}if(p.strict&&p.end){const x=_.length-1;_[x][_[x].length-1]+=.7000000000000001}p.strict||(E+="/?"),p.end?E+="$":p.strict&&(E+="(?:/|$)");const R=new RegExp(E,p.sensitive?"":"i");function N(x){const P=x.match(R),G={};if(!P)return null;for(let z=1;z<P.length;z++){const rt=P[z]||"",at=T[z-1];G[at.name]=rt&&at.repeatable?rt.split("/"):rt}return G}function D(x){let P="",G=!1;for(const z of o){(!G||!P.endsWith("/"))&&(P+="/"),G=!1;for(const rt of z)if(rt.type===0)P+=rt.value;else if(rt.type===1){const{value:at,repeatable:dt,optional:bt}=rt,Ot=at in x?x[at]:"";if(Xr(Ot)&&!dt)throw new Error(`Provided param "${at}" is an array but it is not repeatable (* or + modifiers)`);const Dt=Xr(Ot)?Ot.join("/"):Ot;if(!Dt)if(bt)z.length<2&&(P.endsWith("/")?P=P.slice(0,-1):G=!0);else throw new Error(`Missing required param "${at}"`);P+=Dt}}return P||"/"}return{re:R,score:_,keys:T,parse:N,stringify:D}}function M6(o,d){let p=0;for(;p<o.length&&p<d.length;){const _=d[p]-o[p];if(_)return _;p++}return o.length<d.length?o.length===1&&o[0]===40+40?-1:1:o.length>d.length?d.length===1&&d[0]===40+40?1:-1:0}function U6(o,d){let p=0;const _=o.score,E=d.score;for(;p<_.length&&p<E.length;){const T=M6(_[p],E[p]);if(T)return T;p++}if(Math.abs(E.length-_.length)===1){if(sD(_))return 1;if(sD(E))return-1}return E.length-_.length}function sD(o){const d=o[o.length-1];return o.length>0&&d[d.length-1]<0}const x6={type:0,value:""},V6=/[a-zA-Z0-9_]/;function F6(o){if(!o)return[[]];if(o==="/")return[[x6]];if(!o.startsWith("/"))throw new Error(`Invalid path "${o}"`);function d(rt){throw new Error(`ERR (${p})/"${x}": ${rt}`)}let p=0,_=p;const E=[];let T;function R(){T&&E.push(T),T=[]}let N=0,D,x="",P="";function G(){x&&(p===0?T.push({type:0,value:x}):p===1||p===2||p===3?(T.length>1&&(D==="*"||D==="+")&&d(`A repeatable param (${x}) must be alone in its segment. eg: '/:ids+.`),T.push({type:1,value:x,regexp:P,repeatable:D==="*"||D==="+",optional:D==="*"||D==="?"})):d("Invalid state to consume buffer"),x="")}function z(){x+=D}for(;N<o.length;){if(D=o[N++],D==="\\"&&p!==2){_=p,p=4;continue}switch(p){case 0:D==="/"?(x&&G(),R()):D===":"?(G(),p=1):z();break;case 4:z(),p=_;break;case 1:D==="("?p=2:V6.test(D)?z():(G(),p=0,D!=="*"&&D!=="?"&&D!=="+"&&N--);break;case 2:D===")"?P[P.length-1]=="\\"?P=P.slice(0,-1)+D:p=3:P+=D;break;case 3:G(),p=0,D!=="*"&&D!=="?"&&D!=="+"&&N--,P="";break;default:d("Unknown state");break}}return p===2&&d(`Unfinished custom RegExp for param "${x}"`),G(),R(),E}function B6(o,d,p){const _=k6(F6(o.path),p),E=Tn(_,{record:o,parent:d,children:[],alias:[]});return d&&!E.record.aliasOf==!d.record.aliasOf&&d.children.push(E),E}function j6(o,d){const p=[],_=new Map;d=aD({strict:!1,end:!0,sensitive:!1},d);function E(P){return _.get(P)}function T(P,G,z){const rt=!z,at=G6(P);at.aliasOf=z&&z.record;const dt=aD(d,P),bt=[at];if("alias"in P){const Gt=typeof P.alias=="string"?[P.alias]:P.alias;for(const Tt of Gt)bt.push(Tn({},at,{components:z?z.record.components:at.components,path:Tt,aliasOf:z?z.record:at}))}let Ot,Dt;for(const Gt of bt){const{path:Tt}=Gt;if(G&&Tt[0]!=="/"){const Kt=G.record.path,Zt=Kt[Kt.length-1]==="/"?"":"/";Gt.path=G.record.path+(Tt&&Zt+Tt)}if(Ot=B6(Gt,G,dt),z?z.alias.push(Ot):(Dt=Dt||Ot,Dt!==Ot&&Dt.alias.push(Ot),rt&&P.name&&!oD(Ot)&&R(P.name)),at.children){const Kt=at.children;for(let Zt=0;Zt<Kt.length;Zt++)T(Kt[Zt],Ot,z&&z.children[Zt])}z=z||Ot,(Ot.record.components&&Object.keys(Ot.record.components).length||Ot.record.name||Ot.record.redirect)&&D(Ot)}return Dt?()=>{R(Dt)}:Ih}function R(P){if(IL(P)){const G=_.get(P);G&&(_.delete(P),p.splice(p.indexOf(G),1),G.children.forEach(R),G.alias.forEach(R))}else{const G=p.indexOf(P);G>-1&&(p.splice(G,1),P.record.name&&_.delete(P.record.name),P.children.forEach(R),P.alias.forEach(R))}}function N(){return p}function D(P){let G=0;for(;G<p.length&&U6(P,p[G])>=0&&(P.record.path!==p[G].record.path||!AL(P,p[G]));)G++;p.splice(G,0,P),P.record.name&&!oD(P)&&_.set(P.record.name,P)}function x(P,G){let z,rt={},at,dt;if("name"in P&&P.name){if(z=_.get(P.name),!z)throw Ll(1,{location:P});dt=z.record.name,rt=Tn(rD(G.params,z.keys.filter(Dt=>!Dt.optional).map(Dt=>Dt.name)),P.params&&rD(P.params,z.keys.map(Dt=>Dt.name))),at=z.stringify(rt)}else if("path"in P)at=P.path,z=p.find(Dt=>Dt.re.test(at)),z&&(rt=z.parse(at),dt=z.record.name);else{if(z=G.name?_.get(G.name):p.find(Dt=>Dt.re.test(G.path)),!z)throw Ll(1,{location:P,currentLocation:G});dt=z.record.name,rt=Tn({},G.params,P.params),at=z.stringify(rt)}const bt=[];let Ot=z;for(;Ot;)bt.unshift(Ot.record),Ot=Ot.parent;return{name:dt,path:at,params:rt,matched:bt,meta:H6(bt)}}return o.forEach(P=>T(P)),{addRoute:T,resolve:x,removeRoute:R,getRoutes:N,getRecordMatcher:E}}function rD(o,d){const p={};for(const _ of d)_ in o&&(p[_]=o[_]);return p}function G6(o){return{path:o.path,redirect:o.redirect,name:o.name,meta:o.meta||{},aliasOf:void 0,beforeEnter:o.beforeEnter,props:W6(o),children:o.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in o?o.components||null:o.component&&{default:o.component}}}function W6(o){const d={},p=o.props||!1;if("component"in o)d.default=p;else for(const _ in o.components)d[_]=typeof p=="object"?p[_]:p;return d}function oD(o){for(;o;){if(o.record.aliasOf)return!0;o=o.parent}return!1}function H6(o){return o.reduce((d,p)=>Tn(d,p.meta),{})}function aD(o,d){const p={};for(const _ in o)p[_]=_ in d?d[_]:o[_];return p}function AL(o,d){return d.children.some(p=>p===o||AL(o,p))}const wL=/#/g,K6=/&/g,q6=/\//g,Y6=/=/g,z6=/\?/g,OL=/\+/g,J6=/%5B/g,X6=/%5D/g,NL=/%5E/g,$6=/%60/g,DL=/%7B/g,Q6=/%7C/g,PL=/%7D/g,Z6=/%20/g;function SC(o){return encodeURI(""+o).replace(Q6,"|").replace(J6,"[").replace(X6,"]")}function tK(o){return SC(o).replace(DL,"{").replace(PL,"}").replace(NL,"^")}function Nv(o){return SC(o).replace(OL,"%2B").replace(Z6,"+").replace(wL,"%23").replace(K6,"%26").replace($6,"`").replace(DL,"{").replace(PL,"}").replace(NL,"^")}function eK(o){return Nv(o).replace(Y6,"%3D")}function nK(o){return SC(o).replace(wL,"%23").replace(z6,"%3F")}function iK(o){return o==null?"":nK(o).replace(q6,"%2F")}function $_(o){try{return decodeURIComponent(""+o)}catch{}return""+o}function sK(o){const d={};if(o===""||o==="?")return d;const _=(o[0]==="?"?o.slice(1):o).split("&");for(let E=0;E<_.length;++E){const T=_[E].replace(OL," "),R=T.indexOf("="),N=$_(R<0?T:T.slice(0,R)),D=R<0?null:$_(T.slice(R+1));if(N in d){let x=d[N];Xr(x)||(x=d[N]=[x]),x.push(D)}else d[N]=D}return d}function cD(o){let d="";for(let p in o){const _=o[p];if(p=eK(p),_==null){_!==void 0&&(d+=(d.length?"&":"")+p);continue}(Xr(_)?_.map(T=>T&&Nv(T)):[_&&Nv(_)]).forEach(T=>{T!==void 0&&(d+=(d.length?"&":"")+p,T!=null&&(d+="="+T))})}return d}function rK(o){const d={};for(const p in o){const _=o[p];_!==void 0&&(d[p]=Xr(_)?_.map(E=>E==null?null:""+E):_==null?_:""+_)}return d}const oK=Symbol(""),dD=Symbol(""),Sm=Symbol(""),LL=Symbol(""),Dv=Symbol("");function fh(){let o=[];function d(_){return o.push(_),()=>{const E=o.indexOf(_);E>-1&&o.splice(E,1)}}function p(){o=[]}return{add:d,list:()=>o.slice(),reset:p}}function ic(o,d,p,_,E){const T=_&&(_.enterCallbacks[E]=_.enterCallbacks[E]||[]);return()=>new Promise((R,N)=>{const D=G=>{G===!1?N(Ll(4,{from:p,to:d})):G instanceof Error?N(G):D6(G)?N(Ll(2,{from:d,to:G})):(T&&_.enterCallbacks[E]===T&&typeof G=="function"&&T.push(G),R())},x=o.call(_&&_.instances[E],d,p,D);let P=Promise.resolve(x);o.length<3&&(P=P.then(D)),P.catch(G=>N(G))})}function iv(o,d,p,_){const E=[];for(const T of o)for(const R in T.components){let N=T.components[R];if(!(d!=="beforeRouteEnter"&&!T.instances[R]))if(aK(N)){const x=(N.__vccOpts||N)[d];x&&E.push(ic(x,p,_,T,R))}else{let D=N();E.push(()=>D.then(x=>{if(!x)return Promise.reject(new Error(`Couldn't resolve component "${R}" at "${T.path}"`));const P=p6(x)?x.default:x;T.components[R]=P;const z=(P.__vccOpts||P)[d];return z&&ic(z,p,_,T,R)()}))}}return E}function aK(o){return typeof o=="object"||"displayName"in o||"props"in o||"__vccOpts"in o}function lD(o){const d=dr(Sm),p=dr(LL),_=Hr(()=>d.resolve(Kr(o.to))),E=Hr(()=>{const{matched:D}=_.value,{length:x}=D,P=D[x-1],G=p.matched;if(!P||!G.length)return-1;const z=G.findIndex(Pl.bind(null,P));if(z>-1)return z;const rt=uD(D[x-2]);return x>1&&uD(P)===rt&&G[G.length-1].path!==rt?G.findIndex(Pl.bind(null,D[x-2])):z}),T=Hr(()=>E.value>-1&&uK(p.params,_.value.params)),R=Hr(()=>E.value>-1&&E.value===p.matched.length-1&&yL(p.params,_.value.params));function N(D={}){return lK(D)?d[Kr(o.replace)?"replace":"push"](Kr(o.to)).catch(Ih):Promise.resolve()}return{route:_,href:Hr(()=>_.value.href),isActive:T,isExactActive:R,navigate:N}}const cK=Nr({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:lD,setup(o,{slots:d}){const p=rm(lD(o)),{options:_}=dr(Sm),E=Hr(()=>({[hD(o.activeClass,_.linkActiveClass,"router-link-active")]:p.isActive,[hD(o.exactActiveClass,_.linkExactActiveClass,"router-link-exact-active")]:p.isExactActive}));return()=>{const T=d.default&&d.default(p);return o.custom?T:bP("a",{"aria-current":p.isExactActive?o.ariaCurrentValue:null,href:p.href,onClick:p.navigate,class:E.value},T)}}}),dK=cK;function lK(o){if(!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)&&!o.defaultPrevented&&!(o.button!==void 0&&o.button!==0)){if(o.currentTarget&&o.currentTarget.getAttribute){const d=o.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(d))return}return o.preventDefault&&o.preventDefault(),!0}}function uK(o,d){for(const p in d){const _=d[p],E=o[p];if(typeof _=="string"){if(_!==E)return!1}else if(!Xr(E)||E.length!==_.length||_.some((T,R)=>T!==E[R]))return!1}return!0}function uD(o){return o?o.aliasOf?o.aliasOf.path:o.path:""}const hD=(o,d,p)=>o??d??p,hK=Nr({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(o,{attrs:d,slots:p}){const _=dr(Dv),E=Hr(()=>o.route||_.value),T=dr(dD,0),R=Hr(()=>{let x=Kr(T);const{matched:P}=E.value;let G;for(;(G=P[x])&&!G.components;)x++;return x}),N=Hr(()=>E.value.matched[R.value]);P_(dD,Hr(()=>R.value+1)),P_(oK,N),P_(Dv,E);const D=js();return D_(()=>[D.value,N.value,o.name],([x,P,G],[z,rt,at])=>{P&&(P.instances[G]=x,rt&&rt!==P&&x&&x===z&&(P.leaveGuards.size||(P.leaveGuards=rt.leaveGuards),P.updateGuards.size||(P.updateGuards=rt.updateGuards))),x&&P&&(!rt||!Pl(P,rt)||!z)&&(P.enterCallbacks[G]||[]).forEach(dt=>dt(x))},{flush:"post"}),()=>{const x=E.value,P=o.name,G=N.value,z=G&&G.components[P];if(!z)return pD(p.default,{Component:z,route:x});const rt=G.props[P],at=rt?rt===!0?x.params:typeof rt=="function"?rt(x):rt:null,bt=bP(z,Tn({},at,d,{onVnodeUnmounted:Ot=>{Ot.component.isUnmounted&&(G.instances[P]=null)},ref:D}));return pD(p.default,{Component:bt,route:x})||bt}}});function pD(o,d){if(!o)return null;const p=o(d);return p.length===1?p[0]:p}const pK=hK;function fK(o){const d=j6(o.routes,o),p=o.parseQuery||sK,_=o.stringifyQuery||cD,E=o.history,T=fh(),R=fh(),N=fh(),D=AG(Za);let x=Za;Tl&&o.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const P=ev.bind(null,pt=>""+pt),G=ev.bind(null,iK),z=ev.bind(null,$_);function rt(pt,jt){let Lt,ee;return IL(pt)?(Lt=d.getRecordMatcher(pt),ee=jt):ee=pt,d.addRoute(ee,Lt)}function at(pt){const jt=d.getRecordMatcher(pt);jt&&d.removeRoute(jt)}function dt(){return d.getRoutes().map(pt=>pt.record)}function bt(pt){return!!d.getRecordMatcher(pt)}function Ot(pt,jt){if(jt=Tn({},jt||D.value),typeof pt=="string"){const st=nv(p,pt,jt.path),ft=d.resolve({path:st.path},jt),mt=E.createHref(st.fullPath);return Tn(st,ft,{params:z(ft.params),hash:$_(st.hash),redirectedFrom:void 0,href:mt})}let Lt;if("path"in pt)Lt=Tn({},pt,{path:nv(p,pt.path,jt.path).path});else{const st=Tn({},pt.params);for(const ft in st)st[ft]==null&&delete st[ft];Lt=Tn({},pt,{params:G(st)}),jt.params=G(jt.params)}const ee=d.resolve(Lt,jt),kt=pt.hash||"";ee.params=P(z(ee.params));const H=m6(_,Tn({},pt,{hash:tK(kt),path:ee.path})),Y=E.createHref(H);return Tn({fullPath:H,hash:kt,query:_===cD?rK(pt.query):pt.query||{}},ee,{redirectedFrom:void 0,href:Y})}function Dt(pt){return typeof pt=="string"?nv(p,pt,D.value.path):Tn({},pt)}function Gt(pt,jt){if(x!==pt)return Ll(8,{from:jt,to:pt})}function Tt(pt){return me(pt)}function Kt(pt){return Tt(Tn(Dt(pt),{replace:!0}))}function Zt(pt){const jt=pt.matched[pt.matched.length-1];if(jt&&jt.redirect){const{redirect:Lt}=jt;let ee=typeof Lt=="function"?Lt(pt):Lt;return typeof ee=="string"&&(ee=ee.includes("?")||ee.includes("#")?ee=Dt(ee):{path:ee},ee.params={}),Tn({query:pt.query,hash:pt.hash,params:"path"in ee?{}:pt.params},ee)}}function me(pt,jt){const Lt=x=Ot(pt),ee=D.value,kt=pt.state,H=pt.force,Y=pt.replace===!0,st=Zt(Lt);if(st)return me(Tn(Dt(st),{state:typeof st=="object"?Tn({},kt,st.state):kt,force:H,replace:Y}),jt||Lt);const ft=Lt;ft.redirectedFrom=jt;let mt;return!H&&E6(_,ee,Lt)&&(mt=Ll(16,{to:ft,from:ee}),Ii(ee,ee,!0,!1)),(mt?Promise.resolve(mt):_e(ft,ee)).catch(Rt=>sa(Rt)?sa(Rt,2)?Rt:_i(Rt):Ve(Rt,ft,ee)).then(Rt=>{if(Rt){if(sa(Rt,2))return me(Tn({replace:Y},Dt(Rt.to),{state:typeof Rt.to=="object"?Tn({},kt,Rt.to.state):kt,force:H}),jt||ft)}else Rt=qt(ft,ee,!0,Y,kt);return Le(ft,ee,Rt),Rt})}function $t(pt,jt){const Lt=Gt(pt,jt);return Lt?Promise.reject(Lt):Promise.resolve()}function Ce(pt){const jt=mi.values().next().value;return jt&&typeof jt.runWithContext=="function"?jt.runWithContext(pt):pt()}function _e(pt,jt){let Lt;const[ee,kt,H]=_K(pt,jt);Lt=iv(ee.reverse(),"beforeRouteLeave",pt,jt);for(const st of ee)st.leaveGuards.forEach(ft=>{Lt.push(ic(ft,pt,jt))});const Y=$t.bind(null,pt,jt);return Lt.push(Y),mn(Lt).then(()=>{Lt=[];for(const st of T.list())Lt.push(ic(st,pt,jt));return Lt.push(Y),mn(Lt)}).then(()=>{Lt=iv(kt,"beforeRouteUpdate",pt,jt);for(const st of kt)st.updateGuards.forEach(ft=>{Lt.push(ic(ft,pt,jt))});return Lt.push(Y),mn(Lt)}).then(()=>{Lt=[];for(const st of H)if(st.beforeEnter)if(Xr(st.beforeEnter))for(const ft of st.beforeEnter)Lt.push(ic(ft,pt,jt));else Lt.push(ic(st.beforeEnter,pt,jt));return Lt.push(Y),mn(Lt)}).then(()=>(pt.matched.forEach(st=>st.enterCallbacks={}),Lt=iv(H,"beforeRouteEnter",pt,jt),Lt.push(Y),mn(Lt))).then(()=>{Lt=[];for(const st of R.list())Lt.push(ic(st,pt,jt));return Lt.push(Y),mn(Lt)}).catch(st=>sa(st,8)?st:Promise.reject(st))}function Le(pt,jt,Lt){N.list().forEach(ee=>Ce(()=>ee(pt,jt,Lt)))}function qt(pt,jt,Lt,ee,kt){const H=Gt(pt,jt);if(H)return H;const Y=jt===Za,st=Tl?history.state:{};Lt&&(ee||Y?E.replace(pt.fullPath,Tn({scroll:Y&&st&&st.scroll},kt)):E.push(pt.fullPath,kt)),D.value=pt,Ii(pt,jt,Lt,Y),_i()}let Ee;function Sn(){Ee||(Ee=E.listen((pt,jt,Lt)=>{if(!bi.listening)return;const ee=Ot(pt),kt=Zt(ee);if(kt){me(Tn(kt,{replace:!0}),ee).catch(Ih);return}x=ee;const H=D.value;Tl&&I6(tD(H.fullPath,Lt.delta),Tm()),_e(ee,H).catch(Y=>sa(Y,12)?Y:sa(Y,2)?(me(Y.to,ee).then(st=>{sa(st,20)&&!Lt.delta&&Lt.type===kh.pop&&E.go(-1,!1)}).catch(Ih),Promise.reject()):(Lt.delta&&E.go(-Lt.delta,!1),Ve(Y,ee,H))).then(Y=>{Y=Y||qt(ee,H,!1),Y&&(Lt.delta&&!sa(Y,8)?E.go(-Lt.delta,!1):Lt.type===kh.pop&&sa(Y,20)&&E.go(-1,!1)),Le(ee,H,Y)}).catch(Ih)}))}let Qn=fh(),xe=fh(),Ne;function Ve(pt,jt,Lt){_i(pt);const ee=xe.list();return ee.length?ee.forEach(kt=>kt(pt,jt,Lt)):console.error(pt),Promise.reject(pt)}function Zn(){return Ne&&D.value!==Za?Promise.resolve():new Promise((pt,jt)=>{Qn.add([pt,jt])})}function _i(pt){return Ne||(Ne=!pt,Sn(),Qn.list().forEach(([jt,Lt])=>pt?Lt(pt):jt()),Qn.reset()),pt}function Ii(pt,jt,Lt,ee){const{scrollBehavior:kt}=o;if(!Tl||!kt)return Promise.resolve();const H=!Lt&&b6(tD(pt.fullPath,0))||(ee||!Lt)&&history.state&&history.state.scroll||null;return Qv().then(()=>kt(pt,jt,H)).then(Y=>Y&&R6(Y)).catch(Y=>Ve(Y,pt,jt))}const Ln=pt=>E.go(pt);let gt;const mi=new Set,bi={currentRoute:D,listening:!0,addRoute:rt,removeRoute:at,hasRoute:bt,getRoutes:dt,resolve:Ot,options:o,push:Tt,replace:Kt,go:Ln,back:()=>Ln(-1),forward:()=>Ln(1),beforeEach:T.add,beforeResolve:R.add,afterEach:N.add,onError:xe.add,isReady:Zn,install(pt){const jt=this;pt.component("RouterLink",dK),pt.component("RouterView",pK),pt.config.globalProperties.$router=jt,Object.defineProperty(pt.config.globalProperties,"$route",{enumerable:!0,get:()=>Kr(D)}),Tl&&!gt&&D.value===Za&&(gt=!0,Tt(E.location).catch(kt=>{}));const Lt={};for(const kt in Za)Object.defineProperty(Lt,kt,{get:()=>D.value[kt],enumerable:!0});pt.provide(Sm,jt),pt.provide(LL,WD(Lt)),pt.provide(Dv,D);const ee=pt.unmount;mi.add(pt),pt.unmount=function(){mi.delete(pt),mi.size<1&&(x=Za,Ee&&Ee(),Ee=null,D.value=Za,gt=!1,Ne=!1),ee()}}};function mn(pt){return pt.reduce((jt,Lt)=>jt.then(()=>Ce(Lt)),Promise.resolve())}return bi}function _K(o,d){const p=[],_=[],E=[],T=Math.max(d.matched.length,o.matched.length);for(let R=0;R<T;R++){const N=d.matched[R];N&&(o.matched.find(x=>Pl(x,N))?_.push(N):p.push(N));const D=o.matched[R];D&&(d.matched.find(x=>Pl(x,D))||E.push(D))}return[p,_,E]}function kL(){return dr(Sm)}const ML="/assets/logo-277e0e97.svg",mK={},EK={class:"container row mt-1 mb-2"},gK=Fh('<div class="dropdown col-1 offset-11 text-end"><a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><img src="'+ML+'" alt="mdo" width="32" height="32" class="rounded-circle"></a><ul class="dropdown-menu text-small"><li><a class="dropdown-item" href="#">Settings</a></li><li><a class="dropdown-item" href="#">Profile</a></li><li><hr class="dropdown-divider"></li><li><a class="dropdown-item" href="#">Sign out</a></li></ul></div>',1),TK=[gK];function SK(o,d){return Pn(),cs("div",EK,TK)}const UL=TC(mK,[["render",SK]]);var xL={exports:{}};(function(o,d){(function(p,_){o.exports=_()})(x_,function(){function p(n,t){return t.forEach(function(e){e&&typeof e!="string"&&!Array.isArray(e)&&Object.keys(e).forEach(function(i){if(i!=="default"&&!(i in n)){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})}),Object.freeze(n)}let _=!0,E=!0;function T(n,t,e){const i=n.match(t);return i&&i.length>=e&&parseInt(i[e],10)}function R(n,t,e){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(a,c){if(a!==t)return s.apply(this,arguments);const l=u=>{const h=e(u);h&&(c.handleEvent?c.handleEvent(h):c(h))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,l),s.apply(this,[a,l])};const r=i.removeEventListener;i.removeEventListener=function(a,c){if(a!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(c))return r.apply(this,arguments);const l=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[a,l])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function N(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(_=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function D(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(E=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function x(){if(typeof window=="object"){if(_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function P(n,t){E&&console.warn(n+" is deprecated, please use "+t+" instead.")}function G(n){return Object.prototype.toString.call(n)==="[object Object]"}function z(n){return G(n)?Object.keys(n).reduce(function(t,e){const i=G(n[e]),s=i?z(n[e]):n[e],r=i&&!Object.keys(s).length;return s===void 0||r?t:Object.assign(t,{[e]:s})},{}):n}function rt(n,t,e){t&&!e.has(t.id)&&(e.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?rt(n,n.get(t[i]),e):i.endsWith("Ids")&&t[i].forEach(s=>{rt(n,n.get(s),e)})}))}function at(n,t,e){const i=e?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const r=[];return n.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&r.push(a)}),r.forEach(a=>{n.forEach(c=>{c.type===i&&c.trackId===a.id&&rt(n,c,s)})}),s}const dt=x;function bt(n,t){const e=n&&n.navigator;if(!e.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,g){return f?f+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",l)]=u.ideal,c.optional.push(f),f={},f[h("max",l)]=u.ideal,c.optional.push(f)):(f[h("",l)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,l)]=u[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},s=function(a,c){if(t.version>=61)return c(a);if((a=JSON.parse(JSON.stringify(a)))&&typeof a.audio=="object"){const l=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};l((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&(!e.mediaDevices.getSupportedConstraints||!e.mediaDevices.getSupportedConstraints().facingMode||u)){let h;if(delete a.video.facingMode,l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:l.exact!=="user"&&l.ideal!=="user"||(h=["front"]),h)return e.mediaDevices.enumerateDevices().then(f=>{let g=(f=f.filter(S=>S.kind==="videoinput")).find(S=>h.some(w=>S.label.toLowerCase().includes(w)));return!g&&f.length&&h.includes("back")&&(g=f[f.length-1]),g&&(a.video.deviceId=l.exact?{exact:g.deviceId}:{ideal:g.deviceId}),a.video=i(a.video),dt("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return dt("chrome: "+JSON.stringify(a)),c(a)},r=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e.getUserMedia=(function(a,c,l){s(a,u=>{e.webkitGetUserMedia(u,c,h=>{l&&l(r(h))})})}).bind(e),e.mediaDevices.getUserMedia){const a=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(c){return s(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(r(u))))}}}function Ot(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function Dt(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",i=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):{track:i.track};const r=new Event("track");r.track=i.track,r.receiver=s,r.transceiver={receiver:s},r.streams=[e.stream],this.dispatchEvent(r)}),e.stream.getTracks().forEach(i=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===i.id):{track:i};const r=new Event("track");r.track=i,r.receiver=s,r.transceiver={receiver:s},r.streams=[e.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else R(n,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Gt(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const t=function(s,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=s.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){let l=s.apply(this,arguments);return l||(l=t(this,a),this._senders.push(l)),l};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(r=>{this._senders.push(t(this,r))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(r=>{const a=this._senders.find(c=>c.track===r);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(i=>i._pc=this),e},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Tt(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[e,i,s]=arguments;if(arguments.length>0&&typeof e=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof e!="function"))return t.apply(this,[]);const r=function(c){const l={};return c.result().forEach(u=>{const h={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(f=>{h[f]=u.stat(f)}),l[h.id]=h}),l},a=function(c){return new Map(Object.keys(c).map(l=>[l,c[l]]))};if(arguments.length>=2){const c=function(l){i(a(r(l)))};return t.apply(this,[c,e])}return new Promise((c,l)=>{t.apply(this,[function(u){c(a(r(u)))},l])}).then(i,s)}}function Kt(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>at(r,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i}),R(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>at(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const e=arguments[0];let i,s,r;return this.getSenders().forEach(a=>{a.track===e&&(i?r=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===e&&(s?r=!0:s=a),a.track===e)),r||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Zt(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(r=>this._shimmedLocalStreams[r][0])};const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(r,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._shimmedLocalStreams=this._shimmedLocalStreams||{},r.getTracks().forEach(l=>{if(this.getSenders().find(u=>u.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();e.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[r.id]=[r].concat(c)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[r.id],i.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(r);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function me(n,t){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Zt(n);const e=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const l=e.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(u=>this._reverseStreams[u.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(u=>{if(this.getSenders().find(h=>h.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const u=new n.MediaStream(l.getTracks());this._streams[l.id]=u,this._reverseStreams[u.id]=l,l=u}i.apply(this,[l])};const s=n.RTCPeerConnection.prototype.removeStream;function r(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const g=l._reverseStreams[f],S=l._streams[g.id];h=h.replace(new RegExp(S.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:h})}n.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},n.RTCPeerConnection.prototype.addTrack=function(l,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(g=>g===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const f=this._streams[u.id];if(f)f.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new n.MediaStream([l]);this._streams[u.id]=g,this._reverseStreams[g.id]=u,this.addStream(g)}return this.getSenders().find(g=>g.track===l)},["createOffer","createAnswer"].forEach(function(l){const u=n.RTCPeerConnection.prototype[l],h={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const S=r(this,g);f[0].apply(null,[S])},g=>{f[1]&&f[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>r(this,g))}};n.RTCPeerConnection.prototype[l]=h[l]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const g=l._reverseStreams[f],S=l._streams[g.id];h=h.replace(new RegExp(g.id,"g"),S.id)}),new RTCSessionDescription({type:u.type,sdp:h})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:r(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(l._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u;this._streams=this._streams||{},Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(f=>l.track===f)&&(u=this._streams[h])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $t(n,t){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const i=n.RTCPeerConnection.prototype[e],s={[e](){return arguments[0]=new(e==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[e]=s[e]})}function Ce(n,t){R(n,"negotiationneeded",e=>{const i=e.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return e})}var _e=Object.freeze({__proto__:null,fixNegotiationNeeded:Ce,shimAddTrackRemoveTrack:me,shimAddTrackRemoveTrackWithNative:Zt,shimGetDisplayMedia:function(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(typeof t=="function"?n.navigator.mediaDevices.getDisplayMedia=function(e){return t(e).then(i=>{const s=e.video&&e.video.width,r=e.video&&e.video.height,a=e.video&&e.video.frameRate;return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:a||3}},s&&(e.video.mandatory.maxWidth=s),r&&(e.video.mandatory.maxHeight=r),n.navigator.mediaDevices.getUserMedia(e)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Gt,shimGetStats:Tt,shimGetUserMedia:bt,shimMediaStream:Ot,shimOnTrack:Dt,shimPeerConnection:$t,shimSenderReceiverGetStats:Kt});function Le(n,t){const e=n&&n.navigator,i=n&&n.MediaStreamTrack;if(e.getUserMedia=function(s,r,a){P("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(s).then(r,a)},!(t.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const s=function(a,c,l){c in a&&!(l in a)&&(a[l]=a[c],delete a[c])},r=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a.audio,"autoGainControl","mozAutoGainControl"),s(a.audio,"noiseSuppression","mozNoiseSuppression")),r(a)},i&&i.prototype.getSettings){const a=i.prototype.getSettings;i.prototype.getSettings=function(){const c=a.apply(this,arguments);return s(c,"mozAutoGainControl","autoGainControl"),s(c,"mozNoiseSuppression","noiseSuppression"),c}}if(i&&i.prototype.applyConstraints){const a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),s(c,"autoGainControl","mozAutoGainControl"),s(c,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[c])}}}}function qt(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ee(n,t){if(typeof n!="object"||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=n.RTCPeerConnection.prototype[s],a={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=a[s]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,r,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(t.version<53&&!r)try{c.forEach(l=>{l.type=e[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:e[u.type]||u.type}))})}return c}).then(r,a)}}function Sn(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i});const e=n.RTCPeerConnection.prototype.addTrack;e&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=e.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Qn(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(i=>i._pc=this),e}),R(n,"track",e=>(e.receiver._pc=e.srcElement,e)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function xe(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(t){P("removeStream","removeTrack"),this.getSenders().forEach(e=>{e.track&&t.getTracks().includes(e.track)&&this.removeTrack(e)})})}function Ne(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function Ve(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.addTransceiver;t&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=[...e];const i=e.length>0;i&&e.forEach(r=>{if("rid"in r&&!/^[a-z0-9]{0,16}$/i.test(r.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in r&&!(parseFloat(r.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in r&&!(parseFloat(r.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(i){const{sender:r}=s,a=r.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=e,r.sendEncodings=e,this.setParametersPromises.push(r.setParameters(a).then(()=>{delete r.sendEncodings}).catch(()=>{delete r.sendEncodings})))}return s})}function Zn(n){if(typeof n!="object"||!n.RTCRtpSender)return;const t=n.RTCRtpSender.prototype.getParameters;t&&(n.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function _i(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Ii(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Ln=Object.freeze({__proto__:null,shimAddTransceiver:Ve,shimCreateAnswer:Ii,shimCreateOffer:_i,shimGetDisplayMedia:function(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(e){if(!e||!e.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return e.video===!0?e.video={mediaSource:t}:e.video.mediaSource=t,n.navigator.mediaDevices.getUserMedia(e)})},shimGetParameters:Zn,shimGetUserMedia:Le,shimOnTrack:qt,shimPeerConnection:Ee,shimRTCDataChannel:Ne,shimReceiverGetStats:Qn,shimRemoveStream:xe,shimSenderGetStats:Sn});function gt(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(i=>t.call(this,i,e)),e.getVideoTracks().forEach(i=>t.call(this,i,e))},n.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),t.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(t);if(e===-1)return;this._localStreams.splice(e,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function mi(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,this.dispatchEvent(r)})})}});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(s)>=0)return;e._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,e.dispatchEvent(r)})}),t.apply(e,arguments)}}}function bi(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype,e=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=e.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f},t.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f};let c=function(l,u,h){const f=s.apply(this,[l]);return h?(f.then(u,h),Promise.resolve()):f};t.setLocalDescription=c,c=function(l,u,h){const f=r.apply(this,[l]);return h?(f.then(u,h),Promise.resolve()):f},t.setRemoteDescription=c,c=function(l,u,h){const f=a.apply(this,[l]);return h?(f.then(u,h),Promise.resolve()):f},t.addIceCandidate=c}function mn(n){const t=n&&n.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=s=>i(pt(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,i,s){t.mediaDevices.getUserMedia(e).then(i,s)}).bind(t))}function pt(n){return n&&n.video!==void 0?Object.assign({},n,{video:z(n.video)}):n}function jt(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection;n.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const s=[];for(let r=0;r<e.iceServers.length;r++){let a=e.iceServers[r];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(P("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(e.iceServers[r])}e.iceServers=s}return new t(e,i)},n.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Lt(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ee(n){const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(e){if(e){e.offerToReceiveAudio!==void 0&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const i=this.getTransceivers().find(r=>r.receiver.track.kind==="audio");e.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):e.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),e.offerToReceiveVideo!==void 0&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const s=this.getTransceivers().find(r=>r.receiver.track.kind==="video");e.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):e.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function kt(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var H=Object.freeze({__proto__:null,shimAudioContext:kt,shimCallbacksAPI:bi,shimConstraints:pt,shimCreateOfferLegacy:ee,shimGetUserMedia:mn,shimLocalStreamsAPI:gt,shimRTCIceServerUrls:jt,shimRemoteStreamsAPI:mi,shimTrackEventTransceiver:Lt}),Y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof x_<"u"?x_:typeof self<"u"?self:{};function st(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ft={exports:{}};(function(n){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(e){return e.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(e){const i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){const i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter(s=>s.indexOf(i)===0)},t.parseCandidate=function(e){let i;i=e.indexOf("a=candidate:")===0?e.substring(12).split(" "):e.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let r=8;r<i.length;r+=2)switch(i[r]){case"raddr":s.relatedAddress=i[r+1];break;case"rport":s.relatedPort=parseInt(i[r+1],10);break;case"tcptype":s.tcpType=i[r+1];break;case"ufrag":s.ufrag=i[r+1],s.usernameFragment=i[r+1];break;default:s[i[r]]===void 0&&(s[i[r]]=i[r+1])}return s},t.writeCandidate=function(e){const i=[];i.push(e.foundation);const s=e.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(e.protocol.toUpperCase()),i.push(e.priority),i.push(e.address||e.ip),i.push(e.port);const r=e.type;return i.push("typ"),i.push(r),r!=="host"&&e.relatedAddress&&e.relatedPort&&(i.push("raddr"),i.push(e.relatedAddress),i.push("rport"),i.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(i.push("ufrag"),i.push(e.usernameFragment||e.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let i=e.substring(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(e){let i=e.payloadType;e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType);const s=e.channels||e.numChannels||1;return"a=rtpmap:"+i+" "+e.name+"/"+e.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(e){const i=e.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+`\r
`},t.parseFmtp=function(e){const i={};let s;const r=e.substring(e.indexOf(" ")+1).split(";");for(let a=0;a<r.length;a++)s=r[a].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(e){let i="",s=e.payloadType;if(e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach(a=>{e.parameters[a]!==void 0?r.push(a+"="+e.parameters[a]):r.push(a)}),i+="a=fmtp:"+s+" "+r.join(";")+`\r
`}return i},t.parseRtcpFb=function(e){const i=e.substring(e.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(e){let i="",s=e.payloadType;return e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(r=>{i+="a=rtcp-fb:"+s+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(e){const i=e.indexOf(" "),s={ssrc:parseInt(e.substring(7,i),10)},r=e.indexOf(":",i);return r>-1?(s.attribute=e.substring(i+1,r),s.value=e.substring(r+1)):s.attribute=e.substring(i+1),s},t.parseSsrcGroup=function(e){const i=e.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},t.getMid=function(e){const i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(e){const i=e.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(e,i){return{role:"auto",fingerprints:t.matchPrefix(e+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,i){let s="a=setup:"+i+`\r
`;return e.fingerprints.forEach(r=>{s+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),s},t.parseCryptoLine=function(e){const i=e.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;const i=e.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){return t.matchPrefix(e+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,i){const s=t.matchPrefix(e+i,"a=ice-ufrag:")[0],r=t.matchPrefix(e+i,"a=ice-pwd:")[0];return s&&r?{usernameFragment:s.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let i="a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`;return e.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(e){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(e)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=t.matchPrefix(e,"a=rtpmap:"+c+" ")[0];if(l){const u=t.parseRtpMap(l),h=t.matchPrefix(e,"a=fmtp:"+c+" ");switch(u.parameters=h.length?t.parseFmtp(h[0]):{},u.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(a=>{i.headerExtensions.push(t.parseExtmap(a))});const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(a=>{r.forEach(c=>{a.rtcpFeedback.find(l=>l.type===c.type&&l.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},t.writeRtpDescription=function(e,i){let s="";s+="m="+e+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{s+=t.writeRtpMap(a),s+=t.writeFmtp(a),s+=t.writeRtcpFb(a)});let r=0;return i.codecs.forEach(a=>{a.maxptime>r&&(r=a.maxptime)}),r>0&&(s+="a=maxptime:"+r+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{s+=t.writeExtmap(a)}),s},t.parseRtpEncodingParameters=function(e){const i=[],s=t.parseRtpParameters(e),r=s.fecMechanisms.indexOf("RED")!==-1,a=s.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(e,"a=ssrc:").map(g=>t.parseSsrcMedia(g)).filter(g=>g.attribute==="cname"),l=c.length>0&&c[0].ssrc;let u;const h=t.matchPrefix(e,"a=ssrc-group:FID").map(g=>g.substring(17).split(" ").map(S=>parseInt(S,10)));h.length>0&&h[0].length>1&&h[0][0]===l&&(u=h[0][1]),s.codecs.forEach(g=>{if(g.name.toUpperCase()==="RTX"&&g.parameters.apt){let S={ssrc:l,codecPayloadType:parseInt(g.parameters.apt,10)};l&&u&&(S.rtx={ssrc:u}),i.push(S),r&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},i.push(S))}}),i.length===0&&l&&i.push({ssrc:l});let f=t.matchPrefix(e,"b=");return f.length&&(f=f[0].indexOf("b=TIAS:")===0?parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?1e3*parseInt(f[0].substring(5),10)*.95-16e3:void 0,i.forEach(g=>{g.maxBitrate=f})),i},t.parseRtcpParameters=function(e){const i={},s=t.matchPrefix(e,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;const a=t.matchPrefix(e,"a=rtcp-mux");return i.mux=a.length>0,i},t.writeRtcpParameters=function(e){let i="";return e.reducedSize&&(i+=`a=rtcp-rsize\r
`),e.mux&&(i+=`a=rtcp-mux\r
`),e.ssrc!==void 0&&e.cname&&(i+="a=ssrc:"+e.ssrc+" cname:"+e.cname+`\r
`),i},t.parseMsid=function(e){let i;const s=t.matchPrefix(e,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};const r=t.matchPrefix(e,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");return r.length>0?(i=r[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(e){const i=t.parseMLine(e),s=t.matchPrefix(e,"a=max-message-size:");let r;s.length>0&&(r=parseInt(s[0].substring(19),10)),isNaN(r)&&(r=65536);const a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};const c=t.matchPrefix(e,"a=sctpmap:");if(c.length>0){const l=c[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,i){let s=[];return s=e.protocol!=="DTLS/SCTP"?["m="+e.kind+" 9 "+e.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+e.kind+" 9 "+e.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,i,s){let r;const a=i!==void 0?i:2;return r=e||t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+r+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(e,i){const s=t.splitLines(e);for(let r=0;r<s.length;r++)switch(s[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[r].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return e.split(" ",2)[1]==="0"},t.parseMLine=function(e){const i=t.splitLines(e)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){const i=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;const i=t.splitLines(e);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},n.exports=t})(ft);var mt=ft.exports,Rt=st(mt),Wt=p({__proto__:null,default:Rt},[mt]);function Nt(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const t=n.RTCIceCandidate;n.RTCIceCandidate=function(e){if(typeof e=="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const i=new t(e),s=Rt.parseCandidate(e.candidate),r=Object.assign(i,s);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},n.RTCIceCandidate.prototype=t.prototype,R(n,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new n.RTCIceCandidate(e.candidate),writable:"false"}),e))}function Mt(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||R(n,"icecandidate",t=>{if(t.candidate){const e=Rt.parseCandidate(t.candidate.candidate);e.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[e.priority>>24])}return t})}function It(n,t){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const e=function(c){if(!c||!c.sdp)return!1;const l=Rt.splitSections(c.sdp);return l.shift(),l.some(u=>{const h=Rt.parseMLine(u);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},i=function(c){const l=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const u=parseInt(l[1],10);return u!=u?-1:u},s=function(c){let l=65536;return t.browser==="firefox"&&(l=t.version<57?c===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),l},r=function(c,l){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const h=Rt.matchPrefix(c.sdp,"a=max-message-size:");return h.length>0?u=parseInt(h[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(u=2147483637),u},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const c=i(arguments[0]),l=s(c),u=r(arguments[0],c);let h;h=l===0&&u===0?Number.POSITIVE_INFINITY:l===0||u===0?Math.max(l,u):Math.min(l,u);const f={};Object.defineProperty(f,"maxMessageSize",{get:()=>h}),this._sctp=f}return a.apply(this,arguments)}}function ne(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function t(i,s){const r=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const e=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=e.apply(this,arguments);return t(i,this),i},R(n,"datachannel",i=>(t(i.channel,i.target),i))}function zt(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const r=s.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const a=new Event("connectionstatechange",s);r.dispatchEvent(a)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function ie(n,t){if(!n.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(r=>r.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return e.apply(this,arguments)}}function fe(n,t){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype.addIceCandidate;e&&e.length!==0&&(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ae(n,t){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype.setLocalDescription;e&&e.length!==0&&(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return e.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?e.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>e.apply(this,[s]))})}var Xe=Object.freeze({__proto__:null,removeExtmapAllowMixed:ie,shimAddIceCandidateNullOrEmpty:fe,shimConnectionState:zt,shimMaxMessageSize:It,shimParameterlessSetLocalDescription:Ae,shimRTCIceCandidate:Nt,shimRTCIceCandidateRelayProtocol:Mt,shimSendThrowTypeError:ne});(function({window:n}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const e=x,i=function(r){const a={browser:null,version:null};if(r===void 0||!r.navigator)return a.browser="Not a browser.",a;const{navigator:c}=r;if(c.mozGetUserMedia)a.browser="firefox",a.version=T(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)a.browser="chrome",a.version=T(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!r.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=T(c.userAgent,/AppleWebKit\/(\d+)\./,1),a.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype}return a}(n),s={browserDetails:i,commonShim:Xe,extractVersion:T,disableLog:N,disableWarnings:D,sdp:Wt};switch(i.browser){case"chrome":if(!_e||!$t||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),s;if(i.version===null)return e("Chrome shim can not determine version, not shimming."),s;e("adapter.js shimming chrome."),s.browserShim=_e,fe(n,i),Ae(n),bt(n,i),Ot(n),$t(n,i),Dt(n),me(n,i),Gt(n),Tt(n),Kt(n),Ce(n,i),Nt(n),Mt(n),zt(n),It(n,i),ne(n),ie(n,i);break;case"firefox":if(!Ln||!Ee||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),s;e("adapter.js shimming firefox."),s.browserShim=Ln,fe(n,i),Ae(n),Le(n,i),Ee(n,i),qt(n),xe(n),Sn(n),Qn(n),Ne(n),Ve(n),Zn(n),_i(n),Ii(n),Nt(n),zt(n),It(n,i),ne(n);break;case"safari":if(!H||!t.shimSafari)return e("Safari shim is not included in this adapter release."),s;e("adapter.js shimming safari."),s.browserShim=H,fe(n,i),Ae(n),jt(n),ee(n),bi(n),gt(n),mi(n),Lt(n),mn(n),kt(n),Nt(n),Mt(n),It(n,i),ne(n),ie(n,i);break;default:e("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var se=function(n){try{return!!n()}catch{return!0}},vn=!se(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),Ei=vn,Ji=Function.prototype,Ws=Ji.call,pr=Ei&&Ji.bind.bind(Ws,Ws),Cn=Ei?pr:function(n){return function(){return Ws.apply(n,arguments)}},En=Cn({}.isPrototypeOf),ji=function(n){return n&&n.Math==Math&&n},ti=ji(typeof globalThis=="object"&&globalThis)||ji(typeof window=="object"&&window)||ji(typeof self=="object"&&self)||ji(typeof Y=="object"&&Y)||function(){return this}()||Y||Function("return this")(),bm=vn,Hh=Function.prototype,Kh=Hh.apply,qh=Hh.call,ld=typeof Reflect=="object"&&Reflect.apply||(bm?qh.bind(Kh):function(){return qh.apply(Kh,arguments)}),dc=Cn,Yh=dc({}.toString),zh=dc("".slice),$r=function(n){return zh(Yh(n),8,-1)},Am=$r,wm=Cn,Bl=function(n){if(Am(n)==="Function")return wm(n)},Qr=typeof document=="object"&&document.all,Zr={all:Qr,IS_HTMLDDA:Qr===void 0&&Qr!==void 0},Om=Zr.all,ii=Zr.IS_HTMLDDA?function(n){return typeof n=="function"||n===Om}:function(n){return typeof n=="function"},lc={},fr=!se(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Nm=vn,pa=Function.prototype.call,ei=Nm?pa.bind(pa):function(){return pa.apply(pa,arguments)},fa={},Jh={}.propertyIsEnumerable,ud=Object.getOwnPropertyDescriptor,Dm=ud&&!Jh.call({1:2},1);fa.f=Dm?function(n){var t=ud(this,n);return!!t&&t.enumerable}:Jh;var to,Dr,eo=function(n,t){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:t}},ko=se,jl=$r,Gl=Object,Xh=Cn("".split),Wl=ko(function(){return!Gl("z").propertyIsEnumerable(0)})?function(n){return jl(n)=="String"?Xh(n,""):Gl(n)}:Gl,hd=function(n){return n==null},Pm=hd,Lm=TypeError,_a=function(n){if(Pm(n))throw Lm("Can't call method on "+n);return n},$h=Wl,km=_a,Ss=function(n){return $h(km(n))},no=ii,Mm=Zr.all,Gi=Zr.IS_HTMLDDA?function(n){return typeof n=="object"?n!==null:no(n)||n===Mm}:function(n){return typeof n=="object"?n!==null:no(n)},Mo={},Hl=Mo,Kl=ti,Um=ii,Qh=function(n){return Um(n)?n:void 0},Xi=function(n,t){return arguments.length<2?Qh(Hl[n])||Qh(Kl[n]):Hl[n]&&Hl[n][t]||Kl[n]&&Kl[n][t]},Uo=typeof navigator<"u"&&String(navigator.userAgent)||"",Zh=ti,ds=Uo,ql=Zh.process,Yl=Zh.Deno,zl=ql&&ql.versions||Yl&&Yl.version,tp=zl&&zl.v8;tp&&(Dr=(to=tp.split("."))[0]>0&&to[0]<4?1:+(to[0]+to[1])),!Dr&&ds&&(!(to=ds.match(/Edge\/(\d+)/))||to[1]>=74)&&(to=ds.match(/Chrome\/(\d+)/))&&(Dr=+to[1]);var xo=Dr,Jl=xo,pd=se,xm=ti.String,ma=!!Object.getOwnPropertySymbols&&!pd(function(){var n=Symbol();return!xm(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&Jl&&Jl<41}),Xl=ma&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Vm=Xi,Fm=ii,ep=En,np=Object,Ea=Xl?function(n){return typeof n=="symbol"}:function(n){var t=Vm("Symbol");return Fm(t)&&ep(t.prototype,np(n))},fd=String,Vo=function(n){try{return fd(n)}catch{return"Object"}},$l=ii,vs=Vo,Bm=TypeError,Cs=function(n){if($l(n))return n;throw Bm(vs(n)+" is not a function")},ip=Cs,sp=hd,Ql=function(n,t){var e=n[t];return sp(e)?void 0:ip(e)},Zl=ei,tu=ii,eu=Gi,jm=TypeError,rp={exports:{}},nu=ti,op=Object.defineProperty,iu=function(n,t){try{op(nu,n,{value:t,configurable:!0,writable:!0})}catch{nu[n]=t}return t},ap="__core-js_shared__",su=ti[ap]||iu(ap,{}),io=su;(rp.exports=function(n,t){return io[n]||(io[n]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var $i=rp.exports,cp=_a,Gm=Object,so=function(n){return Gm(cp(n))},dp=so,lp=Cn({}.hasOwnProperty),Ai=Object.hasOwn||function(n,t){return lp(dp(n),t)},Wm=Cn,Hm=0,Km=Math.random(),up=Wm(1 .toString),_d=function(n){return"Symbol("+(n===void 0?"":n)+")_"+up(++Hm+Km,36)},qm=$i,hp=Ai,Ym=_d,zm=ma,Jm=Xl,Qi=ti.Symbol,md=qm("wks"),Xm=Jm?Qi.for||Qi:Qi&&Qi.withoutSetter||Ym,kn=function(n){return hp(md,n)||(md[n]=zm&&hp(Qi,n)?Qi[n]:Xm("Symbol."+n)),md[n]},$m=ei,pp=Gi,fp=Ea,Qm=Ql,Zm=function(n,t){var e,i;if(t==="string"&&tu(e=n.toString)&&!eu(i=Zl(e,n))||tu(e=n.valueOf)&&!eu(i=Zl(e,n))||t!=="string"&&tu(e=n.toString)&&!eu(i=Zl(e,n)))return i;throw jm("Can't convert object to primitive value")},tE=TypeError,ru=kn("toPrimitive"),Ed=function(n,t){if(!pp(n)||fp(n))return n;var e,i=Qm(n,ru);if(i){if(t===void 0&&(t="default"),e=$m(i,n,t),!pp(e)||fp(e))return e;throw tE("Can't convert object to primitive value")}return t===void 0&&(t="number"),Zm(n,t)},_p=Ea,uc=function(n){var t=Ed(n,"string");return _p(t)?t:t+""},ga=Gi,hc=ti.document,eE=ga(hc)&&ga(hc.createElement),ou=function(n){return eE?hc.createElement(n):{}},nE=ou,ro=!fr&&!se(function(){return Object.defineProperty(nE("div"),"a",{get:function(){return 7}}).a!=7}),iE=fr,sE=ei,gd=fa,au=eo,rE=Ss,mp=uc,oE=Ai,Ta=ro,Td=Object.getOwnPropertyDescriptor;lc.f=iE?Td:function(n,t){if(n=rE(n),t=mp(t),Ta)try{return Td(n,t)}catch{}if(oE(n,t))return au(!sE(gd.f,n,t),n[t])};var Ep=se,aE=ii,cE=/#|\.prototype\./,pc=function(n,t){var e=Fo[fc(n)];return e==lE||e!=dE&&(aE(t)?Ep(t):!!t)},fc=pc.normalize=function(n){return String(n).replace(cE,".").toLowerCase()},Fo=pc.data={},dE=pc.NATIVE="N",lE=pc.POLYFILL="P",gp=pc,uE=Cs,hE=vn,pE=Bl(Bl.bind),_c=function(n,t){return uE(n),t===void 0?n:hE?pE(n,t):function(){return n.apply(t,arguments)}},ys={},cu=fr&&se(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),fE=Gi,Tp=String,du=TypeError,Rs=function(n){if(fE(n))return n;throw du(Tp(n)+" is not an object")},Bo=fr,Sp=ro,lu=cu,mc=Rs,Sd=uc,vp=TypeError,Ec=Object.defineProperty,_E=Object.getOwnPropertyDescriptor,Pr="enumerable",_r="configurable",uu="writable";ys.f=Bo?lu?function(n,t,e){if(mc(n),t=Sd(t),mc(e),typeof n=="function"&&t==="prototype"&&"value"in e&&uu in e&&!e[uu]){var i=_E(n,t);i&&i[uu]&&(n[t]=e.value,e={configurable:_r in e?e[_r]:i[_r],enumerable:Pr in e?e[Pr]:i[Pr],writable:!1})}return Ec(n,t,e)}:Ec:function(n,t,e){if(mc(n),t=Sd(t),mc(e),Sp)try{return Ec(n,t,e)}catch{}if("get"in e||"set"in e)throw vp("Accessors not supported");return"value"in e&&(n[t]=e.value),n};var mE=ys,EE=eo,oo=fr?function(n,t,e){return mE.f(n,t,EE(1,e))}:function(n,t,e){return n[t]=e,n},vd=ti,gE=ld,TE=Bl,SE=ii,Cp=lc.f,Cd=gp,Lr=Mo,vE=_c,Sa=oo,va=Ai,X=function(n){var t=function(e,i,s){if(this instanceof t){switch(arguments.length){case 0:return new n;case 1:return new n(e);case 2:return new n(e,i)}return new n(e,i,s)}return gE(n,this,arguments)};return t.prototype=n.prototype,t},C=function(n,t){var e,i,s,r,a,c,l,u,h,f=n.target,g=n.global,S=n.stat,w=n.proto,I=g?vd:S?vd[f]:(vd[f]||{}).prototype,b=g?Lr:Lr[f]||Sa(Lr,f,{})[f],M=b.prototype;for(r in t)i=!(e=Cd(g?r:f+(S?".":"#")+r,n.forced))&&I&&va(I,r),c=b[r],i&&(l=n.dontCallGetSet?(h=Cp(I,r))&&h.value:I[r]),a=i&&l?l:t[r],i&&typeof c==typeof a||(u=n.bind&&i?vE(a,vd):n.wrap&&i?X(a):w&&SE(a)?TE(a):a,(n.sham||a&&a.sham||c&&c.sham)&&Sa(u,"sham",!0),Sa(b,r,u),w&&(va(Lr,s=f+"Prototype")||Sa(Lr,s,{}),Sa(Lr[s],r,a),n.real&&M&&(e||!M[r])&&Sa(M,r,a)))},k=Math.ceil,J=Math.floor,Et=Math.trunc||function(n){var t=+n;return(t>0?J:k)(t)},Bt=function(n){var t=+n;return t!=t||t===0?0:Et(t)},te=Bt,Ye=Math.max,xn=Math.min,Wi=function(n,t){var e=te(n);return e<0?Ye(e+t,0):xn(e,t)},ls=Bt,Hs=Math.min,kr=function(n){return n>0?Hs(ls(n),9007199254740991):0},Hi=function(n){return kr(n.length)},jo=Ss,Ks=Wi,gc=Hi,Tc=function(n){return function(t,e,i){var s,r=jo(t),a=gc(r),c=Ks(i,a);if(n&&e!=e){for(;a>c;)if((s=r[c++])!=s)return!0}else for(;a>c;c++)if((n||c in r)&&r[c]===e)return n||c||0;return!n&&-1}},yp={includes:Tc(!0),indexOf:Tc(!1)},Go=yp.includes;C({target:"Array",proto:!0,forced:se(function(){return!Array(1).includes()})},{includes:function(n){return Go(this,n,arguments.length>1?arguments[1]:void 0)}});var CE=Mo,Sc=function(n){return CE[n+"Prototype"]},ok=Sc("Array").includes,ak=Gi,ck=$r,dk=kn("match"),lk=function(n){var t;return ak(n)&&((t=n[dk])!==void 0?!!t:ck(n)=="RegExp")},uk=TypeError,AC={};AC[kn("toStringTag")]="z";var yE=String(AC)==="[object z]",hk=yE,pk=ii,Rp=$r,fk=kn("toStringTag"),_k=Object,mk=Rp(function(){return arguments}())=="Arguments",vc=hk?Rp:function(n){var t,e,i;return n===void 0?"Undefined":n===null?"Null":typeof(e=function(s,r){try{return s[r]}catch{}}(t=_k(n),fk))=="string"?e:mk?Rp(t):(i=Rp(t))=="Object"&&pk(t.callee)?"Arguments":i},Ek=vc,gk=String,Wo=function(n){if(Ek(n)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return gk(n)},Tk=kn("match"),Sk=C,vk=function(n){if(lk(n))throw uk("The method doesn't accept regular expressions");return n},Ck=_a,wC=Wo,yk=function(n){var t=/./;try{"/./"[n](t)}catch{try{return t[Tk]=!1,"/./"[n](t)}catch{}}return!1},Rk=Cn("".indexOf);Sk({target:"String",proto:!0,forced:!yk("includes")},{includes:function(n){return!!~Rk(wC(Ck(this)),wC(vk(n)),arguments.length>1?arguments[1]:void 0)}});var Ik=Sc("String").includes,OC=En,bk=ok,Ak=Ik,RE=Array.prototype,IE=String.prototype,Vt=st(function(n){var t=n.includes;return n===RE||OC(RE,n)&&t===RE.includes?bk:typeof n=="string"||n===IE||OC(IE,n)&&t===IE.includes?Ak:t}),NC={exports:{}},wk=C,Ok=fr,DC=ys.f;wk({target:"Object",stat:!0,forced:Object.defineProperty!==DC,sham:!Ok},{defineProperty:DC});var PC=Mo.Object,Nk=NC.exports=function(n,t,e){return PC.defineProperty(n,t,e)};PC.defineProperty.sham&&(Nk.sham=!0);var Dk=st(NC.exports),Pk=$r,bE=Array.isArray||function(n){return Pk(n)=="Array"},Lk=TypeError,kk=uc,Mk=ys,Uk=eo,LC=function(n,t,e){var i=kk(t);i in n?Mk.f(n,i,Uk(0,e)):n[i]=e},xk=ii,AE=su,Vk=Cn(Function.toString);xk(AE.inspectSource)||(AE.inspectSource=function(n){return Vk(n)});var kC=AE.inspectSource,Fk=Cn,Bk=se,MC=ii,jk=vc,Gk=kC,UC=function(){},Wk=[],xC=Xi("Reflect","construct"),wE=/^\s*(?:class|function)\b/,Hk=Fk(wE.exec),Kk=!wE.exec(UC),hu=function(n){if(!MC(n))return!1;try{return xC(UC,Wk,n),!0}catch{return!1}},VC=function(n){if(!MC(n))return!1;switch(jk(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Kk||!!Hk(wE,Gk(n))}catch{return!0}};VC.sham=!0;var FC=!xC||Bk(function(){var n;return hu(hu.call)||!hu(Object)||!hu(function(){n=!0})||n})?VC:hu,BC=bE,qk=FC,Yk=Gi,zk=kn("species"),jC=Array,Jk=function(n){var t;return BC(n)&&(t=n.constructor,(qk(t)&&(t===jC||BC(t.prototype))||Yk(t)&&(t=t[zk])===null)&&(t=void 0)),t===void 0?jC:t},GC=function(n,t){return new(Jk(n))(t===0?0:t)},Xk=se,$k=xo,Qk=kn("species"),Zk=C,t1=se,e1=bE,n1=Gi,i1=so,s1=Hi,WC=function(n){if(n>9007199254740991)throw Lk("Maximum allowed index exceeded");return n},HC=LC,r1=GC,o1=function(n){return $k>=51||!Xk(function(){var t=[];return(t.constructor={})[Qk]=function(){return{foo:1}},t[n](Boolean).foo!==1})},a1=xo,KC=kn("isConcatSpreadable"),c1=a1>=51||!t1(function(){var n=[];return n[KC]=!1,n.concat()[0]!==n}),d1=function(n){if(!n1(n))return!1;var t=n[KC];return t!==void 0?!!t:e1(n)};Zk({target:"Array",proto:!0,arity:1,forced:!c1||!o1("concat")},{concat:function(n){var t,e,i,s,r,a=i1(this),c=r1(a,0),l=0;for(t=-1,i=arguments.length;t<i;t++)if(d1(r=t===-1?a:arguments[t]))for(s=s1(r),WC(l+s),e=0;e<s;e++,l++)e in r&&HC(c,l,r[e]);else WC(l+1),HC(c,l++,r);return c.length=l,c}});var OE={},Ip={},NE=Ai,l1=Ss,u1=yp.indexOf,h1=Ip,qC=Cn([].push),YC=function(n,t){var e,i=l1(n),s=0,r=[];for(e in i)!NE(h1,e)&&NE(i,e)&&qC(r,e);for(;t.length>s;)NE(i,e=t[s++])&&(~u1(r,e)||qC(r,e));return r},DE=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],p1=YC,f1=DE,zC=Object.keys||function(n){return p1(n,f1)},_1=fr,m1=cu,E1=ys,g1=Rs,T1=Ss,S1=zC;OE.f=_1&&!m1?Object.defineProperties:function(n,t){g1(n);for(var e,i=T1(t),s=S1(t),r=s.length,a=0;r>a;)E1.f(n,e=s[a++],i[e]);return n};var bp,JC=Xi("document","documentElement"),v1=_d,XC=$i("keys"),Ap=function(n){return XC[n]||(XC[n]=v1(n))},C1=Rs,y1=OE,$C=DE,R1=Ip,I1=JC,b1=ou,PE="prototype",LE="script",QC=Ap("IE_PROTO"),kE=function(){},ZC=function(n){return"<"+LE+">"+n+"</"+LE+">"},ty=function(n){n.write(ZC("")),n.close();var t=n.parentWindow.Object;return n=null,t},wp=function(){try{bp=new ActiveXObject("htmlfile")}catch{}var n,t,e;wp=typeof document<"u"?document.domain&&bp?ty(bp):(t=b1("iframe"),e="java"+LE+":",t.style.display="none",I1.appendChild(t),t.src=String(e),(n=t.contentWindow.document).open(),n.write(ZC("document.F=Object")),n.close(),n.F):ty(bp);for(var i=$C.length;i--;)delete wp[PE][$C[i]];return wp()};R1[QC]=!0;var Op=Object.create||function(n,t){var e;return n!==null?(kE[PE]=C1(n),e=new kE,kE[PE]=null,e[QC]=n):e=wp(),t===void 0?e:y1.f(e,t)},Np={},A1=YC,w1=DE.concat("length","prototype");Np.f=Object.getOwnPropertyNames||function(n){return A1(n,w1)};var ey={},ny=Wi,O1=Hi,N1=LC,D1=Array,P1=Math.max,iy=function(n,t,e){for(var i=O1(n),s=ny(t,i),r=ny(e===void 0?i:e,i),a=D1(P1(r-s,0)),c=0;s<r;s++,c++)N1(a,c,n[s]);return a.length=c,a},L1=$r,k1=Ss,sy=Np.f,M1=iy,ry=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];ey.f=function(n){return ry&&L1(n)=="Window"?function(t){try{return sy(t)}catch{return M1(ry)}}(n):sy(k1(n))};var Dp={};Dp.f=Object.getOwnPropertySymbols;var U1=oo,pu=function(n,t,e,i){return i&&i.enumerable?n[t]=e:U1(n,t,e),n},x1=ys,oy=function(n,t,e){return x1.f(n,t,e)},yd={},V1=kn;yd.f=V1;var Pp,fu,Lp,ay=Mo,F1=Ai,B1=yd,j1=ys.f,si=function(n){var t=ay.Symbol||(ay.Symbol={});F1(t,n)||j1(t,n,{value:B1.f(n)})},G1=ei,W1=Xi,H1=kn,K1=pu,cy=function(){var n=W1("Symbol"),t=n&&n.prototype,e=t&&t.valueOf,i=H1("toPrimitive");t&&!t[i]&&K1(t,i,function(s){return G1(e,this)},{arity:1})},q1=vc,Y1=yE?{}.toString:function(){return"[object "+q1(this)+"]"},z1=yE,J1=ys.f,X1=oo,$1=Ai,Q1=Y1,dy=kn("toStringTag"),Rd=function(n,t,e,i){if(n){var s=e?n:n.prototype;$1(s,dy)||J1(s,dy,{configurable:!0,value:t}),i&&!z1&&X1(s,"toString",Q1)}},Z1=ii,ly=ti.WeakMap,tM=Z1(ly)&&/native code/.test(String(ly)),uy=ti,eM=Gi,nM=oo,ME=Ai,UE=su,iM=Ap,sM=Ip,hy="Object already initialized",xE=uy.TypeError,rM=uy.WeakMap;if(tM||UE.state){var ao=UE.state||(UE.state=new rM);ao.get=ao.get,ao.has=ao.has,ao.set=ao.set,Pp=function(n,t){if(ao.has(n))throw xE(hy);return t.facade=n,ao.set(n,t),t},fu=function(n){return ao.get(n)||{}},Lp=function(n){return ao.has(n)}}else{var Id=iM("state");sM[Id]=!0,Pp=function(n,t){if(ME(n,Id))throw xE(hy);return t.facade=n,nM(n,Id,t),t},fu=function(n){return ME(n,Id)?n[Id]:{}},Lp=function(n){return ME(n,Id)}}var kp={set:Pp,get:fu,has:Lp,enforce:function(n){return Lp(n)?fu(n):Pp(n,{})},getterFor:function(n){return function(t){var e;if(!eM(t)||(e=fu(t)).type!==n)throw xE("Incompatible receiver, "+n+" required");return e}}},oM=_c,aM=Wl,cM=so,dM=Hi,lM=GC,py=Cn([].push),Ca=function(n){var t=n==1,e=n==2,i=n==3,s=n==4,r=n==6,a=n==7,c=n==5||r;return function(l,u,h,f){for(var g,S,w=cM(l),I=aM(w),b=oM(u,h),M=dM(I),F=0,V=f||lM,Z=t?V(l,M):e||a?V(l,0):void 0;M>F;F++)if((c||F in I)&&(S=b(g=I[F],F,w),n))if(t)Z[F]=S;else if(S)switch(n){case 3:return!0;case 5:return g;case 6:return F;case 2:py(Z,g)}else switch(n){case 4:return!1;case 7:py(Z,g)}return r?-1:i||s?s:Z}},uM={forEach:Ca(0),map:Ca(1),filter:Ca(2),some:Ca(3),every:Ca(4),find:Ca(5),findIndex:Ca(6),filterReject:Ca(7)},Mp=C,VE=ti,FE=ei,hM=Cn,bd=fr,Ad=ma,pM=se,Di=Ai,fM=En,BE=Rs,Up=Ss,jE=uc,_M=Wo,GE=eo,_u=Op,fy=zC,mM=Np,_y=ey,EM=Dp,my=lc,Ey=ys,gM=OE,gy=fa,Ty=pu,TM=oy,WE=$i,Sy=Ip,vy=_d,SM=kn,vM=yd,CM=si,yM=cy,RM=Rd,Cy=kp,xp=uM.forEach,Is=Ap("hidden"),Vp="Symbol",mu="prototype",IM=Cy.set,yy=Cy.getterFor(Vp),Mr=Object[mu],Cc=VE.Symbol,Fp=Cc&&Cc[mu],bM=VE.TypeError,HE=VE.QObject,Ry=my.f,yc=Ey.f,Iy=_y.f,AM=gy.f,by=hM([].push),Ho=WE("symbols"),Eu=WE("op-symbols"),wM=WE("wks"),KE=!HE||!HE[mu]||!HE[mu].findChild,qE=bd&&pM(function(){return _u(yc({},"a",{get:function(){return yc(this,"a",{value:7}).a}})).a!=7})?function(n,t,e){var i=Ry(Mr,t);i&&delete Mr[t],yc(n,t,e),i&&n!==Mr&&yc(Mr,t,i)}:yc,YE=function(n,t){var e=Ho[n]=_u(Fp);return IM(e,{type:Vp,tag:n,description:t}),bd||(e.description=t),e},Bp=function(n,t,e){n===Mr&&Bp(Eu,t,e),BE(n);var i=jE(t);return BE(e),Di(Ho,i)?(e.enumerable?(Di(n,Is)&&n[Is][i]&&(n[Is][i]=!1),e=_u(e,{enumerable:GE(0,!1)})):(Di(n,Is)||yc(n,Is,GE(1,{})),n[Is][i]=!0),qE(n,i,e)):yc(n,i,e)},zE=function(n,t){BE(n);var e=Up(t),i=fy(e).concat(Ny(e));return xp(i,function(s){bd&&!FE(Ay,e,s)||Bp(n,s,e[s])}),n},Ay=function(n){var t=jE(n),e=FE(AM,this,t);return!(this===Mr&&Di(Ho,t)&&!Di(Eu,t))&&(!(e||!Di(this,t)||!Di(Ho,t)||Di(this,Is)&&this[Is][t])||e)},wy=function(n,t){var e=Up(n),i=jE(t);if(e!==Mr||!Di(Ho,i)||Di(Eu,i)){var s=Ry(e,i);return!s||!Di(Ho,i)||Di(e,Is)&&e[Is][i]||(s.enumerable=!0),s}},Oy=function(n){var t=Iy(Up(n)),e=[];return xp(t,function(i){Di(Ho,i)||Di(Sy,i)||by(e,i)}),e},Ny=function(n){var t=n===Mr,e=Iy(t?Eu:Up(n)),i=[];return xp(e,function(s){!Di(Ho,s)||t&&!Di(Mr,s)||by(i,Ho[s])}),i};Ad||(Cc=function(){if(fM(Fp,this))throw bM("Symbol is not a constructor");var n=arguments.length&&arguments[0]!==void 0?_M(arguments[0]):void 0,t=vy(n),e=function(i){this===Mr&&FE(e,Eu,i),Di(this,Is)&&Di(this[Is],t)&&(this[Is][t]=!1),qE(this,t,GE(1,i))};return bd&&KE&&qE(Mr,t,{configurable:!0,set:e}),YE(t,n)},Ty(Fp=Cc[mu],"toString",function(){return yy(this).tag}),Ty(Cc,"withoutSetter",function(n){return YE(vy(n),n)}),gy.f=Ay,Ey.f=Bp,gM.f=zE,my.f=wy,mM.f=_y.f=Oy,EM.f=Ny,vM.f=function(n){return YE(SM(n),n)},bd&&TM(Fp,"description",{configurable:!0,get:function(){return yy(this).description}})),Mp({global:!0,constructor:!0,wrap:!0,forced:!Ad,sham:!Ad},{Symbol:Cc}),xp(fy(wM),function(n){CM(n)}),Mp({target:Vp,stat:!0,forced:!Ad},{useSetter:function(){KE=!0},useSimple:function(){KE=!1}}),Mp({target:"Object",stat:!0,forced:!Ad,sham:!bd},{create:function(n,t){return t===void 0?_u(n):zE(_u(n),t)},defineProperty:Bp,defineProperties:zE,getOwnPropertyDescriptor:wy}),Mp({target:"Object",stat:!0,forced:!Ad},{getOwnPropertyNames:Oy}),yM(),RM(Cc,Vp),Sy[Is]=!0;var Dy=ma&&!!Symbol.for&&!!Symbol.keyFor,OM=C,NM=Xi,DM=Ai,PM=Wo,Py=$i,LM=Dy,JE=Py("string-to-symbol-registry"),kM=Py("symbol-to-string-registry");OM({target:"Symbol",stat:!0,forced:!LM},{for:function(n){var t=PM(n);if(DM(JE,t))return JE[t];var e=NM("Symbol")(t);return JE[t]=e,kM[e]=t,e}});var MM=C,UM=Ai,xM=Ea,VM=Vo,FM=Dy,Ly=$i("symbol-to-string-registry");MM({target:"Symbol",stat:!0,forced:!FM},{keyFor:function(n){if(!xM(n))throw TypeError(VM(n)+" is not a symbol");if(UM(Ly,n))return Ly[n]}});var ky=Cn([].slice),My=bE,BM=ii,Uy=$r,jM=Wo,xy=Cn([].push),GM=C,Vy=Xi,Fy=ld,WM=ei,gu=Cn,By=se,jy=ii,Gy=Ea,Wy=ky,HM=function(n){if(BM(n))return n;if(My(n)){for(var t=n.length,e=[],i=0;i<t;i++){var s=n[i];typeof s=="string"?xy(e,s):typeof s!="number"&&Uy(s)!="Number"&&Uy(s)!="String"||xy(e,jM(s))}var r=e.length,a=!0;return function(c,l){if(a)return a=!1,l;if(My(this))return l;for(var u=0;u<r;u++)if(e[u]===c)return l}}},KM=ma,qM=String,ya=Vy("JSON","stringify"),jp=gu(/./.exec),Hy=gu("".charAt),YM=gu("".charCodeAt),zM=gu("".replace),JM=gu(1 .toString),XM=/[\uD800-\uDFFF]/g,Ky=/^[\uD800-\uDBFF]$/,qy=/^[\uDC00-\uDFFF]$/,Yy=!KM||By(function(){var n=Vy("Symbol")();return ya([n])!="[null]"||ya({a:n})!="{}"||ya(Object(n))!="{}"}),zy=By(function(){return ya("\uDF06\uD834")!=='"\\udf06\\ud834"'||ya("\uDEAD")!=='"\\udead"'}),$M=function(n,t){var e=Wy(arguments),i=HM(t);if(jy(i)||n!==void 0&&!Gy(n))return e[1]=function(s,r){if(jy(i)&&(r=WM(i,this,qM(s),r)),!Gy(r))return r},Fy(ya,null,e)},QM=function(n,t,e){var i=Hy(e,t-1),s=Hy(e,t+1);return jp(Ky,n)&&!jp(qy,s)||jp(qy,n)&&!jp(Ky,i)?"\\u"+JM(YM(n,0),16):n};ya&&GM({target:"JSON",stat:!0,arity:3,forced:Yy||zy},{stringify:function(n,t,e){var i=Wy(arguments),s=Fy(Yy?$M:ya,null,i);return zy&&typeof s=="string"?zM(s,XM,QM):s}});var Jy=Dp,ZM=so;C({target:"Object",stat:!0,forced:!ma||se(function(){Jy.f(1)})},{getOwnPropertySymbols:function(n){var t=Jy.f;return t?t(ZM(n)):[]}}),si("asyncIterator"),si("hasInstance"),si("isConcatSpreadable"),si("iterator"),si("match"),si("matchAll"),si("replace"),si("search"),si("species"),si("split");var tU=cy;si("toPrimitive"),tU();var eU=Xi,nU=Rd;si("toStringTag"),nU(eU("Symbol"),"Symbol"),si("unscopables"),Rd(ti.JSON,"JSON",!0);var Rc,Xy,$y,iU=Mo.Symbol,wd={},XE=fr,sU=Ai,Qy=Function.prototype,rU=XE&&Object.getOwnPropertyDescriptor,$E=sU(Qy,"name"),Zy={EXISTS:$E,PROPER:$E&&(function(){}).name==="something",CONFIGURABLE:$E&&(!XE||XE&&rU(Qy,"name").configurable)},oU=!se(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}),aU=Ai,cU=ii,dU=so,lU=oU,tR=Ap("IE_PROTO"),QE=Object,uU=QE.prototype,ZE=lU?QE.getPrototypeOf:function(n){var t=dU(n);if(aU(t,tR))return t[tR];var e=t.constructor;return cU(e)&&t instanceof e?e.prototype:t instanceof QE?uU:null},hU=se,pU=ii,fU=Gi,_U=Op,eR=ZE,mU=pu,tg=kn("iterator"),nR=!1;[].keys&&("next"in($y=[].keys())?(Xy=eR(eR($y)))!==Object.prototype&&(Rc=Xy):nR=!0);var EU=!fU(Rc)||hU(function(){var n={};return Rc[tg].call(n)!==n});pU((Rc=EU?{}:_U(Rc))[tg])||mU(Rc,tg,function(){return this});var iR={IteratorPrototype:Rc,BUGGY_SAFARI_ITERATORS:nR},gU=iR.IteratorPrototype,TU=Op,SU=eo,vU=Rd,CU=wd,yU=function(){return this},RU=Cn,IU=Cs,bU=ii,AU=String,wU=TypeError,OU=function(n,t,e){try{return RU(IU(Object.getOwnPropertyDescriptor(n,t)[e]))}catch{}},NU=Rs,DU=function(n){if(typeof n=="object"||bU(n))return n;throw wU("Can't set "+AU(n)+" as a prototype")},PU=Object.setPrototypeOf||("__proto__"in{}?function(){var n,t=!1,e={};try{(n=OU(Object.prototype,"__proto__","set"))(e,[]),t=e instanceof Array}catch{}return function(i,s){return NU(i),DU(s),t?n(i,s):i.__proto__=s,i}}():void 0),LU=C,kU=ei,MU=Zy,UU=function(n,t,e,i){var s=t+" Iterator";return n.prototype=TU(gU,{next:SU(+!i,e)}),vU(n,s,!1,!0),CU[s]=yU,n},xU=ZE,VU=Rd,sR=pu,rR=wd,FU=iR,BU=MU.PROPER,Gp=FU.BUGGY_SAFARI_ITERATORS,eg=kn("iterator"),oR="keys",Wp="values",aR="entries",jU=function(){return this},cR=function(n,t,e,i,s,r,a){UU(e,t,i);var c,l,u,h=function(M){if(M===s&&I)return I;if(!Gp&&M in S)return S[M];switch(M){case oR:case Wp:case aR:return function(){return new e(this,M)}}return function(){return new e(this)}},f=t+" Iterator",g=!1,S=n.prototype,w=S[eg]||S["@@iterator"]||s&&S[s],I=!Gp&&w||h(s),b=t=="Array"&&S.entries||w;if(b&&(c=xU(b.call(new n)))!==Object.prototype&&c.next&&(VU(c,f,!0,!0),rR[f]=jU),BU&&s==Wp&&w&&w.name!==Wp&&(g=!0,I=function(){return kU(w,this)}),s)if(l={values:h(Wp),keys:r?I:h(oR),entries:h(aR)},a)for(u in l)(Gp||g||!(u in S))&&sR(S,u,l[u]);else LU({target:t,proto:!0,forced:Gp||g},l);return a&&S[eg]!==I&&sR(S,eg,I,{name:s}),rR[t]=I,l},dR=function(n,t){return{value:n,done:t}},GU=Ss,lR=wd,uR=kp;ys.f;var WU=cR,hR=dR,pR="Array Iterator",HU=uR.set,KU=uR.getterFor(pR);WU(Array,"Array",function(n,t){HU(this,{type:pR,target:GU(n),index:0,kind:t})},function(){var n=KU(this),t=n.target,e=n.kind,i=n.index++;return!t||i>=t.length?(n.target=void 0,hR(void 0,!0)):hR(e=="keys"?i:e=="values"?t[i]:[i,t[i]],!1)},"values"),lR.Arguments=lR.Array;var qU={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},YU=ti,zU=vc,JU=oo,fR=wd,_R=kn("toStringTag");for(var ng in qU){var mR=YU[ng],ig=mR&&mR.prototype;ig&&zU(ig)!==_R&&JU(ig,_R,ng),fR[ng]=fR.Array}var XU=iU,$U=kn,QU=ys.f,ER=$U("metadata"),gR=Function.prototype;gR[ER]===void 0&&QU(gR,ER,{value:null}),si("dispose"),si("metadata");var ZU=XU;si("asyncDispose");var tx=Cn,sg=Xi("Symbol"),ex=sg.keyFor,nx=tx(sg.prototype.valueOf),TR=sg.isRegisteredSymbol||function(n){try{return ex(nx(n))!==void 0}catch{return!1}};C({target:"Symbol",stat:!0},{isRegisteredSymbol:TR});for(var ix=$i,SR=Xi,sx=Cn,rx=Ea,ox=kn,Hp=SR("Symbol"),vR=Hp.isWellKnownSymbol,CR=SR("Object","getOwnPropertyNames"),ax=sx(Hp.prototype.valueOf),yR=ix("wks"),rg=0,RR=CR(Hp),cx=RR.length;rg<cx;rg++)try{var IR=RR[rg];rx(Hp[IR])&&ox(IR)}catch{}var bR=function(n){if(vR&&vR(n))return!0;try{for(var t=ax(n),e=0,i=CR(yR),s=i.length;e<s;e++)if(yR[i[e]]==t)return!0}catch{}return!1};C({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:bR}),si("matcher"),si("observable"),C({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:TR}),C({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:bR}),si("metadataKey"),si("patternMatch"),si("replaceAll");var Od=st(ZU),og=Cn,dx=Bt,lx=Wo,ux=_a,hx=og("".charAt),AR=og("".charCodeAt),px=og("".slice),wR=function(n){return function(t,e){var i,s,r=lx(ux(t)),a=dx(e),c=r.length;return a<0||a>=c?n?"":void 0:(i=AR(r,a))<55296||i>56319||a+1===c||(s=AR(r,a+1))<56320||s>57343?n?hx(r,a):i:n?px(r,a,a+2):s-56320+(i-55296<<10)+65536}},fx={codeAt:wR(!1),charAt:wR(!0)}.charAt,_x=Wo,OR=kp,mx=cR,NR=dR,DR="String Iterator",Ex=OR.set,gx=OR.getterFor(DR);mx(String,"String",function(n){Ex(this,{type:DR,string:_x(n),index:0})},function(){var n,t=gx(this),e=t.string,i=t.index;return i>=e.length?NR(void 0,!0):(n=fx(e,i),t.index+=n.length,NR(n,!1))});var PR=st(yd.f("iterator"));function Tu(n){return Tu=typeof Od=="function"&&typeof PR=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Od=="function"&&t.constructor===Od&&t!==Od.prototype?"symbol":typeof t},Tu(n)}var Tx=st(yd.f("toPrimitive"));function Sx(n){var t=function(e,i){if(Tu(e)!=="object"||e===null)return e;var s=e[Tx];if(s!==void 0){var r=s.call(e,i||"default");if(Tu(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}(n,"string");return Tu(t)==="symbol"?t:String(t)}function m(n,t,e){return(t=Sx(t))in n?Dk(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var vx=Sc("Array").keys,Cx=vc,yx=Ai,Rx=En,Ix=vx,ag=Array.prototype,bx={DOMTokenList:!0,NodeList:!0},bs=st(function(n){var t=n.keys;return n===ag||Rx(ag,n)&&t===ag.keys||yx(bx,Cx(n))?Ix:t}),LR=Vo,Ax=TypeError,kR=iy,wx=Math.floor,cg=function(n,t){var e=n.length,i=wx(e/2);return e<8?Ox(n,t):Nx(n,cg(kR(n,0,i),t),cg(kR(n,i),t),t)},Ox=function(n,t){for(var e,i,s=n.length,r=1;r<s;){for(i=r,e=n[r];i&&t(n[i-1],e)>0;)n[i]=n[--i];i!==r++&&(n[i]=e)}return n},Nx=function(n,t,e,i){for(var s=t.length,r=e.length,a=0,c=0;a<s||c<r;)n[a+c]=a<s&&c<r?i(t[a],e[c])<=0?t[a++]:e[c++]:a<s?t[a++]:e[c++];return n},Dx=cg,Px=se,MR=function(n,t){var e=[][n];return!!e&&Px(function(){e.call(null,t||function(){return 1},1)})},UR=Uo.match(/firefox\/(\d+)/i),Lx=!!UR&&+UR[1],kx=/MSIE|Trident/.test(Uo),xR=Uo.match(/AppleWebKit\/(\d+)\./),Mx=!!xR&&+xR[1],Ux=C,VR=Cn,xx=Cs,Vx=so,FR=Hi,Fx=function(n,t){if(!delete n[t])throw Ax("Cannot delete property "+LR(t)+" of "+LR(n))},BR=Wo,dg=se,Bx=Dx,jx=MR,jR=Lx,Gx=kx,GR=xo,WR=Mx,Ra=[],HR=VR(Ra.sort),Wx=VR(Ra.push),Hx=dg(function(){Ra.sort(void 0)}),Kx=dg(function(){Ra.sort(null)}),qx=jx("sort"),KR=!dg(function(){if(GR)return GR<70;if(!(jR&&jR>3)){if(Gx)return!0;if(WR)return WR<603;var n,t,e,i,s="";for(n=65;n<76;n++){switch(t=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:e=3;break;case 68:case 71:e=4;break;default:e=2}for(i=0;i<47;i++)Ra.push({k:t+i,v:e})}for(Ra.sort(function(r,a){return a.v-r.v}),i=0;i<Ra.length;i++)t=Ra[i].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}});Ux({target:"Array",proto:!0,forced:Hx||!Kx||!qx||!KR},{sort:function(n){n!==void 0&&xx(n);var t=Vx(this);if(KR)return n===void 0?HR(t):HR(t,n);var e,i,s=[],r=FR(t);for(i=0;i<r;i++)i in t&&Wx(s,t[i]);for(Bx(s,function(a){return function(c,l){return l===void 0?-1:c===void 0?1:a!==void 0?+a(c,l)||0:BR(c)>BR(l)?1:-1}}(n)),e=FR(s),i=0;i<e;)t[i]=s[i++];for(;i<r;)Fx(t,i++);return t}});var Yx=Sc("Array").sort,zx=En,Jx=Yx,lg=Array.prototype,Su=st(function(n){var t=n.sort;return n===lg||zx(lg,n)&&t===lg.sort?Jx:t}),Xx=Xi,$x=Np,Qx=Dp,Zx=Rs,t2=Cn([].concat),e2=Xx("Reflect","ownKeys")||function(n){var t=$x.f(Zx(n)),e=Qx.f;return e?t2(t,e(n)):t},qR=Ai,n2=e2,i2=lc,s2=ys,r2=Gi,o2=oo,YR=Error,a2=Cn("".replace),c2=String(YR("zxcasd").stack),zR=/\n\s*at [^:]*:[^\n]*/,d2=zR.test(c2),l2=eo,u2=!se(function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",l2(1,7)),n.stack!==7)}),h2=oo,p2=function(n,t){if(d2&&typeof n=="string"&&!YR.prepareStackTrace)for(;t--;)n=a2(n,zR,"");return n},f2=u2,JR=Error.captureStackTrace,_2=wd,m2=kn("iterator"),E2=Array.prototype,g2=vc,XR=Ql,T2=hd,S2=wd,v2=kn("iterator"),$R=function(n){if(!T2(n))return XR(n,v2)||XR(n,"@@iterator")||S2[g2(n)]},C2=ei,y2=Cs,R2=Rs,I2=Vo,b2=$R,A2=TypeError,w2=ei,QR=Rs,O2=Ql,N2=_c,D2=ei,P2=Rs,L2=Vo,k2=function(n){return n!==void 0&&(_2.Array===n||E2[m2]===n)},M2=Hi,ZR=En,U2=function(n,t){var e=arguments.length<2?b2(n):t;if(y2(e))return R2(C2(e,n));throw A2(I2(n)+" is not iterable")},x2=$R,tI=function(n,t,e){var i,s;QR(n);try{if(!(i=O2(n,"return"))){if(t==="throw")throw e;return e}i=w2(i,n)}catch(r){s=!0,i=r}if(t==="throw")throw e;if(s)throw i;return QR(i),e},V2=TypeError,Kp=function(n,t){this.stopped=n,this.result=t},eI=Kp.prototype,vu=function(n,t,e){var i,s,r,a,c,l,u,h=e&&e.that,f=!(!e||!e.AS_ENTRIES),g=!(!e||!e.IS_RECORD),S=!(!e||!e.IS_ITERATOR),w=!(!e||!e.INTERRUPTED),I=N2(t,h),b=function(F){return i&&tI(i,"normal",F),new Kp(!0,F)},M=function(F){return f?(P2(F),w?I(F[0],F[1],b):I(F[0],F[1])):w?I(F,b):I(F)};if(g)i=n.iterator;else if(S)i=n;else{if(!(s=x2(n)))throw V2(L2(n)+" is not iterable");if(k2(s)){for(r=0,a=M2(n);a>r;r++)if((c=M(n[r]))&&ZR(eI,c))return c;return new Kp(!1)}i=U2(n,s)}for(l=g?n.next:i.next;!(u=D2(l,i)).done;){try{c=M(u.value)}catch(F){tI(i,"throw",F)}if(typeof c=="object"&&c&&ZR(eI,c))return c}return new Kp(!1)},F2=Wo,B2=C,j2=En,G2=ZE,qp=PU,W2=function(n,t,e){for(var i=n2(t),s=s2.f,r=i2.f,a=0;a<i.length;a++){var c=i[a];qR(n,c)||e&&qR(e,c)||s(n,c,r(t,c))}},nI=Op,ug=oo,hg=eo,H2=function(n,t){r2(t)&&"cause"in t&&o2(n,"cause",t.cause)},K2=function(n,t,e,i){f2&&(JR?JR(n,t):h2(n,"stack",p2(e,i)))},q2=vu,Y2=function(n,t){return n===void 0?arguments.length<2?"":t:F2(n)},z2=kn("toStringTag"),Yp=Error,J2=[].push,Nd=function(n,t){var e,i=j2(pg,this);qp?e=qp(Yp(),i?G2(this):pg):(e=i?this:nI(pg),ug(e,z2,"Error")),t!==void 0&&ug(e,"message",Y2(t)),K2(e,Nd,e.stack,1),arguments.length>2&&H2(e,arguments[2]);var s=[];return q2(n,J2,{that:s}),ug(e,"errors",s),e};qp?qp(Nd,Yp):W2(Nd,Yp,{name:!0});var pg=Nd.prototype=nI(Yp.prototype,{constructor:hg(1,Nd),message:hg(1,""),name:hg(1,"AggregateError")});B2({global:!0,constructor:!0,arity:2},{AggregateError:Nd});var Cu,Dd,iI,fg,yu=typeof process<"u"&&$r(process)=="process",X2=Xi,$2=oy,Q2=fr,sI=kn("species"),Z2=En,tV=TypeError,eV=FC,nV=Vo,iV=TypeError,rI=Rs,sV=function(n){if(eV(n))return n;throw iV(nV(n)+" is not a constructor")},rV=hd,oV=kn("species"),oI=function(n,t){var e,i=rI(n).constructor;return i===void 0||rV(e=rI(i)[oV])?t:sV(e)},aV=TypeError,aI=/(?:ipad|iphone|ipod).*applewebkit/i.test(Uo),qs=ti,cV=ld,dV=_c,cI=ii,lV=Ai,dI=se,lI=JC,uV=ky,uI=ou,hV=function(n,t){if(n<t)throw aV("Not enough arguments");return n},pV=aI,fV=yu,_g=qs.setImmediate,mg=qs.clearImmediate,_V=qs.process,Eg=qs.Dispatch,mV=qs.Function,hI=qs.MessageChannel,EV=qs.String,gg=0,Ru={},pI="onreadystatechange";dI(function(){Cu=qs.location});var Tg=function(n){if(lV(Ru,n)){var t=Ru[n];delete Ru[n],t()}},Sg=function(n){return function(){Tg(n)}},fI=function(n){Tg(n.data)},_I=function(n){qs.postMessage(EV(n),Cu.protocol+"//"+Cu.host)};_g&&mg||(_g=function(n){hV(arguments.length,1);var t=cI(n)?n:mV(n),e=uV(arguments,1);return Ru[++gg]=function(){cV(t,void 0,e)},Dd(gg),gg},mg=function(n){delete Ru[n]},fV?Dd=function(n){_V.nextTick(Sg(n))}:Eg&&Eg.now?Dd=function(n){Eg.now(Sg(n))}:hI&&!pV?(fg=(iI=new hI).port2,iI.port1.onmessage=fI,Dd=dV(fg.postMessage,fg)):qs.addEventListener&&cI(qs.postMessage)&&!qs.importScripts&&Cu&&Cu.protocol!=="file:"&&!dI(_I)?(Dd=_I,qs.addEventListener("message",fI,!1)):Dd=pI in uI("script")?function(n){lI.appendChild(uI("script"))[pI]=function(){lI.removeChild(this),Tg(n)}}:function(n){setTimeout(Sg(n),0)});var mI={set:_g,clear:mg},EI=function(){this.head=null,this.tail=null};EI.prototype={add:function(n){var t={item:n,next:null},e=this.tail;e?e.next=t:this.head=t,this.tail=t},get:function(){var n=this.head;if(n)return(this.head=n.next)===null&&(this.tail=null),n.item}};var Pd,vg,Cg,yg,gI,TI=EI,gV=/ipad|iphone|ipod/i.test(Uo)&&typeof Pebble<"u",TV=/web0s(?!.*chrome)/i.test(Uo),Ic=ti,SI=_c,SV=lc.f,Rg=mI.set,vV=TI,CV=aI,yV=gV,RV=TV,Ig=yu,vI=Ic.MutationObserver||Ic.WebKitMutationObserver,CI=Ic.document,yI=Ic.process,zp=Ic.Promise,RI=SV(Ic,"queueMicrotask"),bg=RI&&RI.value;if(!bg){var Jp=new vV,Xp=function(){var n,t;for(Ig&&(n=yI.domain)&&n.exit();t=Jp.get();)try{t()}catch(e){throw Jp.head&&Pd(),e}n&&n.enter()};CV||Ig||RV||!vI||!CI?!yV&&zp&&zp.resolve?((yg=zp.resolve(void 0)).constructor=zp,gI=SI(yg.then,yg),Pd=function(){gI(Xp)}):Ig?Pd=function(){yI.nextTick(Xp)}:(Rg=SI(Rg,Ic),Pd=function(){Rg(Xp)}):(vg=!0,Cg=CI.createTextNode(""),new vI(Xp).observe(Cg,{characterData:!0}),Pd=function(){Cg.data=vg=!vg}),bg=function(n){Jp.head||Pd(),Jp.add(n)}}var IV=bg,Ld=function(n){try{return{error:!1,value:n()}}catch(t){return{error:!0,value:t}}},bc=ti.Promise,II=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",bV=!II&&!yu&&typeof window=="object"&&typeof document=="object",AV=ti,Iu=bc,wV=ii,OV=gp,NV=kC,DV=kn,PV=bV,LV=II,Ag=xo,bI=Iu&&Iu.prototype,kV=DV("species"),AI=!1,wI=wV(AV.PromiseRejectionEvent),MV=OV("Promise",function(){var n=NV(Iu),t=n!==String(Iu);if(!t&&Ag===66||!bI.catch||!bI.finally)return!0;if(!Ag||Ag<51||!/native code/.test(n)){var e=new Iu(function(s){s(1)}),i=function(s){s(function(){},function(){})};if((e.constructor={})[kV]=i,!(AI=e.then(function(){})instanceof i))return!0}return!t&&(PV||LV)&&!wI}),bu={CONSTRUCTOR:MV,REJECTION_EVENT:wI,SUBCLASSING:AI},co={},OI=Cs,UV=TypeError,xV=function(n){var t,e;this.promise=new n(function(i,s){if(t!==void 0||e!==void 0)throw UV("Bad Promise constructor");t=i,e=s}),this.resolve=OI(t),this.reject=OI(e)};co.f=function(n){return new xV(n)};var wg,NI,VV=C,$p=yu,Ia=ti,Au=ei,FV=pu,BV=Rd,jV=function(n){var t=X2(n);Q2&&t&&!t[sI]&&$2(t,sI,{configurable:!0,get:function(){return this}})},GV=Cs,Og=ii,WV=Gi,HV=function(n,t){if(Z2(t,n))return n;throw tV("Incorrect invocation")},KV=oI,DI=mI.set,Ng=IV,qV=function(n,t){try{arguments.length==1?console.error(n):console.error(n,t)}catch{}},YV=Ld,zV=TI,PI=kp,Dg=bc,LI=bu,kI=co,Qp="Promise",MI=LI.CONSTRUCTOR,JV=LI.REJECTION_EVENT,Pg=PI.getterFor(Qp),XV=PI.set,$V=Dg&&Dg.prototype,wu=Dg,Lg=$V,UI=Ia.TypeError,kg=Ia.document,Mg=Ia.process,Ug=kI.f,QV=Ug,ZV=!!(kg&&kg.createEvent&&Ia.dispatchEvent),xI="unhandledrejection",VI=function(n){var t;return!(!WV(n)||!Og(t=n.then))&&t},FI=function(n,t){var e,i,s,r=t.value,a=t.state==1,c=a?n.ok:n.fail,l=n.resolve,u=n.reject,h=n.domain;try{c?(a||(t.rejection===2&&eF(t),t.rejection=1),c===!0?e=r:(h&&h.enter(),e=c(r),h&&(h.exit(),s=!0)),e===n.promise?u(UI("Promise-chain cycle")):(i=VI(e))?Au(i,e,l,u):l(e)):u(r)}catch(f){h&&!s&&h.exit(),u(f)}},BI=function(n,t){n.notified||(n.notified=!0,Ng(function(){for(var e,i=n.reactions;e=i.get();)FI(e,n);n.notified=!1,t&&!n.rejection&&tF(n)}))},jI=function(n,t,e){var i,s;ZV?((i=kg.createEvent("Event")).promise=t,i.reason=e,i.initEvent(n,!1,!0),Ia.dispatchEvent(i)):i={promise:t,reason:e},!JV&&(s=Ia["on"+n])?s(i):n===xI&&qV("Unhandled promise rejection",e)},tF=function(n){Au(DI,Ia,function(){var t,e=n.facade,i=n.value;if(GI(n)&&(t=YV(function(){$p?Mg.emit("unhandledRejection",i,e):jI(xI,e,i)}),n.rejection=$p||GI(n)?2:1,t.error))throw t.value})},GI=function(n){return n.rejection!==1&&!n.parent},eF=function(n){Au(DI,Ia,function(){var t=n.facade;$p?Mg.emit("rejectionHandled",t):jI("rejectionhandled",t,n.value)})},kd=function(n,t,e){return function(i){n(t,i,e)}},Md=function(n,t,e){n.done||(n.done=!0,e&&(n=e),n.value=t,n.state=2,BI(n,!0))},xg=function(n,t,e){if(!n.done){n.done=!0,e&&(n=e);try{if(n.facade===t)throw UI("Promise can't be resolved itself");var i=VI(t);i?Ng(function(){var s={done:!1};try{Au(i,t,kd(xg,s,n),kd(Md,s,n))}catch(r){Md(s,r,n)}}):(n.value=t,n.state=1,BI(n,!1))}catch(s){Md({done:!1},s,n)}}};MI&&(Lg=(wu=function(n){HV(this,Lg),GV(n),Au(wg,this);var t=Pg(this);try{n(kd(xg,t),kd(Md,t))}catch(e){Md(t,e)}}).prototype,(wg=function(n){XV(this,{type:Qp,done:!1,notified:!1,parent:!1,reactions:new zV,rejection:!1,state:0,value:void 0})}).prototype=FV(Lg,"then",function(n,t){var e=Pg(this),i=Ug(KV(this,wu));return e.parent=!0,i.ok=!Og(n)||n,i.fail=Og(t)&&t,i.domain=$p?Mg.domain:void 0,e.state==0?e.reactions.add(i):Ng(function(){FI(i,e)}),i.promise}),NI=function(){var n=new wg,t=Pg(n);this.promise=n,this.resolve=kd(xg,t),this.reject=kd(Md,t)},kI.f=Ug=function(n){return n===wu||n===void 0?new NI(n):QV(n)}),VV({global:!0,constructor:!0,wrap:!0,forced:MI},{Promise:wu}),BV(wu,Qp,!1,!0),jV(Qp);var WI=kn("iterator"),HI=!1;try{var nF=0,KI={next:function(){return{done:!!nF++}},return:function(){HI=!0}};KI[WI]=function(){return this},Array.from(KI,function(){throw 2})}catch{}var iF=bc,sF=function(n,t){if(!t&&!HI)return!1;var e=!1;try{var i={};i[WI]=function(){return{next:function(){return{done:e=!0}}}},n(i)}catch{}return e},Zp=bu.CONSTRUCTOR||!sF(function(n){iF.all(n).then(void 0,function(){})}),rF=ei,oF=Cs,aF=co,cF=Ld,dF=vu;C({target:"Promise",stat:!0,forced:Zp},{all:function(n){var t=this,e=aF.f(t),i=e.resolve,s=e.reject,r=cF(function(){var a=oF(t.resolve),c=[],l=0,u=1;dF(n,function(h){var f=l++,g=!1;u++,rF(a,t,h).then(function(S){g||(g=!0,c[f]=S,--u||i(c))},s)}),--u||i(c)});return r.error&&s(r.value),e.promise}});var lF=C,uF=bu.CONSTRUCTOR;bc&&bc.prototype,lF({target:"Promise",proto:!0,forced:uF,real:!0},{catch:function(n){return this.then(void 0,n)}});var hF=ei,pF=Cs,fF=co,_F=Ld,mF=vu;C({target:"Promise",stat:!0,forced:Zp},{race:function(n){var t=this,e=fF.f(t),i=e.reject,s=_F(function(){var r=pF(t.resolve);mF(n,function(a){hF(r,t,a).then(e.resolve,i)})});return s.error&&i(s.value),e.promise}});var EF=ei,gF=co;C({target:"Promise",stat:!0,forced:bu.CONSTRUCTOR},{reject:function(n){var t=gF.f(this);return EF(t.reject,void 0,n),t.promise}});var TF=Rs,SF=Gi,vF=co,qI=function(n,t){if(TF(n),SF(t)&&t.constructor===n)return t;var e=vF.f(n);return(0,e.resolve)(t),e.promise},CF=C,yF=bc,RF=bu.CONSTRUCTOR,IF=qI,bF=Xi("Promise"),AF=!RF;CF({target:"Promise",stat:!0,forced:!0},{resolve:function(n){return IF(AF&&this===bF?yF:this,n)}});var wF=ei,OF=Cs,NF=co,DF=Ld,PF=vu;C({target:"Promise",stat:!0,forced:Zp},{allSettled:function(n){var t=this,e=NF.f(t),i=e.resolve,s=e.reject,r=DF(function(){var a=OF(t.resolve),c=[],l=0,u=1;PF(n,function(h){var f=l++,g=!1;u++,wF(a,t,h).then(function(S){g||(g=!0,c[f]={status:"fulfilled",value:S},--u||i(c))},function(S){g||(g=!0,c[f]={status:"rejected",reason:S},--u||i(c))})}),--u||i(c)});return r.error&&s(r.value),e.promise}});var LF=ei,kF=Cs,MF=Xi,UF=co,xF=Ld,VF=vu,YI="No one promise resolved";C({target:"Promise",stat:!0,forced:Zp},{any:function(n){var t=this,e=MF("AggregateError"),i=UF.f(t),s=i.resolve,r=i.reject,a=xF(function(){var c=kF(t.resolve),l=[],u=0,h=1,f=!1;VF(n,function(g){var S=u++,w=!1;h++,LF(c,t,g).then(function(I){w||f||(f=!0,s(I))},function(I){w||f||(w=!0,l[S]=I,--h||r(new e(l,YI)))})}),--h||r(new e(l,YI))});return a.error&&r(a.value),i.promise}});var FF=C,Vg=bc,BF=se,jF=Xi,GF=ii,WF=oI,zI=qI,HF=Vg&&Vg.prototype;FF({target:"Promise",proto:!0,real:!0,forced:!!Vg&&BF(function(){HF.finally.call({then:function(){}},function(){})})},{finally:function(n){var t=WF(this,jF("Promise")),e=GF(n);return this.then(e?function(i){return zI(t,n()).then(function(){return i})}:n,e?function(i){return zI(t,n()).then(function(){throw i})}:n)}});var JI=Mo.Promise,K=st(JI);const KF=()=>{};function Ou(){const n={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:KF};return n.promise=new K((t,e)=>{n.resolve=i=>{n.isFinished||(n.isResolved=!0,n.isFinished=!0,t(i),n.value=i)},n.reject=i=>{n.isFinished||(n.isRejected=!0,n.isFinished=!0,e(i))}}),n}const tf=new Map,ef=new Map,lo=new Map;var Kn,De;(function(n){n.WIN_10="Windows 10",n.WIN_81="Windows 8.1",n.WIN_8="Windows 8",n.WIN_7="Windows 7",n.WIN_VISTA="Windows Vista",n.WIN_SERVER_2003="Windows Server 2003",n.WIN_XP="Windows XP",n.WIN_2000="Windows 2000",n.ANDROID="Android",n.HARMONY_OS="HarmonyOS",n.OPEN_BSD="Open BSD",n.SUN_OS="Sun OS",n.LINUX="Linux",n.IOS="iOS",n.MAC_OS="Mac OS",n.QNX="QNX",n.UNIX="UNIX",n.BEOS="BeOS",n.OS_2="OS/2",n.SEARCH_BOT="Search Bot"})(Kn||(Kn={})),function(n){n.CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger"}(De||(De={}));var Fg={exports:{}};(function(n,t){(function(e,i){var s="function",r="undefined",a="object",c="string",l="major",u="model",h="name",f="type",g="vendor",S="version",w="architecture",I="console",b="mobile",M="tablet",F="smarttv",V="wearable",Z="embedded",$="Amazon",W="Apple",q="ASUS",et="BlackBerry",_t="Browser",lt="Chrome",Xt="Firefox",pe="Google",ve="Huawei",Ue="LG",de="Microsoft",Nn="Motorola",nt="Opera",ct="Samsung",Ct="Sharp",Yt="Sony",Ie="Xiaomi",ut="Zebra",y="Facebook",L="Chromium OS",B="Mac OS",ot=function(fn){for(var Dn={},Qe=0;Qe<fn.length;Qe++)Dn[fn[Qe].toUpperCase()]=fn[Qe];return Dn},Qt=function(fn,Dn){return typeof fn===c&&Je(Dn).indexOf(Je(fn))!==-1},Je=function(fn){return fn.toLowerCase()},hi=function(fn,Dn){if(typeof fn===c)return fn=fn.replace(/^\s\s*/,""),typeof Dn===r?fn:fn.substring(0,350)},_s=function(fn,Dn){for(var Qe,ms,Ro,_n,be,rs,Xa=0;Xa<Dn.length&&!be;){var Br=Dn[Xa],$0=Dn[Xa+1];for(Qe=ms=0;Qe<Br.length&&!be&&Br[Qe];)if(be=Br[Qe++].exec(fn))for(Ro=0;Ro<$0.length;Ro++)rs=be[++ms],typeof(_n=$0[Ro])===a&&_n.length>0?_n.length===2?typeof _n[1]==s?this[_n[0]]=_n[1].call(this,rs):this[_n[0]]=_n[1]:_n.length===3?typeof _n[1]!==s||_n[1].exec&&_n[1].test?this[_n[0]]=rs?rs.replace(_n[1],_n[2]):i:this[_n[0]]=rs?_n[1].call(this,rs,_n[2]):i:_n.length===4&&(this[_n[0]]=rs?_n[3].call(this,rs.replace(_n[1],_n[2])):i):this[_n]=rs||i;Xa+=2}},ia=function(fn,Dn){for(var Qe in Dn)if(typeof Dn[Qe]===a&&Dn[Qe].length>0){for(var ms=0;ms<Dn[Qe].length;ms++)if(Qt(Dn[Qe][ms],fn))return Qe==="?"?i:Qe}else if(Qt(Dn[Qe],fn))return Qe==="?"?i:Qe;return fn},T_={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},S_={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,S],[/opios[\/ ]+([\w\.]+)/i],[S,[h,nt+" Mini"]],[/\bopr\/([\w\.]+)/i],[S,[h,nt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[h,S],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[h,"UC"+_t]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[S,[h,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[S,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[h,"IE"]],[/yabrowser\/([\w\.]+)/i],[S,[h,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+_t],S],[/\bfocus\/([\w\.]+)/i],[S,[h,Xt+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[h,nt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[h,nt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[h,"MIUI "+_t]],[/fxios\/([-\w\.]+)/i],[S,[h,Xt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+_t]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+_t],S],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[h,S],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,y],S],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[h,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[h,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[h,lt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,lt+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[h,"Android "+_t]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[S,ia,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[h,Xt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,S],[/(cobalt)\/([\w\.]+)/i],[h,[S,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[w,"amd64"]],[/(ia32(?=;))/i],[[w,Je]],[/((?:i[346]|x)86)[;\)]/i],[[w,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[w,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[w,"armhf"]],[/windows (ce|mobile); ppc;/i],[[w,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[w,/ower/,"",Je]],[/(sun4\w)[;\)]/i],[[w,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[w,Je]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[g,ct],[f,M]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[g,ct],[f,b]],[/\((ip(?:hone|od)[\w ]*);/i],[u,[g,W],[f,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[g,W],[f,M]],[/(macintosh);/i],[u,[g,W]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[g,Ct],[f,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[g,ve],[f,M]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[g,ve],[f,b]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[g,Ie],[f,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[g,Ie],[f,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[g,"OPPO"],[f,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[g,"Vivo"],[f,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[g,"Realme"],[f,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[g,Nn],[f,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[g,Nn],[f,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[g,Ue],[f,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[g,Ue],[f,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[g,"Lenovo"],[f,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[g,"Nokia"],[f,b]],[/(pixel c)\b/i],[u,[g,pe],[f,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[g,pe],[f,b]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[g,Yt],[f,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[g,Yt],[f,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[g,"OnePlus"],[f,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[g,$],[f,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[g,$],[f,b]],[/(playbook);[-\w\),; ]+(rim)/i],[u,g,[f,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[g,et],[f,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[g,q],[f,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[g,q],[f,b]],[/(nexus 9)/i],[u,[g,"HTC"],[f,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[u,/_/g," "],[f,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[g,"Acer"],[f,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[g,"Meizu"],[f,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,u,[f,b]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,u,[f,M]],[/(surface duo)/i],[u,[g,de],[f,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[g,"Fairphone"],[f,b]],[/(u304aa)/i],[u,[g,"AT&T"],[f,b]],[/\bsie-(\w*)/i],[u,[g,"Siemens"],[f,b]],[/\b(rct\w+) b/i],[u,[g,"RCA"],[f,M]],[/\b(venue[\d ]{2,7}) b/i],[u,[g,"Dell"],[f,M]],[/\b(q(?:mv|ta)\w+) b/i],[u,[g,"Verizon"],[f,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[g,"Barnes & Noble"],[f,M]],[/\b(tm\d{3}\w+) b/i],[u,[g,"NuVision"],[f,M]],[/\b(k88) b/i],[u,[g,"ZTE"],[f,M]],[/\b(nx\d{3}j) b/i],[u,[g,"ZTE"],[f,b]],[/\b(gen\d{3}) b.+49h/i],[u,[g,"Swiss"],[f,b]],[/\b(zur\d{3}) b/i],[u,[g,"Swiss"],[f,M]],[/\b((zeki)?tb.*\b) b/i],[u,[g,"Zeki"],[f,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],u,[f,M]],[/\b(ns-?\w{0,9}) b/i],[u,[g,"Insignia"],[f,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[g,"NextBook"],[f,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],u,[f,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],u,[f,b]],[/\b(ph-1) /i],[u,[g,"Essential"],[f,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[g,"Envizen"],[f,M]],[/\b(trio[-\w\. ]+) b/i],[u,[g,"MachSpeed"],[f,M]],[/\btu_(1491) b/i],[u,[g,"Rotor"],[f,M]],[/(shield[\w ]+) b/i],[u,[g,"Nvidia"],[f,M]],[/(sprint) (\w+)/i],[g,u,[f,b]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[g,de],[f,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[g,ut],[f,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[g,ut],[f,b]],[/smart-tv.+(samsung)/i],[g,[f,F]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[g,ct],[f,F]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,Ue],[f,F]],[/(apple) ?tv/i],[g,[u,W+" TV"],[f,F]],[/crkey/i],[[u,lt+"cast"],[g,pe],[f,F]],[/droid.+aft(\w)( bui|\))/i],[u,[g,$],[f,F]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[g,Ct],[f,F]],[/(bravia[\w ]+)( bui|\))/i],[u,[g,Yt],[f,F]],[/(mitv-\w{5}) bui/i],[u,[g,Ie],[f,F]],[/Hbbtv.*(technisat) (.*);/i],[g,u,[f,F]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,hi],[u,hi],[f,F]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,F]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,u,[f,I]],[/droid.+; (shield) bui/i],[u,[g,"Nvidia"],[f,I]],[/(playstation [345portablevi]+)/i],[u,[g,Yt],[f,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[g,de],[f,I]],[/((pebble))app/i],[g,u,[f,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[g,W],[f,V]],[/droid.+; (glass) \d/i],[u,[g,pe],[f,V]],[/droid.+; (wt63?0{2,3})\)/i],[u,[g,ut],[f,V]],[/(quest( 2| pro)?)/i],[u,[g,y],[f,V]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[f,Z]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[f,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[f,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,b]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[h,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,S],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[h,[S,ia,T_]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,"Windows"],[S,ia,T_]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,B],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,S],[/\(bb(10);/i],[S,[h,et]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[h,Xt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[h,lt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,L],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,S],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[h,S]]},or=function(fn,Dn){if(typeof fn===a&&(Dn=fn,fn=i),!(this instanceof or))return new or(fn,Dn).getResult();var Qe=typeof e!==r&&e.navigator?e.navigator:i,ms=fn||(Qe&&Qe.userAgent?Qe.userAgent:""),Ro=Qe&&Qe.userAgentData?Qe.userAgentData:i,_n=Dn?function(be,rs){var Xa={};for(var Br in be)rs[Br]&&rs[Br].length%2==0?Xa[Br]=rs[Br].concat(be[Br]):Xa[Br]=be[Br];return Xa}(S_,Dn):S_;return this.getBrowser=function(){var be={};return be[h]=i,be[S]=i,_s.call(be,ms,_n.browser),be[l]=function(rs){return typeof rs===c?rs.replace(/[^\d\.]/g,"").split(".")[0]:i}(be[S]),Qe&&Qe.brave&&typeof Qe.brave.isBrave==s&&(be[h]="Brave"),be},this.getCPU=function(){var be={};return be[w]=i,_s.call(be,ms,_n.cpu),be},this.getDevice=function(){var be={};return be[g]=i,be[u]=i,be[f]=i,_s.call(be,ms,_n.device),!be[f]&&Ro&&Ro.mobile&&(be[f]=b),be[u]=="Macintosh"&&Qe&&typeof Qe.standalone!==r&&Qe.maxTouchPoints&&Qe.maxTouchPoints>2&&(be[u]="iPad",be[f]=M),be},this.getEngine=function(){var be={};return be[h]=i,be[S]=i,_s.call(be,ms,_n.engine),be},this.getOS=function(){var be={};return be[h]=i,be[S]=i,_s.call(be,ms,_n.os),!be[h]&&Ro&&Ro.platform!="Unknown"&&(be[h]=Ro.platform.replace(/chrome os/i,L).replace(/macos/i,B)),be},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ms},this.setUA=function(be){return ms=typeof be===c&&be.length>350?hi(be,350):be,this},this.setUA(ms),this};or.VERSION="0.7.34",or.BROWSER=ot([h,S,l]),or.CPU=ot([w]),or.DEVICE=ot([u,g,f,I,b,F,M,V,Z]),or.ENGINE=or.OS=ot([h,S]),n.exports&&(t=n.exports=or),t.UAParser=or;var Ja=typeof e!==r&&(e.jQuery||e.Zepto);if(Ja&&!Ja.ua){var fl=new or;Ja.ua=fl.getResult(),Ja.ua.get=function(){return fl.getUA()},Ja.ua.set=function(fn){fl.setUA(fn);var Dn=fl.getResult();for(var Qe in Dn)Ja.ua[Qe]=Dn[Qe]}}})(typeof window=="object"?window:Y)})(Fg,Fg.exports);const Bg=new(st(Fg.exports));let Ko=Bg.getResult(),jg=null;function we(n){if(!jg){n&&Bg.setUA(n),Ko=Bg.getResult();const t=function(r){if(r.engine.name==="Blink"&&r.browser.name!=="WeChat")return De.CHROME;switch(r.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return De.CHROME;case"Safari":case"Mobile Safari":return De.SAFARI;case"Edge":return De.EDGE;case"Firefox":return De.FIREFOX;case"QQBrowser":return De.QQ;case"Opera":return De.OPERA;case"WeChat":return De.WECHAT;default:return r.browser.name||""}}(Ko),e=function(r){let a;return a=r.engine.name==="Blink"?r.engine.version||"":r.browser.version||"",a.split(".")[0]}(Ko),i=function(r){return r.os.name==="Windows"?r.os.version?r.os.name+" "+r.os.version:r.os.name:r.os.name||""}(Ko),s=Ko.os.version;if(!(t&&e&&i&&s))return{name:t,version:e,os:i,osVersion:s};jg={name:t,version:e,os:i,osVersion:s}}return jg}function nf(){return we().os}function XI(){const n=we();return"".concat(n.os," ").concat(n.osVersion)}function sf(){const n=we();return!!(Ko.engine.name==="WebKit"&&n.os===Kn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&n.name!==De.SAFARI||Li()&&n.name!==De.SAFARI)}function qF(){const n=we();if(sf()){if(n.os===Kn.MAC_OS)return!0;if(n.os===Kn.IOS){const t=Ko.os.version&&Ko.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function YF(){return Ko.engine.name==="WebKit"}function Gg(){return we().name===De.CHROME}function Pi(){return we().name===De.SAFARI}function $e(){return we().name===De.FIREFOX}function Li(){return we().os===Kn.IOS}function Wg(n){const t=we();return!(t.name!==De.CHROME||!t.osVersion)&&Number(t.version)>=n}function $I(n){const t=we();return!(t.name!==De.EDGE||!t.osVersion)&&Number(t.version)>=n}function QI(n){const t=we();return!(t.name!==De.OPERA||!t.osVersion)&&Number(t.version)>=n}function ZI(){const n=we();return!(n.name!==De.CHROME||!n.osVersion)&&Number(n.version)<=90}function tb(){const n=we();if(n.os!==Kn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Ud(){const n=we();if(n.os!==Kn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])===15}function Hg(){const n=we();if(n.os!==Kn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])===16}function eb(){const n=we();if(n.os!==Kn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function uo(){return Pi()&&navigator.maxTouchPoints>0}function nb(){return we().name===De.WECHAT}function ib(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function ba(){const n=we();return n.name===De.EDGE||n.name===De.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function rf(){return nf()===Kn.ANDROID}function Nu(){const n=we();return rf()&&(n.name===De.CHROME||n.name===De.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var O;(function(n){n.UNEXPECTED_ERROR="UNEXPECTED_ERROR",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.TIMEOUT="TIMEOUT",n.INVALID_PARAMS="INVALID_PARAMS",n.NOT_READABLE="NOT_READABLE",n.NOT_SUPPORTED="NOT_SUPPORTED",n.INVALID_OPERATION="INVALID_OPERATION",n.OPERATION_ABORTED="OPERATION_ABORTED",n.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",n.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",n.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",n.DATACHANNEL_FAILED="DATACHANNEL_FAILED",n.NETWORK_ERROR="NETWORK_ERROR",n.NETWORK_TIMEOUT="NETWORK_TIMEOUT",n.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",n.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",n.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",n.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",n.ELECTRON_IS_NULL="ELECTRON_IS_NULL",n.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",n.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",n.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",n.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",n.TRACK_IS_DISABLED="TRACK_IS_DISABLED",n.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",n.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",n.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",n.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",n.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",n.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",n.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",n.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",n.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",n.UID_CONFLICT="UID_CONFLICT",n.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",n.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",n.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",n.INVALID_TRACK="INVALID_TRACK",n.SENDER_NOT_FOUND="SENDER_NOT_FOUND",n.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",n.SET_ANSWER_FAILED="SET_ANSWER_FAILED",n.ICE_FAILED="ICE_FAILED",n.PC_CLOSED="PC_CLOSED",n.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",n.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",n.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",n.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",n.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",n.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",n.INVALID_REMOTE_USER="INVALID_REMOTE_USER",n.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",n.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",n.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",n.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",n.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",n.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",n.WS_ABORT="WS_ABORT",n.WS_DISCONNECT="WS_DISCONNECT",n.WS_ERR="WS_ERR",n.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",n.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",n.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",n.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",n.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",n.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",n.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",n.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",n.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",n.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",n.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",n.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",n.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",n.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",n.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",n.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",n.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",n.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",n.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",n.INVALID_PLUGIN="INVALID_PLUGIN",n.DISCONNECT_P2P="DISCONNECT_P2P",n.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",n.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",n.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",n.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",n.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",n.PROHIBITED_OPERATION="PROHIBITED_OPERATION",n.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"})(O||(O={}));let Q=class extends Error{constructor(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",e=arguments.length>2?arguments[2]:void 0;super(t),m(this,"code",void 0),m(this,"message",void 0),m(this,"data",void 0),m(this,"name","AgoraRTCException"),this.code=n,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=e}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return n==="error"&&(t||console).error(this.toString()),n==="warning"&&(t||console).warn(this.toString()),this}throw(n){throw this.print("error",n),this}};function Ac(n,t){if(typeof n!="boolean")throw new Q(O.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Vn(n,t,e){if(!Vt(e).call(e,n))throw new Q(O.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(e)))}function Fe(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(n<e||n>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(n))throw new Q(O.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(e,", ").concat(i,"]. integer only"))}function Kg(n,t){if(typeof n!="number"){if(!(n.min||n.max||n.ideal||n.exact))throw new Q(O.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));n.min!==void 0&&Fe(n.min,"".concat(t,".min"),0,1/0),n.max!==void 0&&Fe(n.max,"".concat(t,".max"),1,1/0),n.exact!==void 0&&Fe(n.exact,"".concat(t,".exact"),1,1/0),n.ideal!==void 0&&Fe(n.ideal,"".concat(t,".ideal"),1,1/0)}else Fe(n,t,1,1/0)}function ai(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(n==null)throw new Q(O.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!sb(n,e,i,s))throw new Q(O.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(e,",").concat(i,"].").concat(s?" ASCII characters only.":""))}function qo(n,t){if(!Array.isArray(n))throw new Q(O.INVALID_PARAMS,"".concat(t," should be an array"))}function nn(n){return n==null}function sb(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof n=="string"&&n.length<=e&&n.length>=t&&(!i||function(s){if(typeof s!="string")return!1;for(let r=0;r<s.length;r+=1){const a=s.charCodeAt(r);if(a<0||a>255)return!1}return!0}(n))}function rb(n,t,e){if("getBigUint64"in DataView.prototype)return n.getBigUint64(t,e);const i=n.getUint32(t,e),s=n.getUint32(t+4,e),r=+!!e,a=+!e;return BigInt(i*a+s*r)<<BigInt(32)|BigInt(i*r+s*a)}function ob(n,t,e,i){if("setBigUint64"in DataView.prototype)return n.setBigUint64(t,e,i);const s=Number(e>>BigInt(32)),r=Number(e&BigInt(4294967295));i?(n.setUint32(t+4,s,i),n.setUint32(t,r,i)):(n.setUint32(t,s,i),n.setUint32(t+4,r,i))}var xd,of;(function(n){n.COVERED="COVERED",n.POSITION="POSITION",n.SIZE="SIZE",n.STYLE="STYLE"})(xd||(xd={})),function(n){n.UNMOUNTED="UNMOUNTED",n.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(of||(of={}));const ab=new class{constructor(){m(this,"_clientSize",null),m(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),m(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),m(this,"getStyle",n=>window.getComputedStyle(n,null)),m(this,"checkCssVisibleProperty",n=>{var t;let e=!0;const i=this.getStyle(n),{display:s,visibility:r,opacity:a,filter:c}=i;return(s==="none"||Vt(t=["hidden","collapse"]).call(t,r)||Number(a)<.1)&&(e=!1),e?(c&&c.split(" ").filter(l=>{var u;const h=l.split("(")[0];return Vt(u=["brightness","blur","opacity"]).call(u,h)}).map(l=>{const[u,h]=l.split(/\(|\)/);return[u,Number(h.match(/^[0-9\.]+/))]}).forEach(l=>{const[u,h]=l;switch(u){case"brightness":(h<.1||h>3)&&(e=!1);break;case"blur":h>3&&(e=!1);break;case"opacity":h<.1&&(e=!1)}}),e):!1}),m(this,"checkPropertyUpToAllParentNodes",(n,t)=>{let e=!0,i=!0;const s=a=>t(a);let r=n;for(;r&&i;)s(r)||(e=!1,i=!1),r=r.parentElement,r||(i=!1);return e}),m(this,"checkActualCssVisibleIncludeInherit",n=>this.checkPropertyUpToAllParentNodes(n,this.checkCssVisibleProperty)),m(this,"getSizeAboutClient",n=>{const{width:t,height:e,left:i,right:s,top:r,bottom:a}=n.getBoundingClientRect(),c=this.getClientWidth(),l=this.getClientHeight();return{width:t,height:e,left:i,right:s,top:r,bottom:a,clientWidth:c,clientHeight:l,clientMin:Math.min(c,l)}}),m(this,"checkActualSize",()=>{const{width:n,height:t,clientMin:e}=this._clientSize;return this.checkSizeIsVisible(n,t,e)}),m(this,"elementFromPoint",(n,t)=>document.elementFromPoint?document.elementFromPoint(n,t):null),m(this,"checkCoverForAPoint",(n,t,e)=>{const i=this.elementFromPoint(n,t);return i!==null&&i!==e}),m(this,"getPointPositionList",()=>{const{width:n,height:t,left:e,top:i}=this._clientSize,s=n/6,r=t/6,a=[],c=10**6;for(let l=0;l<5;l++)for(let u=0;u<5;u++){const h=(e*c+(l===0?.1:l===4?(s*l*c-1e5)/c:s*l)*c)/c,f=(i*c+(u===0?.1:u===4?(r*u*c-1e5)/c:r*u)*c)/c;a.push({x:h,y:f})}return[...a]}),m(this,"checkElementCover",n=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,n)).filter(t=>!!t).length>6),m(this,"checkSizeIsVisible",(n,t,e)=>(n>50||e/n<=10)&&(t>50||e/t<=10)),m(this,"checkSizeOfPartInClient",()=>{const{left:n,right:t,top:e,bottom:i,clientHeight:s,clientWidth:r,clientMin:a}=this._clientSize;let c,l,u,h;if(n<0)c=0;else{if(!(n<r))return!1;c=n}if(t<0)return!1;if(l=t<r?t:r,e<0)u=0;else{if(!(e<s))return!1;u=e}if(i<0)return!1;h=i<s?i:s;const f=l-c,g=h-u;return this.checkSizeIsVisible(f,g,a)}),m(this,"returnHiddenResult",n=>(this._clientSize=null,{visible:!1,reason:n})),m(this,"checkOneElementVisible",n=>{if(n instanceof HTMLElement){if(this.checkElementIsMountedOnDom(n)){if(this.checkActualCssVisibleIncludeInherit(n)){if(this._clientSize=this.getSizeAboutClient(n),this.checkElementCover(n))return this.returnHiddenResult(xd.COVERED);{const t=this.checkActualSize(),e=this.checkSizeOfPartInClient();return t&&!e?this.returnHiddenResult(xd.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(xd.SIZE)}}return this.returnHiddenResult(xd.STYLE)}return this.returnHiddenResult(of.UNMOUNTED)}return this.returnHiddenResult(of.INVALID_HTML_ELEMENT)}),m(this,"checkElementIsMountedOnDom",n=>this.checkPropertyUpToAllParentNodes(n,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function qg(n){return new TextEncoder().encode(n)}const cb=function(n,t){const e=new Uint8Array(n.byteLength+t.byteLength);return e.set(new Uint8Array(n),0),e.set(new Uint8Array(t),n.byteLength),e},zF=async n=>{const t=function(r){const a=window.atob(r),c=new Uint8Array(new ArrayBuffer(a.length));for(let l=0;l<a.length;l+=1)c[l]=a.charCodeAt(l);return c}(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),e=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=qg(n),s=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},e,i);return function(r){let a="";for(let c=0;c<r.length;c+=1)a+=String.fromCharCode(r[c]);return window.btoa(a)}(new Uint8Array(s))},JF=async n=>function(t,e){let i="";return new Uint8Array(t).forEach(s=>{i+=s.toString(e).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",qg(n)),16);class Ze{constructor(){m(this,"_events",{}),m(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,e)===-1&&i.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,e)===-1&&i.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,e);s!==-1&&i.splice(s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(a=>a);for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];for(let a=0;a<e.length;a+=1){const c=e[a];c.once&&this.off(t,c.listener),c.listener.apply(this,s||[])}}safeEmit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,i)}catch(a){console.error("safeEmit event:".concat(t," error ").concat(a==null?void 0:a.toString()))}})}_indexOfListener(t,e){let i=t.length;for(;i--;)if(t[i].listener===e)return i;return-1}}let Du=null;function db(){if(Du)return Du;if(window.electron)return Du=window.electron;if(!window.require)return null;try{return Du=window.require("electron"),Du}catch{return null}}var wn,sn,Yg,ce,le,Fn,wi,Yo;function lb(n){return Fe(n.timeout,"config.timeout",0,1e5),Fe(n.timeoutFactor,"config.timeoutFactor",0,100,!1),Fe(n.maxRetryCount,"config.maxRetryConfig",0,1/0),Fe(n.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Vd(n){if(!Array.isArray(n)||n.length<1)return!1;try{n.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function ub(n){return ai(n.turnServerURL,"turnServerURL"),ai(n.username,"username"),ai(n.password,"password"),n.udpport&&Fe(n.udpport,"udpport",1,99999,!0),n.forceturn&&Ac(n.forceturn,"forceturn"),n.security&&Ac(n.security,"security"),n.tcpport&&Fe(n.tcpport,"tcpport",1,99999,!0),!0}function hb(n){return n.level!==void 0&&Vn(n.level,"level",[1,2,3]),n.delay!==void 0&&Fe(n.delay,"delay",0,3e3,!0),!0}function rn(n,t){for(var e=arguments.length,i=new Array(e>2?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return n.getListeners(t).length===0?K.reject(new Q(O.UNEXPECTED_ERROR,"can not emit promise")):new K((r,a)=>{n.emit(t,...i,r,a)})}function He(n,t){if(n.getListeners(t).length===0)return K.resolve();for(var e=arguments.length,i=new Array(e>2?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return rn(n,t,...i)}function us(n,t){if(n.getListeners(t).length===0)return null;for(var e=arguments.length,i=new Array(e>2?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return zo(n,t,...i)}function zo(n,t){let e=null,i=null;for(var s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];if(n.emit(t,...r,c=>{e=c},c=>{i=c}),i!==null)throw i;if(e===null)throw new Q(O.UNEXPECTED_ERROR,"handler is not sync");return e}(function(n){n.CREATE_CLIENT="createClient",n.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",n.SET_AREA="setArea",n.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",n.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",n.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",n.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",n.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",n.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",n.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",n.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",n.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",n.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",n.START_PROXY_SERVER="Client.startProxyServer",n.STOP_PROXY_SERVER="Client.stopProxyServer",n.SET_PROXY_SERVER="Client.setProxyServer",n.SET_TURN_SERVER="Client.setTurnServer",n.SET_CLIENT_ROLE="Client.setClientRole",n.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",n.ENABLE_DUAL_STREAM="Client.enableDualStream",n.DISABLE_DUAL_STREAM="Client.disableDualStream",n.JOIN="Client.join",n.LEAVE="Client.leave",n.PUBLISH="Client.publish",n.UNPUBLISH="Client.unpublish",n.SUBSCRIBE="Client.subscribe",n.MASS_SUBSCRIBE="Client.massSubscribe",n.MASS_UNSUBSCRIBE="Client.massUnsubscribe",n.UNSUBSCRIBE="Client.unsubscribe",n.RENEW_TOKEN="Client.renewToken",n.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",n.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",n.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",n.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",n.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",n.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",n.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",n.DATACHANNEL_FAILBACK="Client._datachannelFailback",n.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",n.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",n.START_LIVE_STREAMING="Client.startLiveStreaming",n.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",n.STOP_LIVE_STREAMING="Client.stopLiveStreaming",n.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",n.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",n.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",n.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",n.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",n.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",n.SET_CONFIG_DISTRIBUTE="_configDistribute",n.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",n.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",n.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",n.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",n.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",n.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",n.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",n.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",n.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",n.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",n.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",n.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",n.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",n.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",n.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",n.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",n.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",n.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",n.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",n.STREAM_TYPE_CHANGE="streamTypeChange",n.CONNECTION_STATE_CHANGE="connectionStateChange",n.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",n.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(wn||(wn={})),function(n){n.TRACER="tracer"}(sn||(sn={})),function(n){n[n.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",n[n.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",n[n.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(Yg||(Yg={})),function(n){n.LEAVE="LEAVE",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.UID_BANNED="UID_BANNED",n.IP_BANNED="IP_BANNED",n.CHANNEL_BANNED="CHANNEL_BANNED",n.FALLBACK="FALLBACK",n.LICENSE_MISSING="LICENSE_MISSING",n.LICENSE_EXPIRED="LICENSE_EXPIRED",n.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",n.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",n.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",n.LICENSE_ILLEGAL="LICENSE_ILLEGAL",n.TOKEN_EXPIRE="TOKEN_EXPIRE"}(ce||(ce={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.MEDIA_RECONNECT_START="media-reconnect-start",n.MEDIA_RECONNECT_END="media-reconnect-end",n.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",n.USER_JOINED="user-joined",n.USER_LEAVED="user-left",n.USER_PUBLISHED="user-published",n.USER_UNPUBLISHED="user-unpublished",n.USER_INFO_UPDATED="user-info-updated",n.CLIENT_BANNED="client-banned",n.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",n.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",n.VOLUME_INDICATOR="volume-indicator",n.CRYPT_ERROR="crypt-error",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGED="stream-type-changed",n.STREAM_FALLBACK="stream-fallback",n.RECEIVE_METADATA="receive-metadata",n.STREAM_MESSAGE="stream-message",n.LIVE_STREAMING_ERROR="live-streaming-error",n.LIVE_STREAMING_WARNING="live-streaming-warning",n.INJECT_STREAM_STATUS="stream-inject-status",n.EXCEPTION="exception",n.ERROR="error",n.P2P_LOST="p2p_lost",n.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",n.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",n.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",n.PUBLISHED_USER_LIST="published-user-list",n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",n.CONTENT_INSPECT_ERROR="content-inspect-error",n.CONTENT_INSPECT_RESULT="content-inspect-result",n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(le||(le={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}(Fn||(Fn={})),function(n){n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(wi||(wi={})),function(n){n.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(Yo||(Yo={}));const yn=new class extends Ze{set networkState(n){this.emit(Yo.NETWORK_STATE_CHANGE,n,this._networkState),n===wi.ONLINE?this.emit(Yo.ONLINE):n===wi.OFFLINE&&(this.onlineWaiter=new K(t=>{this.once(Yo.ONLINE,()=>{this.onlineWaiter=void 0,t(wi.ONLINE)})}),this.emit(Yo.OFFLINE)),this._networkState=n}get networkState(){return this._networkState}get isOnline(){return this._networkState===wi.ONLINE}constructor(){super(),m(this,"_moduleName","network-indicator"),m(this,"_networkState",wi.ONLINE),m(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=wi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=wi.OFFLINE})}};function pb(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function wc(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?pb(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):pb(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function zg(n,t){const e=n.indexOf(t);e!==-1&&n.splice(e,1)}function Fd(n){const t=[];return n.forEach(e=>{t.indexOf(e)===-1&&t.push(e)}),t}function mr(n){K!==void 0?K.resolve().then(n):setTimeout(n,0)}function Rn(n){return JSON.parse(JSON.stringify(n))}function Oc(n){try{return Rn(n)}catch{return n}}const fb={};function Pu(n,t){fb[t]||(fb[t]=!0,n())}function af(n){const t=window.atob(n),e=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)e[i]=t.charCodeAt(i);return e}function cf(n){let t="";for(let e=0;e<n.length;e+=1)t+=String.fromCharCode(n[e]);return window.btoa(t)}function ho(n){return window.TextEncoder?new TextEncoder().encode(n).length:n.length}function _b(n){let t=0;return/DingTalk/i.test(navigator.userAgent)&&n.realFormData&&(n=n.realFormData),n.forEach(e=>{t+=typeof e=="string"?ho(e):e.size}),t+138}function XF(n){const t=new Q(O.TIMEOUT,"timeout");return new K((e,i)=>{window.setTimeout(()=>i(t),n)})}function ri(n){return new K(t=>{window.setTimeout(t,n)})}function Be(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const e=Math.random().toString(16).substr(2,n).toLowerCase();return e.length===n?"".concat(t).concat(e):"".concat(t).concat(e)+Be(n-e.length,"")}function Jg(){return Be(32,"").toUpperCase()}const df=()=>{},mb=new class{constructor(){m(this,"fnMap",new Map)}throttleByKey(n,t,e,i){for(var s=arguments.length,r=new Array(s>4?s-4:0),a=4;a<s;a++)r[a-4]=arguments[a];if(this.fnMap.has(t)){const c=this.fnMap.get(t);if(c.threshold!==e){c.fn(...c.args),clearTimeout(c.timer);const l=window.setTimeout(()=>{const u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},e);this.fnMap.set(t,{fn:n,threshold:e,timer:l,args:r,skipFn:i})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(t,wc(wc({},c),{},{fn:n,args:r,skipFn:i}))}else{const c=window.setTimeout(()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},e);this.fnMap.set(t,{fn:n,threshold:e,timer:c,args:r,skipFn:i})}}},Eb=mb.throttleByKey.bind(mb);function gb(n){return typeof n=="object"&&n!==null&&!(n instanceof RegExp)}function Xg(n,t){if(!gb(n)||!gb(t)||Array.isArray(n)&&!Array.isArray(t)||!Array.isArray(n)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(n)){const e=[...n];for(let i=0;i<t.length;i++)e[i]=Xg(n[i],t[i]);return e}{const e=wc({},n);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(n,i)?e[i]=Xg(n[i],t[i]):e[i]=t[i]);return e}}let $F=1,lf=console;class qn{static setLogger(t){lf=t}constructor(t){m(this,"lockingPromise",K.resolve()),m(this,"locks",0),m(this,"name",""),m(this,"lockId",void 0),this.lockId=$F++,t&&(this.name=t),lf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,lf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const i=new K(r=>{e=()=>{this.locks-=1,lf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),r()}}),s=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>i),s}}function Bd(n,t){return function(e,i,s){const r=s.value;if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const a=this[t];if(!a)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(n));const c=await a.lock("From ".concat(n,".").concat(i));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await r.apply(this,u)}finally{c()}},s}}const In={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function uf(n,t){const e=Math.floor(t.timeout*Math.pow(t.timeoutFactor,n));return Math.min(t.maxRetryTimeout,e)}function Ur(n,t,e,i){const s=Object.assign({},In,i);let r=s.timeout;const a=async()=>{await function(u){return new K(h=>{window.setTimeout(h,u)})}(r),r*=s.timeoutFactor,r=Math.min(s.maxRetryTimeout,r)};let c=!1;const l=new K(async(u,h)=>{t=t||(()=>!1),e=e||(()=>!0);for(let f=0;f<s.maxRetryCount;f+=1){if(c)return h(new Q(O.OPERATION_ABORTED));try{const g=await n();if(!t(g,f)||f+1===s.maxRetryCount)return u(g);await a()}catch(g){if(!e(g,f)||f+1===s.maxRetryCount)return h(g);await a()}}});return l.cancel=()=>c=!0,l}var QF=Cs,ZF=so,tB=Wl,eB=Hi,nB=TypeError,Tb=function(n){return function(t,e,i,s){QF(e);var r=ZF(t),a=tB(r),c=eB(r),l=n?c-1:0,u=n?-1:1;if(i<2)for(;;){if(l in a){s=a[l],l+=u;break}if(l+=u,n?l<0:c<=l)throw nB("Reduce of empty array with no initial value")}for(;n?l>=0:c>l;l+=u)l in a&&(s=e(s,a[l],l,r));return s}},iB={left:Tb(!1),right:Tb(!0)}.left;C({target:"Array",proto:!0,forced:!yu&&xo>79&&xo<83||!MR("reduce")},{reduce:function(n){var t=arguments.length;return iB(this,n,t,t>1?arguments[1]:void 0)}});var sB=Sc("Array").reduce,rB=En,oB=sB,$g=Array.prototype,Nc=st(function(n){var t=n.reduce;return n===$g||rB($g,n)&&t===$g.reduce?oB:t});let Qg=class{constructor(n){m(this,"input",[]),m(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}mean(){var n;return this.input.length===0?0:Nc(n=this.input).call(n,(t,e)=>t+e)/this.input.length}};var Zg,tT={exports:{}},Sb=function(n,t){return function(){for(var e=new Array(arguments.length),i=0;i<e.length;i++)e[i]=arguments[i];return n.apply(t,e)}},aB=Sb,eT=Object.prototype.toString,nT=(Zg=Object.create(null),function(n){var t=eT.call(n);return Zg[t]||(Zg[t]=t.slice(8,-1).toLowerCase())});function Dc(n){return n=n.toLowerCase(),function(t){return nT(t)===n}}function iT(n){return Array.isArray(n)}function hf(n){return n===void 0}var vb=Dc("ArrayBuffer");function Cb(n){return n!==null&&typeof n=="object"}function pf(n){if(nT(n)!=="object")return!1;var t=Object.getPrototypeOf(n);return t===null||t===Object.prototype}var cB=Dc("Date"),dB=Dc("File"),lB=Dc("Blob"),uB=Dc("FileList");function sT(n){return eT.call(n)==="[object Function]"}var hB=Dc("URLSearchParams");function rT(n,t){if(n!=null)if(typeof n!="object"&&(n=[n]),iT(n))for(var e=0,i=n.length;e<i;e++)t.call(null,n[e],e,n);else for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.call(null,n[s],s,n)}var oT,pB=(oT=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(n){return oT&&n instanceof oT}),Ki={isArray:iT,isArrayBuffer:vb,isBuffer:function(n){return n!==null&&!hf(n)&&n.constructor!==null&&!hf(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)},isFormData:function(n){var t="[object FormData]";return n&&(typeof FormData=="function"&&n instanceof FormData||eT.call(n)===t||sT(n.toString)&&n.toString()===t)},isArrayBufferView:function(n){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&vb(n.buffer)},isString:function(n){return typeof n=="string"},isNumber:function(n){return typeof n=="number"},isObject:Cb,isPlainObject:pf,isUndefined:hf,isDate:cB,isFile:dB,isBlob:lB,isFunction:sT,isStream:function(n){return Cb(n)&&sT(n.pipe)},isURLSearchParams:hB,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:rT,merge:function n(){var t={};function e(r,a){pf(t[a])&&pf(r)?t[a]=n(t[a],r):pf(r)?t[a]=n({},r):iT(r)?t[a]=r.slice():t[a]=r}for(var i=0,s=arguments.length;i<s;i++)rT(arguments[i],e);return t},extend:function(n,t,e){return rT(t,function(i,s){n[s]=e&&typeof i=="function"?aB(i,e):i}),n},trim:function(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")},stripBOM:function(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n},inherits:function(n,t,e,i){n.prototype=Object.create(t.prototype,i),n.prototype.constructor=n,e&&Object.assign(n.prototype,e)},toFlatObject:function(n,t,e){var i,s,r,a={};t=t||{};do{for(s=(i=Object.getOwnPropertyNames(n)).length;s-- >0;)a[r=i[s]]||(t[r]=n[r],a[r]=!0);n=Object.getPrototypeOf(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},kindOf:nT,kindOfTest:Dc,endsWith:function(n,t,e){n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;var i=n.indexOf(t,e);return i!==-1&&i===e},toArray:function(n){if(!n)return null;var t=n.length;if(hf(t))return null;for(var e=new Array(t);t-- >0;)e[t]=n[t];return e},isTypedArray:pB,isFileList:uB},jd=Ki;function yb(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Rb=function(n,t,e){if(!t)return n;var i;if(e)i=e(t);else if(jd.isURLSearchParams(t))i=t.toString();else{var s=[];jd.forEach(t,function(a,c){a!=null&&(jd.isArray(a)?c+="[]":a=[a],jd.forEach(a,function(l){jd.isDate(l)?l=l.toISOString():jd.isObject(l)&&(l=JSON.stringify(l)),s.push(yb(c)+"="+yb(l))}))}),i=s.join("&")}if(i){var r=n.indexOf("#");r!==-1&&(n=n.slice(0,r)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n},fB=Ki;function ff(){this.handlers=[]}ff.prototype.use=function(n,t,e){return this.handlers.push({fulfilled:n,rejected:t,synchronous:!!e&&e.synchronous,runWhen:e?e.runWhen:null}),this.handlers.length-1},ff.prototype.eject=function(n){this.handlers[n]&&(this.handlers[n]=null)},ff.prototype.forEach=function(n){fB.forEach(this.handlers,function(t){t!==null&&n(t)})};var Ib,bb,_B=ff,mB=Ki;function Gd(){if(bb)return Ib;bb=1;var n=Ki;function t(s,r,a,c,l){Error.call(this),this.message=s,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),c&&(this.request=c),l&&(this.response=l)}n.inherits(t,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var e=t.prototype,i={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(s){i[s]={value:s}}),Object.defineProperties(t,i),Object.defineProperty(e,"isAxiosError",{value:!0}),t.from=function(s,r,a,c,l,u){var h=Object.create(e);return n.toFlatObject(s,h,function(f){return f!==Error.prototype}),t.call(h,s.message,r,a,c,l),h.name=s.name,u&&Object.assign(h,u),h},Ib=t}var aT,Ab,wb,Ob,cT,Nb,Db={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function Pb(){if(Ab)return aT;Ab=1;var n=Ki;return aT=function(t,e){e=e||new FormData;var i=[];function s(r){return r===null?"":n.isDate(r)?r.toISOString():n.isArrayBuffer(r)||n.isTypedArray(r)?typeof Blob=="function"?new Blob([r]):Buffer.from(r):r}return function r(a,c){if(n.isPlainObject(a)||n.isArray(a)){if(i.indexOf(a)!==-1)throw Error("Circular reference detected in "+c);i.push(a),n.forEach(a,function(l,u){if(!n.isUndefined(l)){var h,f=c?c+"."+u:u;if(l&&!c&&typeof l=="object"){if(n.endsWith(u,"{}"))l=JSON.stringify(l);else if(n.endsWith(u,"[]")&&(h=n.toArray(l)))return void h.forEach(function(g){!n.isUndefined(g)&&e.append(f,s(g))})}r(l,f)}}),i.pop()}else e.append(c,s(a))}(t),e},aT}function EB(){if(Ob)return wb;Ob=1;var n=Gd();return wb=function(t,e,i){var s=i.config.validateStatus;i.status&&s&&!s(i.status)?e(new n("Request failed with status code "+i.status,[n.ERR_BAD_REQUEST,n.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}}function gB(){if(Nb)return cT;Nb=1;var n=Ki;return cT=n.isStandardBrowserEnv()?{write:function(t,e,i,s,r,a){var c=[];c.push(t+"="+encodeURIComponent(e)),n.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),n.isString(s)&&c.push("path="+s),n.isString(r)&&c.push("domain="+r),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},cT}var dT,Lb,kb,Mb,Ub,xb,Vb,Fb,lT,Bb,jb,Gb,TB=function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)},SB=function(n,t){return t?n.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):n},Wb=function(n,t){return n&&!TB(t)?SB(n,t):t};function vB(){if(Lb)return dT;Lb=1;var n=Ki,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return dT=function(e){var i,s,r,a={};return e&&n.forEach(e.split(`
`),function(c){if(r=c.indexOf(":"),i=n.trim(c.substr(0,r)).toLowerCase(),s=n.trim(c.substr(r+1)),i){if(a[i]&&t.indexOf(i)>=0)return;a[i]=i==="set-cookie"?(a[i]?a[i]:[]).concat([s]):a[i]?a[i]+", "+s:s}}),a},dT}function CB(){if(Mb)return kb;Mb=1;var n=Ki;return kb=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function s(r){var a=r;return e&&(i.setAttribute("href",a),a=i.href),i.setAttribute("href",a),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return t=s(window.location.href),function(r){var a=n.isString(r)?s(r):r;return a.protocol===t.protocol&&a.host===t.host}}():function(){return!0}}function _f(){if(xb)return Ub;xb=1;var n=Gd();function t(e){n.call(this,e??"canceled",n.ERR_CANCELED),this.name="CanceledError"}return Ki.inherits(t,n,{__CANCEL__:!0}),Ub=t}function yB(){return Fb||(Fb=1,Vb=function(n){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}),Vb}function RB(){if(Bb)return lT;Bb=1;var n=Ki,t=EB(),e=gB(),i=Rb,s=Wb,r=vB(),a=CB(),c=Db,l=Gd(),u=_f(),h=yB();return lT=function(f){return new Promise(function(g,S){var w,I=f.data,b=f.headers,M=f.responseType;function F(){f.cancelToken&&f.cancelToken.unsubscribe(w),f.signal&&f.signal.removeEventListener("abort",w)}n.isFormData(I)&&n.isStandardBrowserEnv()&&delete b["Content-Type"];var V=new XMLHttpRequest;if(f.auth){var Z=f.auth.username||"",$=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"";b.Authorization="Basic "+btoa(Z+":"+$)}var W=s(f.baseURL,f.url);function q(){if(V){var lt="getAllResponseHeaders"in V?r(V.getAllResponseHeaders()):null,Xt={data:M&&M!=="text"&&M!=="json"?V.response:V.responseText,status:V.status,statusText:V.statusText,headers:lt,config:f,request:V};t(function(pe){g(pe),F()},function(pe){S(pe),F()},Xt),V=null}}if(V.open(f.method.toUpperCase(),i(W,f.params,f.paramsSerializer),!0),V.timeout=f.timeout,"onloadend"in V?V.onloadend=q:V.onreadystatechange=function(){V&&V.readyState===4&&(V.status!==0||V.responseURL&&V.responseURL.indexOf("file:")===0)&&setTimeout(q)},V.onabort=function(){V&&(S(new l("Request aborted",l.ECONNABORTED,f,V)),V=null)},V.onerror=function(){S(new l("Network Error",l.ERR_NETWORK,f,V,V)),V=null},V.ontimeout=function(){var lt=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded",Xt=f.transitional||c;f.timeoutErrorMessage&&(lt=f.timeoutErrorMessage),S(new l(lt,Xt.clarifyTimeoutError?l.ETIMEDOUT:l.ECONNABORTED,f,V)),V=null},n.isStandardBrowserEnv()){var et=(f.withCredentials||a(W))&&f.xsrfCookieName?e.read(f.xsrfCookieName):void 0;et&&(b[f.xsrfHeaderName]=et)}"setRequestHeader"in V&&n.forEach(b,function(lt,Xt){I===void 0&&Xt.toLowerCase()==="content-type"?delete b[Xt]:V.setRequestHeader(Xt,lt)}),n.isUndefined(f.withCredentials)||(V.withCredentials=!!f.withCredentials),M&&M!=="json"&&(V.responseType=f.responseType),typeof f.onDownloadProgress=="function"&&V.addEventListener("progress",f.onDownloadProgress),typeof f.onUploadProgress=="function"&&V.upload&&V.upload.addEventListener("progress",f.onUploadProgress),(f.cancelToken||f.signal)&&(w=function(lt){V&&(S(!lt||lt&&lt.type?new u:lt),V.abort(),V=null)},f.cancelToken&&f.cancelToken.subscribe(w),f.signal&&(f.signal.aborted?w():f.signal.addEventListener("abort",w))),I||(I=null);var _t=h(W);_t&&["http","https","file"].indexOf(_t)===-1?S(new l("Unsupported protocol "+_t+":",l.ERR_BAD_REQUEST,f)):V.send(I)})},lT}var ki=Ki,Hb=function(n,t){mB.forEach(n,function(e,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(n[t]=e,delete n[i])})},Kb=Gd(),IB=Db,bB=Pb(),AB={"Content-Type":"application/x-www-form-urlencoded"};function qb(n,t){!ki.isUndefined(n)&&ki.isUndefined(n["Content-Type"])&&(n["Content-Type"]=t)}var Yb,mf={transitional:IB,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(Yb=RB()),Yb),transformRequest:[function(n,t){if(Hb(t,"Accept"),Hb(t,"Content-Type"),ki.isFormData(n)||ki.isArrayBuffer(n)||ki.isBuffer(n)||ki.isStream(n)||ki.isFile(n)||ki.isBlob(n))return n;if(ki.isArrayBufferView(n))return n.buffer;if(ki.isURLSearchParams(n))return qb(t,"application/x-www-form-urlencoded;charset=utf-8"),n.toString();var e,i=ki.isObject(n),s=t&&t["Content-Type"];if((e=ki.isFileList(n))||i&&s==="multipart/form-data"){var r=this.env&&this.env.FormData;return bB(e?{"files[]":n}:n,r&&new r)}return i||s==="application/json"?(qb(t,"application/json"),function(a,c,l){if(ki.isString(a))try{return(c||JSON.parse)(a),ki.trim(a)}catch(u){if(u.name!=="SyntaxError")throw u}return(l||JSON.stringify)(a)}(n)):n}],transformResponse:[function(n){var t=this.transitional||mf.transitional,e=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,s=!e&&this.responseType==="json";if(s||i&&ki.isString(n)&&n.length)try{return JSON.parse(n)}catch(r){if(s)throw r.name==="SyntaxError"?Kb.from(r,Kb.ERR_BAD_RESPONSE,this,null,this.response):r}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Gb?jb:(Gb=1,jb=null)},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ki.forEach(["delete","get","head"],function(n){mf.headers[n]={}}),ki.forEach(["post","put","patch"],function(n){mf.headers[n]=ki.merge(AB)});var zb,Jb,uT=mf,wB=Ki,OB=uT;function Xb(){return Jb?zb:(Jb=1,zb=function(n){return!(!n||!n.__CANCEL__)})}var $b=Ki,hT=function(n,t,e){var i=this||OB;return wB.forEach(e,function(s){n=s.call(i,n,t)}),n},NB=Xb(),DB=uT,PB=_f();function pT(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new PB}var Qb,Zb,Ys=Ki,tA=function(n,t){t=t||{};var e={};function i(u,h){return Ys.isPlainObject(u)&&Ys.isPlainObject(h)?Ys.merge(u,h):Ys.isPlainObject(h)?Ys.merge({},h):Ys.isArray(h)?h.slice():h}function s(u){return Ys.isUndefined(t[u])?Ys.isUndefined(n[u])?void 0:i(void 0,n[u]):i(n[u],t[u])}function r(u){if(!Ys.isUndefined(t[u]))return i(void 0,t[u])}function a(u){return Ys.isUndefined(t[u])?Ys.isUndefined(n[u])?void 0:i(void 0,n[u]):i(void 0,t[u])}function c(u){return u in t?i(n[u],t[u]):u in n?i(void 0,n[u]):void 0}var l={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return Ys.forEach(Object.keys(n).concat(Object.keys(t)),function(u){var h=l[u]||s,f=h(u);Ys.isUndefined(f)&&h!==c||(e[u]=f)}),e};function eA(){return Zb?Qb:(Zb=1,Qb={version:"0.27.2"})}var LB=eA().version,Aa=Gd(),fT={};["object","boolean","number","function","string","symbol"].forEach(function(n,t){fT[n]=function(e){return typeof e===n||"a"+(t<1?"n ":" ")+n}});var nA={};fT.transitional=function(n,t,e){function i(s,r){return"[Axios v"+LB+"] Transitional option '"+s+"'"+r+(e?". "+e:"")}return function(s,r,a){if(n===!1)throw new Aa(i(r," has been removed"+(t?" in "+t:"")),Aa.ERR_DEPRECATED);return t&&!nA[r]&&(nA[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!n||n(s,r,a)}};var iA,sA,rA,oA,aA,cA,kB={assertOptions:function(n,t,e){if(typeof n!="object")throw new Aa("options must be an object",Aa.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(n),s=i.length;s-- >0;){var r=i[s],a=t[r];if(a){var c=n[r],l=c===void 0||a(c,r,n);if(l!==!0)throw new Aa("option "+r+" must be "+l,Aa.ERR_BAD_OPTION_VALUE)}else if(e!==!0)throw new Aa("Unknown option "+r,Aa.ERR_BAD_OPTION)}},validators:fT},dA=Ki,MB=Rb,lA=_B,uA=function(n){return pT(n),n.headers=n.headers||{},n.data=hT.call(n,n.data,n.headers,n.transformRequest),n.headers=$b.merge(n.headers.common||{},n.headers[n.method]||{},n.headers),$b.forEach(["delete","get","head","post","put","patch","common"],function(t){delete n.headers[t]}),(n.adapter||DB.adapter)(n).then(function(t){return pT(n),t.data=hT.call(n,t.data,t.headers,n.transformResponse),t},function(t){return NB(t)||(pT(n),t&&t.response&&(t.response.data=hT.call(n,t.response.data,t.response.headers,n.transformResponse))),Promise.reject(t)})},Ef=tA,UB=Wb,hA=kB,Wd=hA.validators;function Hd(n){this.defaults=n,this.interceptors={request:new lA,response:new lA}}Hd.prototype.request=function(n,t){typeof n=="string"?(t=t||{}).url=n:t=n||{},(t=Ef(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=t.transitional;e!==void 0&&hA.assertOptions(e,{silentJSONParsing:Wd.transitional(Wd.boolean),forcedJSONParsing:Wd.transitional(Wd.boolean),clarifyTimeoutError:Wd.transitional(Wd.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(t)===!1||(s=s&&f.synchronous,i.unshift(f.fulfilled,f.rejected))});var r,a=[];if(this.interceptors.response.forEach(function(f){a.push(f.fulfilled,f.rejected)}),!s){var c=[uA,void 0];for(Array.prototype.unshift.apply(c,i),c=c.concat(a),r=Promise.resolve(t);c.length;)r=r.then(c.shift(),c.shift());return r}for(var l=t;i.length;){var u=i.shift(),h=i.shift();try{l=u(l)}catch(f){h(f);break}}try{r=uA(l)}catch(f){return Promise.reject(f)}for(;a.length;)r=r.then(a.shift(),a.shift());return r},Hd.prototype.getUri=function(n){n=Ef(this.defaults,n);var t=UB(n.baseURL,n.url);return MB(t,n.params,n.paramsSerializer)},dA.forEach(["delete","get","head","options"],function(n){Hd.prototype[n]=function(t,e){return this.request(Ef(e||{},{method:n,url:t,data:(e||{}).data}))}}),dA.forEach(["post","put","patch"],function(n){function t(e){return function(i,s,r){return this.request(Ef(r||{},{method:n,headers:e?{"Content-Type":"multipart/form-data"}:{},url:i,data:s}))}}Hd.prototype[n]=t(),Hd.prototype[n+"Form"]=t(!0)});var pA=Ki,xB=Sb,gf=Hd,VB=tA,As=function n(t){var e=new gf(t),i=xB(gf.prototype.request,e);return pA.extend(i,gf.prototype,e),pA.extend(i,e),i.create=function(s){return n(VB(t,s))},i}(uT);As.Axios=gf,As.CanceledError=_f(),As.CancelToken=function(){if(sA)return iA;sA=1;var n=_f();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var i;this.promise=new Promise(function(r){i=r});var s=this;this.promise.then(function(r){if(s._listeners){var a,c=s._listeners.length;for(a=0;a<c;a++)s._listeners[a](r);s._listeners=null}}),this.promise.then=function(r){var a,c=new Promise(function(l){s.subscribe(l),a=l}).then(r);return c.cancel=function(){s.unsubscribe(a)},c},e(function(r){s.reason||(s.reason=new n(r),i(s.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},t.prototype.unsubscribe=function(e){if(this._listeners){var i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}},t.source=function(){var e;return{token:new t(function(i){e=i}),cancel:e}},iA=t}(),As.isCancel=Xb(),As.VERSION=eA().version,As.toFormData=Pb(),As.AxiosError=Gd(),As.Cancel=As.CanceledError,As.all=function(n){return Promise.all(n)},As.spread=oA?rA:(oA=1,rA=function(n){return function(t){return n.apply(null,t)}}),As.isAxiosError=function(){if(cA)return aA;cA=1;var n=Ki;return aA=function(t){return n.isObject(t)&&t.isAxiosError===!0}}(),tT.exports=As,tT.exports.default=As;var Zi=st(tT.exports);function fA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function _A(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?fA(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):fA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}let Tf,Sf=0,_T=0;function mT(n,t,e,i){return new K((s,r)=>{t.responseType=t.responseType||"json",t.data&&!e?(t.data=JSON.stringify(t.data),Sf+=ho(t.data)):e&&(t.data.size?Sf+=t.data.size:t.data instanceof FormData?Sf+=_b(t.data):Sf+=ho(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=n,Zi.request(t).then(a=>{typeof a.data=="string"?_T+=ho(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?_T+=a.data.byteLength:_T+=ho(JSON.stringify(a.data)),i&&s({data:a.data,headers:a.headers}),s(a.data)}).catch(a=>{Zi.isCancel(a)?r(new Q(O.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?r(new Q(O.NETWORK_TIMEOUT,a.message)):a.response?r(new Q(O.NETWORK_RESPONSE_ERROR,a.response.status)):r(new Q(O.NETWORK_ERROR,a.message))})})}async function FB(n,t){const e=new Blob([t.data],{type:"buffer"});return await mT(n,_A(_A({},t),{},{data:e,headers:{"Content-Type":"application/octet-stream"}}),!0)}const BB=()=>(Tf||Tf||(Tf=(window.location.protocol.split(":")[0]||"").toUpperCase(),Tf))==="HTTPS",mA=()=>window.isSecureContext!==void 0;function EA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Pt(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?EA(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):EA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}var he;(function(n){n.SET_SESSION_ID="SET_SESSION_ID",n.SET_P2P_ID="SET_P2P_id",n.SET_DC_ID="SET_DC_id",n.SET_UID="SET_UID",n.SET_PUB_ID="SET_PUB_ID",n.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",n.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",n.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",n.AVOID_JOIN_START="AVOID_JOIN_START",n.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",n.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",n.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",n.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",n.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",n.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",n.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",n.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",n.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",n.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",n.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",n.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",n.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",n.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",n.RESET_KEY_METRICS="RESET_KEY_METRICS",n.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",n.SET_USE_P2P="SET_USE_P2P"})(he||(he={}));class jB{constructor(t,e,i,s){m(this,"state",void 0),this.state={codec:t,audioCodec:e,mode:i,clientId:s,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(t){this.state=function(e,i){switch(i.type){case he.SET_SESSION_ID:return Pt(Pt({},e),{},{sessionId:i.sessionId});case he.SET_P2P_ID:return Pt(Pt({},e),{},{p2pId:i.p2pId});case he.SET_UID:return Pt(Pt({},e),{},{uid:i.uid});case he.SET_PUB_ID:return Pt(Pt({},e),{},{pubId:i.pubId});case he.KEY_METRIC_CLIENT_CREATED:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{clientCreated:i.metric})});case he.KEY_METRIC_JOIN_START:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{joinStart:i.metric})});case he.AVOID_JOIN_START:return Pt(Pt({},e),{},{avoidJoinStart:i.avoidJoinStart});case he.KEY_METRIC_JOIN_END:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{joinEnd:i.metric})});case he.KEY_METRIC_REQUEST_AP_START:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{requestAPStart:i.metric})});case he.KEY_METRIC_REQUEST_AP_END:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{requestAPEnd:i.metric})});case he.KEY_METRIC_JOIN_GATEWAY_START:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{joinGatewayStart:i.metric})});case he.KEY_METRIC_JOIN_GATEWAY_END:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{joinGatewayEnd:i.metric})});case he.KEY_METRIC_PEER_CONNECTION_START:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{peerConnectionStart:i.metric})});case he.KEY_METRIC_PEER_CONNECTION_END:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{peerConnectionEnd:i.metric})});case he.KEY_METRIC_DESCRIPTION_START:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{descriptionStart:i.metric})});case he.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{signalChannelOpen:i.metric})});case he.KEY_METRIC_ICE_CONNECTION_END:return Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{iceConnectionEnd:i.metric})});case he.KEY_METRIC_PUBLISH:{const s=e.keyMetrics.publish,r=s.findIndex(a=>a.trackId===i.metric.trackId);return r!==-1?(s[r]=Pt(Pt({},s[r]),i.metric),Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{publish:[...s]})})):Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,i.metric]})})}case he.KEY_METRIC_SUBSCRIBE:{const s=e.keyMetrics.subscribe,r=s.findIndex(a=>a.userId===i.metric.userId&&a.type===i.metric.type);return r!==-1?(s[r]=Pt(Pt({},s[r]),i.metric),Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{subscribe:[...s]})})):Pt(Pt({},e),{},{keyMetrics:Pt(Pt({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,i.metric]})})}case he.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=i.mode,e;case he.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,i.record]:(e.joinChannelServiceRecords[i.index]=Pt(Pt({},e.joinChannelServiceRecords[i.index]),i.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case he.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case he.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case he.SET_USE_DATACHANNEL:return Pt(Pt({},e),{},{useDataChannel:i.val});case he.SET_USE_P2P:return Pt(Pt({},e),{},{useP2P:i.val});default:return e}}(this.state,t)}set sessionId(t){this.dispatch({type:he.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:he.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:he.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:he.SET_UID,uid:t})}get uid(){return this.state.uid}set pubId(t){this.dispatch({type:he.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:he.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:he.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}set useP2P(t){this.dispatch({type:he.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:he.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:he.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:he.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:he.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:he.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:he.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:he.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:he.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:he.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:he.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:he.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:he.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,e,i,s){this.dispatch({type:he.KEY_METRIC_PUBLISH,metric:Pt(Pt({trackId:t,type:e},i&&{publishStart:i}),s&&{publishEnd:s})})}subscribe(t,e,i,s,r,a,c){this.dispatch({type:he.KEY_METRIC_SUBSCRIBE,metric:Pt(Pt(Pt(Pt(Pt({userId:t,type:e},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),r&&{firstFrame:r}),a&&{streamAdded:a}),c&&{firstDecoded:c})})}massSubscribe(t,e,i,s){t.forEach(r=>{this.dispatch({type:he.KEY_METRIC_SUBSCRIBE,metric:Pt(Pt(Pt({userId:r.userId,type:r.type},e&&{subscribeStart:e}),i&&{subscribeEnd:i}),s&&{firstFrame:s})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,e){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof e!="number"?(this.dispatch({type:he.RECORD_JOIN_CHANNEL_SERVICE,record:Pt(Pt({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(e<0||e>=this.state.joinChannelServiceRecords.length||this.dispatch({type:he.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:e}),e)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:he.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:he.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:he.AVOID_JOIN_START,avoidJoinStart:t})}}const zs=function(n){if(n.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return n;const t=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[1],s=t[2];return"".concat(i,".").concat(s)}const e=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(e&&e[1]&&e[2]){const i=e[1],s=e[2];return"".concat(i,".").concat(100*(Number(s)+1))}return"4.0.0.999"}("4.19.1"),ET=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),gT="v4.19.1-0-g605286cc(10/11/2023, 2:37:03 PM)",Mi={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}};function je(n,t,e){var i,s;Vt(i=Object.keys(Mi)).call(i,n)&&(!e&&Vt(s=Object.keys(wa)).call(s,n)||(Mi[n]=t))}function U(n){return Mi[n]}const wa={},vf=new class extends Ze{reportLogUploadError(n){this.emit("REPORT_LOG_UPLOAD",n)}};class GB{constructor(t){m(this,"logger",void 0),m(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.debug(...this.prefixLists,...e)}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.info(...this.prefixLists,...e)}warning(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.warning(...this.prefixLists,...e)}error(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.error(...this.prefixLists,...e)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function TT(){const n=new Date;return n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}function gA(){const n=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+n.getUTCMilliseconds():n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}const Js={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Cf=Date.now(),Lu=n=>{for(const t in Js)if(Object.prototype.hasOwnProperty.call(Js,t)&&Js[t]===n)return t;return"DEFAULT"},v=new class{constructor(){m(this,"proxyServerURL",void 0),m(this,"logLevel",Js.DEBUG),m(this,"uploadState","collecting"),m(this,"uploadLogWaitingList",[]),m(this,"uploadLogUploadingList",[]),m(this,"uploadErrorCount",0),m(this,"currentLogID",0),m(this,"url",void 0),m(this,"extLog",(n,t)=>{this.appendLogToWaitingList(n,...t)})}debug(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Js.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Js.INFO].concat(t);this.log.apply(this,i)}warning(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Js.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Js.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Js.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(n){n=Math.min(Math.max(0,n),4),this.logLevel=n}enableLogUpload(){je("UPLOAD_LOG",!0)}disableLogUpload(){je("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(n){this.proxyServerURL=n}prefix(n){return new GB(this).prefix(n)}log(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];if(Date.now()-Cf<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Cf);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=TT()+" Agora-SDK [".concat(Lu(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const s=TT()+" %cAgora-SDK [".concat(Lu(i),"]:");let r=[];if(!U("USE_NEW_LOG"))switch(i){case Js.DEBUG:r=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,r);break;case Js.INFO:r=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,r);break;case Js.WARNING:r=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,r);break;case Js.ERROR:r=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,r)}}uploadLog(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];if(Date.now()-Cf<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Cf);const i=Math.max(0,Math.min(4,t[0]));t[0]=TT()+" Agora-SDK [".concat(Lu(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(n){if(!U("UPLOAD_LOG"))return;for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];Array.isArray(e[0])?e[0][0]=gA()+" Agora-SDK [".concat(Lu(n),"]:"):e[0]=gA()+" Agora-SDK [".concat(Lu(n),"]:");let s="";e.forEach(r=>{typeof r=="object"&&(r=JSON.stringify(r)),s+="".concat(r," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:n,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const n=this.uploadLogUploadingList,t={sdk_version:zs,process_id:U("PROCESS_ID"),payload:JSON.stringify(n)};return Ur(async()=>{const e=await Zi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(U("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(U("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(e.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=e,i}},()=>(this.uploadLogUploadingList=[],!1),e=>(e.response?vf.reportLogUploadError({status:e.response.status,data:e.response.data,headers:e.response.headers,message:e.message}):e.request?vf.reportLogUploadError({status:e.request.status,message:e.message}):vf.reportLogUploadError({status:-1,message:e.message}),!0),{timeout:U("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:U("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,U("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_INTERVAL"))}).catch(n=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var TA,SA;function WB(n){return ai(n.reportId,"params.reportId",0,100,!1),ai(n.category,"params.category",0,100,!1),ai(n.event,"params.event",0,100,!1),ai(n.label,"params.label",0,100,!1),Fe(n.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(n){n.FREE="free",n.UPLOADING="uploading"})(TA||(TA={})),function(n){n[n.MISC=0]="MISC",n[n.INTERNAL_EVENT=1]="INTERNAL_EVENT",n[n.PUBLIC_EVENT=2]="PUBLIC_EVENT",n[n.WEB_EVENT=3]="WEB_EVENT",n[n.INTERNAL_API=4]="INTERNAL_API",n[n.WEB_API=5]="WEB_API",n[n.PUBLIC_API=6]="PUBLIC_API"}(SA||(SA={}));const HB={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Bn,tn,vA,CA;function yA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function re(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?yA(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):yA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}(function(n){n.PUBLISH="publish",n.SUBSCRIBE="subscribe",n.WS_COMPRESSOR_INIT="ws_compressor_init",n.SESSION_INIT="session_init",n.JOIN_CHOOSE_SERVER="join_choose_server",n.REQ_USER_ACCOUNT="req_user_account",n.JOIN_GATEWAY="join_gateway",n.REJOIN_GATEWAY="rejoin_gateway",n.STREAM_SWITCH="stream_switch",n.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",n.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",n.FIRST_VIDEO_RECEIVED="first_video_received",n.FIRST_AUDIO_RECEIVED="first_audio_received",n.FIRST_VIDEO_DECODE="first_video_decode",n.FIRST_AUDIO_DECODE="first_audio_decode",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_UPDATE_STREAM="on_update_stream",n.ON_REMOVE_STREAM="on_remove_stream",n.USER_ANALYTICS="req_user_analytics",n.PC_STATS="pc_stats"})(Bn||(Bn={})),function(n){n.SESSION="io.agora.pb.Wrtc.Session",n.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",n.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",n.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",n.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",n.PUBLISH="io.agora.pb.Wrtc.Publish",n.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",n.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",n.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",n.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",n.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",n.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",n.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",n.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",n.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",n.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",n.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",n.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",n.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",n.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",n.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",n.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",n.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",n.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",n.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",n.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",n.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",n.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",n.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",n.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",n.PC_STATS="io.agora.pb.Wrtc.PCStats"}(tn||(tn={})),function(n){n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(vA||(vA={})),function(n){n[n.SESSION=26]="SESSION",n[n.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",n[n.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",n[n.JOIN_GATEWAY=28]="JOIN_GATEWAY",n[n.PUBLISH=30]="PUBLISH",n[n.SUBSCRIBE=29]="SUBSCRIBE",n[n.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",n[n.STREAM_SWITCH=32]="STREAM_SWITCH",n[n.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",n[n.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",n[n.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",n[n.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",n[n.API_INVOKE=41]="API_INVOKE",n[n.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",n[n.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",n[n.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",n[n.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",n[n.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",n[n.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",n[n.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",n[n.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",n[n.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",n[n.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",n[n.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",n[n.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",n[n.USER_ANALYTICS=1e4]="USER_ANALYTICS",n[n.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(CA||(CA={}));class ku{constructor(){m(this,"baseInfoMap",new Map),m(this,"proxyServer",void 0),m(this,"eventUploadTimer",void 0),m(this,"setSessionIdTimer",void 0),m(this,"url",void 0),m(this,"backupUrl",void 0),m(this,"_appId",void 0),m(this,"keyEventUploadPendingItems",[]),m(this,"normalEventUploadPendingItems",[]),m(this,"apiInvokeUploadPendingItems",[]),m(this,"apiInvokeCount",0),m(this,"ltsList",[]),m(this,"lastSendNormalEventTime",Date.now()),m(this,"customReportCounterTimer",void 0),m(this,"customReportCount",0),m(this,"extApiInvoke",async t=>{for(const e of t){const i=re(re({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:sn.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),U("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),U("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void v.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));const e=this.baseInfoMap.get(t),i=Date.now(),s=e.startTime;e.startTime=i,v.debug("rewrite session ".concat(t," startTime: ").concat(i," , ").concat(i-s,"ms")),this.baseInfoMap.set(t,e)}setAppId(t){this._appId=t}reportApiInvoke(t,e,i){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const s=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,a=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:s,options:e.options,states:e.states||null}),c=!!U("SHOW_REPORT_INVOKER_LOG");c&&v.info("".concat(e.name," start"),e.options);let l=!1;ri(e.timeout).then(()=>{l||(this.sendApiInvoke(re(re({},a()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),v.debug("".concat(e.name," timeout")))});const u=new Q(O.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:h=>{const f=()=>{if(l)throw u;return l=!0,this.sendApiInvoke(re(re({},a()),{},{success:!0},e.reportResult&&{result:h})),c&&v.info("".concat(e.name," onSuccess")),h};return i?Eb(f,e.name+"Success",i,()=>l=!0):f()},onError:h=>{const f=()=>{if(l)throw h;l=!0,this.sendApiInvoke(re(re({},a()),{},{success:!1,error:h})),c&&v.info("".concat(e.name," onFailure"),h.toString())};return i?Eb(f,e.name+"Error",i,()=>l=!0):f()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const i=Date.now(),s=this.createBaseInfo(t,i);s.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:U("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ET?"global":"oversea",areas:U("AREAS")&&U("AREAS").join(",")},e.extend),a=Date.now(),c=re(re({},s),{},{eventType:Bn.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,build:gT,lts:a,elapse:a-i,extend:JSON.stringify(r),mode:e.mode,process:U("PROCESS_ID"),appType:U("APP_TYPE"),success:!0,version:zs});this.send({type:tn.SESSION,data:c},!0)}joinChooseServer(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re({},s),{},{eventType:Bn.JOIN_CHOOSE_SERVER,lts:r,eventElapse:r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-i.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3});this.send({type:tn.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re({},s),{},{eventType:Bn.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:r-i.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:tn.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;e.vid&&(s.vid=e.vid),s.uid=e.uid,s.cid=e.cid;const r=Date.now(),{firstSuccess:a,avoidJoinStartTime:c,isProxy:l,addr:u}=e,h=r-(a&&c?c:i.startTime),f=re(re({},s),{},{eventType:Bn.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,elapse:h,eventElapse:r-e.lts,firstSuccess:a,signalChannel:e.signalChannel}),g=f.success?1:0;if(e.succ&&(i.lastJoinSuccessTime=r),a)this.send({type:tn.JOIN_GATEWAY,data:f},!0);else{let S;if(u)if(l){const I=u.match(/h=(\d{1,3}-){3}\d{1,3}/g),b=u.match(/p=[0-9]{1,6}/g);S={isSuccess:g,gatewayIp:I&&I.length?I[0].split("=")[1].replace(/-/g,"."):"",port:b&&b.length?b[0].split("=")[1]:"",isProxy:l?1:0}}else{const I=u.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),b=u.match(/(:|p=)[0-9]{1,6}/g);S={isSuccess:g,gatewayIp:I&&I.length?I[0].split("//")[1].replace(/-/g,"."):"",port:b&&b.length?b[0].split(/:|p=/g)[1]:"",isProxy:l?1:0}}else S={isSuccess:g,gatewayIp:"",port:"",isProxy:l?1:0};delete f.success,delete f.eventType,delete f.firstSuccess,f.vid=Number(f.vid);const w=Object.assign({},f,S,{eventType:Bn.REJOIN_GATEWAY});this.send({type:tn.RE_JOIN_GATEWAY,data:w},!0)}}joinChannelTimeout(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=Date.now(),r=re(re({},i.info),{},{lts:s,timeout:e,elapse:s-i.startTime});this.send({type:tn.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re({},s),{},{eventType:Bn.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-i.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:tn.PUBLISH,data:a},!0)}subscribe(t,e,i){const s=this.baseInfoMap.get(t);if(!s)return;const r=s.info,a=Date.now(),c=re(re({},r),{},{eventType:Bn.SUBSCRIBE,lts:a,eventElapse:e.eventElapse,elapse:a-s.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:tn.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const i=[...bs(e=this.baseInfoMap).call(e)],s=i.length?i[0]:"UnableToGetSid",r=this.baseInfoMap.get(s);if(!r)return;const a=r.info,c=Date.now(),l=re(re({},a),{},{eventType:Bn.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:tn.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,i,s){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=re(re(re({},a),s),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max(c-r.startTime,0),apEnd:Math.max(s.apEnd-r.startTime,0),apStart:Math.max(s.apStart-r.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-r.startTime,0),joinGwStart:Math.max(s.joinGwStart-r.startTime,0),pcEnd:Math.max(s.pcEnd-r.startTime,0),pcStart:Math.max(s.pcStart-r.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-r.startTime,0),subscriberStart:Math.max(s.subscriberStart-r.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-r.startTime,0)});this.send({type:i,data:l},!0)}firstRemoteFrame(t,e,i,s){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=re(re(re({},a),s),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:i,data:l},!0)}pcStats(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re(re({},s),e),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:r-i.startTime,eventType:Bn.PC_STATS,lts:r});this.send({type:tn.PC_STATS,data:a},!0)}onGatewayStream(t,e,i,s){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=re(re(re({},a),s),{},{eventType:e,lts:c});this.send({type:i,data:l},!0)}streamSwitch(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re({},s),{},{eventType:Bn.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-i.startTime,success:e.succ});this.send({type:tn.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re({},s),{},{eventType:Bn.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-i.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:tn.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re({},s),{},{eventType:Bn.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-i.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:tn.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(t){this.proxyServer=t,t?v.debug("reportProxyServerurl: ".concat(t)):v.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re({},s),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-i.startTime,joinChannelSuccessElapse:r-(i.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:tn.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now();(function(c,l,u){const h=c[l];if(!h||typeof h!="string")return[c];c[l]="";const f=ho(JSON.stringify(c));let g=0;const S=[];let w=0;for(let I=0;I<h.length;I++)w+=h.charCodeAt(I)<=127?1:3,w<=u-f||(S[S.length]=wc(wc({},c),{},{[l]:h.substring(g,I)}),g=I,w=h.charCodeAt(I)<=127?1:3);return g!==h.length-1&&(S[S.length]=wc(wc({},c),{},{[l]:h.substring(g)})),S})(re(re(re({},s),e),{},{elapse:r-i.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:tn.WORKER_EVENT,data:c},!0))}apworkerEvent(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re(re({},s),e),{},{elapse:r-i.startTime,lts:r});this.send({type:tn.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re(re({},s),e),{},{elapse:r-i.startTime,lts:r,extend:e.extend||void 0});this.send({type:tn.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,r=Date.now(),a=re(re(re({},s),e),{},{elapse:r-i.startTime,lts:r});this.send({type:tn.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>U("CUSTOM_REPORT_LIMIT"))throw new Q(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),s=e.map(r=>({type:tn.USER_ANALYTICS,data:re(re({sid:t},r),{},{lts:i})}));try{U("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(r){throw v.error("send custom report message failed",r.toString()),new Q(O.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=U("NOT_REPORT_EVENT");if(t.tag&&Vt(e)&&Vt(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const i=this.baseInfoMap.get(t.sid);if(!i)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:s,uid:r,cid:a}=i.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Q){const{code:u,message:h}=t.error;c=u||h||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:s,cid:a,uid:r,lts:t.lts,success:t.success,elapse:t.lts-i.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:tn.API_INVOKE,data:l},!1),!0}appendSessionId(){ku.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){const e=this.apiInvokeUploadPendingItems.length;for(let i=0;i<e;i++){const s=this.apiInvokeUploadPendingItems.shift();s&&(s.sid=t._sessionId,this.sendApiInvoke(Object.assign({},s)))}}})}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>U("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const i=[],s=[];for(;t.length;){const a=t.shift();i.length<20?i.push(a):s.push(a)}t.push(...s);for(const a of[...i]){var r;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),Su(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),U("ENABLE_EVENT_REPORT")&&i.length&&(U("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((a=>c=>{U("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>U("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-U("NORMAL_EVENT_QUEUE_CAPACITY")),v.warning("report: drop normal events"))))})(i)),t}async postDataToStatsCollector2(t){yn.networkState===wi.OFFLINE&&await K.race([yn.onlineWaiter,ri(2*In.maxRetryTimeout)]);const e=r=>{let a=new Uint8Array;return r.forEach(c=>{const l=qg(JSON.stringify(c.data)),u=new ArrayBuffer(5),h=(g=>{let S=0;return Object.entries(tn).forEach(w=>{let[I,b]=w;b===g.type&&(S=EventNameToID[I])}),S})(c),f=new DataView(u);f.setUint16(0,l.byteLength,!0),f.setUint8(2,255&h),f.setUint8(3,h>>>8&255),f.setUint8(4,h>>>16&255),a=cb(a,new Uint8Array(u)),a=cb(a,l)}),a},i="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(U("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let r=0;r<2;r+=1){r===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(U("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await mT(s,{timeout:1e4,data:e(t),headers:re(re({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(r===1)throw a;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(a=>JSON.stringify(a)),vid:(a=>{const c=a&&a.data.sid&&this.baseInfoMap.get(a.data.sid);return c&&c.info.vid&&+c.info.vid||0})(t[0])};yn.networkState===wi.OFFLINE&&await K.race([yn.onlineWaiter,ri(2*In.maxRetryTimeout)]);const s=e?"/events/proto-raws":"/events/messages";let r=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("EVENT_REPORT_DOMAIN"),"&p=").concat(U("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(U("EVENT_REPORT_DOMAIN"),":").concat(U("STATS_COLLECTOR_PORT")).concat(s));for(let a=0;a<2;a+=1){a===1&&(r=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(U("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(U("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(U("STATS_COLLECTOR_PORT")).concat(s)));try{e?await FB(r,{timeout:1e4,data:i}):await mT(r,{timeout:1e4,data:i})}catch(c){if(a===1)throw c;continue}return}}createBaseInfo(t,e){const i=Object.assign({},HB);return i.sid=t,this.baseInfoMap.set(t,{info:i,startTime:e}),i}reportResourceTiming(t,e){const i=performance.getEntriesByName(t),s=i[i.length-1];s&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:s,tag:sn.TRACER}).onSuccess()}}function Ft(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,e,i){const s=i.value;if(typeof s=="function"){const r=n.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];let u=c;if(n.argsMap)try{u=n.argsMap(this,...c)}catch(f){v.warning(f),u=[]}try{JSON.stringify(u)}catch{v.warning("arguments for method ".concat(r,".").concat(String(e)," not serializable for apiInvoke.")),u=[]}const h=(n.report||wt).reportApiInvoke(this._sessionId||null,{name:"".concat(r,".").concat(String(e)),options:u,tag:sn.TRACER,reportResult:n.reportResult},n.throttleTime);try{const f=s.apply(this,c);return f instanceof K?f.then(g=>(h.onSuccess(n.reportResult&&g),g)).catch(g=>{throw h.onError(g),g}):(h.onSuccess(n.reportResult&&f),f)}catch(f){throw h.onError(f),f}}}return i}}m(ku,"__CLIENT_LIST__",[]);const wt=new ku;vf.on("REPORT_LOG_UPLOAD",n=>{n.networkState=yn.networkState,wt.reportApiInvoke(null,{name:"logUploadError",options:n,tag:sn.TRACER})});const KB=["CHINA","GLOBAL"],ws=function(){const n="us".concat("erna","me"),t="pa".concat("sswo","rd"),e=["t","s","t"];e.splice(1,0,"e");const i=e.join(""),s=[];for(let c=0;c<6;c++)s.push("1");const r=s.join(""),a={};return a[n]=i,a[t]=r,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ws,ET||(Mi.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Mi.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Mi.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Mi.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Mi.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Mi.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Mi.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Mi.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Mi.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Mi.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Mi.AREAS=["NORTH_AMERICA","OVERSEA"]);const RA=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Oa=[];function Pc(n,t){return!!t&&Oa.some(e=>e.uid===n&&e.channelName===t)}ku.__CLIENT_LIST__=Oa;var ST,ts,Kd,Mu,Os,gi,Ut,oe,ht,At,es,Jt,IA,qd,Ht,Mn,Na,qB=Sc("Array").values,YB=vc,zB=Ai,JB=En,XB=qB,vT=Array.prototype,$B={DOMTokenList:!0,NodeList:!0},po=st(function(n){var t=n.values;return n===vT||JB(vT,n)&&t===vT.values||zB($B,YB(n))?XB:t});function tt(n,t,e,i){var s,r=arguments.length,a=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(n,t,e,i);else for(var c=n.length-1;c>=0;c--)(s=n[c])&&(a=(r<3?s(a):r>3?s(t,e,a):s(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a}function A(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}(function(n){n.L1T1="L1T1",n.L1T2="L1T2",n.L1T3="L1T3",n.L2T1_KEY="L2T1_KEY",n.L2T2_KEY="L2T2_KEY",n.L2T3_KEY="L2T3_KEY",n.L3T1_KEY="L3T1_KEY",n.L3T2_KEY="L3T2_KEY",n.L3T3_KEY="L3T3_KEY"})(ST||(ST={})),function(n){n.CERTIFICATE="certificate",n.CODEC="codec",n.CANDIDATE_PAIR="candidate-pair",n.LOCAL_CANDIDATE="local-candidate",n.REMOTE_CANDIDATE="remote-candidate",n.INBOUND="inbound-rtp",n.TRACK="track",n.OUTBOUND="outbound-rtp",n.PC="peer-connection",n.REMOTE_INBOUND="remote-inbound-rtp",n.REMOTE_OUTBOUND="remote-outbound-rtp",n.TRANSPORT="transport",n.CSRC="csrc",n.DATA_CHANNEL="data-channel",n.STREAM="stream",n.SENDER="sender",n.RECEIVER="receiver"}(ts||(ts={})),function(n){n[n.ACCESS_POINT=101]="ACCESS_POINT",n[n.UNILBS=201]="UNILBS",n[n.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Kd||(Kd={})),function(n){n[n.IIIEGAL_APPID=1]="IIIEGAL_APPID",n[n.IIIEGAL_UID=2]="IIIEGAL_UID",n[n.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Mu||(Mu={})),function(n){n[n.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",n[n.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",n[n.INTERNAL_ERROR=8]="INTERNAL_ERROR",n[n.NO_AUTHORIZED=9]="NO_AUTHORIZED",n[n.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",n[n.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",n[n.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",n[n.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",n[n.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",n[n.USER_OVERLOAD=16]="USER_OVERLOAD",n[n.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",n[n.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Os||(Os={})),function(n){n[n.NO_FLAG_SET=100]="NO_FLAG_SET",n[n.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",n[n.INVALID_FALG_SET=102]="INVALID_FALG_SET",n[n.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",n[n.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",n[n.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",n[n.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",n[n.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",n[n.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",n[n.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",n[n.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",n[n.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",n[n.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",n[n.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",n[n.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",n[n.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",n[n.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",n[n.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",n[n.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(gi||(gi={})),function(n){n[n.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",n[n.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",n[n.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",n[n.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",n[n.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",n[n.K_TICKET_INVALID=7]="K_TICKET_INVALID",n[n.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",n[n.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",n[n.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",n[n.K_UID_BANNED=14]="K_UID_BANNED",n[n.K_IP_BANNED=15]="K_IP_BANNED",n[n.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",n[n.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",n[n.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",n[n.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",n[n.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",n[n.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",n[n.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",n[n.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",n[n.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",n[n.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",n[n.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",n[n.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",n[n.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",n[n.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",n[n.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",n[n.ERR_INVALID_UID=117]="ERR_INVALID_UID",n[n.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",n[n.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",n[n.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",n[n.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",n[n.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",n[n.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",n[n.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",n[n.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",n[n.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",n[n.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",n[n.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",n[n.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",n[n.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",n[n.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",n[n.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",n[n.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",n[n.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",n[n.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",n[n.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",n[n.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",n[n.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",n[n.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",n[n.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",n[n.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",n[n.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",n[n.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",n[n.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",n[n.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",n[n.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",n[n.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",n[n.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",n[n.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",n[n.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",n[n.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",n[n.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",n[n.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",n[n.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ut||(Ut={})),function(n){n.CONNECTING="connecting",n.CONNECTED="connected",n.RECONNECTING="reconnecting",n.CLOSED="closed"}(oe||(oe={})),function(n){n.WS_CONNECTED="ws_connected",n.WS_RECONNECTING="ws_reconnecting",n.WS_CLOSED="ws_closed",n.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",n.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",n.ON_BINARY_DATA="on_binary_data",n.REQUEST_RECOVER="request_recover",n.REQUEST_JOIN_INFO="request_join_info",n.REQUEST_REJOIN_INFO="req_rejoin_info",n.IS_P2P_DISCONNECTED="is_p2p_dis",n.DISCONNECT_P2P="dis_p2p",n.ABORT_P2P_EXECUTION="abort_p2p_execution",n.NEED_RENEW_SESSION="need-sid",n.REPORT_JOIN_GATEWAY="report_join_gateway",n.REQUEST_TIMEOUT="request_timeout",n.REQUEST_SUCCESS="request_success",n.JOIN_RESPONSE="join_response",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_CONNECTING="datachannel_connecting",n.DATACHANNEL_FAILBACK="datachannel_failback",n.P2P_START="p2p_start",n.P2P_CONNECTION="p2p_connection",n.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",n.P2P_SUBSCRIBE="p2p_subscribe",n.P2P_UNSUBSCRIBE="p2p_unsubscribe",n.P2P_EXCHANGE_SDP="p2p_exchange_sdp",n.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",n.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(ht||(ht={})),function(n){n.PING="ping",n.PING_BACK="ping_back",n.JOIN="join_v3",n.REJOIN="rejoin_v3",n.LEAVE="leave",n.SET_CLIENT_ROLE="set_client_role",n.PUBLISH="publish",n.PUBLISH_DATASTREAM="publish_datastream",n.UNPUBLISH="unpublish",n.UNPUBLISH_DATASTREAM="unpublish_datastream",n.SUBSCRIBE="subscribe",n.SUBSCRIBE_DATASTREAM="subscribe_datastream",n.SUBSCRIBE_STREAMS="subscribe_streams",n.UNSUBSCRIBE="unsubscribe",n.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",n.UNSUBSCRIBE_STREAMS="unsubscribe_streams",n.SUBSCRIBE_CHANGE="subscribe_change",n.TRAFFIC_STATS="traffic_stats",n.RENEW_TOKEN="renew_token",n.SWITCH_VIDEO_STREAM="switch_video_stream",n.DEFAULT_VIDEO_STREAM="default_video_stream",n.SET_FALLBACK_OPTION="set_fallback_option",n.GATEWAY_INFO="gateway_info",n.CONTROL="control",n.SEND_METADATA="send_metadata",n.DATA_STREAM="data_stream",n.PICK_SVC_LAYER="pick_svc_layer",n.RESTART_ICE="restart_ice",n.CONNECT_PC="connect_pc",n.SET_VIDEO_PROFILE="set_video_profile",n.SET_PARAMETER="set_parameter",n.SET_RTM2_FLAG="set_rtm2_flag"}(At||(At={})),function(n){n.PUBLISH_STATS="publish_stats",n.PUBLISH_RELATED_STATS="publish_related_stats",n.SUBSCRIBE_STATS="subscribe_stats",n.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",n.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",n.DENOISER_STATS="denoiser_stats",n.TRANSPORT_STATS="transport_stats",n.EXTENSION_USAGE_STATS="extension_usage_stats"}(es||(es={})),function(n){n.ON_USER_ONLINE="on_user_online",n.ON_USER_OFFLINE="on_user_offline",n.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",n.ON_PUBLISH_STREAM="on_publish_stream",n.ON_UPLINK_STATS="on_uplink_stats",n.ON_P2P_LOST="on_p2p_lost",n.ON_REMOVE_STREAM="on_remove_stream",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",n.ON_USER_BANNED="on_user_banned",n.ON_USER_LICENSE_BANNED="on_user_license_banned",n.ON_NOTIFICATION="on_notification",n.ON_CRYPT_ERROR="on_crypt_error",n.MUTE_AUDIO="mute_audio",n.MUTE_VIDEO="mute_video",n.UNMUTE_AUDIO="unmute_audio",n.UNMUTE_VIDEO="unmute_video",n.ON_P2P_OK="on_p2p_ok",n.RECEIVE_METADATA="receive_metadata",n.ON_DATA_STREAM="on_data_stream",n.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",n.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",n.ENABLE_LOCAL_VIDEO="enable_local_video",n.DISABLE_LOCAL_VIDEO="disable_local_video",n.ENABLE_LOCAL_AUDIO="enable_local_audio",n.DISABLE_LOCAL_AUDIO="disable_local_audio",n.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Jt||(Jt={})),function(n){n.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",n.NEED_ANSWER="NEED_ANSWER",n.NEED_RENEGOTIATE="NEED_RENEGOTIATE",n.P2P_LOST="P2P_LOST",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NEED_UNPUB="NEED_UNPUB",n.NEED_UNSUB="NEED_UNSUB",n.NEED_UPLOAD="NEED_UPLOAD",n.NEED_CONTROL="NEED_CONTROL",n.START_RECONNECT="START_RECONNECT",n.END_RECONNECT="END_RECONNECT",n.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(IA||(IA={})),function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"}(qd||(qd={})),function(n){n.CONNECTED="websocket:connected",n.RECONNECTING="websocket:reconnecting",n.WILL_RECONNECT="websocket:will_reconnect",n.CLOSED="websocket:closed",n.FAILED="websocket:failed",n.ON_MESSAGE="websocket:on_message",n.REQUEST_NEW_URLS="websocket:request_new_urls",n.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Ht||(Ht={}));class j extends Q{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),m(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,v)}throw(){super.throw(v)}}function CT(n){if(typeof n!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n))throw v.error("Invalid Channel Name ".concat(n)),new j(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function yT(n){if(t=n,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||sb(n,1,255)))throw new j(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof n=="string"&&v.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(n){n.TRANSCODE="mix_streaming",n.RAW="raw_streaming",n.INJECT="inject_streaming"})(Mn||(Mn={})),function(n){n[n.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",n[n.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",n[n.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",n[n.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",n[n.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",n[n.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",n[n.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",n[n.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",n[n.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Na||(Na={}));const QB={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},RT={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function IT(n,t){ai(n.url,"".concat(t,".url"),1,1e3,!1),nn(n.x)||Fe(n.x,"".concat(t,".x"),0,1e4),nn(n.y)||Fe(n.y,"".concat(t,".y"),0,1e4),nn(n.width)||Fe(n.width,"".concat(t,".width"),0,1e4),nn(n.height)||Fe(n.height,"".concat(t,".height"),0,1e4),nn(n.zOrder)||Fe(n.zOrder,"".concat(t,".zOrder"),0,255),nn(n.alpha)||Fe(n.alpha,"".concat(t,".alpha"),0,1,!1)}const ZB={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},tj={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var Er,Yd,gn,bA,Ti,xr,Ui,Da,ke,cn,Lc,On,yf,ge;function AA(n){if(!n.channelName)throw new j(O.INVALID_PARAMS,"invalid channelName in info");if(typeof n.uid!="number")throw new j(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return n.token&&ai(n.token,"info.token",1,2047),yT(n.uid),CT(n.channelName),!0}(function(n){n.WARNING="@live_uap-warning",n.ERROR="@line_uap-error",n.PUBLISH_STREAM_STATUS="@live_uap-publish-status",n.INJECT_STREAM_STATUS="@live_uap-inject-status",n.WORKER_STATUS="@live_uap-worker-status",n.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Er||(Er={})),function(n){n.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(Yd||(Yd={})),function(n){n[n.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",n[n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",n[n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",n[n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",n[n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",n[n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",n[n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",n[n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",n[n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",n[n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",n[n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",n[n.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",n[n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",n[n.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",n[n.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",n[n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(gn||(gn={})),function(n){n.CONNECT_FAILED="connect failed",n.CONNECT_TIMEOUT="connect timeout",n.WS_DISCONNECTED="websocket disconnected",n.REQUEST_TIMEOUT="request timeout",n.REQUEST_FAILED="request failed",n.WAIT_STATUS_TIMEOUT="wait status timeout",n.WAIT_STATUS_ERROR="wait status error",n.BAD_STATE="bad state",n.WS_ABORT="ws abort",n.AP_REQUEST_TIMEOUT="AP request timeout",n.AP_JSON_PARSE_ERROR="AP json parse error",n.AP_REQUEST_ERROR="AP request error",n.AP_REQUEST_ABORT="AP request abort"}(bA||(bA={})),function(n){n[n.SetSdkProfile=0]="SetSdkProfile",n[n.SetSourceChannel=1]="SetSourceChannel",n[n.SetSourceUserId=2]="SetSourceUserId",n[n.SetDestChannel=3]="SetDestChannel",n[n.StartPacketTransfer=4]="StartPacketTransfer",n[n.StopPacketTransfer=5]="StopPacketTransfer",n[n.UpdateDestChannel=6]="UpdateDestChannel",n[n.Reconnect=7]="Reconnect",n[n.SetVideoProfile=8]="SetVideoProfile"}(Ti||(Ti={})),function(n){n.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",n.NETWORK_CONNECTED="NETWORK_CONNECTED",n.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",n.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",n.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",n.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",n.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",n.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",n.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",n.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(xr||(xr={})),function(n){n.RELAY_STATE_IDLE="RELAY_STATE_IDLE",n.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",n.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",n.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Ui||(Ui={})),function(n){n.RELAY_OK="RELAY_OK",n.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",n.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",n.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Da||(Da={})),function(n){n.High="high",n.Low="low",n.Audio="audio",n.Screen="screen",n.ScreenLow="screen_low"}(ke||(ke={})),function(n){n.DISCONNECT="disconnect",n.CONNECTION_STATE_CHANGE="connection-state-change",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGE="stream-type-change",n.IS_P2P_DISCONNECTED="is-p2p-dis",n.DISCONNECT_P2P="dis-p2p",n.REQUEST_NEW_GATEWAY_LIST="req-gate-url",n.NEED_RENEW_SESSION="need-sid",n.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",n.JOIN_RESPONSE="join-response",n.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",n.RESET_CONNECTION_EVENTS="reset-connection-events",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_FAILBACK="datachannel_failback",n.RESET_SIGNAL="reset-signal"}(cn||(cn={})),function(n){n.P2P_DISCONNECTED="P2P_DISCONNECTED",n.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",n.TIMEOUT="TIMEOUT",n.UNKNOWN_REASON="UNKNOWN_REASON"}(Lc||(Lc={})),function(n){n[n.Nothing=0]="Nothing",n[n.Audio=1]="Audio",n[n.LwoVideo=2]="LwoVideo",n[n.Video=4]="Video",n[n.Data=8]="Data",n[n.DataStream0=256]="DataStream0",n[n.DataStream1=512]="DataStream1",n[n.DataStream2=1024]="DataStream2",n[n.DataStream3=2048]="DataStream3",n[n.DataStream4=4096]="DataStream4",n[n.DataStream5=8192]="DataStream5",n[n.DataStream6=16384]="DataStream6",n[n.DataStream7=32768]="DataStream7"}(On||(On={})),function(n){n[n.websocket=0]="websocket",n[n.datachannel=1]="datachannel"}(yf||(yf={})),function(n){n.CHINA="CHINA",n.ASIA="ASIA",n.NORTH_AMERICA="NORTH_AMERICA",n.EUROPE="EUROPE",n.JAPAN="JAPAN",n.INDIA="INDIA",n.KOREA="KOREA",n.HKMC="HKMC",n.US="US",n.OCEANIA="OCEANIA",n.SOUTH_AMERICA="SOUTH_AMERICA",n.AFRICA="AFRICA",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="EXTENSIONS"}(ge||(ge={}));const wA=[ge.AFRICA,ge.ASIA,ge.CHINA,ge.EUROPE,ge.GLOBAL,ge.INDIA,ge.JAPAN,ge.NORTH_AMERICA,ge.OCEANIA,ge.OVERSEA,ge.SOUTH_AMERICA];var ni;(function(n){n.CHINA="CN",n.ASIA="AS",n.NORTH_AMERICA="NA",n.EUROPE="EU",n.JAPAN="JP",n.INDIA="IN",n.KOREA="KR",n.HKMC="HK",n.US="US",n.OCEANIA="OC",n.SOUTH_AMERICA="SA",n.AFRICA="AF",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="GLOBAL"})(ni||(ni={}));const Rf={CHINA:{},ASIA:{CODE:ni.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ni.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ni.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ni.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ni.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ni.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ni.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ni.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ni.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ni.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ni.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ni.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ni.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var Uu,OA,yt,ci,Vr,it,Te,xt,NA,Ns,Ds,Un,fo,hn,Fr,DA,hs,Xs,Pa,qe,_o,PA;ET&&(Rf.CHINA={CODE:ni.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(n){n.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Uu||(Uu={}));class LA extends Ze{constructor(t,e){super(),m(this,"onICEConnectionStateChange",void 0),m(this,"onConnectionStateChange",void 0),m(this,"onDTLSTransportStateChange",void 0),m(this,"onDTLSTransportError",void 0),m(this,"onICETransportStateChange",void 0),m(this,"onFirstAudioReceived",void 0),m(this,"onFirstVideoReceived",void 0),m(this,"onFirstAudioDecoded",void 0),m(this,"onFirstVideoDecoded",void 0),m(this,"onFirstVideoDecodedTimeout",void 0),m(this,"onSelectedLocalCandidateChanged",void 0),m(this,"onSelectedRemoteCandidateChanged",void 0)}}class If extends LA{constructor(t,e){super(t,e)}}(function(n){n.SEND="sendonly",n.RECV="recvonly",n.SENDRECV="sendrecv",n.INACTIVE="inactive"})(OA||(OA={})),function(n){n.VIDEO="video",n.AUDIO="audio"}(yt||(yt={})),function(n){n[n.UDP=0]="UDP",n[n.TCP=1]="TCP",n[n.RELAY=2]="RELAY"}(ci||(ci={})),function(n){n[n.FIRST_CONNECTION=0]="FIRST_CONNECTION",n[n.TCP_RESTART=1]="TCP_RESTART",n[n.RELAY_RESTART=2]="RELAY_RESTART",n[n.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",n[n.OLD_RESTART=11]="OLD_RESTART",n[n.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Vr||(Vr={})),function(n){n.LocalVideoTrack="videoTrack",n.LocalAudioTrack="audioTrack",n.LocalVideoLowTrack="videoLowTrack"}(it||(it={})),function(n){n.New="new",n.Connected="connected",n.Reconnecting="reconnecting",n.Disconnected="disconnected"}(Te||(Te={})),function(n){n.StateChange="stateChange",n.IceConnectionStateChange="iceConnectionStateChange",n.RequestMuteLocal="requestMuteLocal",n.RequestUnmuteLocal="requestUnmuteLocal",n.RequestRePublish="requestRePublish",n.RequestRePublishDataChannel="requestRePublishDataChannel",n.RequestReSubscribe="requestReSubscribe",n.RequestUploadStats="requestUploadStats",n.MediaReconnectStart="MediaReconnectStart",n.MediaReconnectEnd="MediaReconnectEnd",n.NeedSignalRTT="NeedSignalRTT",n.RequestRestartICE="RequestRestartIce",n.PeerConnectionStateChange="PeerConnectionStateChange",n.RequestReconnect="RequestReconnect",n.RequestReconnectPC="RequestReconnectPC",n.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",n.P2PLost="P2PLost",n.UpdateVideoEncoder="UpdateVideoEncoder",n.ConnectionTypeChange="ConnectionTypeChange",n.RequestLowStreamParameter="RequestLowStreamParameter",n.QueryClientConnectionState="QueryClientConnectionState",n.LocalCandidate="LocalCandidate",n.RequestP2PMuteLocal="requestP2PMuteLocal",n.RequestP2PPublish="RequestP2PPublish",n.RequestP2PUnPublish="RequestP2PUnPublish",n.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",n.RequestP2PMuteRemote="RequestP2PMuteRemote",n.RequestP2PRestartICE="RequestP2PRestartICE"}(xt||(xt={})),function(n){n.MUTE_LOCAL_VIDEO="mute_local_video",n.MUTE_LOCAL_AUDIO="mute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.MUTE_REMOTE_VIDEO="mute_remote_video",n.MUTE_REMOTE_AUDIO="mute_remote_audio",n.UNMUTE_REMOTE_VIDEO="unmute_remote_video",n.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(NA||(NA={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(Ns||(Ns={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(Ds||(Ds={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Un||(Un={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}(fo||(fo={})),function(n){n.CONNECTED="transmitter:connected",n.RECONNECTING="transmitter:reconnecting",n.WILL_RECONNECT="transmitter:will_reconnect",n.CLOSED="transmitter:closed",n.FAILED="transmitter:failed",n.ON_MESSAGE="transmitter:on_message",n.REQUEST_NEW_URLS="transmitter:request_new_urls",n.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",n.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",n.FAILBACK="transmitter:failback"}(hn||(hn={})),function(n){n.CAMERA_CHANGED="camera-changed",n.MICROPHONE_CHANGED="microphone-changed",n.PLAYBACK_DEVICE_CHANGED="playback-device-changed",n.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",n.AUTOPLAY_FAILED="autoplay-failed",n.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Fr||(Fr={})),function(n){n[n.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",n[n.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",n[n.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",n[n.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",n[n.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",n[n.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",n[n.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",n[n.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",n[n.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",n[n.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",n[n.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",n[n.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",n[n.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",n[n.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",n[n.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",n[n.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",n[n.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",n[n.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",n[n.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",n[n.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(DA||(DA={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(hs||(hs={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Xs||(Xs={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(Pa||(Pa={})),function(n){n.CALL="call",n.CANDIDATE="candidate",n.PUBLISH="publish",n.UNPUBLISH="unpublish",n.SUBSCRIBE="subscribe",n.UNSUBSCRIBE="unsubscribe",n.CONTROL="control",n.RESTART_ICE="restart_ice",n.ACK="ack",n.JOIN="join",n.EXCHANGE_SDP="exchange_sdp",n.DO_SUBSCRIBE="do_subscribe",n.DO_UNSUBSCRIBE="do_unsubscribe"}(qe||(qe={})),function(n){n.MUTE_LOCAL_AUDIO="mute_local_audio",n.MUTE_LOCAL_VIDEO="mute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(_o||(_o={})),function(n){n[n.SUCCESS=1]="SUCCESS",n[n.FAILED=0]="FAILED"}(PA||(PA={}));const ej={[Kd.ACCESS_POINT]:{[gi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[gi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[gi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[gi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[gi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[gi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Kd.UNILBS]:{[Os.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Os.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Os.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Os.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Os.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Os.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Os.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Os.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Os.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Os.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Os.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Os.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Kd.STRING_UID_ALLOCATOR]:{[Mu.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Mu.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Mu.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function bf(n){const t=ej[Math.floor(n/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const e=t[n%1e4];if(!e){if(Math.floor(n/1e4)===Kd.ACCESS_POINT){const i=n%1e4;if(i.toString()[0]==="1")return{desc:n.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:n.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return e}const nj={[Ut.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ut.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ut.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ut.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ut.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ut.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ut.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ut.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ut.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ut.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ut.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ut.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ut.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ut.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ut.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ut.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ut.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ut.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ut.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ut.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ut.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ut.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ut.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ut.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ut.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ut.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ut.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ut.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ut.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ut.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ut.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ut.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ut.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ut.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ut.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ut.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ut.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ut.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ut.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ut.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ut.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ut.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ut.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ut.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ut.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ut.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ut.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ut.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ut.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ut.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ut.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ut.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ut.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ut.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ut.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ut.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ut.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ut.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ut.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ut.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ut.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ut.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ut.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function kc(n){return nj[n]||{desc:"UNKNOW_ERROR_".concat(n),action:"failed"}}function kA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function bT(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?kA(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):kA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function MA(n){return n.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function UA(n,t){if(typeof n=="string")return n;const{proxy:e,host:i,port:s}=n;if(t){const r=U("JOIN_GATEWAY_FALLBACK_PORT")||443;return r===443?"wss://".concat(i,"/ws/?p=").concat(Number(s)+150):"wss://".concat(i,":").concat(r,"/ws/?p=").concat(Number(s)+150)}return e?"wss://".concat(e,"/ws/?h=").concat(i,"&p=").concat(s):"wss://".concat(i,":").concat(s)}const ij=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,sj=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,rj=/wss:\/\/(.+):([0-9]+)\/?/,oj=/wss:\/\/(.[^\/]+)\/?/;let aj=0;class cj{constructor(t,e){m(this,"id",0),m(this,"store",void 0),m(this,"recordIndex",void 0),m(this,"websockets",[]),m(this,"try443PortDuration",2e3),m(this,"forceCloseWSDuration",5e3),m(this,"try443PortTimeout",null),m(this,"forceCloseTimeout",null),m(this,"isTry443PortFailed",!1),m(this,"isNormalPortFailed",!1),m(this,"useDoubleDomain",!1),m(this,"useProxy",!1),m(this,"startTime",Date.now()),this.id=++aj,this.try443PortDuration=U("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=e}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;const e=Date.now()-this.startTime;for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];v.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(e,"ms:"),...s)}createWebSocket(t,e,i){this.logger("createWebSocket:",t,{isTry443Port:e,hasTimeoutDetection:i});const s=U("GATEWAY_DOMAINS"),r=Date.now(),a=[],c=s.find(h=>{var f;return Vt(f=t.host).call(f,h)});c||(this.useDoubleDomain=!1);const l=[];if(this.useDoubleDomain)s.forEach(h=>{l.push(UA(bT(bT({},t),{},{host:t.host.replace(c,h)}),e))});else{const h=bT({},t);if(e&&c){const f=s.find(g=>g!==c);f&&(h.host=h.host.replace(c,f))}l.push(UA(h,e))}try{l.forEach(h=>{const f=new WebSocket(h);f.binaryType="arraybuffer",a.push(f),this.logger("ws is connecting:",f.url)})}catch(h){if(this.logger("ws create failed"),a.forEach(f=>f.close()),a.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,e,i);if(!e&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new j(O.WS_ERR,"init websocket failed! Error: ".concat(h.toString()))}const u=Ou();return this.store&&this.store.recordJoinChannelService({urls:a.map(h=>h.url),service:"gateway"},this.recordIndex),a.forEach(h=>{h.onopen=()=>{this.logger("onopen: ws ".concat(h.url," open cost ").concat(Date.now()-r,"ms")),this.websockets.forEach(f=>{f!==h&&(f.onopen=null,f.onclose=null,f.onmessage=null,f.close(),this.logger("close backup websocket: ".concat(f.url)))}),this.websockets.length=0,u.resolve(h)},h.onclose=f=>{this.logger("onclose: ws ".concat(h.url," closed cost ").concat(Date.now()-r,"ms state: ").concat(h.readyState)),e?this.isTry443PortFailed=MA(a):this.isNormalPortFailed=MA(a),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(e&&this.isTry443PortFailed||!e&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(f.reason)),u.reject({code:f.code,reason:Lc.A_ROUND_WS_FAILED}))},h.onmessage=f=>this.logger("".concat(h.url," onmessage: ").concat(f.data))}),this.websockets.push(...a),i||(()=>{const h=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u.isResolved),this.websockets.forEach(f=>f.readyState!==WebSocket.OPEN&&f.close())};if(e||this.useProxy)return this.logger("add 5s timeout at ".concat(e?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(h,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",u.isResolved),u.isResolved)return h();we().os===Kn.MAC_OS&&$e()&&h(),this.createWebSocket(t,!0,!0).then(f=>u.resolve(f)).catch(f=>{this.isNormalPortFailed&&u.reject(f),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(h,this.forceCloseWSDuration)},this.try443PortDuration)})(),u.promise}chooseBestWebsocket(t,e,i,s){return this.useDoubleDomain=!!e,typeof t=="string"&&(t=function(r){let a,c,l;return[,a,c,l]=r.match(ij)||[],a||([,c,l]=r.match(sj)||[]),c&&l||([,c,l]=r.match(rj)||[]),c&&l||([,c]=r.match(oj)||[]),c||v.warning("un-destructible url: ",r),{proxy:a,host:c,port:l||"443"}}(t)),this.recordIndex=s,this.useProxy=!!t.proxy,i&&this.useProxy&&(v.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function xA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}class VA extends Ze{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var e;Vt(e=["tryNext","recover"]).call(e,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ht.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ht.CONNECTED):this._state==="closed"?this.emit(Ht.CLOSED):this._state==="failed"&&this.emit(Ht.FAILED))}resetReconnectCount(t){v.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],r=arguments.length>4&&arguments[4]!==void 0&&arguments[4],a=arguments.length>5?arguments[5]:void 0;super(),m(this,"connectionID",0),m(this,"currentURLIndex",0),m(this,"urls",[]),m(this,"_reconnectMode","tryNext"),m(this,"reconnectReason",void 0),m(this,"_initMutex",new qn("websocket")),m(this,"name",void 0),m(this,"_state","closed"),m(this,"reconnectInterrupter",void 0),m(this,"websocket",void 0),m(this,"retryConfig",void 0),m(this,"reconnectCount",0),m(this,"forceCloseTimeout",5e3),m(this,"onlineReconnectListener",void 0),m(this,"useCompress",void 0),m(this,"tryDoubleDomain",!1),m(this,"use443PortOnly",!1),m(this,"wsInflateLength",0),m(this,"wsDeflateLength",0),m(this,"closeEstablishingWs",()=>{}),m(this,"store",void 0),m(this,"joinGatewayRecordIndex",void 0),this.store=a,this.name=t,this.retryConfig=function(f){for(var g=1;g<arguments.length;g++){var S=arguments[g]!=null?arguments[g]:{};g%2?xA(Object(S),!0).forEach(function(w){m(f,w,S[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(S)):xA(Object(S)).forEach(function(w){Object.defineProperty(f,w,Object.getOwnPropertyDescriptor(S,w))})}return f}({},e),this.useCompress=i,this.tryDoubleDomain=s,this.use443PortOnly=r;const{timeout:c,timeoutFactor:l}=e,u=Math.max(300,Math.floor(3*c/5)),h=Math.max(1.2,Math.floor(8*l)/10);wi.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h),yn.on(Yo.NETWORK_STATE_CHANGE,(f,g)=>{f!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(f)),f===wi.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}async init(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this.forceCloseTimeout=e,this.urls=t,this.state="connecting";try{const s=Ou(),r=this.urls[this.currentURLIndex];this.createWebSocketConnection(r).then(s.resolve).catch(s.reject),this.once(Ht.CLOSED,()=>{s.reject(new Q(O.WS_DISCONNECT))}),this.once(Ht.CONNECTED,s.resolve),await s.promise}catch{}finally{i()}}close(t,e){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;e?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,e){if(!this.websocket)return void v.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(e)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:e})}sendMessage(t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Q(O.WS_ABORT,"websocket is not ready");try{e||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new Q(O.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,e=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:e}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var e;const i=Ou();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=h=>{var f;(f=this.store)===null||f===void 0||f.signalChannelOpen(),v.debug("[".concat(this.name,"] websocket opened:"),h),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},r=async h=>{var f;if(v.debug("[".concat(this.name,"] websocket close ").concat((f=this.websocket)===null||f===void 0?void 0:f.url,", code: ").concat(h.code,", reason: ").concat(h.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new Q(O.WS_DISCONNECT,"websocket close: ".concat(h.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=h.reason,this.state="reconnecting");const g=us(this,Ht.WILL_RECONNECT,this.reconnectMode,h.reason)||this.reconnectMode,S=await this.reconnectWithAction(g);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!S)return i.reject(new Q(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(h.code))),this.close(!0);i.resolve()}},a=h=>{this.emit(Ht.ON_MESSAGE,h)},c=h=>{v.warn("[".concat(this.connectionID,"] ws open error ").concat(h))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),U("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=U("GATEWAY_WSS_ADDRESS")),v.debug("[".concat(this.name,"] start connect, url:"),t);const l=(e=this.store)===null||e===void 0?void 0:e.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u;const h=await this.chooseBestWebsocketConnection(t);this.websocket=h,s&&s(this.websocket.url),this.websocket.onclose=r,this.websocket.onmessage=a,this.websocket.onerror=c,(u=this.store)===null||u===void 0||u.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l}catch(h){const f=this.state==="closed",g=h instanceof Q,S=g&&h.code===O.WS_ABORT,w=g&&h.code===O.WS_ERR,I=g?h.message:h&&(h.reason||h.toString());v.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:S?"aborted":"error",errors:[h]},l),f||w?(i.reject(f?new Q(O.WS_DISCONNECT,"websocket is closed: ".concat(I)):new Q(O.WS_ERR,"init websocket failed: ".concat(I))),w&&v.error("[".concat(this.name,"] init websocket failed: ").concat(I))):r&&r(h)}return i.promise}async reconnectWithAction(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;v.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||yn.isOnline||!yn.onlineWaiter||(this.onlineReconnectListener=yn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,e){const a=uf(this.reconnectCount,this.retryConfig);v.debug("[".concat(this.name,"] wait ").concat(a,"ms to reconnect websocket, mode: ").concat(t)),await K.race([ri(a),this.onlineReconnectListener||new K(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const s=async(a,c)=>{this.emit(Ht.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(a)};try{if(t==="retry")this.emit(Ht.RECONNECT_WAITTING_FINISH,t),await s(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);v.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Ht.RECONNECT_WAITTING_FINISH,t),await s(this.urls[this.currentURLIndex],t)}else t==="recover"&&(v.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Ht.RECONNECT_WAITTING_FINISH,t),this.urls=await rn(this,Ht.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],t))}catch(a){var r;v.error("[".concat(this.name,"] reconnect failed ").concat(a&&a.toString()));const c=a==null||(r=a.data)===null||r===void 0?void 0:r.desc;return Array.isArray(c)&&Vt(c).call(c,"dynamic key expired")?(this.emit(Ht.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,e)}return!0}}class xu extends VA{constructor(t,e){super(t,e,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,e){const i=Ou(),s=function(a,c){return new cj(a,c)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),i.reject(new Q(O.WS_ABORT,"choose best websocket aborted"))};const r=U("GATEWAY_DOMAINS");return v.debug("[choose-best-ws] currentDomain: ",t,", domains: ",r,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,e).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Vu extends VA{constructor(t,e){super(t,e,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,e){return new K((i,s)=>{let r=!1;const a=[];this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),a.forEach(w=>{w.onclose=null,w.onopen=null,w.onmessage=null,w.close()}),s(new Q(O.WS_ABORT,"choose best websocket aborted"))};const c=U("GATEWAY_DOMAINS");let l;const u=t.indexOf("?h="),h=c.find(w=>u!==-1?Vt(t).call(t,w,u):Vt(t).call(t,w));v.debug("[choose-best-ws] currentDomain: ",h,", domains: ",c);let f=!this.tryDoubleDomain||!h;if(!f&&h){var g;const w=Date.now();try{c.forEach(I=>{const b=u===-1?t.replace(h,I):t.substr(0,u)+t.substr(u).replace(h,I),M=new WebSocket(b);M.binaryType="arraybuffer",a.push(M),v.debug("[choose-best-ws] ws is connecting:",M.url)})}catch{for(v.debug("[choose-best-ws] ws create failed, fallback to single url"),a.forEach(b=>b.close());a.length;)a.pop();f=!0}(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:a.map(I=>I.url),service:"gateway"},e),a.forEach(I=>{I.onopen=()=>{if(r)return;const b=Date.now()-w;v.debug("[choose-best-ws] ws open cost ".concat(b,"ms")),a.filter(M=>M!==I).forEach(M=>{v.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()}),r=!0,i(I)},I.onclose=b=>{l=b,!r&&(a.find(M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING))||(v.debug("[choose-best-ws] all websocket is closed"),r=!0,s(l)))},I.onmessage=b=>{v.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(b.data))}}),ri(this.forceCloseTimeout).then(()=>{a.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(f){var S;let w;v.debug("[choose-best-ws] use single url: ",t),(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:[t],service:"gateway"},e);try{w=new WebSocket(t),a.push(w),w.binaryType="arraybuffer"}catch(I){const b=new Q(O.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return v.error("[".concat(this.name,"]").concat(b)),void s(b)}w.onopen=()=>{i(w)},w.onclose=I=>{s(I)},w.onmessage=I=>{v.debug("[choose-best-ws]".concat(w.url," onmessage: ").concat(I.data))},ri(this.forceCloseTimeout).then(()=>{w&&w.readyState!==WebSocket.OPEN&&w.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class FA extends Ze{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===oe.CONNECTED?this.emit(ht.WS_CONNECTED):t===oe.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===oe.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),m(this,"_disconnectedReason",void 0),m(this,"_websocketReconnectReason",void 0),m(this,"_connectionState",oe.CLOSED),m(this,"reconnectToken",void 0),m(this,"websocket",void 0),m(this,"openConnectionTime",void 0),m(this,"clientId",void 0),m(this,"lastMsgTime",Date.now()),m(this,"uploadCache",[]),m(this,"uploadCacheInterval",void 0),m(this,"rttRolling",new Qg(5)),m(this,"pingpongTimer",void 0),m(this,"wsInflateDataTimer",void 0),m(this,"pingpongTimeoutCount",0),m(this,"joinResponse",void 0),m(this,"multiIpOption",void 0),m(this,"initError",void 0),m(this,"spec",void 0),m(this,"store",void 0),m(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const r="res-@".concat(s._id);this.emit(r,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===Jt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Jt.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(ce.UID_BANNED);break;case 15:this.close(ce.IP_BANNED);break;case 16:this.close(ce.CHANNEL_BANNED)}if(s._type===Jt.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Ut.ERR_LICENSE_MISSING:this.close(ce.LICENSE_MISSING);break;case Ut.ERR_LICENSE_EXPIRED:this.close(ce.LICENSE_EXPIRED);break;case Ut.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ce.LICENSE_MINUTES_EXCEEDED);break;case Ut.ERR_LICENSE_PERIOD_INVALID:this.close(ce.LICENSE_PERIOD_INVALID);break;case Ut.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ce.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ut.ERR_LICENSE_ILLEGAL:this.close(ce.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new xu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),e),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===oe.CONNECTED&&this.reconnect("retry",Fn.OFFLINE)})}async request(t,e,i,s){const r=Be(6,""),a={_id:r,_type:t,_message:e},c=this.websocket.connectionID,l=()=>new K((w,I)=>{if(this.connectionState===oe.CONNECTED)return w();const b=()=>{this.off(ht.WS_CLOSED,M),w()},M=()=>{this.off(ht.WS_CONNECTED,b),I(new j(O.WS_ABORT))};this.once(ht.WS_CONNECTED,b),this.once(ht.WS_CLOSED,M),t!==At.PUBLISH&&t!==At.SUBSCRIBE&&t!==At.UNSUBSCRIBE&&t!==At.UNPUBLISH&&t!==At.CONTROL&&t!==At.RESTART_ICE||this.once(ht.DISCONNECT_P2P,()=>{I(new j(O.DISCONNECT_P2P))}),t!==At.PUBLISH&&t!==At.RESTART_ICE||this.once(ht.ABORT_P2P_EXECUTION,()=>{I(new j(O.DISCONNECT_P2P))})});if(this.connectionState!==oe.CONNECTING&&this.connectionState!==oe.RECONNECTING||t===At.JOIN||t===At.REJOIN||await l(),this.websocket.sendMessage(a,!0),s)return;const u=new K((w,I)=>{let b=!1;const M=(V,Z)=>{b=!0,w({isSuccess:V==="success",message:Z||{}}),this.off(ht.WS_CLOSED,F),this.off(ht.WS_RECONNECTING,F),this.emit(ht.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(r),M);const F=()=>{I(new j(O.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,F),this.off(ht.WS_RECONNECTING,F),this.off("res-@".concat(r),M)};this.once(ht.WS_CLOSED,F),this.once(ht.WS_RECONNECTING,F),ri(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||b||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,e))})});let h=null;try{h=await u}catch(w){if(this.connectionState===oe.CLOSED||t===At.LEAVE)throw new j(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():t===At.JOIN||t===At.REJOIN?null:(await l(),await this.request(t,e))}if(h.isSuccess)return h.message;const f=Number(h.message.error_code||h.message.code),g=kc(f),S=new j(O.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(h.message.error_str),{code:f,data:h.message});return g.action==="success"?h.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(f,", message: ").concat(g.desc,", action: ").concat(g.action)),f===Ut.ERR_TOO_MANY_BROADCASTERS?((t===At.JOIN||t===At.REJOIN)&&(this.initError=S,this.close()),S.throw()):g.action==="failed"?S.throw():g.action==="quit"?(this.initError=S,this.close(),S.throw()):(f===Ut.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Fn.MULTI_IP)):this.reconnect(g.action,Fn.SERVER_ERROR),t===At.JOIN||t===At.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new K(i=>{const s=r=>{(!e||e(r))&&(this.off(t,s),i(r))};this.on(t,s)})}upload(t,e){const i={_type:t,_message:e};try{this.websocket.sendMessage(i)}catch{const r=U("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==oe.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},U("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const i={_type:t,_message:e};this.websocket.sendMessage(i)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new K((i,s)=>{this.once(ht.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ht.WS_CLOSED,()=>s(this.initError||new j(O.WS_ABORT))),this.connectionState=oe.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||ce.LEAVE,this.connectionState=oe.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===ce.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new xu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION);const t=await rn(this,ht.REQUEST_JOIN_INFO),e=await this.request(At.JOIN,t);if(!e)return this.emit(ht.REPORT_JOIN_GATEWAY,Lc.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=oe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new j(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=zo(this,ht.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const e=await this.request(At.REJOIN,t);return!!e&&(this.connectionState=oe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),e.peers&&e.peers.forEach(i=>{this.emit(Jt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Jt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Jt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Jt.MUTE_AUDIO,{uid:i.uid}):this.emit(Jt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Jt.MUTE_VIDEO,{uid:i.uid}):this.emit(Jt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Jt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Jt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Jt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Jt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Jt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const e=kc(t.code);if(e.action!=="success"){if(e.action!=="failed")return e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ce.UID_BANNED),void this.close()):void this.reconnect(e.action,Fn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=U("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>U("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Fn.TIMEOUT):this.request(At.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-e;this.rttRolling.add(i),U("REPORT_STATS")&&this.send(At.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:e}=this.websocket.getWsInflateData();t!==0&&e!==0&&this.upload(es.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ht.RECONNECT_WAITTING_FINISH,t=>{this.emit(ht.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Ht.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ht.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ht.CLOSED,()=>{this.connectionState=oe.CLOSED}),this.websocket.on(Ht.FAILED,()=>{this._disconnectedReason=ce.NETWORK_ERROR,this.connectionState=oe.CLOSED}),this.websocket.on(Ht.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===oe.CONNECTED?this.connectionState=oe.RECONNECTING:this.connectionState=oe.CONNECTING}),this.websocket.on(Ht.WILL_RECONNECT,(t,e,i)=>{const s=zo(this,ht.IS_P2P_DISCONNECTED),r=s||t!=="retry";s&&t==="retry"&&(v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",e=Lc.P2P_DISCONNECTED),r&&(v.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ht.REPORT_JOIN_GATEWAY,e||Lc.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P)),i(t)}),this.websocket.on(Ht.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Fn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t.message||t.code||Lc.UNKNOWN_REASON,this.url||""),t instanceof j&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ut.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Fn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Fn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ht.REQUEST_NEW_URLS,(t,e)=>{rn(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)}),this.websocket.on(Ht.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var BA=`	
\v\f\r                　\u2028\u2029\uFEFF`,dj=_a,lj=Wo,AT=BA,jA=Cn("".replace),uj=RegExp("^["+AT+"]+"),hj=RegExp("(^|[^"+AT+"])["+AT+"]+$"),wT=function(n){return function(t){var e=lj(dj(t));return 1&n&&(e=jA(e,uj,"")),2&n&&(e=jA(e,hj,"$1")),e}},pj={start:wT(1),end:wT(2),trim:wT(3)},fj=Zy.PROPER,_j=se,GA=BA,mj=pj.trim;C({target:"String",proto:!0,forced:function(n){return _j(function(){return!!GA[n]()||"​᠎"[n]()!=="​᠎"||fj&&GA[n].name!==n})}("trim")},{trim:function(){return mj(this)}});var Yn,zn,Ej=Sc("String").trim,gj=En,Tj=Ej,OT=String.prototype,NT=st(function(n){var t=n.trim;return typeof n=="string"||n===OT||gj(OT,n)&&t===OT.trim?Tj:t});function zd(n,t,e){return{sampleRate:n,stereo:t,bitrate:e}}function Se(n,t,e,i,s){return{width:n,height:t,frameRate:e,bitrateMin:i,bitrateMax:s}}function gr(n,t,e,i,s){return{width:{max:n},height:{max:t},frameRate:e,bitrateMin:i,bitrateMax:s}}function DT(n,t){return{numSpatialLayers:n,numTemporalLayers:t}}(function(n){n[n.CHOOSE_SERVER=11]="CHOOSE_SERVER",n[n.CLOUD_PROXY=18]="CLOUD_PROXY",n[n.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",n[n.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(Yn||(Yn={})),function(n){n.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",n.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",n.IOS_INTERRUPTION_START="ios-interruption-start",n.IOS_INTERRUPTION_END="ios-interruption-end",n.STATE_CHANGE="state-change"}(zn||(zn={}));const Sj={"90p":Se(160,90),"90p_1":Se(160,90),"120p":Se(160,120,15,30,65),"120p_1":Se(160,120,15,30,65),"120p_3":Se(120,120,15,30,50),"120p_4":Se(212,120),"180p":Se(320,180,15,30,140),"180p_1":Se(320,180,15,30,140),"180p_3":Se(180,180,15,30,100),"180p_4":Se(240,180,15,30,120),"240p":Se(320,240,15,40,200),"240p_1":Se(320,240,15,40,200),"240p_3":Se(240,240,15,40,140),"240p_4":Se(424,240,15,40,220),"360p":Se(640,360,15,80,400),"360p_1":Se(640,360,15,80,400),"360p_3":Se(360,360,15,80,260),"360p_4":Se(640,360,30,80,600),"360p_6":Se(360,360,30,80,400),"360p_7":Se(480,360,15,80,320),"360p_8":Se(480,360,30,80,490),"360p_9":Se(640,360,15,80,800),"360p_10":Se(640,360,24,80,800),"360p_11":Se(640,360,24,80,1e3),"480p":Se(640,480,15,100,500),"480p_1":Se(640,480,15,100,500),"480p_2":Se(640,480,30,100,1e3),"480p_3":Se(480,480,15,100,400),"480p_4":Se(640,480,30,100,750),"480p_6":Se(480,480,30,100,600),"480p_8":Se(848,480,15,100,610),"480p_9":Se(848,480,30,100,930),"480p_10":Se(640,480,10,100,400),"720p":Se(1280,720,15,120,1130),"720p_1":Se(1280,720,15,120,1130),"720p_2":Se(1280,720,30,120,2e3),"720p_3":Se(1280,720,30,120,1710),"720p_5":Se(960,720,15,120,910),"720p_6":Se(960,720,30,120,1380),"1080p":Se(1920,1080,15,120,2080),"1080p_1":Se(1920,1080,15,120,2080),"1080p_2":Se(1920,1080,30,120,3e3),"1080p_3":Se(1920,1080,30,120,3150),"1080p_5":Se(1920,1080,60,120,4780),"1440p":Se(2560,1440,30,120,4850),"1440p_1":Se(2560,1440,30,120,4850),"1440p_2":Se(2560,1440,60,120,7350),"4k":Se(3840,2160,30,120,8910),"4k_1":Se(3840,2160,30,120,8910),"4k_3":Se(3840,2160,60,120,13500)},vj={"480p":gr(640,480,5),"480p_1":gr(640,480,5),"480p_2":gr(640,480,30),"480p_3":gr(640,480,15),"720p":gr(1280,720,5),"720p_1":gr(1280,720,5),"720p_2":gr(1280,720,30),"720p_3":gr(1280,720,15),"1080p":gr(1920,1080,5),"1080p_1":gr(1920,1080,5),"1080p_2":gr(1920,1080,30),"1080p_3":gr(1920,1080,15)},Cj={"1SL1TL":DT(1,1),"3SL3TL":DT(3,3),"2SL3TL":DT(2,3)};function Jo(n){return n||(n="480p_1"),typeof n=="string"?Object.assign({},Sj[n]):n}function PT(n){return typeof n=="string"?Object.assign({},vj[n]):n}function Af(n){return typeof n=="string"?Object.assign({},Cj[n]):n}const yj={speech_low_quality:zd(16e3,!1),speech_standard:zd(32e3,!1,18),music_standard:zd(48e3,!1),standard_stereo:zd(48e3,!0,56),high_quality:zd(48e3,!1,128),high_quality_stereo:zd(48e3,!0,192)};function wf(n){return typeof n=="string"?Object.assign({},yj[n]):n}const Jd=[];function WA(n){return Vn(n,"mediaSource",["screen","window","application"]),!0}var St,ze,La,Of,LT,Xd,ka,Mc,ns,Nf;(function(n){n.NEED_RENEGOTIATE="@need_renegotiate",n.NEED_REPLACE_TRACK="@need_replace_track",n.NEED_CLOSE="@need_close",n.NEED_ENABLE_TRACK="@need_enable_track",n.NEED_DISABLE_TRACK="@need_disable_track",n.NEED_SESSION_ID="@need_sid",n.SET_OPTIMIZATION_MODE="@set_optimization_mode",n.GET_STATS="@get_stats",n.GET_LOW_VIDEO_TRACK="@get_low_video_track",n.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",n.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",n.NEED_MUTE_TRACK="@need_mute_track",n.NEED_UNMUTE_TRACK="@need_unmute_track"})(St||(St={})),function(n){n.SCREEN_TRACK="screen_track",n.CUSTOM_TRACK="custome_track",n.LOW_STREAM="low_stream"}(ze||(ze={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(La||(La={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(Of||(Of={})),function(n){n[n.DISABLE=0]="DISABLE",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.AUDIO_ONLY=2]="AUDIO_ONLY"}(LT||(LT={})),function(n){n.TRANSCEIVER_UPDATED="transceiver-updated"}(Xd||(Xd={})),function(n){n.SOURCE_STATE_CHANGE="source-state-change",n.TRACK_ENDED="track-ended",n.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.CLOSED="closed"}(ka||(ka={})),function(n){n.FIRST_FRAME_DECODED="first-frame-decoded",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Mc||(Mc={})),function(n){n.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",n.RECEIVE_TRACK_BUFFER="receive_track_buffer",n.ON_AUDIO_BUFFER="on_audio_buffer",n.UPDATE_SOURCE="update_source"}(ns||(ns={})),function(n){n.UPDATE_TRACK_SOURCE="update-track-source"}(Nf||(Nf={}));const kT={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},MT={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},HA={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Rj={uplinkNetworkQuality:0,downlinkNetworkQuality:0},KA={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Si,is,Uc,Xo,vi;(function(n){n.ON_TRACK="on_track",n.ON_NODE="on_node"})(Si||(Si={})),function(n){n.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",n.REQUEST_CONSTRAINTS="request_constraints"}(is||(is={})),function(n){n.IDLE="IDLE",n.INITING="INITING",n.INITEND="INITEND"}(Uc||(Uc={})),function(n){n.STATE_CHANGE="state_change",n.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",n.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",n.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Xo||(Xo={})),function(n){n.NONE="none",n.INIT="init",n.CANPLAY="canplay",n.PLAYING="playing",n.PAUSED="paused",n.SUSPEND="suspend",n.STALLED="stalled",n.WAITING="waiting",n.ERROR="error",n.DESTROYED="destroyed",n.ABORT="abort",n.ENDED="ended",n.EMPTIED="emptied",n.LOADEDDATA="loadeddata"}(vi||(vi={}));const UT={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var $d;(function(n){n.OPEN="open",n.MESSAGE="message",n.CLOSE="close",n.CLOSING="closing",n.ERROR="error"})($d||($d={}));class qA extends Ze{constructor(t,e){super(),m(this,"_ID",void 0),m(this,"_rtpTransceiver",void 0),m(this,"_lowRtpTransceiver",void 0),m(this,"_hints",[]),m(this,"_isClosed",!1),m(this,"_originMediaStreamTrack",void 0),m(this,"_mediaStreamTrack",void 0),m(this,"_external",{}),this._ID=e||Be(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,function(i){Vt(Jd).call(Jd,i)||Jd.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const e=wt.reportApiInvoke(null,{name:wn.GET_MEDIA_STREAM_TRACK,options:[],tag:sn.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?e.onSuccess(this._mediaStreamTrack.label):e.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===La.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const e=Jd.indexOf(t);e!==-1&&Jd.splice(e,1)}(this),this.emit(ka.CLOSED)}_updateRtpTransceiver(t,e){if(e===La.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Xd.TRANSCEIVER_UPDATED,t,e)}}class di extends qA{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}constructor(t,e){super(t,e),m(this,"_enabled",!0),m(this,"_muted",!1),m(this,"_isExternalTrack",!1),m(this,"_isClosed",!1),m(this,"_enabledMutex",void 0),m(this,"processor",void 0),m(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new qn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,e;return(t=(e=this._originMediaStreamTrack)===null||e===void 0?void 0:e.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,v.debug("[".concat(this.getTrackId(),"] close")),this.emit(St.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await He(this,St.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ka.TRACK_ENDED)}stateCheck(t,e){if(v.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(e,"]")),Ac(e,t),this._enabled&&this._muted&&t==="enabled"&&e===!1)throw new Q(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",v);if(!this._enabled&&!this._muted&&t==="muted"&&e===!0)throw new Q(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",v)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function YA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}const zA=window.AudioContext||window.webkitAudioContext;let Ps=null;const Me=new class extends Ze{constructor(){super(...arguments),m(this,"prevState",void 0),m(this,"curState",void 0),m(this,"currentTime",void 0),m(this,"currentTimeStuckAt",void 0),m(this,"interruptDetectorTrack",void 0),m(this,"onLocalAudioTrackMute",()=>{v.info("ios15-interruption-start"),this.emit(zn.IOS_15_16_INTERRUPTION_START)}),m(this,"onLocalAudioTrackUnmute",async()=>{v.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?v.info("ios15-interruption-end-canceled"):(Ps&&await Ps.suspend(),this.emit(zn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(n){v.debug("webaudio bindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=n,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(n){v.debug("webaudio unbindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===n&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Ij(){if(!zA)return void v.error("your browser is not support web audio");v.info("create audio context");const n=function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?YA(Object(i),!0).forEach(function(s){m(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):YA(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}({},U("WEBAUDIO_INIT_OPTIONS"));v.debug("audio context init option:",JSON.stringify(n)),Ps=new zA(n),Me.curState=Ps.state,Ps.onstatechange=()=>{Me.prevState=Me.curState,Me.curState=Ps?Ps.state:void 0;const{prevState:t,curState:e}=Me,i=e==="running",s=e==="interrupted",r=t==="running",a=t==="suspended",c=t==="interrupted",l=we().osVersion;(Li()||uo())&&r&&s&&(v.info("ios".concat(l,"-interruption-start")),Me.emit(zn.IOS_INTERRUPTION_START)),(Li()||uo())&&(a||c)&&i&&(v.info("ios".concat(l,"-interruption-end")),Me.emit(zn.IOS_INTERRUPTION_END)),t!==e&&(v.debug("AudioContext State Change","".concat(t,"=>").concat(e)),Me.emit(zn.STATE_CHANGE))},setInterval(()=>{var t;const e=(t=Ps)===null||t===void 0?void 0:t.currentTime;Me.currentTime!==e?(Me.currentTimeStuckAt&&(v.debug("AudioContext current time resume at ".concat(e)),Me.currentTimeStuckAt=void 0),Me.currentTime=e):(e!==Me.currentTimeStuckAt&&(wt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:e},tag:sn.TRACER}).onSuccess(),v.warning("AudioContext current time stuck at ".concat(e))),Me.currentTimeStuckAt=e)},5e3),async function(t){const e=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,s=!1,r=!1,a=!1;function c(b){t.state==="running"?l(!1):Li()||uo()?t.state==="suspended"&&(l(!0),b&&t.resume().then(h,h)):t.state!=="closed"&&(l(!0),b&&t.resume().then(h,h))}function l(b){if(s!==b){s=b;for(let M=0,F=e;M<F.length;M+=1){const V=F[M];b?window.addEventListener(V,f,{capture:!0,passive:!0}):window.removeEventListener(V,f,{capture:!0,passive:!0})}}}function u(){c(!0)}function h(){c(!1)}function f(){c(!0)}function g(b){if(!a)if(i.paused)if(b){let M;S(!1),a=!0;try{M=i.play(),M?M.then(w,w):(i.addEventListener("playing",w),i.addEventListener("abort",w),i.addEventListener("error",w))}catch{w()}}else S(!0);else S(!1)}function S(b){if(r!==b){r=b;for(let M=0,F=e;M<F.length;M++){const V=F[M];b?window.addEventListener(V,I,{capture:!0,passive:!0}):window.removeEventListener(V,I,{capture:!0,passive:!0})}}}function w(){i.removeEventListener("playing",w),i.removeEventListener("abort",w),i.removeEventListener("error",w),a=!1,g(!1)}function I(){g(!0)}if(Li()){const b=t.createMediaStreamDestination(),M=document.createElement("div");M.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=M.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=b.stream,g(!0)}Me.on(zn.STATE_CHANGE,u),c(!1)}(Ps)}function Qd(){if(!Ps){if(Ij(),!Ps)throw new Q(O.NOT_SUPPORTED,"can not create audio context");return Ps}return Ps}function JA(){return!!Ps}function xc(n){if(function(){if(xT!==null)return xT;const i=Qd(),s=i.createBufferSource(),r=i.createGain(),a=i.createGain();s.connect(r),s.connect(a),s.disconnect(r);let c=!1;try{s.disconnect(r)}catch{c=!0}return s.disconnect(),xT=c,c}())return;const t=n.connect,e=n.disconnect;n.connect=(i,s,r)=>{var a;return n._inputNodes||(n._inputNodes=[]),Vt(a=n._inputNodes).call(a,i)||(i instanceof AudioNode?(n._inputNodes.push(i),t.call(n,i,s,r)):t.call(n,i,s)),n},n.disconnect=(i,s,r)=>{e.call(n),i?zg(n._inputNodes,i):n._inputNodes=[];for(const a of n._inputNodes)t.call(n,a)}}let xT=null;function VT(n,t){let e=!1;const i=1/t;if(U("DISABLE_WEBAUDIO")){const s=window.setInterval(()=>{e?window.clearInterval(s):n(performance.now()/1e3)},1e3*i)}else{const s=Qd();let r=s.createGain();r.gain.value=0,r.connect(s.destination);const a=()=>{if(e)return void(r=null);const c=s.createOscillator();c.onended=a,c.connect(r),c.start(0),c.stop(s.currentTime+i),n(s.currentTime)};a()}return()=>{e=!0}}const Ci={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function Ke(){return Ci}class XA{constructor(){m(this,"context",void 0),m(this,"analyserNode",void 0),m(this,"sourceNode",void 0),this.context=Qd(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Li()||uo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let s=0;s<t.length;++s)t[s]=i[s]/128-1}const e=Nc(t).call(t,(i,s)=>i+s*s,0)/t.length;return Math.max(10*Math.log10(e)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,e;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(e=this.sourceNode)===null||e===void 0||e.connect(this.analyserNode)}catch{v.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class $A extends Ze{get processSourceNode(){return this.sourceNode}set processedNode(t){var e;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(e=this._processedNode)===null||e===void 0||e.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),m(this,"outputNode",void 0),m(this,"outputTrack",void 0),m(this,"isPlayed",!1),m(this,"context",void 0),m(this,"audioBufferNode",void 0),m(this,"destNode",void 0),m(this,"audioOutputLevel",0),m(this,"volumeLevelAnalyser",void 0),m(this,"_processedNode",void 0),m(this,"playNode",void 0),m(this,"isDestroyed",!1),m(this,"onNoAudioInput",void 0),m(this,"isNoAudioInput",!1),m(this,"_noAudioInputCount",0),this.context=Qd(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),xc(this.outputNode),this.volumeLevelAnalyser=new XA}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(ns.ON_AUDIO_BUFFER,function(i){for(let s=0;s<i.outputBuffer.numberOfChannels;s+=1){const r=i.outputBuffer.getChannelData(s);for(let a=0;a<r.length;a+=1)r[a]=0}return i.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ke().webAudioMediaStreamDest)throw new Q(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&mr(()=>{Me.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Li()||uo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const e=this.volumeLevelAnalyser.getAnalyserNode();let i;e.getFloatTimeDomainData?(i=new Float32Array(e.fftSize),e.getFloatTimeDomainData(i)):(i=new Uint8Array(e.fftSize),e.getByteTimeDomainData(i));let s=!1;for(let r=0;r<i.length;r++)i[r]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await ri(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,e;(t=this.processedNode)===null||t===void 0||t.disconnect(),(e=this.sourceNode)===null||e===void 0||e.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class FT extends $A{get isFreeze(){return!1}constructor(t,e,i){var s;if(super(),m(this,"sourceNode",void 0),m(this,"track",void 0),m(this,"clonedTrack",void 0),m(this,"audioElement",void 0),m(this,"isCurrentTrackCloned",!1),m(this,"isRemoteTrack",!1),m(this,"originVolumeLevelAnalyser",void 0),m(this,"rebuildWebAudio",async()=>{if(v.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void v.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>v.info("resume success")),v.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const l=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(l),xc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),xc(this.outputNode),this.emit(ns.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=l,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Q(O.UNEXPECTED_ERROR);this.track=t;const r=new MediaStream([this.track]);if(this.isRemoteTrack=!!e,this.sourceNode=this.context.createMediaStreamSource(r),xc(this.sourceNode),i){const c=i.clone();c.enabled=!0,this.clonedTrack=c,v.debug("create an unmuted track ".concat(c.id," from the original track ").concat(i.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([c]));xc(l),this.originVolumeLevelAnalyser=new XA,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=r;const a=we();e&&a.os===Kn.IOS&&Number((s=a.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(Me.on(zn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const e=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(e),xc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ns.UPDATE_SOURCE),this.audioElement.srcObject=e}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Me.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const e=t.clone();e.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=e),v.debug("create an unmuted track ".concat(e.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([e]));xc(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function QA(n,t,e){const i=(r,a)=>r?typeof r!="number"?r.max||r.exact||r.ideal||r.min||a:r:a,s={audio:!!e&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function bj(n,t){const e=await ZA(n.mediaSource),{sourceId:i,audio:s}=await function(r){let a=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new K((c,l)=>{const u=document.createElement("div");u.innerText="share screen",u.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const h=document.createElement("div");h.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const f=document.createElement("div");f.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",f.setAttribute("style","height: 12%;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const S=document.createElement("div");S.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const w=document.createElement("button");w.innerHTML="cancel",w.setAttribute("style","width: 85px;"),w.onclick=()=>{document.body.removeChild(M);const F=new Error("NotAllowedError");F.name="NotAllowedError",l(F)};let I=a;const b=document.createElement("div");if(a){const F=document.createElement("input");F.setAttribute("type","checkbox");const V=document.createElement("span");F.setAttribute("style","margin-right: 6px;"),V.innerText="Share audio",F.checked=I,F.onchange=()=>{I=F.checked},b.appendChild(F),b.appendChild(V)}S.appendChild(b),S.appendChild(w),h.appendChild(f),h.appendChild(g),h.appendChild(S);const M=document.createElement("div");M.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),M.appendChild(u),M.appendChild(h),document.body.appendChild(M),r.map(F=>{if(F.id){const V=document.createElement("div");V.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Z=F.thumbnail;try{const{width:$}=Z.getSize();$>1920&&(Z=Z.resize({width:1920}))}catch($){throw $&&$.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),$}V.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Z.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+F.name.replace(/[\u00A0-\u9999<>\&]/g,function($){return"&#"+$.charCodeAt(0)+";"})+"</span>",V.onclick=()=>{document.body.removeChild(M),c({sourceId:F.id,audio:I})},g.appendChild(V)}})})}(e,t);return await QA(i,n,s)}async function ZA(n){let t=["window","screen"];n!=="application"&&n!=="window"||(t=["window"]),n==="screen"&&(t=["screen"]);const e=db();if(!e)throw console.error("failed to fetch electron, please mount it to window"),new Q(O.ELECTRON_IS_NULL);let i=null;try{var s;i=((s=e.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:t}))||e.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new K((r,a)=>{e.desktopCapturer.getSources({types:t},(c,l)=>{c?a(c):r(l)})}));try{return await i}catch(r){throw new Q(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,r.toString())}}function tw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}const BT=new qn("safari");let ew=!1,nw=!1;async function Ls(n,t){let e=0,i=null;for(;e<2;)try{i=await Aj(n,t,e>0);break}catch(s){if(s instanceof Q)throw v.error("[".concat(t,"] ").concat(s.toString())),s;const r=Df(s.name||s.code||s,s.message);if(r.code===O.MEDIA_OPTION_INVALID){v.debug("[".concat(t,"] detect media option invalid, retry")),e+=1,await ri(500);continue}throw v.error("[".concat(t,"] ").concat(r.toString())),r}if(!i)throw new Q(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function Aj(n,t,e){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Q(O.NOT_SUPPORTED,"can not find getUserMedia");e&&(n.video&&(delete n.video.width,delete n.video.height),n.screen&&(delete n.screen.width,delete n.screen.height));const i=Ke(),s=new MediaStream;if(n.audioSource&&s.addTrack(n.audioSource),n.videoSource&&s.addTrack(n.videoSource),!n.audio&&!n.video&&!n.screen)return v.debug("Using Video Source/ Audio Source"),s;if(n.screen)if(db())n.screen.sourceId?Zd(s,await QA(n.screen.sourceId,n.screen,n.screenAudio)):Zd(s,await bj(n.screen,n.screenAudio));else if(Gg()&&n.screen.extensionId&&n.screen.mandatory){if(!i.getStreamFromExtension)throw new Q(O.NOT_SUPPORTED,"This browser does not support screen sharing");v.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const g=await(a=n.screen.extensionId,c=t,new K((S,w)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},I=>{if(!I||!I.streamId)return v.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),I),void w(new Q(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));S(I.streamId)})}catch(I){v.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),I.toString()),w(new Q(O.CHROME_PLUGIN_NOT_INSTALL))}}));n.screen.mandatory.chromeMediaSourceId=g,Zd(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:n.screen.mandatory}}))}else if(i.getDisplayMedia){var r;n.screen.mediaSource&&WA(n.screen.mediaSource);const g={width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate,displaySurface:(r=n.screen.displaySurface)!==null&&r!==void 0?r:n.screen.mediaSource==="screen"?"monitor":n.screen.mediaSource},{selfBrowserSurface:S,surfaceSwitching:w,systemAudio:I}=n.screen,b={selfBrowserSurface:S,surfaceSwitching:w,systemAudio:I};!S&&delete b.selfBrowserSurface,!w&&delete b.surfaceSwitching,!I&&delete b.systemAudio,v.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:g,audio:!!n.screenAudio,controls:b}));const M=await navigator.mediaDevices.getDisplayMedia(function(F){for(var V=1;V<arguments.length;V++){var Z=arguments[V]!=null?arguments[V]:{};V%2?tw(Object(Z),!0).forEach(function($){m(F,$,Z[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(Z)):tw(Object(Z)).forEach(function($){Object.defineProperty(F,$,Object.getOwnPropertyDescriptor(Z,$))})}return F}({video:g,audio:!!n.screenAudio},b));Zd(s,M)}else{if(!$e())throw v.error("[".concat(t,"] This browser does not support screenSharing")),new Q(O.NOT_SUPPORTED,"This browser does not support screen sharing");{n.screen.mediaSource&&WA(n.screen.mediaSource);const g={video:{mediaSource:n.screen.mediaSource,width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate}};v.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(g))),Zd(s,await navigator.mediaDevices.getUserMedia(g))}}var a,c;if(!n.video&&!n.audio)return s;let l={video:n.video,audio:n.audio},u=U("MEDIA_DEVICE_CONSTRAINTS");if(u)try{typeof u=="string"&&(u=JSON.parse(u)),l=Xg(l,u)}catch{}v.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(l)),we();let h,f=null;(Pi()||Li()||sf())&&(f=await BT.lock());try{h=await navigator.mediaDevices.getUserMedia(l)}catch(g){throw f&&f(),g}return l.audio&&(ew=!0),l.video&&(nw=!0),Zd(s,h),f&&f(),s}function Df(n,t){switch(n){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Q(O.MEDIA_OPTION_INVALID,"".concat(n,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Q(O.DEVICE_NOT_FOUND,"".concat(n,": ").concat(t));case"NotSupportedError":return new Q(O.NOT_SUPPORTED,"".concat(n,": ").concat(t));case"NotReadableError":return new Q(O.NOT_READABLE,"".concat(n,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Q(O.PERMISSION_DENIED,"".concat(n,": ").concat(t));case"ConstraintNotSatisfiedError":return new Q(O.CONSTRAINT_NOT_SATISFIED,"".concat(n,": ").concat(t));default:return v.error("getUserMedia unexpected error",n),new Q(O.UNEXPECTED_ERROR,"".concat(n,": ").concat(t))}}function Zd(n,t){const e=n.getVideoTracks()[0],i=n.getAudioTracks()[0],s=t.getVideoTracks()[0],r=t.getAudioTracks()[0];r&&(i&&n.removeTrack(i),n.addTrack(r)),s&&(e&&n.removeTrack(e),n.addTrack(s))}const ks=new class extends Ze{get state(){return this._state}set state(n){n!==this._state&&(this.emit(Xo.STATE_CHANGE,n),this._state=n)}constructor(){super(),m(this,"_state",Uc.IDLE),m(this,"isAccessMicrophonePermission",!1),m(this,"isAccessCameraPermission",!1),m(this,"lastAccessMicrophonePermission",!1),m(this,"lastAccessCameraPermission",!1),m(this,"checkdeviceMatched",!1),m(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(U("ENUMERATE_DEVICES_INTERVAL")||(rf()||nf()===Kn.HARMONY_OS)&&ba())&&this.updateDevicesInfo()},U("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(n=>v.error(n.toString()))}async enumerateDevices(n,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Q(O.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i);let r=!this.isAccessMicrophonePermission&&n,a=!this.isAccessCameraPermission&&t;s.audio&&(r=!1),s.video&&(a=!1);let c=null,l=null,u=null;if(!e&&(r||a)){if(BT.isLocked&&(v.debug("[device manager] wait GUM lock"),(await BT.lock())(),v.debug("[device manager] GUM unlock")),ew&&(r=!1,this.isAccessMicrophonePermission=!0),nw&&(a=!1,this.isAccessCameraPermission=!0),v.debug("[device manager] check media device permissions",n,t,r,a),r&&a){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(h){const f=Df(h.name||h.code||h,h.message);if(f.code===O.PERMISSION_DENIED)throw f;v.warning("getUserMedia failed in getDevices",f)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(r){try{c=await navigator.mediaDevices.getUserMedia({audio:n})}catch(h){const f=Df(h.name||h.code||h,h.message);if(f.code===O.PERMISSION_DENIED)throw f;v.warning("getUserMedia failed in getDevices",f)}this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({video:t})}catch(h){const f=Df(h.name||h.code||h,h.message);if(f.code===O.PERMISSION_DENIED)throw f;v.warning("getUserMedia failed in getDevices",f)}this.isAccessCameraPermission=!0}v.debug("[device manager] mic permission",n,"cam permission",t)}try{const h=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach(f=>f.stop()),l&&l.getTracks().forEach(f=>f.stop()),u&&u.getTracks().forEach(f=>f.stop()),c=null,l=null,u=null,h}catch(h){return c&&c.getTracks().forEach(f=>f.stop()),l&&l.getTracks().forEach(f=>f.stop()),u&&u.getTracks().forEach(f=>f.stop()),c=null,l=null,u=null,new Q(O.ENUMERATE_DEVICES_FAILED,h.toString()).throw()}}async getRecordingDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,n)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(n){let t=null;return this.deviceInfoMap.forEach(e=>{e.device.label===n&&(t=e.device.deviceId)}),t}async getDeviceById(n){const t=(await this.enumerateDevices(!0,!0,!0)).find(e=>e.deviceId===n);if(!t)throw new Q(O.DEVICE_NOT_FOUND,"deviceId: ".concat(n));return t}async init(){this.state=Uc.INITING;try{await this.updateDevicesInfo(),this.state=Uc.INITEND}catch(n){throw v.warning("Device Detection functionality cannot start properly.",n.toString()),this.state=Uc.IDLE,!(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")&&new Q(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}}async updateDevicesInfo(){const n=await this.enumerateDevices(!0,!0,!0),t=Date.now(),e=[];if(n[0]&&n[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=n.find(a=>a.kind==="audioinput"&&a.deviceId==="default"),r=n.find(a=>a.kind==="audiooutput"&&a.deviceId==="default");s&&r?r.groupId===s.groupId?v.debug("[device-check] default input ".concat(s.label," and output ").concat(r.label," is the same group")):v.warning("[device-check] default input ".concat(s.label," and output ").concat(r.label," is not the same group")):v.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(n);if(n.forEach(s=>{if(!s.deviceId)return;const r=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((r?r.state:"INACTIVE")!=="ACTIVE"){const a={initAt:t,updateAt:t,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),a),e.push(a)}r&&(r.updateAt=t)}),this.deviceInfoMap.forEach((s,r)=>{s.state==="ACTIVE"&&s.updateAt!==t&&(s.state="INACTIVE",e.push(s))}),this.state!==Uc.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));e.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Xo.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Xo.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Xo.PLAYOUT_DEVICE_CHANGED,s)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(n){const t=n.filter(s=>s.kind==="audioinput"),e=n.filter(s=>s.kind==="videoinput"),i={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){i.audio=!0;break}for(const s of e)if(s.label&&s.deviceId){i.video=!0;break}return i}};let jT=!1;const Ms=new class extends Ze{constructor(){super(...arguments),m(this,"onAutoplayFailed",void 0),m(this,"onAudioAutoplayFailed",void 0)}};function iw(){if(we(),!jT){const n=t=>{t.preventDefault(),jT=!1,Nu()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};jT=!0,Nu()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),v.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ms.onAutoplayFailed?Ms.onAutoplayFailed():Ms.onAudioAutoplayFailed?v.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):v.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ms.emit("autoplay-failed")}}function sw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function rw(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?sw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):sw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function ow(n,t,e,i){if(!n)return;const s=wt.getBaseInfoBySessionId(n);if(!s)return;const r=s.info,a=Date.now(),c=rw(rw({},r),{},{vid:r.vid===void 0?0:Number(r.vid),lts:a,elapse:a-s.startTime,cbRegistered:Ms.onAutoplayFailed||Ms.onAudioAutoplayFailed?1:-1,errorMsg:e,mediaType:t,trackId:i,extend:void 0});wt.send({type:tn.AUTOPLAY_FAILED,data:c},!0)}const wj=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ps=new class{constructor(){m(this,"onAutoplayFailed",void 0),m(this,"elementMap",new Map),m(this,"elementStateMap",new Map),m(this,"elementsNeedToResume",[]),m(this,"sinkIdMap",new Map),m(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[t,e]=n;const i=this.elementStateMap.get(t),s=e.srcObject.getAudioTracks()[0];Ud()?s&&s.readyState==="live"&&Me.curState==="running"&&(v.debug("auto resume after interruption for iOS 15"),e.pause(),e.play()):i&&i==="paused"&&s&&s.readyState==="live"&&Me.curState==="running"&&(v.debug("auto resume after interruption for iOS"),e.play())})}),m(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[t,e]=n;const i=e.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(v.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),e.pause(),e.play())})}),this.autoResumeAudioElement(),Me.on(zn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Me.on(zn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Me.on(zn.STATE_CHANGE,()=>{Li()&&Me.prevState==="suspended"&&Me.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(n,t){const e=this.elementMap.get(n);if(this.sinkIdMap.set(n,t),e)try{await e.setSinkId(t)}catch(i){throw new Q(O.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(n,t,e,i){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([n]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,vi.INIT),this.setVolume(t,e);const r=this.sinkIdMap.get(t);if(r)try{s.setSinkId(r).catch(c=>{v.warning("[".concat(t,"] set sink id failed"),c.toString())})}catch(c){v.warning("[".concat(t,"] set sink id failed"),c.toString())}const a=s.play();a&&a.then&&a.catch(c=>{i&&ow(i,"audio",c.message,t),v.warning("audio element play warning",c.toString()),this.elementMap.has(t)&&c.name==="NotAllowedError"&&(v.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),mr(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),iw()}))})}updateTrack(n,t){const e=this.elementMap.get(n);e&&(e.srcObject=new MediaStream([t]))}isPlaying(n){return this.elementMap.has(n)&&this.elementStateMap.get(n)==="playing"}setVolume(n,t){const e=this.elementMap.get(n);e&&(t=Math.max(0,Math.min(100,t)),e.volume=t/100)}stop(n){const t=this.elementMap.get(n);if(this.sinkIdMap.delete(n),!t)return;const e=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(e,1),t.srcObject=null,t.remove(),this.elementMap.delete(n),this.elementStateMap.delete(n)}bindAudioElementEvents(n,t){wj.forEach(e=>{t.addEventListener(e,i=>{const s=this.elementStateMap.get(n),r=i.type==="pause"?"paused":i.type;if(v.debug("[".concat(n,"] audio-element-status change ").concat(s," => ").concat(r)),i.type==="error"){const a=t==null?void 0:t.error;a&&v.error("[".concat(n,"] media error, code: ").concat(a.code,", message: ").concat(a.message))}this.elementStateMap.set(n,r)})})}getPlayerState(n){return this.elementStateMap.get(n)||"uninit"}autoResumeAudioElement(){const n=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(e=>{v.debug("Auto resume audio element success")}).catch(e=>{v.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new K(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Nu()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0))})}};function pn(){return function(n,t,e){const i=e.value;return typeof i=="function"&&(e.value=function(){this._isClosed&&new Q(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",v);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];const c=i.apply(this,r);return c instanceof K?new K((l,u)=>{c.then(l).catch(u)}):c}),e}}function aw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Pf(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?aw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):aw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class cw extends Ze{constructor(t){super(),m(this,"name","VideoProcessorDestination"),m(this,"ID","0"),m(this,"_source",void 0),m(this,"videoContext",void 0),m(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Q(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Q(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Si.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Si.ON_TRACK,void 0)}}class dw extends Ze{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,e){super(),m(this,"constraintsMap",new Map),m(this,"statsRegistry",[]),m(this,"usageRegistry",[]),m(this,"trackId",void 0),m(this,"direction",void 0),m(this,"_chained",!1),this.trackId=t,this.direction=e}async getConstraints(){return await rn(this,is.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,e){var i;return v.info("processor ".concat(e.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(e,t),He(this,is.REQUEST_UPDATE_CONSTRAINTS,Array.from(po(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var e;if(this.constraintsMap.has(t))return v.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),He(this,is.REQUEST_UPDATE_CONSTRAINTS,Array.from(po(e=this.constraintsMap).call(e)))}registerStats(t,e,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:e,cb:i})}unregisterStats(t,e){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:e,processorName:i,type:s,cb:r}of this.statsRegistry)try{const a=r();t.push({processorID:e,processorName:i,type:s,stats:a})}catch(a){v.error(new Q(O.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,e){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:e})}unregisterUsage(t){const e=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);e!==-1&&this.usageRegistry.splice(e,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:e}of this.usageRegistry)try{let i=e();i instanceof K&&(i=await i),t.push(Pf(Pf({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class Lf extends Ze{constructor(t){super(),m(this,"name","AudioProcessorDestination"),m(this,"ID","0"),m(this,"inputTrack",void 0),m(this,"inputNode",void 0),m(this,"audioProcessorContext",void 0),m(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Q(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Q(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Si.ON_TRACK,void 0),this.emit(Si.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Si.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Si.ON_NODE,this.inputNode))}}class kf extends Ze{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,e,i){super(),m(this,"constraintsMap",new Map),m(this,"statsRegistry",[]),m(this,"audioContext",void 0),m(this,"trackId",void 0),m(this,"direction",void 0),m(this,"usageRegistry",[]),m(this,"_chained",!1),this.audioContext=t,this.trackId=e,this.direction=i}async getConstraints(){return rn(this,is.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,e){var i;return v.info("processor ".concat(e.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(e,t),He(this,is.REQUEST_UPDATE_CONSTRAINTS,Array.from(po(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var e;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),He(this,is.REQUEST_UPDATE_CONSTRAINTS,Array.from(po(e=this.constraintsMap).call(e)))}registerStats(t,e,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:e,cb:i})}unregisterStats(t,e){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:e,processorName:i,type:s,cb:r}of this.statsRegistry)try{const a=r();t.push({processorID:e,processorName:i,type:s,stats:a})}catch(a){v.error(new Q(O.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,e){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:e})}unregisterUsage(t){const e=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);e!==-1&&this.usageRegistry.splice(e,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:e}of this.usageRegistry)try{let i=e();i instanceof K&&(i=await i),t.push(Pf(Pf({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class GT extends Ze{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),m(this,"context",void 0),m(this,"processSourceNode",void 0),m(this,"outputTrack",void 0),m(this,"processedNode",void 0),m(this,"clonedTrack",void 0),m(this,"outputNode",void 0),this.outputNode=new Oj}setVolume(){}createOutputTrack(){throw new Q(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Oj{disconnect(){}connect(){}}let tl=null;class Nj{constructor(){m(this,"state","open"),m(this,"trigger",void 0),m(this,"tasks",[]),v.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",v.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(t=>t.key),"]")),this.trigger=void 0,this.tasks.forEach(t=>{let{func:e}=t;return e()}),this.tasks.length=0,v.debug("[macro-task-queue] is closed.")})}enqueue(t,e){this.state!=="closed"&&(this.tasks.push({key:t,func:e}),v.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")))}runTask(t){if(this.state==="closed")return;const e=this.tasks.findIndex(i=>i.key===t);if(e!==-1){const i=this.tasks.splice(e,1);v.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")),i[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,v.debug("[macro-task-queue] is closed."))}}function WT(n){return function(t,e,i){var s;const r=(s=i.value)!==null&&s!==void 0?s:i.get,a=function(){tl&&tl.state==="open"&&tl.runTask(n);for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return r==null?void 0:r.apply(this,...l)};return i.value?i.value=a:i.get=a,i}}function lw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function HT(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?lw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):lw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Oe extends di{get _source(){return this._trackSource}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get processorDestination(){return this._processorDestination}set processorDestination(t){this._processorDestination=t}get isPlaying(){return this._useAudioElement?ps.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,i,s,r){super(t,i),m(this,"trackMediaType","audio"),m(this,"_encoderConfig",void 0),m(this,"_trackSource",void 0),m(this,"_enabled",!0),m(this,"_volume",100),m(this,"_useAudioElement",!1),m(this,"_bypassWebAudio",!1),m(this,"processor",void 0),m(this,"_processorContext",void 0),m(this,"_processorDestination",void 0),m(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!s;const a=()=>{this.processorContext=new kf(this._source.context,this.getTrackId(),"local"),this.processorDestination=new Lf(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ns.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},c=r&&Pi()&&!JA();U("DISABLE_WEBAUDIO")?(this._source=new GT,this._useAudioElement=!0,this._bypassWebAudio=!0):c?this._source=new GT:(this._source=new FT(t,!1,this._getOriginVolumeLevel?t:void 0),U("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),a(),!U("DISABLE_WEBAUDIO")&&c&&(tl||(tl=new Nj),tl).enqueue("INIT_WEBAUDIO",()=>{this._source=new FT(t,!1,this._getOriginVolumeLevel?t:void 0),U("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),a(),this.emit(Nf.UPDATE_TRACK_SOURCE)})}setVolume(t){Fe(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&ps.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void v.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,He(this,St.NEED_REPLACE_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{v.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement)throw new Q(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ps.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,i){return this._setEnabled(t,e,i)}async _setEnabled(t,e,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await He(this,St.NEED_ENABLE_TRACK,this),v.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(s){throw i||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await He(this,St.NEED_DISABLE_TRACK,this)}catch(s){throw i||(this._enabled=!0),v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await He(this,St.NEED_MUTE_TRACK,this):await He(this,St.NEED_UNMUTE_TRACK,this))}getStats(){return Pu(()=>{v.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),us(this,St.GET_STATS)||HT({},kT)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ns.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ns.ON_AUDIO_BUFFER),this._source.on(ns.ON_AUDIO_BUFFER,i=>t(i))}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ps.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ps.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ps.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:t,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await He(this,St.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return K.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Q(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Si.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await He(this,St.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await He(this,St.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(Si.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Si.ON_TRACK),this.processorDestination.removeAllListeners(Si.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(is.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(is.REQUEST_CONSTRAINTS)}}tt([WT("INIT_WEBAUDIO"),A("design:type",Object),A("design:paramtypes",[Object])],Oe.prototype,"_source",null),tt([WT("INIT_WEBAUDIO"),A("design:type",kf),A("design:paramtypes",[kf])],Oe.prototype,"processorContext",null),tt([WT("INIT_WEBAUDIO"),A("design:type",Lf),A("design:paramtypes",[Lf])],Oe.prototype,"processorDestination",null),tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t],throttleTime:300}),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Oe.prototype,"setVolume",null),tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Oe.prototype,"setPlaybackDevice",null),tt([Bd("LocalAudioTrack","_enabledMutex"),Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[Boolean,Object,Boolean]),A("design:returntype",K)],Oe.prototype,"setEnabled",null),tt([Bd("LocalAudioTrack","_enabledMutex"),Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",K)],Oe.prototype,"setMuted",null),tt([pn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Object)],Oe.prototype,"getStats",null),tt([pn(),A("design:type",Function),A("design:paramtypes",[Object,Number]),A("design:returntype",void 0)],Oe.prototype,"setAudioFrameCallback",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),pn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Oe.prototype,"play",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),pn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Oe.prototype,"stop",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Oe.prototype,"close",null),tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],Oe.prototype,"pipe",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Oe.prototype,"unpipe",null);class Ma extends Oe{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,i,s){super(t,e.encoderConfig?wf(e.encoderConfig):{},s,U("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),m(this,"_config",void 0),m(this,"_deviceName","default"),m(this,"_constraints",void 0),m(this,"_originalConstraints",void 0),m(this,"_enabled",!0),this._config=e,this._constraints=i,this._originalConstraints=i,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Ud()||Hg())&&Me.bindInterruptDetectorTrack(this),this.on(Nf.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),JA()&&this.bindProcessorContextEvents()}async setDevice(t){if(v.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await ks.getDeviceById(t),i={};i.audio=HT({},this._constraints),i.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let s=null;try{s=await Ls(i,this.getTrackId())}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),s=await Ls({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await ks.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}v.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,i){if(e)return v.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),i||(this._enabled=!1);try{await He(this,St.NEED_DISABLE_TRACK,this)}catch(c){throw v.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=HT({},this._constraints),a=ks.searchDeviceIdByName(this._deviceName);a&&!r.deviceId&&(r.deviceId=a);try{i||(this._enabled=!0);const c=await Ls({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await He(this,St.NEED_ENABLE_TRACK,this)}catch(c){throw i||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}v.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ud()||Hg())&&Me.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Li()||uo())&&this._enabled&&!this._isClosed&&Me.duringInterruption){const t=async()=>{Me.off(zn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Me.on(zn.IOS_INTERRUPTION_END,t)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ka.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,i=ks.searchDeviceIdByName(this._deviceName);if(i&&!e.deviceId&&(e.deviceId=i),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const s=await Ls({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(is.REQUEST_UPDATE_CONSTRAINTS,async(t,e,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),e()}catch(s){i(s)}}),this.processorContext.on(is.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}}tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Ma.prototype,"setDevice",null),tt([Bd("MicrophoneAudioTrack","_enabledMutex"),Ft({argsMap:(n,t,e)=>[n.getTrackId(),t,e]}),pn(),A("design:type",Function),A("design:paramtypes",[Boolean,Boolean,Boolean]),A("design:returntype",K)],Ma.prototype,"setEnabled",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ma.prototype,"close",null);class Ua extends Oe{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,i,s){super(e.createOutputTrack(),i,s),m(this,"source",void 0),m(this,"_bufferSource",void 0),this.source=t,this._bufferSource=e,this._bufferSource.on(ns.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(ka.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){Fe(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t,n.duration]}),pn(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],Ua.prototype,"startProcessAudioBuffer",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),pn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ua.prototype,"pauseProcessAudioBuffer",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),pn(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Ua.prototype,"seekAudioBuffer",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),pn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ua.prototype,"resumeProcessAudioBuffer",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),pn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ua.prototype,"stopProcessAudioBuffer",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ua.prototype,"close",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),pn(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Ua.prototype,"setAudioBufferPlaybackSpeed",null);class bn extends Oe{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Qd().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Be(8,"track-mix-")),m(this,"trackList",void 0),m(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(v.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):v.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){v.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}zg(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(e=>{e._encoderConfig&&((e._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=e._encoderConfig.bitrate),(e._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=e._encoderConfig.sampleRate),(e._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=e._encoderConfig.sampleSize),e._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(e=>{e instanceof bn?e.emit(Xd.TRANSCEIVER_UPDATED,t):e._updateRtpTransceiver(t)}))}}function Mf(n){const t={};n.facingMode&&(t.facingMode=n.facingMode),n.cameraId&&(t.deviceId={exact:n.cameraId});const e=Jo(n.encoderConfig);return e.width!=null&&(t.width=e.width),e.height!=null&&(t.height=e.height),!ib()&&e.frameRate&&(t.frameRate=e.frameRate),we().name===De.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),$e()&&(t.frameRate={ideal:30,max:30}),t}function uw(n){const t={};if(ib()||(n.AGC!==void 0&&(t.autoGainControl=n.AGC),n.AEC!==void 0&&(t.echoCancellation=n.AEC),n.ANS!==void 0&&(t.noiseSuppression=n.ANS,Gg()&&n.ANS&&(t.googHighpassFilter=n.ANS))),n.encoderConfig){const e=wf(n.encoderConfig);t.channelCount=e.stereo?2:1,t.sampleRate=e.sampleRate,t.sampleSize=e.sampleSize}return n.microphoneId&&(t.deviceId={exact:n.microphoneId}),rf()&&(t.sampleRate=void 0),t}class Dj extends $A{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ns.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),m(this,"audioBuffer",void 0),m(this,"sourceNode",void 0),m(this,"startPlayTime",0),m(this,"startPlayOffset",0),m(this,"pausePlayTime",0),m(this,"options",void 0),m(this,"currentLoopCount",0),m(this,"currentPlaybackSpeed",100),m(this,"_currentState","stopped"),this.audioBuffer=t,this.options=e,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):v.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const hw=new Map;async function Pj(n,t){let e=null;if(typeof n=="string"){const s=hw.get(n);if(s)return v.debug("use cached audio resource: ",n),s;try{e=(await Ur(()=>Zi.get(n,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(r){throw new Q(O.FETCH_AUDIO_FILE_FAILED,r.toString())}}else e=await new K((r,a)=>{const c=new FileReader;c.onload=l=>{l.target?r(l.target.result):a(new Q(O.READ_LOCAL_AUDIO_FILE_ERROR))},c.onerror=()=>{a(new Q(O.READ_LOCAL_AUDIO_FILE_ERROR))},c.readAsArrayBuffer(n)});const i=await function(s){const r=Qd();return new K((a,c)=>{r.decodeAudioData(s,l=>{a(l)},l=>{c(new Q(O.DECODE_AUDIO_FILE_FAILED,l.toString()))})})}(e);return typeof n=="string"&&t&&hw.set(n,i),i}const KT=n=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new K((e,i)=>{t.toBlob(async s=>{if(t.remove(),s){const r=await pw(s);e({buffer:r,width:t.width,height:t.height})}else i(new Q(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,1)})},pw=async n=>{const t=await n.arrayBuffer();return new Uint8Array(t)},$o=new class extends Ze{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),m(this,"_lastHiddenTime",0),m(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),v.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function fw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function _w(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?fw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):fw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class qT{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(v.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}constructor(t){m(this,"trackId",void 0),m(this,"config",void 0),m(this,"onFirstVideoFrameDecoded",void 0),m(this,"freezeTimeCounterList",[]),m(this,"renderFreezeAccTime",0),m(this,"isKeepLastFrame",!1),m(this,"timeUpdatedCount",0),m(this,"freezeTime",0),m(this,"playbackTime",0),m(this,"lastTimeUpdatedTime",0),m(this,"autoplayFailed",!1),m(this,"videoTrack",void 0),m(this,"videoElement",void 0),m(this,"cacheVideoElement",void 0),m(this,"videoElementCheckInterval",void 0),m(this,"_videoElementStatus",vi.NONE),m(this,"isGettingVideoDimensions",!1),m(this,"startGetVideoDimensions",()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return v.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()}),m(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Me.curState==="running"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(XI())),eb()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),m(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=vi.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=vi.CANPLAY;break;case"stalled":this.videoElementStatus=vi.STALLED;break;case"suspend":this.videoElementStatus=vi.SUSPEND;break;case"pause":this.videoElementStatus=vi.PAUSED,Li()||uo()||Pi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=vi.WAITING;break;case"abort":this.videoElementStatus=vi.ABORT;break;case"ended":this.videoElementStatus=vi.ENDED;break;case"emptied":this.videoElementStatus=vi.EMPTIED;break;case"error":{this.videoElementStatus=vi.ERROR;const i=this.videoElement.error;i&&v.error("[".concat(this.trackId,"] media error, code: ").concat(i.code,", message: ").concat(i.message));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const s=i-this.lastTimeUpdatedTime,r=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,$o.lastVisibleTime<$o.lastHiddenTime||r<$o.lastHiddenTime||r<$o.lastVisibleTime)return;for(s>U("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const a=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(a),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),m(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(XI())),eb()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Me.on(zn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Me.on(zn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const e=this.videoElement.play();e&&e.catch&&e.catch(s=>{t&&ow(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(v.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):v.warning("[".concat(this.trackId,"] play warning: "),s)});const i=we();if((i.name==="Safari"&&Number(i.version)===15||Ud())&&e&&e.then){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};e.then(s).catch(s)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const e=t.getContext("2d");if(!e)return v.error("create canvas context failed!"),new ImageData(2,2);e.drawImage(this.videoElement,0,0,t.width,t.height);const i=e.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,i.width,i.height),new K((r,a)=>{i.toBlob(async c=>{if(i.remove(),c){const l=await pw(c);r({buffer:l,width:i.width,height:i.height})}else a(new Q(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,e<0?.1:e>1?1:e)})):await KT(t)}destroy(){Me.off(zn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Me.off(zn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=vi.INIT,!this.videoElementCheckInterval&&(mw.forEach(r=>{this.videoElement.addEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(r){return r!==document.body&&document.body.contains(r)})(this.videoElement)||(this.videoElementStatus=vi.DESTROYED)},1e3),U("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,e;let r;const a=(c,l)=>{if(this.videoElementStatus===vi.PLAYING){if(r){const f=l.presentationTime-r.presentationTime;f>U("VIDEO_FREEZE_DURATION")&&$o.lastVisibleTime>=$o.lastHiddenTime&&r.timestamp>$o.lastVisibleTime&&r.timestamp>$o.lastHiddenTime&&(this.renderFreezeAccTime+=f)}r=_w(_w({},l),{},{timestamp:c})}var u,h;U("ENABLE_VIDEO_FRAME_CALLBACK")&&((u=(h=this.videoElement).requestVideoFrameCallback)===null||u===void 0||u.call(h,a))};(t=(e=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(e,a)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),rf()&&(this.videoElement.poster="noposter");const i=we();i.name==="Safari"&&Number(i.version)===15||Ud()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$e()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$e()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch(r=>{v.debug("[".concat(this.trackId,"] playback interrupted"),r.toString())})}resetVideoElement(){mw.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=vi.NONE}handleAutoPlayFailed(){const t=e=>{e.preventDefault(),this.videoElement.play().then(()=>{v.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{v.error(i)}),this.autoplayFailed=!1,Nu()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Nu()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),iw()}}const mw=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Ew extends qT{constructor(t){super(t),m(this,"container",void 0),m(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const e=t.element;e!==this.slot&&(this.destroy(),this.slot=e),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var e;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await KT(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",U("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function gw(n){return new K((t,e)=>{let i=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const r=Li()?"canplay":"playing";s.addEventListener(r,()=>{const a=s.videoWidth,c=s.videoHeight;!a&&$e()||(i=!0,s.srcObject=null,s.remove(),t([a,c]))}),s.srcObject=new MediaStream([n]),s.play().catch(df),setTimeout(()=>{i||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}const Lj=async(n,t,e)=>{const i=function(a){const c=[];for(let l=0;l<a.length;l+=2)c.push(parseInt(a.slice(l,l+2),16));return Uint8Array.from(c)}(function(a){const c="0123456789abcdef";function l(_t){let lt,Xt="";for(lt=0;lt<=3;lt++)Xt+=c.charAt(_t>>8*lt+4&15)+c.charAt(_t>>8*lt&15);return Xt}function u(_t,lt){const Xt=(65535&_t)+(65535&lt);return(_t>>16)+(lt>>16)+(Xt>>16)<<16|65535&Xt}function h(_t,lt,Xt,pe,ve,Ue){return u(function(de,Nn){return de<<Nn|de>>>32-Nn}(u(u(lt,_t),u(pe,Ue)),ve),Xt)}function f(_t,lt,Xt,pe,ve,Ue,de){return h(lt&Xt|~lt&pe,_t,lt,ve,Ue,de)}function g(_t,lt,Xt,pe,ve,Ue,de){return h(lt&pe|Xt&~pe,_t,lt,ve,Ue,de)}function S(_t,lt,Xt,pe,ve,Ue,de){return h(lt^Xt^pe,_t,lt,ve,Ue,de)}function w(_t,lt,Xt,pe,ve,Ue,de){return h(Xt^(lt|~pe),_t,lt,ve,Ue,de)}const I=function(_t){let lt;const Xt=1+(_t.length+8>>6),pe=new Array(16*Xt);for(lt=0;lt<16*Xt;lt++)pe[lt]=0;for(lt=0;lt<_t.length;lt++)pe[lt>>2]|=_t.charCodeAt(lt)<<lt%4*8;return pe[lt>>2]|=128<<lt%4*8,pe[16*Xt-2]=8*_t.length,pe}(a);let b,M,F,V,Z,$=1732584193,W=-271733879,q=-1732584194,et=271733878;for(b=0;b<I.length;b+=16)M=$,F=W,V=q,Z=et,$=f($,W,q,et,I[b+0],7,-680876936),et=f(et,$,W,q,I[b+1],12,-389564586),q=f(q,et,$,W,I[b+2],17,606105819),W=f(W,q,et,$,I[b+3],22,-1044525330),$=f($,W,q,et,I[b+4],7,-176418897),et=f(et,$,W,q,I[b+5],12,1200080426),q=f(q,et,$,W,I[b+6],17,-1473231341),W=f(W,q,et,$,I[b+7],22,-45705983),$=f($,W,q,et,I[b+8],7,1770035416),et=f(et,$,W,q,I[b+9],12,-1958414417),q=f(q,et,$,W,I[b+10],17,-42063),W=f(W,q,et,$,I[b+11],22,-1990404162),$=f($,W,q,et,I[b+12],7,1804603682),et=f(et,$,W,q,I[b+13],12,-40341101),q=f(q,et,$,W,I[b+14],17,-1502002290),W=f(W,q,et,$,I[b+15],22,1236535329),$=g($,W,q,et,I[b+1],5,-165796510),et=g(et,$,W,q,I[b+6],9,-1069501632),q=g(q,et,$,W,I[b+11],14,643717713),W=g(W,q,et,$,I[b+0],20,-373897302),$=g($,W,q,et,I[b+5],5,-701558691),et=g(et,$,W,q,I[b+10],9,38016083),q=g(q,et,$,W,I[b+15],14,-660478335),W=g(W,q,et,$,I[b+4],20,-405537848),$=g($,W,q,et,I[b+9],5,568446438),et=g(et,$,W,q,I[b+14],9,-1019803690),q=g(q,et,$,W,I[b+3],14,-187363961),W=g(W,q,et,$,I[b+8],20,1163531501),$=g($,W,q,et,I[b+13],5,-1444681467),et=g(et,$,W,q,I[b+2],9,-51403784),q=g(q,et,$,W,I[b+7],14,1735328473),W=g(W,q,et,$,I[b+12],20,-1926607734),$=S($,W,q,et,I[b+5],4,-378558),et=S(et,$,W,q,I[b+8],11,-2022574463),q=S(q,et,$,W,I[b+11],16,1839030562),W=S(W,q,et,$,I[b+14],23,-35309556),$=S($,W,q,et,I[b+1],4,-1530992060),et=S(et,$,W,q,I[b+4],11,1272893353),q=S(q,et,$,W,I[b+7],16,-155497632),W=S(W,q,et,$,I[b+10],23,-1094730640),$=S($,W,q,et,I[b+13],4,681279174),et=S(et,$,W,q,I[b+0],11,-358537222),q=S(q,et,$,W,I[b+3],16,-722521979),W=S(W,q,et,$,I[b+6],23,76029189),$=S($,W,q,et,I[b+9],4,-640364487),et=S(et,$,W,q,I[b+12],11,-421815835),q=S(q,et,$,W,I[b+15],16,530742520),W=S(W,q,et,$,I[b+2],23,-995338651),$=w($,W,q,et,I[b+0],6,-198630844),et=w(et,$,W,q,I[b+7],10,1126891415),q=w(q,et,$,W,I[b+14],15,-1416354905),W=w(W,q,et,$,I[b+5],21,-57434055),$=w($,W,q,et,I[b+12],6,1700485571),et=w(et,$,W,q,I[b+3],10,-1894986606),q=w(q,et,$,W,I[b+10],15,-1051523),W=w(W,q,et,$,I[b+1],21,-2054922799),$=w($,W,q,et,I[b+8],6,1873313359),et=w(et,$,W,q,I[b+15],10,-30611744),q=w(q,et,$,W,I[b+6],15,-1560198380),W=w(W,q,et,$,I[b+13],21,1309151649),$=w($,W,q,et,I[b+4],6,-145523070),et=w(et,$,W,q,I[b+11],10,-1120210379),q=w(q,et,$,W,I[b+2],15,718787259),W=w(W,q,et,$,I[b+9],21,-343485551),$=u($,M),W=u(W,F),q=u(q,V),et=u(et,Z);return l($)+l(W)+l(q)+l(et)}(""+t+e)).slice(0,16),s=i.slice(0,12),r=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},r,n))},Tw=async(n,t,e)=>await Lj(n.buffer,t,e);function Sw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Us(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Sw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Sw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class ae extends di{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==vi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,e,i,s,r,a){if(super(t,r),m(this,"trackMediaType","video"),m(this,"_player",void 0),m(this,"_videoVisibleTimer",null),m(this,"_previousVideoVisibleStatus",void 0),m(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),m(this,"_encoderConfig",void 0),m(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),m(this,"_optimizationMode",void 0),m(this,"_videoHeight",void 0),m(this,"_videoWidth",void 0),m(this,"_forceBitrateLimit",void 0),m(this,"_enabled",!0),m(this,"processorDestination",void 0),m(this,"_processorContext",void 0),Pi()){const{width:c,height:l}=t.getSettings();this._videoWidth=c,this._videoHeight=l}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=e,this._scalabilityMode=i,this._optimizationMode=s,this._hints=a||[],this._hints.indexOf(ze.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(c,l,u){const h=we();return!(h.name!==c||!h.osVersion)&&(u?Number(h.version)>=l&&Number(h.version)<=u:Number(h.version)===l)}(De.CHROME,115)&&nf().indexOf("Windows")!==-1){const c=function(l,u){if("VideoFrame"in window&&"TransformStream"in window&&Ke().supportWebRTCInsertableStream){const h=new MediaStreamTrackProcessor(l),f=new MediaStreamTrackGenerator({kind:"video"});let g,S,w=Date.now();const I=()=>{b&&(clearInterval(b),b=void 0),g&&(g.close(),g=void 0),l.stop(),S=void 0,f.removeEventListener("ended",I)};let b=window.setInterval(()=>{if(S&&g&&Date.now()-w>(u??1e3))try{f.readyState==="live"?S.enqueue(g.clone()):I()}catch{I()}},u??1e3);const M=new TransformStream({transform:(F,V)=>{f.readyState==="live"?(S=V,w=Date.now(),g===void 0?(g=F,V.enqueue(F.clone())):(V.enqueue(g),g=F)):F.close()}});return f.addEventListener("ended",I),h.readable.pipeThrough(M).pipeTo(f.writable),f}}(t);c&&(v.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}e&&this._hints.indexOf(ze.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(e),this.processorContext=new dw(this.getTrackId(),"local"),this.processorDestination=new cw(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const i=Us(Us(Us({},this._getDefaultPlayerConfig()),e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new qT(i):this._player=new Ew(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(ka.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},U("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await He(this,St.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return e||(this._enabled=!1),void v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await He(this,St.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),e||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await He(this,St.NEED_MUTE_TRACK,this):await He(this,St.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,e){if(!this._enabled)throw new Q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Jo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=Mf({encoderConfig:t});(Pi()||Li()||uo())&&(i.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const r=new Q(O.UNEXPECTED_ERROR,s.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),r.toString()),r}}this._encoderConfig=t,this._hints.indexOf(ze.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await He(this,St.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(v)}}getStats(){return Pu(()=>{v.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),us(this,St.GET_STATS)||Us({},MT)}async setBeautyEffect(t){v.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,e):await KT(t)}async setBitrateLimit(t){if(v.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await He(this,St.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(v)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void v.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const e=this._optimizationMode;try{this._optimizationMode=t,await He(this,St.SET_OPTIMIZATION_MODE,this)}catch(i){throw this._optimizationMode=e,v.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return v.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,v.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){gw(this._originMediaStreamTrack).then(t=>{let[e,i]=t;this._videoHeight=i,this._videoWidth=e}).catch(df)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:e,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!e||!i)return;const[s,r]=function(a,c,l,u){let h;const f=200*Math.pow(l/15,.6)*Math.pow(a*c/640/360,.75),g=f;if(u==="STANDARD_BITRATE")h=4*f;else{if(u!=="COMPATIABLE_BITRATE")return;h=2*f}return[Math.floor(h),Math.floor(g)]}(t,e,i,U("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=r,this._encoderConfig.bitrateMax=s,v.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(e,", fps: ").concat(i,"] => [brMax: ").concat(s,", brMin: ").concat(r,"]")))}getVideoElementVisibleStatus(){try{var t,e;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:r,slot:a}=s;if(this.isPlaying&&r instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=ab.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(i){throw new Q(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Us(Us({},i),Jo(t))),i=Oc(i);const s=Be(8,"track-video-cloned-"),r=new ae(e?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Oc(this._scalabilityMode),this._optimizationMode,s,Oc(this._hints));return t&&i&&r.setEncoderConfiguration(i),v.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(e)),r}async replaceTrack(t,e){if(!(t instanceof MediaStreamTrack))throw new Q(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Q(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,e,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(Si.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await He(this,St.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await He(this,St.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Si.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(is.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(is.REQUEST_CONSTRAINTS)}}tt([Ft({argsMap:(n,t,e)=>[n.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",e]}),pn(),A("design:type",Function),A("design:paramtypes",[Object,Object]),A("design:returntype",void 0)],ae.prototype,"play",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],ae.prototype,"stop",null),tt([Bd("LocalVideoTrack","_enabledMutex"),Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[Boolean,Boolean]),A("design:returntype",K)],ae.prototype,"setEnabled",null),tt([Bd("LocalVideoTrack","_enabledMutex"),Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",K)],ae.prototype,"setMuted",null),tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",K)],ae.prototype,"setEncoderConfiguration",null),tt([pn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Object)],ae.prototype,"getStats",null),tt([Ft({argsMap:(n,t,e)=>[n.getTrackId(),t,e]}),pn(),A("design:type",Function),A("design:paramtypes",[Boolean,Object]),A("design:returntype",K)],ae.prototype,"setBeautyEffect",null),tt([pn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",ImageData)],ae.prototype,"getCurrentFrameData",null),tt([pn(),A("design:type",Function),A("design:paramtypes",[String,Number]),A("design:returntype",K)],ae.prototype,"getCurrentFrameImage",null),tt([pn(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],ae.prototype,"setBitrateLimit",null),tt([pn(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],ae.prototype,"setOptimizationMode",null),tt([pn(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],ae.prototype,"setScalabiltyMode",null),tt([pn(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],ae.prototype,"updateMediaStreamTrackResolution",null),tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],ae.prototype,"pipe",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],ae.prototype,"unpipe",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],ae.prototype,"close",null),tt([Ft({argsMap:(n,t,e)=>[n.getTrackId(),t.label,e]}),A("design:type",Function),A("design:paramtypes",[MediaStreamTrack,Boolean]),A("design:returntype",K)],ae.prototype,"replaceTrack",null);class xa extends ae{get __className__(){return"CameraVideoTrack"}constructor(t,e,i,s,r,a){super(t,Jo(e.encoderConfig),s,r,a),m(this,"_config",void 0),m(this,"_originalConstraints",void 0),m(this,"_constraints",void 0),m(this,"_enabled",!0),m(this,"_deviceName","default"),m(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ud()||Hg())&&!function(){const c=we();if(c.os!==Kn.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2}()&&nb()&&this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=e,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=Jo(this._config.encoderConfig),Me.on(zn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Me.on(zn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(v.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const e=await ks.getDeviceById(t),i={};i.video=Us({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await Ls(i,this.getTrackId())}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),s=await Ls({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=e.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await ks.getDeviceById(t);this._deviceName=e.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}v.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){v.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const e={video:Us(Us({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Ls(e,this.getTrackId())}catch(s){throw v.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),i=await Ls({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Us({},e.video),v.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Ls({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await He(this,St.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),e||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),e||(this._enabled=!1);try{await He(this,St.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,e){if(!this._enabled)throw new Q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Jo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin);const i=Rn(this._config);i.encoderConfig=t;const s=Mf(i);(Pi()||Li()||uo())&&(s.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(r){const a=new Q(O.UNEXPECTED_ERROR,r.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=i,this._constraints=s,this._originalConstraints=s,this._encoderConfig=t,this._hints.indexOf(ze.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await He(this,St.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(v)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Li()||uo())&&this._enabled&&!this._isClosed&&Me.duringInterruption){const t=async()=>{Me.off(zn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Me.on(zn.IOS_INTERRUPTION_END,t)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ka.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,i=ks.searchDeviceIdByName(this._deviceName);if(i&&!e.deviceId&&(e.deviceId={exact:i}),this._enabled){const s=await Ls({video:e},this.getTrackId());this._constraints=e,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Me.off(zn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Me.off(zn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Us(Us({},i),Jo(t))),i=Oc(i);const s=Be(8,"track-cam-cloned-"),r=new xa(e?this._mediaStreamTrack.clone():this._mediaStreamTrack,Oc(Us(Us({},this._config),{},{encoderConfig:i})),Oc(this._constraints),Oc(this._scalabilityMode),this._optimizationMode,s);return t&&i&&r.setEncoderConfiguration(i),v.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(e)),r}bindProcessorContextEvents(){this.processorContext.on(is.REQUEST_UPDATE_CONSTRAINTS,async(t,e,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),e()}catch(s){i(s)}}),this.processorContext.on(is.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}}function vw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Uf(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?vw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):vw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function YT(n,t,e,i){e.optimizationMode&&(i&&i.width&&i.height?(e.encoderConfig=Uf(Uf({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),e.optimizationMode!=="motion"&&e.optimizationMode!=="detail"||(t.contentHint=e.optimizationMode,t.contentHint===e.optimizationMode?v.debug("[".concat(n,"] set content hint to"),e.optimizationMode):v.debug("[".concat(n,"] set content hint failed")))):v.warning("[".concat(n,"] can not apply optimization mode bitrate config, no encoderConfig")))}function Cw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function xf(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Cw(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Cw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],xa.prototype,"setDevice",null),tt([Bd("CameraVideoTrack","_enabledMutex"),Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[Boolean,Boolean]),A("design:returntype",K)],xa.prototype,"setEnabled",null),tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),pn(),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",K)],xa.prototype,"setEncoderConfiguration",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],xa.prototype,"close",null);class yw extends qA{getUserId(){return this._userId}constructor(t,e,i,s){super(t,"track-".concat(t.kind,"-").concat(e,"-").concat(s.clientId,"_").concat(Be(5,""))),m(this,"_userId",void 0),m(this,"_uintId",void 0),m(this,"_isDestroyed",!1),m(this,"store",void 0),m(this,"processor",void 0),this._userId=e,this._uintId=i,this.store=s}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,v.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class mo extends yw{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==vi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,i,s){super(t,e,i,s),m(this,"_videoVisibleTimer",null),m(this,"_previousVideoVisibleStatus",void 0),m(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),m(this,"trackMediaType","video"),m(this,"_videoWidth",void 0),m(this,"_videoHeight",void 0),m(this,"_player",void 0),m(this,"processorDestination",void 0),m(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new dw(this.getTrackId(),"remote"),this.processorDestination=new cw(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Pu(()=>{v.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),us(this,St.GET_STATS)||xf({},KA)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const i=xf(xf({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new qT(i):this._player=new Ew(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Mc.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(Mc.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},U("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){gw(this._originMediaStreamTrack).then(t=>{let[e,i]=t;this._videoHeight=i,this._videoWidth=e}).catch(df)}_updatePlayerSource(){v.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:r,slot:a}=s;if(this.isPlaying&&r instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=ab.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(i){throw new Q(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Si.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Si.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}tt([Ft({argsMap:(n,t,e)=>[n.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",e]}),A("design:type",Function),A("design:paramtypes",[Object,Object]),A("design:returntype",void 0)],mo.prototype,"play",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],mo.prototype,"stop",null),tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],mo.prototype,"pipe",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],mo.prototype,"unpipe",null);class Tr extends yw{get isPlaying(){return this._useAudioElement?ps.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,i,s){super(t,e,i,s),m(this,"trackMediaType","audio"),m(this,"_source",void 0),m(this,"_useAudioElement",!0),m(this,"_volume",100),m(this,"processorContext",void 0),m(this,"processorDestination",void 0),m(this,"_played",!1),m(this,"_bypassWebAudio",!1),U("DISABLE_WEBAUDIO")?(this._source=new GT,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new FT(t,!0),U("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ns.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Mc.FIRST_FRAME_DECODED)}),this.processorContext=new kf(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Lf(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ns.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ns.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ns.ON_AUDIO_BUFFER),this._source.on(ns.ON_AUDIO_BUFFER,i=>t(i))}setVolume(t){this._volume=t,this._useAudioElement?ps.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement)throw new Q(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ps.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Pu(()=>{v.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),us(this,St.GET_STATS)||xf({},HA)}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] use audio element to play")),ps.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ps.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ps.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Si.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Si.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Si.ON_TRACK),this.processorDestination.removeAllListeners(Si.ON_NODE)}}tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t],throttleTime:300}),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Tr.prototype,"setVolume",null),tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t]}),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Tr.prototype,"setPlaybackDevice",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Tr.prototype,"play",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Tr.prototype,"stop",null),tt([Ft({argsMap:(n,t)=>[n.getTrackId(),t.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],Tr.prototype,"pipe",null),tt([Ft({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Tr.prototype,"unpipe",null);function el(n){let t=n.length;for(;--t>=0;)n[t]=0}const zT=256,Rw=286,Fu=30,Bu=15,JT=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Vf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),kj=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Iw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qo=new Array(576);el(Qo);const ju=new Array(60);el(ju);const Gu=new Array(512);el(Gu);const Wu=new Array(256);el(Wu);const XT=new Array(29);el(XT);const Ff=new Array(Fu);function $T(n,t,e,i,s){this.static_tree=n,this.extra_bits=t,this.extra_base=e,this.elems=i,this.max_length=s,this.has_stree=n&&n.length}let bw,Aw,ww;function QT(n,t){this.dyn_tree=n,this.max_code=0,this.stat_desc=t}el(Ff);const Ow=n=>n<256?Gu[n]:Gu[256+(n>>>7)],Hu=(n,t)=>{n.pending_buf[n.pending++]=255&t,n.pending_buf[n.pending++]=t>>>8&255},xs=(n,t,e)=>{n.bi_valid>16-e?(n.bi_buf|=t<<n.bi_valid&65535,Hu(n,n.bi_buf),n.bi_buf=t>>16-n.bi_valid,n.bi_valid+=e-16):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=e)},Eo=(n,t,e)=>{xs(n,e[2*t],e[2*t+1])},Nw=(n,t)=>{let e=0;do e|=1&n,n>>>=1,e<<=1;while(--t>0);return e>>>1},Dw=(n,t,e)=>{const i=new Array(16);let s,r,a=0;for(s=1;s<=Bu;s++)a=a+e[s-1]<<1,i[s]=a;for(r=0;r<=t;r++){let c=n[2*r+1];c!==0&&(n[2*r]=Nw(i[c]++,c))}},Pw=n=>{let t;for(t=0;t<Rw;t++)n.dyn_ltree[2*t]=0;for(t=0;t<Fu;t++)n.dyn_dtree[2*t]=0;for(t=0;t<19;t++)n.bl_tree[2*t]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},Lw=n=>{n.bi_valid>8?Hu(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},kw=(n,t,e,i)=>{const s=2*t,r=2*e;return n[s]<n[r]||n[s]===n[r]&&i[t]<=i[e]},ZT=(n,t,e)=>{const i=n.heap[e];let s=e<<1;for(;s<=n.heap_len&&(s<n.heap_len&&kw(t,n.heap[s+1],n.heap[s],n.depth)&&s++,!kw(t,i,n.heap[s],n.depth));)n.heap[e]=n.heap[s],e=s,s<<=1;n.heap[e]=i},Mw=(n,t,e)=>{let i,s,r,a,c=0;if(n.sym_next!==0)do i=255&n.pending_buf[n.sym_buf+c++],i+=(255&n.pending_buf[n.sym_buf+c++])<<8,s=n.pending_buf[n.sym_buf+c++],i===0?Eo(n,s,t):(r=Wu[s],Eo(n,r+zT+1,t),a=JT[r],a!==0&&(s-=XT[r],xs(n,s,a)),i--,r=Ow(i),Eo(n,r,e),a=Vf[r],a!==0&&(i-=Ff[r],xs(n,i,a)));while(c<n.sym_next);Eo(n,256,t)},tS=(n,t)=>{const e=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let a,c,l,u=-1;for(n.heap_len=0,n.heap_max=573,a=0;a<r;a++)e[2*a]!==0?(n.heap[++n.heap_len]=u=a,n.depth[a]=0):e[2*a+1]=0;for(;n.heap_len<2;)l=n.heap[++n.heap_len]=u<2?++u:0,e[2*l]=1,n.depth[l]=0,n.opt_len--,s&&(n.static_len-=i[2*l+1]);for(t.max_code=u,a=n.heap_len>>1;a>=1;a--)ZT(n,e,a);l=r;do a=n.heap[1],n.heap[1]=n.heap[n.heap_len--],ZT(n,e,1),c=n.heap[1],n.heap[--n.heap_max]=a,n.heap[--n.heap_max]=c,e[2*l]=e[2*a]+e[2*c],n.depth[l]=(n.depth[a]>=n.depth[c]?n.depth[a]:n.depth[c])+1,e[2*a+1]=e[2*c+1]=l,n.heap[1]=l++,ZT(n,e,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((h,f)=>{const g=f.dyn_tree,S=f.max_code,w=f.stat_desc.static_tree,I=f.stat_desc.has_stree,b=f.stat_desc.extra_bits,M=f.stat_desc.extra_base,F=f.stat_desc.max_length;let V,Z,$,W,q,et,_t=0;for(W=0;W<=Bu;W++)h.bl_count[W]=0;for(g[2*h.heap[h.heap_max]+1]=0,V=h.heap_max+1;V<573;V++)Z=h.heap[V],W=g[2*g[2*Z+1]+1]+1,W>F&&(W=F,_t++),g[2*Z+1]=W,Z>S||(h.bl_count[W]++,q=0,Z>=M&&(q=b[Z-M]),et=g[2*Z],h.opt_len+=et*(W+q),I&&(h.static_len+=et*(w[2*Z+1]+q)));if(_t!==0){do{for(W=F-1;h.bl_count[W]===0;)W--;h.bl_count[W]--,h.bl_count[W+1]+=2,h.bl_count[F]--,_t-=2}while(_t>0);for(W=F;W!==0;W--)for(Z=h.bl_count[W];Z!==0;)$=h.heap[--V],$>S||(g[2*$+1]!==W&&(h.opt_len+=(W-g[2*$+1])*g[2*$],g[2*$+1]=W),Z--)}})(n,t),Dw(e,u,n.bl_count)},Uw=(n,t,e)=>{let i,s,r=-1,a=t[1],c=0,l=7,u=4;for(a===0&&(l=138,u=3),t[2*(e+1)+1]=65535,i=0;i<=e;i++)s=a,a=t[2*(i+1)+1],++c<l&&s===a||(c<u?n.bl_tree[2*s]+=c:s!==0?(s!==r&&n.bl_tree[2*s]++,n.bl_tree[32]++):c<=10?n.bl_tree[34]++:n.bl_tree[36]++,c=0,r=s,a===0?(l=138,u=3):s===a?(l=6,u=3):(l=7,u=4))},xw=(n,t,e)=>{let i,s,r=-1,a=t[1],c=0,l=7,u=4;for(a===0&&(l=138,u=3),i=0;i<=e;i++)if(s=a,a=t[2*(i+1)+1],!(++c<l&&s===a)){if(c<u)do Eo(n,s,n.bl_tree);while(--c!=0);else s!==0?(s!==r&&(Eo(n,s,n.bl_tree),c--),Eo(n,16,n.bl_tree),xs(n,c-3,2)):c<=10?(Eo(n,17,n.bl_tree),xs(n,c-3,3)):(Eo(n,18,n.bl_tree),xs(n,c-11,7));c=0,r=s,a===0?(l=138,u=3):s===a?(l=6,u=3):(l=7,u=4)}};let Vw=!1;const Fw=(n,t,e,i)=>{xs(n,0+(i?1:0),3),Lw(n),Hu(n,e),Hu(n,~e),e&&n.pending_buf.set(n.window.subarray(t,t+e),n.pending),n.pending+=e};var Mj=n=>{Vw||((()=>{let t,e,i,s,r;const a=new Array(16);for(i=0,s=0;s<28;s++)for(XT[s]=i,t=0;t<1<<JT[s];t++)Wu[i++]=s;for(Wu[i-1]=s,r=0,s=0;s<16;s++)for(Ff[s]=r,t=0;t<1<<Vf[s];t++)Gu[r++]=s;for(r>>=7;s<Fu;s++)for(Ff[s]=r<<7,t=0;t<1<<Vf[s]-7;t++)Gu[256+r++]=s;for(e=0;e<=Bu;e++)a[e]=0;for(t=0;t<=143;)Qo[2*t+1]=8,t++,a[8]++;for(;t<=255;)Qo[2*t+1]=9,t++,a[9]++;for(;t<=279;)Qo[2*t+1]=7,t++,a[7]++;for(;t<=287;)Qo[2*t+1]=8,t++,a[8]++;for(Dw(Qo,287,a),t=0;t<Fu;t++)ju[2*t+1]=5,ju[2*t]=Nw(t,5);bw=new $T(Qo,JT,257,Rw,Bu),Aw=new $T(ju,Vf,0,Fu,Bu),ww=new $T(new Array(0),kj,0,19,7)})(),Vw=!0),n.l_desc=new QT(n.dyn_ltree,bw),n.d_desc=new QT(n.dyn_dtree,Aw),n.bl_desc=new QT(n.bl_tree,ww),n.bi_buf=0,n.bi_valid=0,Pw(n)},Uj=(n,t,e,i)=>{let s,r,a=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(c=>{let l,u=4093624447;for(l=0;l<=31;l++,u>>>=1)if(1&u&&c.dyn_ltree[2*l]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(l=32;l<zT;l++)if(c.dyn_ltree[2*l]!==0)return 1;return 0})(n)),tS(n,n.l_desc),tS(n,n.d_desc),a=(c=>{let l;for(Uw(c,c.dyn_ltree,c.l_desc.max_code),Uw(c,c.dyn_dtree,c.d_desc.max_code),tS(c,c.bl_desc),l=18;l>=3&&c.bl_tree[2*Iw[l]+1]===0;l--);return c.opt_len+=3*(l+1)+5+5+4,l})(n),s=n.opt_len+3+7>>>3,r=n.static_len+3+7>>>3,r<=s&&(s=r)):s=r=e+5,e+4<=s&&t!==-1?Fw(n,t,e,i):n.strategy===4||r===s?(xs(n,2+(i?1:0),3),Mw(n,Qo,ju)):(xs(n,4+(i?1:0),3),((c,l,u,h)=>{let f;for(xs(c,l-257,5),xs(c,u-1,5),xs(c,h-4,4),f=0;f<h;f++)xs(c,c.bl_tree[2*Iw[f]+1],3);xw(c,c.dyn_ltree,l-1),xw(c,c.dyn_dtree,u-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,a+1),Mw(n,n.dyn_ltree,n.dyn_dtree)),Pw(n),i&&Lw(n)},xj=(n,t,e)=>(n.pending_buf[n.sym_buf+n.sym_next++]=t,n.pending_buf[n.sym_buf+n.sym_next++]=t>>8,n.pending_buf[n.sym_buf+n.sym_next++]=e,t===0?n.dyn_ltree[2*e]++:(n.matches++,t--,n.dyn_ltree[2*(Wu[e]+zT+1)]++,n.dyn_dtree[2*Ow(t)]++),n.sym_next===n.sym_end),Vj={_tr_init:Mj,_tr_stored_block:Fw,_tr_flush_block:Uj,_tr_tally:xj,_tr_align:n=>{xs(n,2,3),Eo(n,256,Qo),(t=>{t.bi_valid===16?(Hu(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(n)}},Ku=(n,t,e,i)=>{let s=65535&n|0,r=n>>>16&65535|0,a=0;for(;e!==0;){a=e>2e3?2e3:e,e-=a;do s=s+t[i++]|0,r=r+s|0;while(--a);s%=65521,r%=65521}return s|r<<16|0};const Fj=new Uint32Array((()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var i=0;i<8;i++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t})());var xi=(n,t,e,i)=>{const s=Fj,r=i+e;n^=-1;for(let a=i;a<r;a++)n=n>>>8^s[255&(n^t[a])];return-1^n},Vc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},nl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Bj,_tr_stored_block:eS,_tr_flush_block:jj,_tr_tally:Va,_tr_align:Gj}=Vj,{Z_NO_FLUSH:Fa,Z_PARTIAL_FLUSH:Wj,Z_FULL_FLUSH:Hj,Z_FINISH:Sr,Z_BLOCK:Bw,Z_OK:qi,Z_STREAM_END:jw,Z_STREAM_ERROR:go,Z_DATA_ERROR:Kj,Z_BUF_ERROR:nS,Z_DEFAULT_COMPRESSION:qj,Z_FILTERED:Yj,Z_HUFFMAN_ONLY:Bf,Z_RLE:zj,Z_FIXED:Jj,Z_DEFAULT_STRATEGY:Xj,Z_UNKNOWN:$j,Z_DEFLATED:jf}=nl,iS=286,Qj=30,Zj=19,t3=2*iS+1,e3=15,Fc=258,To=262,il=42,Bc=113,qu=666,jc=(n,t)=>(n.msg=Vc[t],t),Gw=n=>2*n-(n>4?9:0),Ba=n=>{let t=n.length;for(;--t>=0;)n[t]=0},n3=n=>{let t,e,i,s=n.w_size;t=n.hash_size,i=t;do e=n.head[--i],n.head[i]=e>=s?e-s:0;while(--t);t=s,i=t;do e=n.prev[--i],n.prev[i]=e>=s?e-s:0;while(--t)};let ja=(n,t,e)=>(t<<n.hash_shift^e)&n.hash_mask;const $s=n=>{const t=n.state;let e=t.pending;e>n.avail_out&&(e=n.avail_out),e!==0&&(n.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),n.next_out),n.next_out+=e,t.pending_out+=e,n.total_out+=e,n.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},Qs=(n,t)=>{jj(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,$s(n.strm)},ln=(n,t)=>{n.pending_buf[n.pending++]=t},Yu=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=255&t},sS=(n,t,e,i)=>{let s=n.avail_in;return s>i&&(s=i),s===0?0:(n.avail_in-=s,t.set(n.input.subarray(n.next_in,n.next_in+s),e),n.state.wrap===1?n.adler=Ku(n.adler,t,s,e):n.state.wrap===2&&(n.adler=xi(n.adler,t,s,e)),n.next_in+=s,n.total_in+=s,s)},Ww=(n,t)=>{let e,i,s=n.max_chain_length,r=n.strstart,a=n.prev_length,c=n.nice_match;const l=n.strstart>n.w_size-To?n.strstart-(n.w_size-To):0,u=n.window,h=n.w_mask,f=n.prev,g=n.strstart+Fc;let S=u[r+a-1],w=u[r+a];n.prev_length>=n.good_match&&(s>>=2),c>n.lookahead&&(c=n.lookahead);do if(e=t,u[e+a]===w&&u[e+a-1]===S&&u[e]===u[r]&&u[++e]===u[r+1]){r+=2,e++;do;while(u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&u[++r]===u[++e]&&r<g);if(i=Fc-(g-r),r=g-Fc,i>a){if(n.match_start=t,a=i,i>=c)break;S=u[r+a-1],w=u[r+a]}}while((t=f[t&h])>l&&--s!=0);return a<=n.lookahead?a:n.lookahead},sl=n=>{const t=n.w_size;let e,i,s;do{if(i=n.window_size-n.lookahead-n.strstart,n.strstart>=t+(t-To)&&(n.window.set(n.window.subarray(t,t+t-i),0),n.match_start-=t,n.strstart-=t,n.block_start-=t,n.insert>n.strstart&&(n.insert=n.strstart),n3(n),i+=t),n.strm.avail_in===0)break;if(e=sS(n.strm,n.window,n.strstart+n.lookahead,i),n.lookahead+=e,n.lookahead+n.insert>=3)for(s=n.strstart-n.insert,n.ins_h=n.window[s],n.ins_h=ja(n,n.ins_h,n.window[s+1]);n.insert&&(n.ins_h=ja(n,n.ins_h,n.window[s+3-1]),n.prev[s&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=s,s++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<To&&n.strm.avail_in!==0)},Hw=(n,t)=>{let e,i,s,r=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,a=0,c=n.strm.avail_in;do{if(e=65535,s=n.bi_valid+42>>3,n.strm.avail_out<s||(s=n.strm.avail_out-s,i=n.strstart-n.block_start,e>i+n.strm.avail_in&&(e=i+n.strm.avail_in),e>s&&(e=s),e<r&&(e===0&&t!==Sr||t===Fa||e!==i+n.strm.avail_in)))break;a=t===Sr&&e===i+n.strm.avail_in?1:0,eS(n,0,0,a),n.pending_buf[n.pending-4]=e,n.pending_buf[n.pending-3]=e>>8,n.pending_buf[n.pending-2]=~e,n.pending_buf[n.pending-1]=~e>>8,$s(n.strm),i&&(i>e&&(i=e),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+i),n.strm.next_out),n.strm.next_out+=i,n.strm.avail_out-=i,n.strm.total_out+=i,n.block_start+=i,e-=i),e&&(sS(n.strm,n.strm.output,n.strm.next_out,e),n.strm.next_out+=e,n.strm.avail_out-=e,n.strm.total_out+=e)}while(a===0);return c-=n.strm.avail_in,c&&(c>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=c&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-c,n.strm.next_in),n.strstart),n.strstart+=c,n.insert+=c>n.w_size-n.insert?n.w_size-n.insert:c),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),a?4:t!==Fa&&t!==Sr&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(s=n.window_size-n.strstart,n.strm.avail_in>s&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,s+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),s>n.strm.avail_in&&(s=n.strm.avail_in),s&&(sS(n.strm,n.window,n.strstart,s),n.strstart+=s,n.insert+=s>n.w_size-n.insert?n.w_size-n.insert:s),n.high_water<n.strstart&&(n.high_water=n.strstart),s=n.bi_valid+42>>3,s=n.pending_buf_size-s>65535?65535:n.pending_buf_size-s,r=s>n.w_size?n.w_size:s,i=n.strstart-n.block_start,(i>=r||(i||t===Sr)&&t!==Fa&&n.strm.avail_in===0&&i<=s)&&(e=i>s?s:i,a=t===Sr&&n.strm.avail_in===0&&e===i?1:0,eS(n,n.block_start,e,a),n.block_start+=e,$s(n.strm)),a?3:1)},rS=(n,t)=>{let e,i;for(;;){if(n.lookahead<To){if(sl(n),n.lookahead<To&&t===Fa)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=ja(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),e!==0&&n.strstart-e<=n.w_size-To&&(n.match_length=Ww(n,e)),n.match_length>=3)if(i=Va(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=ja(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=ja(n,n.ins_h,n.window[n.strstart+1]);else i=Va(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(i&&(Qs(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,t===Sr?(Qs(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Qs(n,!1),n.strm.avail_out===0)?1:2},rl=(n,t)=>{let e,i,s;for(;;){if(n.lookahead<To){if(sl(n),n.lookahead<To&&t===Fa)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=ja(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,e!==0&&n.prev_length<n.max_lazy_match&&n.strstart-e<=n.w_size-To&&(n.match_length=Ww(n,e),n.match_length<=5&&(n.strategy===Yj||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){s=n.strstart+n.lookahead-3,i=Va(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=s&&(n.ins_h=ja(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,i&&(Qs(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(i=Va(n,0,n.window[n.strstart-1]),i&&Qs(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(i=Va(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,t===Sr?(Qs(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Qs(n,!1),n.strm.avail_out===0)?1:2};function So(n,t,e,i,s){this.good_length=n,this.max_lazy=t,this.nice_length=e,this.max_chain=i,this.func=s}const zu=[new So(0,0,0,0,Hw),new So(4,4,8,4,rS),new So(4,5,16,8,rS),new So(4,6,32,32,rS),new So(4,4,16,16,rl),new So(8,16,32,32,rl),new So(8,16,128,128,rl),new So(8,32,128,256,rl),new So(32,128,258,1024,rl),new So(32,258,258,4096,rl)];function i3(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=jf,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*t3),this.dyn_dtree=new Uint16Array(2*(2*Qj+1)),this.bl_tree=new Uint16Array(2*(2*Zj+1)),Ba(this.dyn_ltree),Ba(this.dyn_dtree),Ba(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(e3+1),this.heap=new Uint16Array(2*iS+1),Ba(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*iS+1),Ba(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ju=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.status!==il&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Bc&&t.status!==qu?1:0},Kw=n=>{if(Ju(n))return jc(n,go);n.total_in=n.total_out=0,n.data_type=$j;const t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?il:Bc,n.adler=t.wrap===2?0:1,t.last_flush=-2,Bj(t),qi},qw=n=>{const t=Kw(n);var e;return t===qi&&((e=n.state).window_size=2*e.w_size,Ba(e.head),e.max_lazy_match=zu[e.level].max_lazy,e.good_match=zu[e.level].good_length,e.nice_match=zu[e.level].nice_length,e.max_chain_length=zu[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t},Yw=(n,t,e,i,s,r)=>{if(!n)return go;let a=1;if(t===qj&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),s<1||s>9||e!==jf||i<8||i>15||t<0||t>9||r<0||r>Jj||i===8&&a!==1)return jc(n,go);i===8&&(i=9);const c=new i3;return n.state=c,c.strm=n,c.status=il,c.wrap=a,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=t,c.strategy=r,c.method=e,qw(n)};var s3=(n,t)=>{if(Ju(n)||t>Bw||t<0)return n?jc(n,go):go;const e=n.state;if(!n.output||n.avail_in!==0&&!n.input||e.status===qu&&t!==Sr)return jc(n,n.avail_out===0?nS:go);const i=e.last_flush;if(e.last_flush=t,e.pending!==0){if($s(n),n.avail_out===0)return e.last_flush=-1,qi}else if(n.avail_in===0&&Gw(t)<=Gw(i)&&t!==Sr)return jc(n,nS);if(e.status===qu&&n.avail_in!==0)return jc(n,nS);if(e.status===il&&e.wrap===0&&(e.status=Bc),e.status===il){let s=jf+(e.w_bits-8<<4)<<8,r=-1;if(r=e.strategy>=Bf||e.level<2?0:e.level<6?1:e.level===6?2:3,s|=r<<6,e.strstart!==0&&(s|=32),s+=31-s%31,Yu(e,s),e.strstart!==0&&(Yu(e,n.adler>>>16),Yu(e,65535&n.adler)),n.adler=1,e.status=Bc,$s(n),e.pending!==0)return e.last_flush=-1,qi}if(e.status===57){if(n.adler=0,ln(e,31),ln(e,139),ln(e,8),e.gzhead)ln(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),ln(e,255&e.gzhead.time),ln(e,e.gzhead.time>>8&255),ln(e,e.gzhead.time>>16&255),ln(e,e.gzhead.time>>24&255),ln(e,e.level===9?2:e.strategy>=Bf||e.level<2?4:0),ln(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(ln(e,255&e.gzhead.extra.length),ln(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(n.adler=xi(n.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69;else if(ln(e,0),ln(e,0),ln(e,0),ln(e,0),ln(e,0),ln(e,e.level===9?2:e.strategy>=Bf||e.level<2?4:0),ln(e,3),e.status=Bc,$s(n),e.pending!==0)return e.last_flush=-1,qi}if(e.status===69){if(e.gzhead.extra){let s=e.pending,r=(65535&e.gzhead.extra.length)-e.gzindex;for(;e.pending+r>e.pending_buf_size;){let c=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+c),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(n.adler=xi(n.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=c,$s(n),e.pending!==0)return e.last_flush=-1,qi;s=0,r-=c}let a=new Uint8Array(e.gzhead.extra);e.pending_buf.set(a.subarray(e.gzindex,e.gzindex+r),e.pending),e.pending+=r,e.gzhead.hcrc&&e.pending>s&&(n.adler=xi(n.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=73}if(e.status===73){if(e.gzhead.name){let s,r=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(n.adler=xi(n.adler,e.pending_buf,e.pending-r,r)),$s(n),e.pending!==0)return e.last_flush=-1,qi;r=0}s=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,ln(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>r&&(n.adler=xi(n.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=91}if(e.status===91){if(e.gzhead.comment){let s,r=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(n.adler=xi(n.adler,e.pending_buf,e.pending-r,r)),$s(n),e.pending!==0)return e.last_flush=-1,qi;r=0}s=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,ln(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>r&&(n.adler=xi(n.adler,e.pending_buf,e.pending-r,r))}e.status=103}if(e.status===103){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&($s(n),e.pending!==0))return e.last_flush=-1,qi;ln(e,255&n.adler),ln(e,n.adler>>8&255),n.adler=0}if(e.status=Bc,$s(n),e.pending!==0)return e.last_flush=-1,qi}if(n.avail_in!==0||e.lookahead!==0||t!==Fa&&e.status!==qu){let s=e.level===0?Hw(e,t):e.strategy===Bf?((r,a)=>{let c;for(;;){if(r.lookahead===0&&(sl(r),r.lookahead===0)){if(a===Fa)return 1;break}if(r.match_length=0,c=Va(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,c&&(Qs(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,a===Sr?(Qs(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(Qs(r,!1),r.strm.avail_out===0)?1:2})(e,t):e.strategy===zj?((r,a)=>{let c,l,u,h;const f=r.window;for(;;){if(r.lookahead<=Fc){if(sl(r),r.lookahead<=Fc&&a===Fa)return 1;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=3&&r.strstart>0&&(u=r.strstart-1,l=f[u],l===f[++u]&&l===f[++u]&&l===f[++u])){h=r.strstart+Fc;do;while(l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&l===f[++u]&&u<h);r.match_length=Fc-(h-u),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=3?(c=Va(r,1,r.match_length-3),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(c=Va(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),c&&(Qs(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,a===Sr?(Qs(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(Qs(r,!1),r.strm.avail_out===0)?1:2})(e,t):zu[e.level].func(e,t);if(s!==3&&s!==4||(e.status=qu),s===1||s===3)return n.avail_out===0&&(e.last_flush=-1),qi;if(s===2&&(t===Wj?Gj(e):t!==Bw&&(eS(e,0,0,!1),t===Hj&&(Ba(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),$s(n),n.avail_out===0))return e.last_flush=-1,qi}return t!==Sr?qi:e.wrap<=0?jw:(e.wrap===2?(ln(e,255&n.adler),ln(e,n.adler>>8&255),ln(e,n.adler>>16&255),ln(e,n.adler>>24&255),ln(e,255&n.total_in),ln(e,n.total_in>>8&255),ln(e,n.total_in>>16&255),ln(e,n.total_in>>24&255)):(Yu(e,n.adler>>>16),Yu(e,65535&n.adler)),$s(n),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?qi:jw)},r3=(n,t)=>{let e=t.length;if(Ju(n))return go;const i=n.state,s=i.wrap;if(s===2||s===1&&i.status!==il||i.lookahead)return go;if(s===1&&(n.adler=Ku(n.adler,t,e,0)),i.wrap=0,e>=i.w_size){s===0&&(Ba(i.head),i.strstart=0,i.block_start=0,i.insert=0);let l=new Uint8Array(i.w_size);l.set(t.subarray(e-i.w_size,e),0),t=l,e=i.w_size}const r=n.avail_in,a=n.next_in,c=n.input;for(n.avail_in=e,n.next_in=0,n.input=t,sl(i);i.lookahead>=3;){let l=i.strstart,u=i.lookahead-2;do i.ins_h=ja(i,i.ins_h,i.window[l+3-1]),i.prev[l&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=l,l++;while(--u);i.strstart=l,i.lookahead=2,sl(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,n.next_in=a,n.input=c,n.avail_in=r,i.wrap=s,qi},Xu={deflateInit:(n,t)=>Yw(n,t,jf,15,8,Xj),deflateInit2:Yw,deflateReset:qw,deflateResetKeep:Kw,deflateSetHeader:(n,t)=>Ju(n)||n.state.wrap!==2?go:(n.state.gzhead=t,qi),deflate:s3,deflateEnd:n=>{if(Ju(n))return go;const t=n.state.status;return n.state=null,t===Bc?jc(n,Kj):qi},deflateSetDictionary:r3,deflateInfo:"pako deflate (from Nodeca project)"};const o3=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var Gf={assign:function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const i in e)o3(e,i)&&(n[i]=e[i])}}return n},flattenChunks:n=>{let t=0;for(let i=0,s=n.length;i<s;i++)t+=n[i].length;const e=new Uint8Array(t);for(let i=0,s=0,r=n.length;i<r;i++){let a=n[i];e.set(a,s),s+=a.length}return e}};let zw=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{zw=!1}const $u=new Uint8Array(256);for(let n=0;n<256;n++)$u[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;$u[254]=$u[254]=1;var Qu={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,i,s,r,a=n.length,c=0;for(s=0;s<a;s++)e=n.charCodeAt(s),(64512&e)==55296&&s+1<a&&(i=n.charCodeAt(s+1),(64512&i)==56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),c+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(c),r=0,s=0;r<c;s++)e=n.charCodeAt(s),(64512&e)==55296&&s+1<a&&(i=n.charCodeAt(s+1),(64512&i)==56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),e<128?t[r++]=e:e<2048?(t[r++]=192|e>>>6,t[r++]=128|63&e):e<65536?(t[r++]=224|e>>>12,t[r++]=128|e>>>6&63,t[r++]=128|63&e):(t[r++]=240|e>>>18,t[r++]=128|e>>>12&63,t[r++]=128|e>>>6&63,t[r++]=128|63&e);return t},buf2string:(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let i,s;const r=new Array(2*e);for(s=0,i=0;i<e;){let a=n[i++];if(a<128){r[s++]=a;continue}let c=$u[a];if(c>4)r[s++]=65533,i+=c-1;else{for(a&=c===2?31:c===3?15:7;c>1&&i<e;)a=a<<6|63&n[i++],c--;c>1?r[s++]=65533:a<65536?r[s++]=a:(a-=65536,r[s++]=55296|a>>10&1023,r[s++]=56320|1023&a)}}return((a,c)=>{if(c<65534&&a.subarray&&zw)return String.fromCharCode.apply(null,a.length===c?a:a.subarray(0,c));let l="";for(let u=0;u<c;u++)l+=String.fromCharCode(a[u]);return l})(r,s)},utf8border:(n,t)=>{(t=t||n.length)>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(192&n[e])==128;)e--;return e<0||e===0?t:e+$u[n[e]]>t?e:t}},Jw=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Xw=Object.prototype.toString,{Z_NO_FLUSH:a3,Z_SYNC_FLUSH:c3,Z_FULL_FLUSH:d3,Z_FINISH:l3,Z_OK:Wf,Z_STREAM_END:u3,Z_DEFAULT_COMPRESSION:h3,Z_DEFAULT_STRATEGY:p3,Z_DEFLATED:f3}=nl;function Zu(n){this.options=Gf.assign({level:h3,method:f3,chunkSize:16384,windowBits:15,memLevel:8,strategy:p3},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Jw,this.strm.avail_out=0;let e=Xu.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Wf)throw new Error(Vc[e]);if(t.header&&Xu.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?Qu.string2buf(t.dictionary):Xw.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,e=Xu.deflateSetDictionary(this.strm,i),e!==Wf)throw new Error(Vc[e]);this._dict_set=!0}}function oS(n,t){const e=new Zu(t);if(e.push(n,!0),e.err)throw e.msg||Vc[e.err];return e.result}Zu.prototype.push=function(n,t){const e=this.strm,i=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=t===~~t?t:t===!0?l3:a3,typeof n=="string"?e.input=Qu.string2buf(n):Xw.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;)if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(r===c3||r===d3)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(s=Xu.deflate(e,r),s===u3)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=Xu.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Wf;if(e.avail_out!==0){if(r>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(e.avail_in===0)break}else this.onData(e.output)}return!0},Zu.prototype.onData=function(n){this.chunks.push(n)},Zu.prototype.onEnd=function(n){n===Wf&&(this.result=Gf.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var _3={Deflate:Zu,deflate:oS,deflateRaw:function(n,t){return(t=t||{}).raw=!0,oS(n,t)},gzip:function(n,t){return(t=t||{}).gzip=!0,oS(n,t)},constants:nl};const Hf=16209;var m3=function(n,t){let e,i,s,r,a,c,l,u,h,f,g,S,w,I,b,M,F,V,Z,$,W,q,et,_t;const lt=n.state;e=n.next_in,et=n.input,i=e+(n.avail_in-5),s=n.next_out,_t=n.output,r=s-(t-n.avail_out),a=s+(n.avail_out-257),c=lt.dmax,l=lt.wsize,u=lt.whave,h=lt.wnext,f=lt.window,g=lt.hold,S=lt.bits,w=lt.lencode,I=lt.distcode,b=(1<<lt.lenbits)-1,M=(1<<lt.distbits)-1;t:do{S<15&&(g+=et[e++]<<S,S+=8,g+=et[e++]<<S,S+=8),F=w[g&b];e:for(;;){if(V=F>>>24,g>>>=V,S-=V,V=F>>>16&255,V===0)_t[s++]=65535&F;else{if(!(16&V)){if(!(64&V)){F=w[(65535&F)+(g&(1<<V)-1)];continue e}if(32&V){lt.mode=16191;break t}n.msg="invalid literal/length code",lt.mode=Hf;break t}Z=65535&F,V&=15,V&&(S<V&&(g+=et[e++]<<S,S+=8),Z+=g&(1<<V)-1,g>>>=V,S-=V),S<15&&(g+=et[e++]<<S,S+=8,g+=et[e++]<<S,S+=8),F=I[g&M];n:for(;;){if(V=F>>>24,g>>>=V,S-=V,V=F>>>16&255,!(16&V)){if(!(64&V)){F=I[(65535&F)+(g&(1<<V)-1)];continue n}n.msg="invalid distance code",lt.mode=Hf;break t}if($=65535&F,V&=15,S<V&&(g+=et[e++]<<S,S+=8,S<V&&(g+=et[e++]<<S,S+=8)),$+=g&(1<<V)-1,$>c){n.msg="invalid distance too far back",lt.mode=Hf;break t}if(g>>>=V,S-=V,V=s-r,$>V){if(V=$-V,V>u&&lt.sane){n.msg="invalid distance too far back",lt.mode=Hf;break t}if(W=0,q=f,h===0){if(W+=l-V,V<Z){Z-=V;do _t[s++]=f[W++];while(--V);W=s-$,q=_t}}else if(h<V){if(W+=l+h-V,V-=h,V<Z){Z-=V;do _t[s++]=f[W++];while(--V);if(W=0,h<Z){V=h,Z-=V;do _t[s++]=f[W++];while(--V);W=s-$,q=_t}}}else if(W+=h-V,V<Z){Z-=V;do _t[s++]=f[W++];while(--V);W=s-$,q=_t}for(;Z>2;)_t[s++]=q[W++],_t[s++]=q[W++],_t[s++]=q[W++],Z-=3;Z&&(_t[s++]=q[W++],Z>1&&(_t[s++]=q[W++]))}else{W=s-$;do _t[s++]=_t[W++],_t[s++]=_t[W++],_t[s++]=_t[W++],Z-=3;while(Z>2);Z&&(_t[s++]=_t[W++],Z>1&&(_t[s++]=_t[W++]))}break}}break}}while(e<i&&s<a);Z=S>>3,e-=Z,S-=Z<<3,g&=(1<<S)-1,n.next_in=e,n.next_out=s,n.avail_in=e<i?i-e+5:5-(e-i),n.avail_out=s<a?a-s+257:257-(s-a),lt.hold=g,lt.bits=S};const Kf=15,E3=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),g3=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),T3=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),S3=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var th=(n,t,e,i,s,r,a,c)=>{const l=c.bits;let u,h,f,g,S,w,I=0,b=0,M=0,F=0,V=0,Z=0,$=0,W=0,q=0,et=0,_t=null;const lt=new Uint16Array(16),Xt=new Uint16Array(16);let pe,ve,Ue,de=null;for(I=0;I<=Kf;I++)lt[I]=0;for(b=0;b<i;b++)lt[t[e+b]]++;for(V=l,F=Kf;F>=1&&lt[F]===0;F--);if(V>F&&(V=F),F===0)return s[r++]=20971520,s[r++]=20971520,c.bits=1,0;for(M=1;M<F&&lt[M]===0;M++);for(V<M&&(V=M),W=1,I=1;I<=Kf;I++)if(W<<=1,W-=lt[I],W<0)return-1;if(W>0&&(n===0||F!==1))return-1;for(Xt[1]=0,I=1;I<Kf;I++)Xt[I+1]=Xt[I]+lt[I];for(b=0;b<i;b++)t[e+b]!==0&&(a[Xt[t[e+b]]++]=b);if(n===0?(_t=de=a,w=20):n===1?(_t=E3,de=g3,w=257):(_t=T3,de=S3,w=0),et=0,b=0,I=M,S=r,Z=V,$=0,f=-1,q=1<<V,g=q-1,n===1&&q>852||n===2&&q>592)return 1;for(;;){pe=I-$,a[b]+1<w?(ve=0,Ue=a[b]):a[b]>=w?(ve=de[a[b]-w],Ue=_t[a[b]-w]):(ve=96,Ue=0),u=1<<I-$,h=1<<Z,M=h;do h-=u,s[S+(et>>$)+h]=pe<<24|ve<<16|Ue|0;while(h!==0);for(u=1<<I-1;et&u;)u>>=1;if(u!==0?(et&=u-1,et+=u):et=0,b++,--lt[I]==0){if(I===F)break;I=t[e+a[b]]}if(I>V&&(et&g)!==f){for($===0&&($=V),S+=M,Z=I-$,W=1<<Z;Z+$<F&&(W-=lt[Z+$],!(W<=0));)Z++,W<<=1;if(q+=1<<Z,n===1&&q>852||n===2&&q>592)return 1;f=et&g,s[f]=V<<24|Z<<16|S-r|0}}return et!==0&&(s[S+et]=I-$<<24|64<<16|0),c.bits=V,0};const{Z_FINISH:$w,Z_BLOCK:v3,Z_TREES:qf,Z_OK:Gc,Z_STREAM_END:C3,Z_NEED_DICT:y3,Z_STREAM_ERROR:vr,Z_DATA_ERROR:Qw,Z_MEM_ERROR:Zw,Z_BUF_ERROR:R3,Z_DEFLATED:tO}=nl,Yf=16180,zf=16190,Zo=16191,aS=16192,cS=16194,Jf=16199,Xf=16200,dS=16206,Jn=16209,eO=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function I3(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Wc=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<Yf||t.mode>16211?1:0},nO=n=>{if(Wc(n))return vr;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=1&t.wrap),t.mode=Yf,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Gc},iO=n=>{if(Wc(n))return vr;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,nO(n)},sO=(n,t)=>{let e;if(Wc(n))return vr;const i=n.state;return t<0?(e=0,t=-t):(e=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?vr:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=e,i.wbits=t,iO(n))},rO=(n,t)=>{if(!n)return vr;const e=new I3;n.state=e,e.strm=n,e.window=null,e.mode=Yf;const i=sO(n,t);return i!==Gc&&(n.state=null),i};let lS,uS,oO=!0;const b3=n=>{if(oO){lS=new Int32Array(512),uS=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(th(1,n.lens,0,288,lS,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;th(2,n.lens,0,32,uS,0,n.work,{bits:5}),oO=!1}n.lencode=lS,n.lenbits=9,n.distcode=uS,n.distbits=5},aO=(n,t,e,i)=>{let s;const r=n.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(t.subarray(e-r.wsize,e),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>i&&(s=i),r.window.set(t.subarray(e-i,e-i+s),r.wnext),(i-=s)?(r.window.set(t.subarray(e-i,e),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var A3=(n,t)=>{let e,i,s,r,a,c,l,u,h,f,g,S,w,I,b,M,F,V,Z,$,W,q,et=0;const _t=new Uint8Array(4);let lt,Xt;const pe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Wc(n)||!n.output||!n.input&&n.avail_in!==0)return vr;e=n.state,e.mode===Zo&&(e.mode=aS),a=n.next_out,s=n.output,l=n.avail_out,r=n.next_in,i=n.input,c=n.avail_in,u=e.hold,h=e.bits,f=c,g=l,q=Gc;t:for(;;)switch(e.mode){case Yf:if(e.wrap===0){e.mode=aS;break}for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(2&e.wrap&&u===35615){e.wbits===0&&(e.wbits=15),e.check=0,_t[0]=255&u,_t[1]=u>>>8&255,e.check=xi(e.check,_t,2,0),u=0,h=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&u)<<8)+(u>>8))%31){n.msg="incorrect header check",e.mode=Jn;break}if((15&u)!==tO){n.msg="unknown compression method",e.mode=Jn;break}if(u>>>=4,h-=4,W=8+(15&u),e.wbits===0&&(e.wbits=W),W>15||W>e.wbits){n.msg="invalid window size",e.mode=Jn;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=512&u?16189:Zo,u=0,h=0;break;case 16181:for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(e.flags=u,(255&e.flags)!==tO){n.msg="unknown compression method",e.mode=Jn;break}if(57344&e.flags){n.msg="unknown header flags set",e.mode=Jn;break}e.head&&(e.head.text=u>>8&1),512&e.flags&&4&e.wrap&&(_t[0]=255&u,_t[1]=u>>>8&255,e.check=xi(e.check,_t,2,0)),u=0,h=0,e.mode=16182;case 16182:for(;h<32;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.head&&(e.head.time=u),512&e.flags&&4&e.wrap&&(_t[0]=255&u,_t[1]=u>>>8&255,_t[2]=u>>>16&255,_t[3]=u>>>24&255,e.check=xi(e.check,_t,4,0)),u=0,h=0,e.mode=16183;case 16183:for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.head&&(e.head.xflags=255&u,e.head.os=u>>8),512&e.flags&&4&e.wrap&&(_t[0]=255&u,_t[1]=u>>>8&255,e.check=xi(e.check,_t,2,0)),u=0,h=0,e.mode=16184;case 16184:if(1024&e.flags){for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.length=u,e.head&&(e.head.extra_len=u),512&e.flags&&4&e.wrap&&(_t[0]=255&u,_t[1]=u>>>8&255,e.check=xi(e.check,_t,2,0)),u=0,h=0}else e.head&&(e.head.extra=null);e.mode=16185;case 16185:if(1024&e.flags&&(S=e.length,S>c&&(S=c),S&&(e.head&&(W=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(r,r+S),W)),512&e.flags&&4&e.wrap&&(e.check=xi(e.check,i,S,r)),c-=S,r+=S,e.length-=S),e.length))break t;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(c===0)break t;S=0;do W=i[r+S++],e.head&&W&&e.length<65536&&(e.head.name+=String.fromCharCode(W));while(W&&S<c);if(512&e.flags&&4&e.wrap&&(e.check=xi(e.check,i,S,r)),c-=S,r+=S,W)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(c===0)break t;S=0;do W=i[r+S++],e.head&&W&&e.length<65536&&(e.head.comment+=String.fromCharCode(W));while(W&&S<c);if(512&e.flags&&4&e.wrap&&(e.check=xi(e.check,i,S,r)),c-=S,r+=S,W)break t}else e.head&&(e.head.comment=null);e.mode=16188;case 16188:if(512&e.flags){for(;h<16;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(4&e.wrap&&u!==(65535&e.check)){n.msg="header crc mismatch",e.mode=Jn;break}u=0,h=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=Zo;break;case 16189:for(;h<32;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}n.adler=e.check=eO(u),u=0,h=0,e.mode=zf;case zf:if(e.havedict===0)return n.next_out=a,n.avail_out=l,n.next_in=r,n.avail_in=c,e.hold=u,e.bits=h,y3;n.adler=e.check=1,e.mode=Zo;case Zo:if(t===v3||t===qf)break t;case aS:if(e.last){u>>>=7&h,h-=7&h,e.mode=dS;break}for(;h<3;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}switch(e.last=1&u,u>>>=1,h-=1,3&u){case 0:e.mode=16193;break;case 1:if(b3(e),e.mode=Jf,t===qf){u>>>=2,h-=2;break t}break;case 2:e.mode=16196;break;case 3:n.msg="invalid block type",e.mode=Jn}u>>>=2,h-=2;break;case 16193:for(u>>>=7&h,h-=7&h;h<32;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if((65535&u)!=(u>>>16^65535)){n.msg="invalid stored block lengths",e.mode=Jn;break}if(e.length=65535&u,u=0,h=0,e.mode=cS,t===qf)break t;case cS:e.mode=16195;case 16195:if(S=e.length,S){if(S>c&&(S=c),S>l&&(S=l),S===0)break t;s.set(i.subarray(r,r+S),a),c-=S,r+=S,l-=S,a+=S,e.length-=S;break}e.mode=Zo;break;case 16196:for(;h<14;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(e.nlen=257+(31&u),u>>>=5,h-=5,e.ndist=1+(31&u),u>>>=5,h-=5,e.ncode=4+(15&u),u>>>=4,h-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=Jn;break}e.have=0,e.mode=16197;case 16197:for(;e.have<e.ncode;){for(;h<3;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.lens[pe[e.have++]]=7&u,u>>>=3,h-=3}for(;e.have<19;)e.lens[pe[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,lt={bits:e.lenbits},q=th(0,e.lens,0,19,e.lencode,0,e.work,lt),e.lenbits=lt.bits,q){n.msg="invalid code lengths set",e.mode=Jn;break}e.have=0,e.mode=16198;case 16198:for(;e.have<e.nlen+e.ndist;){for(;et=e.lencode[u&(1<<e.lenbits)-1],b=et>>>24,M=et>>>16&255,F=65535&et,!(b<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(F<16)u>>>=b,h-=b,e.lens[e.have++]=F;else{if(F===16){for(Xt=b+2;h<Xt;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(u>>>=b,h-=b,e.have===0){n.msg="invalid bit length repeat",e.mode=Jn;break}W=e.lens[e.have-1],S=3+(3&u),u>>>=2,h-=2}else if(F===17){for(Xt=b+3;h<Xt;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}u>>>=b,h-=b,W=0,S=3+(7&u),u>>>=3,h-=3}else{for(Xt=b+7;h<Xt;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}u>>>=b,h-=b,W=0,S=11+(127&u),u>>>=7,h-=7}if(e.have+S>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=Jn;break}for(;S--;)e.lens[e.have++]=W}}if(e.mode===Jn)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=Jn;break}if(e.lenbits=9,lt={bits:e.lenbits},q=th(1,e.lens,0,e.nlen,e.lencode,0,e.work,lt),e.lenbits=lt.bits,q){n.msg="invalid literal/lengths set",e.mode=Jn;break}if(e.distbits=6,e.distcode=e.distdyn,lt={bits:e.distbits},q=th(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,lt),e.distbits=lt.bits,q){n.msg="invalid distances set",e.mode=Jn;break}if(e.mode=Jf,t===qf)break t;case Jf:e.mode=Xf;case Xf:if(c>=6&&l>=258){n.next_out=a,n.avail_out=l,n.next_in=r,n.avail_in=c,e.hold=u,e.bits=h,m3(n,g),a=n.next_out,s=n.output,l=n.avail_out,r=n.next_in,i=n.input,c=n.avail_in,u=e.hold,h=e.bits,e.mode===Zo&&(e.back=-1);break}for(e.back=0;et=e.lencode[u&(1<<e.lenbits)-1],b=et>>>24,M=et>>>16&255,F=65535&et,!(b<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(M&&!(240&M)){for(V=b,Z=M,$=F;et=e.lencode[$+((u&(1<<V+Z)-1)>>V)],b=et>>>24,M=et>>>16&255,F=65535&et,!(V+b<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}u>>>=V,h-=V,e.back+=V}if(u>>>=b,h-=b,e.back+=b,e.length=F,M===0){e.mode=16205;break}if(32&M){e.back=-1,e.mode=Zo;break}if(64&M){n.msg="invalid literal/length code",e.mode=Jn;break}e.extra=15&M,e.mode=16201;case 16201:if(e.extra){for(Xt=e.extra;h<Xt;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.length+=u&(1<<e.extra)-1,u>>>=e.extra,h-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=16202;case 16202:for(;et=e.distcode[u&(1<<e.distbits)-1],b=et>>>24,M=et>>>16&255,F=65535&et,!(b<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(!(240&M)){for(V=b,Z=M,$=F;et=e.distcode[$+((u&(1<<V+Z)-1)>>V)],b=et>>>24,M=et>>>16&255,F=65535&et,!(V+b<=h);){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}u>>>=V,h-=V,e.back+=V}if(u>>>=b,h-=b,e.back+=b,64&M){n.msg="invalid distance code",e.mode=Jn;break}e.offset=F,e.extra=15&M,e.mode=16203;case 16203:if(e.extra){for(Xt=e.extra;h<Xt;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}e.offset+=u&(1<<e.extra)-1,u>>>=e.extra,h-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=Jn;break}e.mode=16204;case 16204:if(l===0)break t;if(S=g-l,e.offset>S){if(S=e.offset-S,S>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=Jn;break}S>e.wnext?(S-=e.wnext,w=e.wsize-S):w=e.wnext-S,S>e.length&&(S=e.length),I=e.window}else I=s,w=a-e.offset,S=e.length;S>l&&(S=l),l-=S,e.length-=S;do s[a++]=I[w++];while(--S);e.length===0&&(e.mode=Xf);break;case 16205:if(l===0)break t;s[a++]=e.length,l--,e.mode=Xf;break;case dS:if(e.wrap){for(;h<32;){if(c===0)break t;c--,u|=i[r++]<<h,h+=8}if(g-=l,n.total_out+=g,e.total+=g,4&e.wrap&&g&&(n.adler=e.check=e.flags?xi(e.check,s,g,a-g):Ku(e.check,s,g,a-g)),g=l,4&e.wrap&&(e.flags?u:eO(u))!==e.check){n.msg="incorrect data check",e.mode=Jn;break}u=0,h=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;h<32;){if(c===0)break t;c--,u+=i[r++]<<h,h+=8}if(4&e.wrap&&u!==(4294967295&e.total)){n.msg="incorrect length check",e.mode=Jn;break}u=0,h=0}e.mode=16208;case 16208:q=C3;break t;case Jn:q=Qw;break t;case 16210:return Zw;default:return vr}return n.next_out=a,n.avail_out=l,n.next_in=r,n.avail_in=c,e.hold=u,e.bits=h,(e.wsize||g!==n.avail_out&&e.mode<Jn&&(e.mode<dS||t!==$w))&&aO(n,n.output,n.next_out,g-n.avail_out),f-=n.avail_in,g-=n.avail_out,n.total_in+=f,n.total_out+=g,e.total+=g,4&e.wrap&&g&&(n.adler=e.check=e.flags?xi(e.check,s,g,n.next_out-g):Ku(e.check,s,g,n.next_out-g)),n.data_type=e.bits+(e.last?64:0)+(e.mode===Zo?128:0)+(e.mode===Jf||e.mode===cS?256:0),(f===0&&g===0||t===$w)&&q===Gc&&(q=R3),q},ta={inflateReset:iO,inflateReset2:sO,inflateResetKeep:nO,inflateInit:n=>rO(n,15),inflateInit2:rO,inflate:A3,inflateEnd:n=>{if(Wc(n))return vr;let t=n.state;return t.window&&(t.window=null),n.state=null,Gc},inflateGetHeader:(n,t)=>{if(Wc(n))return vr;const e=n.state;return 2&e.wrap?(e.head=t,t.done=!1,Gc):vr},inflateSetDictionary:(n,t)=>{const e=t.length;let i,s,r;return Wc(n)?vr:(i=n.state,i.wrap!==0&&i.mode!==zf?vr:i.mode===zf&&(s=1,s=Ku(s,t,e,0),s!==i.check)?Qw:(r=aO(n,t,e,e),r?(i.mode=16210,Zw):(i.havedict=1,Gc)))},inflateInfo:"pako inflate (from Nodeca project)"},w3=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const cO=Object.prototype.toString,{Z_NO_FLUSH:O3,Z_FINISH:N3,Z_OK:eh,Z_STREAM_END:hS,Z_NEED_DICT:pS,Z_STREAM_ERROR:D3,Z_DATA_ERROR:dO,Z_MEM_ERROR:P3}=nl;function nh(n){this.options=Gf.assign({chunkSize:65536,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||n&&n.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Jw,this.strm.avail_out=0;let e=ta.inflateInit2(this.strm,t.windowBits);if(e!==eh)throw new Error(Vc[e]);if(this.header=new w3,ta.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Qu.string2buf(t.dictionary):cO.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=ta.inflateSetDictionary(this.strm,t.dictionary),e!==eh)))throw new Error(Vc[e])}function fS(n,t){const e=new nh(t);if(e.push(n),e.err)throw e.msg||Vc[e.err];return e.result}nh.prototype.push=function(n,t){const e=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let r,a,c;if(this.ended)return!1;for(a=t===~~t?t:t===!0?N3:O3,cO.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),r=ta.inflate(e,a),r===pS&&s&&(r=ta.inflateSetDictionary(e,s),r===eh?r=ta.inflate(e,a):r===dO&&(r=pS));e.avail_in>0&&r===hS&&e.state.wrap>0&&n[e.next_in]!==0;)ta.inflateReset(e),r=ta.inflate(e,a);switch(r){case D3:case dO:case pS:case P3:return this.onEnd(r),this.ended=!0,!1}if(c=e.avail_out,e.next_out&&(e.avail_out===0||r===hS))if(this.options.to==="string"){let l=Qu.utf8border(e.output,e.next_out),u=e.next_out-l,h=Qu.buf2string(e.output,l);e.next_out=u,e.avail_out=i-u,u&&e.output.set(e.output.subarray(l,l+u),0),this.onData(h)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(r!==eh||c!==0){if(r===hS)return r=ta.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(e.avail_in===0)break}}return!0},nh.prototype.onData=function(n){this.chunks.push(n)},nh.prototype.onEnd=function(n){n===eh&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Gf.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var L3={Inflate:nh,inflate:fS,inflateRaw:function(n,t){return(t=t||{}).raw=!0,fS(n,t)},ungzip:fS,constants:nl};const{Deflate:Iq,deflate:k3,deflateRaw:bq,gzip:Aq}=_3,{Inflate:wq,inflate:M3,inflateRaw:Oq,ungzip:Nq}=L3;var _S,U3=k3,x3=M3;(function(n){n[n.ONE_BYTE=0]="ONE_BYTE",n[n.TWO_BYTE=1]="TWO_BYTE"})(_S||(_S={}));class V3{constructor(){m(this,"_sequence",0),m(this,"_startTime",Date.now()),m(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const e={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const l={id:0,length:4,data:c.buffer},u={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[l]};e.commonPacketHeader.extension=1,e.extension=u,e.payload=this.compress(t),e.commonPacketHeader.length=8+(e.extension.length+2)+e.payload.byteLength}else e.commonPacketHeader.length=8+e.payload.byteLength;const i=new ArrayBuffer(e.commonPacketHeader.length),s=new Uint8Array(i),r=new DataView(i);let a=0;if(r.setUint16(a,e.commonPacketHeader.extension<<15|e.commonPacketHeader.reserved<<14|e.commonPacketHeader.length,!0),a+=2,r.setUint32(a,e.commonPacketHeader.sequence,!0),a+=4,r.setUint16(a,e.commonStreamHeader,!0),a+=2,e.extension){const c=this.serializeExtension(e.extension);s.set(new Uint8Array(c),a),a+=c.byteLength}if(s.set(new Uint8Array(e.payload),a),a+=e.payload.byteLength,a!==e.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const e=new DataView(t);let i=0;const s=e.getUint16(i,!0);i+=2;const r=(32768&s)>>15;e.getUint16(i+2,!0),e.getUint16(i,!0);let a,c;if(i+=4,e.getUint16(i,!0),i+=2,r){c=this.deserializeExtension(t.slice(i)),i+=2+c.length,a=t.slice(i);let l=!1;if(c.datas.length>0){const u=c.datas.find(h=>h.id===0);u&&(l=(1&new DataView(u.data).getUint32(0,!0))==1)}a=l?this.decompress(a):a}else a=t.slice(8);return a}serializeExtension(t){const{profile:e,length:i,datas:s}=t,r=new ArrayBuffer(i+2),a=new Uint8Array(r),c=new DataView(r);let l=0;if(c.setUint8(l++,e),c.setUint8(l++,i),s.forEach(u=>{e?(c.setUint8(l++,u.id),c.setUint8(l++,u.length),a.set(new Uint8Array(u.data),l),l+=u.data.byteLength):(c.setUint8(l++,u.id|u.length<<4),a.set(new Uint8Array(u.data),l),l+=u.data.byteLength)}),l!==i+2)throw Error("serialize extension error, is ".concat(l,"!==").concat(i+2));return r}deserializeExtension(t){const e=new DataView(t);let i=0;const s=e.getUint8(i);i++;const r=e.getUint8(i);i++;const a=s===_S.TWO_BYTE,c=[],l=new DataView(t,2);let u=0;for(;u<r;){let h=0,f=0,g=new ArrayBuffer(0);a?(h=l.getUint8(u),u++,f=l.getUint8(u),u++):(h=15&l.getUint8(u),f=l.getUint8(u)>>4,u++),f>0&&(g=l.buffer.slice(u+2,u+2+f),u+=g.byteLength),c.push({id:h,length:f,data:g})}if(u!==r)throw Error("parse error");return{profile:s,length:r,datas:c}}decompress(t){return x3(new Uint8Array(t))}compress(t){return U3(new Uint8Array(t))}}class lO extends Ze{constructor(t,e){super(),m(this,"_version",1),m(this,"_type",3),m(this,"_config",void 0),m(this,"_originDataChannel",void 0),m(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),m(this,"_dataStreamPacketHandler",void 0),m(this,"_datachannelEventMap",new Map),this._config=t,e&&(this._originDataChannel=e,this._bandDataChannelEvents(e)),this._initPacketHeader(),this._dataStreamPacketHandler=new V3}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return U("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,e;return(t=(e=this._originDataChannel)===null||e===void 0?void 0:e.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,e;return(t=(e=this._originDataChannel)===null||e===void 0?void 0:e.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new K((t,e)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var s;e(new Q(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new Q(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else e(new Q(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[$d.OPEN,$d.CLOSE,$d.ERROR].forEach(e=>{const i=()=>{this.emit(e)};this._datachannelEventMap.set(e,i),t.addEventListener(e,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(e=>{let[i,s]=e;t.removeEventListener(i,s)}),this._datachannelEventMap.clear()}}class F3 extends lO{constructor(t){super(t),m(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=e.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(i).getUint8(3)!==this.id)return;let s=e.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit($d.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class uO extends lO{send(t){if(this._originDataChannel){let e=t;e=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+e.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(e),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}class B3 extends Ze{constructor(){super(...arguments),m(this,"resultStorage",new Map)}setLocalAudioStats(t,e,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,e)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,e))}setLocalVideoStats(t,e,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,e)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,e)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,e){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(e))}setRemoteVideoStats(t,e){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(e))}record(t,e,i){if(U("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(s&&(s.result.push(i),s.result.length>=5)){var r;const a=Vt(r=s.result).call(r,!0);s.isPrevNormal&&!a&&this.emit("exception",hO[t],t,e),!s.isPrevNormal&&a&&this.emit("exception",hO[t]+2e3,t+"_RECOVER",e),s.isPrevNormal=a,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,e){return e instanceof bn&&!e.isActive||!!e.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,e){let i=null;e._encoderConfig&&e._encoderConfig.frameRate&&(i=Vs(e._encoderConfig.frameRate));const s=t.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,e){return!!e.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,e){return e instanceof bn&&!e.isActive||!!e.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const hO={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},li=new class{markSubscribeStart(n,t){performance.mark("agora-web-sdk/".concat(n,"/subscribe-").concat(t))}markPublishStart(n,t){performance.mark("agora-web-sdk/".concat(n,"/publish-").concat(t))}measureFromSubscribeStart(n,t){const e=performance.getEntriesByName("agora-web-sdk/".concat(n,"/subscribe-").concat(t));if(e.length>0){const i=e[e.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(n,t){const e=performance.getEntriesByName("agora-web-sdk/".concat(n,"/publish-").concat(t));if(e.length>0){const i=e[e.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function pO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Hc(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?pO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):pO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class ol{constructor(t){m(this,"store",void 0),m(this,"onStatsException",void 0),m(this,"onUploadPublishDuration",void 0),m(this,"onStatsChanged",void 0),m(this,"localStats",new Map),m(this,"remoteStats",new Map),m(this,"updateStatsInterval",void 0),m(this,"trafficStats",void 0),m(this,"trafficStatsPeerList",[]),m(this,"uplinkStats",void 0),m(this,"exceptionMonitor",void 0),m(this,"p2pChannel",void 0),m(this,"scalabilityMode",ST.L1T1),m(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new B3,this.exceptionMonitor.on("exception",(e,i,s)=>{this.onStatsException&&this.onStatsException(e,i,s)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(it.LocalAudioTrack)||Hc({},kT)}getLocalVideoTrackStats(){return this.localStats.get(it.LocalVideoTrack)||Hc({},MT)}getRemoteAudioTrackStats(t){const e=(r,a)=>{if(!this.trafficStats)return a;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===r);return c&&(a.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),a},i={};if(t){var s;const r=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;r&&(i[t]=e(t,r))}else Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{audioStats:c}]=r;c&&(i[a]=e(a,c))});return i}getRemoteNetworkQualityStats(t){const e={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;s&&(e[t]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[r,{networkStats:a}]=s;a&&(e[r]=a)});return e}getRemoteVideoTrackStats(t){const e=(r,a)=>{if(!this.trafficStats)return a;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===r);return c&&(a.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),a},i={};if(t){var s;const r=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;r&&(i[t]=e(t,r))}else Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{videoStats:c}]=r;c&&(i[a]=e(a,c))});return i}getRTCStats(){let t=0,e=0,i=0,s=0;const r=this.localStats.get(it.LocalAudioTrack);r&&(t+=r.sendBytes,e+=r.sendBitrate);const a=this.localStats.get(it.LocalVideoTrack);a&&(t+=a.sendBytes,e+=a.sendBitrate);const c=this.localStats.get(it.LocalVideoLowTrack);c&&(t+=c.sendBytes,e+=c.sendBitrate),this.remoteStats.forEach(u=>{let{audioStats:h,videoStats:f}=u;h&&(i+=h.receiveBytes,s+=h.receiveBitrate),f&&(i+=f.receiveBytes,s+=f.receiveBitrate)});let l=1;return this.trafficStats&&(l+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:l,SendBitrate:e,SendBytes:t,RecvBytes:i,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(e=>e.B_ppad!==void 0||e.B_ppvd!==void 0),t.peer_delay.filter(e=>this.trafficStatsPeerList.indexOf(e.peer_uid)===-1).forEach(e=>{var i;const s=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(e.peer_uid),r=s!=null&&s.videoSSRC?li.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,a=s!=null&&s.audioSSRC?li.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;e.B_ppad!==void 0&&e.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>a?r:a),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&v.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,e,i){if(!t)return!1;const s=!!i&&e.framesDecodeFreezeTime>i.framesDecodeFreezeTime,r=!i||e.framesDecodeCount>i.framesDecodeCount;return s||!r}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(e=>{let[i,s]=e;switch(i){case it.LocalVideoTrack:case it.LocalVideoLowTrack:{const a=s,c=Hc({},MT),l=t.getStats(),u=t.getLocalMedia(i);if(l){const h=l.videoSend.find(f=>f.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(h){const f=t.getLocalVideoSize(),g=t.getEncoderConfig(it.LocalVideoTrack);h.codec!=="H264"&&h.codec!=="H265"&&h.codec!=="VP8"&&h.codec!=="VP9"&&h.codec!=="AV1X"&&h.codec!=="AV1"||(c.codecType=h.codec),c.sendBytes=h.bytes,c.sendBitrate=a?8*Math.max(0,c.sendBytes-a.sendBytes):0,h.inputFrame?(c.captureFrameRate=h.inputFrame.frameRate,c.captureResolutionHeight=h.inputFrame.height,c.captureResolutionWidth=h.inputFrame.width):f&&(c.captureResolutionWidth=f.width,c.captureResolutionHeight=f.height),h.sentFrame?(c.sendFrameRate=h.sentFrame.frameRate,c.sendResolutionHeight=h.sentFrame.height,c.sendResolutionWidth=h.sentFrame.width):f&&(c.sendResolutionWidth=f.width,c.sendResolutionHeight=f.height),h.avgEncodeMs&&(c.encodeDelay=h.avgEncodeMs),g&&g.bitrateMax&&(c.targetSendBitrate=1e3*g.bitrateMax),c.sendPackets=h.packets,c.sendPacketsLost=h.packetsLost,c.sendJitterMs=h.jitterMs,c.sendRttMs=h.rttMs,c.totalDuration=a?a.totalDuration+1:1,c.totalFreezeTime=a?a.totalFreezeTime:0,this.isLocalVideoFreeze(h)&&(c.totalFreezeTime+=1),h.scalabilityMode&&this.scalabilityMode!==h.scalabilityMode&&(v.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(h.scalabilityMode)),this.scalabilityMode=h.scalabilityMode)}this.trafficStats&&(c.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var r;this.localStats.set(i,c),((a==null?void 0:a.sendResolutionWidth)!==c.sendResolutionWidth||(a==null?void 0:a.sendResolutionHeight)!==c.sendResolutionHeight)&&((r=this.onStatsChanged)===null||r===void 0||r.call(this,"resolution",{width:c.sendResolutionWidth,height:c.sendResolutionHeight})),c&&u&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,u.track,c);break}case it.LocalAudioTrack:{const a=s,c=Hc({},kT),l=t.getStats(),u=t.getLocalMedia(i);if(l){const h=l.audioSend.find(f=>f.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(h){if(h.codec!=="opus"&&h.codec!=="aac"&&h.codec!=="PCMU"&&h.codec!=="PCMA"&&h.codec!=="G722"||(c.codecType=h.codec),h.inputLevel)c.sendVolumeLevel=Math.round(32767*h.inputLevel);else{const f=t.getLocalAudioVolume();f&&(c.sendVolumeLevel=Math.round(32767*f))}c.sendBytes=h.bytes,c.sendPackets=h.packets,c.sendPacketsLost=h.packetsLost,c.sendJitterMs=h.jitterMs,c.sendRttMs=h.rttMs,c.sendBitrate=a?8*Math.max(0,c.sendBytes-a.sendBytes):0}}this.trafficStats&&(c.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(it.LocalAudioTrack,c),c&&u&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,u.track,c);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(e=>{let[i,{videoStats:s,audioStats:r,videoPcStats:a}]=e;const c=r,l=s,u=a,h=Hc({},HA),f=Hc({},KA),g=Hc({},Rj),{audioTrack:S,videoTrack:w,audioSSRC:I,videoSSRC:b}=t.getRemoteMedia(i),M=t.getStats(),F=M==null?void 0:M.audioRecv.find($=>$.ssrc===I),V=M==null?void 0:M.videoRecv.find($=>$.ssrc===b),Z=this.trafficStats&&this.trafficStats.peer_delay.find($=>$.peer_uid===i);if(F&&(F.codec!=="opus"&&F.codec!=="aac"&&F.codec!=="PCMU"&&F.codec!=="PCMA"&&F.codec!=="G722"||(h.codecType=F.codec),F.outputLevel?h.receiveLevel=Math.round(32767*F.outputLevel):S&&(h.receiveLevel=Math.round(32767*S.getVolumeLevel())),h.receiveBytes=F.bytes,h.receivePackets=F.packets,h.receivePacketsLost=F.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.receiveBitrate=c?8*Math.max(0,h.receiveBytes-c.receiveBytes):0,h.totalDuration=c?c.totalDuration+1:1,h.totalFreezeTime=c?c.totalFreezeTime:0,h.freezeRate=h.totalFreezeTime/h.totalDuration,h.receiveDelay=F.jitterBufferMs,h.totalDuration>10&&ol.isRemoteAudioFreeze(S)&&(h.totalFreezeTime+=1)),V){V.codec!=="H264"&&V.codec!=="H265"&&V.codec!=="VP8"&&V.codec!=="VP9"&&V.codec!=="AV1X"&&V.codec!=="AV1"||(f.codecType=V.codec),f.receiveBytes=V.bytes,f.receiveBitrate=l?8*Math.max(0,f.receiveBytes-l.receiveBytes):0,f.decodeFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,f.renderFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,V.outputFrame&&(f.renderFrameRate=V.outputFrame.frameRate),V.receivedFrame?(f.receiveFrameRate=V.receivedFrame.frameRate,f.receiveResolutionHeight=V.receivedFrame.height,f.receiveResolutionWidth=V.receivedFrame.width):w&&(f.receiveResolutionHeight=w._videoHeight||0,f.receiveResolutionWidth=w._videoWidth||0),V.framesRateFirefox!==void 0&&(f.receiveFrameRate=Math.round(V.framesRateFirefox)),f.receivePackets=V.packets,f.receivePacketsLost=V.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost),f.totalDuration=l?l.totalDuration+1:1,f.totalFreezeTime=l?l.totalFreezeTime:0,f.receiveDelay=V.jitterBufferMs||0;const $=!!b&&t.getRemoteVideoIsReady(b);w&&$&&ol.isRemoteVideoFreeze(w,V,u)&&(f.totalFreezeTime+=1),f.freezeRate=f.totalFreezeTime/f.totalDuration}Z&&(h.end2EndDelay=Z.B_ad,f.end2EndDelay=Z.B_vd,h.transportDelay=Z.B_ed,f.transportDelay=Z.B_ed,h.currentPacketLossRate=Z.B_ealr4/100,f.currentPacketLossRate=Z.B_evlr4/100,g.uplinkNetworkQuality=Z.B_punq?Z.B_punq:0,g.downlinkNetworkQuality=Z.B_pdnq?Z.B_pdnq:0),this.remoteStats.set(i,{audioStats:h,videoStats:f,videoPcStats:V,networkStats:g}),S&&this.exceptionMonitor.setRemoteAudioStats(S,h),w&&this.exceptionMonitor.setRemoteVideoStats(w,f)})}}function fO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function $f(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?fO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):fO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function ih(n){return n.match(/^[\.\:\d]+$/)?"".concat(n.replace(/[^\d]/g,"-"),".").concat(U("TURN_DOMAIN")):(v.info("Cannot recognized as IP address ".concat(n,". Used As Host instead")),n)}function _O(n,t){var e,i;const s=U("GATEWAY_DOMAINS");let r=s[1]&&t.indexOf(s[1])!==-1?1:0;n.addresses=n.addresses||[];const a=n.addresses.map(l=>l.domain_prefix?{address:"".concat(l.domain_prefix,".").concat(s[r++%s.length],":").concat(l.port)}:l.ip.match(/^[\.\:\d]+$/)?{ip:l.ip,port:l.port,address:"".concat(l.ip.replace(/[^\d]/g,"-"),".").concat(s[r++%s.length],":").concat(l.port)}:(v.info("Cannot recognized as IP address ".concat(l.ip,". Used As Host instead")),{ip:l.ip,port:l.port,address:"".concat(l.ip,":").concat(l.port)}));if((e=n.detail)!==null&&e!==void 0&&e[18]&&typeof((i=n.detail)===null||i===void 0?void 0:i[18])=="string"){const l=n.detail[18],u=l==null?void 0:l.split(";");for(let h=0;h<u.length;h++){var c;const f=NT(c=u[h]).call(c);a[h]&&f&&(a[h].ip6=f)}}return{gatewayAddrs:a,uid:n.uid,cid:n.cid,cert:n.cert,vid:n.detail&&n.detail[8],uni_lbs_ip:n.detail&&n.detail[1],res:n,csIp:n.detail&&n.detail[502]}}function Vs(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function Qf(n){const t=n._encoderConfig;if(!t)return{};const e={resolution:t.width&&t.height?"".concat(Vs(t.width),"x").concat(Vs(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(e.maxFrameRate=t.frameRate,e.minFrameRate=t.frameRate):t.frameRate&&(e.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,e.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),e}function mO(n){const t={connectionType:0,googRtt:n.rtt};switch(n.selectedCandidatePair.localCandidate.candidateType){case"relay":{const e=n.selectedCandidatePair.localCandidate.relayProtocol;e==="udp"&&(t.connectionType=1),e==="tcp"&&(t.connectionType=3),e==="tls"&&(t.connectionType=4);break}case"srflx":t.connectionType=2}return t}function EO(n){return n>=0&&n<.17?1:n>=.17&&n<.36?2:n>=.36&&n<.59?3:n>=.59&&n<=1?4:n>1?5:0}function mS(n,t){let e,i,s;switch(t){case Yn.CHOOSE_SERVER:i=4096,s="choose server";break;case Yn.CLOUD_PROXY:i=1048576,s="proxy";break;case Yn.CLOUD_PROXY_5:i=4194304,s="proxy5";break;case Yn.CLOUD_PROXY_FALLBACK:i=4194310,s="proxy fallback";break;default:throw new j(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:n.detail&&n.detail[502],retry:!1})}if(n.response_body.forEach(r=>{r.buffer&&r.buffer.flag===i&&(e={code:r.buffer.code,addresses:(r.buffer.edges_services||[]).map(a=>$f($f({},a),{},{ticket:r.buffer.cert})),server_ts:n.enter_ts,uid:r.buffer.uid,cid:r.buffer.cid,cname:r.buffer.cname,detail:$f($f({},r.buffer.detail),n.detail),flag:r.buffer.flag,opid:n.opid,cert:r.buffer.cert})}),!e)throw new j(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:n.detail&&n.detail[502]});return e}async function j3(n,t){return await K.all(n.addresses.map(async e=>({address:ih(e.ip),tcpport:e.port,udpport:e.port,username:t&&U("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ws.username,password:t&&U("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await JF(t.toString()):ws.password})))}function ES(n,t){const e=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height;return e?Math.max(e/Vs(n.height),1):(v.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ga(n){let{candidateType:t,relayProtocol:e,type:i,address:s,port:r,protocol:a}=n;return i==="local-candidate"?{candidateType:t,relayProtocol:e,protocol:a}:{candidateType:t,relayProtocol:e,address:s,port:r,protocol:a}}function gO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}class G3 extends Ze{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var e;Vt(e=["tryNext","recover"]).call(e,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(hn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(hn.CONNECTED):this._state==="closed"?this.emit(hn.CLOSED):this._state==="failed"&&this.emit(hn.FAILED))}constructor(t,e,i,s){super(),m(this,"connectionID",0),m(this,"currentURLIndex",0),m(this,"reconnectReason",void 0),m(this,"_reconnectMode","tryNext"),m(this,"_name",void 0),m(this,"_state","closed"),m(this,"_retryConfig",void 0),m(this,"_reconnectCount",0),m(this,"_forceCloseTimeout",5e3),m(this,"_onlineReconnectListener",void 0),m(this,"_closeEstablishingTransmitter",()=>{}),m(this,"_store",void 0),m(this,"_joinChannelServiceRecordIndex",void 0),m(this,"_useCompress",void 0),m(this,"_inflateLength",0),m(this,"_deflateLength",0),this._store=s,this._name=t,this._retryConfig=function(r){for(var a=1;a<arguments.length;a++){var c=arguments[a]!=null?arguments[a]:{};a%2?gO(Object(c),!0).forEach(function(l){m(r,l,c[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(c)):gO(Object(c)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(c,l))})}return r}({},e),this._useCompress=i}resetReconnectCount(t){v.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,e){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;e?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,e){if(!this._transmitter)return void v.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(e)]},this._joinChannelServiceRecordIndex));const s=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),s&&s.bind(this._transmitter)({code:9999,reason:e})}getInflateData(){const t=this._inflateLength,e=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:e}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var Zs;(function(n){n[n.Default=0]="Default",n[n.Ack=1]="Ack"})(Zs||(Zs={}));class W3{constructor(t,e,i){m(this,"version",1),m(this,"initialRTO",void 0),m(this,"maxBatchAckCount",void 0),m(this,"maxRTO",void 0),m(this,"initialRTT",void 0),m(this,"ID",void 0),m(this,"rtt",void 0),m(this,"packetNumber",1),m(this,"rtoRatioMap",new Map),m(this,"timeoutMap",new Map),m(this,"unorderedPacketQueue",[]),m(this,"batchAckPacketQueue",[]),m(this,"lastOrderedPacketNumber",0),m(this,"batchAckTimer",void 0),m(this,"sendImpl",void 0),m(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=e,this.ID=Be(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:U("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:U("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:U("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:U("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:U("TRANSMITTER_MAX_RTO")}packetize(t,e){return{type:Zs.Default,version:this.version,packetNumber:e,payload:t}}serialize(t){switch(t.type){case Zs.Default:{let e;typeof t.payload=="string"?e=new TextEncoder().encode(t.payload):e=t.payload;const i=new ArrayBuffer(e.length+15),s=new DataView(i);return s.setUint16(0,t.version),s.setUint8(2,t.type),s.setUint32(3,t.packetNumber),ob(s,7,BigInt(t.sendTs)),new Uint8Array(s.buffer).set(e,15),i}case Zs.Ack:{const e=new ArrayBuffer(16),i=new DataView(e);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),ob(i,8,BigInt(t.ackSendTs)),e}}}deserialize(t){const e=new DataView(t),i=e.getUint16(0),s=e.getUint8(2);switch(s){case Zs.Default:{const r=e.getUint32(3),a=rb(e,7),c=t.slice(15),l=new TextDecoder().decode(c);return{version:i,type:s,packetNumber:r,sendTs:Number(a),payload:l}}case Zs.Ack:{const r=e.getUint32(3),a=e.getUint8(7),c=rb(e,8);return{version:i,type:s,maxAckPacketNumber:r,shift:a,ackSendTs:Number(c)}}default:throw v.error("[".concat(this.ID,"] Unrecognized packet type ").concat(s)),new Error("Unrecognized packet type ".concat(s))}}sendMessage(t){const e=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(e),s=window.setTimeout(()=>{this.resendMessage(e)},i);this.timeoutMap.set(e.packetNumber,s),this.sendPacket(e)}onData(t){const e=this.deserialize(t);e.type===Zs.Default?this.ack(e):e.type===Zs.Ack&&(this.updateRTT(e,Math.round(performance.now())),this.clearRTO(e))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[e,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const e=this.calculateRTO(t),i=window.setTimeout(()=>{this.resendMessage(t)},e);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const e=this.rtoRatioMap.get(t.packetNumber);if(e===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*e;return this.rtoRatioMap.set(t.packetNumber,e+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,e){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(e-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const e=this.unorderedPacketQueue[0];if(!e){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(e.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const e={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Zs.Ack,version:this.version};this.sendPacket(e)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const e={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Zs.Ack,version:this.version};this.sendPacket(e)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Zs.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Zs.Default&&(t.sendTs=Math.round(performance.now()));const e=this.serialize(t);this.sendImpl(e)}clearRTO(t){for(let e=t.maxAckPacketNumber-t.shift;e<=t.maxAckPacketNumber;e++){const i=this.timeoutMap.get(e);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(e),this.rtoRatioMap.delete(e)}}}class TO extends G3{constructor(t,e){super(t,e,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),m(this,"_initMutex",void 0),m(this,"_reconnectInterrupter",void 0),m(this,"_url",void 0),m(this,"_transmitter",void 0),m(this,"_addresses",void 0),m(this,"_reliableTransmission",void 0),this._initMutex=new qn("datachannel");const{timeout:i,timeoutFactor:s}=e,r=Math.max(300,Math.floor(3*i/5)),a=Math.max(1.2,Math.floor(8*s)/10);wi.ONLINE&&(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=a),yn.on(Yo.NETWORK_STATE_CHANGE,(c,l)=>{c!==l&&(this.resetReconnectCount("network state change: ".concat(l," -> ").concat(c)),c===wi.ONLINE?(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=a):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=s))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=e;const i=(s,r)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(c=>c.fingerprint||U("FINGERPRINT"));const a=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(a).then(s).catch(r),this.once(hn.CLOSED,()=>r(new j(O.WS_DISCONNECT))),this.once(hn.CONNECTED,()=>s())};return this._initMutex.lock().then(s=>new K((r,a)=>{i(r,a)}).then(()=>{s()}).catch(()=>{s()}))}sendMessage(t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new j(O.WS_ABORT,"datachannel is not ready");try{e||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(i){throw new j(O.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const e=JSON.stringify(t);return{compressed:e,compressedLength:e.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new K((e,i)=>{var s;const r=()=>{v.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),e()},a=async h=>{var f;if((f=this._closeEstablishingTransmitter)===null||f===void 0||f.call(this),v.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(h.code,", reason: ").concat(h.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=h.reason,this.state="reconnecting");const g=us(this,hn.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,S=await this.reconnectWithAction(g);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!S)return i(new j(O.WS_DISCONNECT,"datachannel reconnect failed: ".concat(h.code))),void this.close(!0);e()}else i(new j(O.WS_DISCONNECT,"datachannel close: ".concat(h.code))),this.close()},c=h=>{var f;(f=this._reliableTransmission)===null||f===void 0||f.onData(h.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),v.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const l=(s=this._store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),u=Date.now();rn(this,hn.TO_CONNECT_DATACHANNEL,t).then(h=>{var f,g;if(!h)throw new Error("transmissonInfo not exist yet");const{transmitter:S,close:w}=h;this._transmitter=S,(f=this._store)===null||f===void 0||f.signalChannelOpen();const I=Date.now()-u;v.debug("[choose dc] dc open cost ".concat(I,"ms")),this._reliableTransmission=new W3(b=>{var M;this._transmitter&&this._transmitter.readyState==="open"&&((M=this._transmitter)===null||M===void 0||M.send(b))},b=>{typeof b=="string"&&this.emit(hn.ON_MESSAGE,b)}),this._closeEstablishingTransmitter=()=>{var b;(b=this._reliableTransmission)===null||b===void 0||b.close(),this._reliableTransmission=void 0,w()},r&&r(),S.onclose=a,S.onmessage=c,(g=this._store)===null||g===void 0||g.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this._joinChannelServiceRecordIndex=l}).catch(h=>{var f;if((f=this._store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:h instanceof j&&h.code===O.WS_ABORT?"aborted":"error",errors:[h]},l),this.state!=="closed"){if(h instanceof j&&h.code===O.WS_ERR){const g=new j(O.WS_ERR,"init datachannel failed! Error: ".concat(h.toString()));return v.error("[".concat(this._name,"]").concat(g)),void i(g)}a&&a(h)}else i(new j(O.WS_DISCONNECT,"datachannel is closed: ".concat(h.toString())))})})}async reconnectWithAction(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||yn.networkState!==wi.OFFLINE||(this._onlineReconnectListener=yn.onlineWaiter&&yn.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},e){const c=uf(this._reconnectCount,this._retryConfig);v.debug("[".concat(this._name,"] wait ").concat(c,"ms to reconnect datachannel, mode: ").concat(t)),await K.race([ri(c),this._onlineReconnectListener||new K(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const s=async(c,l)=>{this.emit(hn.RECONNECT_CREATE_CONNECTION,l),await this.createTransmitterConnection(c)};try{if(t==="retry"){const c=this._addresses[this.currentURLIndex];this.emit(hn.RECONNECT_WAITTING_FINISH,t),await s(c,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let l=this.currentURLIndex;l<this._addresses.length;l++){if(this._addresses[l].fingerprint||U("FINGERPRINT")){this.currentURLIndex=l;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return v.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);v.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const c=this._addresses[this.currentURLIndex];this.emit(hn.RECONNECT_WAITTING_FINISH,t),await s(c,t)}else t==="recover"&&(v.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(hn.RECONNECT_WAITTING_FINISH,t),this.emit(hn.FAILBACK));return!0}catch(c){var r,a;return v.error("[".concat(this._name,"] reconnect failed"),c.toString()),c!=null&&(r=c.data)!==null&&r!==void 0&&r.desc&&Array.isArray(c.data.desc)&&c.data.desc.length&&Vt(a=c.data.desc).call(a,"dynamic key expired")?(this.emit(hn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,e)}}}class ea extends Ze{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===oe.CONNECTED?this.emit(ht.WS_CONNECTED):t===oe.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===oe.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),m(this,"_disconnectedReason",void 0),m(this,"_websocketReconnectReason",void 0),m(this,"_connectionState",oe.CLOSED),m(this,"reconnectToken",void 0),m(this,"websocket",void 0),m(this,"openConnectionTime",void 0),m(this,"clientId",void 0),m(this,"lastMsgTime",Date.now()),m(this,"uploadCache",[]),m(this,"uploadCacheInterval",void 0),m(this,"rttRolling",new Qg(5)),m(this,"pingpongTimer",void 0),m(this,"inflateDataTimer",void 0),m(this,"pingpongTimeoutCount",0),m(this,"joinResponse",void 0),m(this,"multiIpOption",void 0),m(this,"initError",void 0),m(this,"spec",void 0),m(this,"store",void 0),m(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,i);const s=JSON.parse(i);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const r="res-@".concat(s._id);this.emit(r,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===Jt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Jt.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close(ce.UID_BANNED);break;case 15:this.close(ce.IP_BANNED);break;case 16:this.close(ce.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new TO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,e),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===oe.CONNECTED&&this.reconnect("retry",fo.OFFLINE)})}async request(t,e,i,s){const r=Be(6,""),a={_id:r,_type:t,_message:e},c=this.websocket.connectionID,l=()=>new K((w,I)=>{if(this.connectionState===oe.CONNECTED)return w();const b=()=>{this.off(ht.WS_CLOSED,M),w()},M=()=>{this.off(ht.WS_CONNECTED,b),I(new j(O.WS_ABORT))};this.once(ht.WS_CONNECTED,b),this.once(ht.WS_CLOSED,M),t!==At.PUBLISH&&t!==At.SUBSCRIBE&&t!==At.UNSUBSCRIBE&&t!==At.UNPUBLISH&&t!==At.CONTROL&&t!==At.RESTART_ICE||this.once(ht.DISCONNECT_P2P,()=>{I(new j(O.DISCONNECT_P2P))}),t!==At.PUBLISH&&t!==At.RESTART_ICE||this.once(ht.ABORT_P2P_EXECUTION,()=>{I(new j(O.DISCONNECT_P2P))})});if(this.connectionState!==oe.CONNECTING&&this.connectionState!==oe.RECONNECTING||t===At.JOIN||t===At.REJOIN||await l(),t===At.LEAVE&&(this.websocket.unbindDcCloseEventListener(),s=!0),this.websocket.sendMessage(a,!0,!1),s)return;const u=new K((w,I)=>{let b=!1;const M=(V,Z)=>{b=!0,w({isSuccess:V==="success",message:Z||{}}),this.off(ht.WS_CLOSED,F),this.off(ht.WS_RECONNECTING,F),this.emit(ht.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(r),M);const F=()=>{I(new j(O.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,F),this.off(ht.WS_RECONNECTING,F),this.off("res-@".concat(r),M)};this.once(ht.WS_CLOSED,F),this.once(ht.WS_RECONNECTING,F),ri(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||b||(v.warning("dc request timeout, type: ".concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,e))})});let h=null;try{h=await u}catch(w){if(this.connectionState===oe.CLOSED||t===At.LEAVE)throw new j(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():t===At.JOIN||t===At.REJOIN?null:(await l(),await this.request(t,e))}if(h.isSuccess)return h.message;const f=Number(h.message.error_code||h.message.code),g=kc(f),S=new j(O.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(h.message.error_str),{code:f,data:h.message});return g.action==="success"?h.message:(v.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(f,", message: ").concat(g.desc,", action: ").concat(g.action)),f===Ut.ERR_TOO_MANY_BROADCASTERS?((t===At.JOIN||t===At.REJOIN)&&(this.initError=S,this.close()),S.throw()):g.action==="failed"?S.throw():g.action==="quit"?(this.initError=S,this.close(),S.throw()):(f===Ut.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",fo.MULTI_IP)):this.reconnect(g.action,fo.SERVER_ERROR),t===At.JOIN||t===At.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new K(i=>{const s=r=>{(!e||e(r))&&(this.off(t,s),i(r))};this.on(t,s)})}upload(t,e){const i={_type:t,_message:e};try{this.websocket.sendMessage(i)}catch{const r=U("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==oe.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},U("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const i={_type:t,_message:e};this.websocket.sendMessage(i)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new K((i,s)=>{this.once(ht.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ht.WS_CLOSED,()=>s(this.initError||new j(O.WS_ABORT))),this.connectionState=oe.CONNECTING,this.websocket.init(t).catch(s),this.websocket.once(hn.FAILBACK,()=>{this.openConnectionTime===void 0&&s(new j(O.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{e&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new j(O.INIT_DATACHANNEL_TIMEOUT)))},U("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||ce.LEAVE,this.connectionState=oe.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===ce.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new TO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION);const t=await rn(this,ht.DATACHANNEL_CONNECTING),e=await this.request(At.JOIN,t);if(!e)return this.emit(ht.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=oe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new j(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=zo(this,ht.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const e=await this.request(At.REJOIN,t);return!!e&&(this.connectionState=oe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),e.peers&&e.peers.forEach(i=>{this.emit(Jt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Jt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Jt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Jt.MUTE_AUDIO,{uid:i.uid}):this.emit(Jt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Jt.MUTE_VIDEO,{uid:i.uid}):this.emit(Jt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Jt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Jt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Jt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Jt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Jt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const e=kc(t.code);if(e.action!=="success"){if(e.action!=="failed")return e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ce.UID_BANNED),void this.close()):void this.reconnect(e.action,fo.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=U("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("PINGPONG Timeout. Last Socket Message: ".concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>U("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",fo.TIMEOUT):this.request(At.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-e;this.rttRolling.add(i),U("REPORT_STATS")&&this.send(At.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:e}=this.websocket.getInflateData();t!==0&&e!==0&&this.upload(es.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(hn.RECONNECT_WAITTING_FINISH,t=>{this.emit(ht.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(hn.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(hn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(hn.CLOSED,()=>{this.connectionState=oe.CLOSED}),this.websocket.on(hn.FAILED,()=>{this._disconnectedReason=ce.NETWORK_ERROR,this.connectionState=oe.CLOSED}),this.websocket.on(hn.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===oe.CONNECTED?this.connectionState=oe.RECONNECTING:this.connectionState=oe.CONNECTING}),this.websocket.on(hn.WILL_RECONNECT,(t,e)=>{if(zo(this,ht.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P),e("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P)),e(t)}),this.websocket.on(hn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",fo.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof j&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ut.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",fo.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",fo.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(hn.REQUEST_NEW_URLS,(t,e)=>{rn(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)}),this.websocket.on(hn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(hn.TO_CONNECT_DATACHANNEL,async(t,e,i)=>rn(this,ht.DATACHANNEL_PRECONNECT,t).then(e).catch(i)),this.websocket.on(hn.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(ht.DATACHANNEL_FAILBACK)})}}class Zf extends Ze{constructor(t){super(),m(this,"_signal",void 0),m(this,"_sequence",0),m(this,"_userMap",new Map),m(this,"_encoder",new TextEncoder),this._signal=t}async send(t,e,i,s,r){var a,c,l;typeof e!="string"&&(e=JSON.stringify(e)),s=(a=s)!==null&&a!==void 0?a:Be(6,""),r=(c=r)!==null&&c!==void 0?c:this._sequence++;const u={_id:s,_type:t,_seq:(l=r)!==null&&l!==void 0?l:this._sequence++,_message:e};if(U("SHOW_P2P_LOG")&&v.debug("send message",u),this.sendStreamMessage(JSON.stringify(u)),i)return;const h=new K((g,S)=>{const w=window.setTimeout(()=>{this.off("res-@".concat(s),I),v.warning("[external-signal] request timeout, type: ".concat(t)),this._userMap.size===0?S(new Q(O.INVALID_REMOTE_USER)):S(new Q(O.TIMEOUT))},U("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),I=(b,M)=>{w&&window.clearTimeout(w),b==="success"?g({isSuccess:!0,message:M}):S(new Q(O.UNEXPECTED_ERROR,M))};this.once("res-@".concat(s),I)});let f;try{f=await h}catch(g){if(g.code===O.TIMEOUT)return await this.send(t,e,!1,s,r);throw g}return f.isSuccess?f.message:void 0}sendStreamMessage(t){this._splitMessage(t).forEach(e=>{this._signal.request(At.DATA_STREAM,{payload:cf(this._encoder.encode(e))})})}onMessage(t){const{_uid:e}=t;let i;const s=this._userMap.get(e);if(s?i=s.splitMessageMap:(i=new Map,this._userMap.set(e,{isStart:!1,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in t&&"total"in t){var r;const{id:a,total:c}=t,l=(r=i.get(a))!==null&&r!==void 0?r:[];if(l.push(t),i.has(a)||i.set(a,l),l.length!==c)return;{const u=Su(l).call(l,(h,f)=>h.index-f.index).map(h=>h.payload).join("");i.delete(a),(t=JSON.parse(u))._uid=e}}this.handleReceivedMessage(t)}setStart(t){this._userMap.has(t)?this._userMap.get(t).isStart=!0:this._userMap.set(t,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(t){return this._userMap.delete(t),this._userMap.size===0}ack(t,e,i){this.send(qe.ACK,JSON.stringify({success:!i,message:e}),!0,t)}handleReceivedMessage(t){const e=()=>{this._userMap.forEach(u=>{const{receivedMessagesMap:h,nextExpectedSequenceNumber:f}=u;for(;h.has(f);){const g=h.get(f);h.delete(f),this.receiveMessage(g),u.nextExpectedSequenceNumber++}})};if(!t)return void e();const{_uid:i,_seq:s}=t,r=this._userMap.get(i),{receivedMessagesMap:a,isStart:c,nextExpectedSequenceNumber:l}=r;s<l?v.debug("[external-signal] receive old message, seq: ".concat(s)):(a.set(s,t),c&&s===l&&(this.receiveMessage(t),a.delete(l),r.nextExpectedSequenceNumber++,e()))}receiveMessage(t){const{_id:e,_type:i,_message:s,_uid:r}=t;if(U("SHOW_P2P_LOG")&&v.debug("收到消息",t),e)switch(t._type){case qe.PUBLISH:const a=JSON.parse(s);this._signal.emit(i,a,r),this.ack(t._id);break;case qe.CONTROL:case qe.UNPUBLISH:case qe.DO_SUBSCRIBE:case qe.DO_UNSUBSCRIBE:{const c=JSON.parse(s);c.uid=r,rn(this._signal,i,c).then(l=>{this.ack(t._id,l)}).catch(l=>{this.ack(t._id,void 0,!0)});break}case qe.ACK:{const{success:c,message:l}=JSON.parse(s);this.emit("res-@".concat(e),c?"success":"failed",l);break}case qe.CALL:rn(this,i,s).then(c=>{this.ack(e,c)});break;case qe.RESTART_ICE:case qe.EXCHANGE_SDP:case qe.SUBSCRIBE:case qe.UNSUBSCRIBE:rn(this._signal,i,s).then(c=>{this.ack(e,c)}).catch(c=>{this.ack(t._id,void 0,!0)});break;case qe.CANDIDATE:this._signal.emit(i,s),this.ack(e);break;case qe.JOIN:this.emit(i,JSON.parse(s));break;default:this.emit(i,s),this.ack(e)}}_splitMessage(t){if(t.length<Zf.MAX_MESSAGE_SIZE)return[t];const e=[],i=Be(6,"");let s=0;const r=Math.ceil(t.length/800);for(;t.length>0;){s++;const a=t.slice(0,800);e.push({id:i,index:s,total:r,payload:a}),t=t.slice(800)}return e.map(a=>JSON.stringify(a))}clear(){this._sequence=0,this._userMap.clear()}}m(Zf,"MAX_MESSAGE_SIZE",1024);class SO extends Ze{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===oe.CONNECTED?this.emit(ht.WS_CONNECTED):t===oe.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===oe.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),m(this,"_disconnectedReason",void 0),m(this,"_websocketReconnectReason",void 0),m(this,"_connectionState",oe.CLOSED),m(this,"reconnectToken",void 0),m(this,"_userInRoom",!1),m(this,"_userOnlineTime",void 0),m(this,"websocket",void 0),m(this,"openConnectionTime",void 0),m(this,"clientId",void 0),m(this,"lastMsgTime",Date.now()),m(this,"uploadCache",[]),m(this,"uploadCacheInterval",void 0),m(this,"rttRolling",new Qg(5)),m(this,"pingpongTimer",void 0),m(this,"wsInflateDataTimer",void 0),m(this,"pingpongTimeoutCount",0),m(this,"joinResponse",void 0),m(this,"multiIpOption",void 0),m(this,"initError",void 0),m(this,"spec",void 0),m(this,"store",void 0),m(this,"_external_signal",void 0),m(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const r="res-@".concat(s._id);this.emit(r,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case Jt.ON_DATA_STREAM:return void this.handleDataStream(s._message);case Jt.MUTE_AUDIO:case Jt.MUTE_VIDEO:case Jt.ON_P2P_LOST:return;case Jt.ON_USER_ONLINE:this.emit(s._type,s._message);const{uid:r}=s._message;return this._external_signal.setStart(r),void this._external_signal.send(qe.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(s._type,s._message),s._type===Jt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Jt.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(ce.UID_BANNED);break;case 15:this.close(ce.IP_BANNED);break;case 16:this.close(ce.CHANNEL_BANNED)}if(s._type===Jt.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Ut.ERR_LICENSE_MISSING:this.close(ce.LICENSE_MISSING);break;case Ut.ERR_LICENSE_EXPIRED:this.close(ce.LICENSE_EXPIRED);break;case Ut.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ce.LICENSE_MINUTES_EXCEEDED);break;case Ut.ERR_LICENSE_PERIOD_INVALID:this.close(ce.LICENSE_PERIOD_INVALID);break;case Ut.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ce.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ut.ERR_LICENSE_ILLEGAL:this.close(ce.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new xu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),e),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===oe.CONNECTED&&this.reconnect("retry",Fn.OFFLINE)}),this._external_signal=new Zf(this),this._handleSignalP2PEvents()}async request(t,e,i,s){const r=Be(6,""),a={_id:r,_type:t,_message:e},c=this.websocket.connectionID,l=()=>new K((w,I)=>{if(this.connectionState===oe.CONNECTED)return w();const b=()=>{this.off(ht.WS_CLOSED,M),w()},M=()=>{this.off(ht.WS_CONNECTED,b),I(new Q(O.WS_ABORT))};this.once(ht.WS_CONNECTED,b),this.once(ht.WS_CLOSED,M),t!==At.PUBLISH&&t!==At.SUBSCRIBE&&t!==At.UNSUBSCRIBE&&t!==At.UNPUBLISH&&t!==At.CONTROL&&t!==At.RESTART_ICE||this.once(ht.DISCONNECT_P2P,()=>{I(new Q(O.DISCONNECT_P2P))}),t!==At.PUBLISH&&t!==At.RESTART_ICE||this.once(ht.ABORT_P2P_EXECUTION,()=>{I(new Q(O.DISCONNECT_P2P))})});if(this.connectionState!==oe.CONNECTING&&this.connectionState!==oe.RECONNECTING||t===At.JOIN||t===At.REJOIN||await l(),this.websocket.sendMessage(a,!0),s)return;const u=new K((w,I)=>{let b=!1;const M=(V,Z)=>{b=!0,w({isSuccess:V==="success",message:Z||{}}),this.off(ht.WS_CLOSED,F),this.off(ht.WS_RECONNECTING,F),this.emit(ht.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(r),M);const F=()=>{I(new Q(O.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,F),this.off(ht.WS_RECONNECTING,F),this.off("res-@".concat(r),M)};this.once(ht.WS_CLOSED,F),this.once(ht.WS_RECONNECTING,F),ri(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||b||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,e))})});let h=null;try{h=await u}catch(w){if(this.connectionState===oe.CLOSED||t===At.LEAVE)throw new Q(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():t===At.JOIN||t===At.REJOIN?null:(await l(),await this.request(t,e))}if(h.isSuccess)return h.message;const f=Number(h.message.error_code||h.message.code),g=kc(f),S=new Q(O.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(h.message.error_str),{code:f,data:h.message});return g.action==="success"?h.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(f,", message: ").concat(g.desc,", action: ").concat(g.action)),f===Ut.ERR_TOO_MANY_BROADCASTERS?((t===At.JOIN||t===At.REJOIN)&&(this.initError=S,this.close()),S.throw()):g.action==="failed"?S.throw():g.action==="quit"?(this.initError=S,this.close(),S.throw()):(f===Ut.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Fn.MULTI_IP)):this.reconnect(g.action,Fn.SERVER_ERROR),t===At.JOIN||t===At.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new K(i=>{const s=r=>{(!e||e(r))&&(this.off(t,s),i(r))};this.on(t,s)})}upload(t,e){const i={_type:t,_message:e};try{this.websocket.sendMessage(i)}catch{const r=U("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==oe.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},U("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const i={_type:t,_message:e};this.websocket.sendMessage(i)}async sendExtensionMessage(t,e,i){return await this.waitTillUserOnline(),await this._external_signal.send(t,e,i)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new K((i,s)=>{this.once(ht.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ht.WS_CLOSED,()=>s(this.initError||new Q(O.WS_ABORT))),this.connectionState=oe.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||ce.LEAVE,this.connectionState=oe.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===ce.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new xu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION);const t=await rn(this,ht.REQUEST_JOIN_INFO),e=await this.request(At.JOIN,t);if(!e)return this.emit(ht.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=oe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),this._userOnlineTime=new Date().getTime(),this._external_signal.clear(),!0}async rejoin(){if(!this.reconnectToken)throw new Q(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=zo(this,ht.REQUEST_REJOIN_INFO);return t.token=this.reconnectToken,!!await this.request(At.REJOIN,t)&&(this.connectionState=oe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleDataStream(t){try{var e;const i=af(t.payload),s=new TextDecoder().decode(i),r=JSON.parse(s);"total"in r&&"id"in r||Vt(e=Object.values(qe)).call(e,r._type)?(t.seq&&delete t.seq,r._uid=t.uid,this._external_signal.onMessage(r)):this.emit(Jt.ON_DATA_STREAM,t)}catch{}}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const e=kc(t.code);if(e.action!=="success"){if(e.action!=="failed")return e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ce.UID_BANNED),void this.close()):void this.reconnect(e.action,Fn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=U("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>U("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Fn.TIMEOUT):this.request(At.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-e;this.rttRolling.add(i),U("REPORT_STATS")&&this.send(At.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:e}=this.websocket.getWsInflateData();t!==0&&e!==0&&this.upload(es.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ht.RECONNECT_WAITTING_FINISH,t=>{this.emit(ht.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Ht.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ht.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ht.CLOSED,()=>{this.connectionState=oe.CLOSED}),this.websocket.on(Ht.FAILED,()=>{this._disconnectedReason=ce.NETWORK_ERROR,this.connectionState=oe.CLOSED}),this.websocket.on(Ht.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===oe.CONNECTED?this.connectionState=oe.RECONNECTING:this.connectionState=oe.CONNECTING}),this.websocket.on(Ht.WILL_RECONNECT,(t,e,i)=>{if(zo(this,ht.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P),i("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P)),i(t)}),this.websocket.on(Ht.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Fn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof Q&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ut.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Fn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Fn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ht.REQUEST_NEW_URLS,(t,e)=>{rn(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)}),this.websocket.on(Ht.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){this._external_signal.on(qe.JOIN,async t=>{if(this._userOnlineTime&&this._userOnlineTime<t.onlineTime){const e=await rn(this,ht.P2P_START,void 0),i=await this._external_signal.send(qe.CALL,e);this.emit(ht.P2P_CONNECTION,i,!0)}this._userInRoom=!0,this.emit("user-online")}),this.on(Jt.ON_USER_OFFLINE,async t=>{this._external_signal.clear(),this._userInRoom=!1}),this._external_signal.on(qe.CALL,async(t,e,i)=>{this._userInRoom=!0,this.emit("user-online");try{e(await rn(this,ht.P2P_START,t))}catch(s){i(s)}})}async waitTillUserOnline(){return new K(t=>{if(this._userInRoom)t();else{const e=()=>{this.off("user-online",e),t()};this.on("user-online",e)}})}}function vO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Cr(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?vO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):vO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}const gS=new Map;class H3 extends Ze{get state(){return this._state}set state(t){if(t===this._state)return;const e=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(cn.CONNECTION_STATE_CHANGE,t,e,this._disconnectedReason):this.emit(cn.CONNECTION_STATE_CHANGE,t,e)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){v.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,e){super(),m(this,"store",void 0),m(this,"joinInfo",void 0),m(this,"key",void 0),m(this,"ntpOffset",0),m(this,"signal",void 0),m(this,"role",void 0),m(this,"inChannelInfo",{joinAt:null,duration:0}),m(this,"spec",void 0),m(this,"_state","DISCONNECTED"),m(this,"_statsCollector",void 0),m(this,"_disconnectedReason",void 0),m(this,"isSignalRecover",!1),m(this,"hasChangeBGPAddress",!1),m(this,"trafficStatsInterval",void 0),m(this,"networkQualityInterval",void 0),m(this,"_joinGatewayStartTime",0),m(this,"_signalTimeout",!1),m(this,"_clientRoleOptions",void 0),m(this,"_isProactiveJoin",!1),this.store=t,this.spec=e,this.signal=this.store.useP2P?new SO(Cr(Cr({},e),{},{retryConfig:e.websocketRetryConfig}),t):this.store.useDataChannel?new ea(Cr(Cr({},e),{},{retryConfig:e.websocketRetryConfig}),t):new FA(Cr(Cr({},e),{},{retryConfig:e.websocketRetryConfig}),t),this._statsCollector=e.statsCollector,this.role=e.role||"audience",this._clientRoleOptions=e.clientRoleOptions,this.handleSignalEvents()}async join(t,e,i){if(this.signal instanceof ea){let l=!1;t.cloudProxyServer!=="disabled"?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),l=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),l=!0):t.apResponse.addresses.some(u=>u.fingerprint)||U("FINGERPRINT")||(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),l=!0),l&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let r=gS.get(t.cname);if(r||(r=new Map,gS.set(t.cname,r)),this._isProactiveJoin=!0,r.has(t.uid)){const l=new j(O.UID_CONFLICT);throw wt.joinGateway(t.sid,{lts:s,succ:!1,ec:l.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof ea?"1":"0"}),this._isProactiveJoin=!1,l}r.set(t.uid,!0),this.joinInfo=t,this.key=e;let a=0;this.joinGatewayStartTime=s;const c=t.proxyServer;try{let l;if(v.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof ea?"datachannel":"websocket"," join uid ").concat(a)),this.signal instanceof ea)l=await this.signal.init(t.apResponse.addresses,i);else{const u=t.gatewayAddrs.map(h=>{let{address:f}=h;const[g,S]=f.split(":"),w={host:g,port:S};return t.proxyServer&&(w.proxy=t.proxyServer),w});l=await this.signal.init(u,i)}a=l.uid,v.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof ea?"datachannel":"websocket"," join uid ").concat(a," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(l){throw l&&l.code===O.INIT_WEBSOCKET_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join failed"),l.toString()),l):l&&l.code===O.INIT_DATACHANNEL_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join datachannel failed"),l.toString()),this.resetSignal(),l):(v.error("[".concat(this.store.clientId,"] User join failed"),l.toString()),wt.joinGateway(t.sid,{lts:s,succ:!1,ec:l.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!c,signalChannel:this.signal instanceof ea?"1":"0"}),this._isProactiveJoin=!1,r.delete(t.uid),this.signal.close(),l)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),v.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(l=>{v.warning("[".concat(this.store.clientId,"] get traffic stats error"),l.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(cn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(cn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(cn.NETWORK_QUALITY,{uplinkNetworkQuality:EO(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:EO(this._statsCollector.trafficStats.B_dnq)}):this.emit(cn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),a}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){e!==ce.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==oe.CONNECTED||await function(i,s){return s===1/0?i:K.race([i,XF(s)])}(this.signal.request(At.LEAVE,void 0,!0),3e3)}catch(i){v.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(e),e!==ce.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,e,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:e,mode:this.spec.mode,extend:U("PUB_EXTEND"),twcc:!!U("PUBLISH_TWCC"),rtx:!!U("USE_PUB_RTX")};try{return(await this.signal.request(At.PUBLISH,s,!0))._message}catch(r){if(i&&r.data&&r.data.code===Ut.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(t,e),this.publish(t,e,!1);throw r}}async publishDataChannel(t,e,i){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={stream_id:e.streamId,ordered:e.ordered?1:0,max_retrans_times:(s=e.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:e.channelId,metadata:e.metadata};try{await this.signal.request(At.PUBLISH_DATASTREAM,r,!0)}catch(a){if(i&&a.data&&a.data.code===Ut.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),a.toString()),await this.tryUnpubDataChannelBeforeRepub(t,e),this.publishDataChannel(t,e,!1);throw a}}async unpublish(t,e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(At.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await K.all(t.map(e=>this.signal.request(At.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){v.warning("unpublish datachannels warning: ",e)}}async subscribe(t,e,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:e.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!U("SUBSCRIBE_TWCC"),rtx:!!U("USE_SUB_RTX"),extend:U("SUB_EXTEND"),ssrcId:e.ssrcId,svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return(await this.signal.request(At.SUBSCRIBE,s,!0))._message}catch(r){if(i&&r.data&&r.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(t,e),await this.subscribe(t,e,!1);throw r}}async subscribeDataChannel(t,e,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:t,stream_id:e.id,channel_id:e.datachannelId};try{return void await this.signal.request(At.SUBSCRIBE_DATASTREAM,s,!0)}catch(r){if(i&&r.data&&r.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),r.toString()),await this.tryUnsubDataChannelBeforeResub(t,e),await this.subscribeDataChannel(t,e,!1);throw r}}async subscribeAll(t,e){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!U("USE_SUB_RTX")};try{return await this.signal.request(At.SUBSCRIBE_STREAMS,i,!0)}catch(s){if(e&&s.data&&s.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw s}}async setVideoProfile(t){const e=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let s=i.frameRate,r=i.width,a=i.height,c=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(c=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,s||(c=!1)),c?{stream_type:0,width:r,height:a,fps:s,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(e)return this.signal.request(At.SET_VIDEO_PROFILE,e);v.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,e){try{await this.signal.request(At.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:e},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await K.all(t.map(i=>this.signal.request(At.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:e},!0)))}catch(i){v.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(At.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){v.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(t){const{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(At.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(At.GATEWAY_INFO)}async renewToken(t){await this.signal.request(At.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,e){if(e&&(this._clientRoleOptions=Object.assign({},e)),this.state!=="CONNECTED")return void(this.role=t);let i,s=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(At.SET_CLIENT_ROLE,{role:t,level:s,delay:i,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,e){await this.signal.request(At.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:e})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(At.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,e){await this.signal.request(At.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:e})}async pickSVCLayer(t,e){await this.signal.request(At.PICK_SVC_LAYER,{stream_id:t,spatial_layer:e.spatialLayer,temporal_layer:e.temporalLayer})}async setRTM2Flag(t){await this.signal.request(At.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,e,i){if(this.signal instanceof SO)return this.signal.sendExtensionMessage(t,e,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Cr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(At.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=gS.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(e){let i;return i=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:ws.username,password:ws.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Cr(Cr({},ws),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(At.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(e=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===e.peer_uid);i&&i.B_st!==e.B_st&&mr(()=>{this.emit(cn.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new j(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const e=Object.assign({},this.joinInfo.apResponse);let i=U("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const s=Cr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:zs,browser:navigator.userAgent,process_id:U("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:e,extend:U("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:U("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:U("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof U("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?U("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof U("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?U("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof U("ENABLE_USER_LICENSE_CHECK")=="boolean"?U("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:U("USE_PUB_RTX")===!0||U("USE_SUB_RTX")===!0||void 0,disableFEC:U("DISABLE_FEC"),enableNTPReport:!!U("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!U("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof U("ENABLE_DATASTREAM_2")=="boolean"?U("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof U("RTM2_FLAG")=="number"?U("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!U("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof U("USE_XR")=="boolean"?U("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,U("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),e.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=e.addresses[this.signal.websocket.currentURLIndex].ticket,delete e.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s.default_video_stream=this.joinInfo.defaultVideoStream),s}getRejoinMessage(){if(!this.joinInfo)throw new j(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ht.WS_RECONNECT_WAITTING_FINISH,t=>{var e;Vt(e=["tryNext","recover"]).call(e,t)&&this.joinInfo&&wt.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(ht.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ht.WS_RECONNECTING,t=>{this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Fn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",wt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ht.WS_CLOSED,t=>{let e;switch(t){case ce.LEAVE:e=Fn.LEAVE;break;case ce.UID_BANNED:case ce.IP_BANNED:case ce.CHANNEL_BANNED:case ce.SERVER_ERROR:e=Fn.SERVER_ERROR;break;case ce.FALLBACK:e=Fn.FALLBACK;break;case ce.LICENSE_MISSING:case ce.LICENSE_EXPIRED:case ce.LICENSE_MINUTES_EXCEEDED:case ce.LICENSE_PERIOD_INVALID:case ce.LICENSE_MULTIPLE_SDK_SERVICE:case ce.LICENSE_ILLEGAL:case ce.TOKEN_EXPIRE:e=t;break;default:e=Fn.NETWORK_ERROR}v.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(e||"undefined -> "+Fn.NETWORK_ERROR)),this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===ce.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e}),this._disconnectedReason=t,t!==ce.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ht.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(v.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ea?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void v.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));je("EVENT_REPORT_DOMAIN",t[1]),je("EVENT_REPORT_BACKUP_DOMAIN",t[1]),je("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(Jt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ht.REQUEST_RECOVER,(t,e,i)=>{if(!this.joinInfo)return i(new j(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,rn(this,cn.REQUEST_NEW_GATEWAY_LIST).then(e).catch(i)}),this.signal.on(ht.REQUEST_JOIN_INFO,async t=>{var e;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const{iceParameters:i,dtlsParameters:s,rtpCapabilities:r}=await rn(this,cn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(e=this.joinInfo)===null||e===void 0?void 0:e.turnServer});t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:r,version:"2"}}))}),this.signal.on(ht.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ht.REPORT_JOIN_GATEWAY,(t,e)=>{this.joinInfo&&(wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:e,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ea?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(ht.IS_P2P_DISCONNECTED,t=>{t(zo(this,cn.IS_P2P_DISCONNECTED))}),this.signal.on(ht.DISCONNECT_P2P,()=>{this.emit(cn.DISCONNECT_P2P)}),this.signal.on(ht.NEED_RENEW_SESSION,()=>{this.emit(cn.NEED_RENEW_SESSION)}),this.signal.on(ht.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ht.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ht.JOIN_RESPONSE,t=>{const e=this.getCurrentGatewayAddress();this.emit(cn.JOIN_RESPONSE,t,e)}),this.signal.on(ht.DATACHANNEL_PRECONNECT,async(t,e,i)=>{this.updateTurnConfigFromSignal();const s=this.getCurrentGatewayAddress();return rn(this,cn.DATACHANNEL_PRECONNECT,t,s).then(e).catch(i)}),this.signal.on(ht.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}=await rn(this,cn.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:e,dtlsParameters:i,rtpCapabilities:s,version:"2"}}))}),this.signal.on(ht.DATACHANNEL_FAILBACK,()=>{v.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(cn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,e){try{await this.signal.request(At.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[e]},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,e){try{await this.signal.request(At.UNSUBSCRIBE,{stream_id:e.id},!0)}catch(i){throw v.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,e){try{await this.signal.request(At.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,e){try{await this.signal.request(At.UNPUBLISH_DATASTREAM,{channnel_id:e.channelId},!0)}catch(i){throw v.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const e={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(At.UNSUBSCRIBE_STREAMS,e,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,e){const i={action:t.find(s=>s.stream_type===ke.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(At.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(t,e){const i={action:t.find(s=>s.stream_type===ke.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(At.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(t,e){const i={action:t===yt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:e};try{await this.signal.request(At.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(t,e){const i={action:t===yt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:e};try{await this.signal.request(At.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadStats(t,e){this.signal.upload(t,e)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const e={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(At.RESTART_ICE,e,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Fn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!U("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(At.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(ce.FALLBACK)),this.store.useDataChannel=!1,this.signal=new FA(Cr(Cr({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(cn.RESET_SIGNAL,yf.websocket)}}let t_=0,TS=0;function na(n,t,e,i){return new K((s,r)=>{t.timeout=t.timeout||U("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!e?(t.data=JSON.stringify(t.data),t_+=ho(t.data)):e&&(t.data.size?t_+=t.data.size:t.data instanceof FormData?t_+=_b(t.data):t_+=ho(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=n,Zi.request(t).then(a=>{typeof a.data=="string"?TS+=ho(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?TS+=a.data.byteLength:TS+=ho(JSON.stringify(a.data)),i&&s({data:a.data,headers:a.headers}),s(a.data)}).catch(a=>{Zi.isCancel(a)?r(new j(O.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?r(new j(O.NETWORK_TIMEOUT,a.message)):a.response?r(new j(O.NETWORK_RESPONSE_ERROR,a.response.status)):r(new j(O.NETWORK_ERROR,a.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var n;function t(nt){var ct=0;return function(){return ct<nt.length?{done:!1,value:nt[ct++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(nt,ct,Ct){return nt==Array.prototype||nt==Object.prototype||(nt[ct]=Ct.value),nt},i,s=function(nt){nt=[typeof globalThis=="object"&&globalThis,nt,typeof window=="object"&&window,typeof self=="object"&&self,typeof Y=="object"&&Y];for(var ct=0;ct<nt.length;++ct){var Ct=nt[ct];if(Ct&&Ct.Math==Math)return Ct}throw Error("Cannot find global object")}(this);function r(nt,ct){if(ct)t:{var Ct=s;nt=nt.split(".");for(var Yt=0;Yt<nt.length-1;Yt++){var Ie=nt[Yt];if(!(Ie in Ct))break t;Ct=Ct[Ie]}(ct=ct(Yt=Ct[nt=nt[nt.length-1]]))!=Yt&&ct!=null&&e(Ct,nt,{configurable:!0,writable:!0,value:ct})}}function a(nt){return(nt={next:nt})[Symbol.iterator]=function(){return this},nt}function c(nt){var ct=typeof Symbol<"u"&&Symbol.iterator&&nt[Symbol.iterator];return ct?ct.call(nt):{next:t(nt)}}if(r("Symbol",function(nt){function ct(Ie,ut){this.A=Ie,e(this,"description",{configurable:!0,writable:!0,value:ut})}if(nt)return nt;ct.prototype.toString=function(){return this.A};var Ct="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Yt=0;return function Ie(ut){if(this instanceof Ie)throw new TypeError("Symbol is not a constructor");return new ct(Ct+(ut||"")+"_"+Yt++,ut)}}),r("Symbol.iterator",function(nt){if(nt)return nt;nt=Symbol("Symbol.iterator");for(var ct="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ct=0;Ct<ct.length;Ct++){var Yt=s[ct[Ct]];typeof Yt=="function"&&typeof Yt.prototype[nt]!="function"&&e(Yt.prototype,nt,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return nt}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var l;t:{var u={};try{u.__proto__={a:!0},l=u.a;break t}catch{}l=!1}i=l?function(nt,ct){if(nt.__proto__=ct,nt.__proto__!==ct)throw new TypeError(nt+" is not extensible");return nt}:null}var h=i;function f(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function g(nt){if(nt.m)throw new TypeError("Generator is already running");nt.m=!0}function S(nt,ct){return nt.h=3,{value:ct}}function w(nt){this.g=new f,this.G=nt}function I(nt,ct,Ct,Yt){try{var Ie=ct.call(nt.g.j,Ct);if(!(Ie instanceof Object))throw new TypeError("Iterator result "+Ie+" is not an object");if(!Ie.done)return nt.g.m=!1,Ie;var ut=Ie.value}catch(y){return nt.g.j=null,nt.g.s(y),b(nt)}return nt.g.j=null,Yt.call(nt.g,ut),b(nt)}function b(nt){for(;nt.g.h;)try{var ct=nt.G(nt.g);if(ct)return nt.g.m=!1,{value:ct.value,done:!1}}catch(Ct){nt.g.v=void 0,nt.g.s(Ct)}if(nt.g.m=!1,nt.g.l){if(ct=nt.g.l,nt.g.l=null,ct.F)throw ct.D;return{value:ct.return,done:!0}}return{value:void 0,done:!0}}function M(nt){this.next=function(ct){return nt.o(ct)},this.throw=function(ct){return nt.s(ct)},this.return=function(ct){return function(Ct,Yt){g(Ct.g);var Ie=Ct.g.j;return Ie?I(Ct,"return"in Ie?Ie.return:function(ut){return{value:ut,done:!0}},Yt,Ct.g.return):(Ct.g.return(Yt),b(Ct))}(nt,ct)},this[Symbol.iterator]=function(){return this}}function F(nt,ct){return ct=new M(new w(ct)),h&&nt.prototype&&h(ct,nt.prototype),ct}if(f.prototype.o=function(nt){this.v=nt},f.prototype.s=function(nt){this.l={D:nt,F:!0},this.h=this.C||this.u},f.prototype.return=function(nt){this.l={return:nt},this.h=this.u},w.prototype.o=function(nt){return g(this.g),this.g.j?I(this,this.g.j.next,nt,this.g.o):(this.g.o(nt),b(this))},w.prototype.s=function(nt){return g(this.g),this.g.j?I(this,this.g.j.throw,nt,this.g.o):(this.g.s(nt),b(this))},r("Array.prototype.entries",function(nt){return nt||function(){return function(ct,Ct){ct instanceof String&&(ct+="");var Yt=0,Ie=!1,ut={next:function(){if(!Ie&&Yt<ct.length){var y=Yt++;return{value:Ct(y,ct[y]),done:!1}}return Ie=!0,{done:!0,value:void 0}}};return ut[Symbol.iterator]=function(){return ut},ut}(this,function(ct,Ct){return[ct,Ct]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var V=function(nt,ct){for(var Ct=0;Ct<nt.length;Ct++)ct(nt[Ct])},Z=function(nt){return nt.replace(/\r?\n|\r/g,`\r
`)},$=function(nt,ct,Ct){return ct instanceof Blob?(Ct=Ct!==void 0?Ct+"":typeof ct.name=="string"?ct.name:"blob",ct.name===Ct&&Object.prototype.toString.call(ct)!=="[object Blob]"||(ct=new File([ct],Ct)),[String(nt),ct]):[String(nt),String(ct)]},W=function(nt,ct){if(nt.length<ct)throw new TypeError(ct+" argument required, but only "+nt.length+" present.")},q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,et=q.FormData,_t=q.XMLHttpRequest&&q.XMLHttpRequest.prototype.send,lt=q.Request&&q.fetch,Xt=q.navigator&&q.navigator.sendBeacon,pe=q.Element&&q.Element.prototype,ve=q.Symbol&&Symbol.toStringTag;ve&&(Blob.prototype[ve]||(Blob.prototype[ve]="Blob"),"File"in q&&!File.prototype[ve]&&(File.prototype[ve]="File"));try{new File([],"")}catch{q.File=function(ct,Ct,Yt){return ct=new Blob(ct,Yt||{}),Object.defineProperties(ct,{name:{value:Ct},lastModified:{value:+(Yt&&Yt.lastModified!==void 0?new Date(Yt.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ve&&Object.defineProperty(ct,ve,{value:"File"}),ct}}var Ue=function(nt){return nt.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},de=function(nt){this.i=[];var ct=this;nt&&V(nt.elements,function(Ct){if(Ct.name&&!Ct.disabled&&Ct.type!=="submit"&&Ct.type!=="button"&&!Ct.matches("form fieldset[disabled] *"))if(Ct.type==="file"){var Yt=Ct.files&&Ct.files.length?Ct.files:[new File([],"",{type:"application/octet-stream"})];V(Yt,function(Ie){ct.append(Ct.name,Ie)})}else Ct.type==="select-multiple"||Ct.type==="select-one"?V(Ct.options,function(Ie){!Ie.disabled&&Ie.selected&&ct.append(Ct.name,Ie.value)}):Ct.type==="checkbox"||Ct.type==="radio"?Ct.checked&&ct.append(Ct.name,Ct.value):(Yt=Ct.type==="textarea"?Z(Ct.value):Ct.value,ct.append(Ct.name,Yt))})};if((n=de.prototype).append=function(nt,ct,Ct){W(arguments,2),this.i.push($(nt,ct,Ct))},n.delete=function(nt){W(arguments,1);var ct=[];nt=String(nt),V(this.i,function(Ct){Ct[0]!==nt&&ct.push(Ct)}),this.i=ct},n.entries=function nt(){var ct,Ct=this;return F(nt,function(Yt){if(Yt.h==1&&(ct=0),Yt.h!=3)return ct<Ct.i.length?Yt=S(Yt,Ct.i[ct]):(Yt.h=0,Yt=void 0),Yt;ct++,Yt.h=2})},n.forEach=function(nt,ct){W(arguments,1);for(var Ct=c(this),Yt=Ct.next();!Yt.done;Yt=Ct.next()){var Ie=c(Yt.value);Yt=Ie.next().value,Ie=Ie.next().value,nt.call(ct,Ie,Yt,this)}},n.get=function(nt){W(arguments,1);var ct=this.i;nt=String(nt);for(var Ct=0;Ct<ct.length;Ct++)if(ct[Ct][0]===nt)return ct[Ct][1];return null},n.getAll=function(nt){W(arguments,1);var ct=[];return nt=String(nt),V(this.i,function(Ct){Ct[0]===nt&&ct.push(Ct[1])}),ct},n.has=function(nt){W(arguments,1),nt=String(nt);for(var ct=0;ct<this.i.length;ct++)if(this.i[ct][0]===nt)return!0;return!1},n.keys=function nt(){var ct,Ct,Yt,Ie,ut=this;return F(nt,function(y){if(y.h==1&&(ct=c(ut),Ct=ct.next()),y.h!=3)return Ct.done?void(y.h=0):(Yt=Ct.value,Ie=c(Yt),S(y,Ie.next().value));Ct=ct.next(),y.h=2})},n.set=function(nt,ct,Ct){W(arguments,2),nt=String(nt);var Yt=[],Ie=$(nt,ct,Ct),ut=!0;V(this.i,function(y){y[0]===nt?ut&&(ut=!Yt.push(Ie)):Yt.push(y)}),ut&&Yt.push(Ie),this.i=Yt},n.values=function nt(){var ct,Ct,Yt,Ie,ut=this;return F(nt,function(y){if(y.h==1&&(ct=c(ut),Ct=ct.next()),y.h!=3)return Ct.done?void(y.h=0):(Yt=Ct.value,(Ie=c(Yt)).next(),S(y,Ie.next().value));Ct=ct.next(),y.h=2})},de.prototype._asNative=function(){for(var nt=new et,ct=c(this),Ct=ct.next();!Ct.done;Ct=ct.next()){var Yt=c(Ct.value);Ct=Yt.next().value,Yt=Yt.next().value,nt.append(Ct,Yt)}return nt},de.prototype._blob=function(){var nt="----formdata-polyfill-"+Math.random(),ct=[],Ct="--"+nt+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Yt,Ie){return typeof Yt=="string"?ct.push(Ct+Ue(Z(Ie))+`"\r
\r
`+Z(Yt)+`\r
`):ct.push(Ct+Ue(Z(Ie))+'"; filename="'+Ue(Yt.name)+`"\r
Content-Type: `+(Yt.type||"application/octet-stream")+`\r
\r
`,Yt,`\r
`)}),ct.push("--"+nt+"--"),new Blob(ct,{type:"multipart/form-data; boundary="+nt})},de.prototype[Symbol.iterator]=function(){return this.entries()},de.prototype.toString=function(){return"[object FormData]"},pe&&!pe.matches&&(pe.matches=pe.matchesSelector||pe.mozMatchesSelector||pe.msMatchesSelector||pe.oMatchesSelector||pe.webkitMatchesSelector||function(nt){for(var ct=(nt=(this.document||this.ownerDocument).querySelectorAll(nt)).length;0<=--ct&&nt.item(ct)!==this;);return-1<ct}),ve&&(de.prototype[ve]="FormData"),_t){var Nn=q.XMLHttpRequest.prototype.setRequestHeader;q.XMLHttpRequest.prototype.setRequestHeader=function(nt,ct){Nn.call(this,nt,ct),nt.toLowerCase()==="content-type"&&(this.B=!0)},q.XMLHttpRequest.prototype.send=function(nt){nt instanceof de?(nt=nt._blob(),this.B||this.setRequestHeader("Content-Type",nt.type),_t.call(this,nt)):_t.call(this,nt)}}lt&&(q.fetch=function(nt,ct){return ct&&ct.body&&ct.body instanceof de&&(ct.body=ct.body._blob()),lt.call(this,nt,ct)}),Xt&&(q.navigator.sendBeacon=function(nt,ct){return ct instanceof de&&(ct=ct._asNative()),Xt.call(this,nt,ct)}),q.FormData=de}})();const e_=()=>{const n=U("AREAS");return n.length===0&&n.push(ge.GLOBAL),Nc(n).call(n,(t,e,i)=>{const s=CO(e);return s?i===0?s:"".concat(t,",").concat(s):t},"")},CO=n=>n===ge.OVERSEA?"".concat(ni.ASIA,",").concat(ni.EUROPE,",").concat(ni.AFRICA,",").concat(ni.NORTH_AMERICA,",").concat(ni.SOUTH_AMERICA,",").concat(ni.OCEANIA):ni[n],K3=n=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return n.map(e=>{const i=Rf[e],s=Object.keys(i);s&&s.map(r=>{r!=="CODE"&&(t[r]=t[r].concat(i[r]))})}),t},n_={GLOBAL:{ASIA:[ge.CHINA,ge.JAPAN,ge.INDIA,ge.KOREA,ge.HKMC],EUROPE:[],NORTH_AMERICA:[ge.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},i_=Object.keys(n_[ge.GLOBAL]),SS=[ge.CHINA,ge.NORTH_AMERICA,ge.EUROPE,ge.ASIA,ge.JAPAN,ge.INDIA,ge.OCEANIA,ge.SOUTH_AMERICA,ge.AFRICA,ge.KOREA,ge.HKMC,ge.US],q3=function(n,t){let e=[];if(Vt(n).call(n,ge.GLOBAL)){const r=[ge.GLOBAL,ge.OVERSEA],a=Object.keys(Rf);if(t===ge.GLOBAL)throw new j(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===ge.CHINA)e=[ge.OVERSEA];else if(s=t,Vt(i_).call(i_,s)){const c=(i=t,n_[ge.GLOBAL][i]||[]),l=[...r,t,...c];e=a.filter(u=>!Vt(l).call(l,u))}else if(function(c){let l=!1;return i_.forEach(u=>{var h;Vt(h=n_[ge.GLOBAL][u]).call(h,c)&&(l=!0)}),l}(t)){const c=function(u){let h;return i_.forEach(f=>{var g;Vt(g=n_[ge.GLOBAL][f]).call(g,u)&&(h=f)}),h}(t),l=[...r,c,t];e=a.filter(u=>!Vt(l).call(l,u))}else e=n;e=function(c){const l=[];return SS.forEach(u=>{Vt(c).call(c,u)&&l.push(u)}),l.concat(c.filter(u=>!Vt(SS).call(SS,u)))}(e)}else e=n;var i,s;return e};function yO(n){var t,e;if(!n&&Vt(t=U("AREAS")).call(t,ge.EXTENSIONS))return v.debug("update area from ap : reset"),void vS(KB,!0);if(!Vt(e=U("AREAS")).call(e,ge.GLOBAL)||!n)return;let i=Rf.EXTENSIONS;i&&(i={CODE:CO(ge.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(n,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(n,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(n,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(n,".agora.io"),"cds-ap-web-2-".concat(n,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(n,".agora.io"),"sua-ap-web-2-".concat(n,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(n,".agora.io"),"uap-ap-web-2-".concat(n,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(n,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(n,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(n,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(n,".agora.io")]},v.debug("update area from ap success: ".concat(n,",config is "),i),je("AREAS",[ge.EXTENSIONS],!0),Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?je(s,i[s][0]):je(s,i[s])}))}function vS(n){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const e=wt.reportApiInvoke(null,{name:wn.SET_AREA,options:n,tag:sn.TRACER});try{let i=[];if(typeof n=="string"&&(i=[n]),Array.isArray(n)&&(n.forEach(r=>{if(!Vt(wA).call(wA,r))throw new j(O.INVALID_PARAMS,"invalid area code")}),i=n),Object.prototype.toString.call(n)==="[object Object]"){const{areaCode:r,excludedArea:a}=n;if(!r)throw new j(O.INVALID_PARAMS,"area code is needed");let c=r;typeof r=="string"&&(c=[r]),i=a?q3(c,a):c}if(!t){if(wa.AREAS){const r=new j(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return e.onError(r),void v.warning("setArea is prohibited because of config-distribute")}if(Vt(i).call(i,ge.GLOBAL)&&U("AREAS")===ge.EXTENSIONS){const r=new j(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return e.onError(r),void v.warning("setArea is prohibited because of ap extensions")}}je("AREAS",i,t);const s=K3(i);Object.keys(s).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?je(r,s[r][0]):je(r,s[r])}),v.debug("set area success:",i.join(","))}catch(i){throw e.onError(i),i}e.onSuccess()}function RO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function CS(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?RO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):RO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}let yS=1;function Y3(n,t,e,i,s){yS+=1;const r={sid:e.sid,command:"convergeAllocateEdge",uid:"666",appId:e.appId,ts:Math.floor(Date.now()/1e3),seq:yS,requestId:yS,version:zs,cname:e.cname},a={service_name:t,json_body:JSON.stringify(r)};let c,l,u=n[0];return Ur(async()=>{c=Date.now();const h=await na(u,{data:a,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(l=Date.now()-c,h.code!==0){const S=new j(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+h.code,{retry:!0,responseTime:l});throw v.error(S.toString()),S}const f=JSON.parse(h.json_body);if(f.code!==200){const S=new j(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(f.code,", reason: ").concat(f.reason),{code:f.code,responseTime:l});throw v.error(S.toString()),S}if(!f.servers||f.servers.length===0){const S=new j(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:f.code,responseTime:l});throw v.error(S.toString()),S}const g=function(S,w){return{addressList:S.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(U("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(w))),workerToken:S.workerToken,vid:S.vid}}(f,t);return U("LIVE_STREAMING_ADDRESS")&&(g.addressList=U("LIVE_STREAMING_ADDRESS")instanceof Array?U("LIVE_STREAMING_ADDRESS"):[U("LIVE_STREAMING_ADDRESS")]),CS(CS({},g),{},{responseTime:l})},(h,f)=>(wt.apworkerEvent(e.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(h.addressList),firstSuccess:f===0,responseTime:l,serverIp:n[f%n.length]}),!1),(h,f)=>(wt.apworkerEvent(e.sid,{success:!1,sc:h.data&&h.data.code||200,serviceName:t,responseTime:l,serverIp:n[f%n.length]}),!!(h.code!==O.OPERATION_ABORTED&&h.code!==O.UNEXPECTED_RESPONSE||h.data&&h.data.retry)&&(u=n[(f+1)%n.length],!0)),s)}let RS=1;function IO(n,t,e,i){let{url:s,areaCode:r}=n;const a=Date.now();let c;const[l,u]=OO(t,r,[Yn.CHOOSE_SERVER]);let h=yn.networkState;return Ur(async()=>{h&&yn.networkState===wi.OFFLINE&&yn.onlineWaiter&&await K.race([yn.onlineWaiter,ri(i&&i.maxRetryTimeout||In.maxRetryTimeout)]),h=yn.networkState;const{data:f,headers:g}=await na(s,{data:l,cancelToken:e,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=g.http3==="1"?1:-1,wt.reportResourceTiming(s,t.sid),AO(f,s,t,a,[Yn.CHOOSE_SERVER],c);const S=mS(f,Yn.CHOOSE_SERVER);return wO(S),_O(S,s)},f=>(f&&wt.joinChooseServer(t.sid,{lts:a,succ:!0,csAddr:s,opid:u,serverList:f.gatewayAddrs.map(g=>g.address),ec:null,cid:f.cid.toString(),uid:f.uid.toString(),csIp:f.csIp,unilbsServerIds:[Yn.CHOOSE_SERVER].toString(),isHttp3:c}),!1),f=>f.code!==O.OPERATION_ABORTED&&(f.code===O.CAN_NOT_GET_GATEWAY_SERVER?f.data.retry:(wt.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:s,serverList:null,opid:u,ec:f.code,csIp:f.data&&f.data.csIp,unilbsServerIds:[Yn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:c}),v.warning("[".concat(t.clientId,"] Choose server network error, retry"),f),!0)),i)}function bO(n,t,e,i){let s,{url:r,areaCode:a,serviceIds:c}=n;const l=Date.now(),[u,h]=OO(t,a,c);let f;return Ur(async()=>{f&&yn.networkState===wi.OFFLINE&&yn.onlineWaiter&&await K.race([yn.onlineWaiter,ri(i&&i.maxRetryTimeout||In.maxRetryTimeout)]),f=yn.networkState;const{data:g,headers:S}=await na(r,{data:u,cancelToken:e,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=S.http3==="1"?1:-1,wt.reportResourceTiming(r,t.sid),AO(g,r,t,l,c,s);const w=mS(g,Yn.CHOOSE_SERVER),I=mS(g,t.cloudProxyServer==="proxy5"?Yn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Yn.CLOUD_PROXY:Yn.CLOUD_PROXY_FALLBACK);return wO(w),{gatewayInfo:_O(w,r),proxyInfo:I,url:r}},g=>(g.gatewayInfo&&wt.joinChooseServer(t.sid,{lts:l,succ:!0,csAddr:r,serverList:g.gatewayInfo.gatewayAddrs.map(S=>S.address),ec:null,opid:h,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:s}),g.proxyInfo&&wt.joinWebProxyAP(t.sid,{lts:l,sucess:1,apServerAddr:r,turnServerAddrList:g.proxyInfo.addresses.map(S=>S.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1),g=>g.code!==O.OPERATION_ABORTED&&(g.code===O.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(wt.joinWebProxyAP(t.sid,{lts:l,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:g.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:f})}),v.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),g),!0)),i)}const AO=(n,t,e,i,s,r)=>{const a=[],c=l=>{l.flag===4096?wt.joinChooseServer(e.sid,{lts:i,succ:!1,csAddr:t,opid:n.opid,serverList:null,ec:l.error.message,csIp:l.error.data&&l.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:r}):l.flag!==1048576&&l.flag!==4194304&&l.flag!==4194310||wt.joinWebProxyAP(e.sid,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:l.error.code,eventType:e.cloudProxyServer,unilbsServerIds:s.toString()})};if(n.response_body.forEach(l=>{const u=l.buffer.code;if(l.uri===23&&u===0&&!l.buffer.edges_services)if(l.buffer.flag===4194310)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),l.buffer.edges_services=[];else{const h={error:new j(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:n.detail[502]}),flag:l.buffer.flag};a.push(h),c(h)}if(u!==0){const h=bf(u),f={error:new j(O.CAN_NOT_GET_GATEWAY_SERVER,h.desc,{desc:h.desc,retry:h.retry,csIp:n.detail[502]}),flag:l.buffer.flag};l.buffer.flag===4194310?v.warning(f.error.toString()):a.push(f),c(f)}}),a.length)throw v.warning("[".concat(e.clientId,"] multi unilbs ").concat(t," failed, ").concat(a.map(l=>"flag: ".concat(l.flag,", message: ").concat(l.error.message,", retry: ").concat(l.error.data.retry)).join(" | "))),new j(O.CAN_NOT_GET_GATEWAY_SERVER,a.map(l=>"flag: ".concat(l.flag,", message: ").concat(l.error.message)).join(" | "),{retry:!!a.find(l=>l.error.data.retry),csIp:n.detail[502],desc:[...new Set(a.map(l=>{var u;return l==null||(u=l.error)===null||u===void 0||(u=u.data)===null||u===void 0?void 0:u.desc}).filter(l=>!!l))]})},wO=n=>{var t,e,i,s;if(n.addresses&&n.addresses.length===0&&n.code===0)throw new j(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:n.detail&&n.detail[502]});if(U("AP_AREA")&&((i=n.detail)!==null&&i!==void 0&&i[23]&&typeof((s=n.detail)===null||s===void 0?void 0:s[23])=="string"?yO(n.detail[23].toLowerCase()):yO()),(t=n.detail)!==null&&t!==void 0&&t[19]&&typeof((e=n.detail)===null||e===void 0?void 0:e[19])=="string"){const a=n.detail[19],c=a==null?void 0:a.split(";");for(let l=0;l<c.length;l++){var r;const u=NT(r=c[l]).call(r);n.addresses[l]&&c&&(n.addresses[l].fingerprint=u)}}if(U("GATEWAY_ADDRESS")&&U("GATEWAY_ADDRESS").length>0){v.debug("assign gateway address to",U("GATEWAY_ADDRESS"));const a=U("GATEWAY_ADDRESS").map(c=>{var l,u;const h=(l=(u=n.addresses.find(f=>f.ip===c.ip&&f.port===c.port))===null||u===void 0?void 0:u.fingerprint)!==null&&l!==void 0?l:"";return{ip:c.ip,port:c.port,ticket:n.addresses[0]&&n.addresses[0].ticket,fingerprint:h}});n.addresses=a}},z3=(n,t)=>{if(n.response_body&&n.response_body.length){const e=n.response_body[0];if(e.buffer.code!==0){const i=bf(e.buffer.code);throw new j(O.UPDATE_TICKET_FAILED,"[".concat(e.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return e.buffer.ticket}throw v.debug("update ticket request received ap response without response body:",t),new j(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},OO=(n,t,e)=>{const i=Math.floor(Math.random()*1e12),s={appid:n.appId,client_ts:Date.now(),opid:i,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:CS({6:n.stringUid,11:t,12:U("USE_NEW_TOKEN")?"1":void 0,22:t},U("AP_RTM")?{26:"RTM2"}:{}),key:n.token,service_ids:e,uid:n.uid||0}}]};s.request_bodies.forEach(a=>{n.multiIP&&n.multiIP.gateway_ip&&(a.buffer.detail[5]=JSON.stringify({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]}))});const r=new FormData;return r.append("request",JSON.stringify(s)),[r,i]},J3=(n,t)=>{const e=Math.floor(Math.random()*1e12),i={appid:n.appId,client_ts:Date.now(),opid:e,sid:n.sid,request_bodies:[{uri:28,buffer:{cname:n.cname,detail:{1:"",6:n.stringUid,12:"1"},token:n.token,service_ids:t,uid:n.uid||0,edges_services:n.apResponse.addresses.map(r=>({ip:r.ip,port:r.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(i)),[s,e]};let al=0;function cl(n){return K.all(n.map(t=>t.then(e=>{throw e},e=>e))).then(t=>{throw t},t=>t)}const sh=async n=>{let{fragementLength:t,referenceList:e,asyncMapHandler:i,allFailedhandler:s,promisesCollector:r}=n,a=0;const c=t;let l,u=0;const h=async()=>{const f=(()=>{const g=a*c,S=g+c;return e.slice(g,S).map(i)})();r&&r.push(...f);try{l=await cl(f)}catch(g){if(u+=c,a++,!(u>=e.length))return void await h();s(g)}f.forEach(g=>g.cancel())};return await h(),l};async function IS(n,t,e,i){return{gatewayInfo:await async function(r,a,c,l){let u=null;const h=[],f=async()=>{const S=U("WEBCS_DOMAIN").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(b=>({url:r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(b+"/api/v2/transpond/webrtc?v=2"):"https://".concat(b,"/api/v2/transpond/webrtc?v=2"),areaCode:e_()})),w=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(b=>b.url)}),I=await sh({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:b=>(v.debug("[".concat(r.clientId,"] Connect to choose_server:"),b.url),IO(b,r,a,c)),allFailedhandler:b=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},w),b[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},w),I},g=async()=>{if(await ri(1e3),u!==null)return u;const S=U("WEBCS_DOMAIN_BACKUP_LIST").map(b=>({url:r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(b+"/api/v2/transpond/webrtc?v=2"):"https://".concat(b,"/api/v2/transpond/webrtc?v=2"),areaCode:e_()})),w=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(b=>b.url)}),I=await sh({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:b=>(v.debug("[".concat(r.clientId,"] Connect to backup choose_server:"),b.url),IO(b,r,a,c)),allFailedhandler:b=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},w),b[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},w),I};try{return u=await cl([f(),g()]),h.length&&h.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),u}catch(S){throw S[0]}}(n,t,e,i)}}async function NO(n,t,e,i,s){const r=n.cloudProxyServer;if(r==="disabled"){if(!i)return;if(n.useLocalAccessPoint)return await IS(n,t,e,s);if(U("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:u,proxyInfo:h}=await PO(n,t,e,s);return n.turnServer&&n.turnServer.mode!=="auto"||(n.turnServer={mode:"manual",servers:h.map(f=>({turnServerURL:f.address,tcpport:f.tcpport||ws.tcpport,udpport:f.udpport||ws.udpport,username:f.username||ws.username,password:f.password||ws.password,forceturn:!1,security:!0}))}),{gatewayInfo:u}}return await IS(n,t,e,s)}const{proxyInfo:a,gatewayInfo:c}=await PO(n,t,e,s),l={gatewayInfo:c};return n.turnServer={mode:"manual",servers:a.map(u=>({turnServerURL:u.address,tcpport:r==="proxy3"?void 0:u.tcpport?u.tcpport:ws.tcpport,udpport:r==="proxy4"?void 0:u.udpport?u.udpport:ws.udpport,username:u.username||ws.username,password:u.password||ws.password,forceturn:r!=="proxy4",security:r==="proxy5"}))},v.debug("[".concat(n.clientId,"] set proxy server: ").concat(n.proxyServer,", mode: ").concat(r)),l}async function DO(n,t,e,i,s){const r=U("ACCOUNT_REGISTER").slice(0,U("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?r.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):r.map(l=>"https://".concat(l,"/api/v1"));const c=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const l=await async function(u,h,f,g,S){const w=Date.now(),I={sid:f.sid,opid:10,appid:f.appId,string_uid:h};let b=u[0];const M=await Ur(()=>na(b+"".concat(b.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(F,V)=>{if(F.code===0){if(F.uid<=0||F.uid>=Math.pow(2,32))throw v.error("Invalid Uint Uid ".concat(h," => ").concat(F.uid),F),wt.reqUserAccount(I.sid,{lts:w,success:!1,serverAddr:b,stringUid:I.string_uid,uid:F.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new j(O.INVALID_UINT_UID_FROM_STRING_UID);return wt.reqUserAccount(I.sid,{lts:w,success:!0,serverAddr:b,stringUid:I.string_uid,uid:F.uid,errorCode:null,extend:I}),!1}const Z=bf(F.code);return Z.retry&&(b=u[(V+1)%u.length]),wt.reqUserAccount(I.sid,{lts:w,success:!1,serverAddr:b,stringUid:I.string_uid,uid:F.uid,errorCode:Z.desc,extend:I}),Z.retry},(F,V)=>F.code!==O.OPERATION_ABORTED&&(wt.reqUserAccount(I.sid,{lts:w,success:!1,serverAddr:b,stringUid:I.string_uid,uid:null,errorCode:F.code,extend:I}),b=u[(V+1)%u.length],!0),S);if(M.code!==0){const F=bf(M.code);throw new j(O.UNEXPECTED_RESPONSE,F.desc)}return M}(a,n,t,e,i);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},c),l.uid}catch(l){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[l]},c),l}}async function X3(n,t,e){const i=U("CDS_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(c=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(c+"/api/v1"):"https://".concat(c,"/api/v1?action=config")).map(c=>function(l,u,h,f){const g=we(),S={flag:64,cipher_method:0,features:{device:g.name,system:g.os,system_general:navigator.userAgent,vendor:u.appId,version:zs,cname:u.cname,sid:u.sid,session_id:u.sid,detail:"",proxyServer:u.proxyServer}};return Ur(()=>na(l,{data:S,timeout:1e3,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,w=>w.code!==O.OPERATION_ABORTED,f)}(c,n,t,e));let s=null,r=null,a={};try{s=await cl(i)}catch(c){if(c.code===O.OPERATION_ABORTED)throw c;r=c}if(i.forEach(c=>c.cancel()),wt.reportApiInvoke(n.sid,{name:wn.REQUEST_CONFIG_DISTRIBUTE,options:{error:r,res:s}}).onSuccess(),s&&s.test_tags)try{a=function(c){if(!c.test_tags)return{};const l=c.test_tags,u=Object.keys(l),h={};return u.forEach(f=>{var g;const S=NT(g=f.slice(4)).call(g),w=JSON.parse(l[f])[1];h[S]=w}),h}(s)}catch{}return a}async function PO(n,t,e,i){const s=U("PROXY_SERVER_TYPE3"),r=(S,w,I)=>{let b=I||s;return Array.isArray(b)&&(b=w%2==0?s[1]:s[0]),"https://".concat(b,"/ap/?url=").concat(S)};let a=null;const c=[],l=async()=>{const S=U("WEBCS_DOMAIN").slice(0,U("AJAX_REQUEST_CONCURRENT")).map((b,M)=>{let F;return F=n.cloudProxyServer==="disabled"&&n.proxyServer?r("".concat(b,"/api/v2/transpond/webrtc?v=2"),M,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(b,"/api/v2/transpond/webrtc?v=2"):r("".concat(b,"/api/v2/transpond/webrtc?v=2"),M),{url:F,areaCode:e_(),serviceIds:[Yn.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Yn.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Yn.CLOUD_PROXY:Yn.CLOUD_PROXY_FALLBACK]}}),w=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(b=>b.url)}),I=await sh({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:b=>(v.debug("[".concat(n.clientId,"] Connect to choose_server:"),b.url),bO(b,n,t,e)),allFailedhandler:b=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},w),b[0]},promisesCollector:c});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},w),I},u=async()=>{if(await ri(1e3),a!==null)return a;const S=U("WEBCS_DOMAIN_BACKUP_LIST").map((b,M)=>{let F;return F=n.cloudProxyServer==="disabled"&&n.proxyServer?r("".concat(b,"/api/v2/transpond/webrtc?v=2"),M,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(b,"/api/v2/transpond/webrtc?v=2"):r("".concat(b,"/api/v2/transpond/webrtc?v=2"),M),{url:F,areaCode:e_(),serviceIds:[Yn.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Yn.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Yn.CLOUD_PROXY:Yn.CLOUD_PROXY_FALLBACK]}}),w=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(b=>b.url)}),I=await sh({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:b=>(v.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),b.url),bO(b,n,t,e)),allFailedhandler:b=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},w),b[0]},promisesCollector:c});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},w),I};let h,f,g;try{({gatewayInfo:h,proxyInfo:f,url:g}=await cl([l(),u()]))}catch(S){throw S[0]}if(c.length&&c.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),!h||!f)throw new j(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(n.apUrl=g,n.cloudProxyServer!=="disabled"&&Array.isArray(s)&&g){const S=/^https?:\/\/(.+?)(\/.*)?$/.exec(g)[1];Vt(s).call(s,S)&&(n.proxyServer=S,v.setProxyServer(S),wt.setProxyServer(S))}return a={gatewayInfo:h,proxyInfo:await j3(f,h.uid)},a}async function LO(n,t,e,i){const s=U("UAP_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(r=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(r+"/api/v1?action=uap"):"https://".concat(r,"/api/v1?action=uap"));return await Y3(s,n,t,e,i)}async function $3(n,t,e){const i=U("UAP_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(s=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")).map(s=>function(r,a,c,l){const u={command:"convergeAllocateEdge",sid:a.sid,appId:a.appId,token:a.token,ts:Date.now(),version:zs,cname:a.cname,uid:a.uid.toString(),requestId:RS,seq:RS};RS+=1;const h={service_name:"tele_channel",json_body:JSON.stringify(u)};return Ur(async()=>{const f=await na(r,{data:h,cancelToken:c,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(f.code!==0){const S=new j(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+f.code,{retry:!0});throw v.error(S.toString()),S}const g=JSON.parse(f.json_body);if(g.code!==200){const S=new j(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(g.code,", reason: ").concat(g.reason));throw v.error(S.toString()),S}if(!g.servers||g.servers.length===0){const S=new j(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw v.error(S.toString()),S}return{vid:g.vid,workerToken:g.workerToken,addressList:(U("CHANNEL_MEDIA_RELAY_SERVERS")||g.servers).map(S=>"wss://".concat(S.address.replace(/\./g,"-"),".").concat(U("WORKER_DOMAIN"),":").concat(S.wss))}},void 0,f=>!!(f.code!==O.OPERATION_ABORTED&&f.code!==O.UNEXPECTED_RESPONSE||f.data&&f.data.retry),l)}(s,n,t,e));try{const s=await cl(i);return i.forEach(r=>r.cancel()),s}catch(s){throw s[0]}}async function Q3(n,t,e){let i=null;const s=[],r=async a=>{const c=U(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(l=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(l+"/api/v2/transpond/webrtc?v=2"):"https://".concat(l,"/api/v2/transpond/webrtc?v=2"));return a&&(await ri(1e3),i!==null)?i:await sh({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:l=>(v.debug("[".concat(n.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),l),function(u,h,f,g){const[S]=J3(h,[Yn.CHOOSE_SERVER]);let w=yn.networkState;return Ur(async()=>{w&&yn.networkState===wi.OFFLINE&&yn.onlineWaiter&&await K.race([yn.onlineWaiter,ri(g&&g.maxRetryTimeout||In.maxRetryTimeout)]),w=yn.networkState;const I=await na(u,{data:S,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0);return z3(I,u)},()=>!1,I=>I.code!==O.OPERATION_ABORTED&&(I.code===O.UPDATE_TICKET_FAILED?I.data.retry:(v.warning("[".concat(h.clientId,"] update ticket network error, retry"),I),!0)),g)}(l,n,t,e)),allFailedhandler:l=>{throw l[0]},promisesCollector:s})};try{return i=await cl([r(!1),r(!0)]),s.length&&s.forEach(a=>a.cancel&&typeof a.cancel=="function"&&a.cancel()),i}catch(a){throw a[0]}}function kO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function MO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?kO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):kO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Z3 extends Ze{constructor(){super(),m(this,"configs",void 0),m(this,"joinInfo",void 0),m(this,"cancelToken",void 0),m(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),m(this,"interval",void 0),m(this,"mutex",new qn("config-distribute")),m(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,e){this.joinInfo=t,this.cancelToken=e,this.interval&&this.stopGetConfigDistribute(),U("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},U("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,wt.reportApiInvoke(null,{options:void 0,name:wn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:sn.TRACER}).onSuccess(JSON.stringify(wa))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void v.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const e=await this.mutex.lock();try{t=await X3(this.joinInfo,this.cancelToken,this.retryConfig),v.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(i){const s=new j(O.NETWORK_RESPONSE_ERROR,i);v.warning("[config-distribute] ".concat(s.toString()))}finally{e()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var e;(e=t)&&e.uplink&&e.id&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(Uu.UPDATE_BITRATE_LIMIT,t):this.emit(Uu.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&MO({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var e;const i=Su(e=Object.keys(t).filter(r=>/^webrtc_ng_global_parameter/.test(r))).call(e);for(let r=0;r<i.length;r++)for(let a=i.length-1;a>r;a--){const c=i[a];if(typeof t[c].__priority=="number"){const l=t[c].__priority,u=i[a-1];if(typeof t[u].__priority=="number"){if(!(l>t[u].__priority))continue;{const h=c;i[a]=i[a-1],i[a-1]=h}}else{const h=c;i[a]=i[a-1],i[a-1]=h}}}const s={};i.forEach(r=>{const a=t[r],c=a.__expires;Object.keys(a).forEach(l=>{l==="__priority"||l==="__expires"||Object.prototype.hasOwnProperty.call(s,l)||(s[l]=MO({value:a[l]},c&&{expires:c}))})});try{(function(c){try{const l=Date.now();Object.keys(c).forEach(u=>{switch(u){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(Mi,u)){const{value:h,expires:f}=c[u];if(f&&f<=l)return;wa[u]=h,Mi[u]=h,v.debug("Update global parameters from config distribute",u,h)}}})}catch(l){v.error("Error update config immediately: ".concat(c),l.message)}})(s);const r=JSON.stringify(s),a=window.btoa(r);window.localStorage.setItem("websdk_ng_global_parameter",a),v.debug("Caching global parameters ".concat(r))}catch(r){v.error("Error caching global parameters:",r.message)}}}function UO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function rh(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?UO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):UO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class t4 extends Ze{constructor(t,e,i,s){super(),m(this,"spec",void 0),m(this,"token",void 0),m(this,"websocket",void 0),m(this,"pingpongTimer",void 0),m(this,"reconnectMode","retry"),m(this,"serviceMode",void 0),m(this,"reqId",0),m(this,"commandReqId",0),m(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),m(this,"handleWebSocketMessage",r=>{if(!r.data)return;const a=JSON.parse(r.data);a.requestId?this.emit("@".concat(a.requestId,"-").concat(a.sid),a):this.serviceMode===Mn.INJECT?this.emit(Er.INJECT_STREAM_STATUS,a):(wt.workerEvent(this.spec.sid,{actionType:"status",serverCode:a.code,workerType:this.serviceMode===Mn.TRANSCODE?1:2}),this.emit(Er.PUBLISH_STREAM_STATUS,a))}),this.spec=e,this.token=t,this.serviceMode=s,this.websocket=new Vu("live-streaming",i),this.websocket.on(Ht.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ht.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ht.REQUEST_NEW_URLS,(r,a)=>{rn(this,Er.REQUEST_NEW_ADDRESS).then(r).catch(a)}),this.websocket.on(Ht.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,e,i,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const r=this.commandReqId,a=this.reqId;if(!a||!this.websocket)throw new j(O.UNEXPECTED_ERROR);const c=rh({command:t,sdkVersion:zs==="4.19.1"?"0.0.1":zs,seq:a,requestId:a,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},e);if(this.websocket.state==="closed")throw new j(O.WS_DISCONNECT);const l=()=>new K((g,S)=>{this.websocket.once(Ht.CLOSED,()=>S(new j(O.WS_ABORT))),this.websocket.once(Ht.CONNECTED,g)});this.websocket.state!=="connected"&&await l(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const u=new K((g,S)=>{const w=()=>{S(new j(O.WS_ABORT))};this.websocket.once(Ht.RECONNECTING,w),this.websocket.once(Ht.CLOSED,w),this.once("@".concat(a,"-").concat(this.spec.sid),I=>{g(I)})});s&&wt.workerEvent(this.spec.sid,rh(rh({},s),{},{requestId:r,actionType:"request",payload:JSON.stringify(e.clientRequest),serverCode:0,code:0}));const h=Date.now();this.websocket.sendMessage(c);let f=null;try{f=await u}catch(g){if(this.websocket.state==="closed")throw g;return await l(),await this.request(t,e,i)}return s&&wt.workerEvent(this.spec.sid,rh(rh({},s),{},{requestId:r,actionType:"response",payload:JSON.stringify(f.serverResponse),serverCode:f.code,success:f.code===200,responseTime:Date.now()-h})),f.code!==200&&this.handleResponseError(f),f}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=zs==="4.19.1"?"0.0.1":zs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case gn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void v.warning("live stream response already exists stream");case gn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case gn.LIVE_STREAM_RESPONSE_BAD_STREAM:case gn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new j(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case gn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case gn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new j(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case gn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new j(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Er.WARNING,e,t.serverResponse.url)}case gn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const e=new j(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Er.WARNING,e,t.serverResponse.url)}case gn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case gn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new j(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case gn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const e=new j(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Er.WARNING,e,t.serverResponse.url)}case gn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case gn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case gn.LIVE_STREAM_RESPONSE_WORKER_LOST:case gn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case gn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case gn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new j(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(df)},6e3)}}function xO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Yi(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?xO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):xO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class e4 extends Ze{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:In,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:In;super(),m(this,"onLiveStreamWarning",void 0),m(this,"onLiveStreamError",void 0),m(this,"onInjectStatusChange",void 0),m(this,"spec",void 0),m(this,"retryTimeout",1e4),m(this,"connection",void 0),m(this,"httpRetryConfig",void 0),m(this,"wsRetryConfig",void 0),m(this,"streamingTasks",new Map),m(this,"isStartingStreamingTask",!1),m(this,"taskMutex",new qn("live-streaming")),m(this,"cancelToken",Zi.CancelToken.source()),m(this,"transcodingConfig",void 0),m(this,"injectConfig",Yi({},tj)),m(this,"injectLoopTimes",0),m(this,"uapResponse",void 0),m(this,"lastTaskId",1),m(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=e}async setTranscodingConfig(t){const e=Yi(Yi({},ZB),t);e.videoCodecProfile!==66&&e.videoCodecProfile!==77&&e.videoCodecProfile!==100&&(v.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(e.videoCodecProfile," -> 100")),e.videoCodecProfile=100),e.transcodingUsers||(e.transcodingUsers=e.userConfigs),e.transcodingUsers&&(e.transcodingUsers=e.transcodingUsers.map(a=>Yi(Yi(Yi({},QB),a),{},{zOrder:a.zOrder?a.zOrder+1:1}))),function(a){nn(a.width)||Fe(a.width,"config.width",0,1e4),nn(a.height)||Fe(a.height,"config.height",0,1e4),nn(a.videoBitrate)||Fe(a.videoBitrate,"config.videoBitrate",1,1e6),nn(a.videoFrameRate)||Fe(a.videoFrameRate,"config.videoFrameRate"),nn(a.lowLatency)||Ac(a.lowLatency,"config.lowLatency"),nn(a.audioSampleRate)||Vn(a.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),nn(a.audioBitrate)||Fe(a.audioBitrate,"config.audioBitrate",1,128),nn(a.audioChannels)||Vn(a.audioChannels,"config.audioChannels",[1,2,3,4,5]),nn(a.videoGop)||Fe(a.videoGop,"config.videoGop"),nn(a.videoCodecProfile)||Vn(a.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),nn(a.userCount)||Fe(a.userCount,"config.userCount",0,17),nn(a.backgroundColor)||Fe(a.backgroundColor,"config.backgroundColor",0,16777215),nn(a.userConfigExtraInfo)||ai(a.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),a.transcodingUsers&&!nn(a.transcodingUsers)&&(qo(a.transcodingUsers,"config.transcodingUsers"),a.transcodingUsers.forEach((c,l)=>{yT(c.uid),nn(c.x)||Fe(c.x,"transcodingUser[".concat(l,"].x"),0,1e4),nn(c.y)||Fe(c.y,"transcodingUser[".concat(l,"].y"),0,1e4),nn(c.width)||Fe(c.width,"transcodingUser[".concat(l,"].width"),0,1e4),nn(c.height)||Fe(c.height,"transcodingUser[".concat(l,"].height"),0,1e4),nn(c.zOrder)||Fe(c.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),nn(c.alpha)||Fe(c.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)})),nn(a.watermark)||IT(a.watermark,"watermark"),nn(a.backgroundImage)||IT(a.backgroundImage,"backgroundImage"),a.images&&!nn(a.images)&&(qo(a.images,"config.images"),a.images.forEach((c,l)=>{IT(c,"images[".concat(l,"]"))}))}(e);const i=[];e.images&&i.push(...e.images.map(a=>Yi(Yi(Yi({},RT),a),{},{zOrder:255}))),e.backgroundImage&&(i.push(Yi(Yi(Yi({},RT),e.backgroundImage),{},{zOrder:0})),delete e.backgroundImage),e.watermark&&(i.push(Yi(Yi(Yi({},RT),e.watermark),{},{zOrder:255})),delete e.watermark),e.images=i,e.transcodingUsers&&(e.userConfigs=e.transcodingUsers.map(a=>Yi({},a)),e.userCount=e.transcodingUsers.length,delete e.transcodingUsers);const s=(e.userConfigs||[]).map(a=>typeof a.uid=="number"?K.resolve(a.uid):DO(a.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await K.all(s)).forEach((a,c)=>{e.userConfigs&&e.userConfigs[c]&&(e.userConfigs[c].uid=a)}),this.transcodingConfig=e,this.connection)try{var r;const a=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(po(r=this.streamingTasks).call(r)).map(c=>c.taskId).join("#")});v.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(a.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(a){if(!a.data||!a.data.retry)throw a;a.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(c=>{v.warning("[".concat(this.spec.clientId,"] live streaming receive error"),a.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,a).then(()=>{v.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(l=>{v.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)})})}}setInjectStreamConfig(t,e){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=e}async startLiveStreamingTask(t,e,i){var s;if(Array.from(po(s=this.streamingTasks).call(s)).find(l=>l.mode===Mn.INJECT)&&e===Mn.INJECT)return new j(O.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&e===Mn.TRANSCODE)throw new j(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let r={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};v.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(e));const a=await this.taskMutex.lock();if(!this.connection&&i)return void a();if(this.streamingTasks.get(t)&&!i)return a(),new j(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(e))}catch(l){throw a(),l}switch(e){case Mn.TRANSCODE:r.transcodingConfig=Yi({},this.transcodingConfig);break;case Mn.RAW:break;case Mn.INJECT:r={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new K((h,f)=>{ri(this.retryTimeout).then(()=>{if(i)return f(i);const g=this.statusError.get(t);return g?(this.statusError.delete(t),f(g)):void 0})}),u=await K.race([this.connection.request("request",{clientRequest:r},!0,{url:t,command:"PublishStream",workerType:e===Mn.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,v.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(u.code)),this.streamingTasks.set(t,{clientRequest:r,mode:e,url:t,taskId:c}),a()}catch(l){if(a(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,e,l)):await this.startLiveStreamingTask(t,e,l)}}stopLiveStreamingTask(t){return new K((e,i)=>{const s=this.streamingTasks.get(t);if(!s||!this.connection)return new j(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const r=s.mode;s.abortTask=()=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),e()},this.connection.request("request",{clientRequest:{command:r===Mn.INJECT?"UninjectStream":"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:r===Mn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(a=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(a.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&r!==Mn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),e(),r===Mn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Na.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(i)})}async controlInjectStream(t,e,i,s){const r=this.streamingTasks.get(t);if(!r||!this.connection||r.mode!==Mn.INJECT)throw new j(O.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:e,audioVolume:i,position:s}})).serverResponse}resetAllTask(){var t;const e=Array.from(po(t=this.streamingTasks).call(t));this.terminate();for(const i of e)this.startLiveStreamingTask(i.url,i.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Zi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new j(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const e=await rn(this,Yd.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=e,this.connection=new t4(e.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Er.WARNING,(i,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,i)),this.connection.on(Er.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Er.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(Er.REQUEST_NEW_ADDRESS,(i,s)=>{if(!this.connection)return s(new j(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));rn(this,Yd.REQUEST_WORKER_MANAGER_LIST,t).then(r=>{this.uapResponse=r,i(r.addressList)}).catch(s)}),await this.connection.init(e.addressList),this.connection}handlePublishStreamServer(t){const e=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(e),s=t.reason;switch(t.code){case gn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const a=new j(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return v.error(a.toString()),this.onLiveStreamError&&this.onLiveStreamError(e,a);if(!this.isStartingStreamingTask)return;this.statusError.set(e,a)}case gn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const a=new j(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(e,a)}case gn.LIVE_STREAM_RESPONSE_WORKER_LOST:case gn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var r;if(!this.connection)return;this.connection.tryNextAddress();const a=Array.from(po(r=this.streamingTasks).call(r));for(const c of a)c.abortTask?c.abortTask():(v.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new j(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{v.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)}).catch(l=>{v.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)}));return}}}handleInjectStreamServerStatus(t){const e=Number(t.uid),i=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Na.INJECT_STREAM_STATUS_START_SUCCESS,e,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Na.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,e,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Na.INJECT_STREAM_STATUS_START_UNAUTHORIZED,e,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Na.INJECT_STREAM_STATUS_BROKEN,e,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Na.INJECT_STREAM_STATUS_START_TIMEOUT,e,i),void this.streamingTasks.delete(i);default:return void v.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class s_{constructor(){m(this,"destChannelMediaInfos",new Map),m(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){AA(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){AA(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){CT(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function VO(n){if(!(n instanceof s_))return new j(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=n.getSrcChannelMediaInfo(),e=n.getDestChannelMediaInfo();if(!t)return new j(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(e.size===0)return new j(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class n4 extends Ze{constructor(t,e,i){super(),m(this,"ws",void 0),m(this,"requestId",1),m(this,"heartBeatTimer",void 0),m(this,"joinInfo",void 0),m(this,"clientId",void 0),m(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),m(this,"onClose",s=>{this.emit("close"),this.dispose()}),m(this,"onMessage",s=>{const r=JSON.parse(s.data);if(!r||r.command!=="serverResponse"||!r.requestId)return r&&r.command==="serverStatus"&&r.serverStatus&&r.serverStatus.command?(this.emit("status",r.serverStatus),void this.emit(r.serverStatus.command,r.serverStatus)):void 0;this.emit("req_".concat(r.requestId),r)}),this.joinInfo=t,this.clientId=e,this.ws=new Vu("cross-channel-".concat(this.clientId),i),this.ws.on(Ht.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ht.CONNECTED,this.onOpen),this.ws.on(Ht.ON_MESSAGE,this.onMessage),this.ws.on(Ht.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const e=this.requestId++;return t.requestId=e,t.seq=e,this.ws.sendMessage(t),e}waitStatus(t){return new K((e,i)=>{const s=window.setTimeout(()=>{i(new j(O.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,r=>{window.clearTimeout(s),r.state&&r.state!==0?i(new j(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):e(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),i(new j(O.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new j(O.WS_DISCONNECT);const e=()=>new K((a,c)=>{this.ws.once(Ht.CLOSED,()=>c(new j(O.WS_ABORT))),this.ws.once(Ht.CONNECTED,a)});this.ws.state!=="connected"&&await e();const i=this.sendMessage(t),s=new K((a,c)=>{const l=()=>{c(new j(O.WS_ABORT))};this.ws.once(Ht.RECONNECTING,l),this.ws.once(Ht.CLOSED,l),this.once("req_".concat(i),a),ri(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Ht.RECONNECTING,l),this.ws.off(Ht.CLOSED,l),c(new j(O.TIMEOUT,"cross channel ws request timeout"))})}),r=await s;if(!r||r.code!==200)throw new j(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(r)));return r}async connect(t){this.ws.removeAllListeners(Ht.REQUEST_NEW_URLS),this.ws.on(Ht.REQUEST_NEW_URLS,e=>{e(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const e=this.requestId++;return t.requestId=e,this.ws.sendMessage(t),e}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class i4 extends Ze{set state(t){t!==this._state&&(t!==Ui.RELAY_STATE_FAILURE&&(this.errorCode=Da.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,e,i,s,r){super(),m(this,"joinInfo",void 0),m(this,"sid",void 0),m(this,"clientId",void 0),m(this,"cancelToken",Zi.CancelToken.source()),m(this,"workerToken",void 0),m(this,"requestId",0),m(this,"signal",void 0),m(this,"prevChannelMediaConfig",void 0),m(this,"httpRetryConfig",void 0),m(this,"_resolution",void 0),m(this,"_state",Ui.RELAY_STATE_IDLE),m(this,"errorCode",Da.RELAY_OK),m(this,"onStatus",a=>{v.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(a))),a&&a.command&&(a.command==="onAudioPacketReceived"&&this.emit("event",xr.PACKET_RECEIVED_AUDIO_FROM_SRC),a.command==="onVideoPacketReceived"&&this.emit("event",xr.PACKET_RECEIVED_VIDEO_FROM_SRC),a.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Da.SRC_TOKEN_EXPIRED,this.state=Ui.RELAY_STATE_FAILURE),a.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Da.DEST_TOKEN_EXPIRED,this.state=Ui.RELAY_STATE_FAILURE))}),m(this,"onReconnect",async()=>{v.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",xr.NETWORK_DISCONNECTED),this.state=Ui.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(a=>{this.state!==Ui.RELAY_STATE_IDLE&&(v.error("auto restart channel media relay failed",a.toString()),this.errorCode=Da.SERVER_CONNECTION_LOST,this.state=Ui.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=e,this.sid=Jg(),this.signal=new n4(this.joinInfo,this.clientId,i),this.httpRetryConfig=s,this._resolution=r}async startChannelMediaRelay(t){if(this.state!==Ui.RELAY_STATE_IDLE)throw new j(O.INVALID_OPERATION);this.state=Ui.RELAY_STATE_CONNECTING,await this.connect(),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(e){throw e.data&&e.data.serverResponse&&e.data.serverResponse.command==="SetSourceChannel"?new j(O.CROSS_CHANNEL_FAILED_JOIN_SRC):e.data&&e.data.serverResponse&&e.serverResponse.command==="SetDestChannelStatus"?new j(O.CROSS_CHANNEL_FAILED_JOIN_DEST):e.data&&e.data.serverResponse&&e.serverResponse.command==="StartPacketTransfer"?new j(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):e}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ui.RELAY_STATE_RUNNING)throw new j(O.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ui.RELAY_STATE_RUNNING)throw new j(O.INVALID_OPERATION);const e=this.genMessage(Ti.SetVideoProfile);await this.signal.request(e),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),v.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ui.RELAY_STATE_IDLE,this.dispose()}dispose(){v.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Zi.CancelToken.source(),this.state=Ui.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await $3(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",xr.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const e=this.genMessage(Ti.StopPacketTransfer);await this.signal.request(e),await this.signal.waitStatus("Normal Quit"),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Ti.SetSdkProfile,t);await this.signal.request(i),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Ti.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",xr.PACKET_JOINED_SRC_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const r=this.genMessage(Ti.SetSourceUserId,t);await this.signal.request(r),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const a=this.genMessage(Ti.SetDestChannel,t);await this.signal.request(a),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",xr.PACKET_JOINED_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(Ti.StartPacketTransfer,t);await this.signal.request(c),this.emit("event",xr.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ui.RELAY_STATE_RUNNING,v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const e=this.genMessage(Ti.UpdateDestChannel,t);await this.signal.request(e),this.emit("event",xr.PACKET_UPDATE_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Ti.StopPacketTransfer);await this.signal.request(t),v.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,e){const i=[],s=[],r=[];this.requestId+=1;const a={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:zs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};a.sdkVersion==="4.19.1"&&(a.sdkVersion="0.0.1");let c=null,l=null;switch(t){case Ti.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case Ti.SetSourceChannel:if(l=e&&e.getSrcChannelMediaInfo(),!l)throw new j(O.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceChannel",uid:"0",channelName:l.channelName,token:l.token||this.joinInfo.appId},a;case Ti.SetSourceUserId:if(l=e&&e.getSrcChannelMediaInfo(),!l)throw new j(O.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceUserId",uid:l.uid+""},a;case Ti.SetDestChannel:if(c=e&&e.getDestChannelMediaInfo(),!c)throw new j(O.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{i.push(u.channelName),s.push(u.uid+""),r.push(u.token||this.joinInfo.appId)}),a.clientRequest={command:"SetDestChannel",channelName:i,uid:s,token:r},a;case Ti.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case Ti.Reconnect:return a.clientRequest={command:"Reconnect"},a;case Ti.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case Ti.UpdateDestChannel:if(c=e&&e.getDestChannelMediaInfo(),!c)throw new j(O.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{i.push(u.channelName),s.push(u.uid+""),r.push(u.token||this.joinInfo.appId)}),a.clientRequest={command:"UpdateDestChannel",channelName:i,uid:s,token:r},a;case Ti.SetVideoProfile:a.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return a}}class ui{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,e){m(this,"uid",void 0),m(this,"_uintid",void 0),m(this,"_trust_in_room_",!0),m(this,"_trust_audio_enabled_state_",!0),m(this,"_trust_video_enabled_state_",!0),m(this,"_trust_audio_mute_state_",!0),m(this,"_trust_video_mute_state_",!0),m(this,"_audio_muted_",!1),m(this,"_video_muted_",!1),m(this,"_audio_enabled_",!0),m(this,"_video_enabled_",!0),m(this,"_audio_added_",!1),m(this,"_video_added_",!1),m(this,"_trust_video_stream_added_state_",!0),m(this,"_trust_audio_stream_added_state_",!0),m(this,"_audioTrack",void 0),m(this,"_videoTrack",void 0),m(this,"_dataChannels",[]),m(this,"_audioSSRC",void 0),m(this,"_videoSSRC",void 0),m(this,"_audioOrtc",void 0),m(this,"_videoOrtc",void 0),m(this,"_cname",void 0),m(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=e}}var s4=JI,r4=co;C({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var n=r4.f(this);return{promise:n.promise,resolve:n.resolve,reject:n.reject}}});var o4=co,a4=Ld;C({target:"Promise",stat:!0,forced:!0},{try:function(n){var t=o4.f(this),e=a4(n);return(e.error?t.reject:t.resolve)(e.value),t.promise}});var bS=st(s4),FO=yd.f("asyncIterator"),c4=st(FO);function AS(n,t){this.v=n,this.k=t}function oh(n){var t,e;function i(r,a){try{var c=n[r](a),l=c.value,u=l instanceof AS;bS.resolve(u?l.v:l).then(function(h){if(u){var f=r==="return"?"return":"next";if(!l.k||h.done)return i(f,h);h=n[f](h).value}s(c.done?"return":"normal",h)},function(h){i("throw",h)})}catch(h){s("throw",h)}}function s(r,a){switch(r){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?i(t.key,t.arg):e=null}this._invoke=function(r,a){return new bS(function(c,l){var u={key:r,arg:a,resolve:c,reject:l,next:null};e?e=e.next=u:(t=e=u,i(r,a))})},typeof n.return!="function"&&(this.return=void 0)}function tr(n){return function(){return new oh(n.apply(this,arguments))}}function Re(n){return new AS(n,0)}function r_(n){var t={},e=!1;function i(s,r){return e=!0,{done:!1,value:new AS(r=new bS(function(a){a(n[s](r))}),1)}}return t[Od!==void 0&&PR||"@@iterator"]=function(){return this},t.next=function(s){return e?(e=!1,s):i("next",s)},typeof n.throw=="function"&&(t.throw=function(s){if(e)throw e=!1,s;return i("throw",s)}),typeof n.return=="function"&&(t.return=function(s){return e?(e=!1,s):i("return",s)}),t}oh.prototype[typeof Od=="function"&&c4||"@@asyncIterator"]=function(){return this},oh.prototype.next=function(n){return this._invoke("next",n)},oh.prototype.throw=function(n){return this._invoke("throw",n)},oh.prototype.return=function(n){return this._invoke("return",n)};var BO=st(FO),jO={exports:{}};(function(n,t){n.exports=(()=>{var e={8:(r,a,c)=>{c.r(a),c.d(a,{Parser:()=>Xt,Printer:()=>Nn,parse:()=>Yt,print:()=>Ie});const l=`
`,u="".concat("\r").concat(l),h=" ";let f;function g(ut){return ut>="0"&&ut<="9"}function S(ut){return ut>="!"&&ut<="~"}function w(ut){return S(ut)||ut>=""&&ut<="ÿ"}function I(ut){return ut==="!"||ut>="#"&&ut<="'"||ut>="*"&&ut<="+"||ut>="-"&&ut<="."||ut>="0"&&ut<="9"||ut>="A"&&ut<="Z"||ut>="^"&&ut<="~"}function b(ut){return ut>="1"&&ut<="9"}function M(ut){return ut>="A"&&ut<="Z"||ut>="a"&&ut<="z"}function F(ut){return ut==="d"||ut==="h"||ut==="m"||ut==="s"}function V(ut){return ut>""&&ut<"	"||ut>"\v"&&ut<"\f"||ut>""&&ut<"ÿ"}function Z(ut){return M(ut)||g(ut)||ut==="+"||ut==="/"}function $(ut){return g(ut)||M(ut)||ut==="+"||ut==="/"||ut==="-"||ut==="_"}function W(ut){return M(ut)||g(ut)||ut==="+"||ut==="/"}function q(ut,y){var L=Object.keys(ut);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ut);y&&(B=B.filter(function(ot){return Object.getOwnPropertyDescriptor(ut,ot).enumerable})),L.push.apply(L,B)}return L}function et(ut){for(var y=1;y<arguments.length;y++){var L=arguments[y]!=null?arguments[y]:{};y%2?q(Object(L),!0).forEach(function(B){_t(ut,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ut,Object.getOwnPropertyDescriptors(L)):q(Object(L)).forEach(function(B){Object.defineProperty(ut,B,Object.getOwnPropertyDescriptor(L,B))})}return ut}function _t(ut,y,L){return y in ut?Object.defineProperty(ut,y,{value:L,enumerable:!0,configurable:!0,writable:!0}):ut[y]=L,ut}(function(ut){ut.VERSION="v",ut.ORIGIN="o",ut.SESSION_NAME="s",ut.INFORMATION="i",ut.URI="u",ut.EMAIL="e",ut.PHONE="p",ut.CONNECTION="c",ut.BANDWIDTH="b",ut.TIME="t",ut.REPEAT="r",ut.ZONE_ADJUSTMENTS="z",ut.KEY="k",ut.ATTRIBUTE="a",ut.MEDIA="m"})(f||(f={}));class lt{consumeText(y,L){let B=L;for(;B<y.length;){const ot=y[B];if(ot==="\0"||ot==="\r"||ot===l)break;B+=1}if(B-L==0)throw new Error("Invalid text, at ".concat(y));return B}consumeUnicastAddress(y,L,B){return this.consumeTill(y,L,h)}consumeOneOrMore(y,L,B){let ot=L;for(;B(y[ot]);)ot++;if(ot-L==0)throw new Error("Invalid rule at ".concat(L,"."));return ot}consumeSpace(y,L){if(y[L]===h)return L+1;throw new Error("Invalid space at ".concat(L,"."))}consumeIP4Address(y,L){let B=L;for(let ot=0;ot<4;ot++)if(B=this.consumeDecimalUChar(y,B),ot!==3){if(y[B]!==".")throw new Error("Invalid IP4 address.");B++}return B}consumeDecimalUChar(y,L){let B=L;for(let Qt=0;Qt<3&&g(y[B]);Qt++,B++);if(B-L==0)throw new Error("Invalid decimal uchar.");const ot=parseInt(y.slice(L,B));if(ot>=0&&ot<=255)return B;throw new Error("Invalid decimal uchar")}consumeIP6Address(y,L){let B=this.consumeHexpart(y,L);return y[B]===":"&&(B+=1,B=this.consumeIP4Address(y,B)),B}consumeHexpart(y,L){let B=L;if(y[B]===":"&&y[B+1]===":"){B+=2;try{B=this.consumeHexseq(y,B)}catch{}return B}if(B=this.consumeHexseq(y,B),y[B]===":"&&y[B+1]===":"){B+=2;try{B=this.consumeHexseq(y,B)}catch{}return B}return B}consumeHexseq(y,L){let B=L;for(;B=this.consumeHex4(y,B),y[B]===":"&&y[B+1]!==":";)B+=1;return B}consumeHex4(y,L){let B=0;for(;B<4;B++)if(!((ot=y[L+B])>="0"&&ot<="9"||ot>="a"&&ot<="f"||ot>="A"&&ot<="F")){if(B===0)throw new Error("Invalid hex 4");break}var ot;return L+B}consumeFQDN(y,L){let B=L;for(;g(y[B])||M(y[B])||y[B]==="-"||y[B]===".";)B+=1;if(B-L<4)throw new Error("Invalid FQDN");return B}consumeExtnAddr(y,L){return this.consumeOneOrMore(y,L,w)}consumeMulticastAddress(y,L,B){switch(B){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(y,L);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(y,L);default:try{return this.consumeFQDN(y,L)}catch{return this.consumeExtnAddr(y,L)}}}consumeIP6MulticastAddress(y,L){const B=this.consumeHexpart(y,L);return y[B]==="/"?this.consumeInteger(y,B+1):B}consumeIP4MulticastAddress(y,L){let B=L+3;const ot=y.slice(L,B),Qt=parseInt(ot);if(Qt<224||Qt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Je=0;Je<3;Je++){if(y[B]!==".")throw new Error("Invalid IP4 multicast address.");B+=1,B=this.consumeDecimalUChar(y,B)}return y[B]==="/"&&(B+=1),B=this.consumeTTL(y,B),y[B]==="/"&&(B=this.consumeInteger(y,B)),B}consumeInteger(y,L){if(!b(y[L]))throw new Error("Invalid integer.");for(L+=1;g(y[L]);)L+=1;return L}consumeTTL(y,L){if(y[L]==="0")return L+1;if(!b(y[L]))throw new Error("Invalid TTL.");L+=1;for(let B=0;B<2&&g(y[L]);B++)L+=1;return L}consumeToken(y,L){return this.consumeOneOrMore(y,L,I)}consumeTime(y,L){let B=L;if(y[B]==="0")return B+1;for(b(y[B])&&(B+=1);g(y[B]);)B++;if(B-L<10)throw new Error("Invalid time");return B}consumeAddress(y,L){return this.consumeTill(y,L,h)}consumeTypedTime(y,L){let B=L;return B=this.consumeOneOrMore(y,B,g),F(y[B])?B+1:B}consumeRepeatInterval(y,L){if(!b(y[L]))throw new Error("Invalid repeat interval");for(L+=1;g(y[L]);)L+=1;return F(y[L])&&(L+=1),L}consumePort(y,L){return this.consumeOneOrMore(y,L,g)}consume(y,L,B){for(let ot=0;ot<B.length;ot++){if(L+ot>=y.length)throw new Error("consume exceeding value length");if(y[L+ot]!==B[ot])throw new Error("consume ".concat(B," failed at ").concat(ot))}return L+B.length}consumeTill(y,L,B){let ot=L;for(;ot<y.length&&(typeof B!="string"||y[ot]!==B)&&(typeof B!="function"||!B(y[ot]));)ot++;return ot}}class Xt extends lt{constructor(){super(),_t(this,"records",[]),_t(this,"currentLine",0)}parse(y){const L=this.probeEOL(y);this.records=y.split(L).filter(Dn=>!!Dn.trim()).map(this.parseLine),this.currentLine=0;const B=this.parseVersion(),ot=this.parseOrigin(),Qt=this.parseSessionName(),Je=this.parseInformation(),hi=this.parseUri(),_s=this.parseEmail(),ia=this.parsePhone(),T_=this.parseConnection(),S_=this.parseBandWidth(),or=this.parseTimeFields(),Ja=this.parseKey(),fl=this.parseSessionAttribute(),fn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:B,origin:ot,sessionName:Qt,information:Je,uri:hi,emails:_s,phones:ia,connection:T_,bandwidths:S_,timeFields:or,key:Ja,attributes:fl,mediaDescriptions:fn}}getCurrentRecord(){const y=this.records[this.currentLine];if(!y)throw new Error("Record doesn't exit.");return y}probeEOL(y){for(let L=0;L<y.length;L++)if(y[L]===l)return y[L-1]==="\r"?u:l;throw new Error("Invalid newline character.")}parseLine(y,L){if(y.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const B=y[0];if(y[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:B,value:y.slice(2),line:L,cur:0}}parseSessionAttribute(){const y=new ve;for(;this.currentLine<this.records.length;){const L=this.getCurrentRecord();if(L.type!==f.ATTRIBUTE)break;const B={attField:this.extractOneOrMore(L,ot=>I(ot)&&ot!==":"),_cur:0};L.value[L.cur]===":"&&(L.cur+=1,B.attValue=this.extractOneOrMore(L,V)),y.parse(B),this.currentLine++}return y.digest()}parseMediaAttributes(y){const L=new Ue(y);for(;this.currentLine<this.records.length;){const B=this.getCurrentRecord();if(B.type!==f.ATTRIBUTE)break;const ot={attField:this.extractOneOrMore(B,Qt=>I(Qt)&&Qt!==":"),_cur:0};B.value[B.cur]===":"&&(B.cur+=1,ot.attValue=this.extractOneOrMore(B,V)),L.parse(ot),this.currentLine++}return L.digest()}parseKey(){const y=this.getCurrentRecord();if(y.type===f.KEY){if(y.value==="prompt"||y.value==="clear:"||y.value==="base64:"||y.value==="uri:")return y.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const y=this.getCurrentRecord();if(y.type===f.ZONE_ADJUSTMENTS){const L=[];for(;;)try{const B=this.extract(y,this.consumeTime);this.consumeSpaceForRecord(y);let ot=!1;y.value[y.cur]==="-"&&(ot=!0,y.cur+=1);const Qt=this.extract(y,this.consumeTypedTime);L.push({time:B,typedTime:Qt,back:ot})}catch{break}if(L.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,L}return[]}parseRepeat(){const y=[];for(;;){const L=this.getCurrentRecord();if(L.type!==f.REPEAT)break;{const B=this.extract(L,this.consumeRepeatInterval),ot=this.parseTypedTime(L);y.push({repeatInterval:B,typedTimes:ot}),this.currentLine++}}return y}parseTypedTime(y){const L=[];for(;;)try{this.consumeSpaceForRecord(y),L.push(this.extract(y,this.consumeTypedTime))}catch{break}if(L.length===0)throw new Error("Invalid typed time.");return L}parseTime(){const y=this.getCurrentRecord(),L=this.extract(y,this.consumeTime);this.consumeSpaceForRecord(y);const B=this.extract(y,this.consumeTime);return this.currentLine++,{startTime:L,stopTime:B}}parseBandWidth(){const y=[];for(;this.currentLine<this.records.length;){const L=this.getCurrentRecord();if(L.type!==f.BANDWIDTH)break;{const B=this.extractOneOrMore(L,I);if(L.value[L.cur]!==":")throw new Error("Invalid bandwidth field.");L.cur++;const ot=this.extractOneOrMore(L,g);y.push({bwtype:B,bandwidth:ot}),this.currentLine++}}return y}parseVersion(){const y=this.getCurrentRecord();if(y.type!==f.VERSION)throw new Error("first sdp record must be version");const L=y.value.slice(0,this.consumeOneOrMore(y.value,0,g));if(L.length!==y.value.length)throw new Error('invalid proto version, "v='.concat(y.value,'"'));return this.currentLine++,L}parseOrigin(){const y=this.getCurrentRecord();if(y.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");const L=this.extractOneOrMore(y,w);this.consumeSpaceForRecord(y);const B=this.extractOneOrMore(y,g);this.consumeSpaceForRecord(y);const ot=this.extractOneOrMore(y,g);this.consumeSpaceForRecord(y);const Qt=this.extractOneOrMore(y,I);this.consumeSpaceForRecord(y);const Je=this.extractOneOrMore(y,I);this.consumeSpaceForRecord(y);const hi=this.extract(y,this.consumeUnicastAddress);return this.currentLine++,{username:L,sessId:B,sessVersion:ot,nettype:Qt,addrtype:Je,unicastAddress:hi}}parseSessionName(){const y=this.getCurrentRecord();if(y.type===f.SESSION_NAME){const L=this.extract(y,this.consumeText);return this.currentLine++,L}}parseInformation(){const y=this.getCurrentRecord();if(y.type!==f.INFORMATION)return;const L=this.extract(y,this.consumeText);return this.currentLine++,L}parseUri(){const y=this.getCurrentRecord();if(y.type===f.URI)return this.currentLine++,y.value}parseEmail(){const y=[];for(;;){const L=this.getCurrentRecord();if(L.type!==f.EMAIL)break;y.push(L.value),this.currentLine++}return y}parsePhone(){const y=[];for(;;){const L=this.getCurrentRecord();if(L.type!==f.PHONE)break;y.push(L.value),this.currentLine++}return y}parseConnection(){const y=this.getCurrentRecord();if(y.type===f.CONNECTION){const L=this.extractOneOrMore(y,I);this.consumeSpaceForRecord(y);const B=this.extractOneOrMore(y,I);this.consumeSpaceForRecord(y);const ot=this.extract(y,this.consumeAddress);return this.currentLine++,{nettype:L,addrtype:B,address:ot}}}parseMedia(){const y=this.getCurrentRecord(),L=this.extract(y,this.consumeToken);this.consumeSpaceForRecord(y);let B=this.extract(y,this.consumePort);y.value[y.cur]==="/"&&(y.cur+=1,B+=this.extract(y,this.consumeInteger)),this.consumeSpaceForRecord(y);const ot=[];for(ot.push(this.extract(y,this.consumeToken));y.value[y.cur]==="/";)y.cur+=1,ot.push(this.extract(y,this.consumeToken));if(ot.length===0)throw new Error("Invalid proto");const Qt=this.parseFmt(y);return this.currentLine++,{mediaType:L,port:B,protos:ot,fmts:Qt}}parseTimeFields(){const y=[];for(;this.getCurrentRecord().type===f.TIME;){const L=this.parseTime(),B=this.parseRepeat(),ot=this.parseZone();y.push({time:L,repeats:B,zones:ot})}return y}parseMediaDescription(){const y=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){const L=this.parseMedia(),B=this.parseInformation(),ot=this.parseConnections(),Qt=this.parseBandWidth(),Je=this.parseKey(),hi=this.parseMediaAttributes(L);y.push({media:L,information:B,connections:ot,bandwidths:Qt,key:Je,attributes:hi})}return y}parseConnections(){const y=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)y.push(this.parseConnection());return y}parseFmt(y){const L=[];for(;;)try{this.consumeSpaceForRecord(y),L.push(this.extract(y,this.consumeToken))}catch{break}if(L.length===0)throw new Error("Invalid fmts");return L}extract(y,L,...B){const ot=L.call(this,y.value,y.cur,...B),Qt=y.value.slice(y.cur,ot);return y.cur=ot,Qt}extractOneOrMore(y,L){const B=this.consumeOneOrMore(y.value,y.cur,L),ot=y.value.slice(y.cur,B);return y.cur=B,ot}consumeSpaceForRecord(y){if(y.value[y.cur]!==h)throw new Error("Invalid space at ".concat(y.cur,"."));y.cur+=1}}class pe extends lt{constructor(...y){super(...y),_t(this,"attributes",void 0),_t(this,"digested",!1)}extractOneOrMore(y,L,B){const ot=this.consumeOneOrMore(y.attValue,y._cur,L),Qt=y.attValue.slice(y._cur,ot),[Je,hi]=B||[];if(typeof Je=="number"&&Qt.length<Je)throw new Error("error in length, should be more or equal than ".concat(Je," characters."));if(typeof hi=="number"&&Qt.length>hi)throw new Error("error in length, should be less or equal than ".concat(hi," characters."));return y._cur=ot,Qt}consumeAttributeSpace(y){if(y.attValue[y._cur]!==h)throw new Error("Invalid space at ".concat(y._cur,"."));y._cur+=1}extract(y,L,...B){if(!y.attValue)throw new Error("Nothing to extract from attValue.");const ot=L.call(this,y.attValue,y._cur,...B),Qt=y.attValue.slice(y._cur,ot);return y._cur=ot,Qt}atEnd(y){if(!y.attValue)throw new Error;return y._cur>=y.attValue.length}peekChar(y){if(!y.attValue)throw new Error;return y.attValue[y._cur]}peek(y,L){if(!y.attValue)throw new Error;for(let B=0;B<L.length;B++)if(L[B]!==y.attValue[y._cur+B])return!1;return!0}parseIceUfrag(y){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(y,Z,[4,256])}parseIcePwd(y){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(y,Z,[22,256])}parseIceOptions(y){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const L=[];for(;!this.atEnd(y);){L.push(this.extractOneOrMore(y,Z));try{this.consumeAttributeSpace(y)}catch(B){if(this.atEnd(y))break;throw B}}this.attributes.iceOptions=L}parseFingerprint(y){const L=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y);const B=this.extract(y,this.consumeTill);this.attributes.fingerprints.push({hashFunction:L,fingerprint:B})}parseExtmap(y){const L=this.extractOneOrMore(y,g);let B;this.peekChar(y)==="/"&&(this.extract(y,this.consume,"/"),B=this.extract(y,this.consumeToken)),this.consumeAttributeSpace(y);const ot=this.extract(y,this.consumeTill,h),Qt=et(et({entry:parseInt(L,10)},B&&{direction:B}),{},{extensionName:ot});this.peekChar(y)===h&&(this.consumeAttributeSpace(y),Qt.extensionAttributes=this.extract(y,this.consumeTill)),this.attributes.extmaps.push(Qt)}parseSetup(y){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const L=this.extract(y,this.consumeTill);if(L!=="active"&&L!=="passive"&&L!=="actpass"&&L!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=L}}class ve extends pe{constructor(...y){super(...y),_t(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(y){if(this.digested)throw new Error("already digested");try{switch(y.attField){case"group":this.parseGroup(y);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(y);break;case"ice-pwd":this.parseIcePwd(y);break;case"ice-options":this.parseIceOptions(y);break;case"fingerprint":this.parseFingerprint(y);break;case"setup":this.parseSetup(y);break;case"tls-id":this.parseTlsId(y);break;case"identity":this.parseIdentity(y);break;case"extmap":this.parseExtmap(y);break;case"msid-semantic":this.parseMsidSemantic(y);break;default:y.ignored=!0,this.attributes.unrecognized.push(y)}}catch(L){throw console.error("parsing session attribute ".concat(y.attField,' error, "a=').concat(y.attField,":").concat(y.attValue,'"')),L}if(!y.ignored&&y.attValue&&!this.atEnd(y))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(y){const L=this.extract(y,this.consumeToken),B=[];for(;!this.atEnd(y)&&this.peekChar(y)===h;)this.consumeAttributeSpace(y),B.push(this.extract(y,this.consumeToken));this.attributes.groups.push({semantic:L,identificationTag:B})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(y){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(y,$)}parseIdentity(y){const L=this.extractOneOrMore(y,W),B=[];for(;!this.atEnd(y)&&this.peekChar(y)===h;){this.consumeAttributeSpace(y);const ot=this.extract(y,this.consumeToken);this.extract(y,this.consume,"=");const Qt=this.extractOneOrMore(y,Je=>Je!==h&&V(Je));B.push({name:ot,value:Qt})}this.attributes.identities.push({assertionValue:L,extensions:B})}parseMsidSemantic(y){this.peekChar(y)===h&&this.consumeAttributeSpace(y);const L={semantic:this.extract(y,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(y)}catch{break}if(this.peekChar(y)==="*"){this.extract(y,this.consume,"*"),L.applyForAll=!0;break}{const B=this.extract(y,this.consumeTill,h);L.identifierList.push(B)}}this.attributes.msidSemantic=L}}class Ue extends pe{constructor(y){super(),_t(this,"attributes",void 0),y.protos.indexOf("RTP")!==-1||y.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(y){if(this.digested)throw new Error("already digested");try{switch(y.attField){case"extmap":this.parseExtmap(y);break;case"setup":this.parseSetup(y);break;case"ice-ufrag":this.parseIceUfrag(y);break;case"ice-pwd":this.parseIcePwd(y);break;case"ice-options":this.parseIceOptions(y);break;case"candidate":this.parseCandidate(y);break;case"remote-candidate":this.parseRemoteCandidate(y);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(y);break;case"rtpmap":this.parseRtpmap(y);break;case"ptime":this.parsePtime(y);break;case"maxptime":this.parseMaxPtime(y);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(y);break;case"ssrc":this.parseSSRC(y);break;case"fmtp":this.parseFmtp(y);break;case"rtcp-fb":this.parseRtcpFb(y);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(y);break;case"mid":this.parseMid(y);break;case"msid":this.parseMsid(y);break;case"imageattr":this.parseImageAttr(y);break;case"rid":this.parseRid(y);break;case"simulcast":this.parseSimulcast(y);break;case"sctp-port":this.parseSctpPort(y);break;case"max-message-size":this.parseMaxMessageSize(y);break;case"ssrc-group":this.parseSSRCGroup(y);break;default:y.ignored=!0,this.attributes.unrecognized.push(y)}}catch(L){throw console.error("parsing media attribute ".concat(y.attField,' error, "a=').concat(y.attField,":").concat(y.attValue,'"')),L}if(!y.ignored&&y.attValue&&!this.atEnd(y))throw new Error("attribute parsing error")}parseCandidate(y){const L=this.extractOneOrMore(y,Z,[1,32]);this.consumeAttributeSpace(y);const B=this.extractOneOrMore(y,g,[1,5]);this.consumeAttributeSpace(y);const ot=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y);const Qt=this.extractOneOrMore(y,g,[1,10]);this.consumeAttributeSpace(y);const Je=this.extract(y,this.consumeAddress);this.consumeAttributeSpace(y);const hi=this.extract(y,this.consumePort);this.consumeAttributeSpace(y),this.extract(y,this.consume,"typ"),this.consumeAttributeSpace(y);const _s={foundation:L,componentId:B,transport:ot,priority:Qt,connectionAddress:Je,port:hi,type:this.extract(y,this.consumeToken),extension:{}};for(this.peek(y," raddr")&&(this.extract(y,this.consume," raddr"),this.consumeAttributeSpace(y),_s.relAddr=this.extract(y,this.consumeAddress)),this.peek(y," rport")&&(this.extract(y,this.consume," rport"),this.consumeAttributeSpace(y),_s.relPort=this.extract(y,this.consumePort));this.peekChar(y)===h;){this.consumeAttributeSpace(y);const ia=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y),_s.extension[ia]=this.extractOneOrMore(y,S)}this.attributes.candidates.push(_s)}parseRemoteCandidate(y){const L=[];for(;;){const B=this.extractOneOrMore(y,g,[1,5]);this.consumeAttributeSpace(y);const ot=this.extract(y,this.consumeAddress);this.consumeAttributeSpace(y);const Qt=this.extract(y,this.consumePort);L.push({componentId:B,connectionAddress:ot,port:Qt});try{this.consumeAttributeSpace(y)}catch{break}}this.attributes.remoteCandidatesList.push(L)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(y){const L=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y);const B=this.extract(y,this.consumeTill,"/");this.extract(y,this.consume,"/");const ot={encodingName:B,clockRate:this.extractOneOrMore(y,g)};this.atEnd(y)||this.peekChar(y)!=="/"||(this.extract(y,this.consume,"/"),ot.encodingParameters=parseInt(this.extract(y,this.consumeTill),10));const Qt=this.attributes.payloads.find(Je=>Je.payloadType===parseInt(L,10));Qt?Qt.rtpMap=ot:this.attributes.payloads.push({payloadType:parseInt(L,10),rtpMap:ot,rtcpFeedbacks:[]})}parsePtime(y){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(y,this.consumeTill)}parseMaxPtime(y){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(y,this.consumeTill)}parseDirection(y){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=y.attField}parseSSRC(y){const L=this.extractOneOrMore(y,g);this.consumeAttributeSpace(y);const B=this.extract(y,this.consumeTill,":");let ot;this.peekChar(y)===":"&&(this.extract(y,this.consume,":"),ot=this.extract(y,this.consumeTill));const Qt=this.attributes.ssrcs.find(Je=>Je.ssrcId===parseInt(L,10));Qt?Qt.attributes[B]=ot:this.attributes.ssrcs.push({ssrcId:parseInt(L,10),attributes:{[B]:ot}})}parseFmtp(y){const L=this.extract(y,this.consumeTill,h);this.consumeAttributeSpace(y);const B=this.extract(y,this.consumeTill),ot={};B.split(";").forEach(Je=>{let[hi,_s]=Je.split("=");hi=hi.trim();const ia=typeof _s=="string"?_s.trim():null;typeof hi=="string"&&hi.length>0&&(ot[hi]=ia)});const Qt=this.attributes.payloads.find(Je=>Je.payloadType===parseInt(L,10));Qt?Qt.fmtp={parameters:ot}:this.attributes.payloads.push({payloadType:parseInt(L,10),rtcpFeedbacks:[],fmtp:{parameters:ot}})}parseFmtParameters(y){const L={},B=this.extract(y,this.consumeTill,"=");y._cur++;const ot=this.extract(y,this.consumeTill,";");for(L[B]=ot;y.attValue[y._cur]===";";){const Qt=this.extract(y,this.consumeTill,"=");y._cur++;const Je=this.extract(y,this.consumeTill,";");L[Qt]=Je}return L}parseRtcpFb(y){let L="";L=this.peekChar(y)==="*"?this.extract(y,this.consume,"*"):this.extract(y,this.consumeTill,h),this.consumeAttributeSpace(y);const B=this.extract(y,this.consumeTill,h);let ot;if(B==="trr-int")ot={type:B,interval:this.extract(y,this.consumeTill)};else{const Qt={type:B};this.peekChar(y)===h&&(this.consumeAttributeSpace(y),Qt.parameter=this.extract(y,this.consumeToken),this.peekChar(y)===h&&(Qt.additional=this.extract(y,this.consumeTill))),ot=Qt}if(L==="*")this.attributes.rtcpFeedbackWildcards.push(ot);else{const Qt=this.attributes.payloads.find(Je=>Je.payloadType===parseInt(L,10));Qt?Qt.rtcpFeedbacks.push(ot):this.attributes.payloads.push({payloadType:parseInt(L,10),rtcpFeedbacks:[ot]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(y){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const L={port:this.extract(y,this.consumePort)};this.peekChar(y)===h&&(this.consumeAttributeSpace(y),L.netType=this.extractOneOrMore(y,I),this.consumeAttributeSpace(y),L.addressType=this.extractOneOrMore(y,I),this.consumeAttributeSpace(y),L.address=this.extract(y,this.consumeAddress)),this.attributes.rtcp=L}parseMsid(y){const L={id:this.extractOneOrMore(y,I,[1,64])};this.peekChar(y)===h&&(this.consumeAttributeSpace(y),L.appdata=this.extractOneOrMore(y,I,[1,64])),this.attributes.msids.push(L)}parseImageAttr(y){this.attributes.imageattr.push(y.attValue)}parseRid(y){const L=this.extractOneOrMore(y,ot=>M(ot)||g(ot)||ot==="_"||ot==="-");this.consumeAttributeSpace(y);const B={id:L,direction:this.extract(y,this.consumeToken),params:[]};if(this.peekChar(y)===h){if(this.consumeAttributeSpace(y),this.peek(y,"pt=")){this.extract(y,this.consume,"pt=");const ot=[];for(;;){const Qt=this.extract(y,this.consumeToken);ot.push(Qt);try{this.extract(y,this.consume,",")}catch{break}}B.payloads=ot,this.peekChar(y)===h&&this.extract(y,this.consume,h)}for(;;){const ot=this.extract(y,this.consumeToken);switch(ot){case"depend":{const Qt={type:ot,rids:this.extract(y,this.consume,"=").split(",")};B.params.push(Qt);break}default:{const Qt={type:ot};this.peekChar(y)==="="&&(this.extract(y,this.consume,"="),Qt.val=this.extract(y,this.consumeTill,";")),B.params.push(Qt)}}try{this.extract(y,this.consume,";")}catch{break}}}this.attributes.rids.push(B)}parseSimulcast(y){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=y.attValue,this.extract(y,this.consumeTill)}parseSctpPort(y){this.attributes.sctpPort=this.extractOneOrMore(y,g,[1,5])}parseMaxMessageSize(y){this.attributes.maxMessageSize=this.extractOneOrMore(y,g,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(y){this.attributes.mid=this.extract(y,this.consumeToken)}parseSSRCGroup(y){const L=this.extract(y,this.consumeToken),B=[];for(;;)try{this.consumeAttributeSpace(y);const ot=this.extract(y,this.consumeInteger);B.push(parseInt(ot,10))}catch{break}this.attributes.ssrcGroups.push({semantic:L,ssrcIds:B})}}function de(ut,y,L){return y in ut?Object.defineProperty(ut,y,{value:L,enumerable:!0,configurable:!0,writable:!0}):ut[y]=L,ut}class Nn{constructor(){de(this,"eol",u)}print(y,L){let B="";return L&&(this.eol=L),B+=this.printVersion(y.version),B+=this.printOrigin(y.origin),B+=this.printSessionName(y.sessionName),B+=this.printInformation(y.information),B+=this.printUri(y.uri),B+=this.printEmail(y.emails),B+=this.printPhone(y.phones),B+=this.printConnection(y.connection),B+=this.printBandwidth(y.bandwidths),B+=this.printTimeFields(y.timeFields),B+=this.printKey(y.key),B+=this.printSessionAttributes(y.attributes),B+=this.printMediaDescription(y.mediaDescriptions),B}printVersion(y){return"v=".concat(y).concat(this.eol)}printOrigin(y){return"o=".concat(y.username," ").concat(y.sessId," ").concat(y.sessVersion," ").concat(y.nettype," ").concat(y.addrtype," ").concat(y.unicastAddress).concat(this.eol)}printSessionName(y){return y?"s=".concat(y).concat(this.eol):""}printInformation(y){return y?"i=".concat(y).concat(this.eol):""}printUri(y){return y?"u=".concat(y).concat(this.eol):""}printEmail(y){let L="";for(const B of y)L+="e=".concat(B).concat(this.eol);return L}printPhone(y){let L="";for(const B of y)L+="e=".concat(B).concat(this.eol);return L}printConnection(y){return y?"c=".concat(y.nettype," ").concat(y.addrtype," ").concat(y.address).concat(this.eol):""}printBandwidth(y){let L="";for(const B of y)L+="b=".concat(B.bwtype,":").concat(B.bandwidth).concat(this.eol);return L}printTimeFields(y){let L="";for(const B of y){L+="t=".concat(B.time.startTime," ").concat(B.time.startTime).concat(this.eol);for(const ot of B.repeats)L+="r=".concat(ot.repeatInterval," ").concat(ot.typedTimes.join(" ")).concat(this.eol);B.zoneAdjustments&&(L+="z=",L+="z=".concat(B.zoneAdjustments.map(ot=>"".concat(ot.time," ").concat(ot.back?"-":""," ").concat(ot.typedTime)).join(" ")).concat(this.eol),L+=this.eol)}return L}printKey(y){return y?"k=".concat(y).concat(this.eol):""}printAttributes(y){let L="";for(const B of y)L+="a=".concat(B.attField).concat(B.attValue?":".concat(B.attValue):"").concat(this.eol);return L}printMediaDescription(y){let L="";for(const B of y)L+=this.printMedia(B.media),L+=this.printInformation(B.information),L+=this.printConnections(B.connections),L+=this.printBandwidth(B.bandwidths),L+=this.printKey(B.key),L+=this.printMediaAttributes(B);return L}printConnections(y){let L="";for(const B of y)L+=this.printConnection(B);return L}printMedia(y){return"m=".concat(y.mediaType," ").concat(y.port," ").concat(y.protos.join("/")," ").concat(y.fmts.join(" ")).concat(this.eol)}printSessionAttributes(y){return new ct(this.eol).print(y)}printMediaAttributes(y){return new Ct(this.eol).print(y)}}class nt{constructor(y){de(this,"eol",void 0),this.eol=y}printIceUfrag(y){return y===void 0?"":"a=ice-ufrag:".concat(y).concat(this.eol)}printIcePwd(y){return y===void 0?"":"a=ice-pwd:".concat(y).concat(this.eol)}printIceOptions(y){return y===void 0?"":"a=ice-options:".concat(y.join(h)).concat(this.eol)}printFingerprints(y){return y.length>0?y.map(L=>"a=fingerprint:".concat(L.hashFunction).concat(h).concat(L.fingerprint)).join(this.eol)+this.eol:""}printExtmap(y){return y.map(L=>"a=extmap:".concat(L.entry).concat(L.direction?"/".concat(L.direction):"").concat(h).concat(L.extensionName).concat(L.extensionAttributes?"".concat(h).concat(L.extensionAttributes):"").concat(this.eol)).join("")}printSetup(y){return y===void 0?"":"a=setup:".concat(y).concat(this.eol)}printUnrecognized(y){return y.map(L=>"a=".concat(L.attField).concat(L.attValue?":".concat(L.attValue):"").concat(this.eol)).join("")}}class ct extends nt{print(y){let L="";return L+=this.printGroups(y.groups),L+=this.printMsidSemantic(y.msidSemantic),L+=this.printIceLite(y.iceLite),L+=this.printIceUfrag(y.iceUfrag),L+=this.printIcePwd(y.icePwd),L+=this.printIceOptions(y.iceOptions),L+=this.printFingerprints(y.fingerprints),L+=this.printSetup(y.setup),L+=this.printTlsId(y.tlsId),L+=this.printIdentity(y.identities),L+=this.printExtmap(y.extmaps),L+=this.printUnrecognized(y.unrecognized),L}printGroups(y){let L="";return y.length>0&&(L+=y.map(B=>"a=group:".concat(B.semantic).concat(B.identificationTag.map(ot=>"".concat(h).concat(ot)).join("")).concat(this.eol)).join("")),L}printIceLite(y){return y===void 0?"":"a=ice-lite"+this.eol}printTlsId(y){return y?"a=tls-id:".concat(y).concat(this.eol):""}printIdentity(y){return y.length===0?"":y.map(L=>"a=identity:".concat(L.assertionValue).concat(L.extensions.map(B=>"".concat(h).concat(B.name).concat(B.value?"=".concat(B.value):"")))).join(this.eol)+this.eol}printMsidSemantic(y){if(!y)return"";let L="a=msid-semantic:".concat(y.semantic);return y.applyForAll?L+="".concat(h,"*"):y.identifierList.length>0&&(L+=y.identifierList.map(B=>"".concat(h).concat(B))),L+this.eol}}class Ct extends nt{print(y){const L=y.attributes;let B="";return B+=this.printRTCP(L.rtcp),B+=this.printIceUfrag(L.iceUfrag),B+=this.printIcePwd(L.icePwd),B+=this.printIceOptions(L.iceOptions),B+=this.printCandidates(L.candidates),B+=this.printRemoteCandidatesList(L.remoteCandidatesList),B+=this.printEndOfCandidates(L.endOfCandidates),B+=this.printFingerprints(L.fingerprints),B+=this.printSetup(L.setup),B+=this.printMid(L.mid),B+=this.printExtmap(L.extmaps),B+=this.printRTPRelated(L),B+=this.printPtime(L.ptime),B+=this.printMaxPtime(L.maxPtime),B+=this.printDirection(L.direction),B+=this.printSSRCGroups(L.ssrcGroups),B+=this.printSSRC(L.ssrcs),B+=this.printRTCPMux(L.rtcpMux),B+=this.printRTCPMuxOnly(L.rtcpMuxOnly),B+=this.printRTCPRsize(L.rtcpRsize),B+=this.printMSId(L.msids),B+=this.printImageattr(L.imageattr),B+=this.printRid(L.rids),B+=this.printSimulcast(L.simulcast),B+=this.printSCTPPort(L.sctpPort),B+=this.printMaxMessageSize(L.maxMessageSize),B+=this.printUnrecognized(L.unrecognized),B}printCandidates(y){return y.map(L=>"a=candidate:".concat(L.foundation).concat(h).concat(L.componentId).concat(h).concat(L.transport).concat(h).concat(L.priority).concat(h).concat(L.connectionAddress).concat(h).concat(L.port).concat(h,"typ").concat(h).concat(L.type).concat(L.relAddr?"".concat(h,"raddr").concat(h).concat(L.relAddr):"").concat(L.relPort?"".concat(h,"rport").concat(h).concat(L.relPort):"").concat(Object.keys(L.extension).map(B=>"".concat(h).concat(B).concat(h).concat(L.extension[B])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(y){return y.map(L=>"a=remote-candidates:".concat(L.join(h)).concat(this.eol)).join("")}printEndOfCandidates(y){return y===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(y){if(!y.payloads)return"";const L=y.payloads;let B="";B+=y.rtcpFeedbackWildcards.map(ot=>this.printRTCPFeedback("*",ot)).join("");for(const ot of L)B+=this.printRtpMap(ot.payloadType,ot.rtpMap),B+=this.printFmtp(ot.payloadType,ot.fmtp),B+=ot.rtcpFeedbacks.map(Qt=>this.printRTCPFeedback(ot.payloadType,Qt)).join("");return B}printFmtp(y,L){if(!L)return"";const B=Object.keys(L.parameters);return B.length===1&&L.parameters[B[0]]===null?"a=fmtp:".concat(y).concat(h).concat(B[0]).concat(this.eol):"a=fmtp:".concat(y).concat(h).concat(Object.keys(L.parameters).map(ot=>"".concat(ot,"=").concat(L.parameters[ot])).join(";")).concat(this.eol)}printRtpMap(y,L){return L?"a=rtpmap:".concat(y).concat(h).concat(L.encodingName,"/").concat(L.clockRate).concat(L.encodingParameters?"/".concat(L.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(y,L){let B="a=rtcp-fb:".concat(y).concat(h),ot=L;return ot.type==="trr-int"?B+="ttr-int".concat(h).concat(ot.interval):(B+="".concat(ot.type),ot.parameter&&(B+="".concat(h).concat(ot.parameter),ot.additional&&(B+="".concat(h).concat(ot.additional)))),B+this.eol}printPtime(y){return y===void 0?"":"a=ptime:".concat(y).concat(this.eol)}printMaxPtime(y){return y===void 0?"":"a=maxptime:".concat(y).concat(this.eol)}printDirection(y){return y===void 0?"":"a=".concat(y).concat(this.eol)}printSSRC(y){return y.map(L=>Object.keys(L.attributes).map(B=>"a=ssrc:".concat(L.ssrcId.toString(10)).concat(h).concat(B).concat(L.attributes[B]?":".concat(L.attributes[B]):"").concat(this.eol)).join("")).join("")}printRTCPMux(y){return y===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(y){return y===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(y){return y===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(y){if(y===void 0)return"";let L="a=rtcp:".concat(y.port);return y.netType&&(L+="".concat(h).concat(y.netType)),y.addressType&&(L+="".concat(h).concat(y.addressType)),y.address&&(L+="".concat(h).concat(y.address)),L+this.eol}printMSId(y){return y.map(L=>"a=msid:".concat(L.id).concat(L.appdata?"".concat(h).concat(L.appdata):"").concat(this.eol)).join("")}printImageattr(y){return y.map(L=>"a=imageattr:".concat(L).concat(this.eol)).join("")}printRid(y){return y.map(L=>{let B="a=rid:".concat(L.id).concat(h).concat(L.direction);return L.payloads&&(B+="".concat(h,"pt=").concat(L.payloads.join(","))),L.params.length>0&&(B+="".concat(h).concat(L.params.map(ot=>ot.type==="depend"?"depend=".concat(ot.rids.join(",")):"".concat(ot.type,"=").concat(ot.val)).join(";"))),B+this.eol}).join("")}printSimulcast(y){return y===void 0?"":"a=simulcast:".concat(y).concat(this.eol)}printSCTPPort(y){return y===void 0?"":"a=sctp-port:".concat(y).concat(this.eol)}printMaxMessageSize(y){return y===void 0?"":"a=max-message-size:".concat(y).concat(this.eol)}printMid(y){return y===void 0?"":"a=mid:".concat(y).concat(this.eol)}printSSRCGroups(y){return y.map(L=>"a=ssrc-group:".concat(L.semantic).concat(L.ssrcIds.map(B=>"".concat(h).concat(B.toString(10))).join("")).concat(this.eol)).join("")}}function Yt(ut){return new Xt().parse(ut)}function Ie(ut,y){return new Nn().print(ut,y)}}},i={};function s(r){if(i[r])return i[r].exports;var a=i[r]={exports:{}};return e[r](a,a.exports,s),a.exports}return s.d=(r,a)=>{for(var c in a)s.o(a,c)&&!s.o(r,c)&&Object.defineProperty(r,c,{enumerable:!0,get:a[c]})},s.o=(r,a)=>Object.prototype.hasOwnProperty.call(r,a),s.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},s(8)})()})(jO);var un=jO.exports;function GO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function WO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?GO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):GO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function wS(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:r,filterAudioFec:a,filterAudioCodec:c,filterVideoCodec:l}=t,{useXR:u}=e;let h=[],f=[],g=[],S=[],w=!1,I=!1;if(un.parse(n).mediaDescriptions.forEach(b=>{i&&i!==b.attributes.direction||(b.media.mediaType!=="video"||w||(f=b.attributes.payloads,S=b.attributes.extmaps,w=!0),b.media.mediaType!=="audio"||I||(h=b.attributes.payloads,g=b.attributes.extmaps,I=!0))}),!S||f.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!g||h.length===0)throw new Error("Cannot get audio capabilities from SDP.");return f.forEach(b=>{var M;(M=b.rtpMap)!==null&&M!==void 0&&M.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),u&&b.rtcpFeedbacks.push({type:"rrtr"})}),h.forEach(b=>{var M;(M=b.rtpMap)!==null&&M!==void 0&&M.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),u&&b.rtcpFeedbacks.push({type:"rrtr"})}),s&&(h=h.filter(b=>{var M;return((M=b.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())!=="rtx"}),f=f.filter(b=>{var M;return((M=b.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())!=="rtx"})),r&&(f=f.filter(b=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test(((M=b.rtpMap)===null||M===void 0?void 0:M.encodingName)||"")})),a&&(h=h.filter(b=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test(((M=b.rtpMap)===null||M===void 0?void 0:M.encodingName)||"")})),c&&(c==null?void 0:c.length)>0&&(h=h.filter(b=>{var M;return Vt(c).call(c,((M=b.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"")})),l&&(l==null?void 0:l.length)>0&&(f=f.filter(b=>{var M;return Vt(l).call(l,((M=b.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"")})),{audioCodecs:h,videoCodecs:f,audioExtensions:g,videoExtensions:S}}function Kc(n){const t=un.parse(n);let e,i;for(const s of t.mediaDescriptions){if(!e){const r=s.attributes.iceUfrag,a=s.attributes.icePwd;if(!r||!a)throw new Error("Cannot get iceUfrag or icePwd from SDP.");e={iceUfrag:r,icePwd:a}}if(!i){const r=s.attributes.fingerprints;r.length>0&&(i={fingerprints:r})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!e)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:e,dtlsParameters:i}}function HO(n,t){const e=[],i=n.attributes.ssrcGroups.filter(a=>a.semantic==="FID"),s=n.attributes.ssrcGroups.find(a=>a.semantic==="SIM"),r=n.attributes.ssrcs;if(s)s.ssrcIds.forEach(a=>{var c;const l=(c=i.find(u=>u.ssrcIds[0]===a))===null||c===void 0?void 0:c.ssrcIds[1];e.push({ssrcId:a,rtx:t?l:void 0})});else if(i.length>0){const a=i[0].ssrcIds[0],c=i[0].ssrcIds[1];e.push({ssrcId:a,rtx:t?c:void 0})}else{if(r.length===0)throw new Error("No ssrcs found on local media description.");e.push({ssrcId:r[0].ssrcId})}return e}function KO(n,t){const{cname:e}=n;let i;t&&t.ip&&typeof t.port=="number"?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):i=n.iceParameters.candidates.map(c=>({foundation:c.foundation,componentId:"1",transport:c.protocol,priority:c.priority.toString(),connectionAddress:c.ip,port:c.port.toString(),type:c.type,extension:{}}));const s={fingerprints:n.dtlsParameters.fingerprints.map(c=>({hashFunction:c.algorithm,fingerprint:c.fingerprint}))},r={iceUfrag:n.iceParameters.iceUfrag,icePwd:n.iceParameters.icePwd};let a;switch(n.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}return{dtlsParameters:s,iceParameters:r,candidates:i,rtpCapabilities:PS(n.rtpCapabilities),setup:a,cname:e}}function er(n,t,e){const i=[],s=[];return n.forEach(r=>{let{ssrcId:a,rtx:c}=r;const l=Be(8,"track-"),u={ssrcId:a,attributes:WO({label:l,mslabel:e=e||Be(10,""),msid:"".concat(e," ").concat(l)},t&&{cname:t})};if(i.push(u),c!==void 0){const h={ssrcId:c,attributes:WO({label:l,mslabel:e,msid:"".concat(e," ").concat(l)},t&&{cname:t})};i.push(h),s.push({semantic:"FID",ssrcIds:[a,c]})}}),n.length>1&&s.push({semantic:"SIM",ssrcIds:n.map(r=>{let{ssrcId:a}=r;return a})}),{ssrcs:i,ssrcGroups:s}}function qc(n,t){t instanceof Oe&&n.attributes.payloads.forEach(e=>{var i;const s=(i=e.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const r=t._encoderConfig;r&&s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(r.bitrate&&!$e()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*r.bitrate))),r.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(r.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(r.sampleRate)),r.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))})}function OS(n){const t=n.attributes.unrecognized.findIndex(e=>e.attField==="x-google-flag"&&e.attValue==="conference");t!==-1&&n.attributes.unrecognized.splice(t,1)}function NS(n,t){var e;if(!(t instanceof ae&&t._encoderConfig&&t._hints.indexOf(ze.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;Ke().supportMinBitrate&&i.bitrateMin&&n.attributes.payloads.forEach(s=>{var r,a;Vt(r=["h264","h265","vp8","vp9","av1"]).call(r,((a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Ke().supportMinBitrate&&!Vt(e=t._hints).call(e,ze.LOW_STREAM)&&i.bitrateMax&&n.attributes.payloads.forEach(s=>{var r,a;Vt(r=["h264","h265","vp8","vp9","av1"]).call(r,((a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(U("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function qO(n){if(n.media.mediaType!=="video")return;const t=we();if(t.name!==De.SAFARI&&t.os!==Kn.IOS)return;const e=n.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));e!==-1&&n.attributes.extmaps.splice(e,1)}function o_(n,t,e){if(!t)return;let i,s;if(n.media.mediaType==="video"?(i=e.videoExtensions,s=e.videoCodecs):(i=e.audioExtensions,s=e.audioCodecs),t.twcc===!0){const r=i.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");r&&(n.attributes.extmaps.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||n.attributes.extmaps.push({entry:r.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(c,l){return l.filter(u=>!!c.find(h=>h.payloadType===u.payloadType&&!!h.rtcpFeedbacks.find(f=>f.type==="transport-cc")))}(s,n.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="transport-cc")||c.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const r=n.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");r!==-1&&n.attributes.extmaps.splice(r,1),n.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}if(t.remb===!0){const r=i.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");r&&(n.attributes.extmaps.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||n.attributes.extmaps.push({entry:r.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(c,l){return l.filter(u=>!!c.find(h=>h.payloadType===u.payloadType&&!!h.rtcpFeedbacks.find(f=>f.type==="goog-remb")))}(s,n.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="goog-remb")||c.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const r=n.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");r!==-1&&n.attributes.extmaps.splice(r,1),n.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(l=>l.type==="goog-remb");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}}function DS(n,t,e){if($e()||n.media.mediaType!=="video"||!(t instanceof ae)||e!=="vp9"&&e!=="vp8"||e==="vp8"&&!U("SIMULCAST")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=e==="vp8"?2:t._scalabilityMode.numSpatialLayers,s=n.attributes.ssrcs[0],r=n.attributes.ssrcGroups.find(c=>c.semantic==="FID"&&c.ssrcIds[0]===s.ssrcId),a={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let c=1;c<i;c++)n.attributes.ssrcs.push({ssrcId:s.ssrcId+c,attributes:Rn(s.attributes)}),a.ssrcIds.push(s.ssrcId+c),r&&(n.attributes.ssrcs.push({ssrcId:r.ssrcIds[1]+c,attributes:Rn(s.attributes)}),n.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+c,r.ssrcIds[1]+c]}));n.attributes.ssrcGroups.unshift(a)}async function YO(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{filterRTX:e,filterVideoFec:i,filterAudioFec:s,filterAudioCodec:r,filterVideoCodec:a}=n,{useXR:c}=t,l=new RTCPeerConnection;l.addTransceiver("video",{direction:"sendonly"}),l.addTransceiver("audio",{direction:"sendonly"}),l.addTransceiver("video",{direction:"recvonly"}),l.addTransceiver("audio",{direction:"recvonly"});const u=(await l.createOffer()).sdp,h=wS(u,{filterRTX:e,filterVideoFec:i,filterAudioFec:s,filterAudioCodec:r,filterVideoCodec:a},{useXR:c},"sendonly"),f=wS(u,{filterRTX:e,filterVideoFec:i,filterAudioFec:s,filterAudioCodec:r,filterVideoCodec:a},{useXR:c},"recvonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(a_(h,f,"videoExtensions",g,S,w),a_(h,f,"videoCodecs",g,S,w),a_(h,f,"audioExtensions",g,S,w),a_(h,f,"audioCodecs",g,S,w),U("RAISE_H264_BASELINE_PRIORITY")){const I=w.videoCodecs.findIndex(b=>{var M,F;return((M=b.rtpMap)===null||M===void 0?void 0:M.encodingName.toLocaleLowerCase())==="h264"&&((F=b.fmtp)===null||F===void 0?void 0:F.parameters["profile-level-id"])==="42001f"});if(I!==-1){const b=w.videoCodecs.findIndex(M=>{var F;return((F=M.rtpMap)===null||F===void 0?void 0:F.encodingName.toLocaleLowerCase())==="h264"});if(b<I){v.debug("raising H264 baseline profile priority");const M=w.videoCodecs[I];w.videoCodecs.splice(I,1),w.videoCodecs.splice(b,0,M)}b!==-1&&(S.videoCodecs=S.videoCodecs.filter(M=>{var F,V;return!(((F=M.rtpMap)===null||F===void 0?void 0:F.encodingName.toLocaleLowerCase())==="h264"&&((V=M.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!=="42001f")})),b!==-1&&U("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(M=>{var F,V;return!(((F=M.rtpMap)===null||F===void 0?void 0:F.encodingName.toLocaleLowerCase())==="h264"&&((V=M.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!=="42001f")}))}}try{l.close()}catch{}return{send:g,recv:S,sendrecv:w}}function a_(n,t,e,i,s,r){if(e==="videoExtensions"||e==="audioExtensions"){const a=[];return n[e].forEach(c=>{t[e].some((l,u)=>{if(c.entry===l.entry&&c.extensionName===l.extensionName)return a.push(u),!0})?r[e].push(c):i[e].push(c)}),void t[e].forEach((c,l)=>{a.indexOf(l)===-1&&s[e].push(c)})}if(e==="videoCodecs"||e==="audioCodecs"){const a=[];return n[e].forEach(c=>{t[e].some((l,u)=>{if(c.payloadType===l.payloadType&&JSON.stringify(c)===JSON.stringify(l))return a.push(u),!0})?r[e].push(c):i[e].push(c)}),void t[e].forEach((c,l)=>{a.indexOf(l)===-1&&s[e].push(c)})}}function PS(n){const{send:t,recv:e,sendrecv:i}=n;if(!i){if(!t||!e)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:e}}let s,r;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...i.audioCodecs],s.videoCodecs=[...t.videoCodecs,...i.videoCodecs],s.audioExtensions=[...t.audioExtensions,...i.audioExtensions],s.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):s=i,e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,{send:s,recv:r}}function Wa(n){n.media.mediaType==="audio"&&n.attributes.payloads.filter(t=>{var e;return((e=t.rtpMap)===null||e===void 0?void 0:e.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function c_(n){n.mediaDescriptions.forEach(t=>{t.media.mediaType!=="video"&&t.media.mediaType!=="audio"||t.attributes.payloads.forEach(e=>{e.rtcpFeedbacks.findIndex(i=>i.type==="rrtr")===-1&&e.rtcpFeedbacks.push({type:"rrtr"})})})}function zO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function JO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?zO(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):zO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function yr(n){if(Array.isArray(n))return n.map(e=>e);if(!XO(n))return n;const t={};for(const e in n){const i=n[e];XO(i)||Array.isArray(i)?t[e]=yr(i):t[e]=i}return t}function XO(n){return!(typeof n!="object"||Array.isArray(n)||!n)}class LS{constructor(t){m(this,"input",[]),m(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const vo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},ah={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:vo,remoteCandidate:vo}},$O={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},QO={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},ZO={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},t0={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function e0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function n0(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?e0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):e0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class kS{constructor(t,e){m(this,"onFirstVideoReceived",void 0),m(this,"onFirstVideoDecoded",void 0),m(this,"onFirstAudioReceived",void 0),m(this,"onFirstVideoDecodedTimeout",void 0),m(this,"onFirstAudioDecoded",void 0),m(this,"onSelectedLocalCandidateChanged",void 0),m(this,"onSelectedRemoteCandidateChanged",void 0),m(this,"videoIsReady",!1),m(this,"videoIsReady2",{}),m(this,"pc",void 0),m(this,"options",void 0),m(this,"intervalTimer",void 0),m(this,"stats",yr(ah)),m(this,"isFirstVideoReceived",{}),m(this,"isFirstVideoDecoded",{}),m(this,"isFirstAudioReceived",{}),m(this,"isFirstAudioDecoded",{}),m(this,"isFirstVideoDecodedTimeout",{}),m(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new K(t=>{t({local:n0({},vo),remote:n0({},vo)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,r=0,a=0,c=0;for(const l of i)t[l].forEach((u,h)=>{if(!this.lossRateWindowStats[e-1][l][h]||!this.lossRateWindowStats[0][l][h])return;const f=this.lossRateWindowStats[e-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,g=this.lossRateWindowStats[e-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(s+=f,a+=g):(r+=f,c+=g),Number.isNaN(f)||Number.isNaN(f)?u.packetLostRate=0:u.packetLostRate=f<=0||g<=0?0:g/(f+g)});t.sendPacketLossRate=s<=0||a<=0?0:a/(s+a),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}}function i0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function d4(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?i0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):i0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class l4 extends kS{constructor(){super(...arguments),m(this,"_stats",ah),m(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=yr(ah);const i=e.filter(r=>r.type==="ssrc");this.processSSRCStats(i);const s=e.find(r=>r.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var i;const s=Vt(i=e.id).call(i,"send");switch("".concat(e.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const r=yr(QO);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=yr($O),a=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),a){const c=a.stats,l=Date.now()-a.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<a.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:d4({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=yr(t0);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=yr(ZO);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new K((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(r=>{s[r]=i.stat(r)}),e.push(s)}),e}}function s0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Yc(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?s0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):s0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class r0 extends kS{constructor(){super(...arguments),m(this,"_stats",ah),m(this,"report",void 0),m(this,"lastDecodeVideoReceiverStats",new Map),m(this,"lastVideoFramesRecv",new Map),m(this,"lastVideoFramesSent",new Map),m(this,"lastVideoFramesDecode",new Map),m(this,"lastVideoJBDelay",new Map),m(this,"lastAudioJBDelay",new Map),m(this,"mediaBytesSent",new Map),m(this,"mediaBytesRetransmit",new Map),m(this,"mediaBytesTargetEncode",new Map),m(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=yr(ah),this.report.forEach(t=>{switch(t.type){case ts.OUTBOUND:case ts.INBOUND:{const e=t.mediaType||t.kind,i=!e&&"frameWidth"in t,s=!e&&!("frameWidth"in t);t.type===ts.OUTBOUND?e==="audio"||s?this.processAudioOutboundStats(t):(e==="video"||i)&&this.processVideoOutboundStats(t):t.type===ts.INBOUND&&(e==="audio"||s?this.processAudioInboundStats(t):(e==="video"||i)&&this.processVideoInboundStats(t));break}case ts.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case ts.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:Yc({},vo),remote:Yc({},vo)};return t.forEach(i=>{let s;if(i.type===ts.TRANSPORT&&(s=t.get(i.selectedCandidatePairId)),i.type===ts.CANDIDATE_PAIR&&i.selected&&(s=i),s){const r=(a,c)=>{a.type=c.type,a.id=c.id,c.address&&(a.address=c.address),c.candidateType&&(a.candidateType=c.candidateType),c.port&&(a.port=c.port),c.priority&&(a.priority=c.priority),c.protocol&&(a.protocol=c.protocol),c.relayProtocol&&(a.relayProtocol=c.relayProtocol)};if(s.localCandidateId){const a=t.get(s.localCandidateId);a&&r(e.local,a)}if(s.remoteCandidateId){const a=t.get(s.remoteCandidateId);a&&r(e.remote,a)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===ts.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===ts.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===ts.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Yc({},e),Yc({},this.stats.selectedCandidatePair.localCandidate)),t.type===ts.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Yc({},e),Yc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=yr(t0),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let e=this._stats.videoRecv.find(a=>a.ssrc===t.ssrc);e||(e=yr($O),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay;const i=this.lastDecodeVideoReceiverStats.get(e.ssrc),s=this.lastVideoFramesDecode.get(e.ssrc),r=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const a=e.decodedFrame?e.decodedFrame.width:0,c=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,a,c),this.isFirstVideoDecoded[e.ssrc]=!0}if(i){const a=i.stats,c=r-i.lts;e.framesDecodeFreezeTime=a.framesDecodeFreezeTime,e.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(i.lts=Date.now(),e.framesDecodeInterval=c,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<a.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}s&&r-s.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-s.count)/((r-s.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:r,rate:e.decodeFrameRate})):s?e.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:r,rate:0}),t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:Yc({},e),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(s=>s.ssrc===t.ssrc);e||(e=yr(QO),this._stats.videoSend.push(e));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const s=new LS(10);s.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,s)}if(t.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(t.ssrc);if(s)s.add(t.retransmittedBytesSent);else{const r=new LS(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(t.ssrc);if(s)s.add(t.totalEncodedBytesTarget);else{const r=new LS(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const s=this.lastEncoderMs.get(t.ssrc);if(!s||s.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-s.lastFrameCount,a=t.totalEncodeTime-s.lastEncoderTime;e.avgEncodeMs=1e3*a/r}}if(t.framesEncoded&&t.qpSum){const s=this.lastEncoderMs.get(t.ssrc);!s||s.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-s.lastQpSum)/(t.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const s=this.findRemoteStatsId(t.ssrc,ts.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(e||(e=yr(ZO),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,ts.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}findRemoteStatsId(t,e){var i;const s=Array.from(po(i=this.report).call(i)).find(r=>r.type===e&&r.ssrc===t);return s?s.id:null}processVideoMediaSource(t,e){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(e.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,e){const i=this.report.get(t);i&&(e.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,e,i){var s,r,a,c;const l=e?this.report.get(e):void 0,u=(s=l==null?void 0:l.framesSent)!==null&&s!==void 0?s:t.framesSent;if(typeof u!="number")return;let h=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,f=(a=l==null?void 0:l.frameHeight)!==null&&a!==void 0?a:t.frameHeight,g=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof h=="number"&&typeof f=="number"||(h=0,f=0),g==null){const S=Date.now(),w=this.lastVideoFramesSent.get(i.ssrc);w&&S-w.lts>=800?(g=Math.round((u-w.count)/((S-w.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:S,rate:g})):w?g=w.rate:this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:S,rate:0})}i.sentFrame={width:h,height:f,frameRate:Math.max(0,g)}}processVideoTrackReceiverStats(t,e,i){var s,r,a,c,l;const u=e?this.report.get(e):void 0,h=(s=u==null?void 0:u.framesReceived)!==null&&s!==void 0?s:t.framesReceived,f=(r=u==null?void 0:u.frameWidth)!==null&&r!==void 0?r:t.frameWidth,g=(a=u==null?void 0:u.frameHeight)!==null&&a!==void 0?a:t.frameHeight,S=(c=u==null?void 0:u.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,w=(l=u==null?void 0:u.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof h=="number"){const I=this.lastVideoFramesRecv.get(i.ssrc),b=Date.now();i.framesReceivedCount=h;let M=0;I&&b-I.lts>=800?(M=Math.round((h-I.count)/((b-I.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:b,rate:M})):I?M=I.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:b,rate:0}),i.receivedFrame={width:f||0,height:g||0,frameRate:M||0},i.decodedFrame={width:f||0,height:g||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:f||0,height:g||0,frameRate:i.decodeFrameRate||0}}if(S&&w){const I=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let b=I.jitterBufferMs;const M=w-I.jitterBufferEmittedCount;M>0&&(b=1e3*(S-I.jitterBufferDelay)/M),i.jitterBufferMs=b,i.currentDelayMs=Math.round(b),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:w,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,e,i){var s,r,a,c;const l=e?this.report.get(e):void 0,u=(s=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&s!==void 0?s:0,h=(a=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&a!==void 0?a:0;i.aecReturnLoss=u,i.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(t,e,i){var s,r,a,c,l,u,h;const f=e?this.report.get(e):void 0,g=(s=f==null?void 0:f.removedSamplesForAcceleration)!==null&&s!==void 0?s:t.removedSamplesForAcceleration,S=(r=f==null?void 0:f.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,w=(a=f==null?void 0:f.jitterBufferDelay)!==null&&a!==void 0?a:t.jitterBufferDelay,I=(c=f==null?void 0:f.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,b=(l=f==null?void 0:f.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,M=(u=f==null?void 0:f.totalSamplesDuration)!==null&&u!==void 0?u:t==null?void 0:t.totalSamplesDuration,F=(h=f==null?void 0:f.concealedSamples)!==null&&h!==void 0?h:t.concealedSamples;if(g&&S&&(i.accelerateRate=g/S),w&&I){const Z=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let $=Z.jitterBufferMs;const W=I-Z.jitterBufferEmittedCount;W>0&&($=1e3*(w-Z.jitterBufferDelay)/W),i.jitterBufferMs=Math.round($),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:I,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=b;let V=1920;M&&S&&(V=S/M/50,i.receivedFrames=Math.round(S/V)),F&&(i.droppedFrames=Math.round(F/V))}processRemoteInboundStats(t,e){const i=this.report.get(t);i&&(e.packetsLost=i.packetsLost,i.roundTripTime&&(e.rttMs=1e3*i.roundTripTime),i.jitter&&(e.jitterMs=1e3*i.jitter),i.timestamp&&(e.timestamp=i.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const i=e.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,e=null,i=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{i=i===null?r.diffMean():i+r.diffMean()});const s=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class u4 extends kS{updateStats(){return K.resolve()}}function d_(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const r=function(){const a=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return a&&a[0]?Number(a[0].split("/")[1]):null}();return r?r<76?new l4(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new r0(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s}):function(a){return!!window.RTCStatsReport&&a.getStats()instanceof K}(n)?new r0(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new u4(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s})}function o0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function a0(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?o0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):o0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Xn extends If{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,e){super(t,e),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"remoteSDP",void 0),m(this,"initialOffer",void 0),m(this,"statsFilter",void 0),m(this,"useRTX",!1),m(this,"localCapabilities",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"establishPromise",void 0),m(this,"mutex",new qn("P2PConnection-mutex")),this.store=e,this.peerConnection=new RTCPeerConnection(Xn.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=d_(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,$e()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=Kc(t.sdp),i=wS(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:U("FILTER_VIDEO_FEC"),filterAudioFec:U("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,a0(a0({},e),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new Q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,i,s,r,a){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(l){m(this,"sessionDesc",void 0),m(this,"localCapabilities",void 0),m(this,"rtpCapabilities",void 0),m(this,"candidates",void 0),m(this,"iceParameters",void 0),m(this,"dtlsParameters",void 0),m(this,"setup",void 0),m(this,"currentMidIndex",void 0),m(this,"cname",void 0),l=Rn(l);const{remoteIceParameters:u,remoteDtlsParameters:h,candidates:f,remoteRTPCapabilities:g,remoteSetup:S,localCapabilities:w,sdkCodec:I,cname:b}=l,M=un.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=g,this.candidates=f,this.iceParameters=u,this.dtlsParameters=h,this.setup=S,this.localCapabilities=w,this.cname=b;for(let F=0;F<M.mediaDescriptions.length;F++){const V=M.mediaDescriptions[F];V.attributes.iceUfrag=u.iceUfrag,V.attributes.icePwd=u.icePwd,V.attributes.fingerprints=h.fingerprints,V.attributes.candidates=f,V.attributes.setup=S,V.media.mediaType==="video"&&(V.media.fmts=g.videoCodecs.map(Z=>Z.payloadType.toString(10)),V.attributes.payloads=g.videoCodecs,V.attributes.extmaps=g.videoExtensions),V.media.mediaType==="audio"&&(V.media.fmts=g.audioCodecs.map(Z=>Z.payloadType.toString(10)),V.attributes.payloads=g.audioCodecs,V.attributes.extmaps=g.audioExtensions),M.mediaDescriptions[F]=this.mungMediaDesc(V)}this.sessionDesc=M,this.currentMidIndex=M.mediaDescriptions.length-1}toString(){return un.print(this.sessionDesc)}send(l,u,h){const{ssrcs:f,ssrcGroups:g}=er(u,this.cname),S=this.sessionDesc.mediaDescriptions.find(b=>l===yt.VIDEO?b.media.mediaType==="video":b.media.mediaType==="audio"),w=f[0].attributes.label,I=f[0].attributes.mslabel;return S.attributes.ssrcs=S.attributes.ssrcs.concat(f),S.attributes.ssrcGroups=S.attributes.ssrcGroups.concat(g),{id:w,mslabel:I}}batchSend(l){return l.map(u=>{let{kind:h,ssrcMsg:f}=u;return this.send(h,f,void 0)})}stopSending(l){this.sessionDesc.mediaDescriptions.forEach(u=>{const h=[],f=[],g=[];u.attributes.ssrcs.forEach(S=>{Vt(l).call(l,S.attributes.label||"")?g.push(S):h.push(S)}),u.attributes.ssrcGroups.forEach(S=>{var w;Vt(w=g.map(I=>I.ssrcId)).call(w,S.ssrcIds[0])||f.push(S)}),u.attributes.ssrcs=h,u.attributes.ssrcGroups=f})}mute(l){const u=this.sessionDesc.mediaDescriptions.find(h=>h.attributes.mid===l);if(!u)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.mute."));u.attributes.direction="inactive"}unmute(l){const u=this.sessionDesc.mediaDescriptions.find(h=>h.attributes.mid===l);if(!u)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.unmute."));u.attributes.direction="sendonly"}receive(l,u,h){l.forEach((f,g)=>{const S=f._mediaStreamTrack,w=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===S.kind),I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],f);this.sessionDesc.mediaDescriptions[w]=I})}stopReceiving(l){}updateCandidates(l){l===ci.TCP?this.candidates.forEach(u=>{this.candidates.findIndex(h=>h.transport==="tcp"&&h.connectionAddress===u.connectionAddress&&h.port===u.port)===-1&&this.candidates.push(JO(JO({},u),{},{foundation:"tcpcandidate",priority:Number(u.priority)-1+"",transport:"tcp",port:Number(u.port)+90+""}))}):this.candidates=this.candidates.filter(u=>u.transport!=="tcp");for(const u of this.sessionDesc.mediaDescriptions)u.attributes.candidates=this.candidates}restartICE(l){l=Rn(l),this.iceParameters=l,this.sessionDesc.mediaDescriptions.forEach(u=>{u.attributes.iceUfrag=l.iceUfrag,u.attributes.icePwd=l.icePwd})}predictReceivingMids(l){const u=[];for(let h=0;h<l;h++)u.push((this.currentMidIndex+h+1).toString(10));return u}mungRecvMediaDsec(l,u){const h=Rn(l);return qc(h,u),NS(h,u),h}updateRecvMedia(l,u){const h=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===l);if(h!==-1){const f=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],u);this.sessionDesc.mediaDescriptions[h]=f}}bumpMid(l){this.currentMidIndex+=l}updateTrackLabel(l,u,h){const f=this.sessionDesc.mediaDescriptions.find(S=>l===yt.VIDEO?S.attributes.mid==="video":S.attributes.mid==="audio");if(f){const S=f.attributes.ssrcs.find(w=>w.attributes.label===u);var g;S&&(S.attributes.label=h,(g=S.attributes.msid)===null||g===void 0||g.replace(u,h))}}mungMediaDesc(l){const u=Rn(l);return OS(u),function(h){const f=h.attributes.extmaps.find(g=>g.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");f&&h.attributes.extmaps.splice(h.attributes.extmaps.indexOf(f),1),h.attributes.payloads.forEach(g=>{const S=g.rtcpFeedbacks.findIndex(w=>w.type==="transport-cc");S!==-1&&g.rtcpFeedbacks.splice(S,1)})}(u),u}getSSRC(l){for(const u of this.sessionDesc.mediaDescriptions)for(const h of u.attributes.ssrcs)if(h.attributes.label===l)return[h]}}({remoteIceParameters:t,remoteDtlsParameters:e,candidates:i,remoteRTPCapabilities:s.send,remoteSetup:r,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:a});const c=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(c){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}}send(t,e){var i=this;return tr(function*(){const s=yield Re(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=t.map(g=>i.peerConnection.addTrack(g._mediaStreamTrack)),a=yield Re(i.peerConnection.createOffer()),c=un.parse(a.sdp),l=t.map(g=>{const S=g._mediaStreamTrack,w=c.mediaDescriptions.find(I=>I.attributes.mid===S.kind);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,b,M){const F=I.attributes.ssrcs.filter(Z=>Z.attributes.label===b),V=I.attributes.ssrcGroups;if(F.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(V&&F.length>1){const Z=V.find($=>$.ssrcIds.indexOf(F[0].ssrcId)!==-1);return Z?[{ssrcId:Z.ssrcIds[0],rtx:M?Z.ssrcIds[1]:void 0}]:[{ssrcId:F[0].ssrcId}]}return[{ssrcId:F[0].ssrcId}]}(w,S.id,i.useRTX)});let u;try{u=yield l}catch(g){throw r.forEach(S=>{Pi()&&S.replaceTrack(null),i.peerConnection.removeTrack(S)}),g}const h=i.mungSendOfferSDP(a.sdp,t);i.remoteSDP.receive(t,e,u);const f=i.remoteSDP.toString();return yield Re(i.peerConnection.setLocalDescription({type:"offer",sdp:h})),yield Re(i.applySendEncodings(r,t)),yield Re(i.peerConnection.setRemoteDescription({type:"answer",sdp:f})),t.map((g,S)=>{const w=g._mediaStreamTrack.id;return{localSSRC:l[S],id:w}})}catch(r){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(r.toString()))}finally{s()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const e=this.peerConnection.getSenders().filter(r=>{var a;return t.indexOf(((a=r.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");e.map(r=>{Pi()&&r.replaceTrack(null),this.peerConnection.removeTrack(r)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(t,e,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:r,mslabel:a}=this.remoteSDP.send(t,e,s),c=new K((h,f)=>{const g=setTimeout(()=>{f(new Error("Cannot receive track, id: ".concat(r)))},1e4),S=w=>{const I=we();if((I.name==="Safari"&&Number(I.version)===11||Li())&&w.track.id!==r&&w.streams[0].id===a){var b;const M=w.streams[0].getTracks()[0];return(b=this.remoteSDP)===null||b===void 0||b.updateTrackLabel(t,r,w.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(g),void h(M)}if(w.track.id===r)return this.peerConnection.removeEventListener("track",S),clearTimeout(g),void h(w.track)};this.peerConnection.addEventListener("track",S)}),l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const u=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u),{track:await c,id:r}}catch(r){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getSenders().filter(i=>{var s;return t.indexOf(((s=i.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(e.length!==t.length)throw new Error("sender' length doesn't match mids' length.");e.map(i=>{if(Pi()&&i.track)i.track.enabled=!1;else{const s=i.getParameters();s.encodings.forEach(r=>r.active=!1),i.setParameters(s)}})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getSenders().filter(r=>{var a;return t.indexOf(((a=r.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(e.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");e.map(async r=>{if(Pi()&&r.track)r.track.enabled=!0;else{const a=r.getParameters();a.encodings.forEach(c=>c.active=!0),await r.setParameters(a)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(t){var e=this;return tr(function*(){const i=yield Re(e.mutex.lock("From P2PConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ke().supportPCSetConfiguration){const l=e.peerConnection.getConfiguration(),u=t===ci.RELAY?"relay":"all";l.iceTransportPolicy!==u&&(v.debug("[".concat(e.store.clientId,"] restartICE change iceTransportPolicy from [").concat(l.iceTransportPolicy,"] to [").concat(u,"]")),l.iceTransportPolicy=u,e.peerConnection.setConfiguration(l))}else if(t===ci.RELAY)return;t!==ci.RELAY&&e.remoteSDP.updateCandidates(t);const s=yield Re(e.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=Kc(s.sdp),{remoteIceParameters:a}=yield r.iceParameters;e.remoteSDP.restartICE(a);const c=e.remoteSDP.toString();yield Re(e.peerConnection.setLocalDescription(s)),yield Re(e.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(s){v.warning("[".concat(e.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[e]);this.remoteSDP.updateRecvMedia(e._mediaStreamTrack.kind,e);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,e){const i=this.peerConnection.getSenders().filter(s=>{var r;return((r=s.track)===null||r===void 0?void 0:r.id)===t});i.length===1&&await this.applySendEncodings(i,[e])}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getSenders().find(s=>{var r;return((r=s.track)===null||r===void 0?void 0:r.id)===e});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,e){throw new Q(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Q(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Vd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...Xn.turnServerConfigToIceServers(t.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...Xn.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}async updateRtpSenderEncodings(t,e){var i;if(e||(e=this.peerConnection.getSenders().find(u=>{var h;return((h=u.track)===null||h===void 0?void 0:h.id)===t._mediaStreamTrack.id})),!e)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ke().supportSetRtpSenderParameters)return v.warn("Browser not support set rtp-sender parameters");const s={},r={};if(t instanceof ae)switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(U("DSCP_TYPE")&&ba()){var a;const u=U("DSCP_TYPE");Vt(a=["very-low","low","medium","high"]).call(a,u)&&(r.networkPriority=u)}const c=e.getParameters(),l=(i=c.encodings)===null||i===void 0?void 0:i[0];l&&Object.assign(l,r),Object.assign(c,s),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await e.setParameters(c)}async applySendEncodings(t,e){try{if(!Ke().supportSetRtpSenderParameters||t.length!==e.length)return;for(let i=0;i<t.length;i++){const s=t[i],r=e[i];s&&r&&await this.updateRtpSenderEncodings(r,s)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e){const i=un.parse(t);return e.forEach((s,r)=>{const a=s._mediaStreamTrack,c=i.mediaDescriptions.find(l=>l.attributes.mid===a.kind);c&&qc(c,s)}),un.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const e=this.remoteSDP.batchSend(t).map((r,a)=>{let{id:c,mslabel:l}=r;const{kind:u}=t[a];return new K((h,f)=>{const g=setTimeout(()=>{f(new Error("Cannot receive track, id: ".concat(c)))},1e4),S=w=>{const I=we();if(I.name==="Safari"&&Number(I.version)===11&&w.track.id!==c&&w.streams[0].id===l){var b;const M=w.streams[0].getTracks()[0];return(b=this.remoteSDP)===null||b===void 0||b.updateTrackLabel(u,c,w.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(g),void h({track:M,id:c})}if(w.track.id===c)return this.peerConnection.removeEventListener("track",S),clearTimeout(g),void h({track:w.track,id:c})};this.peerConnection.addEventListener("track",S)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await K.all(e)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return e==null?void 0:e[0].ssrcId}setConfiguration(t){if(Ke().supportPCSetConfiguration){const e=Xn.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}}function nr(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("Locking from P2PConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function c0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Ha(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?c0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):c0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}tt([nr,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],Xn.prototype,"connect",null),tt([nr,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Xn.prototype,"stopSending",null),tt([nr,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",K)],Xn.prototype,"receive",null),tt([nr,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Xn.prototype,"stopReceiving",null),tt([nr,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Xn.prototype,"muteRemote",null),tt([nr,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Xn.prototype,"unmuteRemote",null),tt([nr,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Xn.prototype,"muteLocal",null),tt([nr,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Xn.prototype,"unmuteLocal",null),tt([nr,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Xn.prototype,"close",null),tt([nr,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],Xn.prototype,"updateEncoderConfig",null),tt([nr,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],Xn.prototype,"updateSendParameters",null),tt([nr,A("design:type",Function),A("design:paramtypes",[di,String]),A("design:returntype",K)],Xn.prototype,"replaceTrack",null),tt([nr,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Xn.prototype,"getRemoteSSRC",null);const ch="9",d0=4e4;function l0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function dl(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?l0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):l0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}let $n=class gh extends If{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,e;return(t=(e=this.peerConnection.getReceivers()[0])===null||e===void 0||(e=e.transport)===null||e===void 0?void 0:e.state)!==null&&t!==void 0?t:null}constructor(t,e){super(t,e),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"remoteSDP",void 0),m(this,"initialOffer",void 0),m(this,"transportEventReceiver",void 0),m(this,"statsFilter",void 0),m(this,"useXR",U("USE_XR")),m(this,"localCapabilities",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"dataStreamChannelMap",new Map),m(this,"establishPromise",void 0),m(this,"mutex",new qn("P2PConnection-mutex")),this.store=e,this.peerConnection=new RTCPeerConnection(gh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=d_(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,$e()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=Kc(t.sdp),i=await YO({filterRTX:!U("USE_PUB_RTX")&&!U("USE_SUB_RTX"),filterVideoFec:U("FILTER_VIDEO_FEC"),filterAudioFec:U("FILTER_AUDIO_FEC")},{useXR:this.useXR});return this.localCapabilities=PS(i),this.initialOffer=t,dl(dl({},e),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new Q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,i,s,r,a){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return Rn(this._localCapabilities)}get rtpCapabilities(){return Rn(this._rtpCapabilities)}get candidates(){return Rn(this._candidates)}get iceParameters(){return Rn(this._iceParameters)}get dtlsParameters(){return Rn(this._dtlsParameters)}constructor(S){m(this,"sessionDesc",void 0),m(this,"_localCapabilities",void 0),m(this,"_rtpCapabilities",void 0),m(this,"_candidates",void 0),m(this,"_iceParameters",void 0),m(this,"_dtlsParameters",void 0),m(this,"setup",void 0),m(this,"currentMidIndex",void 0),m(this,"cname",void 0),m(this,"firefoxSsrcMidMap",new Map),S=Rn(S);const{remoteIceParameters:w,remoteDtlsParameters:I,candidates:b,remoteRTPCapabilities:M,remoteSetup:F,localCapabilities:V,cname:Z}=S,$=un.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=M,this._candidates=b,this._iceParameters=w,this._dtlsParameters=I,this._localCapabilities=V,this.setup=F,this.cname=Z;const W=this.rtpCapabilities.send;for(const q of $.mediaDescriptions){if(q.attributes.iceUfrag=w.iceUfrag,q.attributes.icePwd=w.icePwd,q.attributes.fingerprints=I.fingerprints,q.attributes.candidates=b,q.attributes.setup=F,q.media.mediaType==="video"&&(q.media.fmts=W.videoCodecs.map(et=>et.payloadType.toString(10)),q.attributes.payloads=W.videoCodecs,q.attributes.extmaps=W.videoExtensions,U("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:et,ssrcGroups:_t}=er([{ssrcId:d0,rtx:U("USE_SUB_RTX")?40001:void 0}],this.cname);q.attributes.ssrcs=et,q.attributes.ssrcGroups=_t}if(q.media.mediaType==="audio"&&(q.media.fmts=W.audioCodecs.map(et=>et.payloadType.toString(10)),q.attributes.payloads=W.audioCodecs,q.attributes.extmaps=W.audioExtensions,Wa(q),U("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:et,ssrcGroups:_t}=er([{ssrcId:2e4}],this.cname);q.attributes.ssrcs=et,q.attributes.ssrcGroups=_t}}this.sessionDesc=$,this.currentMidIndex=$.mediaDescriptions.length-1}preloadRemoteMedia(){const S=U("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const w=this.candidates,I=this.dtlsParameters,b=this.iceParameters,M=this.rtpCapabilities.send;for(let F=1;F<S;F++){const V=2*F+2e4,Z=2*F+d0,{ssrcs:$,ssrcGroups:W}=er([{ssrcId:V}],this.cname),{ssrcs:q,ssrcGroups:et}=er([{ssrcId:Z,rtx:U("USE_SUB_RTX")?Z+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:ch,protos:["UDP","TLS","RTP","SAVPF"],fmts:M.videoCodecs.map(_t=>_t.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:b.iceUfrag,icePwd:b.icePwd,unrecognized:[],candidates:w,extmaps:M.videoExtensions,fingerprints:I.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:et,rtcpFeedbackWildcards:[],payloads:M.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*F)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:ch,protos:["UDP","TLS","RTP","SAVPF"],fmts:M.audioCodecs.map(_t=>_t.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:b.iceUfrag,icePwd:b.icePwd,unrecognized:[],candidates:w,extmaps:M.audioExtensions,fingerprints:I.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:W,rtcpFeedbackWildcards:[],payloads:M.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*F+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return un.print(this.sessionDesc)}send(S,w,I,b){const{ssrcs:M,ssrcGroups:F}=er(w,this.cname,U("SYNC_GROUP")?I:void 0),V=this.findPreloadMediaDesc(M);if(V){if($e()&&this.firefoxSsrcMidMap.set(M[0].ssrcId,V.attributes.mid),b&&(b.twcc||b.remb)){const Z=this.sessionDesc.mediaDescriptions.indexOf(V);return this.sessionDesc.mediaDescriptions[Z]=this.mungSendMediaDesc(V,b),{mid:V.attributes.mid,needExchangeSDP:!0}}return{mid:V.attributes.mid,needExchangeSDP:!1}}{const Z=this.findAvailableMediaIndex(S,M);let $;return Z===-1||Z===1&&(Pi()||ZI())||Z===0&&U("USE_SUB_RTX")||tb()?($=this.createOrRecycleSendMedia(S,M,F,"sendonly",b),this.updateBundleMids()):($=Rn(this.sessionDesc.mediaDescriptions[Z]),$.attributes.direction="sendonly",$.attributes.ssrcs=M,$.attributes.ssrcGroups=F,this.sessionDesc.mediaDescriptions[Z]=this.mungSendMediaDesc($,b)),$e()&&this.firefoxSsrcMidMap.set(M[0].ssrcId,$.attributes.mid),{mid:$.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:S,needExchangeSDP:w}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:S.attributes.mid,needExchangeSDP:w}}batchSend(S){const w=S.map(M=>{let{kind:F,ssrcMsg:V,mslabel:Z}=M;return this.send(F,V,Z)}),I=[];let b=!1;return w.forEach(M=>{let{mid:F,needExchangeSDP:V}=M;V&&(b=!0),I.push(F)}),{mids:I,needExchangeSDP:b}}stopSending(S){const w=this.sessionDesc.mediaDescriptions.filter(I=>I.attributes.mid&&S.indexOf(I.attributes.mid)!==-1);if(w.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");w.forEach(I=>{I.attributes.mid==="0"||$e()||tb()?I.attributes.ssrcs=[]:(I.attributes.ssrcs=[],I.attributes.direction="inactive",I.media.port="0")}),this.updateBundleMids()}mute(S){const w=this.sessionDesc.mediaDescriptions.find(I=>I.attributes.mid===S);if(!w)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.mute."));w.attributes.direction="inactive"}unmute(S){const w=this.sessionDesc.mediaDescriptions.find(I=>I.attributes.mid===S);if(!w)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.unmute."));w.attributes.direction="sendonly"}muteRemote(S){const w=this.sessionDesc.mediaDescriptions.filter(I=>Vt(S).call(S,I.attributes.mid||""));if(w.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");w.forEach(I=>{I.attributes.direction="inactive"})}unmuteRemote(S){const w=this.sessionDesc.mediaDescriptions.filter(I=>Vt(S).call(S,I.attributes.mid||""));if(w.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");w.forEach(I=>{I.attributes.direction="recvonly"})}receive(S,w,I,b){S.forEach((M,F)=>{this.createOrRecycleRecvMedia(M,[],"recvonly",w,I,b[F])}),this.updateBundleMids()}stopReceiving(S){const w=this.sessionDesc.mediaDescriptions.filter(I=>S.indexOf(I.attributes.mid)!==-1);if(w.length!==S.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");w.forEach(I=>{I.media.port="0",I.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(S){const w=this._candidates.filter(I=>I.transport==="udp");if(S===ci.TCP){if(w.length===0)return;if(U("TCP_CANDIDATE_ONLY")){const I=this._candidates.filter(b=>b.transport==="tcp");w.forEach(b=>{I.findIndex(M=>M.connectionAddress===b.connectionAddress)===-1&&I.push(Ha(Ha({},b),{},{foundation:"tcpcandidate",priority:Number(b.priority)-1+"",transport:"tcp",port:Number(b.port)+90+""}))}),this._candidates=I}else{const I=[];w.forEach(b=>{I.push(Ha(Ha({},b),{},{foundation:"tcpcandidate",priority:Number(b.priority)-1+"",transport:"tcp",port:Number(b.port)+90+""}))}),this._candidates=[...w,...I]}}else if(S===ci.RELAY){if(w.length!==0)return;{const I=this._candidates.filter(b=>b.transport==="tcp");I.forEach(b=>{w.push(Ha(Ha({},b),{},{foundation:"udpcandidate",priority:Number(b.priority)+1+"",transport:"udp",port:Number(b.port)-90+""}))}),this._candidates=[...w,...I]}}else w.length===0?(this._candidates.filter(I=>I.transport==="tcp").forEach(I=>{w.push(Ha(Ha({},I),{},{foundation:"udpcandidate",priority:Number(I.priority)+1+"",transport:"udp",port:Number(I.port)-90+""}))}),this._candidates=w):this._candidates=this._candidates.filter(I=>I.transport!=="tcp");for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}restartICE(S){S=Rn(S),this._iceParameters=S,this.sessionDesc.mediaDescriptions.forEach(w=>{w.attributes.iceUfrag=S.iceUfrag,w.attributes.icePwd=S.icePwd})}predictReceivingMids(S){const w=[];for(let I=0;I<S;I++)w.push((this.currentMidIndex+I+1).toString(10));return w}findAvailableMediaIndex(S,w){return this.sessionDesc.mediaDescriptions.findIndex(I=>{const b=I.media.mediaType===S&&I.media.port!=="0"&&(I.attributes.direction==="sendonly"||I.attributes.direction==="sendrecv")&&I.attributes.ssrcs.length===0;if($e()){if(b){const M=this.firefoxSsrcMidMap.get(w[0].ssrcId);return!(M||I.attributes.mid!=="0"&&I.attributes.mid!=="1")||!(!M||M!==I.attributes.mid)}return!1}return b})}createOrRecycleDataChannel(){for(const I of this.sessionDesc.mediaDescriptions)if(I.media.mediaType==="application")return{mediaDesc:I,needExchangeSDP:!1};this.currentMidIndex+=1;const S="".concat(this.currentMidIndex),w={media:{mediaType:"application",port:ch,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(S),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(w),{mediaDesc:w,needExchangeSDP:!0}}createOrRecycleRecvMedia(S,w,I,b,M,F){const V=S._mediaStreamTrack.kind,Z=this.rtpCapabilities.recv,$=this.localCapabilities.send;let W=[];if(V===yt.VIDEO){var q,et;if(U("H264_PROFILE_LEVEL_ID")&&b==="h264"&&(W=Z.videoCodecs.filter(ve=>{var Ue,de,Nn;return Vt(Ue=((de=ve.rtpMap)===null||de===void 0?void 0:de.encodingName.toLowerCase())||"").call(Ue,b)&&(ve==null||(Nn=ve.fmtp)===null||Nn===void 0?void 0:Nn.parameters["profile-level-id"])===U("H264_PROFILE_LEVEL_ID")})),!W||((q=W)===null||q===void 0?void 0:q.length)===0){const ve=$.videoCodecs.filter(Ue=>{var de,Nn;return Vt(de=((Nn=Ue.rtpMap)===null||Nn===void 0?void 0:Nn.encodingName.toLowerCase())||"").call(de,b)});ve.length!==0&&(W=Z.videoCodecs.filter(Ue=>ve.some(de=>de.payloadType===Ue.payloadType)))}if(U("USE_PUB_RTX")){const ve=W.map(de=>de.payloadType.toString()),Ue=Z.videoCodecs.filter(de=>{var Nn,nt;return((Nn=de.rtpMap)===null||Nn===void 0?void 0:Nn.encodingName)==="rtx"&&Vt(ve).call(ve,((nt=de.fmtp)===null||nt===void 0?void 0:nt.parameters.apt)||"")});W=[...W,...Ue]}W.length===0&&(v.warning("codec ".concat(b," not included in rtpCapabilities, fallback to default payloads: ").concat((et=Z.videoCodecs[0].rtpMap)===null||et===void 0?void 0:et.encodingName)),W=Z.videoCodecs)}else W=Z.audioCodecs.filter(ve=>{var Ue,de;return Vt(Ue=((de=ve.rtpMap)===null||de===void 0?void 0:de.encodingName.toLowerCase())||"").call(Ue,M)}),W.length===0&&(v.warning("codec ".concat(M," not included in rtpCapabilities, fallback to opus")),W=Z.audioCodecs.filter(ve=>{var Ue,de;return Vt(Ue=((de=ve.rtpMap)===null||de===void 0?void 0:de.encodingName.toLowerCase())||"").call(Ue,"opus")}));const _t=V===yt.VIDEO?Z.videoExtensions:Z.audioExtensions;this.currentMidIndex+=1;const lt="".concat(this.currentMidIndex);let Xt={media:{mediaType:V,port:ch,protos:["UDP","TLS","RTP","SAVPF"],fmts:W.map(ve=>ve.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_t,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:w,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:W,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(lt)}};Xt=this.mungRecvMediaDsec(Xt,S,F);const pe=this.findFirstClosedMedia(V);if(pe){const ve=this.sessionDesc.mediaDescriptions.indexOf(pe);this.sessionDesc.mediaDescriptions[ve]=Xt}else this.sessionDesc.mediaDescriptions.push(Xt);return Xt}createOrRecycleSendMedia(S,w,I,b,M){const F=this.rtpCapabilities.send,V=S===yt.VIDEO?F.videoCodecs:F.audioCodecs,Z=S===yt.VIDEO?F.videoExtensions:F.audioExtensions;this.currentMidIndex+=1;const $="".concat(this.currentMidIndex);let W={media:{mediaType:S,port:ch,protos:["UDP","TLS","RTP","SAVPF"],fmts:V.map(et=>et.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:w,ssrcGroups:I,rtcpFeedbackWildcards:[],payloads:V,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:b,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($)}};W=this.mungSendMediaDesc(W,M);const q=this.findFirstClosedMedia(S);if(q){const et=this.sessionDesc.mediaDescriptions.indexOf(q);this.sessionDesc.mediaDescriptions[et]=W}else this.sessionDesc.mediaDescriptions.push(W);return W}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(S=>S.media.port!=="0").map(S=>S.attributes.mid)}mungRecvMediaDsec(S,w,I){const b=Rn(S);return OS(b),qc(b,w),NS(b,w),qO(b),o_(b,I,this.localCapabilities.send),b}mungSendMediaDesc(S,w){const I=Rn(S);return o_(I,w,this.localCapabilities.recv),Wa(I),I}updateRecvMedia(S,w){const I=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===S);if(I!==-1){const b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[I],w);this.sessionDesc.mediaDescriptions[I]=b}}bumpMid(S){this.currentMidIndex+=S}findFirstClosedMedia(S){return this.sessionDesc.mediaDescriptions.find(w=>$e()?w.media.port==="0"&&w.media.mediaType===S:w.media.port==="0")}findPreloadMediaDesc(S){return this.sessionDesc.mediaDescriptions.find(w=>{var I;return((I=w.attributes)===null||I===void 0||(I=I.ssrcs[0])===null||I===void 0?void 0:I.ssrcId)===S[0].ssrcId})}getSSRC(S){var w;return(w=this.sessionDesc.mediaDescriptions.find(I=>I.attributes.mid===S))===null||w===void 0?void 0:w.attributes.ssrcs}}({remoteIceParameters:t,remoteDtlsParameters:e,candidates:i,remoteRTPCapabilities:s,remoteSetup:r,localCapabilities:this.localCapabilities,cname:a});const c=this.remoteSDP.toString(),l=un.parse(this.initialOffer.sdp),u=l.mediaDescriptions.find(S=>S.media.mediaType==="audio");u&&Wa(u),this.useXR&&c_(l);const h=un.print(l),f=this.logSDPExchange(h||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),f==null||f(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const g=this.peerConnection.getTransceivers()[0];if(g!=null&&g.receiver&&this.tryBindTransportEvents(g.receiver),U("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const S=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:S});const w=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(w)}}catch(c){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}}send(t,e,i){var s=this;return tr(function*(){const r=yield Re(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=[];t.forEach(I=>{const b=s.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});a.push(b),I._updateRtpTransceiver(b)}),$e()&&U("SIMULCAST")===!0&&(yield Re(s.applySimulcastForFirefox(a,t)));const c=yield Re(s.peerConnection.createOffer()),l=s.remoteSDP.predictReceivingMids(t.length),u=s.mungSendOfferSDP(c.sdp,t,l),h=un.parse(u),f=l.map(I=>{const b=h.mediaDescriptions.find(M=>M.attributes.mid===I);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return HO(b,U("USE_PUB_RTX"))});let g;try{g=yield f}catch(I){g=[],s.remoteSDP.receive(t,e,i,g);const b=s.remoteSDP.toString();throw yield Re(s.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Re(s.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield Re(s.stopSending(l,!0)),I}s.remoteSDP.receive(t,e,i,g);const S=s.remoteSDP.toString(),w=s.logSDPExchange(u,"offer","local","send");return yield Re(s.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Re(s.applySimulcastEncodings(a,t)),yield Re(s.applySendEncodings(a,t)),w==null||w(S),yield Re(s.peerConnection.setRemoteDescription({type:"answer",sdp:S})),a.map((I,b)=>{const M=l[b];return{localSSRC:f[b],id:M,transceiver:I}})}catch(a){throw a instanceof Q?a:new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{r()}})()}async createDataChannels(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);i&&i.readyState==="open"?v.debug("[P2PConnection] Channels are already available and can be reused directly."):(i=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:U("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)),e.forEach(r=>{r._updateOriginDataChannel(i)});const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),v.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else v.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof Q?i:new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const e=this.dataStreamChannelMap.get(t);return e==null||e.close(),void this.dataStreamChannelMap.delete(t)}catch(e){throw e instanceof Q?e:new Q(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(t,e){const i=e?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(l=>{var u;l.direction="inactive",(u=l.stop)===null||u===void 0||u.call(l)});const r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,e,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:r,needExchangeSDP:a}=this.remoteSDP.send(t,e,i,s);if(a){const l=this.remoteSDP.toString(),u=this.logSDPExchange(l,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(h.sdp,r,t);u==null||u(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find(l=>l.mid===r);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:r,transceiver:c}}catch(r){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:e,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();r==null||r(a.sdp||""),await this.peerConnection.setLocalDescription(a),v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return e.map(s=>{const r=this.peerConnection.getTransceivers().find(a=>a.mid===s);if(!r)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:r.receiver.track,id:s,transceiver:r}})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(a=>{a.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const r=this.remoteSDP.toString();s==null||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(async(a,c)=>{a.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const r=this.remoteSDP.toString();s==null||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(t){var e=this;return tr(function*(){const i=yield Re(e.mutex.lock("From P2PConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ke().supportPCSetConfiguration){const u=e.peerConnection.getConfiguration(),h=t===ci.RELAY?"relay":"all";u.iceTransportPolicy!==h&&(v.debug("[".concat(e.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(h,"]")),u.iceTransportPolicy=h,e.peerConnection.setConfiguration(u))}else if(t===ci.RELAY)return;e.remoteSDP.updateCandidates(t);const s=yield Re(e.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=Kc(s.sdp),{remoteIceParameters:a}=yield r.iceParameters;e.remoteSDP.restartICE(a);const c=e.remoteSDP.toString(),l=e.logSDPExchange(s.sdp||"","offer","local","restartICE");e.store.descriptionStart(),yield Re(e.peerConnection.setLocalDescription(s)),l==null||l(c),yield Re(e.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(s){v.warning("[".concat(e.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[e],[t]);this.remoteSDP.updateRecvMedia(t,e);const r=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),a==null||a(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,e){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(e)?$e()||await this.applySimulcastEncodings(i,[e]):await this.applySendEncodings(i,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getTransceivers().find(s=>s.mid===e);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const e=t[0].transport.iceTransport,{local:i,remote:s}=e.getSelectedCandidatePair();return{local:dl(dl({},vo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:dl(dl({},vo),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Vd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...gh.turnServerConfigToIceServers(t.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...gh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),U("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),U("ENABLE_ENCODED_TRANSFORM")&&Ke().supportWebRTCEncodedTransform&&(e.encodedInsertableStreams=!0),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(ih(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!U("FORCE_TURN_TCP")&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}tryBindTransportEvents(t){const e=t.transport;if(e){this.transportEventReceiver=t,e.onstatechange=()=>{var s;e!=null&&e.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,e.state))},e.onerror=s=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in s?s.error:s)};const i=e.iceTransport;i&&(i.onstatechange=()=>{const s=e==null?void 0:e.iceTransport.state;var r;s&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:r}=i.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,e){var i;if(e||(e=this.peerConnection.getSenders().find(h=>h.track===t._mediaStreamTrack)),!e)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ke().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},r={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var a;const{bitrateMax:h,frameRate:f,scaleResolutionDownBy:g}=t._encoderConfig;h&&(r.maxBitrate=1e3*h),Vt(a=t._hints).call(a,ze.LOW_STREAM)&&(f&&(r.maxFramerate=Vs(f)),g&&g>=1&&(r.scaleResolutionDownBy=g))}if(U("DSCP_TYPE")&&ba()){var c;const h=U("DSCP_TYPE");Vt(c=["very-low","low","medium","high"]).call(c,h)&&(r.networkPriority=h)}const l=e.getParameters(),u=(i=l.encodings)===null||i===void 0?void 0:i[0];$e()&&!u&&(s.encodings=[r]),u&&Object.assign(u,r),Object.assign(l,s),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await e.setParameters(l)}async applySendEncodings(t,e){try{if(!Ke().supportSetRtpSenderParameters||t.length!==e.length)return;for(let i=0;i<t.length;i++){const s=t[i],r=e[i];r instanceof ae&&!this.isVP8Simulcast(r)&&await this.updateRtpSenderEncodings(r,s.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e,i){const s=un.parse(t);return e.forEach((r,a)=>{const c=i[a],l=s.mediaDescriptions.find(u=>u.attributes.mid===c);l&&(qc(l,r),DS(l,r,this.store.codec))}),un.print(s)}mungReceiveAnswerSDP(t,e,i){const s=un.parse(t),r=s.mediaDescriptions.find(a=>a.attributes.mid===e);return r&&(i===yt.AUDIO&&r.media.mediaType==="audio"&&Wa(r),this.useXR&&c_(s)),un.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;(e=this.onFirstVideoDecodedTimeout)===null||e===void 0||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let l=0;l<t.length;l++){var i,s,r,a,c;const u=t[l],h=e[l];if(h instanceof ae&&!Vt(i=h._hints).call(i,ze.LOW_STREAM)&&(s=h._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((r=h._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=h._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=h._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},g={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const S=u.sender.getParameters();await u.sender.setParameters(Object.assign(S,f))}}}async applySimulcastEncodings(t,e){if(!$e()&&t.length===e.length)for(let i=0;i<t.length;i++){const s=e[i];if(s instanceof ae&&this.isVP8Simulcast(s)){const r=t[i],a={},c={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=r.sender.getParameters();await r.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var e,i,s,r,a;return!!(t instanceof ae&&U("SIMULCAST")&&this.store.codec==="vp8"&&!Vt(e=t._hints).call(e,ze.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(r=t._scalabilityMode)!==null&&r!==void 0&&r.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,e,i,s){if(U("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(e," SDP during P2PConnection.").concat(s,`
`),t),e==="offer"?r=>{this.logSDPExchange(r,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return e==null?void 0:e[0].ssrcId}setConfiguration(t){if(Ke().supportPCSetConfiguration){const e=gh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}};function Fs(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function MS(n,t){let e=document.createElement("video"),i=document.createElement("canvas");e.setAttribute("style","display:none"),i.setAttribute("style","display:none"),e.setAttribute("muted",""),e.muted=!0,e.setAttribute("autoplay",""),e.autoplay=!0,e.setAttribute("playsinline",""),i.width=Vs(t.width),i.height=Vs(t.height);const s=Vs(t.framerate||15);document.body.append(e),document.body.append(i);let r=n._mediaStreamTrack;e.srcObject=new MediaStream([r]),e.play();const a=i.getContext("2d");if(!a)throw new j(O.UNEXPECTED_ERROR,"can not get canvas context");const c=Ke(),l=i.captureStream(c.supportRequestFrame?0:s).getVideoTracks()[0];l.canvas||(l.canvas=i),i.startCapture=()=>{if(!e)return i.stopCapture&&i.stopCapture();if(e.paused&&e.play(),e.videoHeight>2&&e.videoWidth>2){const h=e.videoWidth,f=e.videoHeight/h,g=i.width*f;Math.abs(g-i.height)>=2&&(v.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(g)),i.height=g)}a.drawImage(e,0,0,i.width,i.height),l.requestFrame&&l.requestFrame(),r!==n._mediaStreamTrack&&(r=n._mediaStreamTrack,e.srcObject=new MediaStream([r]))},i.stopCapture=VT(()=>i.startCapture&&i.startCapture(),s);const u=l.stop;return l.stop=()=>{u.call(l),e&&(e.remove(),e.srcObject=null,e=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),v.debug("clean low stream renderer")},l}function u0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function h0(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?u0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):u0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}tt([Fs,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],$n.prototype,"connect",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[Object,Array]),A("design:returntype",K)],$n.prototype,"createDataChannels",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",K)],$n.prototype,"receive",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],$n.prototype,"batchReceive",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],$n.prototype,"stopReceiving",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],$n.prototype,"muteRemote",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],$n.prototype,"unmuteRemote",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],$n.prototype,"muteLocal",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],$n.prototype,"unmuteLocal",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],$n.prototype,"close",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],$n.prototype,"updateEncoderConfig",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],$n.prototype,"updateSendParameters",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[di,String]),A("design:returntype",K)],$n.prototype,"replaceTrack",null),tt([Fs,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],$n.prototype,"getRemoteSSRC",null);const p0=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,l_="9",US=2e4,xS=4e4;class h4{get localCapabilities(){return Rn(this._localCapabilities)}get rtpCapabilities(){return Rn(this._rtpCapabilities)}get candidates(){return Rn(this._candidates)}get iceParameters(){return Rn(this._iceParameters)}get dtlsParameters(){return Rn(this._dtlsParameters)}constructor(t){m(this,"sessionDesc",void 0),m(this,"_localCapabilities",void 0),m(this,"_rtpCapabilities",void 0),m(this,"_candidates",void 0),m(this,"_iceParameters",void 0),m(this,"_dtlsParameters",void 0),m(this,"setup",void 0),m(this,"currentMidIndex",void 0),m(this,"cname",void 0),m(this,"firefoxSsrcMidMap",new Map),t=Rn(t);const{remoteIceParameters:e,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:r,remoteSetup:a,localCapabilities:c,cname:l}=t,u=un.parse(p0);this._rtpCapabilities=r,this._candidates=s,this._iceParameters=e,this._dtlsParameters=i,this._localCapabilities=c,this.setup=a,this.cname=l;const h=this.rtpCapabilities.send;for(const f of u.mediaDescriptions){if(f.attributes.iceUfrag=e.iceUfrag,f.attributes.icePwd=e.icePwd,f.attributes.fingerprints=i.fingerprints,f.attributes.candidates=s,f.attributes.setup=a,f.media.mediaType==="application"&&(f.attributes.sctpPort="5000"),f.media.mediaType==="video"&&(f.media.fmts=h.videoCodecs.map(g=>g.payloadType.toString(10)),f.attributes.payloads=h.videoCodecs,f.attributes.extmaps=h.videoExtensions,U("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:g,ssrcGroups:S}=er([{ssrcId:xS,rtx:U("USE_SUB_RTX")?40001:void 0}],this.cname);f.attributes.ssrcs=g,f.attributes.ssrcGroups=S}if(f.media.mediaType==="audio"&&(f.media.fmts=h.audioCodecs.map(g=>g.payloadType.toString(10)),f.attributes.payloads=h.audioCodecs,f.attributes.extmaps=h.audioExtensions,Wa(f),U("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:g,ssrcGroups:S}=er([{ssrcId:US}],this.cname);f.attributes.ssrcs=g,f.attributes.ssrcGroups=S}}this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const e=un.parse(p0);this._rtpCapabilities=t;const i=this.rtpCapabilities.send;for(const s of e.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"&&(s.media.fmts=i.videoCodecs.map(r=>r.payloadType.toString(10)),s.attributes.payloads=i.videoCodecs,s.attributes.extmaps=i.videoExtensions,U("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:r,ssrcGroups:a}=er([{ssrcId:xS,rtx:U("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=r,s.attributes.ssrcGroups=a}if(s.media.mediaType==="audio"&&(s.media.fmts=i.audioCodecs.map(r=>r.payloadType.toString(10)),s.attributes.payloads=i.audioCodecs,s.attributes.extmaps=i.audioExtensions,U("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:r,ssrcGroups:a}=er([{ssrcId:US}],this.cname);s.attributes.ssrcs=r,s.attributes.ssrcGroups=a}}this.sessionDesc=e,this.currentMidIndex=e.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const e=this.candidates,i=this.dtlsParameters,s=this.iceParameters,r=this.rtpCapabilities.send;for(let a=1;a<t;a++){const c=2*a+US,l=2*a+xS,{ssrcs:u,ssrcGroups:h}=er([{ssrcId:c}],this.cname),{ssrcs:f,ssrcGroups:g}=er([{ssrcId:l,rtx:U("USE_SUB_RTX")?l+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:l_,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.videoCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:e,extmaps:r.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:g,rtcpFeedbackWildcards:[],payloads:r.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:l_,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.audioCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:e,extmaps:r.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:h,rtcpFeedbackWildcards:[],payloads:r.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return un.print(this.sessionDesc)}send(t,e,i,s){const{ssrcs:r,ssrcGroups:a}=er(e,this.cname,U("SYNC_GROUP")?i:void 0),c=this.findPreloadMediaDesc(r);if(c){if($e()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,c.attributes.mid),s&&(s.twcc||s.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(c,s),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(t,r);let u;return l===-1||Pi()||Li()||ZI()||l===0&&U("USE_SUB_RTX")?(u=this.createOrRecycleSendMedia(t,r,a,"sendonly",s),this.updateBundleMids()):(u=Rn(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="sendonly",u.attributes.ssrcs=r,u.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(u,s)),$e()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const e=t.map(r=>{let{kind:a,ssrcMsg:c,mslabel:l}=r;return this.send(a,c,l)}),i=[];let s=!1;return e.forEach(r=>{let{mid:a,needExchangeSDP:c}=r;c&&(s=!0),i.push(a)}),{mids:i,needExchangeSDP:s}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(i=>{i.attributes.mid==="0"||$e()||Pi()||Li()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const e=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));e.attributes.direction="inactive"}unmute(t){const e=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));e.attributes.direction="sendonly"}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>Vt(t).call(t,i.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>Vt(t).call(t,i.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,e,i,s){t.forEach((r,a)=>{this.createOrRecycleRecvMedia(r,[],"recvonly",e,i,s[a])}),this.updateBundleMids()}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===ci.TCP?this._candidates.forEach(e=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===e.connectionAddress&&i.port===e.port)===-1&&this._candidates.push(h0(h0({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}):this._candidates=this._candidates.filter(e=>e.transport!=="tcp");for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(t){t=Rn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const e=[];for(let i=0;i<t;i++)e.push((this.currentMidIndex+i+1).toString(10));return e}findAvailableMediaIndex(t,e){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if($e()){if(s){const r=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(r||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!r||r!==i.attributes.mid)}return!1}return s})}createOrRecycleRecvMedia(t,e,i,s,r,a){const c=t._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=this.localCapabilities.send;let h=[];if(c===yt.VIDEO){var f,g;if(U("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(h=l.videoCodecs.filter(M=>{var F,V,Z;return Vt(F=((V=M.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").call(F,s)&&(M==null||(Z=M.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"])===U("H264_PROFILE_LEVEL_ID")})),!h||((f=h)===null||f===void 0?void 0:f.length)===0){const M=u.videoCodecs.filter(F=>{var V,Z;return Vt(V=((Z=F.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())||"").call(V,s)});M.length!==0&&(h=l.videoCodecs.filter(F=>M.some(V=>V.payloadType===F.payloadType)))}if(U("USE_PUB_RTX")){const M=h.map(V=>V.payloadType.toString()),F=l.videoCodecs.filter(V=>{var Z,$;return((Z=V.rtpMap)===null||Z===void 0?void 0:Z.encodingName)==="rtx"&&Vt(M).call(M,(($=V.fmtp)===null||$===void 0?void 0:$.parameters.apt)||"")});h=[...h,...F]}h.length===0&&(v.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat((g=l.videoCodecs[0].rtpMap)===null||g===void 0?void 0:g.encodingName)),h=l.videoCodecs)}else h=l.audioCodecs.filter(M=>{var F,V;return Vt(F=((V=M.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").call(F,r)}),h.length===0&&(v.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),h=l.audioCodecs.filter(M=>{var F,V;return Vt(F=((V=M.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").call(F,"opus")}));const S=c===yt.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let I={media:{mediaType:c,port:l_,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:S,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};I=this.mungRecvMediaDsec(I,t,a);const b=this.findFirstClosedMedia(c);if(b){const M=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[M]=I}else this.sessionDesc.mediaDescriptions.push(I);return I}createOrRecycleSendMedia(t,e,i,s,r){const a=this.rtpCapabilities.send,c=t===yt.VIDEO?a.videoCodecs:a.audioCodecs,l=t===yt.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let h={media:{mediaType:t,port:l_,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};h=this.mungSendMediaDesc(h,r);const f=this.findFirstClosedMedia(t);if(f){const g=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[g]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,e,i){const s=Rn(t);return OS(s),qc(s,e),NS(s,e),qO(s),o_(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,e){const i=Rn(t);return o_(i,e,this.localCapabilities.recv),Wa(i),i}updateRecvMedia(t,e){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],e);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>$e()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var i;return((i=e.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var e;return(e=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||e===void 0?void 0:e.attributes.ssrcs}}function f0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function u_(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?f0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):f0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class yi extends If{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,e,i){super(t,e),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"remoteSDP",void 0),m(this,"initialOffer",void 0),m(this,"transportEventReceiver",void 0),m(this,"statsFilter",void 0),m(this,"useXR",U("USE_XR")),m(this,"localCapabilities",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"dataStreamChannelMap",new Map),m(this,"establishPromise",void 0),m(this,"mutex",new qn("NVExtentionsConnection-mutex")),m(this,"rtcMedia",void 0),this.store=e,this.peerConnection=i,this.statsFilter=d_(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,$e()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Kc(e.sdp),s=await YO({filterRTX:!U("USE_PUB_RTX")&&!U("USE_SUB_RTX"),filterVideoFec:U("FILTER_VIDEO_FEC"),filterAudioFec:U("FILTER_AUDIO_FEC")},{useXR:this.useXR});return this.localCapabilities=s,this.initialOffer=e,u_(u_({},i),{},{rtpCapabilities:s,offerSDP:e.sdp})}catch(e){throw new j(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(t,e,i,s,r,a){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new h4({remoteIceParameters:t,remoteDtlsParameters:e,candidates:i,remoteRTPCapabilities:s,remoteSetup:r,localCapabilities:PS(this.localCapabilities),cname:a});const c=this.remoteSDP.toString(),l=un.parse(this.initialOffer.sdp),u=l.mediaDescriptions.find(g=>g.media.mediaType==="audio");u&&Wa(u),this.useXR&&c_(l);const h=un.print(l),f=this.logSDPExchange(h||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),f==null||f(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(c){throw new j(O.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(c.toString()))}}async updateRemoteConnect(t){var e,i,s;(e=this.remoteSDP)===null||e===void 0||e.updateRemoteRTPCapabilities(t),(i=this.remoteSDP)===null||i===void 0||i.preloadRemoteMedia(2);const r=(s=this.remoteSDP)===null||s===void 0?void 0:s.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),v.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,e,i){var s=this;return tr(function*(){const r=yield Re(s.mutex.lock("From NVExtentionsConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const a=[];t.forEach(I=>{const b=s.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});a.push(b)}),$e()&&U("SIMULCAST")===!0&&(yield Re(s.applySimulcastForFirefox(a,t)));const c=yield Re(s.peerConnection.createOffer()),l=s.remoteSDP.predictReceivingMids(t.length),u=s.mungSendOfferSDP(c.sdp,t,l),h=un.parse(u),f=l.map(I=>{const b=h.mediaDescriptions.find(M=>M.attributes.mid===I);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return HO(b,U("USE_PUB_RTX"))});let g;try{g=yield f}catch(I){g=[],s.remoteSDP.receive(t,e,i,g);const b=s.remoteSDP.toString();throw yield Re(s.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Re(s.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield Re(s.stopSending(l,!0)),I}s.remoteSDP.receive(t,e,i,g);const S=s.remoteSDP.toString(),w=s.logSDPExchange(u,"offer","local","send");return yield Re(s.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Re(s.applySimulcastEncodings(a,t)),yield Re(s.applySendEncodings(a,t)),w==null||w(S),yield Re(s.peerConnection.setRemoteDescription({type:"answer",sdp:S})),a.map((I,b)=>{const M=l[b];return{localSSRC:f[b],id:M,transceiver:I}})}catch(a){throw a instanceof j?a:new j(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(a.toString()))}finally{r()}})()}async stopSending(t,e){const i=e?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");s.map(l=>{var u;l.direction="inactive",(u=l.stop)===null||u===void 0||u.call(l)});const r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();a==null||a(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new j(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async createDataChannels(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);return i&&i.readyState==="open"?v.debug("[P2PConnection] Channels are already available and can be reused directly."):(i=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:U("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)),void e.forEach(s=>{s._updateOriginDataChannel(i)})}catch(i){throw i instanceof j?i:new j(O.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const e=this.dataStreamChannelMap.get(t);return e==null||e.close(),void this.dataStreamChannelMap.delete(t)}catch(e){throw e instanceof j?e:new j(O.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(e.toString()))}}async receive(t,e,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:r,needExchangeSDP:a}=this.remoteSDP.send(t,e,i,s);if(a){const l=this.remoteSDP.toString(),u=this.logSDPExchange(l,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(h.sdp,r,t);u==null||u(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),v.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else v.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find(l=>l.mid===r);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:r}}catch(r){throw new j(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(r.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:e,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();r==null||r(a.sdp||""),await this.peerConnection.setLocalDescription(a),v.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else v.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return e.map(s=>{const r=this.peerConnection.getTransceivers().find(a=>a.mid===s);if(!r)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:r.receiver.track,id:s}})}catch(e){throw new j(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new j(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new j(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new j(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(a=>{a.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const r=this.remoteSDP.toString();s==null||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new j(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(async(a,c)=>{a.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const r=this.remoteSDP.toString();s==null||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new j(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(t){var e=this;return tr(function*(){const i=yield Re(e.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ke().supportPCSetConfiguration){const u=e.peerConnection.getConfiguration(),h=t===ci.RELAY?"relay":"all";u.iceTransportPolicy!==h&&(v.debug("restartICE change iceTransportPolicy from [".concat(u.iceTransportPolicy,"] to [").concat(h,"]")),u.iceTransportPolicy=h,e.peerConnection.setConfiguration(u))}else if(t===ci.RELAY)return;t!==ci.RELAY&&e.remoteSDP.updateCandidates(t);const s=yield Re(e.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=Kc(s.sdp),{remoteIceParameters:a}=yield r.iceParameters;e.remoteSDP.restartICE(a);const c=e.remoteSDP.toString(),l=e.logSDPExchange(s.sdp||"","offer","local","restartICE");yield Re(e.peerConnection.setLocalDescription(s)),l==null||l(c),yield Re(e.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(s){v.warning("restart ICE failed, abort operation",s)}finally{i()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[e],[t]);this.remoteSDP.updateRecvMedia(t,e);const r=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),a==null||a(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(i){throw new j(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,e){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(e)?$e()||await this.applySimulcastEncodings(i,[e]):await this.applySendEncodings(i,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getTransceivers().find(s=>s.mid===e);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return u_(u_({},Kc(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Vd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...yi.turnServerConfigToIceServers(t.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...yi.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),U("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(ih(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!U("FORCE_TURN_TCP")&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}async applySendEncodings(t,e){try{if(!Ke().supportSetRtpSenderParameters||t.length!==e.length)return;for(let f=0;f<t.length;f++){const g=t[f],S=e[f];if(S&&S instanceof ae){var i,s,r;if(this.isVP8Simulcast(S))continue;const w={},I={};switch(S._optimizationMode){case"motion":w.degradationPreference="maintain-framerate";break;case"detail":w.degradationPreference="maintain-resolution";break;default:w.degradationPreference="balanced"}var a,c,l,u;if((i=S._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(I.maxBitrate=1e3*((a=S._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),Vt(s=S._hints).call(s,ze.LOW_STREAM)&&((c=S._encoderConfig)!==null&&c!==void 0&&c.frameRate&&(I.maxFramerate=Vs(S._encoderConfig.frameRate)),(l=S._encoderConfig)!==null&&l!==void 0&&l.scaleResolutionDownBy&&((u=S._encoderConfig)===null||u===void 0?void 0:u.scaleResolutionDownBy)>1&&(I.scaleResolutionDownBy=S._encoderConfig.scaleResolutionDownBy)),U("DSCP_TYPE")&&ba()){var h;const F=U("DSCP_TYPE");Vt(h=["very-low","low","medium","high"]).call(h,F)&&(I.networkPriority=F)}const b=g.sender.getParameters(),M=(r=b.encodings)===null||r===void 0?void 0:r[0];$e()&&!M&&(w.encodings=[I]),M&&Object.assign(M,I),Object.assign(b,w),await g.sender.setParameters(b)}}}catch{v.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,e,i){const s=un.parse(t);return e.forEach((r,a)=>{const c=i[a],l=s.mediaDescriptions.find(u=>u.attributes.mid===c);l&&(qc(l,r),DS(l,r,this.store.codec))}),un.print(s)}mungReceiveAnswerSDP(t,e,i){const s=un.parse(t),r=s.mediaDescriptions.find(a=>a.attributes.mid===e);return r&&i===yt.AUDIO&&r.media.mediaType==="audio"&&Wa(r),this.useXR&&c_(s),un.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;(e=this.onFirstVideoDecodedTimeout)===null||e===void 0||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let l=0;l<t.length;l++){var i,s,r,a,c;const u=t[l],h=e[l];if(h instanceof ae&&!Vt(i=h._hints).call(i,ze.LOW_STREAM)&&(s=h._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((r=h._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=h._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=h._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},g={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const S=u.sender.getParameters();await u.sender.setParameters(Object.assign(S,f))}}}async applySimulcastEncodings(t,e){if(!$e()&&t.length===e.length)for(let i=0;i<t.length;i++){const s=e[i];if(s instanceof ae&&this.isVP8Simulcast(s)){const r=t[i],a={},c={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=r.sender.getParameters();await r.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var e,i,s,r,a;return!!(t instanceof ae&&U("SIMULCAST")&&this.store.codec==="vp8"&&!Vt(e=t._hints).call(e,ze.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(r=t._scalabilityMode)!==null&&r!==void 0&&r.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,e,i,s){if(U("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(e," SDP during NVExtentionsConnection.").concat(s,`
`),t),e==="offer"?r=>{this.logSDPExchange(r,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return e==null?void 0:e[0].ssrcId}setConfiguration(t){if(Ke().supportPCSetConfiguration){const e=yi.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}}function fs(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From NVExtentionsConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function _0(n){var t,e,i,s=2;for(typeof Symbol<"u"&&(e=BO,i=Symbol.iterator);s--;){if(e&&(t=n[e])!=null)return t.call(n);if(i&&(t=n[i])!=null)return new h_(t.call(n));e="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function h_(n){function t(e){if(Object(e)!==e)return K.reject(new TypeError(e+" is not an object."));var i=e.done;return K.resolve(e.value).then(function(s){return{value:s,done:i}})}return h_=function(e){this.s=e,this.n=e.next},h_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var i=this.s.return;return i===void 0?K.resolve({value:e,done:!0}):t(i.apply(this.s,arguments))},throw:function(e){var i=this.s.return;return i===void 0?K.reject(e):t(i.apply(this.s,arguments))}},new h_(n)}tt([fs,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],yi.prototype,"connect",null),tt([fs,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],yi.prototype,"updateRemoteConnect",null),tt([fs,A("design:type",Function),A("design:paramtypes",[Object,Array]),A("design:returntype",K)],yi.prototype,"createDataChannels",null),tt([fs,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",K)],yi.prototype,"receive",null),tt([fs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],yi.prototype,"batchReceive",null),tt([fs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],yi.prototype,"stopReceiving",null),tt([fs,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],yi.prototype,"muteRemote",null),tt([fs,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],yi.prototype,"unmuteRemote",null),tt([fs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],yi.prototype,"muteLocal",null),tt([fs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],yi.prototype,"unmuteLocal",null),tt([fs,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],yi.prototype,"close",null),tt([fs,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],yi.prototype,"updateEncoderConfig",null),tt([fs,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],yi.prototype,"updateSendParameters",null),tt([fs,A("design:type",Function),A("design:paramtypes",[di,String]),A("design:returntype",K)],yi.prototype,"replaceTrack",null),tt([fs,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],yi.prototype,"getRemoteSSRC",null);class jn extends If{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,e){super(t,e),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"cname",void 0),m(this,"mutex",new qn("DataChannelConnection-mutex")),m(this,"dataChannel",void 0),m(this,"_p2pConnection",void 0),m(this,"establishPromise",void 0),m(this,"_nvMedia",void 0),this.store=e,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(jn.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new yi(t,e,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const e=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(e)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,e,i,s,r,a){return this.cname=a,await this._p2pConnection.connect(t,e,i,s,r,a),await new K((c,l)=>{const u=setTimeout(()=>{this.closeSignal(),l(new j(O.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(u),void c()},this.dataChannel.onerror=h=>{this.closeSignal(),l(h)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(t,e,i){var s=this;return tr(function*(){const r=yield Re(s.mutex.lock("From DataChannelConnection.send"));try{return yield*r_(_0(s._p2pConnection.send(t,e,i)))}finally{r()}})()}async stopSending(t,e){return this._p2pConnection.stopSending(t,e)}async createDataChannels(t,e){return this._p2pConnection.createDataChannels(t,e)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,e,i,s){return this._nvMedia?(v.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,e,this.cname)):(v.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,e,i,s))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var e=this;return tr(function*(){return yield*r_(_0(e._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var e;(e=this._nvMedia)===null||e===void 0||e.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,e){return await this._p2pConnection.updateEncoderConfig(t,e)}async updateSendParameters(t,e){return await this._p2pConnection.updateSendParameters(t,e)}setStatsRemoteVideoIsReady(t,e){this._p2pConnection.setStatsRemoteVideoIsReady(t,e)}async replaceTrack(t,e){return await this._p2pConnection.replaceTrack(t,e)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,e,i,s){if(U("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(e," SDP during DataChannelConnection.").concat(s,`
`),t),e==="offer"?r=>{this.logSDPExchange(r,"answer",i==="local"?"remote":"local",s)}:void 0}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Vd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...jn.turnServerConfigToIceServers(t.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...jn.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),U("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(ih(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!U("FORCE_TURN_TCP")&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var e;return(e=this.onICEConnectionStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var e;return(e=this.onConnectionStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var e;return(e=this.onDTLSTransportStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var e;return(e=this.onDTLSTransportError)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var e;return(e=this.onICETransportStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var e;return(e=this.onFirstAudioReceived)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var e;return(e=this.onFirstVideoReceived)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var e;return(e=this.onFirstAudioDecoded)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,e,i)=>{var s;return(s=this.onFirstVideoDecoded)===null||s===void 0?void 0:s.call(this,t,e,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var e;return(e=this.onFirstVideoDecodedTimeout)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,e)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,e)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,e)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,e)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}}function ir(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From DataChannelConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function m0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function E0(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?m0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):m0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}tt([ir,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],jn.prototype,"connect",null),tt([ir,A("design:type",Function),A("design:paramtypes",[Object,Array]),A("design:returntype",K)],jn.prototype,"createDataChannels",null),tt([ir,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",K)],jn.prototype,"receive",null),tt([ir,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],jn.prototype,"stopReceiving",null),tt([ir,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],jn.prototype,"muteRemote",null),tt([ir,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],jn.prototype,"unmuteRemote",null),tt([ir,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],jn.prototype,"muteLocal",null),tt([ir,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],jn.prototype,"unmuteLocal",null),tt([ir,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],jn.prototype,"close",null),tt([ir,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],jn.prototype,"updateEncoderConfig",null),tt([ir,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],jn.prototype,"updateSendParameters",null),tt([ir,A("design:type",Function),A("design:paramtypes",[di,String]),A("design:returntype",K)],jn.prototype,"replaceTrack",null),tt([ir,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],jn.prototype,"getRemoteSSRC",null);class g0 extends Ze{constructor(){super(),m(this,"uplinkStatsUploadInterval",void 0),m(this,"uplinkRelatedStatsUploadInterval",void 0),m(this,"uplinkDenoiserStatsUploadInterval",void 0),m(this,"transportStatsUploadInterval",void 0),m(this,"uplinkExtensionStatsUploadInterval",void 0),m(this,"downlinkExtensionStatsUploadInterval",void 0),m(this,"extensionUsageStatsUploadInterval",void 0),m(this,"downlinkStatsUploadInterval",void 0),m(this,"downlinkRelatedStatsUploadInterval",void 0),m(this,"lastStats",void 0),m(this,"uploadUnplinkStarted",!1),m(this,"uploadDownlinkStarted",!1),m(this,"uploadTransportStarted",!1),m(this,"uploadExtensionUsageStarted",!1),m(this,"requestStats",void 0),m(this,"requestTransportStats",void 0),m(this,"requestLocalMedia",void 0),m(this,"requestRemoteMedia",void 0),m(this,"requestAllTracks",void 0),m(this,"requestVideoIsReady",void 0),m(this,"requestUpload",void 0)}startUploadTransportStats(t){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var e;const i=(e=this.requestStats)===null||e===void 0?void 0:e.call(this);if(i){const r=mO(i);if(t){var s;const a=(s=this.requestStats)===null||s===void 0?void 0:s.call(this,!0);if(a){const c=mO(a);r.connectionType+=c.connectionType<<3}r.connectionType+=110}else r.connectionType+=100;mr(()=>{var a;(a=this.requestUpload)===null||a===void 0||a.call(this,es.TRANSPORT_STATS,r)})}},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var e,i,s;const r=Date.now(),a={connectionInterval:U("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let c=[];const l=((e=this.requestAllTracks)===null||e===void 0?void 0:e.call(this))||[];for(const g of l)!g.muted&&g.enabled&&(c=c.concat(await g.getProcessorUsage()));const u=((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[];for(const[g,S]of u)S.has(yt.VIDEO)&&g.videoTrack&&(c=c.concat(await g.videoTrack.getProcessorUsage())),S.has(yt.AUDIO)&&g.audioTrack&&(c=c.concat(await g.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(g,S){const w={};for(const{id:F,value:V,level:Z,direction:$}of g){var I;const W=(I=S.get(F))!==null&&I!==void 0?I:0,q=V===2?W+U("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:W;var b,M;S.set(F,q),w[F]?(V===2&&(w[F].value=V),Z>w[F].level&&(w[F].level=Z),$==="remote"&&(w[F].remoteUidCount+=1),w[F].totalTs=(b=S.get(F))!==null&&b!==void 0?b:0):w[F]={value:V,level:Z,remoteUidCount:$==="local"?0:1,totalTs:(M=S.get(F))!==null&&M!==void 0?M:0}}return Object.keys(w).map(F=>{const{level:V,value:Z,totalTs:$}=w[F];return{id:F,level:V,value:Z,totalTs:$}})}(c,t);const h=Date.now(),f=h>r?h:r+1;(s=this.requestUpload)===null||s===void 0||s.call(this,es.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:f})},U("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);e&&(this.uploadUplinkStats(e),this.lastStats=e)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);e&&this.uploadRelatedUplinkStats(e,this.lastStats),this.lastStats=e},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);e&&this.uploadDenoiserStats(e)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);e&&this.uploadExtensionStats(e)},2e3))}uploadUplinkStats(t){var e;(((e=this.requestLocalMedia)===null||e===void 0?void 0:e.call(this))||[]).forEach(i=>{let[s,{track:r,ssrcs:a}]=i;switch(s){case it.LocalVideoLowTrack:case it.LocalVideoTrack:{const c=function(h,f,g){var S;const w=f.videoSend.find(b=>b.ssrc===h);if(!w)return null;const I={id:Be(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:w.ssrc.toString()};switch(I.A_vstd=g._originMediaStreamTrack&&!g._originMediaStreamTrack.enabled||g._mediaStreamTrack&&!g._mediaStreamTrack.enabled?"1":"0",w.sentFrame&&(I.A_fhs=w.sentFrame.height.toString(),I.A_frs=w.sentFrame.frameRate.toString(),I.A_fws=w.sentFrame.width.toString()),w.adaptionChangeReason){case"none":I.A_ac="0";break;case"cpu":I.A_ac="1";break;case"bandwidth":I.A_ac="2";break;case"other":I.A_ac="3"}return I.A_lvps=UT[g._player?g._player.videoElementStatus:"uninit"].toString(),I.A_nr=(S=w.nacksCount)===null||S===void 0?void 0:S.toString(),w.avgEncodeMs&&(I.A_aem=w.avgEncodeMs.toFixed(0).toString()),U("P2P")&&(w.bytes&&(I.bytesSent=w.bytes.toString()),typeof w.packetsLost=="number"&&(I.packetsLost=w.packetsLost.toString()),w.packets&&(I.packetsSent=w.packets.toString())),I}(a[0].ssrcId,t,r),l=s===it.LocalVideoTrack?function(h,f,g){var S,w,I,b,M,F,V,Z;const $=f.videoSend.find(lt=>lt.ssrc===h);if(!$)return null;const W={id:Be(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:$.ssrc.toString()},q=(S=(w=(I=$.inputFrame)===null||I===void 0?void 0:I.height)!==null&&w!==void 0?w:g==null?void 0:g._videoHeight)!==null&&S!==void 0?S:0,et=(b=(M=(F=$.inputFrame)===null||F===void 0?void 0:F.width)!==null&&M!==void 0?M:g==null?void 0:g._videoWidth)!==null&&b!==void 0?b:0,_t=(V=(Z=$.inputFrame)===null||Z===void 0?void 0:Z.frameRate)!==null&&V!==void 0?V:0;return q&&(W.A_fhi=q+""),et&&(W.A_fwi=et+""),_t&&(W.A_fri=_t+""),W}(a[0].ssrcId,t,r):null;c&&mr(()=>{var h;return(h=this.requestUpload)===null||h===void 0?void 0:h.call(this,es.PUBLISH_STATS,{stream_type:s===it.LocalVideoLowTrack?"low":"high",stats:E0(E0({},c),l)})});const u=function(h){const f={id:"bweforvideo",timestamp:new Date(h.timestamp).toISOString(),type:"VideoBwe"};return h.bitrate.retransmit&&(f.A_rb=h.bitrate.retransmit.toString()),h.bitrate.targetEncoded&&(f.A_teb=h.bitrate.targetEncoded.toString()),f.A_aeb=h.bitrate.actualEncoded.toString(),f.A_tb=h.bitrate.transmit.toString(),h.sendBandwidth!==void 0&&(f.A_asb=h.sendBandwidth.toString()),f}(t);u&&setTimeout(()=>{var h;return(h=this.requestUpload)===null||h===void 0?void 0:h.call(this,es.PUBLISH_STATS,{stream_type:s===it.LocalVideoLowTrack?"low":"high",stats:u})},1e3);break}case it.LocalAudioTrack:{const c=function(l,u,h){const f=u.audioSend.find(S=>S.ssrc===l);if(!f)return null;const g={id:Be(10,""),timestamp:new Date(u.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:f.ssrc.toString()};return g.A_astd=h._originMediaStreamTrack&&!h._originMediaStreamTrack.enabled||h._mediaStreamTrack&&!h._mediaStreamTrack.enabled?"1":"0",f.inputLevel?g.A_ail=Math.round(100*f.inputLevel).toString():g.A_ail=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),g.A_apil=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),f.aecReturnLoss&&(g.A_ecrl=Math.round(f.aecReturnLoss).toString()),f.aecReturnLossEnhancement&&(g.A_ecrle=Math.round(f.aecReturnLossEnhancement).toString()),U("P2P")&&(f.bytes&&(g.bytesSent=f.bytes.toString()),typeof f.packetsLost=="number"&&(g.packetsLost=f.packetsLost.toString()),f.packets&&(g.packetsSent=f.packets.toString())),g}(a[0].ssrcId,t,r);c&&mr(()=>{var l;return(l=this.requestUpload)===null||l===void 0?void 0:l.call(this,es.PUBLISH_STATS,{stream_type:"high",stats:c})});break}}})}uploadRelatedUplinkStats(t,e){var i;(((i=this.requestLocalMedia)===null||i===void 0?void 0:i.call(this))||[]).filter(s=>{let[r]=s;return r===it.LocalVideoLowTrack||r===it.LocalVideoTrack}).forEach(s=>{let[r,{ssrcs:a}]=s;const c=function(l,u){const h=u.videoSend.find(f=>f.ssrc===l);return h?{mediaType:"video",isVideoMute:!1,frameRateInput:h.inputFrame&&h.inputFrame.frameRate.toString(),frameRateSent:h.sentFrame&&h.sentFrame.frameRate.toString(),googRtt:h.rttMs.toString(),qpSumPerFrame:Math.floor(h.qpSumPerFrame).toString()}:null}(a[0].ssrcId,t);c&&mr(()=>{var l;(l=this.requestUpload)===null||l===void 0||l.call(this,es.PUBLISH_RELATED_STATS,{stream_type:r===it.LocalVideoLowTrack?"low":"high",stats:c})})})}uploadDenoiserStats(t){for(let r=0;r<t.length;r++){const a=t[r];if(a instanceof Ma){var e,i,s;const c=(e=(i=a._external).getDenoiserStats)===null||e===void 0?void 0:e.call(i);return void(c&&((s=this.requestUpload)===null||s===void 0||s.call(this,es.DENOISER_STATS,c)))}}}uploadExtensionStats(t){for(let e=0;e<t.length;e++)t[e].getProcessorStats().forEach(i=>{var s;(s=this.requestUpload)===null||s===void 0||s.call(this,i.type,i.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this,!0);s&&(this.uploadDownlinkStats(s,e,t),t=s),e=!e},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this,!0);s&&(this.uploadRelatedDownlinkStats(s,this.lastStats),this.lastStats=s)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this);s&&this.uploadDownlinkExtensionStats(s)},2e3)}uploadDownlinkStats(t,e,i){var s;(((s=this.requestRemoteMedia)===null||s===void 0?void 0:s.call(this))||[]).forEach(r=>{let[a,c]=r;if(c.has(yt.VIDEO)&&a.videoTrack){const l=a.videoTrack?function(u,h,f,g,S){const w=h.videoRecv.find(F=>F.ssrc===u);if(!w)return null;const I={id:Be(10,""),timestamp:new Date(h.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:w.ssrc.toString()};var b,M;if(I.bytesReceived=w.bytes.toString(),I.packetsLost=w.packetsLost.toString(),I.packetsReceived=w.packets.toString(),w.framesRateFirefox&&(I.A_frr=w.framesRateFirefox.toString()),w.receivedFrame?(I.A_frr=w.receivedFrame.frameRate.toString(),I.A_fhr=w.receivedFrame.height.toString(),I.A_fwr=w.receivedFrame.width.toString()):(I.A_fhr=(b=g._videoHeight)===null||b===void 0?void 0:b.toString(),I.A_fwr=(M=g._videoWidth)===null||M===void 0?void 0:M.toString()),I.A_frd=w.decodeFrameRate.toString(),w.outputFrame&&(I.A_fro=w.outputFrame.frameRate.toString()),w.jitterBufferMs!==void 0&&(I.A_jbm=Math.floor(w.jitterBufferMs).toString()),w.currentDelayMs!==void 0&&(I.A_cdm=Math.floor(w.currentDelayMs).toString()),I.A_fs=w.firsCount.toString(),I.A_ns=w.nacksCount.toString(),I.A_ps=w.plisCount.toString(),g&&(I.A_vrtd=g._originMediaStreamTrack.enabled&&g._mediaStreamTrack.enabled?"0":"1"),g._player&&g._player.freezeTimeCounterList.length>0&&(I.A_vrft=Math.round(g._player.freezeTimeCounterList.splice(0,1)[0]).toString()),S&&g._player&&$o.visibility==="visible"){const F=Math.min(6e3,g._player.renderFreezeAccTime);I.A_vrrft=Math.round(F).toString(),g._player.renderFreezeAccTime=Math.max(0,g._player.renderFreezeAccTime-F)}if(I.A_rvps=UT[g._player?g._player.videoElementStatus:"uninit"].toString(),f){const F=f.videoRecv.find(V=>V.ssrc===u);if(F&&w.totalInterFrameDelay!==void 0&&w.totalSquaredInterFrameDelay!==void 0&&F.totalInterFrameDelay!==void 0&&F.totalSquaredInterFrameDelay!==void 0){const V=w.totalInterFrameDelay-F.totalInterFrameDelay,Z=w.totalSquaredInterFrameDelay-F.totalSquaredInterFrameDelay,$=w.framesDecodeCount-F.framesDecodeCount,W=V/$*1e3,q=Math.round(1e3*Math.sqrt((Z-Math.pow(V,2)/$)/$));!isNaN(q)&&W+q>Math.max(3*W,W+150)&&(I.A_ifdsd=q.toString())}}return I}(a._videoSSRC,t,i,a.videoTrack,e):void 0;l&&mr(()=>{var u;return(u=this.requestUpload)===null||u===void 0?void 0:u.call(this,es.SUBSCRIBE_STATS,{stream_id:a.uid,stats:l})})}if(c.has(yt.AUDIO)&&a.audioTrack){const l=a.audioTrack?function(u,h,f,g){const S=h.audioRecv.find(I=>I.ssrc===u);if(!S)return null;const w={id:Be(10,""),timestamp:new Date(h.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:S.ssrc.toString()};if(w.bytesReceived=S.bytes.toString(),w.packetsLost=S.packetsLost.toString(),w.packetsReceived=S.packets.toString(),S.outputLevel?w.A_aol=Math.round(100*S.outputLevel).toString():w.A_aol=Math.round(100*g._source.getAccurateVolumeLevel()).toString(),w.A_apol=Math.round(100*g._source.getAccurateVolumeLevel()).toString(),g&&(w.A_artd=g._originMediaStreamTrack.enabled&&g._mediaStreamTrack.enabled?"0":"1"),w.A_jr=S.jitterMs.toString(),w.A_jbm=Math.floor(S.jitterBufferMs).toString(),w.A_cdm=Math.floor(S.jitterBufferMs).toString(),w.A_raps=UT[ps.getPlayerState(g.getTrackId())].toString(),f){const I=f.audioRecv.find(b=>b.ssrc===u);if(I){const b=S.concealedSamples-I.concealedSamples;b>0&&(w.A_cs=Math.round(b).toString())}}return w}(a._audioSSRC,t,i,a.audioTrack):void 0;l&&mr(()=>{var u;return(u=this.requestUpload)===null||u===void 0?void 0:u.call(this,es.SUBSCRIBE_STATS,{stream_id:a.uid,stats:l})})}})}uploadRelatedDownlinkStats(t,e){var i;(((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[]).forEach(s=>{let[r,a]=s;if(a.has(yt.VIDEO)&&r.videoTrack){var c;const l=(r._videoSSRC&&((c=this.requestVideoIsReady)===null||c===void 0?void 0:c.call(this,r._videoSSRC))||!1)===!0,u=function(h,f,g,S,w,I){const b=g.videoRecv.find(Z=>Z.ssrc===h),M=w?w.videoRecv.find(Z=>Z.ssrc===h):void 0;if(!b)return null;const F=ol.isRemoteVideoFreeze(I,b,M)&&f,V={mediaType:"video",isVideoMute:!1,peerId:S,frameRateReceived:b.receivedFrame&&b.receivedFrame.frameRate.toString(),frameRateDecoded:b.decodedFrame&&b.decodedFrame.frameRate.toString(),isFreeze:F,bytesReceived:b.bytes.toString(),packetsReceived:b.packets.toString(),packetsLost:b.packetsLost.toString(),qpSumPerFrame:Math.floor(b.qpSumPerFrame).toString()};return b.framesRateFirefox&&(V.frameRateDecoded=b.framesRateFirefox.toString(),V.frameRateReceived=b.framesRateFirefox.toString()),V}(r._videoSSRC,l,t,r.uid,e,r.videoTrack);u&&mr(()=>{var h;(h=this.requestUpload)===null||h===void 0||h.call(this,es.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:u})})}if(a.has(yt.AUDIO)&&r.audioTrack){const l=function(u,h,f,g){const S=h.audioRecv.find(I=>I.ssrc===u);if(!S)return null;const w=ol.isRemoteAudioFreeze(g);return{mediaType:"audio",isAudioMute:!1,peerId:f,googJitterReceived:S.jitterMs.toString(),isFreeze:w,bytesReceived:S.bytes.toString(),packetsReceived:S.packets.toString(),packetsLost:S.packetsLost.toString(),frameReceived:S.receivedFrames.toString(),frameDropped:S.droppedFrames.toString()}}(r._audioSSRC,t,r.uid,r.audioTrack);l&&mr(()=>{var u;(u=this.requestUpload)===null||u===void 0||u.call(this,es.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:l})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(t){t.forEach(e=>{let[i,s]=e;s.has(yt.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(r=>{var a;(a=this.requestUpload)===null||a===void 0||a.call(this,r.type,r.stats)}),s.has(yt.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(r=>{var a;(a=this.requestUpload)===null||a===void 0||a.call(this,r.type,r.stats)})})}}function T0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Ka(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?T0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):T0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function S0(n){var t,e,i,s=2;for(typeof Symbol<"u"&&(e=BO,i=Symbol.iterator);s--;){if(e&&(t=n[e])!=null)return t.call(n);if(i&&(t=n[i])!=null)return new p_(t.call(n));e="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function p_(n){function t(e){if(Object(e)!==e)return K.reject(new TypeError(e+" is not an object."));var i=e.done;return K.resolve(e.value).then(function(s){return{value:s,done:i}})}return p_=function(e){this.s=e,this.n=e.next},p_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var i=this.s.return;return i===void 0?K.resolve({value:e,done:!0}):t(i.apply(this.s,arguments))},throw:function(e){var i=this.s.return;return i===void 0?K.reject(e):t(i.apply(this.s,arguments))}},new p_(n)}class oi extends Ze{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(xt.StateChange,e,this._state)}constructor(t,e){super(),m(this,"store",void 0),m(this,"statsUploader",void 0),m(this,"connection",void 0),m(this,"localTrackMap",new Map),m(this,"remoteUserMap",new Map),m(this,"localDataChannels",[]),m(this,"remoteDataChannelMap",new Map),m(this,"pendingLocalTracks",[]),m(this,"pendingRemoteTracks",[]),m(this,"pendingLocalDataChannels",[]),m(this,"pendingRemoteDataChannels",[]),m(this,"statsCollector",void 0),m(this,"isPlanB",!1),m(this,"shouldForwardP2PCreation",void 0),m(this,"iceFailedCount",0),m(this,"dtlsFailedCount",0),m(this,"mutex",new qn("P2PChannel-mutex")),m(this,"_state",Te.Disconnected),m(this,"_pcStatsUploadType",U("NEW_ICE_RESTART")?Vr.FIRST_CONNECTION:Vr.OLD_FIRST_CONNECTION),m(this,"_isInRestartIce",!1),m(this,"_isStartRestartIce",!1),m(this,"_restartStates",["disconnected","failed"]),m(this,"_restartTimer",void 0),m(this,"_isFirstConnected",!0),m(this,"handleMuteLocalTrack",async(i,s,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Te.Connected)return void r(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(i);if(c.length===0)return void s();const l=c.find(h=>h[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(h=>{let[,{id:f}]=h;return f}));const u=this.createMuteMessage(c);await He(this,xt.RequestMuteLocal,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleUnmuteLocalTrack",async(i,s,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Te.Connected)return void r(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void s();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];if(h.track._originMediaStreamTrack.stop(),!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding){const f=i._mediaStreamTrack.clone();h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f}else{const f=MS(i,zo(this,xt.RequestLowStreamParameter));h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f}await new K((f,g)=>{this.handleReplaceTrack(h.track,f,g,!0)})}await this.connection.unmuteLocal(c.map(h=>{let[,{id:f}]=h;return f}));const u=this.createUnmuteMessage(c);await He(this,xt.RequestUnmuteLocal,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleUpdateVideoEncoder",async(i,s,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const c=this.localTrackMap.get(it.LocalVideoTrack);if(!this.connection||!c||c.track!==i||this.state!==Te.Connected)return void s();const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),await this.connection.updateEncoderConfig(l,u),this.emit(xt.UpdateVideoEncoder,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleSetOptimizationMode",async(i,s,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const c=this.localTrackMap.get(it.LocalVideoTrack);if(!this.connection||!c||c.track!==i||this.state!==Te.Connected)return;const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleReplaceTrack",async(i,s,r,a)=>{let c;v.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:g}]=f;return i===g});if(!this.connection||!h||this.state!==Te.Connected)return void s();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),this.isPlanB){const f=h[1];f.id=i._mediaStreamTrack.id,this.localTrackMap.set(h[0],f)}if(h[0]===it.LocalVideoTrack&&!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding){const f=this.localTrackMap.get(it.LocalVideoLowTrack);if(f){const g=i._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=g,f.track._originMediaStreamTrack=g,await new K((S,w)=>{this.handleReplaceTrack(f.track,S,w,!0)})}}s()}catch(h){r(h)}finally{var u;(u=c)===null||u===void 0||u()}}),m(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),m(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),m(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),m(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new g0,this.bindStatsUploaderEvents(),this.isPlanB=!Ke().supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&ba(),this.shouldForwardP2PCreation=U("FORWARD_P2P_CREATION")&&Ke().supportPCSetConfiguration&&function(){const i=nf();return i===Kn.ANDROID||i===Kn.IOS||i===Kn.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new jn({},this.store):this.isPlanB?new Xn({},this.store):new $n({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,e){var i;this.state=Te.New;const s=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new jn(t,this.store):this.isPlanB?new Xn(t,this.store):new $n(t,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=U("NEW_ICE_RESTART")?Vr.FIRST_CONNECTION:Vr.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t,e,i,s,r,a){if(!this.connection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof jn?this.connection.updateRemoteConnect(s):(this.store.peerConnectionStart(),await this.connection.connect(t,e,i,s,r,a),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Te.Connected)}async preConnect(t,e,i,s,r,a){if(!this.connection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const c=await this.connection.connect(t,e,i,s,r,a);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Te.Connected,c}getEstablishParams(){if(this.connection instanceof jn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(t){if(!this.connection){if(this.state===Te.Disconnected)throw new Q(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const i=t.filter(s=>this.pendingLocalDataChannels.findIndex(r=>r.id===s.id)!==-1);return void(this.pendingLocalDataChannels=this.pendingLocalDataChannels.concat(i))}const e=this.filterTobePublishedDataChannels(t);e.length!==0&&(e.forEach(i=>{const s=Date.now();this.store.publish(i.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(i=>{this.localDataChannels.push(i);const s=Date.now();this.store.publish(i.id+"","datachannel",void 0,s)}))}publish(t,e,i){var s=this;return tr(function*(){const r=yield Re(s.mutex.lock("From P2PChannel.publish"));try{if(!s.connection||s.state!==Te.Connected){if(s.state===Te.Disconnected)throw new Q(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(t);const c=t.filter(l=>s.pendingLocalTracks.indexOf(l)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(c))}s.store.pubId=s.store.pubId+1,li.markPublishStart(s.store.clientId,s.store.pubId);const a=s.filterTobePublishedTracks(t,e,i);if(a.length===0)return void(yield Re(s.tryToUnmuteAudio(t)));yield*r_(S0(s.doPublish(s.connection,a)))}finally{r()}})()}doPublish(t,e){var i=this;return tr(function*(){e.forEach(h=>{let{track:f,type:g}=h;const S=Date.now();i.store.publish(f.getTrackId(),g===it.LocalAudioTrack?"audio":"video",S)}),i.bindLocalTrackEvents(e);const s=yield Re(t.send(e.map(h=>{let{track:f}=h;return f}),i.store.codec,i.store.audioCodec)),r=(yield Re(s.next())).value,a=i.createGatewayPublishMessage(e,r);let c;try{c=yield a}catch(h){throw s.throw(h),(h==null?void 0:h.code)===O.WS_ABORT&&e.forEach(f=>{let{track:g}=f;i.pendingLocalTracks.indexOf(g)===-1&&i.pendingLocalTracks.push(g)}),i.unbindLocalTrackEvents(e),h}const l=i.mapPubResToRemoteConfig(a,c),u=(yield Re(s.next(l))).value;e.forEach(h=>{let{type:f}=h;i.statsCollector.addLocalStats(f)}),i.assignLocalTracks(e,u),i.statsUploader.startUploadUplinkStats(),e.forEach(h=>{let{track:f,type:g}=h;const S=Date.now();i.store.publish(f.getTrackId(),g===it.LocalAudioTrack?"audio":"video",void 0,S)})})()}async updateVideoStreamParameter(t,e){const i=this.localTrackMap.get(e);if(!i)return;if(!(i.track instanceof ae))return v.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof $n||this.connection instanceof Xn))return v.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:s}=i,r=function(a,c){const l={};return a.height&&a.width&&(l.scaleResolutionDownBy=ES(a,c)),l.maxFramerate=a.framerate?Vs(a.framerate):void 0,l.maxBitrate=a.bitrate?1e3*a.bitrate:void 0,l}(t,s);if(s._encoderConfig||(s._encoderConfig={}),e!==it.LocalVideoLowTrack||!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const a=s._originMediaStreamTrack;if(!a.canvas)return v.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(c,l){const u=c.canvas;l.width&&(u.width=Vs(l.width)),l.height&&(u.height=Vs(l.height)),l.framerate&&(u.stopCapture&&u.stopCapture(),u.stopCapture=VT(()=>{!u.startCapture&&u.stopCapture&&u.stopCapture(),u.startCapture&&u.startCapture()},Vs(l.framerate)))})(a,t)}r.maxBitrate!=null&&(s._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=r.maxFramerate:s._encoderConfig.frameRate={max:r.maxFramerate}),v.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(t){var e=this;return tr(function*(){if(!e.connection||e.state!==Te.Connected)return;const i=yield Re(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(it.LocalVideoTrack);if(!r)throw new Q(O.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(it.LocalVideoLowTrack))throw new Q(O.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:e.getLowVideoTrack(r.track,t),type:it.LocalVideoLowTrack}];if(yield*r_(S0(e.doPublish(e.connection,a))),r.track.muted||!r.track.enabled){var s;const c=(s=e.localTrackMap.get(it.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;c!==void 0&&(yield Re(e.connection.muteLocal([c])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await rn(this,xt.RequestRePublish,this.pendingLocalTracks),this.emit(xt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(v.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await rn(this,xt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:i,kind:s}=this.pendingRemoteTracks[e];(s!==yt.AUDIO||i._audio_added_&&i._audioSSRC)&&(s!==yt.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await rn(this,xt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:i}of this.pendingRemoteTracks)await this.subscribe(e,i,i===yt.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:i}=e;this.emit(xt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Te.Connected)return void t.forEach(s=>{const r=this.pendingLocalTracks.indexOf(s);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const i=e.find(s=>s[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Te.Connected)return void t.forEach(i=>{const s=this.pendingLocalDataChannels.indexOf(i);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(i=>{const s=this.localDataChannels.indexOf(i);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Te.Connected)return;const t=this.localTrackMap.get(it.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[it.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const i=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(s=>{let[,{id:r}]=s;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(s=>{let[r,{track:a}]=s;return{type:r,track:a}})),e.forEach(s=>{let[r]=s;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),i}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Te.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=e.filter(s=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(s.id))});if(i.length!==0)return await this.connection.createDataChannels(t.uid,i),i.forEach(s=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(s.id,s):this.remoteDataChannelMap.set(t,new Map([[s.id,s]]));const a=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:u}=c;return l.uid===t.uid&&u===s.id});a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),i.map(s=>s.id)}async subscribe(t,e,i,s,r){var a;if(!this.connection||this.state!==Te.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(t))!==null&&a!==void 0&&a.has(e))return;let c,l,u;if(r){const g=r.find(w=>{let{stream_type:I}=w;return I===e});if(!g)throw new Q(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const S=await this.connection.receive(e,g.ssrcs,String(t._uintid),g.attributes);this.connection instanceof $n&&(u=S.transceiver),c=S.track,l=S.id}else{const g=await this.connection.receive(e,[{ssrcId:i,rtx:s}],String(t._uintid),void 0);this.connection instanceof $n&&(u=g.transceiver),c=g.track,l=g.id}e===yt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new Tr(c,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),u&&t._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new mo(c,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),u&&t._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._videoTrack));const h=this.remoteUserMap.get(t);h?h.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats();const f=this.pendingRemoteTracks.findIndex(g=>{let{user:S,kind:w}=g;return S.uid===t.uid&&e===w});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(xt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Te.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(i=>{var s;let{user:r,mediaType:a}=i;return!((s=this.remoteUserMap.get(r))!==null&&s!==void 0&&s.has(a))});const e=await this.connection.batchReceive(t.map(i=>{let{user:s,mediaType:r,ssrcId:a,rtxSsrcId:c}=i;return{kind:r,ssrcMsg:[{ssrcId:a,rtx:c}],mslabel:String(s._uintid)}}));t.forEach((i,s)=>{let{user:r,mediaType:a}=i;const{track:c,id:l,transceiver:u}=e[s];a===yt.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(c):(r._audioTrack=new Tr(c,r.uid,r._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),u&&r._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(c):(r._videoTrack=new mo(c,r.uid,r._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),u&&r._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(r,r._videoTrack));const h=this.remoteUserMap.get(r);h?h.set(a,l):this.remoteUserMap.set(r,new Map([[a,l]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadDownlinkStats();const f=this.pendingRemoteTracks.findIndex(g=>{let{user:S,kind:w}=g;return S.uid===r.uid&&a===w});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(xt.MediaReconnectEnd,r.uid))})}async unsubscribe(t,e,i){const s=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return e!==void 0?l.uid===t.uid&&e===u:l.uid===t.uid});if(s.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Te.Connected||i||s.forEach(c=>{let{kind:l}=c;var u;if(l===yt.AUDIO)(u=t._audioTrack)===null||u===void 0||u._destroy(),t._audioTrack=void 0;else if(l===yt.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Te.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const a=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),r.forEach(c=>{let[l,{kind:u}]=c;var h,f;if(u===yt.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===yt.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),i||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(u===yt.AUDIO){var g;this.unbindRemoteTrackEvents(l._audioTrack),!i&&((g=l._audioTrack)===null||g===void 0||g._destroy(),l._audioTrack=void 0)}}),a}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const a=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(t,e);if(i.length===0)return;e.forEach(r=>{r._close()});const s=this.remoteDataChannelMap.get(t);return i.forEach(r=>{s&&s.delete(r.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),i.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:a}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return a!==void 0?u.uid===r.uid&&a===h:u.uid===r.uid});c.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),e=e.concat(c)}if(!this.connection||this.state!==Te.Connected)return void e.forEach(r=>{let{user:a,kind:c}=r;var l;if(c===yt.AUDIO)(l=a._audioTrack)===null||l===void 0||l._destroy(),a._audioTrack=void 0;else if(c===yt.VIDEO){var u;(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0}});const i=Nc(t).call(t,(r,a)=>{let{user:c,mediaType:l}=a;const u=this.filterTobeUnSubscribedTracks(c,l);return r.concat(u)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(r=>{let[,{id:a}]=r;return a}));const s=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),i.forEach(r=>{let[a,{kind:c}]=r;var l,u;if(c===yt.VIDEO&&a._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===yt.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0;else if(c===yt.AUDIO){var h;this.unbindRemoteTrackEvents(a._audioTrack),(h=a._audioTrack)===null||h===void 0||h._destroy(),a._audioTrack=void 0}}),s}async muteRemote(t,e){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(e))return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const s=e===yt.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(e)||v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(it.LocalAudioTrack);if((e==null?void 0:e.track)instanceof bn){const i=e.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[r]=s;return r!==it.LocalAudioTrack}).filter(s=>{let[r]=s;return!(t&&r===it.LocalVideoLowTrack)}).map(s=>{let[,{track:r}]=s;return r}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===it.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,i,s,r){if(t){const c=this.localTrackMap.get(it.LocalAudioTrack),l=s?this.localTrackMap.get(it.LocalVideoLowTrack):this.localTrackMap.get(it.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;i||(i=[]);const c=i.find(u=>u instanceof Oe),l=s?(a=this.localTrackMap.get(it.LocalVideoTrack))===null||a===void 0?void 0:a.track:i.find(u=>u instanceof ae);wt.publish(this.store.sessionId,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,i,s){const r=s===yt.VIDEO?i._videoSSRC:i._audioSSRC;r&&wt.subscribe(this.store.sessionId,{succ:t,ec:e,video:s===yt.VIDEO,audio:s===yt.AUDIO,peerid:i.uid,subscribeRequestid:s===yt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:li.measureFromSubscribeStart(this.store.clientId,r)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new qn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new jn({},this.store):this.isPlanB?new Xn({},this.store):new $n({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(it.LocalAudioTrack);if((t==null?void 0:t.track)instanceof bn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(i=>{e.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Te.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(it.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(it.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof ae||e&&e.track instanceof Oe?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}getRemoteMedia(t){var e;const i=Array.from(bs(e=this.remoteUserMap).call(e)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(it.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Su(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.connection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Te.Reconnecting,U("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var i;e._videoTrack&&e._videoTrack._player&&((i=e._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new jn({},this.store):this.isPlanB?new Xn({},this.store):new $n({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[i,{track:s}]=t;switch(i){case it.LocalVideoTrack:Vt(e=s._hints).call(e,ze.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case it.LocalAudioTrack:s instanceof bn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case it.LocalVideoLowTrack:}}),this.emit(xt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;Array.from(bs(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(e,s)}),this.emit(xt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,i]=t;Array.from(bs(i).call(i)).forEach(s=>{this.setPendingRemoteDataChannel(e,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const i of this.pendingRemoteDataChannels){const{user:s,id:r}=i;if((t instanceof ui?t.uid:t)===s.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const i of this.pendingRemoteTracks){const{user:s,kind:r}=i;if((t instanceof ui?t.uid:t)===s.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return tr(function*(){if(!e.connection||e.state!==Te.Connected||e.connection instanceof jn)return;const i=yield Re(e.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield Re(e.connection.restartICE(t));const a=yield Re(s.next());if(a.done)return;const c=a.value,l=yield c;switch(e.reportPCDisconnectedOrFailed(t),t){case ci.TCP:e._pcStatsUploadType=Vr.TCP_RESTART;break;case ci.RELAY:e._pcStatsUploadType=Vr.RELAY_RESTART;break;default:e._pcStatsUploadType=Vr.OLD_RESTART}e._isInRestartIce=!0,s.next(l)}catch(a){var r;(r=s)===null||r===void 0||r.throw(a)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(it.LocalVideoTrack),i=this.localTrackMap.get(it.LocalAudioTrack),s=t.videoSend.find(w=>w.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(w=>w.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!s||!r)return 1;const a=us(this,xt.NeedSignalRTT),c=s?s.rttMs:void 0,l=r?r.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&a?(u+a)/2:u||a)||0,f=100*t.sendPacketLossRate*.7/50+.3*h/1500,g=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,S=e==null?void 0:e.track;if(S&&S._encoderConfig&&S._hints.indexOf(ze.SCREEN_TRACK)===-1){const w=S._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(w&&I){const b=(1e3*w-I)/(1e3*w);return RA[b<.15?0:b<.3?1:b<.45?2:b<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const r=s._audioSSRC,a=s._videoSSRC,c=t.audioRecv.find(I=>I.ssrc===r),l=t.videoRecv.find(I=>I.ssrc===a);if(!c&&!l)return void(e+=1);const u=us(this,xt.NeedSignalRTT),h=t.rtt,f=(h&&u?(h+u)/2:h||u)||0,g=c?c.jitterMs:void 0,S=t.recvPacketLossRate;let w=.7*S*100/50+.3*f/1500;g&&(w=.6*S*100/50+.2*f/1500+.2*g/400),e+=w<.1?1:w<.17?2:w<.36?3:w<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new K((e,i)=>{this.handleMuteLocalTrack(t,e,i)})}filterTobePublishedTracks(t,e,i){const s=[],r=Ke(),a=this.getAllTracks();t=Fd(t=t.filter(u=>a.indexOf(u)===-1));let c=!1,l=!1;for(const u of t){if(u instanceof ae&&(this.localTrackMap.has(it.LocalVideoTrack)||c?new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:u,type:it.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(u,i);s.push({track:h,type:it.LocalVideoLowTrack})}if(u instanceof Oe){const h=this.localTrackMap.get(it.LocalAudioTrack);if(h){if(!(h.track instanceof bn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){const f=s.find(g=>{let{type:S}=g;return S===it.LocalAudioTrack});if(!(f.track instanceof bn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(u)}else{if(!r.webAudioMediaStreamDest||u instanceof bn||u._bypassWebAudio)s.push({track:u,type:it.LocalAudioTrack});else{const f=new bn;f.addAudioTrack(u),s.push({track:f,type:it.LocalAudioTrack})}l=!0}}}return s}filterTobeUnpublishedTracks(t){const e=[],i=this.getAllTracks();t=Fd(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Oe){const r=this.localTrackMap.get(it.LocalAudioTrack);if(!r)continue;r.track instanceof bn?(r.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),r.track.trackList.length===0&&(e.push([it.LocalAudioTrack,r]),r.track.close())):e.push([it.LocalAudioTrack,r])}if(s instanceof ae){const r=this.localTrackMap.get(it.LocalVideoTrack);if(!r)continue;e.push([it.LocalVideoTrack,r]);const a=this.localTrackMap.get(it.LocalVideoLowTrack);a&&e.push([it.LocalVideoLowTrack,a])}}return e}filterTobePublishedDataChannels(t){return t=(t=Fd(t)).filter(e=>this.localDataChannels.findIndex(i=>i.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Fd(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:i,type:s}=e;switch(s){case it.LocalVideoTrack:i.addListener(St.GET_STATS,this.handleGetLocalVideoStats),i.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(St.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(St.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case it.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case it.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof bn?t.trackList.forEach(i=>{i.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(St.GET_STATS,this.handleGetLocalAudioStats),i.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(St.GET_STATS,this.handleGetLocalAudioStats),t.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(St.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[i,{track:s}]=e;return{track:s,type:i}})),t.forEach(e=>{let{track:i,type:s}=e;switch(s){case it.LocalVideoTrack:i.off(St.GET_STATS,this.handleGetLocalVideoStats),i.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(St.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(St.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case it.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case it.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof bn?t.trackList.forEach(e=>{e.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(St.GET_STATS,this.handleGetLocalAudioStats),e.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(St.GET_STATS,this.handleGetLocalAudioStats),t.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof mo&&e.addListener(St.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),e instanceof Tr&&e.addListener(St.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(St.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;i.has(yt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),i.has(yt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((i,s)=>{var r;let a,c,{track:l,type:u}=i;switch(u){case it.LocalAudioTrack:a=ke.Audio,c={dtx:l instanceof Ma&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case it.LocalVideoTrack:a=Vt(r=l._hints).call(r,ze.SCREEN_TRACK)?ke.Screen:ke.High,c=Ka(Ka({},Qf(l)),{},{codec:this.store.codec});break;case it.LocalVideoLowTrack:a=ke.Low,c=Ka(Ka({},Qf(l)),{},{codec:this.store.codec})}return{stream_type:a,attributes:c,ssrcs:e[s]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case it.LocalVideoTrack:s=Vt(i=a._hints).call(i,ze.SCREEN_TRACK)?ke.Screen:ke.High;break;case it.LocalAudioTrack:s=ke.Audio;break;case it.LocalVideoLowTrack:s=ke.Low}return{stream_type:s,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((i,s)=>{let{track:r,type:a}=i;this.localTrackMap.set(a,{track:r,id:e[s].id,ssrcs:e[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[i]=e;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(xt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),U("NEW_ICE_RESTART")){var i;if(Vt(i=this._restartStates).call(i,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(c)),us(this,xt.QueryClientConnectionState)==="CONNECTED"&&this.emit(xt.RequestRestartICE,c))},r=()=>{t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="checking"&&t.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),v.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},a=U("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(U("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ke().supportPCSetConfiguration)s(ci.RELAY),this._restartTimer=window.setTimeout(r,a);else if($e())s(ci.UDP),this._restartTimer=window.setTimeout(r,4e3);else{if(s(ci.TCP),Ke().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{s(ci.RELAY),this._restartTimer=window.setTimeout(r,a)},a));this._restartTimer=window.setTimeout(r,a)}},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&U("ICE_RESTART")&&us(this,xt.QueryClientConnectionState)==="CONNECTED"&&this.emit(xt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:sn.TRACER}).onSuccess(),this.emit(xt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var i;const s=Array.from(bs(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===e);var r;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(r=s.audioTrack)===null||r===void 0||r.emit(Mc.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_DECODE,tn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var i;const s=Array.from(bs(i=this.remoteUserMap).call(i)).find(r=>r._audioSSRC===e);s&&wt.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_RECEIVED,tn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,i,s)=>{this.reportVideoFirstFrameDecoded(e,i,s)},t.onFirstVideoReceived=e=>{var i;const s=Array.from(bs(i=this.remoteUserMap).call(i)).find(r=>r._videoSSRC===e);s&&wt.firstRemoteFrame(this.store.sessionId,Bn.FIRST_VIDEO_RECEIVED,tn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,i)=>{const s=e.candidateType==="relay",r=i.candidateType==="relay";i.candidateType!=="unknown"&&s===r||this.emit(xt.ConnectionTypeChange,s),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ga(i))," -> ").concat(JSON.stringify(Ga(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,i)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ga(i))," -> ").concat(JSON.stringify(Ga(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const i=this.localTrackMap.get(it.LocalAudioTrack);if(t instanceof Oe&&(i==null?void 0:i.track)instanceof bn)return i.track.isActive||e.push([it.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(s&&(e.push(s),s[0]===it.LocalVideoTrack)){const r=this.localTrackMap.get(it.LocalVideoLowTrack);r&&e.push([it.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],i=this.localTrackMap.get(it.LocalAudioTrack);if(t instanceof Oe&&(i==null?void 0:i.track)instanceof bn)return i.track.isActive&&e.push([it.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(s)if(s[0]===it.LocalVideoTrack){e.push(s);const r=this.localTrackMap.get(it.LocalVideoLowTrack);r&&e.push([it.LocalVideoLowTrack,r])}else e.push(s);return e}createMuteMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case it.LocalAudioTrack:s=ke.Audio;break;case it.LocalVideoTrack:s=Vt(i=a._hints).call(i,ze.SCREEN_TRACK)?ke.Screen:ke.High;break;case it.LocalVideoLowTrack:s=ke.Low}return{stream_type:s,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case it.LocalAudioTrack:s=ke.Audio;break;case it.LocalVideoTrack:s=Vt(i=a._hints).call(i,ze.SCREEN_TRACK)?ke.Screen:ke.High;break;case it.LocalVideoLowTrack:s=ke.Low}return{stream_type:s,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(e){const r=s.get(e);if(!r)return i;i.push([t,{kind:e,id:r}])}else Array.from(s.entries()).forEach(r=>{let[a,c]=r;i.push([t,{kind:a,id:c}])});return i}filterTobeUnSubscribedDataChannels(t,e){const i=[];return e.forEach(s=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(s.id)&&i.push(s)}),i}createUnsubscribeMessage(t){const e=[];return t.forEach(i=>{let[s,{kind:r,id:a}]=i;switch(r){case yt.VIDEO:return void(s._videoSSRC&&e.push({stream_type:yt.VIDEO,ssrcId:s._videoSSRC}));case yt.AUDIO:return void(s._audioSSRC&&e.push({stream_type:yt.AUDIO,ssrcId:s._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(i=>{let[s,{kind:r}]=i;if(e.has(s)){let a=e.get(s);r===yt.VIDEO?a|=On.Video:a|=On.Audio,e.set(s,a)}else r===yt.VIDEO?e.set(s,On.Video):e.set(s,On.Audio)}),{users:Array.from(e.entries()).map(i=>{let[s,r]=i;return{stream_id:s.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[i,{kind:s}]=e;const r=this.remoteUserMap.get(i);r&&(r.delete(s),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(it.LocalVideoTrack),i=this.localTrackMap.get(it.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),i&&t.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e){return t.map((i,s)=>{var r;let{stream_type:a}=i;return(r=e.find(c=>{let{stream_type:l}=c;return a===l}))===null||r===void 0?void 0:r.attributes})}async tryToUnmuteAudio(t){for(let i=0;i<t.length;i++)if(t[i]instanceof Oe){var e;const s=this.filterTobeUnmutedTracks(t[i]);if(s.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(s.map(a=>{let[,{id:c}]=a;return c})));const r=this.createUnmuteMessage(s);return void await He(this,xt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(xt.RequestUploadStats,t,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ri(uf(this.dtlsFailedCount,In)),this.emit(xt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await rn(this,xt.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(xt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(it.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof ae)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof ae).length>1)throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Oe).length>1&&(t.some(e=>e instanceof Oe&&e._bypassWebAudio)||!Ke().webAudioMediaStreamDest))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof ae&&this.pendingLocalTracks.some(i=>i instanceof ae))throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Oe&&this.pendingLocalTracks.some(i=>i instanceof Oe)&&(!Ke().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Oe&&i._bypassWebAudio)))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const i=!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding,s=Ka(Ka({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=i?t._mediaStreamTrack.clone():MS(t,s);const a=Be(8,"track-low-"),c=new ae(r,Ka(Ka({},i&&{scaleResolutionDownBy:ES(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,a);return c.on(Xd.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,La.LOW_STREAM)}),c._hints.push(ze.LOW_STREAM),t.addListener(St.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof $n){var r,a,c,l;const u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:f,peerConnectionState:g}=this.connection,{local:S,remote:w}=await this.connection.getSelectedCandidatePair();wt.pcStats(this.store.sessionId,{startTime:u,eventElapse:t-u||0,iceconnectionsate:h,dtlsstate:f,connectionstate:g,intSucc:e?1:2,error:s,selectedLocalCandidateProtocol:(r=S==null?void 0:S.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(a=S.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(c=w.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=w.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(w.address,":").concat(w.port),restartCnt:i})}}reportVideoFirstFrameDecoded(t,e,i,s){var r;const a=Array.from(bs(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(a){s||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,Bn.FIRST_VIDEO_DECODE,tn.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:i,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,e,i){if(!this.connection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const r=s.get(e);if(!r)return!1;const a=await this.connection.getRemoteSSRC(r);return a!==void 0&&a!==i}resetConnection(t){v.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(t)),this.state===Te.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=t===yf.datachannel?new jn({},this.store):this.isPlanB?new Xn({},this.store):new $n({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:i}]=t;e===it.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,La.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(t){this.connection&&this.connection instanceof $n&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Vr.TCP_RESTART&&t===ci.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Vr.DISCONNECTED_OR_FAILED)))}}function Oi(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From P2PChannel.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}function p4(n){let t=y0();return function(e,i){let s=e.appId;s!==void 0&&(Pe(i,10),Co(i,s));let r=e.cid;r!==void 0&&(Pe(i,16),Pe(i,r));let a=e.cname;a!==void 0&&(Pe(i,26),Co(i,a));let c=e.deviceId;c!==void 0&&(Pe(i,34),Co(i,c));let l=e.elapse;l!==void 0&&(Pe(i,40),qa(i,l));let u=e.fileSize;u!==void 0&&(Pe(i,48),qa(i,ll(u)));let h=e.height;h!==void 0&&(Pe(i,56),qa(i,ll(h)));let f=e.jpg;f!==void 0&&(Pe(i,66),Pe(i,f.length),function(Nn,nt){let ct=ul(Nn,nt.length);Nn.bytes.set(nt,ct)}(i,f));let g=e.networkType;g!==void 0&&(Pe(i,72),qa(i,ll(g)));let S=e.osType;S!==void 0&&(Pe(i,80),qa(i,ll(S)));let w=e.requestId;w!==void 0&&(Pe(i,90),Co(i,w));let I=e.sdkVersion;I!==void 0&&(Pe(i,98),Co(i,I));let b=e.sequence;b!==void 0&&(Pe(i,104),qa(i,ll(b)));let M=e.sid;M!==void 0&&(Pe(i,114),Co(i,M));let F=e.timestamp;F!==void 0&&(Pe(i,120),qa(i,F));let V=e.uid;V!==void 0&&(Pe(i,128),Pe(i,V));let Z=e.vid;Z!==void 0&&(Pe(i,136),Pe(i,Z));let $=e.width;$!==void 0&&(Pe(i,144),qa(i,ll($)));let W=e.service;W!==void 0&&(Pe(i,152),Pe(i,W));let q=e.callbackData;q!==void 0&&(Pe(i,162),Co(i,q));let et=e.jpgEncryption;et!==void 0&&(Pe(i,168),Pe(i,et));let _t=e.requestType;_t!==void 0&&(Pe(i,176),Pe(i,_t));let lt=e.scorePorn;lt!==void 0&&(Pe(i,185),GS(i,lt));let Xt=e.scoreSexy;Xt!==void 0&&(Pe(i,193),GS(i,Xt));let pe=e.scoreNeutral;pe!==void 0&&(Pe(i,201),GS(i,pe));let ve=e.scene;ve!==void 0&&(Pe(i,208),Pe(i,ve));let Ue=e.ossFilePrefix;Ue!==void 0&&(Pe(i,218),Co(i,Ue));let de=e.serviceVendor;if(de!==void 0)for(let Nn of de){Pe(i,226);let nt=y0();m4(Nn,nt),Pe(i,nt.limit),S4(i,nt),T4(nt)}}(n,t),function(e){let i=e.bytes,s=e.limit;return i.length===s?i:i.subarray(0,s)}(t)}function f4(n){return function(e){let i={};t:for(;!R0(e);){let s=yo(e);switch(s>>>3){case 0:break t;case 1:i.code=yo(e);break;case 2:i.msg=I0(e,yo(e));break;case 3:{let r=E4(e);i.data=_4(e),e.limit=r;break}default:v0(e,7&s)}}return i}({bytes:t=n,offset:0,limit:t.length});var t}function _4(n){let t={};t:for(;!R0(n);){let e=yo(n);switch(e>>>3){case 0:break t;case 1:t.requestId=I0(n,yo(n));break;case 2:t.requestType=yo(n)>>>0;break;case 3:t.scorePorn=jS(n);break;case 4:t.scoreSexy=jS(n);break;case 5:t.scoreNeutral=jS(n);break;case 6:t.requestScene=yo(n)>>>0;break;case 7:t.scene=yo(n)>>>0;break;default:v0(n,7&e)}}return t}function m4(n,t){let e=n.service;e!==void 0&&(Pe(t,8),Pe(t,e));let i=n.vendor;i!==void 0&&(Pe(t,16),Pe(t,i));let s=n.token;s!==void 0&&(Pe(t,26),Co(t,s));let r=n.callbackUrl;r!==void 0&&(Pe(t,34),Co(t,r))}function E4(n){let t=yo(n),e=n.limit;return n.limit=n.offset+t,e}function v0(n,t){switch(t){case 0:for(;128&b0(n););break;case 2:FS(n,yo(n));break;case 5:FS(n,4);break;case 1:FS(n,8);break;default:throw new Error("Unimplemented type: "+t)}}tt([Oi,A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",K)],oi.prototype,"startP2PConnection",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],oi.prototype,"connect",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",K)],oi.prototype,"preConnect",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],oi.prototype,"publishDataChannel",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],oi.prototype,"unpublish",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],oi.prototype,"unpublishDataChannel",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],oi.prototype,"unpublishLowStream",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[ui,Array]),A("design:returntype",K)],oi.prototype,"subscribeDataChannel",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[ui,String,Number,Number,Array]),A("design:returntype",K)],oi.prototype,"subscribe",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],oi.prototype,"massSubscribe",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[ui,String,Boolean]),A("design:returntype",K)],oi.prototype,"unsubscribe",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[ui,Array]),A("design:returntype",K)],oi.prototype,"unsubscribeDataChannel",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],oi.prototype,"massUnsubscribe",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[ui,String]),A("design:returntype",K)],oi.prototype,"muteRemote",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[ui,String]),A("design:returntype",K)],oi.prototype,"unmuteRemote",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[ui,String]),A("design:returntype",K)],oi.prototype,"hasRemoteMediaWithLock",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],oi.prototype,"disconnectForReconnect",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],oi.prototype,"updateBitrateLimit",null),tt([Oi,A("design:type",Function),A("design:paramtypes",[ui,String,Number]),A("design:returntype",K)],oi.prototype,"remoteMediaSsrcChanged",null);let g4=new Float32Array(1);new Uint8Array(g4.buffer);let VS=new Float64Array(1),ss=new Uint8Array(VS.buffer);function ll(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let C0=[];function y0(){const n=C0.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}function T4(n){C0.push(n)}function FS(n,t){if(n.offset+t>n.limit)throw new Error("Skip past limit");n.offset+=t}function R0(n){return n.offset>=n.limit}function ul(n,t){let e=n.bytes,i=n.offset,s=n.limit,r=i+t;if(r>e.length){let a=new Uint8Array(2*r);a.set(e),n.bytes=a}return n.offset=r,r>s&&(n.limit=r),i}function BS(n,t){let e=n.offset;if(e+t>n.limit)throw new Error("Read past limit");return n.offset+=t,e}function I0(n,t){let e=BS(n,t),i=String.fromCharCode,s=n.bytes,r="�",a="";for(let c=0;c<t;c++){let l,u,h,f,g=s[c+e];128&g?(224&g)==192?c+1>=t?a+=r:(l=s[c+e+1],(192&l)!=128?a+=r:(f=(31&g)<<6|63&l,f<128?a+=r:(a+=i(f),c++))):(240&g)==224?c+2>=t?a+=r:(l=s[c+e+1],u=s[c+e+2],(49344&(l|u<<8))!=32896?a+=r:(f=(15&g)<<12|(63&l)<<6|63&u,f<2048||f>=55296&&f<=57343?a+=r:(a+=i(f),c+=2))):(248&g)==240?c+3>=t?a+=r:(l=s[c+e+1],u=s[c+e+2],h=s[c+e+3],(12632256&(l|u<<8|h<<16))!=8421504?a+=r:(f=(7&g)<<18|(63&l)<<12|(63&u)<<6|63&h,f<65536||f>1114111?a+=r:(f-=65536,a+=i(55296+(f>>10),56320+(1023&f)),c+=3))):a+=r:a+=i(g)}return a}function Co(n,t){let e=t.length,i=0;for(let a=0;a<e;a++){let c=t.charCodeAt(a);c>=55296&&c<=56319&&a+1<e&&(c=(c<<10)+t.charCodeAt(++a)-56613888),i+=c<128?1:c<2048?2:c<65536?3:4}Pe(n,i);let s=ul(n,i),r=n.bytes;for(let a=0;a<e;a++){let c=t.charCodeAt(a);c>=55296&&c<=56319&&a+1<e&&(c=(c<<10)+t.charCodeAt(++a)-56613888),c<128?r[s++]=c:(c<2048?r[s++]=c>>6&31|192:(c<65536?r[s++]=c>>12&15|224:(r[s++]=c>>18&7|240,r[s++]=c>>12&63|128),r[s++]=c>>6&63|128),r[s++]=63&c|128)}}function S4(n,t){let e=ul(n,t.limit),i=n.bytes,s=t.bytes;for(let r=0,a=t.limit;r<a;r++)i[r+e]=s[r]}function b0(n){return n.bytes[BS(n,1)]}function A0(n,t){let e=ul(n,1);n.bytes[e]=t}function jS(n){let t=BS(n,8),e=n.bytes;return ss[0]=e[t++],ss[1]=e[t++],ss[2]=e[t++],ss[3]=e[t++],ss[4]=e[t++],ss[5]=e[t++],ss[6]=e[t++],ss[7]=e[t++],VS[0]}function GS(n,t){let e=ul(n,8),i=n.bytes;VS[0]=t,i[e++]=ss[0],i[e++]=ss[1],i[e++]=ss[2],i[e++]=ss[3],i[e++]=ss[4],i[e++]=ss[5],i[e++]=ss[6],i[e++]=ss[7]}function yo(n){let t,e=0,i=0;do t=b0(n),e<32&&(i|=(127&t)<<e),e+=7;while(128&t);return i}function Pe(n,t){for(t>>>=0;t>=128;)A0(n,127&t|128),t>>>=7;A0(n,t)}function qa(n,t){let e=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,r=s===0?i===0?e<16384?e<128?1:2:e<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,a=ul(n,r),c=n.bytes;switch(r){case 10:c[a+9]=s>>>7&1;case 9:c[a+8]=r!==9?128|s:127&s;case 8:c[a+7]=r!==8?i>>>21|128:i>>>21&127;case 7:c[a+6]=r!==7?i>>>14|128:i>>>14&127;case 6:c[a+5]=r!==6?i>>>7|128:i>>>7&127;case 5:c[a+4]=r!==5?128|i:127&i;case 4:c[a+3]=r!==4?e>>>21|128:e>>>21&127;case 3:c[a+2]=r!==3?e>>>14|128:e>>>14&127;case 2:c[a+1]=r!==2?e>>>7|128:e>>>7&127;case 1:c[a]=r!==1?128|e:127&e}}function w0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}const v4=new Map([["moderation",1],["supervise",2]]);class f_ extends Ze{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const e=this._connectionState;this._connectionState=t,this.emit(Un.CONNECTION_STATE_CHANGE,e,t)}get inspectType(){return this._inspectType}set inspectType(t){var e;this._inspectMode=Nc(e=t.map(i=>v4.get(i)||0)).call(e,(i,s)=>i+s),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),m(this,"name","AgoraRTCVideoContentInspect"),m(this,"_connectionState",Ns.CONNECTING),m(this,"_innerConnectionState",void 0),m(this,"sequence",0),m(this,"inspectStartTime",void 0),m(this,"workerManagerConnection",void 0),m(this,"workerConnection",void 0),m(this,"workerMessageLengthLimit",void 0),m(this,"inspectIntervalMinimum",void 0),m(this,"qualityRatio",void 0),m(this,"_connectInfo",void 0),m(this,"_cancelTokenSource",Zi.CancelToken.source()),m(this,"_retryConfig",void 0),m(this,"wmSequence",0),m(this,"inspectInterval",void 0),m(this,"inspectTimer",null),m(this,"ossFilePrefix",void 0),m(this,"extraInfo",void 0),m(this,"_inspectType",void 0),m(this,"_inspectMode",void 0),m(this,"_quality",1),m(this,"qualityTimer",null),m(this,"_inspectId",void 0),m(this,"_needWorkUrlOnly",!1),m(this,"inspectImage",()=>{if(this.connectionState!==Ns.CONNECTED)throw new j(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ns.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Be(5,"inspect-"),this.workerMessageLengthLimit=U("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=U("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=U("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Vu("worker-manager-"+this._inspectId,In),this.on(Un.STATE_CHANGE,(e,i)=>{this._innerConnectionState=e,v.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ds[e]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Vu("worker-"+this._inspectId,In),this.handleWorkerEvents()}async init(t,e){this.emit(Un.STATE_CHANGE,Ds.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=e,new K((s,r)=>{this.on(Un.CONNECTION_STATE_CHANGE,(a,c)=>{c===Ns.CONNECTED&&s()}),this.requestAP(t,i,e).then(a=>{this.connectWorkerManager(a)}).catch(a=>{r(a)})})}async requestAP(t,e,i){const s=U("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),r=await function(c,l,u,h){let{appId:f,areaCode:g,cname:S,sid:w,token:I,uid:b}=l;al++;const M="image_moderation_api",F={service_name:M,json_body:JSON.stringify({appId:f,areaCode:g,cname:S,command:"allocateEdge",requestId:al,seq:al,sid:w,token:I,ts:Date.now(),uid:b+""})};let V,Z,$=c[0];return Ur(async()=>{V=Date.now();const W=await na($,{data:F,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-V,W.code!==0){const lt=new j(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+W.code,{retry:!0,responseTime:Z});throw v.error(lt.toString()),lt}const q=JSON.parse(W.json_body);if(q.code!==200){const lt=new j(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(q.code,", reason: ").concat(q.reason),{code:q.code,responseTime:Z});throw v.error(lt.toString()),lt}if(!q.servers||!Array.isArray(q.servers)||q.servers.length===0){const lt=new j(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:q.code,responseTime:Z});throw v.error(lt.toString()),lt}const et=U("VIDEO_INSPECT_WORKER_MANAGER_HOST"),_t=U("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:q.servers.map(lt=>{let{address:Xt,wss:pe}=lt;if(Xt&&pe)return"wss://".concat(Xt.replace(/\./g,"-"),".").concat(et,":").concat(_t||pe)}).filter(lt=>!!lt),workerToken:q.workerToken,vid:q.vid,responseTime:Z}},(W,q)=>(wt.apworkerEvent(w,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(W.addressList),firstSuccess:q===0,responseTime:Z,serverIp:c[q%c.length]}),!1),(W,q)=>(wt.apworkerEvent(w,{success:!1,sc:W.data&&W.data.code||200,serviceName:M,responseTime:Z,serverIp:c[q%c.length]}),!!(W.code!==O.OPERATION_ABORTED&&W.code!==O.UNEXPECTED_RESPONSE||W.data&&W.data.retry)&&($=c[(q+1)%c.length],!0)),h)}(s,t,e,i);this.emit(Un.STATE_CHANGE,Ds.AP_CONNECTED);const{addressList:a}=r;return this.wmSequence++,a}async connectWorkerManager(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=e,this.emit(Un.STATE_CHANGE,Ds.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ht.CONNECTED,async()=>{this.emit(Un.STATE_CHANGE,Ds.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.19.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ht.CLOSED,()=>{this._innerConnectionState<Ds.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ht.FAILED,()=>{this._innerConnectionState<Ds.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ht.RECONNECTING,()=>{this._innerConnectionState<Ds.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ht.ON_MESSAGE,async t=>{this.emit(Un.STATE_CHANGE,Ds.GET_WORKER_MANAGER_RESPONSE);const e=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw v.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new j(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&e))throw v.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new j(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const s=U("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,r=e.replace(/:\d+\/?$/,":".concat(s));this.emit(Un.STATE_CHANGE,Ds.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(Un.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}}),this.workerManagerConnection.on(Ht.WILL_RECONNECT,(t,e,i)=>{i(t)}),this.workerManagerConnection.on(Ht.REQUEST_NEW_URLS,(t,e)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(e)})}handleWorkerEvents(){this.workerConnection.on(Ht.CONNECTED,async()=>{this.emit(Un.STATE_CHANGE,Ds.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ns.CONNECTED}),this.workerConnection.on(Ht.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=f4(new Uint8Array(t.data));if(U("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&v.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Un.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var e;const s={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},r=Nc(e=Object.keys(s)).call(e,(c,l)=>s[c]>s[l]?c:l,"porn"),a=Object.keys(s).find(c=>c===r);this.emit(Un.INSPECT_RESULT,a)}else this.emit(Un.INSPECT_RESULT,void 0,new j(O.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Un.INSPECT_RESULT,void 0,new j(O.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else v.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Un.INSPECT_RESULT,void 0,new j(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ht.CLOSED,()=>{this.connectionState=Ns.CLOSED}),this.workerConnection.on(Ht.FAILED,()=>{this.connectionState=Ns.CLOSED}),this.workerConnection.on(Ht.RECONNECTING,()=>{this.connectionState=this.connectionState===Ns.CONNECTED?Ns.RECONNECTING:Ns.CONNECTING}),this.workerConnection.on(Ht.WILL_RECONNECT,(t,e,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(Ht.REQUEST_NEW_URLS,(t,e)=>{this.workerManagerConnection.close(),this.once(Un.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{e(i)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=us(this,Un.CLIENT_LOCAL_VIDEO_TRACK),e={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Un.INSPECT_RESULT,void 0,new j(O.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,e);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Un.INSPECT_RESULT,void 0,new j(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,e){let{appId:i,cname:s,cid:r,vid:a,sid:c,uid:l}=e;const u=Date.now(),h=await t.getCurrentFrameImage("image/jpeg",this.quality),f=await Tw(h,i,s),g=this.sequence+"-"+r+"-"+l+"-"+u+"-"+Be(12,""),S={appId:i,cid:r,cname:s,deviceId:"",elapse:f_.intToLong(Number(u-this.inspectStartTime)),fileSize:f.byteLength,jpgEncryption:2,height:h.height,width:h.width,jpg:f,networkType:6,osType:7,requestId:g,sdkVersion:"4.19.1",sequence:this.sequence,sid:c,timestamp:f_.intToLong(u),uid:l,vid:a,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete S.callbackData,this.ossFilePrefix===void 0&&delete S.ossFilePrefix;const w=p4(S);if(w.byteLength<this.workerMessageLengthLimit){if(U("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const I=function(b){for(var M=1;M<arguments.length;M++){var F=arguments[M]!=null?arguments[M]:{};M%2?w0(Object(F),!0).forEach(function(V){m(b,V,F[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(F)):w0(Object(F)).forEach(function(V){Object.defineProperty(b,V,Object.getOwnPropertyDescriptor(F,V))})}return b}({},S);delete I.jpg,v.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(I))}return w}{const I=this.quality*this.qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:i,cname:s,cid:r,vid:a,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Zi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ns.CLOSED,this.emit(Un.STATE_CHANGE,Ds.CLOSED)}}function C4(n){let t=function(){const e=I4.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,i){let s=e.appId;s!==void 0&&(An(i,10),zc(i,s));let r=e.cid;r!==void 0&&(An(i,16),An(i,r));let a=e.cname;a!==void 0&&(An(i,26),zc(i,a));let c=e.deviceId;c!==void 0&&(An(i,34),zc(i,c));let l=e.elapse;l!==void 0&&(An(i,40),Ya(i,l));let u=e.fileSize;u!==void 0&&(An(i,48),Ya(i,hl(u)));let h=e.height;h!==void 0&&(An(i,56),Ya(i,hl(h)));let f=e.jpg;f!==void 0&&(An(i,66),An(i,f.length),N0(i,f));let g=e.networkType;g!==void 0&&(An(i,72),Ya(i,hl(g)));let S=e.osType;S!==void 0&&(An(i,80),Ya(i,hl(S)));let w=e.requestId;w!==void 0&&(An(i,90),zc(i,w));let I=e.sdkVersion;I!==void 0&&(An(i,98),zc(i,I));let b=e.sequence;b!==void 0&&(An(i,104),Ya(i,hl(b)));let M=e.sid;M!==void 0&&(An(i,114),zc(i,M));let F=e.timestamp;F!==void 0&&(An(i,120),Ya(i,F));let V=e.uid;V!==void 0&&(An(i,128),An(i,V));let Z=e.vid;Z!==void 0&&(An(i,136),An(i,Z));let $=e.width;$!==void 0&&(An(i,144),Ya(i,hl($)));let W=e.service;W!==void 0&&(An(i,152),An(i,W));let q=e.callbackData;q!==void 0&&(An(i,162),An(i,q.length),N0(i,q));let et=e.ticket;et!==void 0&&(An(i,170),zc(i,et))}(n,t),function(e){let i=e.bytes,s=e.limit;return i.length===s?i:i.subarray(0,s)}(t)}function y4(n){return function(e){let i={};t:for(;!b4(e);){let s=dh(e);switch(s>>>3){case 0:break t;case 1:i.code=dh(e);break;case 2:i.msg=D0(e,dh(e));break;case 3:i.requestId=D0(e,dh(e));break;case 4:i.timestamp=A4(e,!1);break;default:R4(e,7&s)}}return i}({bytes:t=n,offset:0,limit:t.length});var t}function R4(n,t){switch(t){case 0:for(;128&Rr(n););break;case 2:WS(n,dh(n));break;case 5:WS(n,4);break;case 1:WS(n,8);break;default:throw new Error("Unimplemented type: "+t)}}function hl(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let I4=[];function WS(n,t){if(n.offset+t>n.limit)throw new Error("Skip past limit");n.offset+=t}function b4(n){return n.offset>=n.limit}function __(n,t){let e=n.bytes,i=n.offset,s=n.limit,r=i+t;if(r>e.length){let a=new Uint8Array(2*r);a.set(e),n.bytes=a}return n.offset=r,r>s&&(n.limit=r),i}function O0(n,t){let e=n.offset;if(e+t>n.limit)throw new Error("Read past limit");return n.offset+=t,e}function N0(n,t){let e=__(n,t.length);n.bytes.set(t,e)}function D0(n,t){let e=O0(n,t),i=String.fromCharCode,s=n.bytes,r="�",a="";for(let c=0;c<t;c++){let l,u,h,f,g=s[c+e];128&g?(224&g)==192?c+1>=t?a+=r:(l=s[c+e+1],(192&l)!=128?a+=r:(f=(31&g)<<6|63&l,f<128?a+=r:(a+=i(f),c++))):(240&g)==224?c+2>=t?a+=r:(l=s[c+e+1],u=s[c+e+2],(49344&(l|u<<8))!=32896?a+=r:(f=(15&g)<<12|(63&l)<<6|63&u,f<2048||f>=55296&&f<=57343?a+=r:(a+=i(f),c+=2))):(248&g)==240?c+3>=t?a+=r:(l=s[c+e+1],u=s[c+e+2],h=s[c+e+3],(12632256&(l|u<<8|h<<16))!=8421504?a+=r:(f=(7&g)<<18|(63&l)<<12|(63&u)<<6|63&h,f<65536||f>1114111?a+=r:(f-=65536,a+=i(55296+(f>>10),56320+(1023&f)),c+=3))):a+=r:a+=i(g)}return a}function zc(n,t){let e=t.length,i=0;for(let a=0;a<e;a++){let c=t.charCodeAt(a);c>=55296&&c<=56319&&a+1<e&&(c=(c<<10)+t.charCodeAt(++a)-56613888),i+=c<128?1:c<2048?2:c<65536?3:4}An(n,i);let s=__(n,i),r=n.bytes;for(let a=0;a<e;a++){let c=t.charCodeAt(a);c>=55296&&c<=56319&&a+1<e&&(c=(c<<10)+t.charCodeAt(++a)-56613888),c<128?r[s++]=c:(c<2048?r[s++]=c>>6&31|192:(c<65536?r[s++]=c>>12&15|224:(r[s++]=c>>18&7|240,r[s++]=c>>12&63|128),r[s++]=c>>6&63|128),r[s++]=63&c|128)}}function Rr(n){return n.bytes[O0(n,1)]}function P0(n,t){let e=__(n,1);n.bytes[e]=t}function dh(n){let t,e=0,i=0;do t=Rr(n),e<32&&(i|=(127&t)<<e),e+=7;while(128&t);return i}function An(n,t){for(t>>>=0;t>=128;)P0(n,127&t|128),t>>>=7;P0(n,t)}function A4(n,t){let e,i=0,s=0,r=0;return e=Rr(n),i=127&e,128&e&&(e=Rr(n),i|=(127&e)<<7,128&e&&(e=Rr(n),i|=(127&e)<<14,128&e&&(e=Rr(n),i|=(127&e)<<21,128&e&&(e=Rr(n),s=127&e,128&e&&(e=Rr(n),s|=(127&e)<<7,128&e&&(e=Rr(n),s|=(127&e)<<14,128&e&&(e=Rr(n),s|=(127&e)<<21,128&e&&(e=Rr(n),r=127&e,128&e&&(e=Rr(n),r|=(127&e)<<7))))))))),{low:i|s<<28,high:s>>>4|r<<24,unsigned:t}}function Ya(n,t){let e=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,r=s===0?i===0?e<16384?e<128?1:2:e<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,a=__(n,r),c=n.bytes;switch(r){case 10:c[a+9]=s>>>7&1;case 9:c[a+8]=r!==9?128|s:127&s;case 8:c[a+7]=r!==8?i>>>21|128:i>>>21&127;case 7:c[a+6]=r!==7?i>>>14|128:i>>>14&127;case 6:c[a+5]=r!==6?i>>>7|128:i>>>7&127;case 5:c[a+4]=r!==5?128|i:127&i;case 4:c[a+3]=r!==4?e>>>21|128:e>>>21&127;case 3:c[a+2]=r!==3?e>>>14|128:e>>>14&127;case 2:c[a+1]=r!==2?e>>>7|128:e>>>7&127;case 1:c[a]=r!==1?128|e:127&e}}const L0={},k0={},m_=4294967296,M0=m_*m_,U0=M0/2,HS=V0(0,!0),x0=V0(0),w4=pl(0,-2147483648,!1),O4=pl(-1,2147483647,!1),N4=pl(-1,-1,!0);function V0(n,t){let e,i,s;return t?(s=0<=(n>>>=0)&&n<256)&&(i=k0[n],i)?i:(e=pl(n,0,!0),s&&(k0[n]=e),e):(s=-128<=(n|=0)&&n<128)&&(i=L0[n],i)?i:(e=pl(n,n<0?-1:0,!1),s&&(L0[n]=e),e)}function pl(n,t,e){return{low:0|n,high:0|t,unsigned:!!e}}function D4(n,t){if(isNaN(n))return t?HS:x0;if(t){if(n<0)return HS;if(n>=M0)return N4}else{if(n<=-U0)return w4;if(n+1>=U0)return O4}return n<0?t?HS:x0:pl(n%m_|0,n/m_|0,t)}function F0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}class KS extends Ze{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const e=this._connectionState;this._connectionState=t,this.emit(Xs.CONNECTION_STATE_CHANGE,t,e)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var e;super(),m(this,"name","AgoraRTCImageModeration"),m(this,"_connectionState",hs.CONNECTING),m(this,"_sequence",0),m(this,"_moderationStartTime",void 0),m(this,"_workerConnection",void 0),m(this,"_workerMessageLengthLimit",void 0),m(this,"_qualityRatio",void 0),m(this,"_connectInfo",void 0),m(this,"_cancelTokenSource",Zi.CancelToken.source()),m(this,"_retryConfig",void 0),m(this,"_moderationInterval",void 0),m(this,"_moderationTimer",null),m(this,"_moderationMode",1),m(this,"_quality",1),m(this,"_qualityTimer",null),m(this,"_ticket",void 0),m(this,"_moderationIntervalMinimum",void 0),m(this,"_uploadFailedNum",0),m(this,"_uploadNum",0),m(this,"_uploadTimer",null),m(this,"_moderationId",void 0),m(this,"inspectImage",()=>{if(this.connectionState!==hs.CONNECTED)throw new j(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===hs.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Be(5,"image-moderation-"),this._workerMessageLengthLimit=U("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=U("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(e=t.interval)!==null&&e!==void 0?e:1e3,this._qualityRatio=U("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Vu("worker-"+this._moderationId,In),this.on(Xs.STATE_CHANGE,(i,s)=>{v.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Pa[i]," ").concat(s||""))}),this.handleWorkerEvents()}async init(t,e){this.emit(Xs.STATE_CHANGE,Pa.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=e,new K((s,r)=>{this.on(Xs.CONNECTION_STATE_CHANGE,(a,c)=>{a===hs.CONNECTED&&s()}),this.requestAP(t,i,e).then(a=>{this.connectWorker(a)}).catch(a=>{r(a)})})}updateConfig(t){var e;this._moderationInterval=(e=t.interval)!==null&&e!==void 0?e:1e3,v.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===hs.CONNECTED&&this.inspectImage()}async requestAP(t,e,i){const s=U("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),r=await function(l,u,h,f){let{appId:g,areaCode:S,cname:w,sid:I,token:b,uid:M}=u;al++;const F="moderation_plugin",V={service_name:F,json_body:JSON.stringify({appId:g,areaCode:S,cname:w,command:"allocateEdge",requestId:al,seq:al,sid:I,appToken:b,ts:Date.now(),uid:M+""})};let Z,$,W=l[0];return Ur(async()=>{Z=Date.now();const q=await na(W,{data:V,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-Z,q.code!==0){const lt=new j(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+q.code,{retry:!0,responseTime:$});throw v.error(lt.toString()),lt}const et=JSON.parse(q.json_body);if(et.code!==200){const lt=new j(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(et.code,", reason: ").concat(et.reason),{code:et.code,responseTime:$});throw v.error(lt.toString()),lt}if(!et.servers||!Array.isArray(et.servers)||et.servers.length===0){const lt=new j(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:et.code,responseTime:$});throw v.error(lt.toString()),lt}if(!et.servers.some(lt=>!!lt.wss)){const lt=new j(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:et.code,responseTime:$});throw v.error(lt.toString()),lt}const _t=U("IMAGE_MODERATION_WORKER_HOST");return{addressList:et.servers.map(lt=>{let{address:Xt,wss:pe}=lt;if(Xt&&pe)return"wss://".concat(Xt.replace(/\./g,"-"),".").concat(_t,":").concat(pe,"/moderation")}).filter(lt=>!!lt),workerToken:et.workerToken,vid:et.vid,ticket:et.appTicket,responseTime:$}},(q,et)=>(wt.apworkerEvent(I,{success:!0,sc:200,serviceName:F,responseDetail:JSON.stringify(q.addressList),firstSuccess:et===0,responseTime:$,serverIp:l[et%l.length]}),!1),(q,et)=>(wt.apworkerEvent(I,{success:!1,sc:q.data&&q.data.code||200,serviceName:F,responseTime:$,serverIp:l[et%l.length]}),!!(q.code!==O.OPERATION_ABORTED&&q.code!==O.UNEXPECTED_RESPONSE||q.data&&q.data.retry)&&(W=l[(et+1)%l.length],!0)),f)}(s,t,e,i);this.emit(Xs.STATE_CHANGE,Pa.AP_CONNECTED);const{addressList:a,ticket:c}=r;return this._ticket=c,a}async connectWorker(t){this.emit(Xs.STATE_CHANGE,Pa.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Ht.CONNECTED,async()=>{this.emit(Xs.STATE_CHANGE,Pa.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=hs.CONNECTED}),this._workerConnection.on(Ht.CLOSED,()=>{this.connectionState=hs.CLOSED}),this._workerConnection.on(Ht.FAILED,()=>{this.connectionState=hs.CLOSED}),this._workerConnection.on(Ht.RECONNECTING,()=>{this.connectionState=this.connectionState===hs.CONNECTED?hs.RECONNECTING:hs.CONNECTING}),this._workerConnection.on(Ht.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const e=y4(new Uint8Array(t.data));U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(e)),this._uploadNum++,e.code===void 0||e.code===0||(this._uploadFailedNum++,v.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(e.code,", msg is ").concat(e.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{wt.reportApiInvoke(this._connectInfo.sid||null,{name:wn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,e.code],tag:sn.TRACER}).onError(new j(O.IMAGE_MODERATION_UPLOAD_FAILED,e.msg)),this._uploadTimer=null},U("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else v.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ht.WILL_RECONNECT,(t,e,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(Ht.REQUEST_NEW_URLS,(t,e)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(e)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=us(this,Xs.CLIENT_LOCAL_VIDEO_TRACK),e={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,e);this._workerConnection.sendMessage(i,!0,!0)}else U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being published can be inspected")}async generateRequestData(t,e){let{appId:i,cname:s,cid:r,vid:a,sid:c,uid:l}=e;const u=Date.now(),h=await t.getCurrentFrameImage("image/jpeg",this.quality),f=await Tw(h,i,s),g=this._sequence+"-"+r+"-"+l+"-"+u+"-"+Be(12,""),S={appId:i,cid:r,cname:s,deviceId:"",elapse:KS.intToLong(Number(u-this._moderationStartTime)),fileSize:h.buffer.byteLength,height:h.height,width:h.width,jpg:f,networkType:6,osType:7,requestId:g,sdkVersion:"4.19.1",sequence:this._sequence,sid:c,timestamp:D4(u),uid:l,vid:a,service:this._moderationMode,ticket:this._ticket},w=C4(S);if(w.byteLength<this._workerMessageLengthLimit){if(U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(b){for(var M=1;M<arguments.length;M++){var F=arguments[M]!=null?arguments[M]:{};M%2?F0(Object(F),!0).forEach(function(V){m(b,V,F[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(F)):F0(Object(F)).forEach(function(V){Object.defineProperty(b,V,Object.getOwnPropertyDescriptor(F,V))})}return b}({},S);delete I.jpg,v.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return w}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:i,cname:s,cid:r,vid:a,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Zi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=hs.CLOSED,this.emit(Xs.STATE_CHANGE,Pa.CLOSED)}}function B0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function E_(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?B0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):B0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Vi extends LA{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,e;return(t=(e=this.peerConnection.getReceivers()[0])===null||e===void 0||(e=e.transport)===null||e===void 0?void 0:e.state)!==null&&t!==void 0?t:null}constructor(t,e,i){super(t,e),m(this,"direction",void 0),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"transportEventReceiver",void 0),m(this,"statsFilter",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"mutex",new qn("P2PConnection-mutex")),m(this,"dataChannel",void 0),m(this,"onLocalCandidate",void 0),this.store=e,this.peerConnection=new RTCPeerConnection(Vi.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.direction=i??qd.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=d_(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,$e()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{if(t){await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const e=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(e),!e.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return e.sdp}{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return await this.peerConnection.setLocalDescription(e),e.sdp}}catch(e){throw new Q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(t){try{await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(t){try{await this.peerConnection.addIceCandidate(t)}catch(e){throw new Q(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}async send(t){try{const e=[];t.forEach(r=>{const a=this.peerConnection.addTransceiver(r._mediaStreamTrack,{direction:"sendonly"});e.push(a)}),$e()&&U("SIMULCAST")===!0&&await this.applySimulcastForFirefox(e,t),await this.applySimulcastEncodings(e,t),await this.applySendEncodings(e,t);const i=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(i),!i.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const s=e.map(r=>{const a=this.getLocalSSRC(r.mid,i.sdp);if(!a)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:r.mid,localSSRC:[{ssrcId:a}]}});return{sdp:i.sdp,trackMessage:s}}catch(e){throw e instanceof Q?e:new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}}async stopSending(t,e){const i=e?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{const s=this.peerConnection.getTransceivers().filter(a=>t.indexOf(a.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));s.map(a=>{var c;a.direction="inactive",(c=a.stop)===null||c===void 0||c.call(a),this.peerConnection.removeTrack(a.sender)});const r=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(r),!r.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return r.sdp}catch(s){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,e,i){try{await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");await this.peerConnection.setLocalDescription(s),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."));const r=this.getRemoteMid(i,e);if(r===void 0)throw new Error("Cannot get transceiver mid when trying to receive track.");const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!a||a.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,sdp:s.sdp}}catch(s){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async setDescription(t,e){try{if(t==="remote"){await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return await this.peerConnection.setLocalDescription(i),v.debug("[".concat(this.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(t)),i.sdp}await this.peerConnection.setRemoteDescription({type:"answer",sdp:e})}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(i.toString()))}}async stopReceiving(t,e){try{const i=this.peerConnection.getTransceivers().filter(r=>t.indexOf(r.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(r=>{var a;r.direction="inactive",(a=r.stop)===null||a===void 0||a.call(r)}),await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(s),!s.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return s.sdp}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(){try{const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return this.store.descriptionStart(),await this.peerConnection.setLocalDescription(t),t.sdp}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){}async updateSendParameters(t,e){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(e)?$e()||await this.applySimulcastEncodings(i,[e]):await this.applySendEncodings(i,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getTransceivers().find(s=>s.mid===e);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const e=t[0].transport.iceTransport,{local:i,remote:s}=e.getSelectedCandidatePair();return{local:E_(E_({},vo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:E_(E_({},vo),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{var e;t.candidate&&((e=this.onLocalCandidate)===null||e===void 0||e.call(this,t.candidate)),t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Vd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...Vi.turnServerConfigToIceServers(t.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...Vi.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),U("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),U("ENABLE_ENCODED_TRANSFORM")&&Ke().supportWebRTCEncodedTransform&&(e.encodedInsertableStreams=!0),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.tcpport&&(e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(ih(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}),e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=udp")}),e.push({username:i.username,credential:i.password,credentialType:"password",urls:"stun:".concat(i.turnServerURL,":").concat(i.tcpport)}))}),e}tryBindTransportEvents(t){const e=t.transport;if(e){this.transportEventReceiver=t,e.onstatechange=()=>{var s;e!=null&&e.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,e.state))},e.onerror=s=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in s?s.error:s)};const i=e.iceTransport;i&&(i.onstatechange=()=>{const s=e==null?void 0:e.iceTransport.state;var r;s&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:r}=i.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,e){var i;if(e||(e=this.peerConnection.getSenders().find(h=>h.track===t._mediaStreamTrack)),!e)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ke().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},r={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var a;const{bitrateMax:h,frameRate:f,scaleResolutionDownBy:g}=t._encoderConfig;h&&(r.maxBitrate=1e3*h),Vt(a=t._hints).call(a,ze.LOW_STREAM)&&(f&&(r.maxFramerate=Vs(f)),g&&g>=1&&(r.scaleResolutionDownBy=g))}if(U("DSCP_TYPE")&&ba()){var c;const h=U("DSCP_TYPE");Vt(c=["very-low","low","medium","high"]).call(c,h)&&(r.networkPriority=h)}const l=e.getParameters(),u=(i=l.encodings)===null||i===void 0?void 0:i[0];$e()&&!u&&(s.encodings=[r]),u&&Object.assign(u,r),Object.assign(l,s),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await e.setParameters(l)}async applySendEncodings(t,e){try{if(!Ke().supportSetRtpSenderParameters||t.length!==e.length)return;for(let i=0;i<t.length;i++){const s=t[i],r=e[i];r instanceof ae&&!this.isVP8Simulcast(r)&&await this.updateRtpSenderEncodings(r,s.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e,i){const s=un.parse(t);return e.forEach((r,a)=>{const c=i[a],l=s.mediaDescriptions.find(u=>u.attributes.mid===c);l&&(qc(l,r),DS(l,r,this.store.codec))}),un.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;(e=this.onFirstVideoDecodedTimeout)===null||e===void 0||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let l=0;l<t.length;l++){var i,s,r,a,c;const u=t[l],h=e[l];if(h instanceof ae&&!Vt(i=h._hints).call(i,ze.LOW_STREAM)&&(s=h._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((r=h._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=h._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=h._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},g={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const S=u.sender.getParameters();await u.sender.setParameters(Object.assign(S,f))}}}async applySimulcastEncodings(t,e){if(!$e()&&t.length===e.length)for(let i=0;i<t.length;i++){const s=e[i];if(s instanceof ae&&this.isVP8Simulcast(s)){const r=t[i],a={},c={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=r.sender.getParameters();await r.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var e,i,s,r,a;return!!(t instanceof ae&&U("SIMULCAST")&&this.store.codec==="vp8"&&!Vt(e=t._hints).call(e,ze.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(r=t._scalabilityMode)!==null&&r!==void 0&&r.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,e,i,s){if(U("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(e," SDP during P2PConnection.").concat(s,`
`),t),e==="offer"?r=>{this.logSDPExchange(r,"answer",i==="local"?"remote":"local",s)}:void 0}getLocalSSRC(t,e){var i,s;if(e=(i=e)!==null&&i!==void 0?i:(s=this.currentLocalDescription)===null||s===void 0?void 0:s.sdp){var r;const a=(r=un.parse(e).mediaDescriptions.find(c=>c.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs;return a==null?void 0:a[0].ssrcId}}getRemoteMid(t,e){var i,s;if(e=(i=e)!==null&&i!==void 0?i:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var r;return(r=un.parse(e).mediaDescriptions.find(a=>a.attributes.ssrcs.some(c=>c.ssrcId===t)))===null||r===void 0?void 0:r.attributes.mid}}async getRemoteSSRC(t,e){var i,s;if(e=(i=e)!==null&&i!==void 0?i:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var r;const a=(r=un.parse(e).mediaDescriptions.find(c=>c.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs;return a==null?void 0:a[0].ssrcId}}}function Ir(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,r=await s.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return await i.apply(this,c)}finally{r()}},e}var sr;function j0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function za(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?j0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):j0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}tt([Ir,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Vi.prototype,"establish",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Vi.prototype,"connect",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[RTCIceCandidate]),A("design:returntype",K)],Vi.prototype,"addRemoteCandidate",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Vi.prototype,"send",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[String,String,Number]),A("design:returntype",K)],Vi.prototype,"receive",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[String,String]),A("design:returntype",K)],Vi.prototype,"setDescription",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[Array,String]),A("design:returntype",K)],Vi.prototype,"stopReceiving",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],Vi.prototype,"restartICE",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Vi.prototype,"close",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],Vi.prototype,"updateEncoderConfig",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[String,di]),A("design:returntype",K)],Vi.prototype,"updateSendParameters",null),tt([Ir,A("design:type",Function),A("design:paramtypes",[di,String]),A("design:returntype",K)],Vi.prototype,"replaceTrack",null),function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"}(sr||(sr={}));class dn extends Ze{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(xt.StateChange,e,this._state)}constructor(t,e){super(),m(this,"store",void 0),m(this,"statsUploader",void 0),m(this,"sendConnection",void 0),m(this,"recvConnection",void 0),m(this,"localTrackMap",new Map),m(this,"remoteUserMap",new Map),m(this,"localDataChannels",[]),m(this,"pendingLocalTracks",[]),m(this,"pendingRemoteTracks",[]),m(this,"statsCollector",void 0),m(this,"dtlsFailedCount",0),m(this,"sendMutex",new qn("P2PChannel2-send-mutex")),m(this,"recvMutex",new qn("P2PChannel2-recv-mutex")),m(this,"_state",Te.Disconnected),m(this,"_restartStates",["disconnected","failed"]),m(this,"_restartTimer",void 0),m(this,"handleMuteLocalTrack",async(i,s,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Te.Connected)return void r(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const u=this.filterTobeMutedTracks(i);if(u.length===0)return void s();const h=u.find(M=>M[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop();let f=!1;var c,l;i.trackMediaType==="video"?f=!((c=this.localTrackMap.get(it.LocalAudioTrack))===null||c===void 0||!c.track._muted):f=((l=this.localTrackMap.get(it.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const g=u.filter(M=>{let[F,V]=M;return(F!==it.LocalAudioTrack||f)&&V.id!==void 0}).map(M=>{let[,F]=M;return F});let S;g.length>0&&(S=await this.sendConnection.stopSending(g.map(M=>M.id)),g.forEach(M=>{M.id=void 0,M.ssrcs=void 0}));const w=this.createMuteMessage(u),I=i.trackMediaType==="video"?_o.MUTE_LOCAL_VIDEO:_o.MUTE_LOCAL_AUDIO,b=await rn(this,xt.RequestP2PMuteLocal,{action:I,sdp:S,message:w,isMuteAll:f});b&&await this.sendConnection.setDescription("local",b),(S||i.trackMediaType==="audio")&&await He(this,xt.RequestMuteLocal,w),s()}catch(u){r(u)}finally{a()}}),m(this,"handleUnmuteLocalTrack",async(i,s,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Te.Connected)return void r(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void s();const l=this.createUnmuteMessage(c),u=i.trackMediaType==="video"?_o.UNMUTE_LOCAL_VIDEO:_o.UNMUTE_LOCAL_AUDIO;await He(this,xt.RequestP2PMuteLocal,{action:u,message:l}),s()}catch(c){r(c)}finally{a()}}),m(this,"handleUpdateVideoEncoder",async(i,s,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const c=this.localTrackMap.get(it.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==i||this.state!==Te.Connected)return void s();const{id:l,track:u}=c;l&&(await this.sendConnection.updateSendParameters(l,u),await this.sendConnection.updateEncoderConfig(l,u),this.emit(xt.UpdateVideoEncoder,u)),s()}catch(c){r(c)}finally{a()}}),m(this,"handleSetOptimizationMode",async(i,s,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const c=this.localTrackMap.get(it.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==i||this.state!==Te.Connected)return;const{id:l,track:u}=c;l&&await this.sendConnection.updateSendParameters(l,u),s()}catch(c){r(c)}finally{a()}}),m(this,"handleReplaceTrack",async(i,s,r,a)=>{let c;v.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:g}]=f;return i===g});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==Te.Connected)return void s();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),h[0]===it.LocalVideoTrack&&Ke().supportDualStreamEncoding){const f=this.localTrackMap.get(it.LocalVideoLowTrack);if(f){const g=i._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=g,f.track._originMediaStreamTrack=g,await new K((S,w)=>{this.handleReplaceTrack(f.track,S,w,!0)})}}s()}catch(h){r(h)}finally{var u;(u=c)===null||u===void 0||u()}}),m(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),m(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),m(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),m(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new g0,this.bindStatsUploaderEvents()}async startP2PConnection(t,e){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t,e,i,s,r,a){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){if(this.state=Te.New,this.sendConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),this.recvConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),this.sendConnection=new Vi(t,this.store),this.bindConnectionEvents(this.sendConnection),this.recvConnection=new Vi(t,this.store,qd.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection),e){this.store.peerConnectionStart(),await this.recvConnection.establish(e);const i=await this.sendConnection.establish(e);return this.statsUploader.startUploadTransportStats(!0),this.statsUploader.startUploadExtensionUsageStats(),this.state=Te.Connected,i}return await this.recvConnection.establish(e),this.sendConnection.establish(e)}async p2pConnect(t){if(!this.sendConnection||!this.recvConnection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.recvConnection.connect(t),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Te.Connected}async addRemoteCandidate(t){if(!this.sendConnection||!this.recvConnection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t),await this.sendConnection.addRemoteCandidate(t)}async publish(t,e,i){if(!this.sendConnection||this.state!==Te.Connected){this.throwIfTrackTypeNotMatch(t);const a=t.filter(c=>this.pendingLocalTracks.indexOf(c)===-1);return void(this.pendingLocalTracks=this.pendingLocalTracks.concat(a))}this.store.pubId=this.store.pubId+1,li.markPublishStart(this.store.clientId,this.store.pubId);const s=this.filterTobePublishedTracks(t,e,i);if(s.length===0)return void await this.tryToUnmuteAudio(t);s.forEach(a=>{let{track:c,type:l}=a;const u=Date.now();this.store.publish(c.getTrackId(),l===it.LocalAudioTrack?"audio":"video",u)}),this.bindLocalTrackEvents(s);const r=this.createGatewayPublishMessage(s);return this.assignLocalTracks(s),s.forEach(a=>{let{track:c,type:l}=a;const u=Date.now();this.store.publish(c.getTrackId(),l===it.LocalAudioTrack?"audio":"video",void 0,u)}),r}async dopublish(t){if(!this.sendConnection||this.state!==Te.Connected)return;const e=this.localTrackMap.get(t);if(e){const{sdp:i,trackMessage:s}=await this.sendConnection.send([e.track]),{mid:r,localSSRC:a}=s[0];e.id=r,e.ssrcs=a,this.statsCollector.addLocalStats(t),this.statsUploader.startUploadUplinkStats();const c=await rn(this,xt.RequestP2PPublish,{kind:t===it.LocalAudioTrack?yt.AUDIO:yt.VIDEO,sdp:i,ssrcId:a[0].ssrcId});await this.sendConnection.setDescription("local",c);const l=this.createUnmuteMessage([[t,e]]);await He(this,xt.RequestUnmuteLocal,l)}}async setDescription(t,e){let i,s;t==="local"?(i=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection):(i=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection);try{return!s||this.state!==Te.Connected?void 0:await s.setDescription(t,e)}finally{i()}}publishLowStream(t){return tr(function*(){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await rn(this,xt.RequestRePublish,this.pendingLocalTracks),this.emit(xt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublish(t){if(!this.sendConnection||this.state!==Te.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(l=>!Vt(t).call(t,l)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;this.unbindLocalTrackEvents(e.map(l=>{let[u,{track:h}]=l;return{type:u,track:h}}));const i=e.filter(l=>{let[,{id:u}]=l;return u!==void 0});if(!this.sendConnection||this.state!==Te.Connected)return void t.forEach(l=>{const u=this.pendingLocalTracks.indexOf(l);u!==-1&&this.pendingLocalTracks.splice(u,1)});const s=e.find(l=>l[0]==="videoLowTrack");s&&s[1].track.close();let r;const a=this.createGatewayUnpublishMessage(e);i.length>0&&(r=await this.sendConnection.stopSending(i.map(l=>{let[,{id:u}]=l;return u}))),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(l=>{let[u,{track:h}]=l;return{type:u,track:h}})),e.forEach(l=>{let[u]=l;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats();const c=this.createMuteMessage(e);return await K.all(c.map(async l=>{await He(this,xt.RequestMuteLocal,[l])})),{sdp:r,unpubMsg:a}}async unpublishLowStream(){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async doUnpublish(t){if(!this.sendConnection||this.state!==Te.Connected)return;const e=[];if(t!==yt.AUDIO){const i=this.localTrackMap.get(it.LocalVideoTrack);(i==null?void 0:i.id)!==void 0&&e.push([it.LocalVideoTrack,i]);const s=this.localTrackMap.get(it.LocalVideoLowTrack);(s==null?void 0:s.id)!==void 0&&e.push([it.LocalVideoLowTrack,s]),this.statsCollector.removeLocalStats(it.LocalVideoTrack),this.statsCollector.removeLocalStats(it.LocalVideoLowTrack)}if(t!==yt.VIDEO){const i=this.localTrackMap.get(it.LocalAudioTrack);(i==null?void 0:i.id)!==void 0&&e.push([it.LocalAudioTrack,i]),this.statsCollector.removeLocalStats(it.LocalAudioTrack)}if(e.length>0){const i=await this.sendConnection.stopSending(e.map(a=>{let[,c]=a;return c.id}));e.forEach(a=>{let[,c]=a;c.id=void 0,c.ssrcs=void 0});const s=await rn(this,xt.RequestP2PUnPublish,{sdp:i,kind:t});await this.sendConnection.setDescription("local",s);const r=this.createMuteMessage(e);await K.all(r.map(async a=>{await He(this,xt.RequestMuteLocal,[a])}))}}async subscribe(t,e,i,s){var r;if(!this.recvConnection||this.state!==Te.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:a,mid:c,sdp:l}=await this.recvConnection.receive(e,i,s);e===yt.AUDIO?(t._audioSSRC=s,t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(a):(t._audioTrack=new Tr(a,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(a):(t._videoTrack=new mo(a,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._videoTrack));const u=this.remoteUserMap.get(t);u?u.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats(),await He(this,xt.RequestP2PUnmuteRemote,e);const h=this.pendingRemoteTracks.findIndex(f=>{let{user:g,kind:S}=f;return g.uid===t.uid&&e===S});return h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(xt.MediaReconnectEnd,t.uid)),l}async unsubscribe(t,e,i,s){const r=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return i!==void 0?u.uid===t.uid&&i===h:u.uid===t.uid});if(r.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.recvConnection&&this.state===Te.Connected||s||r.forEach(l=>{let{kind:u}=l;var h;if(u===yt.AUDIO)(h=t._audioTrack)===null||h===void 0||h._destroy(),t._audioTrack=void 0;else if(u===yt.VIDEO){var f;(f=t._videoTrack)===null||f===void 0||f._destroy(),t._videoTrack=void 0}}),!this.recvConnection||this.state!==Te.Connected)return;const a=this.filterTobeUnSubscribedTracks(t,i);if(a.length===0)return void(i!==yt.VIDEO&&He(this,xt.RequestP2PMuteRemote,yt.AUDIO));const c=await this.recvConnection.stopReceiving(a.map(l=>{let[,{id:u}]=l;return u}),e);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),a.forEach(l=>{let[u,{kind:h}]=l;var f,g;if(h===yt.VIDEO&&u._videoSSRC&&((f=this.recvConnection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===yt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),s||((g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0);else if(h===yt.AUDIO){var S;this.unbindRemoteTrackEvents(u._audioTrack),!s&&((S=u._audioTrack)===null||S===void 0||S._destroy(),u._audioTrack=void 0)}}),a.filter(l=>{let[,{kind:u}]=l;return u!==yt.AUDIO}).forEach(l=>{let[,{kind:u}]=l;He(this,xt.RequestP2PMuteRemote,u)}),i!==yt.VIDEO&&He(this,xt.RequestP2PMuteRemote,yt.AUDIO),c}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(e))return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const s=e===yt.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(e)||v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(it.LocalAudioTrack);if((e==null?void 0:e.track)instanceof bn){const i=e.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[r]=s;return r!==it.LocalAudioTrack}).filter(s=>{let[r]=s;return!(t&&r===it.LocalVideoLowTrack)}).map(s=>{let[,{track:r}]=s;return r}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===it.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(t,e,i,s,r){if(t){const c=this.localTrackMap.get(it.LocalAudioTrack),l=s?this.localTrackMap.get(it.LocalVideoLowTrack):this.localTrackMap.get(it.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;i||(i=[]);const c=i.find(u=>u instanceof Oe),l=s?(a=this.localTrackMap.get(it.LocalVideoTrack))===null||a===void 0?void 0:a.track:i.find(u=>u instanceof ae);wt.publish(this.store.sessionId,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,i,s){const r=s===yt.VIDEO?i._videoSSRC:i._audioSSRC;r&&wt.subscribe(this.store.sessionId,{succ:t,ec:e,video:s===yt.VIDEO,audio:s===yt.AUDIO,peerid:i.uid,subscribeRequestid:s===yt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:li.measureFromSubscribeStart(this.store.clientId,r)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new qn("P2PChannel2-send-mutex"),this.sendMutex=new qn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(it.LocalAudioTrack);if((t==null?void 0:t.track)instanceof bn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(i=>{e.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Te.Disconnected}getStats(t){var e,i;return t?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(it.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(it.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof ae||e&&e.track instanceof Oe?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}getRemoteMedia(t){var e;const i=Array.from(bs(e=this.remoteUserMap).call(e)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(it.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Su(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Te.Reconnecting,U("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var i;e._videoTrack&&e._videoTrack._player&&((i=e._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[i,{track:s}]=t;switch(i){case it.LocalVideoTrack:Vt(e=s._hints).call(e,ze.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case it.LocalAudioTrack:s instanceof bn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case it.LocalVideoLowTrack:}}),this.emit(xt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;Array.from(bs(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(e,s)}),this.emit(xt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const i of this.pendingRemoteTracks){const{user:s,kind:r}=i;if((t instanceof ui?t.uid:t)===s.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t){let e;e=t.direction===qd.SEND_ONLY?await this.sendMutex.lock("From P2PChannel.restartICE"):await this.recvMutex.lock("From P2PChannel.restartICE");try{const i=await t.restartICE(),s=await rn(this,xt.RequestP2PRestartICE,i);t.setDescription("local",s)}finally{e()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(it.LocalVideoTrack),i=this.localTrackMap.get(it.LocalAudioTrack),s=t.videoSend.find(w=>{var I;return w.ssrc===(e==null||(I=e.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}),r=t.audioSend.find(w=>{var I;return w.ssrc===(i==null||(I=i.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)});if(!s||!r)return 1;const a=us(this,xt.NeedSignalRTT),c=s?s.rttMs:void 0,l=r?r.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&a?(u+a)/2:u||a)||0,f=100*t.sendPacketLossRate*.7/50+.3*h/1500,g=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,S=e==null?void 0:e.track;if(S&&S._encoderConfig&&S._hints.indexOf(ze.SCREEN_TRACK)===-1){const w=S._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(w&&I){const b=(1e3*w-I)/(1e3*w);return RA[b<.15?0:b<.3?1:b<.45?2:b<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const r=s._audioSSRC,a=s._videoSSRC,c=t.audioRecv.find(I=>I.ssrc===r),l=t.videoRecv.find(I=>I.ssrc===a);if(!c&&!l)return void(e+=1);const u=us(this,xt.NeedSignalRTT),h=t.rtt,f=(h&&u?(h+u)/2:h||u)||0,g=c?c.jitterMs:void 0,S=t.recvPacketLossRate;let w=.7*S*100/50+.3*f/1500;g&&(w=.6*S*100/50+.2*f/1500+.2*g/400),e+=w<.1?1:w<.17?2:w<.36?3:w<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new K((e,i)=>{this.handleMuteLocalTrack(t,e,i)})}filterTobePublishedTracks(t,e,i){const s=[],r=Ke(),a=this.getAllTracks();t=Fd(t=t.filter(u=>a.indexOf(u)===-1));let c=!1,l=!1;for(const u of t){if(u instanceof ae&&(this.localTrackMap.has(it.LocalVideoTrack)||c?new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:u,type:it.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(u,i);s.push({track:h,type:it.LocalVideoLowTrack})}if(u instanceof Oe){const h=this.localTrackMap.get(it.LocalAudioTrack);if(h){if(!(h.track instanceof bn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){const f=s.find(g=>{let{type:S}=g;return S===it.LocalAudioTrack});if(!(f.track instanceof bn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(u)}else{if(!r.webAudioMediaStreamDest||u instanceof bn||u._bypassWebAudio)s.push({track:u,type:it.LocalAudioTrack});else{const f=new bn;f.addAudioTrack(u),s.push({track:f,type:it.LocalAudioTrack})}l=!0}}}return s}filterTobeUnpublishedTracks(t){const e=[],i=this.getAllTracks();t=Fd(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Oe){const r=this.localTrackMap.get(it.LocalAudioTrack);if(!r)continue;r.track instanceof bn?(r.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),r.track.trackList.length===0&&(e.push([it.LocalAudioTrack,r]),r.track.close())):e.push([it.LocalAudioTrack,r])}if(s instanceof ae){const r=this.localTrackMap.get(it.LocalVideoTrack);if(!r)continue;e.push([it.LocalVideoTrack,r]);const a=this.localTrackMap.get(it.LocalVideoLowTrack);a&&e.push([it.LocalVideoLowTrack,a])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:i,type:s}=e;switch(s){case it.LocalVideoTrack:i.addListener(St.GET_STATS,this.handleGetLocalVideoStats),i.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(St.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(St.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case it.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case it.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof bn?t.trackList.forEach(i=>{i.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(St.GET_STATS,this.handleGetLocalAudioStats),i.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(St.GET_STATS,this.handleGetLocalAudioStats),t.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(St.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[i,{track:s}]=e;return{track:s,type:i}})),t.forEach(e=>{let{track:i,type:s}=e;switch(s){case it.LocalVideoTrack:i.off(St.GET_STATS,this.handleGetLocalVideoStats),i.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(St.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(St.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case it.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case it.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof bn?t.trackList.forEach(e=>{e.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(St.GET_STATS,this.handleGetLocalAudioStats),e.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(St.GET_STATS,this.handleGetLocalAudioStats),t.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof mo&&e.addListener(St.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),e instanceof Tr&&e.addListener(St.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(St.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;i.has(yt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),i.has(yt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t){return t.map(e=>{var i;let s,r,{track:a,type:c}=e;switch(c){case it.LocalAudioTrack:s=ke.Audio,r={dtx:a instanceof Ma&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case it.LocalVideoTrack:s=Vt(i=a._hints).call(i,ze.SCREEN_TRACK)?ke.Screen:ke.High,r=za(za({},Qf(a)),{},{codec:this.store.codec});break;case it.LocalVideoLowTrack:s=ke.Low,r=za(za({},Qf(a)),{},{codec:this.store.codec})}return{kind:c===it.LocalAudioTrack?yt.AUDIO:yt.VIDEO,stream_type:s,attributes:r,isMuted:a.muted||!a.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case it.LocalVideoTrack:s=Vt(i=a._hints).call(i,ze.SCREEN_TRACK)?ke.Screen:ke.High;break;case it.LocalAudioTrack:s=ke.Audio;break;case it.LocalVideoLowTrack:s=ke.Low}return{stream_type:s,ssrcs:c,mid:l}})}assignLocalTracks(t){t.forEach(e=>{let{track:i,type:s}=e;this.localTrackMap.set(s,{track:i})})}withdrawLocalTracks(t){t.forEach(e=>{let[i]=e;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var i;if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(xt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),Vt(i=this._restartStates).call(i,e)||t.direction===qd.SEND_ONLY){if(this._restartTimer)return;const s=()=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE")),us(this,xt.QueryClientConnectionState)==="CONNECTED"&&this.restartICE(t))};this._restartTimer=window.setTimeout(()=>{s(),this._restartTimer=void 0},800)}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:sn.TRACER}).onSuccess(),this.emit(xt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var i;const s=Array.from(bs(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===e);var r;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(r=s.audioTrack)===null||r===void 0||r.emit(Mc.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_DECODE,tn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var i;const s=Array.from(bs(i=this.remoteUserMap).call(i)).find(r=>r._audioSSRC===e);s&&wt.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_RECEIVED,tn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,i,s)=>{this.reportVideoFirstFrameDecoded(e,i,s)},t.onFirstVideoReceived=e=>{var i;const s=Array.from(bs(i=this.remoteUserMap).call(i)).find(r=>r._videoSSRC===e);s&&wt.firstRemoteFrame(this.store.sessionId,Bn.FIRST_VIDEO_RECEIVED,tn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,i)=>{const s=e.candidateType==="relay",r=i.candidateType==="relay";i.candidateType!=="unknown"&&s===r||this.emit(xt.ConnectionTypeChange,s),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ga(i))," -> ").concat(JSON.stringify(Ga(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,i)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ga(i))," -> ").concat(JSON.stringify(Ga(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(xt.LocalCandidate,e)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const i=this.localTrackMap.get(it.LocalAudioTrack);if(t instanceof Oe&&(i==null?void 0:i.track)instanceof bn)return i.track.isActive||e.push([it.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(s&&(e.push(s),s[0]===it.LocalVideoTrack)){const r=this.localTrackMap.get(it.LocalVideoLowTrack);r&&e.push([it.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],i=this.localTrackMap.get(it.LocalAudioTrack);if(t instanceof Oe&&(i==null?void 0:i.track)instanceof bn)return i.track.isActive&&e.push([it.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(s)if(s[0]===it.LocalVideoTrack){e.push(s);const r=this.localTrackMap.get(it.LocalVideoLowTrack);r&&e.push([it.LocalVideoLowTrack,r])}else e.push(s);return e}createMuteMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case it.LocalAudioTrack:s=ke.Audio;break;case it.LocalVideoTrack:s=Vt(i=a._hints).call(i,ze.SCREEN_TRACK)?ke.Screen:ke.High;break;case it.LocalVideoLowTrack:s=ke.Low}return{stream_type:s,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var i;let s,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case it.LocalAudioTrack:s=ke.Audio;break;case it.LocalVideoTrack:s=Vt(i=a._hints).call(i,ze.SCREEN_TRACK)?ke.Screen:ke.High;break;case it.LocalVideoLowTrack:s=ke.Low}return{stream_type:s,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(e){const r=s.get(e);if(!r)return i;i.push([t,{kind:e,id:r}])}else Array.from(s.entries()).forEach(r=>{let[a,c]=r;i.push([t,{kind:a,id:c}])});return i}createUnsubscribeMessage(t){const e=[];return t.forEach(i=>{let[s,{kind:r,id:a}]=i;switch(r){case yt.VIDEO:return void(s._videoSSRC&&e.push({stream_type:yt.VIDEO,ssrcId:s._videoSSRC}));case yt.AUDIO:return void(s._audioSSRC&&e.push({stream_type:yt.AUDIO,ssrcId:s._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[i,{kind:s}]=e;const r=this.remoteUserMap.get(i);r&&(r.delete(s),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(it.LocalVideoTrack),i=this.localTrackMap.get(it.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),i&&t.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof Oe){const i=this.filterTobeUnmutedTracks(t[e]);if(i.length===0)continue;const s=this.createUnmuteMessage(i);return void await He(this,xt.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(xt.RequestUploadStats,t,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ri(uf(this.dtlsFailedCount,In)),this.emit(xt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(it.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof ae)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof ae).length>1)throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Oe).length>1&&(t.some(e=>e instanceof Oe&&e._bypassWebAudio)||!Ke().webAudioMediaStreamDest))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof ae&&this.pendingLocalTracks.some(i=>i instanceof ae))throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Oe&&this.pendingLocalTracks.some(i=>i instanceof Oe)&&(!Ke().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Oe&&i._bypassWebAudio)))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const i=!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding,s=za(za({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=i?t._mediaStreamTrack.clone():MS(t,s);const a=Be(8,"track-low-"),c=new ae(r,za(za({},i&&{scaleResolutionDownBy:ES(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,a);return c.on(Xd.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,La.LOW_STREAM)}),c._hints.push(ze.LOW_STREAM),t.addListener(St.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,i,s){var r;const a=Array.from(bs(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(a){s||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,Bn.FIRST_VIDEO_DECODE,tn.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:i,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,e,i){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const r=s.get(e);if(!r)return!1;const a=await this.recvConnection.getRemoteSSRC(r);return a!==void 0&&a!==i}resetConnection(t){v.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(t)),this.state===Te.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(t){throw new Q(O.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Q(O.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new Q(O.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new Q(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new Q(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new Q(O.NOT_SUPPORTED)}async preConnect(t,e,i,s,r,a){throw new Q(O.NOT_SUPPORTED)}getEstablishParams(){throw new Q(O.NOT_SUPPORTED)}async reSubscribe(t){throw new Q(O.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new Q(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:i}]=t;e===it.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,La.LOW_STREAM):i._updateRtpTransceiver(void 0)})}}function rr(n){return function(t,e,i){const s=t[e];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];switch(n){case sr.SEND_ONLY:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(e));try{return await s.apply(this,a)}finally{l()}}case sr.RECEIVE_ONLY:{const l=await this.recvMutex.lock("From P2PChannel2.".concat(e));try{return await s.apply(this,a)}finally{l()}}default:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(e)),u=await this.recvMutex.lock("From P2PChannel2.".concat(e));try{return await s.apply(this,a)}finally{l(),u()}}}},i}}function G0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function W0(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?G0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):G0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}tt([rr(),A("design:type",Function),A("design:paramtypes",[Object,String]),A("design:returntype",K)],dn.prototype,"startP2P",null),tt([rr(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],dn.prototype,"p2pConnect",null),tt([rr(sr.SEND_ONLY),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],dn.prototype,"dopublish",null),tt([rr(sr.SEND_ONLY),A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],dn.prototype,"unpublish",null),tt([rr(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],dn.prototype,"unpublishLowStream",null),tt([rr(sr.SEND_ONLY),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],dn.prototype,"doUnpublish",null),tt([rr(sr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[ui,String,String,Number]),A("design:returntype",K)],dn.prototype,"subscribe",null),tt([rr(sr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[ui,String,String,Boolean]),A("design:returntype",K)],dn.prototype,"unsubscribe",null),tt([rr(sr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[ui,String]),A("design:returntype",K)],dn.prototype,"muteRemote",null),tt([rr(sr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[ui,String]),A("design:returntype",K)],dn.prototype,"unmuteRemote",null),tt([rr(sr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[ui,String]),A("design:returntype",K)],dn.prototype,"hasRemoteMediaWithLock",null),tt([rr(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],dn.prototype,"disconnectForReconnect",null),tt([rr(sr.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[ui,String,Number]),A("design:returntype",K)],dn.prototype,"remoteMediaSsrcChanged",null);const P4=Date.now(),L4=20,qS=new Map,g_=new Map;async function H0(n){const t=qS.get(n),e=Array.isArray(t)&&t[t.length-1],i=g_.get(n);if(!e)return void(i.isSyncing=!1);const s={uid:e.uid,payload:af(e.payload)};i.firstRecvTs===0&&(i.firstRecvTs=e.recvTs,i.firstSendTs=e.sendTs);const r=e.sendTs-i.firstSendTs,a=r-(Date.now()-i.firstRecvTs);a>0&&(i.firstRecvTs=Date.now()-r);let c=e.mediaDelay+a;c<=0?(t.pop(),K0(e.context,s),c=0):c=Math.min(c,L4),setTimeout(()=>t.length&&H0(n),c)}function K0(n,t){n.safeEmit(le.STREAM_MESSAGE,t.uid,t.payload),n.onStreamMessage&&n.onStreamMessage(t)}function k4(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;if(!n.syncWithAudio)return K0(e,{uid:n.uid,payload:af(n.payload)});const i="".concat(e.id,"-").concat(n.uid),s=qS.get(i)||[],r=s.findIndex(u=>n.sendTs>=u.sendTs),a=W0(W0({},n),{},{context:e,mediaDelay:t,recvTs:Date.now()});r===-1?s.push(a):s.splice(r,0,a),qS.set(i,s);let c=!1;var l;g_.has(i)?c=!((l=g_.get(i))===null||l===void 0||!l.isSyncing):g_.set(i,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||H0(i)}function q0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function lh(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?q0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):q0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}qn.setLogger(v);class Ge extends Ze{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t){let e;if(super(),m(this,"store",void 0),m(this,"_uid",void 0),m(this,"_channelName",void 0),m(this,"_uintUid",void 0),m(this,"_users",[]),m(this,"_config",void 0),m(this,"_clientId",void 0),m(this,"_appId",void 0),m(this,"_sessionId",null),m(this,"_key",void 0),m(this,"_joinInfo",void 0),m(this,"_gateway",void 0),m(this,"_statsCollector",void 0),m(this,"_configDistribute",void 0),m(this,"_leaveMutex",new qn("client-leave")),m(this,"_publishMutex",new qn("client-publish")),m(this,"_renewTokenMutex",new qn("client-renewtoken")),m(this,"_subscribeMutex",new qn("client-subscribe")),m(this,"_encryptionMode","none"),m(this,"_encryptionSecret",null),m(this,"_encryptionSalt",null),m(this,"_proxyServer",void 0),m(this,"_turnServer",{servers:[],mode:"auto"}),m(this,"_cloudProxyServerMode","disabled"),m(this,"_isDualStreamEnabled",!1),m(this,"_defaultStreamFallbackType",void 0),m(this,"_lowStreamParameter",void 0),m(this,"_streamFallbackTypeCacheMap",new Map),m(this,"_remoteStreamTypeCacheMap",new Map),m(this,"_axiosCancelSource",Zi.CancelToken.source()),m(this,"_audioVolumeIndicationInterval",void 0),m(this,"_networkQualityInterval",void 0),m(this,"_userOfflineTimeout",void 0),m(this,"_streamRemovedTimeout",void 0),m(this,"_injectStreamingClient",void 0),m(this,"_liveTranscodeStreamingClient",void 0),m(this,"_liveRawStreamingClient",void 0),m(this,"_channelMediaRelayClient",void 0),m(this,"_networkQualitySensitivity","normal"),m(this,"_p2pChannel",void 0),m(this,"_useLocalAccessPoint",!1),m(this,"_setLocalAPVersion",void 0),m(this,"_joinAndNotLeaveYet",!1),m(this,"_numberOfJoinCount",0),m(this,"_remoteDefaultVideoStreamType",void 0),m(this,"_inspect",void 0),m(this,"_moderation",void 0),m(this,"_license",void 0),m(this,"_pendingPublishedUsers",[]),m(this,"ntpAlignErrorCount",0),m(this,"remoteInboundOffset",0),m(this,"_handleLocalTrackEnable",(i,s,r)=>{this.publish(i,!1).then(s).catch(r)}),m(this,"_handleLocalTrackDisable",(i,s,r)=>{this.unpublish(i).then(s).catch(r)}),m(this,"_handleUserOnline",i=>{if(U("BLOCK_LOCAL_CLIENT")&&Pc(i.uid,this.channelName))return void v.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&v.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(r=>r.uid===i.uid);if(s)s._trust_in_room_=!0;else{const r=new ui(i.uid,i.uint_id||i.uid);this._users.push(r),v.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(le.USER_JOINED,r)}}),m(this,"_handleUserOffline",i=>{if(U("BLOCK_LOCAL_CLIENT")&&Pc(i.uid,this.channelName))return;const s=this._users.find(r=>r.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),zg(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),v.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(le.USER_LEAVED,s,i.reason))}),m(this,"_handleAddAudioOrVideoStream",(i,s,r,a,c,l,u)=>{if(U("BLOCK_LOCAL_CLIENT")&&Pc(s,this.channelName))return;const h=this._users.find(g=>g.uid===s);if(!h)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(h.uid,i,void 0,void 0,void 0,Date.now());const f=i==="audio"?h.hasAudio:h.hasVideo;h._uintid||(h._uintid=c||s),i==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,i==="audio"?(h._audio_added_=!0,r!==void 0&&(h._audioSSRC=r),a!==void 0&&(h._cname=a),l&&(h._audioOrtc=l)):(h._video_added_=!0,r!==void 0&&(h._videoSSRC=r),a!==void 0&&(h._cname=a),u!==void 0&&(h._rtxSsrcId=u),l&&(h._videoOrtc=l)),(i==="audio"?h.hasAudio:h.hasVideo)&&!f&&(v.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(i)),this.safeEmit(le.USER_PUBLISHED,h,i)),i==="video"?wt.onGatewayStream(this._sessionId,Bn.ON_ADD_VIDEO_STREAM,tn.ON_ADD_VIDEO_STREAM,{peer:c||s,ssrc:h._videoSSRC}):wt.onGatewayStream(this._sessionId,Bn.ON_ADD_AUDIO_STREAM,tn.ON_ADD_AUDIO_STREAM,{peer:c||s,ssrc:h._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(h,i,r).then(g=>{if(g&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(h.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof oi))return this._p2pChannel.unsubscribe(h,i,!0).then(()=>this._subscribe(h,i,!0).catch(S=>{v.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(h,i)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,i,!0).catch(g=>{v.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),m(this,"_handleRemoveStream",(i,s,r)=>{if(U("BLOCK_LOCAL_CLIENT")&&Pc(i.uid,this.channelName))return;const a=this._users.find(l=>l.uid===i.uid);if(!a)return void v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));v.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let c=()=>{};if(a.hasAudio&&a.hasVideo?c=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(le.USER_UNPUBLISHED,a,"audio"),v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(le.USER_UNPUBLISHED,a,"video")}:a.hasVideo?c=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(le.USER_UNPUBLISHED,a,"video")}:a.hasAudio&&(c=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(le.USER_UNPUBLISHED,a,"audio")}),a._trust_audio_stream_added_state_=!0,a._trust_video_stream_added_state_=!0,a._audio_added_=!1,a._video_added_=!1,this._p2pChannel instanceof oi)this._p2pChannel.unsubscribe(a).then(l=>{if(l)return this._gateway.unsubscribe(l,a.uid)});else if(s&&r)if(i.sdp){const{sdp:l}=i;this._p2pChannel.unsubscribe(a,l).then(u=>{u&&s(u)}).catch(r)}else s&&s();a._audioSSRC=void 0,a._videoSSRC=void 0,a._audioOrtc=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0,wt.onGatewayStream(this._sessionId,Bn.ON_REMOVE_STREAM,tn.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),c()}),m(this,"_handleSetStreamLocalEnable",(i,s,r)=>{if(U("BLOCK_LOCAL_CLIENT")&&Pc(s,this.channelName))return;const a=this._users.find(u=>u.uid===s);if(!a)return void v.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));v.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(r?"enabled":"disabled"," with uid ").concat(s));const c=i==="audio"?a.hasAudio:a.hasVideo;if(i==="audio"){a._trust_audio_enabled_state_=!0;const u=a._audio_enabled_;if(a._audio_enabled_=r,a._audio_enabled_===u)return;{const h=a._audio_enabled_?"enable-local-audio":"disable-local-audio";v.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(h)),this.safeEmit(le.USER_INFO_UPDATED,s,h)}}else{a._trust_video_enabled_state_=!0;const u=a._video_enabled_;if(a._video_enabled_=r,a._video_enabled_===u)return;{const h=a._video_enabled_?"enable-local-video":"disable-local-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(h)),this.safeEmit(le.USER_INFO_UPDATED,s,h)}}const l=i==="audio"?a.hasAudio:a.hasVideo;return c!==l?!c&&l?(v.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(le.USER_PUBLISHED,a,i)):(i==="video"&&a._videoTrack&&a._videoTrack._destroy(),i==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,i),v.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(le.USER_UNPUBLISHED,a,i)):void 0}),m(this,"_handleMuteStream",(i,s,r,a,c,l)=>{if(U("BLOCK_LOCAL_CLIENT")&&Pc(i,this.channelName))return;v.debug("[".concat(this._clientId,"] receive mute message"),i,s,r);const u=this._users.find(g=>g.uid===i);if(!u)return void v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const h=s==="audio"?u.hasAudio:u.hasVideo;if(s==="audio"){u._trust_audio_mute_state_=!0;const g=u._audio_muted_;if(u._audio_muted_=r,u._audio_muted_===g)return;{const S=u._audio_muted_?"mute-audio":"unmute-audio";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(S)),this.safeEmit(le.USER_INFO_UPDATED,i,S)}}else{u._trust_video_mute_state_=!0;const g=u._video_muted_;if(u._video_muted_=r,u._video_muted_===g)return;{const S=u._video_muted_?"mute-video":"unmute-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(S)),this.safeEmit(le.USER_INFO_UPDATED,i,S)}}const f=s==="audio"?u.hasAudio:u.hasVideo;if(h!==f){if(!h&&f)return!this.store.useP2P&&!(s==="audio"?u._audioSSRC:u._videoSSRC)?void v.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet.")):(v.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(le.USER_PUBLISHED,u,s));s==="video"&&u._videoTrack&&u._videoTrack._destroy(),s==="audio"&&u._audioTrack,c&&l&&this._p2pChannel instanceof dn&&(a?this._p2pChannel.unsubscribe(u,a,s).then(g=>{c(g)}).catch(l):c()),this._p2pChannel.muteRemote(u,s),v.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(le.USER_UNPUBLISHED,u,s)}}),m(this,"_handleP2PLost",async i=>{v.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():v.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),m(this,"_handleTokenWillExpire",()=>{v.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(le.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),m(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),v.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),m(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(le.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(le.NETWORK_QUALITY,i)}),m(this,"_handleP2PAddAudioOrVideoStream",(i,s)=>{const r=this._users.find(c=>c.uid===s);if(!r)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(r.uid,i,void 0,void 0,void 0,Date.now());const a=i==="audio"?r.hasAudio:r.hasVideo;i==="audio"?r._trust_audio_stream_added_state_=!0:r._trust_video_stream_added_state_=!0,i==="audio"?r._audio_added_=!0:r._video_added_=!0,(i==="audio"?r.hasAudio:r.hasVideo)&&!a&&(v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published ").concat(i)),this.safeEmit(le.USER_PUBLISHED,r,i)),this._p2pChannel.hasPendingRemoteMedia(r,i)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(r.uid," after reconnect.")),this._subscribe(r,i,!0).catch(c=>{v.error("[".concat(this._clientId,"] resubscribe error"),c.toString())}))}),this._config=t,this._clientId=Be(5,"client-"),this.store=new jB(t.codec,t.audioCodec,t.mode,this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),v.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(zs," build: ").concat(gT,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{hb(t.clientRoleOptions),e=Object.assign({},t.clientRoleOptions)}catch(i){v.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new ol(this.store),this._statsCollector.onStatsException=(i,s,r)=>{v.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(r)),this.safeEmit(le.EXCEPTION,{code:i,msg:s,uid:r})},this._statsCollector.onUploadPublishDuration=(i,s,r,a)=>{const c=this._users.find(l=>l.uid===i);c&&wt.peerPublishStatus(this._sessionId,{subscribeElapse:a,audioPublishDuration:s,videoPublishDuration:r,peer:c._uintid})},this.store.useDataChannel=Ke().supportDataChannel&&U("SIGNAL_CHANNEL"),this.store.useP2P=U("P2P"),this._gateway=new H3(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||In,httpRetryConfig:t.httpRetryConfig||In,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:e}),this._configDistribute=new Z3,this.store.useP2P?(this._p2pChannel=new dn(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new oi(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,i,s,r){let a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];je("JOIN_GATEWAY_USE_443PORT_ONLY",a),je("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof xu&&(l.use443PortOnly=a,l.tryDoubleDomain=c),async function(u,h,f){tf.get(u)||tf.set(u,[]),ef.get(u)||ef.set(u,h),lo.get(u)||lo.set(u,0);const g=tf.get(u),S=ef.get(u);if(!g||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(lo.get(u)===S){const F=Ou();g.push(F),await F.promise}lo.set(u,lo.get(u)+1);for(var w=arguments.length,I=new Array(w>3?w-3:0),b=3;b<w;b++)I[b-3]=arguments[b];const M=await f(...I);return lo.set(u,lo.get(u)-1),lo.get(u)===S-1&&g.length>0&&(g[0].resolve(),g.shift()),lo.get(u)===0&&(tf.set(u,[]),ef.set(u,0),lo.set(u,0)),M}("client.join",U("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,i,s,r)}async join(t,e,i,s,r){const a=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const c=BB(),l=mA()?window.isSecureContext:"Browser Not Support";if(!mA()&&!c||!window.isSecureContext){const I="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";v.warning(I)}const u=Jg();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),v.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const h=wt.reportApiInvoke(u,{name:wn.JOIN,options:[t,e,i,s],states:{isHttps:c,isSecureContext:l},tag:sn.TRACER});wt.setAppId(t);try{if(!i&&i!==null)throw new j(O.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&ai(i,"token",1,2047),ai(t,"appid",1,2047),CT(e),s&&yT(s),r&&ai(r,"optionalInfo",1,2047)}catch(I){throw h.onError(I),I}if(v.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(a)),this._leaveMutex.isLocked&&(v.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),v.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const I=new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw h.onError(I),I}this._sessionId||(this._sessionId=u,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const f=lh({clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(f.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(f.stringUid=s,this._uintUid?(f.uid=this._uintUid,this._uintUid=void 0):f.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(f.aesmode=this._encryptionMode,f.aespassword=await zF(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(f.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:e,appId:t});const g=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&g===this._sessionId&&wt.joinChannelTimeout(this._sessionId,5)},5e3);try{var S;let I;const b=f.cloudProxyServer;if(Vt(S=["proxy3","proxy4","proxy5"]).call(S,b)){const Z=U("PROXY_SERVER_TYPE3");Array.isArray(Z)?f.proxyServer=Z[0]:f.proxyServer=Z}if(wt.setProxyServer(f.proxyServer),v.setProxyServer(f.proxyServer),this.store.requestAPStart(),f.stringUid&&!f.uid){const Z=await DO(f.stringUid,f,this._axiosCancelSource.token,this._config.httpRetryConfig||In,this.store);v.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(f.stringUid," => ").concat(Z)),f.uid=Z,I=await NO(f,this._axiosCancelSource.token,this._config.httpRetryConfig||In,!0,this.store)}else I=await NO(f,this._axiosCancelSource.token,this._config.httpRetryConfig||In,!0,this.store);if(!this._joinAndNotLeaveYet)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(f,this._axiosCancelSource.token),this._configDistribute.on(Uu.UPDATE_BITRATE_LIMIT,Z=>{this._p2pChannel.updateBitrateLimit(Z)})},0),this._key=i||t;const M=I.gatewayInfo;this._joinInfo=lh(lh({},f),{},{cid:M.cid,uid:f.uid?f.uid:M.uid,vid:M.vid,apResponse:M.res,uni_lbs_ip:M.uni_lbs_ip,gatewayAddrs:M.gatewayAddrs});const F=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));h.onSuccess(F),this._appId=t,this._channelName=f.cname,this._uid=F,this.store.uid=F,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Pi()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const V=f.stringUid?"string uid: ".concat(f.stringUid,",uid: ").concat(f.uid):"uid: ".concat(this._uid);return v.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(V)),setTimeout(()=>{v.startUpload()},5e3),this.store.joinEnd(),w=this,Vt(Oa).call(Oa,w)||Oa.push(w),F}catch(I){const b=Array.isArray(I)?I[0]:I;throw b&&b.code===O.OPERATION_ABORTED?v.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),b):v.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),b),b.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),h.onError(b),b}var w}_joinGateway(){if(!this._joinInfo||!this._key)throw new j(O.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!U("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(t=>t).catch(t=>{if(t.code===O.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,ce.FALLBACK),t;if(t.code===O.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,ce.FALLBACK),t;throw t}).then(t=>{if(t instanceof j){if(t.code===O.INIT_WEBSOCKET_TIMEOUT){if(v.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new j(O.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const e=U("PROXY_SERVER_TYPE3");if(Array.isArray(e))if(this._joinInfo.apUrl){const s=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),r=s.slice(s.length-2).join(".");e.forEach(a=>{this._joinInfo&&Vt(a).call(a,r)&&(this._joinInfo.proxyServer=a)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;const i=U("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return i&&i[1]&&i[1]!=="443"&&v.setProxyServer(this._joinInfo.proxyServer),U("STATS_COLLECTOR_PORT").toString()!=="443"&&wt.setProxyServer(this._joinInfo.proxyServer),wt.reportApiInvoke(this._sessionId,{name:wn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:sn.TRACER}).onSuccess(),this.safeEmit(le.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),U("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(s=>{"forceturn"in s&&(s.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(v.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new j(O.INVALID_OPERATION);return wt.reportApiInvoke(this._sessionId,{name:wn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:sn.TRACER}).onSuccess(),this._joinGateway()}return t}).then(t=>t)}async leave(){v.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Pi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const i=Oa.indexOf(e);i!==-1&&Oa.splice(i,1)}(this);const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return v.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED"),v.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof di))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new j(O.INVALID_PARAMS,"param list is empty");const i=t;if(this._gateway.role==="audience")throw new j(O.INVALID_OPERATION,"audience can not publish stream");for(const r of i){if(!(r instanceof di))throw new j(O.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new j(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}v.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(r=>"".concat(r.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&i.forEach(r=>{const a=this._configDistribute.getBitrateLimit();r instanceof ae&&a&&r.setBitrateLimit(a.uplink)});try{await this._publishHighStream(i),v.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw v.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{s()}}async _publishDataChannel(t){Fe(t.id,"id",0,65535,!0),Ac(t.ordered,"ordered"),ai(t.metadata,"metadata",0,512),v.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(s=>s.id===t.id)!==-1)throw new j(O.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new j(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&U("FORCE_TURN")&&!U("TURN_ENABLE_TCP")&&!U("TURN_ENABLE_UDP"))throw new j(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=new uO(t);await this._p2pChannel.publishDataChannel([i]);try{const s={streamId:t.id,ordered:t.ordered,maxRetransmits:U("DATASTREAM_MAX_RETRANSMITS"),metadata:t.metadata,channelId:i._originDataChannelId};await this._gateway.publishDataChannel(this._uid,s,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw s}return await i._waitTillOpen(),v.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw v.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new j(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof di))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);v.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof dn){const s=await this._p2pChannel.unpublish(e);if(s){const r=await this._gateway.sendExtensionMessage(qe.UNPUBLISH,s);r&&await this._p2pChannel.setDescription("local",r)}}else{const s=await this._p2pChannel.unpublish(e);s&&await this._gateway.unpublish(s,this._uid),v.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(s){throw v.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),v.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(i=>"".concat(i.id," "))," "));const e=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(t);i&&await this._gateway.unpublishDataChannel(i),v.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(s=>"".concat(s.id))))}catch(i){throw v.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{e&&e()}}async subscribe(t,e,i){return e==="datachannel"?this._subscribeDataChannel(t,i):this._subscribe(t,e)}async _subscribeDataChannel(t,e){var i;if(Fe(e,"channelId",0,65535,!0),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===t))throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new j(O.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new j(O.INVALID_REMOTE_USER,"user is not published");const s=(i=t._dataChannels)===null||i===void 0?void 0:i.find(c=>c.id===e);if(!s)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new j(O.REMOTE_USER_IS_NOT_PUBLISHED);const r=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(t,[s]);if(c&&Vt(c).call(c,s.id))try{var a;if(!s._originDataChannelId)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new j(O.REMOTE_USER_IS_NOT_PUBLISHED);const l={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(a=s.metadata)!==null&&a!==void 0?a:""};await this._gateway.subscribeDataChannel(t.uid,l,!0)}catch(l){if((l==null?void 0:l.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[s]),l;await this._p2pChannel.unsubscribeDataChannel(t,[s]),this._p2pChannel.setPendingRemoteDataChannel(t,s.id)}return await s._waitTillOpen(),v.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),s}finally{r()}}async _p2pSubscribe(t,e,i){if(Vn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===t)){const a=new j(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),a}if(!t.hasAudio&&!t.hasVideo){const a=new j(O.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),a}if(!i&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const a=new j(O.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),a}const s=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));const r=e==="audio"?it.LocalAudioTrack:this._joinInfo.defaultVideoStream===Of.LOW_STREAM?it.LocalVideoLowTrack:it.LocalVideoTrack;try{await this._p2pChannel.hasRemoteMediaWithLock(t,e)?await this._p2pChannel.unmuteRemote(t,e):(this.store.subscribe(t.uid,e,Date.now()),this._p2pChannel instanceof dn&&await this._gateway.sendExtensionMessage(qe.SUBSCRIBE,{trackType:r})),v.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const a=e==="audio"?t._audioTrack:t._videoTrack;if(!a)throw new j(O.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),a),a}finally{s()}}async _subscribe(t,e,i){if(this._p2pChannel instanceof dn)return this._p2pSubscribe(t,e);if(Vn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new j(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new j(O.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!(i||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const u=new j(O.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),u}let s=e==="audio"?t._audioSSRC:t._videoSSRC,r=e==="audio"?t._audioOrtc:t._videoOrtc,a=e==="video"?t._rtxSsrcId:void 0,c={stream_type:e==="audio"?yt.AUDIO:yt.VIDEO,ssrcId:s};const l=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const h=e==="audio"?t._audioSSRC:t._videoSSRC;h!==void 0&&h!==s&&(s=h,r=e==="audio"?t._audioOrtc:t._videoOrtc,a=e==="video"?t._rtxSsrcId:void 0,c={stream_type:e==="audio"?yt.AUDIO:yt.VIDEO,ssrcId:s}),li.markSubscribeStart(this.store.clientId,s),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,s,a,r);try{await this._gateway.subscribe(t.uid,c,!0)}catch(f){if((f==null?void 0:f.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),f;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(h){throw this._p2pChannel.reportSubscribeEvent(!1,h==null?void 0:h.code,t,e),h}v.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=e==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new j(O.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{l()}}async massSubscribe(t){if(qo(t,"subscribeList"),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),i=new Map,s=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:u,mediaType:h}=l;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(h)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:u,mediaType:h}=l;return{user:u,mediaType:h}}),a=await this._p2pChannel.globalLock();try{var c;for(let u=t.length-1;u>=0;u--){const h=t[u],{user:f,mediaType:g}=h;if(Vn(g,"mediaType",["audio","video"]),!f){const I=new j(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===f)){const I=new j(O.INVALID_REMOTE_USER,"user is not in the channel");v.error("[".concat(this._clientId,"] can not massSubscribe ").concat(f.uid,", this user is not in the channel")),r[u].error=I,t.splice(u,1);continue}if(g==="audio"&&(!f.hasAudio||f._audioSSRC===void 0)||g==="video"&&(!f.hasVideo||f._videoSSRC===void 0)){const I=new j(O.REMOTE_USER_IS_NOT_PUBLISHED);v.error("[".concat(this._clientId,"] can not subscribe ").concat(f.uid," with mediaType ").concat(g,", remote user is not published")),r[u].error=I,t.splice(u,1);continue}const S=On.Video|On.LwoVideo,w=i.get(f);if(w){if(g==="video"?w&S:w&On.Audio){t.splice(u,1),v.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(f.uid,", mediaType:").concat(g," twice"));continue}i.set(f,w|(g==="video"?S:On.Audio))}else i.set(f,g==="video"?S:On.Audio)}for(let u=t.length-1;u>=0;u--){const h=t[u],{user:f,mediaType:g}=h,S=On.Video|On.LwoVideo;if(this._p2pChannel.hasRemoteMedia(f,g)){await this._p2pChannel.unmuteRemoteNoLock(f,g);const w=i.get(f);i.set(f,g==="video"?w^S:w^On.Audio),t.splice(u,1)}}this.store.massSubscribe(t.map(u=>({userId:u.user.uid,type:u.mediaType})),e);const l=Nc(c=Array.from(i.entries())).call(c,(u,h)=>{let[f,g]=h;if(g===0)return u;const S={stream_id:f.uid,stream_type:g};return g&On.Audio&&(S.audio_ssrc=f._audioSSRC),g&On.Video&&(S.video_ssrc=f._videoSSRC),u.push(S),u},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(h=>{let{user:f,mediaType:g}=h;return{user:f,mediaType:g,ssrcId:g===yt.VIDEO?f._videoSSRC:f._audioSSRC,rtxSsrcId:g===yt.VIDEO?f._rtxSsrcId:void 0}}));const u=new Map;if(l.length>0){const h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(f=>{let{stream_id:g,video_error_code:S,audio_error_code:w,error_code:I}=f;(S||w||I)&&u.set(g,{video_error_code:S,audio_error_code:w,error_code:I})})}if(Array.from(u.entries()).length>0){const h=Array.from(u.entries()).map(f=>{let g,[S,w]=f;return w.error_code||w.video_error_code&&w.audio_error_code?g=void 0:w.video_error_code?g=yt.VIDEO:w.audio_error_code&&(g=yt.AUDIO),{user:this.remoteUsers.find(I=>I.uid===S),mediaType:g}});await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of r){const f=u.get(h.user.uid);if(f){const g=f.error_code||h.mediaType==="audio"&&f.audio_error_code||h.mediaType==="video"&&f.video_error_code;if(g){const S=kc(g);v.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(S.desc)),h.error=new j(O.SUBSCRIBE_FAILED,"code ".concat(g,": ").concat(S.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var f;wt.subscribe(this.store.sessionId,{succ:!!h.error,ec:((f=h.error)===null||f===void 0?void 0:f.code)||null,video:h.mediaType===yt.VIDEO,audio:h.mediaType===yt.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===yt.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e)},!0)}),v.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(h=>{let{user:f,mediaType:g}=h;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(g)}).join("; "))),r}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(t),u}}finally{a(),s()}}async unsubscribe(t,e,i){if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,i)}else await this._unsubscribeDataChannel(t,i);if(e&&Vn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new j(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const s=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof dn)await this._gateway.sendExtensionMessage(qe.UNSUBSCRIBE,{mediaType:e});else{const r=await this._p2pChannel.unsubscribe(t,e);r&&await this._gateway.unsubscribe(r,t.uid),v.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(r){if(r.code===O.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}finally{s()}}async _unsubscribeDataChannel(t,e){if(e&&Fe(e,"id",0,65535,!0),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new j(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}let i;if(typeof e=="number"){const s=t._dataChannels.find(r=>r.id===e);s&&(i=[s])}else i=t._dataChannels;if(i===void 0){const s=new j(O.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),s}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(s=>s.id)));try{const s=await this._p2pChannel.unsubscribeDataChannel(t,i);s&&await this._gateway.unsubscribeDataChannel(s,t.uid),v.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===O.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}}async massUnsubscribe(t){if(qo(t,"unsubscribeList"),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");v.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(i=>{let{user:s,mediaType:r}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let i=t.length-1;i>=0;i--){const{user:s,mediaType:r}=t[i];if(!s){const c=new j(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(Vn(r,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===s)){v.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),t.splice(i,1);continue}const a=On.Video|On.LwoVideo;if(e.has(s)){const c=e.get(s);let l;switch(r){case"video":l=c&a;break;case"audio":l=c&On.Audio;break;default:l=c&(On.Audio|a)}if(l){v.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(r," twice.")),t.splice(i,1);continue}r?r==="audio"?e.set(s,c|On.Audio):r==="video"&&e.set(s,c|a):e.set(s,c|On.Audio|a)}else r?r==="audio"?e.set(s,On.Audio):r==="video"&&e.set(s,a):e.set(s,On.Audio|a)}try{const i=await this._p2pChannel.massUnsubscribe(t);i&&await this._gateway.massUnsubscribe(i),v.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(s=>{let{user:r,mediaType:a}=s;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(a,";")}).join()))}catch(i){if(i.code===O.DISCONNECT_P2P)return void v.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw v.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(t){(function(i){if(!i)throw new Q(O.INVALID_PARAMS);nn(i.width)||Kg(i.width,"streamParameter.width"),nn(i.height)||Kg(i.height,"streamParameter.height"),nn(i.framerate)||Kg(i.framerate,"streamParameter.framerate"),nn(i.bitrate)||Fe(i.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&v.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),v.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,it.LocalVideoLowTrack)}async enableDualStream(){if(!Ke().supportDualStream)throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new j(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new j(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),v.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(it.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),v.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){Vn(i,"role",["audience","host"])}(t),e&&hb(e),this.mode==="rtc")throw v.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new j(O.INVALID_OPERATION,"rtc mode can not use setClientRole");if(e&&e.level&&t==="host")throw new j(O.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new j(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(t,e),this._config.role=t,v.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const i=e.timestamp-Date.now();return Math.abs(i)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(ai(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new j(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,wt.setProxyServer(this._proxyServer),v.setProxyServer(this._proxyServer),v.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new j(O.INVALID_OPERATION,"You have already set the proxy")}if(Vd(t))return this._turnServer={servers:t,mode:"original-manual"},void v.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(i=>i.urls).join(","),"."));t.forEach(i=>ub(i)),this._turnServer={servers:t,mode:"manual"},v.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"you should set license before join channel");if(ai(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new j(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,v.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new j(O.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let i;switch(t===void 0&&(t=3),t){case 1:case 2:throw new j(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new j(O.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new j(O.INVALID_OPERATION,"Stop proxy server after leave channel");wt.setProxyServer(),v.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new j(O.INVALID_PARAMS,"accessPoints is required.");qo(t.accessPoints.serverList,"accessPoints.serverList"),ai(t.accessPoints.domain,"accessPoints.domain");const e=(S,w)=>{Fe(S,w,0,65535,!0)};let i=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),i=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new j(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");U("CLOSE_AFB_FOR_LOCAL_AP")&&(je("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),je("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,a=t.accessPoints.serverList.map(S=>s.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(r):S),c=a.map(S=>"".concat(S,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,je("WEBCS_DOMAIN",c),je("WEBCS_DOMAIN_BACKUP_LIST",c),je("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(qo(t.report.hostname,"report.hostname"),je("EVENT_REPORT_DOMAIN",t.report.hostname[0]),je("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(je("EVENT_REPORT_DOMAIN",a[0]),je("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),je("STATS_COLLECTOR_PORT",l),t.report?je("ENABLE_EVENT_REPORT",!0):je("ENABLE_EVENT_REPORT",!1);let u="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(qo(t.log.hostname,"log.hostname"),u=t.log.hostname[0]):u=a[0];let h=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),h=t.log.port),je("LOG_UPLOAD_SERVER","".concat(u,":").concat(h));let f=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(qo(t.cds.hostname,"cds.hostname"),f=t.cds.hostname):f=a;let g=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),g=t.cds.port),je("CDS_AP",f.map(S=>"".concat(S,":").concat(g))),t.cds?je("ENABLE_CONFIG_DISTRIBUTE",!0):je("ENABLE_CONFIG_DISTRIBUTE",!1),v.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(qo(t,"serverList"),ai(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new j(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(e):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,je("WEBCS_DOMAIN",t),je("WEBCS_DOMAIN_BACKUP_LIST",t),je("GATEWAY_DOMAINS",[e]),je("EVENT_REPORT_DOMAIN",t[0]),je("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),je("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),v.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Vn(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw v.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else v.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Vn(e,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const i=this._users.find(s=>s.uid===t);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw v.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}v.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Vn(e,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(i){throw v.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}v.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,i){(function(r){Vn(r,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ai(e,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(Vt(s).call(s,t)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new j(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new j(O.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||v.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,i&&(this._encryptionSalt=cf(i))}async renewToken(t){if(ai(t,"token",1,2047),!this._key||!this._joinInfo)throw new j(O.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const i=await this._renewTokenMutex.lock();try{if(U("USE_NEW_TOKEN")){v.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await Q3(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||In);v.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:s})}else v.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});v.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=e,this._joinInfo.token=e,v.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?v.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(le.VOLUME_INDICATOR,t)},U("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new j(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new j(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new j(O.LIVE_STREAMING_TASK_CONFLICT);const i=e?Mn.TRANSCODE:Mn.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(t,i)}setLiveTranscoding(t){return this._createLiveStreamingClient(Mn.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(t));if(!e.length)throw new j(O.INVALID_PARAMS,"can not find live streaming url to stop");await K.all(e.map(i=>i&&i.stopLiveStreamingTask(t)))}async addInjectStreamUrl(t,e){if(!this._joinInfo)throw new j(O.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const i=this._createLiveStreamingClient(Mn.INJECT);i.setInjectStreamConfig(e,0),await i.startLiveStreamingTask(t,Mn.INJECT)}async removeInjectStreamUrl(){var t;const e=this._createLiveStreamingClient(Mn.INJECT),i=Array.from(po(t=e.streamingTasks).call(t)).find(s=>s.mode===Mn.INJECT);if(!this._joinInfo||!i)throw new j(O.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await e.stopLiveStreamingTask(i.url)}async startChannelMediaRelay(t){VO(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){VO(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new j(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const i=new TextEncoder;t.payload=i.encode(t.payload)}if(new Blob([t.payload]).size>1024)throw new j(O.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(At.DATA_STREAM,{payload:cf(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-P4},!e)}sendMetadata(t){if(!this._joinInfo)throw new j(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new j(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(At.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:cf(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(WB),!this._joinInfo)throw new j(O.INVALID_OPERATION,"can not send custom report, not joined");await wt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Vn(e.spatialLayer,"spatialLayer",[0,1,2,3]),Vn(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(i){throw v.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}setRTM2Flag(t){if(Vn(t,"flag",[0,1]),!this._joinInfo)throw new j(O.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(t)}_reset(){if(v.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Zi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new qn("client-publish"),this._subscribeMutex=new qn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){const i=t||Jg();t?v.debug("[".concat(this._clientId,"] new Session ").concat(i)):v.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i)),this._sessionId=i,this.store.sessionId=i,e?wt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:e.channel,appid:e.appId,mode:this.mode}):this._joinInfo?wt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&wt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new j(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&U("FORCE_TURN")&&!U("TURN_ENABLE_TCP")&&!U("TURN_ENABLE_UDP"))throw new j(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");v.debug("[".concat(this._clientId,"] publish high stream"));try{if(this._p2pChannel instanceof dn){const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(i)try{await this._gateway.sendExtensionMessage(qe.PUBLISH,i)}catch(s){throw this._p2pChannel.unpublish(t),s}}else{const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter),s=(await i.next()).value;if(s){var e;let r;try{r=await this._gateway.publish(this._uid,s,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw i.throw(a),a}await i.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof ae&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,t),(i==null?void 0:i.code)===O.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new j(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));v.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var e;let r;try{r=await this._gateway.publish(this._uid,s,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw i.throw(a),a}i.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===O.WS_ABORT)return;throw i}}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new j(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=()=>new e4(this._joinInfo,this._config.websocketRetryConfig||In,this._config.httpRetryConfig||In),i=s=>{s.onLiveStreamError=(r,a)=>{wt.reportApiInvoke(this._sessionId,{name:wn.ON_LIVE_STREAM_ERROR,options:[r,a],tag:sn.TRACER}).onSuccess(),this.safeEmit(le.LIVE_STREAMING_ERROR,r,a)},s.onLiveStreamWarning=(r,a)=>{wt.reportApiInvoke(this._sessionId,{name:wn.ON_LIVE_STREAM_WARNING,options:[r,a],tag:sn.TRACER}).onSuccess(),this.safeEmit(le.LIVE_STREAMING_WARNING,r,a)},s.on(Yd.REQUEST_WORKER_MANAGER_LIST,(r,a,c)=>{if(!this._joinInfo)return c(new j(O.INVALID_OPERATION,"can not find join info to get worker manager"));LO(r,this._joinInfo,this._axiosCancelSource.token,In).then(a).catch(c)})};switch(t){case Mn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=e(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Mn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=e(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Mn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=e(),this._injectStreamingClient.on(Yd.REQUEST_WORKER_MANAGER_LIST,(s,r,a)=>{if(!this._joinInfo)return a(new j(O.INVALID_OPERATION,"can not find join info to get worker manager"));LO(s,this._joinInfo,this._axiosCancelSource.token,In).then(r).catch(a)}),this._injectStreamingClient.onInjectStatusChange=(s,r,a)=>{this.safeEmit(le.INJECT_STREAM_STATUS,s,r,a)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new j(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:e}=this.getLocalVideoStats(),i={width:t,height:e};this._channelMediaRelayClient=new i4(this._joinInfo,this._clientId,this._config.websocketRetryConfig||In,this._config.httpRetryConfig||In,i),this._channelMediaRelayClient.on("state",s=>{s===Ui.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(le.CHANNEL_MEDIA_RELAY_STATE,s)}),this._channelMediaRelayClient.on("event",s=>{this.safeEmit(le.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._statsCollector.onStatsChanged=(s,r)=>{var a;s==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(r))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:i,deleted:s}=t,r=[];Array.isArray(i)&&i.length>0&&i.forEach(a=>{const{uid:c,stream_id:l,ordered:u,max_retrans_times:h,metadata:f}=a,g=this._users.find(S=>S._uintid===c);if(!g)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(v.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),Vt(r).call(r,g)||r.push(g),g._uintid||(g._uintid=c),g._dataChannels.findIndex(S=>S.id===a.stream_id)===-1){const S={id:l,ordered:!!u,maxRetransmits:h,metadata:f},w=new F3(S);g._dataChannels.push(w),v.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published datachannel")),e||this.safeEmit(le.USER_PUBLISHED,g,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(g,a.stream_id)&&(v.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(g.uid," after reconnect.")),this._subscribeDataChannel(g,a.stream_id).catch(S=>{v.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),e&&(this.safeEmit(le.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(a=>{const{uid:c,stream_id:l}=a,u=this._users.find(f=>f._uintid===c);if(!u)return void v.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=u._dataChannels.find(f=>f.id===a.stream_id);h&&(v.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(u,[h]).then(f=>{if(f)return u._dataChannels=u._dataChannels.filter(g=>g!==h),this._gateway.unsubscribeDataChannel(f,u.uid)}),v.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(le.USER_UNPUBLISHED,u,"datachannel",h._config))})}_handleRemoveDataChannels(t){const e=this._users.find(i=>i.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){v.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const i=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(s=>{this.safeEmit(le.USER_UNPUBLISHED,e,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,e.uid)}),i()}}else v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(cn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(cn.CONNECTION_STATE_CHANGE,(t,e,i)=>{var s;if(i===ce.FALLBACK)return;const r=()=>{this.safeEmit(le.CONNECTION_STATE_CHANGE,t,e,i)};if(wt.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:wn.CONNECTION_STATE_CHANGE,options:[t,e,i],tag:sn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:i})),v.info("[".concat(this._clientId,"] connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._audioSSRC=void 0,c._videoSSRC=void 0,c._videoOrtc=void 0,c._audioOrtc=void 0,c._cname=void 0,c._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(u=>{v.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(u=>{v.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{v.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{v.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{v.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,yt.AUDIO,!1)),c._trust_video_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,yt.VIDEO,!1)),c._trust_audio_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(v.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(cn.REQUEST_NEW_GATEWAY_LIST,(t,e)=>{if(!this._joinInfo)return e(new j(O.UNEXPECTED_ERROR,"can not recover, no join info"));IS(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||In,this.store).then(i=>{this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const s=[];i.gatewayInfo.gatewayAddrs.forEach(r=>{let{address:a}=r;const[c,l]=a.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:c,port:l}):s.push({host:c,port:l})}),t(s)}).catch(e)}),this._gateway.on(cn.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(le.NETWORK_QUALITY,t)}),this._gateway.on(cn.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(le.STREAM_TYPE_CHANGED,t,e),wt.reportApiInvoke(this._sessionId,{name:wn.STREAM_TYPE_CHANGE,options:[t,e],tag:sn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(cn.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(cn.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(cn.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,i)=>{try{e(await this._p2pChannel.startP2PConnection(t))}catch(s){i(s)}}),this._gateway.on(cn.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;const{dtlsParameters:i,iceParameters:s,candidates:r,rtpCapabilities:a,setup:c,cname:l}=KO(t.ortc,e);this._p2pChannel.connect(s,i,r,a,c,l)}),this._gateway.on(cn.REQUEST_DC_CONNECTION_PARAMS,t=>{t(this._p2pChannel.getEstablishParams())}),this._gateway.on(cn.RESET_SIGNAL,t=>{this._p2pChannel.resetConnection(t),this._handleGatewaySignalEvents()}),this._gateway.on(cn.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(cn.DATACHANNEL_PRECONNECT,async(t,e,i,s)=>{var r,a,c,l,u,h;await this._p2pChannel.startP2PConnection({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},!0);const f=function(g,S){let w;return S&&S.ip&&typeof S.port=="number"?(w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip,port:S.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(S.ip,":").concat(S.port)),S.ip6&&(w.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip6,port:S.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(S.ip6,":").concat(S.port)))):w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:g.ip,port:g.port.toString(),type:"host",extension:{}}],w}(t,e);return this._p2pChannel.preConnect({iceUfrag:"".concat((a=this._joinInfo)===null||a===void 0?void 0:a.apResponse.cid,"_").concat((c=this._joinInfo)===null||c===void 0?void 0:c.apResponse.cert),icePwd:"".concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cid,"_").concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(h=U("FINGERPRINT"))!==null&&h!==void 0?h:t.fingerprint}]},f,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(i).catch(s)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Jt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Jt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Jt.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Jt.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Jt.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Jt.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Jt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Jt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Jt.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,yt.AUDIO,!0)),this._gateway.signal.on(Jt.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,yt.AUDIO,!1)),this._gateway.signal.on(Jt.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,yt.VIDEO,!0)),this._gateway.signal.on(Jt.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,yt.VIDEO,!1)),this._gateway.signal.on(Jt.RECEIVE_METADATA,t=>{const e=af(t.metadata);this.safeEmit(le.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(Jt.ON_DATA_STREAM,async t=>{if(!t)return;let e=0;if(t.ordered||t.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(a=>a.uid===t.uid),r=i==null?void 0:i.audioRecv.find(a=>a.ssrc===(s==null?void 0:s._audioSSRC));e=r==null?void 0:r.jitterBufferMs}e==null&&(e=0),k4(t,e,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Jt.ON_CRYPT_ERROR,()=>{Pu(()=>{v.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(le.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Jt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{v.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,ce.TOKEN_EXPIRE),this.safeEmit(le.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Jt.ON_STREAM_FALLBACK_UPDATE,t=>{v.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(le.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Jt.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),v.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Jt.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Jt.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(ht.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case At.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var i,s;const a=r.some(u=>{let{stream_type:h}=u;return h===ke.Audio}),c=r.some(u=>{let{stream_type:h}=u;return h!==ke.Audio}),l=r.some(u=>{let{stream_type:h}=u;return h===ke.Screen||h===ke.ScreenLow});e.state==="offer"&&wt.publish(this._joinInfo.sid,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:a,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:a?(i=r.find(u=>{let{stream_type:h}=u;return h===ke.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:c?(s=r.find(u=>{let{stream_type:h}=u;return h!==ke.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case At.SUBSCRIBE:e&&wt.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:e.stream_type===yt.AUDIO,video:e.stream_type===yt.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:li.measureFromSubscribeStart(this.store.clientId,e.ssrcId)})}}),this._gateway.signal.on(Jt.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Jt.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;U("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(s=>!Pc(s.string_id||s.stream_id,this.channelName)));const e=[],i=[];for(const s of t.users){let r=this._users.find(f=>f._uintid===s.stream_id);r?r._trust_in_room_=!0:(r=new ui(s.string_id||s.stream_id,s.stream_id),this._users.push(r),this.getListeners(le.PUBLISHED_USER_LIST).length===0&&(v.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(le.USER_JOINED,r)));const a=On.Audio&s.stream_type,c=(On.Video|On.LwoVideo)&s.stream_type,l=(65280&s.stream_type)!=0,u=a&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=s.video_ssrc,r._rtxSsrcId=s.video_rtx),a&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=s.audio_ssrc),a&&!u&&this.getListeners(le.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(le.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(le.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(le.USER_PUBLISHED,r,"video")),(a&&!u||c&&!h||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&i.push({user:r,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&i.push({user:r,mediaType:"audio"})}i.length>0&&(v.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{v.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(le.PUBLISHED_USER_LIST).length>0?U("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(v.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(s=>s.uid).join(", "))),this.safeEmit(le.PUBLISHED_USER_LIST,e)):v.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(s=>s.uid).join(", ")))})}_handleP2PEvents(){this._gateway.signal.on(Jt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(qe.PUBLISH,async(t,e)=>{t.forEach(i=>i.kind===yt.VIDEO?(this._handleP2PAddAudioOrVideoStream("video",e),i.isMuted?this._handleMuteStream(e,yt.VIDEO,!0):this._handleMuteStream(e,yt.VIDEO,!1)):(this._handleP2PAddAudioOrVideoStream("audio",e),i.isMuted?this._handleMuteStream(e,yt.AUDIO,!0):this._handleMuteStream(e,yt.AUDIO,!1)))}),this._gateway.signal.on(ht.P2P_START,async(t,e)=>{if(this._p2pChannel instanceof dn){var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}}),this._gateway.signal.on(ht.P2P_CONNECTION,async t=>{this._p2pChannel instanceof dn&&await this._p2pChannel.p2pConnect(t)}),this._gateway.signal.on(ht.P2P_REMOTE_CANDIDATE_UPDATE,t=>{this._p2pChannel instanceof dn&&this._p2pChannel.addRemoteCandidate(JSON.parse(t))}),this._gateway.signal.on(qe.SUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof dn){const{trackType:s}=JSON.parse(t);try{await this._p2pChannel.dopublish(s),e()}catch(r){i(r)}}}),this._gateway.signal.on(qe.UNSUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof dn){const{mediaType:s}=JSON.parse(t);try{await this._p2pChannel.doUnpublish(s),e()}catch(r){i(r)}}}),this._gateway.signal.on(qe.EXCHANGE_SDP,async(t,e,i)=>{if(this._p2pChannel instanceof dn){const{type:s,sdp:r}=JSON.parse(t);try{e(await this._p2pChannel.setDescription(s,r))}catch(a){i(a)}}}),this._gateway.signal.on(qe.UNPUBLISH,async(t,e,i)=>{if(this._p2pChannel instanceof dn){const{unpubMsg:s,uid:r}=t;if(s.length===1){const a=s[0].stream_type===ke.Audio?yt.AUDIO:yt.VIDEO;this._handleMuteStream(r,a,!0);const{sdp:c}=t;if(this._p2pChannel instanceof dn&&c){const l=this._users.find(u=>u.uid===r);if(!l)return v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();this._p2pChannel.unsubscribe(l,c,a).then(u=>{u&&e(u)}).catch(i)}else e()}else this._handleRemoveStream(t,e,i)}}),this._gateway.signal.on(qe.CONTROL,async(t,e,i)=>{const{action:s,sdp:r,isMuteAll:a,uid:c}=t;switch(s){case _o.MUTE_LOCAL_VIDEO:this._handleMuteStream(c,yt.VIDEO,!0,r,e,i);break;case _o.MUTE_LOCAL_AUDIO:e(),this._handleMuteStream(c,yt.AUDIO,!0);break;case _o.UNMUTE_LOCAL_VIDEO:e(),this._handleP2PAddAudioOrVideoStream("video",c),this._handleMuteStream(c,yt.VIDEO,!1);break;case _o.UNMUTE_LOCAL_AUDIO:e(),this._handleP2PAddAudioOrVideoStream("audio",c),this._handleMuteStream(c,yt.AUDIO,!1)}a&&this._handleRemoveStream(t,e,i)}),this._gateway.signal.on(qe.DO_SUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof dn){const{kind:s,sdp:r,ssrcId:a,uid:c}=t,l=this._users.find(u=>u.uid===c);if(!l)return v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void e();try{e(await this._p2pChannel.subscribe(l,s,r,a))}catch(u){i(u)}}}),this._gateway.signal.on(qe.DO_UNSUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof dn){const{uid:s,kind:r,sdp:a}=t,c=this._users.find(l=>l.uid===s);if(!c)return v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void e();try{e(await this._p2pChannel.unsubscribe(c,a,r))}catch(l){i(l)}}}),this._gateway.signal.on(qe.RESTART_ICE,async(t,e,i)=>{if(this._p2pChannel instanceof dn)try{e(await this._p2pChannel.setDescription("remote",t))}catch(s){i(s)}}),this._p2pChannel.on(xt.RequestP2PRestartICE,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(qe.RESTART_ICE,t))}catch(s){i(s)}}),this._p2pChannel.on(xt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(qe.CANDIDATE,JSON.stringify(t))}),this._p2pChannel.on(xt.RequestP2PMuteLocal,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(qe.CONTROL,t))}catch(s){i(s)}}),this._p2pChannel.on(xt.RequestP2PPublish,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(qe.DO_SUBSCRIBE,t))}catch(s){i(s)}}),this._p2pChannel.on(xt.RequestP2PUnPublish,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(qe.DO_UNSUBSCRIBE,t))}catch(s){i(s)}}),this._p2pChannel.on(xt.RequestP2PUnmuteRemote,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(xt.RequestP2PMuteRemote,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(xt.StateChange,(t,e)=>{e===Te.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(xt.RequestMuteLocal,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(xt.RequestUnmuteLocal,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(xt.RequestRePublish,(t,e,i)=>{this.publish(t,!1).then(e).catch(i)}),this._p2pChannel.on(xt.RequestRePublishDataChannel,(t,e,i)=>{K.all(t.map(async s=>{await this._p2pChannel.publishDataChannel([s]);const r={streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,r,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw a}})).then(e).catch(i)}),this._p2pChannel.on(xt.RequestReSubscribe,async(t,e,i)=>{try{for(const{user:s,kind:r}of t)r===yt.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");e()}catch(s){i(s)}}),this._p2pChannel.on(xt.RequestUploadStats,(t,e)=>{this._gateway.uploadStats(t,e)}),this._p2pChannel.on(xt.MediaReconnectStart,t=>{this.safeEmit(le.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(xt.MediaReconnectEnd,t=>{this.safeEmit(le.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(xt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(xt.RequestRestartICE,async t=>{if(this._p2pChannel instanceof dn)return;const e=await this._p2pChannel.restartICE(t),i=await e.next();if(i.done)return;const s=i.value;let r;try{r=await this._gateway.restartICE({iceParameters:s})}catch(c){return void e.throw(c)}const{iceParameters:a}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:a})}),this._p2pChannel.on(xt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(xt.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:i,rtpCapabilities:s}),{dtlsParameters:c,iceParameters:l,candidates:u,rtpCapabilities:h,setup:f,cname:g}=KO(r,a);await this._p2pChannel.connect(l,c,u,h,f,g),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(xt.RequestUnpublishForReconnectPC,async(t,e,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):i()}),this._p2pChannel.on(xt.P2PLost,()=>{this.safeEmit(le.P2P_LOST,this.store.uid)}),this._p2pChannel.on(xt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(xt.ConnectionTypeChange,t=>{this.safeEmit(le.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(xt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(xt.QueryClientConnectionState,t=>{t(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!t)throw new j(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!t.inspectType||!Array.isArray(t.inspectType))throw new j(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const e=[...new Set(t.inspectType)];e.forEach(i=>{var s;if(!Vt(s=["supervise","moderation"]).call(s,i))throw new j(O.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(i," is not a valid inspect type."))}),t.inspectType=e}if(t&&t.extraInfo&&t.extraInfo.length>1024)throw new j(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const e=new f_(t);this._inspect=e,this.handleVideoInspectEvents(this._inspect),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},In)}catch(e){throw Array.isArray(e)?e[0]:e}}async disableContentInspect(){if(!this._inspect)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Ac(t,"enabled"),t){if(!e)throw new j(O.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(Fe(e.interval,"interval",1e3,1/0),this.connectionState!=="CONNECTED"||!this._joinInfo)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(e);const i=new KS(e);this._moderation=i,this.handleImageModerationEvents(this._moderation),await i.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},In)}catch(i){throw Array.isArray(i)?i[0]:i}}else{if(!this._moderation)throw new j(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(Xs.CONNECTION_STATE_CHANGE,(e,i)=>{if(this.safeEmit(le.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,i),e===hs.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new j(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Xs.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}handleVideoInspectEvents(t){t.on(Un.CONNECTION_STATE_CHANGE,(e,i)=>{if(this.safeEmit(le.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,i),i===Ns.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(le.CONTENT_INSPECT_ERROR,new j(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Un.INSPECT_RESULT,(e,i)=>{var s;if((i==null?void 0:i.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return v.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(le.CONTENT_INSPECT_RESULT,e,i)}),t.on(Un.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return v.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Ac(t,"enabled"),je("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}}tt([Ft(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],Ge.prototype,"leave",null),tt([Ft({argsMap:(n,t)=>{if(!Array.isArray(t)){if(!(t instanceof di))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",K)],Ge.prototype,"publish",null),tt([Ft({argsMap:(n,t)=>(t||(t=[]),t instanceof uO?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())))}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],Ge.prototype,"unpublish",null),tt([Ft({argsMap:(n,t,e,i)=>[t.uid,e,i]}),A("design:type",Function),A("design:paramtypes",[ui,String,Number]),A("design:returntype",K)],Ge.prototype,"subscribe",null),tt([Ft({argsMap:(n,t)=>t.map(e=>{let{user:i,mediaType:s}=e;return[i==null?void 0:i.uid,s]})}),A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Ge.prototype,"massSubscribe",null),tt([Ft({argsMap:(n,t,e,i)=>[t.uid,e,i]}),A("design:type",Function),A("design:paramtypes",[ui,String,Number]),A("design:returntype",K)],Ge.prototype,"unsubscribe",null),tt([Ft({argsMap:(n,t)=>t.map(e=>{let{user:i,mediaType:s}=e;return{uid:i==null?void 0:i.uid,mediaType:s}})}),A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",K)],Ge.prototype,"massUnsubscribe",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],Ge.prototype,"setLowStreamParameter",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],Ge.prototype,"enableDualStream",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],Ge.prototype,"disableDualStream",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[String,Object]),A("design:returntype",K)],Ge.prototype,"setClientRole",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[String,Boolean]),A("design:returntype",void 0)],Ge.prototype,"setProxyServer",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",void 0)],Ge.prototype,"setTurnServer",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",void 0)],Ge.prototype,"setLicense",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Ge.prototype,"startProxyServer",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ge.prototype,"stopProxyServer",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],Ge.prototype,"setLocalAccessPointsV2",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Array,String]),A("design:returntype",void 0)],Ge.prototype,"setLocalAccessPoints",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",K)],Ge.prototype,"setRemoteDefaultVideoStreamType",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Object,Number]),A("design:returntype",K)],Ge.prototype,"setRemoteVideoStreamType",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Object,Number]),A("design:returntype",K)],Ge.prototype,"setStreamFallbackOption",null),tt([Ft({argsMap:(n,t)=>[t]}),A("design:type",Function),A("design:paramtypes",[String,String,Uint8Array]),A("design:returntype",void 0)],Ge.prototype,"setEncryptionConfig",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Ge.prototype,"renewToken",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ge.prototype,"enableAudioVolumeIndicator",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[String,Boolean]),A("design:returntype",K)],Ge.prototype,"startLiveStreaming",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],Ge.prototype,"setLiveTranscoding",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",K)],Ge.prototype,"stopLiveStreaming",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[String,Object]),A("design:returntype",K)],Ge.prototype,"addInjectStreamUrl",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],Ge.prototype,"removeInjectStreamUrl",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[s_]),A("design:returntype",K)],Ge.prototype,"startChannelMediaRelay",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[s_]),A("design:returntype",K)],Ge.prototype,"updateChannelMediaRelay",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],Ge.prototype,"stopChannelMediaRelay",null),tt([Ft({argsMap:(n,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],Ge.prototype,"sendCustomReportMessage",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Object,Object]),A("design:returntype",K)],Ge.prototype,"pickSVCLayer",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",K)],Ge.prototype,"setRTM2Flag",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",K)],Ge.prototype,"enableContentInspect",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",K)],Ge.prototype,"disableContentInspect",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Boolean,Object]),A("design:returntype",K)],Ge.prototype,"setImageModeration",null),tt([Ft({reportResult:!0}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Array)],Ge.prototype,"getJoinChannelServiceRecords",null),tt([Ft(),A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",K)],Ge.prototype,"setPublishAudioFilterEnabled",null);const M4=we().name;class uh{constructor(t,e){m(this,"id",0),m(this,"element",void 0),m(this,"peerPair",void 0),m(this,"context",void 0),m(this,"audioPlayerElement",void 0),m(this,"audioTrack",void 0),uh.count+=1,this.id=uh.count,this.element=t,this.context=e}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const e=document.createElement("audio");e.srcObject=new MediaStream([t.track]),e.play(),this.audioPlayerElement=e}}async switchSdp(){if(!this.peerPair)return;const t=async(i,s)=>{const r=s==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(r),i.iceGatheringState==="complete"?i.localDescription:new K(a=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&a(i.localDescription)}})},e=async(i,s)=>await i.setRemoteDescription(s);try{const i=await t(this.peerPair[0],"offer");await e(this.peerPair[1],i);const s=await t(this.peerPair[1],"answer");await e(this.peerPair[0],s)}catch(i){throw new j(O.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let e;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),e=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(e)}catch(s){throw new j(O.LOCAL_AEC_ERROR,s.toString()).print()}if(!e)throw new j(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=e.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,e=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(e),await this.switchSdp()}close(){v.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}m(uh,"count",0);const U4=window.AudioContext||window.webkitAudioContext;class Y0{constructor(){m(this,"units",[]),m(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return v.debug("the system does not need to process local aec"),-1;this.context||(this.context=new U4);let e=this.units.find(i=>i&&i.getElement()===t);return e||(e=new uh(t,this.context),this.units.push(e)),e.startEchoCancellation(),v.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return we().name!==De.SAFARI}}tt([Ft({report:wt}),A("design:type",Function),A("design:paramtypes",[HTMLAudioElement]),A("design:returntype",Number)],Y0.prototype,"processExternalMediaAEC",null);const x4=new Y0;function z0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function J0(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?z0(Object(e),!0).forEach(function(i){m(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):z0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}const YS=window||document;function X0(n){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!YS)return;const e=Gn._cspEventHandlerPointer;if(e&&t)return void console.error(e,t);const i=s=>{if(!(s&&s.blockedURI&&(Gn.onSecurityPolicyViolation||Gn.getListeners(Fr.SECURITY_POLICY_VIOLATION).length>0)))return;const r=s.blockedURI;U("CSP_DETECTED_HOSTNAME_LIST").some(a=>Vt(r).call(r,a))&&(Gn.onSecurityPolicyViolation&&typeof Gn.onSecurityPolicyViolation=="function"&&Gn.onSecurityPolicyViolation(s),Gn.getListeners(Fr.SECURITY_POLICY_VIOLATION).length>0&&Gn.safeEmit(Fr.SECURITY_POLICY_VIOLATION,s))};e&&YS.removeEventListener("securitypolicyviolation",e),(t||n&&typeof n=="function"||Gn.getListeners(Fr.SECURITY_POLICY_VIOLATION).length>0)&&YS.addEventListener("securitypolicyviolation",i),Gn._cspEventHandlerPointer=i}je("PROCESS_ID","process-".concat(Be(8,""),"-").concat(Be(4,""),"-").concat(Be(4,""),"-").concat(Be(4,""),"-").concat(Be(12,""))),function(){const n=we();Ci.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Ci.getStreamFromExtension=n.name===De.CHROME&&Number(n.version)>34,Ci.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let e=!1;try{t.addTransceiver("audio"),e=!0}catch{}return t.close(),e}(),Ci.supportMinBitrate=n.name===De.CHROME||n.name===De.EDGE,Ci.supportSetRtpSenderParameters=function(){const t=we();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!ba()||!(!Pi()&&!sf())||t.name===De.FIREFOX&&Number(t.version)>=64}(),n.name===De.SAFARI&&(Number(n.version)>=14?Ci.supportDualStream=!0:Ci.supportDualStream=!1),Ci.webAudioMediaStreamDest=function(){const t=we();return!(t.name===De.SAFARI&&Number(t.version)<12)}(),Ci.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Ci.supportWebGL=typeof WebGLRenderingContext<"u",Ci.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ba()||(Ci.webAudioWithAEC=!0),Ci.supportShareAudio=function(){const t=we();return(t.os===Kn.WIN_10||t.os===Kn.WIN_81||t.os===Kn.WIN_7||t.os===Kn.LINUX||t.os===Kn.MAC_OS)&&t.name===De.CHROME&&Number(t.version)>=74}(),Ci.supportDataChannel=function(){return!!(Wg(76)||function(t){const e=we();return!(e.name!==De.FIREFOX||!e.osVersion)&&Number(e.version)>=t}(68)||function(t){const e=we();return!(e.name!==De.SAFARI||!e.osVersion)&&Number(e.version)>=t}(14))}(),Ci.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!$e()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Ci.supportWebRTCEncodedTransform=function(){const t=we();return t.name==="Chrome"&&Number(t.version)>=86}(),Ci.supportWebRTCInsertableStream=function(){const t=we();return(t.name===De.CHROME||t.name===De.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),mr(()=>{Ci.supportDualStreamEncoding=function(){const t=we();return U("DISABLE_WEBAUDIO")?!0:t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&U("CHROME_DUAL_STREAM_USE_ENCODING"))}(),v.info("browser compatibility",JSON.stringify(Ci),JSON.stringify(n))})}(),function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void v.error("Error loading sdk config",t.message)}if(n)try{const t=JSON.parse(window.atob(n)),e=Date.now();v.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Mi,i)){const{value:s,expires:r}=t[i];if(r&&r<=e)return;wa[i]=s,Mi[i]=s}})}catch(t){v.error("Error loading mutableParamsCache: ".concat(n),t.message)}}(),Array.isArray(wa.AREAS)&&wa.AREAS.length>0&&vS(wa.AREAS,!0);const Gn=function(n){const t=new Ze,e=n,i={getListeners:t.getListeners.bind(t),on:(s,r)=>(function(a,c){a===Fr.SECURITY_POLICY_VIOLATION&&X0(c,!0)}(s,r),t.on.bind(t)(s,r)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return J0(J0({},e),i)}({__TRACK_LIST__:Jd,VERSION:zs,BUILD:gT,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(n,t,e)=>{v.debug("setParameter key:".concat(n,", value:").concat(JSON.stringify(t))),je(n,t,e)},getParameter:U,getSupportedCodec:async function(){let n={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const e=(await t.createOffer()).sdp;if(!e)return n;t.close(),t=null,n=function(i){const s={video:[],audio:[]};return i.match(/ VP8/i)&&s.video.push("VP8"),i.match(/ VP9/i)&&s.video.push("VP9"),i.match(/ AV1/i)&&s.video.push("AV1"),i.match(/ H264/i)&&s.video.push("H264"),i.match(/ H265/i)&&s.video.push("H265"),i.match(/ opus/i)&&s.audio.push("OPUS"),i.match(/ PCMU/i)&&s.audio.push("PCMU"),i.match(/ PCMA/i)&&s.audio.push("PCMA"),i.match(/ G722/i)&&s.audio.push("G722"),s}(e)}catch(t){throw new j(O.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return n},checkSystemRequirements:function(){const n=wt.reportApiInvoke(null,{name:wn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:sn.TRACER});let t=!1;try{const r=window.RTCPeerConnection,a=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;t=!!(r&&a&&c)}catch(r){return v.error("check system requirement failed: ",r),!1}let e=!1;const i=we();i.name===De.CHROME&&Number(i.version)>=58&&(!YF()||qF())&&(e=!0),i.name===De.FIREFOX&&Number(i.version)>=56&&(e=!0),i.name===De.OPERA&&Number(i.version)>=45&&(e=!0),i.name===De.SAFARI&&Number(i.version)>=11&&(e=!0),(nb()||we().name===De.QQ)&&(e=!0),v.debug("checkSystemRequirements, api:",t,"browser",e);const s=t&&e;return n.onSuccess(s),s},getDevices:function(n){return ks.enumerateDevices(!0,!0,n)},getMicrophones:function(n){return ks.getRecordingDevices(n)},getCameras:function(n){return ks.getCamerasDevices(n)},getElectronScreenSources:ZA,getPlaybackDevices:function(n){return ks.getSpeakers(n)},createClient:function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=wt.reportApiInvoke(null,{name:wn.CREATE_CLIENT,options:[n],tag:sn.TRACER});try{(function(e){Vn(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Vn(e.mode,"config.mode",["rtc","live"]),e.audioCodec!==void 0&&Vn(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),e.proxyServer!==void 0&&ai(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&ub(e.turnServer),e.httpRetryConfig!==void 0&&lb(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&lb(e.websocketRetryConfig)})(n)}catch(e){throw t.onError(e),e}return n.audioCodec===void 0&&(n.audioCodec="opus"),t.onSuccess(),new Ge(lh(lh({forceWaitGatewayResponse:!0},n),{},{role:n.mode==="rtc"?"host":n.role||"audience"}))},createCameraVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.CREATE_CAM_VIDEO_TRACK,options:[Uf({},n)]}),e=Mf(n),i=Be(8,"track-cam-");let s=null;v.info("start create camera video track with config",JSON.stringify(n),"trackId",i);try{s=(await Ls({video:e},i)).getVideoTracks()[0]||null}catch(a){throw t.onError(a),a}if(!s){const a=new Q(O.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(a),a.throw(v)}n.optimizationMode&&YT(i,s,n,Jo(n.encoderConfig));const r=new xa(s,n,e,n.scalabiltyMode?Af(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,i);return t.onSuccess(r.getTrackId()),v.info("create camera video success, trackId:",i),r},createCustomVideoTrack:function(n){const t=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.CREATE_CUSTOM_VIDEO_TRACK,options:[n]}),e=new ae(n.mediaStreamTrack,{width:n.width,height:n.height,frameRate:n.frameRate,bitrateMax:n.bitrateMax,bitrateMin:n.bitrateMin},n.scalabiltyMode?Af(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,Be(8,"track-cus-"),[ze.CUSTOM_TRACK]);return t.onSuccess(e.getTrackId()),v.info("create custom video track success with config",n,"trackId",e.getTrackId()),e},createScreenVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const e=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.CREATE_SCREEN_VIDEO_TRACK,options:[Uf({},n),t]});n.encoderConfig?typeof n.encoderConfig=="string"||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const i=function(h){const f={};h.screenSourceType&&(f.mediaSource=h.screenSourceType),h.extensionId&&Gg()&&(f.extensionId=h.extensionId);const{displaySurface:g,selfBrowserSurface:S,surfaceSwitching:w,systemAudio:I}=h;(Wg(107)||$I(107)||QI(93))&&(g&&(Vn(g,"displaySurface",["browser","window","monitor"]),f.displaySurface=g),S?(Vn(S,"selfBrowserSurface",["exclude","include"]),f.selfBrowserSurface=S):f.selfBrowserSurface="include",w&&(Vn(w,"surfaceSwitching",["exclude","include"]),f.surfaceSwitching=w)),(Wg(105)||$I(105)||QI(91))&&I&&(Vn(I,"systemAudio",["exclude","include"]),f.systemAudio=I),h.electronScreenSourceId&&(f.sourceId=h.electronScreenSourceId);const b=h.encoderConfig?PT(h.encoderConfig):null;return f.mandatory={chromeMediaSource:"desktop",maxWidth:b?b.width:void 0,maxHeight:b?b.height:void 0},b&&(b.frameRate&&(typeof b.frameRate=="number"?(f.mandatory.maxFrameRate=b.frameRate,f.mandatory.minFrameRate=b.frameRate):(f.mandatory.maxFrameRate=b.frameRate.max||b.frameRate.ideal||b.frameRate.exact||void 0,f.mandatory.minFrameRate=b.frameRate.min||b.frameRate.ideal||b.frameRate.exact||void 0),f.frameRate=b.frameRate),b.width&&(f.width=b.width),b.height&&(f.height=b.height)),f}(n),s=Be(8,"track-scr-v-");let r=null,a=null;const c=Ke();if(!c.supportShareAudio&&t==="enable"){const h=new Q(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return e.onError(h),h.throw(v)}v.info("start create screen video track with config",n,"withAudio",t,"trackId",s);try{const h=await Ls({screen:i,screenAudio:t==="auto"?c.supportShareAudio:t==="enable"},s);r=h.getVideoTracks()[0]||null,a=h.getAudioTracks()[0]||null}catch(h){throw e.onError(h),h}if(!r){const h=new Q(O.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(h),h.throw(v)}if(!a&&t==="enable"){r&&r.stop();const h=new Q(O.SHARE_AUDIO_NOT_ALLOWED);return e.onError(h),h.throw(v)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(YT(s,r,n,n.encoderConfig&&PT(n.encoderConfig)||void 0),n.encoderConfig&&typeof n.encoderConfig!="string"&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const l=new ae(r,n.encoderConfig?PT(n.encoderConfig):{},n.scalabiltyMode?Af(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,s,[ze.SCREEN_TRACK]);if(!a)return e.onSuccess(l.getTrackId()),v.info("create screen video track success","video:",l.getTrackId()),l;const u=new Oe(a,void 0,Be(8,"track-scr-a-"),!1,!0);return e.onSuccess([l.getTrackId(),u.getTrackId()]),v.info("create screen video track success","video:",l.getTrackId(),"audio:",u.getTrackId()),[l,u]},createMicrophoneAndCameraTracks:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.CREATE_MIC_AND_CAM_TRACKS,options:[n,t]}),i=Mf(t),s=uw(n),r=Be(8,"track-mic-"),a=Be(8,"track-cam-");let c=null,l=null;v.info("start create camera video track(".concat(a,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(t)));try{const f=await Ls({audio:s,video:i},"".concat(r,"-").concat(a));c=f.getAudioTracks()[0],l=f.getVideoTracks()[0]}catch(f){throw e.onError(f),f}if(!c||!l){const f=new Q(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return e.onError(f),f.throw(v)}t.optimizationMode&&YT(a,l,t,Jo(t.encoderConfig));const u=new Ma(c,n,s,r),h=new xa(l,t,i,t.scalabiltyMode?Af(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return e.onSuccess([u.getTrackId(),h.getTrackId()]),v.info("create camera video track(".concat(a,") and microphone audio track(").concat(r,") success")),[u,h]},createMicrophoneAudioTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.CREATE_MIC_AUDIO_TRACK,options:[n]}),e=uw(n),i=Be(8,"track-mic-");let s=null;v.info("start create microphone audio track with config",JSON.stringify(n),"trackId",i);try{s=(await Ls({audio:e},i)).getAudioTracks()[0]||null}catch(a){throw t.onError(a),a}if(!s){const a=new Q(O.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(a),a.throw(v)}const r=new Ma(s,n,e,i);return t.onSuccess(r.getTrackId()),v.info("create microphone audio track success, trackId:",i),r},createCustomAudioTrack:function(n){const t=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.CREATE_CUSTOM_AUDIO_TRACK,options:[n]}),e=new Oe(n.mediaStreamTrack,n.encoderConfig?wf(n.encoderConfig):{},Be(8,"track-cus-"),!1,!0);return v.info("create custom audio track success with config",n,"trackId",e.getTrackId()),t.onSuccess(e.getTrackId()),e},createBufferSourceAudioTrack:async function(n){var t;const{cacheOnlineFile:e,encoderConfig:i}=n;let{source:s}=n;const r={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":s,cacheOnlineFile:e,encoderConfig:i},a=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.CREATE_BUFFER_AUDIO_TRACK,options:[r]});if(U("DISABLE_WEBAUDIO"))throw new Q(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const c=Be(8,"track-buf-");v.info("start create buffer source audio track with config",JSON.stringify(r),"trackId",c);const l=s;if(!(s instanceof AudioBuffer))try{s=await Pj(s,e)}catch(f){return a.onError(f),f.throw(v)}const u=new Dj(s),h=new Ua(l,u,i?wf(i):{},c);return v.info("create buffer source audio track success, trackId:",c),a.onSuccess(h.getTrackId()),h},setAppType:function(n){if(v.debug("setAppType: ".concat(n)),!(Number.isInteger(n)&&n>=0))throw v.debug("Invalid appType"),new j(O.INVALID_PARAMS,"invalid app type",n);je("APP_TYPE",Math.floor(n))},setLogLevel:function(n){v.setLogLevel(n)},enableLogUpload:function(){U("USE_NEW_LOG")?je("UPLOAD_LOG",!0):v.enableLogUpload()},disableLogUpload:function(){U("USE_NEW_LOG")?je("UPLOAD_LOG",!1):v.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new s_},checkAudioTrackIsActive:async function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const e=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(n instanceof Oe||n instanceof Tr)){const l=new j(O.INVALID_TRACK,"the parameter is not a audio track");return e.onError(l),l.throw()}t&&t<1e3&&(t=1e3);const i=n instanceof Oe?n.getTrackLabel():"remote_track",s=n.getVolumeLevel();let r=s,a=s;const c=Date.now();return new K(l=>{const u=setInterval(()=>{const h=n.getVolumeLevel();r=h>r?h:r,a=h<a?h:a;const f=r-a>1e-4,g=Date.now()-c;if(f||g>t){clearInterval(u);const S=f,w={duration:g,deviceLabel:i,maxVolumeLevel:r,result:S};v.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(w))),e.onSuccess(w),l(S)}},200)})},checkVideoTrackIsActive:async function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const e=wt.reportApiInvoke(null,{tag:sn.TRACER,name:wn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(n instanceof ae||n instanceof mo)){const f=new j(O.INVALID_TRACK,"the parameter is not a video track");return e.onError(f),f.throw()}t&&t<1e3&&(t=1e3);const i=n instanceof ae?n.getTrackLabel():"remote_track",s=n.getMediaStreamTrack(!0),r=document.createElement("video");r.style.width="1px",r.style.height="1px",r.setAttribute("muted",""),r.muted=!0,r.setAttribute("playsinline",""),r.controls=!1,(Pi()||sf())&&(r.style.opacity="0.01",r.style.position="fixed",r.style.left="0",r.style.top="0",document.body.appendChild(r)),r.srcObject=new MediaStream([s]),r.play();const a=document.createElement("canvas");a.width=160,a.height=120;let c=0,l=0;try{const f=Date.now();c=await function(g,S,w,I){let b,M=0,F=null;return new K((V,Z)=>{function $(){M>I&&b&&(b(),V(M));const W=w.getContext("2d");if(!W){const _t=new j(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return v.error(_t.toString()),void Z(_t)}W.drawImage(g,0,0,160,120);const q=W.getImageData(0,0,w.width,w.height),et=Math.floor(q.data.length/3);if(F){for(let _t=0;_t<et;_t+=3)if(q.data[_t]!==F[_t])return M+=1,void(F=q.data);F=q.data}else F=q.data}setTimeout(()=>{b&&(b(),V(M))},S),b=VT(()=>{$()},30)})}(r,t,a,4),l=Date.now()-f}catch(f){throw e.onError(f),f}M4===De.SAFARI&&(r.pause(),r.remove()),r.srcObject=null;const u=c>4,h={duration:l,changedPicNum:c,deviceLabel:i,result:u};return v.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(h))),e.onSuccess(h),u},setArea:vS,audioElementPlayCenter:ps,processExternalMediaAEC:function(n){x4.processExternalMediaAEC(n)},registerExtensions:function(n){n.forEach(t=>{const e=t;e.__registered__=!0,e.logger.hookLog=v.extLog,e.reporter.hookApiInvoke=wt.extApiInvoke,e.parameters&&Object.keys(e.parameters).forEach(i=>{e.parameters[i]=U(i)})})},ChannelMediaRelayError:Da,ChannelMediaRelayEvent:xr,ChannelMediaRelayState:Ui,RemoteStreamFallbackType:LT,RemoteStreamType:Of,ConnectionDisconnectedReason:ce,AudienceLatencyLevelType:Yg,AREAS:ge});return Object.defineProperties(Gn,{onAudioAutoplayFailed:{get:()=>Ms.onAudioAutoplayFailed,set:n=>{Ms.onAudioAutoplayFailed=n}},onAutoplayFailed:{get:()=>Ms.onAutoplayFailed,set:n=>{Ms.onAutoplayFailed=n}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Gn._onSecurityPolicyViolation,set(n){Gn._onSecurityPolicyViolation=n,X0(n)}},__CLIENT_LIST__:{get:()=>U("SHOW_GLOBAL_CLIENT_LIST")?Oa:[]}}),ks.on(Xo.CAMERA_DEVICE_CHANGED,n=>{v.info("camera device changed",JSON.stringify(n)),Gn.onCameraChanged&&Gn.onCameraChanged(n),Gn.safeEmit(Fr.CAMERA_CHANGED,n)}),ks.on(Xo.RECORDING_DEVICE_CHANGED,n=>{v.info("microphone device changed",JSON.stringify(n)),Gn.onMicrophoneChanged&&Gn.onMicrophoneChanged(n),Gn.safeEmit(Fr.MICROPHONE_CHANGED,n)}),ks.on(Xo.PLAYOUT_DEVICE_CHANGED,n=>{v.debug("playout device changed",JSON.stringify(n)),Gn.onPlaybackDeviceChanged&&Gn.onPlaybackDeviceChanged(n),Gn.safeEmit(Fr.PLAYBACK_DEVICE_CHANGED,n)}),ps.onAutoplayFailed=()=>{v.info("detect audio element autoplay failed"),Ms.onAudioAutoplayFailed&&Ms.onAudioAutoplayFailed()},Me.on("autoplay-failed",()=>{v.info("detect webaudio autoplay failed"),Ms.onAudioAutoplayFailed&&Ms.onAudioAutoplayFailed(),Gn.safeEmit(Fr.AUTOPLAY_FAILED)}),yn.on(Yo.NETWORK_STATE_CHANGE,(n,t)=>{v.info("[network-indicator] network state changed, ".concat(t," => ").concat(n))}),window&&(window.__ARTC__=Gn),Gn})})(xL);var vK=xL.exports;const sv=gH(vK),CK={class:"container row mt-1 mb-2"},yK={class:"col-8 bg-info-subtle"},RK=ue("div",{class:"col-4"},[ue("div",{class:"input-group mb-3"},[ue("span",{class:"input-group-text",id:"basic-addon1"},"user"),ue("input",{type:"text",class:"form-control",placeholder:"Username","aria-label":"Username","aria-describedby":"basic-addon1"})])],-1),IK={class:"row"},bK={class:"col-8"},AK={class:"col-8",id:"camera-video"},wK={class:"col-8",id:"remote-video"},OK={key:0,class:"waiting"},NK=Fh('<div class="col-4"><div class="card"><div class="card-body"><h5 class="card-title">Card title</h5></div></div><div class="card"><div class="card-body"><h5 class="card-title">Card title</h5></div></div></div>',1),DK=ue("div",{class:"col-4 bg-primary-subtle"},[ue("nav",null,[ue("div",{class:"nav nav-tabs row",id:"nav-tab",role:"tablist"},[ue("button",{class:"nav-link active col",id:"nav-setting-tab","data-bs-toggle":"tab","data-bs-target":"#nav-home",type:"button",role:"tab","aria-controls":"nav-home","aria-selected":"true"},"Setting"),ue("button",{class:"nav-link col",id:"nav-chat-tab","data-bs-toggle":"tab","data-bs-target":"#nav-chat",type:"button",role:"tab","aria-controls":"nav-chat","aria-selected":"false"},"Chat")])]),ue("div",{class:"tab-content",id:"nav-tabContent"},[ue("div",{class:"tab-pane fade show active",id:"nav-home",role:"tabpanel","aria-labelledby":"nav-setting-tab",tabindex:"0"},[ue("div",{class:"bg-info mb-1"},[ue("h4",{class:"left-align"},"Connect Toys")]),ue("div",{class:"container"},[ue("h5",{class:"mb-2 text-center"},"VibCrafter APP"),ue("div",{class:"input-group mb-3"},[ue("span",{class:"input-group-text",id:"basic-addon1"},"User ID"),ue("input",{type:"text",class:"form-control",placeholder:"user id","aria-label":"Username","aria-describedby":"basic-addon1"})]),ue("div",{class:"input-group mb-3"},[ue("span",{class:"input-group-text",id:"basic-addon2"},"Password"),ue("input",{type:"text",class:"form-control",placeholder:"password","aria-label":"Recipient's username","aria-describedby":"basic-addon2"})]),ue("div",{class:"col-auto"},[ue("button",{type:"submit",class:"btn btn-primary mb-2 text-center"},"Login")])])])]),ue("div",{class:"tab-pane fade",id:"nav-chat",role:"tabpanel","aria-labelledby":"nav-chat-tab",tabindex:"0"},[Vh(" chat "),ue("h2",{class:"left-align"},"Easemob Chat Examples")])],-1),PK="https://120.55.60.98/health",LK="ac1f26c994ea4f978a11ce1251424920",kK="007eJxTYNA5vt2ZzSI2Or9B51p5yP7s0tmPKhT+P0pYdfmqpfZK52cKDInJhmlGZsmWliapiSZpluYWiYaGyamGRqaGJkYmlkYG7j/VUxsCGRk41K8xMjJAIIjPzpCWWJKUmljEwAAAp2kgEA==",MK=Nr({__name:"LiveRoom",setup(o){const d=dr("axios"),p=kL();d.get(PK,{withCredentials:!0}).then(Zt=>{console.log("res data",Zt.data),Zt.data===401&&(console.log("get 401, push to login"),p.push({name:"login"}))}).catch(Zt=>{console.log("res err",Zt),Zt.response.status===401&&(console.log("res err, get 401, push to login"),p.push({name:"login"}))});let _,E,T,R=js(!1),N=js(!1),D=js(!1),x=js(!1),P=js(!1),G=js(!1),z=js(!1);async function rt(){if(G.value=!G.value,_)return _.setEnabled(!_.enabled);_=await sv.createCameraVideoTrack(),_.play("camera-video")}async function at(){if(z.value=!z.value,E)return E.setEnabled(!E.enabled);E=await sv.createMicrophoneAudioTrack(),E.play()}const dt=js("fatbear");async function bt(){dt.value||(dt.value="fatbear"),R.value&&await Ot(),T||(T=sv.createClient({mode:"rtc",codec:"vp8"}),T.on("user-published",Dt)),await T.join(LK,dt.value,kK,123),R.value=!0}async function Ot(){R.value=!1,N.value=!1,D.value=!1,G.value=!1,T&&await T.leave()}async function Dt(Zt,me){me==="video"&&((await T.subscribe(Zt,me)).play("remote-video"),P.value=!0),me==="audio"&&((await T.subscribe(Zt,me)).play(),x.value=!0)}async function Gt(){G.value||await rt(),R.value||await bt(),await T.publish(_),D.value=!0}async function Tt(){z.value||await at(),R.value||await bt(),await T.publish(E),N.value=!0}async function Kt(){Tt(),Gt()}return(Zt,me)=>(Pn(),cs(Fi,null,[Ni(UL),ue("div",CK,[ue("div",yK,[ue("div",{class:"row input-group"},[RK,ue("div",{class:"col-8"},[ue("button",{class:"btn btn-primary w-45 me-1",onClick:Kt},"Join"),ue("button",{class:"btn btn-primary w-45",onClick:Ot},"Leave")])]),ue("div",IK,[ue("div",bK,[Th(ue("video",AK,null,512),[[MN,Kr(G)]]),Th(ue("video",wK,null,512),[[MN,Kr(P)]]),Kr(R)&&!Kr(P)?(Pn(),cs("div",OK)):M_("",!0)]),NK])]),DK])],64))}}),UK="/assets/logo-0e46a7a4.png",dd=o=>(VG("data-v-cb824314"),o=o(),FG(),o),xK={class:"d-flex align-items-center py-4 bg-body-tertiary"},VK=Fh('<svg xmlns="http://www.w3.org/2000/svg" class="d-none" data-v-cb824314><symbol id="check2" viewBox="0 0 16 16" data-v-cb824314><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" data-v-cb824314></path></symbol><symbol id="circle-half" viewBox="0 0 16 16" data-v-cb824314><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z" data-v-cb824314></path></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16" data-v-cb824314><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z" data-v-cb824314></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z" data-v-cb824314></path></symbol><symbol id="sun-fill" viewBox="0 0 16 16" data-v-cb824314><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z" data-v-cb824314></path></symbol></svg>',1),FK={class:"form-signin w-100 m-auto"},BK=dd(()=>ue("img",{class:"mb-3",src:UK,alt:"",width:"72",height:"57"},null,-1)),jK=dd(()=>ue("h1",{class:"h3 mb-3 fw-normal fw-bold"},"Livestream Demo System",-1)),GK=dd(()=>ue("h4",{class:"h5 mb-3 fw-normal"},"Just for demo Using",-1)),WK={class:"form-floating"},HK=dd(()=>ue("label",{for:"user_id"},"User ID",-1)),KK={class:"form-floating"},qK=dd(()=>ue("label",{for:"password"},"Password",-1)),YK={class:"form-floating mt-0"},zK=dd(()=>ue("label",{for:"channel"},"Channel",-1)),JK=Fh('<div class="form-check mt-2" data-v-cb824314><div class="row" data-v-cb824314><div class="col form-check" data-v-cb824314><input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" checked data-v-cb824314><label class="form-check-label" for="flexRadioDefault1" data-v-cb824314> User </label></div><div class="col form-check" data-v-cb824314><input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" data-v-cb824314><label class="form-check-label" for="flexRadioDefault2" data-v-cb824314> Model </label></div></div></div><div class="form-check text-start my-3" data-v-cb824314><input class="form-check-input" type="checkbox" value="remember-me" id="flexCheckDefault" data-v-cb824314><label class="form-check-label" for="flexCheckDefault" data-v-cb824314> Remember me </label></div>',2),XK=dd(()=>ue("p",{class:"mt-5 mb-3 text-body-secondary"},"© 2023",-1)),$K="https://120.55.60.98/login",QK=Nr({__name:"Login",setup(o){const d=dr("axios");mH();const p=kL(),_=js(""),E=js(""),T=js("");js("");async function R(){console.log("start login"),console.log(_),console.log(E),d.post($K,{user_name:_.value,password:E.value,role:"host"}).then(N=>{console.log(N.data),N.data.code!==0?(console.log("toast come"),alert("login failed")):(console.log("login success ,push to live"),p.push({name:"live"}))}).catch(N=>{console.log(N),alert("[ex]login failed")})}return(N,D)=>(Pn(),cs("body",xK,[VK,ue("main",FK,[BK,jK,GK,ue("div",WK,[Th(ue("input",{type:"text",class:"form-control",id:"user_id",placeholder:"123456","onUpdate:modelValue":D[0]||(D[0]=x=>_.value=x)},null,512),[[ZS,_.value]]),HK]),ue("div",KK,[Th(ue("input",{type:"password",class:"form-control",id:"password",placeholder:"Password","onUpdate:modelValue":D[1]||(D[1]=x=>E.value=x)},null,512),[[ZS,E.value]]),qK]),ue("div",YK,[Th(ue("input",{type:"text",class:"form-control",id:"channel",placeholder:"channel","onUpdate:modelValue":D[2]||(D[2]=x=>T.value=x)},null,512),[[ZS,T.value]]),zK]),JK,ue("button",{class:"btn btn-primary w-100 py-2",onClick:R},"Sign in"),XK])]))}}),ZK=TC(QK,[["__scopeId","data-v-cb824314"]]),t8=Fh('<div class="col-2"><div class="card shadow-sm"><img src="'+ML+'" class="img-fluid"><div class="card-body"><p class="card-text">This is a wider bit longer.</p><div class="d-flex justify-content-between align-items-center"><div class="btn-group"><button type="button" class="btn btn-sm btn-outline-secondary">Join</button></div></div></div></div></div>',1),e8=Nr({__name:"ModelList",setup(o){return(d,p)=>(Pn(),cs(Fi,null,[Ni(UL),t8],64))}}),n8=fK({history:N6("/"),routes:[{path:"/:catchAll(.*)",redirect:{name:"live"}},{path:"/login",name:"login",component:ZK},{path:"/live",name:"live",component:MK},{path:"/model",name:"model",component:e8}]});function VL(o,d){return function(){return o.apply(d,arguments)}}const{toString:i8}=Object.prototype,{getPrototypeOf:vC}=Object,vm=(o=>d=>{const p=i8.call(d);return o[p]||(o[p]=p.slice(8,-1).toLowerCase())})(Object.create(null)),Lo=o=>(o=o.toLowerCase(),d=>vm(d)===o),Cm=o=>d=>typeof d===o,{isArray:Fl}=Array,Mh=Cm("undefined");function s8(o){return o!==null&&!Mh(o)&&o.constructor!==null&&!Mh(o.constructor)&&Or(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const FL=Lo("ArrayBuffer");function r8(o){let d;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?d=ArrayBuffer.isView(o):d=o&&o.buffer&&FL(o.buffer),d}const o8=Cm("string"),Or=Cm("function"),BL=Cm("number"),ym=o=>o!==null&&typeof o=="object",a8=o=>o===!0||o===!1,F_=o=>{if(vm(o)!=="object")return!1;const d=vC(o);return(d===null||d===Object.prototype||Object.getPrototypeOf(d)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)},c8=Lo("Date"),d8=Lo("File"),l8=Lo("Blob"),u8=Lo("FileList"),h8=o=>ym(o)&&Or(o.pipe),p8=o=>{let d;return o&&(typeof FormData=="function"&&o instanceof FormData||Or(o.append)&&((d=vm(o))==="formdata"||d==="object"&&Or(o.toString)&&o.toString()==="[object FormData]"))},f8=Lo("URLSearchParams"),_8=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Gh(o,d,{allOwnKeys:p=!1}={}){if(o===null||typeof o>"u")return;let _,E;if(typeof o!="object"&&(o=[o]),Fl(o))for(_=0,E=o.length;_<E;_++)d.call(null,o[_],_,o);else{const T=p?Object.getOwnPropertyNames(o):Object.keys(o),R=T.length;let N;for(_=0;_<R;_++)N=T[_],d.call(null,o[N],N,o)}}function jL(o,d){d=d.toLowerCase();const p=Object.keys(o);let _=p.length,E;for(;_-- >0;)if(E=p[_],d===E.toLowerCase())return E;return null}const GL=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),WL=o=>!Mh(o)&&o!==GL;function Pv(){const{caseless:o}=WL(this)&&this||{},d={},p=(_,E)=>{const T=o&&jL(d,E)||E;F_(d[T])&&F_(_)?d[T]=Pv(d[T],_):F_(_)?d[T]=Pv({},_):Fl(_)?d[T]=_.slice():d[T]=_};for(let _=0,E=arguments.length;_<E;_++)arguments[_]&&Gh(arguments[_],p);return d}const m8=(o,d,p,{allOwnKeys:_}={})=>(Gh(d,(E,T)=>{p&&Or(E)?o[T]=VL(E,p):o[T]=E},{allOwnKeys:_}),o),E8=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),g8=(o,d,p,_)=>{o.prototype=Object.create(d.prototype,_),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:d.prototype}),p&&Object.assign(o.prototype,p)},T8=(o,d,p,_)=>{let E,T,R;const N={};if(d=d||{},o==null)return d;do{for(E=Object.getOwnPropertyNames(o),T=E.length;T-- >0;)R=E[T],(!_||_(R,o,d))&&!N[R]&&(d[R]=o[R],N[R]=!0);o=p!==!1&&vC(o)}while(o&&(!p||p(o,d))&&o!==Object.prototype);return d},S8=(o,d,p)=>{o=String(o),(p===void 0||p>o.length)&&(p=o.length),p-=d.length;const _=o.indexOf(d,p);return _!==-1&&_===p},v8=o=>{if(!o)return null;if(Fl(o))return o;let d=o.length;if(!BL(d))return null;const p=new Array(d);for(;d-- >0;)p[d]=o[d];return p},C8=(o=>d=>o&&d instanceof o)(typeof Uint8Array<"u"&&vC(Uint8Array)),y8=(o,d)=>{const _=(o&&o[Symbol.iterator]).call(o);let E;for(;(E=_.next())&&!E.done;){const T=E.value;d.call(o,T[0],T[1])}},R8=(o,d)=>{let p;const _=[];for(;(p=o.exec(d))!==null;)_.push(p);return _},I8=Lo("HTMLFormElement"),b8=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(p,_,E){return _.toUpperCase()+E}),fD=(({hasOwnProperty:o})=>(d,p)=>o.call(d,p))(Object.prototype),A8=Lo("RegExp"),HL=(o,d)=>{const p=Object.getOwnPropertyDescriptors(o),_={};Gh(p,(E,T)=>{let R;(R=d(E,T,o))!==!1&&(_[T]=R||E)}),Object.defineProperties(o,_)},w8=o=>{HL(o,(d,p)=>{if(Or(o)&&["arguments","caller","callee"].indexOf(p)!==-1)return!1;const _=o[p];if(Or(_)){if(d.enumerable=!1,"writable"in d){d.writable=!1;return}d.set||(d.set=()=>{throw Error("Can not rewrite read-only method '"+p+"'")})}})},O8=(o,d)=>{const p={},_=E=>{E.forEach(T=>{p[T]=!0})};return Fl(o)?_(o):_(String(o).split(d)),p},N8=()=>{},D8=(o,d)=>(o=+o,Number.isFinite(o)?o:d),rv="abcdefghijklmnopqrstuvwxyz",_D="0123456789",KL={DIGIT:_D,ALPHA:rv,ALPHA_DIGIT:rv+rv.toUpperCase()+_D},P8=(o=16,d=KL.ALPHA_DIGIT)=>{let p="";const{length:_}=d;for(;o--;)p+=d[Math.random()*_|0];return p};function L8(o){return!!(o&&Or(o.append)&&o[Symbol.toStringTag]==="FormData"&&o[Symbol.iterator])}const k8=o=>{const d=new Array(10),p=(_,E)=>{if(ym(_)){if(d.indexOf(_)>=0)return;if(!("toJSON"in _)){d[E]=_;const T=Fl(_)?[]:{};return Gh(_,(R,N)=>{const D=p(R,E+1);!Mh(D)&&(T[N]=D)}),d[E]=void 0,T}}return _};return p(o,0)},M8=Lo("AsyncFunction"),U8=o=>o&&(ym(o)||Or(o))&&Or(o.then)&&Or(o.catch),vt={isArray:Fl,isArrayBuffer:FL,isBuffer:s8,isFormData:p8,isArrayBufferView:r8,isString:o8,isNumber:BL,isBoolean:a8,isObject:ym,isPlainObject:F_,isUndefined:Mh,isDate:c8,isFile:d8,isBlob:l8,isRegExp:A8,isFunction:Or,isStream:h8,isURLSearchParams:f8,isTypedArray:C8,isFileList:u8,forEach:Gh,merge:Pv,extend:m8,trim:_8,stripBOM:E8,inherits:g8,toFlatObject:T8,kindOf:vm,kindOfTest:Lo,endsWith:S8,toArray:v8,forEachEntry:y8,matchAll:R8,isHTMLForm:I8,hasOwnProperty:fD,hasOwnProp:fD,reduceDescriptors:HL,freezeMethods:w8,toObjectSet:O8,toCamelCase:b8,noop:N8,toFiniteNumber:D8,findKey:jL,global:GL,isContextDefined:WL,ALPHABET:KL,generateString:P8,isSpecCompliantForm:L8,toJSONObject:k8,isAsyncFn:M8,isThenable:U8};function en(o,d,p,_,E){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",d&&(this.code=d),p&&(this.config=p),_&&(this.request=_),E&&(this.response=E)}vt.inherits(en,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:vt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const qL=en.prototype,YL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{YL[o]={value:o}});Object.defineProperties(en,YL);Object.defineProperty(qL,"isAxiosError",{value:!0});en.from=(o,d,p,_,E,T)=>{const R=Object.create(qL);return vt.toFlatObject(o,R,function(D){return D!==Error.prototype},N=>N!=="isAxiosError"),en.call(R,o.message,d,p,_,E),R.cause=o,R.name=o.name,T&&Object.assign(R,T),R};const x8=null;function Lv(o){return vt.isPlainObject(o)||vt.isArray(o)}function zL(o){return vt.endsWith(o,"[]")?o.slice(0,-2):o}function mD(o,d,p){return o?o.concat(d).map(function(E,T){return E=zL(E),!p&&T?"["+E+"]":E}).join(p?".":""):d}function V8(o){return vt.isArray(o)&&!o.some(Lv)}const F8=vt.toFlatObject(vt,{},null,function(d){return/^is[A-Z]/.test(d)});function Rm(o,d,p){if(!vt.isObject(o))throw new TypeError("target must be an object");d=d||new FormData,p=vt.toFlatObject(p,{metaTokens:!0,dots:!1,indexes:!1},!1,function(dt,bt){return!vt.isUndefined(bt[dt])});const _=p.metaTokens,E=p.visitor||P,T=p.dots,R=p.indexes,D=(p.Blob||typeof Blob<"u"&&Blob)&&vt.isSpecCompliantForm(d);if(!vt.isFunction(E))throw new TypeError("visitor must be a function");function x(at){if(at===null)return"";if(vt.isDate(at))return at.toISOString();if(!D&&vt.isBlob(at))throw new en("Blob is not supported. Use a Buffer instead.");return vt.isArrayBuffer(at)||vt.isTypedArray(at)?D&&typeof Blob=="function"?new Blob([at]):Buffer.from(at):at}function P(at,dt,bt){let Ot=at;if(at&&!bt&&typeof at=="object"){if(vt.endsWith(dt,"{}"))dt=_?dt:dt.slice(0,-2),at=JSON.stringify(at);else if(vt.isArray(at)&&V8(at)||(vt.isFileList(at)||vt.endsWith(dt,"[]"))&&(Ot=vt.toArray(at)))return dt=zL(dt),Ot.forEach(function(Gt,Tt){!(vt.isUndefined(Gt)||Gt===null)&&d.append(R===!0?mD([dt],Tt,T):R===null?dt:dt+"[]",x(Gt))}),!1}return Lv(at)?!0:(d.append(mD(bt,dt,T),x(at)),!1)}const G=[],z=Object.assign(F8,{defaultVisitor:P,convertValue:x,isVisitable:Lv});function rt(at,dt){if(!vt.isUndefined(at)){if(G.indexOf(at)!==-1)throw Error("Circular reference detected in "+dt.join("."));G.push(at),vt.forEach(at,function(Ot,Dt){(!(vt.isUndefined(Ot)||Ot===null)&&E.call(d,Ot,vt.isString(Dt)?Dt.trim():Dt,dt,z))===!0&&rt(Ot,dt?dt.concat(Dt):[Dt])}),G.pop()}}if(!vt.isObject(o))throw new TypeError("data must be an object");return rt(o),d}function ED(o){const d={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(_){return d[_]})}function CC(o,d){this._pairs=[],o&&Rm(o,this,d)}const JL=CC.prototype;JL.append=function(d,p){this._pairs.push([d,p])};JL.toString=function(d){const p=d?function(_){return d.call(this,_,ED)}:ED;return this._pairs.map(function(E){return p(E[0])+"="+p(E[1])},"").join("&")};function B8(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function XL(o,d,p){if(!d)return o;const _=p&&p.encode||B8,E=p&&p.serialize;let T;if(E?T=E(d,p):T=vt.isURLSearchParams(d)?d.toString():new CC(d,p).toString(_),T){const R=o.indexOf("#");R!==-1&&(o=o.slice(0,R)),o+=(o.indexOf("?")===-1?"?":"&")+T}return o}class j8{constructor(){this.handlers=[]}use(d,p,_){return this.handlers.push({fulfilled:d,rejected:p,synchronous:_?_.synchronous:!1,runWhen:_?_.runWhen:null}),this.handlers.length-1}eject(d){this.handlers[d]&&(this.handlers[d]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(d){vt.forEach(this.handlers,function(_){_!==null&&d(_)})}}const gD=j8,$L={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},G8=typeof URLSearchParams<"u"?URLSearchParams:CC,W8=typeof FormData<"u"?FormData:null,H8=typeof Blob<"u"?Blob:null,K8=(()=>{let o;return typeof navigator<"u"&&((o=navigator.product)==="ReactNative"||o==="NativeScript"||o==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),q8=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),wo={isBrowser:!0,classes:{URLSearchParams:G8,FormData:W8,Blob:H8},isStandardBrowserEnv:K8,isStandardBrowserWebWorkerEnv:q8,protocols:["http","https","file","blob","url","data"]};function Y8(o,d){return Rm(o,new wo.classes.URLSearchParams,Object.assign({visitor:function(p,_,E,T){return wo.isNode&&vt.isBuffer(p)?(this.append(_,p.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},d))}function z8(o){return vt.matchAll(/\w+|\[(\w*)]/g,o).map(d=>d[0]==="[]"?"":d[1]||d[0])}function J8(o){const d={},p=Object.keys(o);let _;const E=p.length;let T;for(_=0;_<E;_++)T=p[_],d[T]=o[T];return d}function QL(o){function d(p,_,E,T){let R=p[T++];const N=Number.isFinite(+R),D=T>=p.length;return R=!R&&vt.isArray(E)?E.length:R,D?(vt.hasOwnProp(E,R)?E[R]=[E[R],_]:E[R]=_,!N):((!E[R]||!vt.isObject(E[R]))&&(E[R]=[]),d(p,_,E[R],T)&&vt.isArray(E[R])&&(E[R]=J8(E[R])),!N)}if(vt.isFormData(o)&&vt.isFunction(o.entries)){const p={};return vt.forEachEntry(o,(_,E)=>{d(z8(_),E,p,0)}),p}return null}function X8(o,d,p){if(vt.isString(o))try{return(d||JSON.parse)(o),vt.trim(o)}catch(_){if(_.name!=="SyntaxError")throw _}return(p||JSON.stringify)(o)}const yC={transitional:$L,adapter:["xhr","http"],transformRequest:[function(d,p){const _=p.getContentType()||"",E=_.indexOf("application/json")>-1,T=vt.isObject(d);if(T&&vt.isHTMLForm(d)&&(d=new FormData(d)),vt.isFormData(d))return E&&E?JSON.stringify(QL(d)):d;if(vt.isArrayBuffer(d)||vt.isBuffer(d)||vt.isStream(d)||vt.isFile(d)||vt.isBlob(d))return d;if(vt.isArrayBufferView(d))return d.buffer;if(vt.isURLSearchParams(d))return p.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),d.toString();let N;if(T){if(_.indexOf("application/x-www-form-urlencoded")>-1)return Y8(d,this.formSerializer).toString();if((N=vt.isFileList(d))||_.indexOf("multipart/form-data")>-1){const D=this.env&&this.env.FormData;return Rm(N?{"files[]":d}:d,D&&new D,this.formSerializer)}}return T||E?(p.setContentType("application/json",!1),X8(d)):d}],transformResponse:[function(d){const p=this.transitional||yC.transitional,_=p&&p.forcedJSONParsing,E=this.responseType==="json";if(d&&vt.isString(d)&&(_&&!this.responseType||E)){const R=!(p&&p.silentJSONParsing)&&E;try{return JSON.parse(d)}catch(N){if(R)throw N.name==="SyntaxError"?en.from(N,en.ERR_BAD_RESPONSE,this,null,this.response):N}}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:wo.classes.FormData,Blob:wo.classes.Blob},validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};vt.forEach(["delete","get","head","post","put","patch"],o=>{yC.headers[o]={}});const RC=yC,$8=vt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Q8=o=>{const d={};let p,_,E;return o&&o.split(`
`).forEach(function(R){E=R.indexOf(":"),p=R.substring(0,E).trim().toLowerCase(),_=R.substring(E+1).trim(),!(!p||d[p]&&$8[p])&&(p==="set-cookie"?d[p]?d[p].push(_):d[p]=[_]:d[p]=d[p]?d[p]+", "+_:_)}),d},TD=Symbol("internals");function _h(o){return o&&String(o).trim().toLowerCase()}function B_(o){return o===!1||o==null?o:vt.isArray(o)?o.map(B_):String(o)}function Z8(o){const d=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=p.exec(o);)d[_[1]]=_[2];return d}const tq=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function ov(o,d,p,_,E){if(vt.isFunction(_))return _.call(this,d,p);if(E&&(d=p),!!vt.isString(d)){if(vt.isString(_))return d.indexOf(_)!==-1;if(vt.isRegExp(_))return _.test(d)}}function eq(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(d,p,_)=>p.toUpperCase()+_)}function nq(o,d){const p=vt.toCamelCase(" "+d);["get","set","has"].forEach(_=>{Object.defineProperty(o,_+p,{value:function(E,T,R){return this[_].call(this,d,E,T,R)},configurable:!0})})}class Im{constructor(d){d&&this.set(d)}set(d,p,_){const E=this;function T(N,D,x){const P=_h(D);if(!P)throw new Error("header name must be a non-empty string");const G=vt.findKey(E,P);(!G||E[G]===void 0||x===!0||x===void 0&&E[G]!==!1)&&(E[G||D]=B_(N))}const R=(N,D)=>vt.forEach(N,(x,P)=>T(x,P,D));return vt.isPlainObject(d)||d instanceof this.constructor?R(d,p):vt.isString(d)&&(d=d.trim())&&!tq(d)?R(Q8(d),p):d!=null&&T(p,d,_),this}get(d,p){if(d=_h(d),d){const _=vt.findKey(this,d);if(_){const E=this[_];if(!p)return E;if(p===!0)return Z8(E);if(vt.isFunction(p))return p.call(this,E,_);if(vt.isRegExp(p))return p.exec(E);throw new TypeError("parser must be boolean|regexp|function")}}}has(d,p){if(d=_h(d),d){const _=vt.findKey(this,d);return!!(_&&this[_]!==void 0&&(!p||ov(this,this[_],_,p)))}return!1}delete(d,p){const _=this;let E=!1;function T(R){if(R=_h(R),R){const N=vt.findKey(_,R);N&&(!p||ov(_,_[N],N,p))&&(delete _[N],E=!0)}}return vt.isArray(d)?d.forEach(T):T(d),E}clear(d){const p=Object.keys(this);let _=p.length,E=!1;for(;_--;){const T=p[_];(!d||ov(this,this[T],T,d,!0))&&(delete this[T],E=!0)}return E}normalize(d){const p=this,_={};return vt.forEach(this,(E,T)=>{const R=vt.findKey(_,T);if(R){p[R]=B_(E),delete p[T];return}const N=d?eq(T):String(T).trim();N!==T&&delete p[T],p[N]=B_(E),_[N]=!0}),this}concat(...d){return this.constructor.concat(this,...d)}toJSON(d){const p=Object.create(null);return vt.forEach(this,(_,E)=>{_!=null&&_!==!1&&(p[E]=d&&vt.isArray(_)?_.join(", "):_)}),p}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([d,p])=>d+": "+p).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(d){return d instanceof this?d:new this(d)}static concat(d,...p){const _=new this(d);return p.forEach(E=>_.set(E)),_}static accessor(d){const _=(this[TD]=this[TD]={accessors:{}}).accessors,E=this.prototype;function T(R){const N=_h(R);_[N]||(nq(E,R),_[N]=!0)}return vt.isArray(d)?d.forEach(T):T(d),this}}Im.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);vt.reduceDescriptors(Im.prototype,({value:o},d)=>{let p=d[0].toUpperCase()+d.slice(1);return{get:()=>o,set(_){this[p]=_}}});vt.freezeMethods(Im);const ca=Im;function av(o,d){const p=this||RC,_=d||p,E=ca.from(_.headers);let T=_.data;return vt.forEach(o,function(N){T=N.call(p,T,E.normalize(),d?d.status:void 0)}),E.normalize(),T}function ZL(o){return!!(o&&o.__CANCEL__)}function Wh(o,d,p){en.call(this,o??"canceled",en.ERR_CANCELED,d,p),this.name="CanceledError"}vt.inherits(Wh,en,{__CANCEL__:!0});function iq(o,d,p){const _=p.config.validateStatus;!p.status||!_||_(p.status)?o(p):d(new en("Request failed with status code "+p.status,[en.ERR_BAD_REQUEST,en.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))}const sq=wo.isStandardBrowserEnv?function(){return{write:function(p,_,E,T,R,N){const D=[];D.push(p+"="+encodeURIComponent(_)),vt.isNumber(E)&&D.push("expires="+new Date(E).toGMTString()),vt.isString(T)&&D.push("path="+T),vt.isString(R)&&D.push("domain="+R),N===!0&&D.push("secure"),document.cookie=D.join("; ")},read:function(p){const _=document.cookie.match(new RegExp("(^|;\\s*)("+p+")=([^;]*)"));return _?decodeURIComponent(_[3]):null},remove:function(p){this.write(p,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function rq(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function oq(o,d){return d?o.replace(/\/+$/,"")+"/"+d.replace(/^\/+/,""):o}function tk(o,d){return o&&!rq(d)?oq(o,d):d}const aq=wo.isStandardBrowserEnv?function(){const d=/(msie|trident)/i.test(navigator.userAgent),p=document.createElement("a");let _;function E(T){let R=T;return d&&(p.setAttribute("href",R),R=p.href),p.setAttribute("href",R),{href:p.href,protocol:p.protocol?p.protocol.replace(/:$/,""):"",host:p.host,search:p.search?p.search.replace(/^\?/,""):"",hash:p.hash?p.hash.replace(/^#/,""):"",hostname:p.hostname,port:p.port,pathname:p.pathname.charAt(0)==="/"?p.pathname:"/"+p.pathname}}return _=E(window.location.href),function(R){const N=vt.isString(R)?E(R):R;return N.protocol===_.protocol&&N.host===_.host}}():function(){return function(){return!0}}();function cq(o){const d=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return d&&d[1]||""}function dq(o,d){o=o||10;const p=new Array(o),_=new Array(o);let E=0,T=0,R;return d=d!==void 0?d:1e3,function(D){const x=Date.now(),P=_[T];R||(R=x),p[E]=D,_[E]=x;let G=T,z=0;for(;G!==E;)z+=p[G++],G=G%o;if(E=(E+1)%o,E===T&&(T=(T+1)%o),x-R<d)return;const rt=P&&x-P;return rt?Math.round(z*1e3/rt):void 0}}function SD(o,d){let p=0;const _=dq(50,250);return E=>{const T=E.loaded,R=E.lengthComputable?E.total:void 0,N=T-p,D=_(N),x=T<=R;p=T;const P={loaded:T,total:R,progress:R?T/R:void 0,bytes:N,rate:D||void 0,estimated:D&&R&&x?(R-T)/D:void 0,event:E};P[d?"download":"upload"]=!0,o(P)}}const lq=typeof XMLHttpRequest<"u",uq=lq&&function(o){return new Promise(function(p,_){let E=o.data;const T=ca.from(o.headers).normalize(),R=o.responseType;let N;function D(){o.cancelToken&&o.cancelToken.unsubscribe(N),o.signal&&o.signal.removeEventListener("abort",N)}let x;vt.isFormData(E)&&(wo.isStandardBrowserEnv||wo.isStandardBrowserWebWorkerEnv?T.setContentType(!1):T.getContentType(/^\s*multipart\/form-data/)?vt.isString(x=T.getContentType())&&T.setContentType(x.replace(/^\s*(multipart\/form-data);+/,"$1")):T.setContentType("multipart/form-data"));let P=new XMLHttpRequest;if(o.auth){const at=o.auth.username||"",dt=o.auth.password?unescape(encodeURIComponent(o.auth.password)):"";T.set("Authorization","Basic "+btoa(at+":"+dt))}const G=tk(o.baseURL,o.url);P.open(o.method.toUpperCase(),XL(G,o.params,o.paramsSerializer),!0),P.timeout=o.timeout;function z(){if(!P)return;const at=ca.from("getAllResponseHeaders"in P&&P.getAllResponseHeaders()),bt={data:!R||R==="text"||R==="json"?P.responseText:P.response,status:P.status,statusText:P.statusText,headers:at,config:o,request:P};iq(function(Dt){p(Dt),D()},function(Dt){_(Dt),D()},bt),P=null}if("onloadend"in P?P.onloadend=z:P.onreadystatechange=function(){!P||P.readyState!==4||P.status===0&&!(P.responseURL&&P.responseURL.indexOf("file:")===0)||setTimeout(z)},P.onabort=function(){P&&(_(new en("Request aborted",en.ECONNABORTED,o,P)),P=null)},P.onerror=function(){_(new en("Network Error",en.ERR_NETWORK,o,P)),P=null},P.ontimeout=function(){let dt=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const bt=o.transitional||$L;o.timeoutErrorMessage&&(dt=o.timeoutErrorMessage),_(new en(dt,bt.clarifyTimeoutError?en.ETIMEDOUT:en.ECONNABORTED,o,P)),P=null},wo.isStandardBrowserEnv){const at=(o.withCredentials||aq(G))&&o.xsrfCookieName&&sq.read(o.xsrfCookieName);at&&T.set(o.xsrfHeaderName,at)}E===void 0&&T.setContentType(null),"setRequestHeader"in P&&vt.forEach(T.toJSON(),function(dt,bt){P.setRequestHeader(bt,dt)}),vt.isUndefined(o.withCredentials)||(P.withCredentials=!!o.withCredentials),R&&R!=="json"&&(P.responseType=o.responseType),typeof o.onDownloadProgress=="function"&&P.addEventListener("progress",SD(o.onDownloadProgress,!0)),typeof o.onUploadProgress=="function"&&P.upload&&P.upload.addEventListener("progress",SD(o.onUploadProgress)),(o.cancelToken||o.signal)&&(N=at=>{P&&(_(!at||at.type?new Wh(null,o,P):at),P.abort(),P=null)},o.cancelToken&&o.cancelToken.subscribe(N),o.signal&&(o.signal.aborted?N():o.signal.addEventListener("abort",N)));const rt=cq(G);if(rt&&wo.protocols.indexOf(rt)===-1){_(new en("Unsupported protocol "+rt+":",en.ERR_BAD_REQUEST,o));return}P.send(E||null)})},kv={http:x8,xhr:uq};vt.forEach(kv,(o,d)=>{if(o){try{Object.defineProperty(o,"name",{value:d})}catch{}Object.defineProperty(o,"adapterName",{value:d})}});const vD=o=>`- ${o}`,hq=o=>vt.isFunction(o)||o===null||o===!1,ek={getAdapter:o=>{o=vt.isArray(o)?o:[o];const{length:d}=o;let p,_;const E={};for(let T=0;T<d;T++){p=o[T];let R;if(_=p,!hq(p)&&(_=kv[(R=String(p)).toLowerCase()],_===void 0))throw new en(`Unknown adapter '${R}'`);if(_)break;E[R||"#"+T]=_}if(!_){const T=Object.entries(E).map(([N,D])=>`adapter ${N} `+(D===!1?"is not supported by the environment":"is not available in the build"));let R=d?T.length>1?`since :
`+T.map(vD).join(`
`):" "+vD(T[0]):"as no adapter specified";throw new en("There is no suitable adapter to dispatch the request "+R,"ERR_NOT_SUPPORT")}return _},adapters:kv};function cv(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Wh(null,o)}function CD(o){return cv(o),o.headers=ca.from(o.headers),o.data=av.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),ek.getAdapter(o.adapter||RC.adapter)(o).then(function(_){return cv(o),_.data=av.call(o,o.transformResponse,_),_.headers=ca.from(_.headers),_},function(_){return ZL(_)||(cv(o),_&&_.response&&(_.response.data=av.call(o,o.transformResponse,_.response),_.response.headers=ca.from(_.response.headers))),Promise.reject(_)})}const yD=o=>o instanceof ca?o.toJSON():o;function kl(o,d){d=d||{};const p={};function _(x,P,G){return vt.isPlainObject(x)&&vt.isPlainObject(P)?vt.merge.call({caseless:G},x,P):vt.isPlainObject(P)?vt.merge({},P):vt.isArray(P)?P.slice():P}function E(x,P,G){if(vt.isUndefined(P)){if(!vt.isUndefined(x))return _(void 0,x,G)}else return _(x,P,G)}function T(x,P){if(!vt.isUndefined(P))return _(void 0,P)}function R(x,P){if(vt.isUndefined(P)){if(!vt.isUndefined(x))return _(void 0,x)}else return _(void 0,P)}function N(x,P,G){if(G in d)return _(x,P);if(G in o)return _(void 0,x)}const D={url:T,method:T,data:T,baseURL:R,transformRequest:R,transformResponse:R,paramsSerializer:R,timeout:R,timeoutMessage:R,withCredentials:R,adapter:R,responseType:R,xsrfCookieName:R,xsrfHeaderName:R,onUploadProgress:R,onDownloadProgress:R,decompress:R,maxContentLength:R,maxBodyLength:R,beforeRedirect:R,transport:R,httpAgent:R,httpsAgent:R,cancelToken:R,socketPath:R,responseEncoding:R,validateStatus:N,headers:(x,P)=>E(yD(x),yD(P),!0)};return vt.forEach(Object.keys(Object.assign({},o,d)),function(P){const G=D[P]||E,z=G(o[P],d[P],P);vt.isUndefined(z)&&G!==N||(p[P]=z)}),p}const nk="1.5.1",IC={};["object","boolean","number","function","string","symbol"].forEach((o,d)=>{IC[o]=function(_){return typeof _===o||"a"+(d<1?"n ":" ")+o}});const RD={};IC.transitional=function(d,p,_){function E(T,R){return"[Axios v"+nk+"] Transitional option '"+T+"'"+R+(_?". "+_:"")}return(T,R,N)=>{if(d===!1)throw new en(E(R," has been removed"+(p?" in "+p:"")),en.ERR_DEPRECATED);return p&&!RD[R]&&(RD[R]=!0,console.warn(E(R," has been deprecated since v"+p+" and will be removed in the near future"))),d?d(T,R,N):!0}};function pq(o,d,p){if(typeof o!="object")throw new en("options must be an object",en.ERR_BAD_OPTION_VALUE);const _=Object.keys(o);let E=_.length;for(;E-- >0;){const T=_[E],R=d[T];if(R){const N=o[T],D=N===void 0||R(N,T,o);if(D!==!0)throw new en("option "+T+" must be "+D,en.ERR_BAD_OPTION_VALUE);continue}if(p!==!0)throw new en("Unknown option "+T,en.ERR_BAD_OPTION)}}const Mv={assertOptions:pq,validators:IC},tc=Mv.validators;class Q_{constructor(d){this.defaults=d,this.interceptors={request:new gD,response:new gD}}request(d,p){typeof d=="string"?(p=p||{},p.url=d):p=d||{},p=kl(this.defaults,p);const{transitional:_,paramsSerializer:E,headers:T}=p;_!==void 0&&Mv.assertOptions(_,{silentJSONParsing:tc.transitional(tc.boolean),forcedJSONParsing:tc.transitional(tc.boolean),clarifyTimeoutError:tc.transitional(tc.boolean)},!1),E!=null&&(vt.isFunction(E)?p.paramsSerializer={serialize:E}:Mv.assertOptions(E,{encode:tc.function,serialize:tc.function},!0)),p.method=(p.method||this.defaults.method||"get").toLowerCase();let R=T&&vt.merge(T.common,T[p.method]);T&&vt.forEach(["delete","get","head","post","put","patch","common"],at=>{delete T[at]}),p.headers=ca.concat(R,T);const N=[];let D=!0;this.interceptors.request.forEach(function(dt){typeof dt.runWhen=="function"&&dt.runWhen(p)===!1||(D=D&&dt.synchronous,N.unshift(dt.fulfilled,dt.rejected))});const x=[];this.interceptors.response.forEach(function(dt){x.push(dt.fulfilled,dt.rejected)});let P,G=0,z;if(!D){const at=[CD.bind(this),void 0];for(at.unshift.apply(at,N),at.push.apply(at,x),z=at.length,P=Promise.resolve(p);G<z;)P=P.then(at[G++],at[G++]);return P}z=N.length;let rt=p;for(G=0;G<z;){const at=N[G++],dt=N[G++];try{rt=at(rt)}catch(bt){dt.call(this,bt);break}}try{P=CD.call(this,rt)}catch(at){return Promise.reject(at)}for(G=0,z=x.length;G<z;)P=P.then(x[G++],x[G++]);return P}getUri(d){d=kl(this.defaults,d);const p=tk(d.baseURL,d.url);return XL(p,d.params,d.paramsSerializer)}}vt.forEach(["delete","get","head","options"],function(d){Q_.prototype[d]=function(p,_){return this.request(kl(_||{},{method:d,url:p,data:(_||{}).data}))}});vt.forEach(["post","put","patch"],function(d){function p(_){return function(T,R,N){return this.request(kl(N||{},{method:d,headers:_?{"Content-Type":"multipart/form-data"}:{},url:T,data:R}))}}Q_.prototype[d]=p(),Q_.prototype[d+"Form"]=p(!0)});const j_=Q_;class bC{constructor(d){if(typeof d!="function")throw new TypeError("executor must be a function.");let p;this.promise=new Promise(function(T){p=T});const _=this;this.promise.then(E=>{if(!_._listeners)return;let T=_._listeners.length;for(;T-- >0;)_._listeners[T](E);_._listeners=null}),this.promise.then=E=>{let T;const R=new Promise(N=>{_.subscribe(N),T=N}).then(E);return R.cancel=function(){_.unsubscribe(T)},R},d(function(T,R,N){_.reason||(_.reason=new Wh(T,R,N),p(_.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]}unsubscribe(d){if(!this._listeners)return;const p=this._listeners.indexOf(d);p!==-1&&this._listeners.splice(p,1)}static source(){let d;return{token:new bC(function(E){d=E}),cancel:d}}}const fq=bC;function _q(o){return function(p){return o.apply(null,p)}}function mq(o){return vt.isObject(o)&&o.isAxiosError===!0}const Uv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Uv).forEach(([o,d])=>{Uv[d]=o});const Eq=Uv;function ik(o){const d=new j_(o),p=VL(j_.prototype.request,d);return vt.extend(p,j_.prototype,d,{allOwnKeys:!0}),vt.extend(p,d,null,{allOwnKeys:!0}),p.create=function(E){return ik(kl(o,E))},p}const Ri=ik(RC);Ri.Axios=j_;Ri.CanceledError=Wh;Ri.CancelToken=fq;Ri.isCancel=ZL;Ri.VERSION=nk;Ri.toFormData=Rm;Ri.AxiosError=en;Ri.Cancel=Ri.CanceledError;Ri.all=function(d){return Promise.all(d)};Ri.spread=_q;Ri.isAxiosError=mq;Ri.mergeConfig=kl;Ri.AxiosHeaders=ca;Ri.formToJSON=o=>QL(vt.isHTMLForm(o)?new FormData(o):o);Ri.getAdapter=ek.getAdapter;Ri.HttpStatusCode=Eq;Ri.default=Ri;const gq=Ri;function Z_(o){return Z_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},Z_(o)}function G_(o,d){if(!o.vueAxiosInstalled){var p=sk(d)?vq(d):d;if(Cq(p)){var _=yq(o);if(_){var E=_<3?Tq:Sq;Object.keys(p).forEach(function(T){E(o,T,p[T])}),o.vueAxiosInstalled=!0}else console.error("[vue-axios] unknown Vue version")}else console.error("[vue-axios] configuration is invalid, expected options are either <axios_instance> or { <registration_key>: <axios_instance> }")}}function Tq(o,d,p){Object.defineProperty(o.prototype,d,{get:function(){return p}}),o[d]=p}function Sq(o,d,p){o.config.globalProperties[d]=p,o[d]=p}function sk(o){return o&&typeof o.get=="function"&&typeof o.post=="function"}function vq(o){return{axios:o,$http:o}}function Cq(o){return Z_(o)==="object"&&Object.keys(o).every(function(d){return sk(o[d])})}function yq(o){return o&&o.version&&Number(o.version.split(".")[0])}(typeof xv>"u"?"undefined":Z_(xv))=="object"?rk.exports=G_:typeof define=="function"&&define.amd?define([],function(){return G_}):window.Vue&&window.axios&&window.Vue.use&&Vue.use(G_,window.axios);const cd=LP(h6);cd.use(SW());cd.use(n8);cd.use(G_,gq);cd.provide("axios",cd.config.globalProperties.axios);cd.use(EH,{});cd.mount("#app");/*!
 * Color mode toggler for Bootstrap's docs (https://getbootstrap.com/)
 * Copyright 2011-2023 The Bootstrap Authors
 * Licensed under the Creative Commons Attribution 3.0 Unported License.
 */(()=>{const o=()=>localStorage.getItem("theme"),d=T=>localStorage.setItem("theme",T),p=()=>{const T=o();return T||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")},_=T=>{T==="auto"&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-bs-theme","dark"):document.documentElement.setAttribute("data-bs-theme",T)};_(p());const E=(T,R=!1)=>{const N=document.querySelector("#bd-theme");if(!N)return;const D=document.querySelector("#bd-theme-text"),x=document.querySelector(".theme-icon-active use"),P=document.querySelector(`[data-bs-theme-value="${T}"]`),G=P.querySelector("svg use").getAttribute("href");document.querySelectorAll("[data-bs-theme-value]").forEach(rt=>{rt.classList.remove("active"),rt.setAttribute("aria-pressed","false")}),P.classList.add("active"),P.setAttribute("aria-pressed","true"),x.setAttribute("href",G);const z=`${D.textContent} (${P.dataset.bsThemeValue})`;N.setAttribute("aria-label",z),R&&N.focus()};window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{const T=o();T!=="light"&&T!=="dark"&&_(p())}),window.addEventListener("DOMContentLoaded",()=>{E(p()),document.querySelectorAll("[data-bs-theme-value]").forEach(T=>{T.addEventListener("click",()=>{const R=T.getAttribute("data-bs-theme-value");d(R),_(R),E(R,!0)})})})})()});export default Rq();
